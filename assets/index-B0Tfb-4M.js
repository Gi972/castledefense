function T9(a,e){for(var t=0;t<e.length;t++){const n=e[t];if(typeof n!="string"&&!Array.isArray(n)){for(const i in n)if(i!=="default"&&!(i in a)){const s=Object.getOwnPropertyDescriptor(n,i);s&&Object.defineProperty(a,i,s.get?s:{enumerable:!0,get:()=>n[i]})}}}return Object.freeze(Object.defineProperty(a,Symbol.toStringTag,{value:"Module"}))}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))n(i);new MutationObserver(i=>{for(const s of i)if(s.type==="childList")for(const o of s.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&n(o)}).observe(document,{childList:!0,subtree:!0});function t(i){const s={};return i.integrity&&(s.integrity=i.integrity),i.referrerPolicy&&(s.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?s.credentials="include":i.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function n(i){if(i.ep)return;i.ep=!0;const s=t(i);fetch(i.href,s)}})();function CC(a){return a&&a.__esModule&&Object.prototype.hasOwnProperty.call(a,"default")?a.default:a}var KG={exports:{}},Mh={};/**
 * @license React
 * react-jsx-runtime.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var US;function z9(){if(US)return Mh;US=1;var a=Symbol.for("react.transitional.element"),e=Symbol.for("react.fragment");function t(n,i,s){var o=null;if(s!==void 0&&(o=""+s),i.key!==void 0&&(o=""+i.key),"key"in i){s={};for(var r in i)r!=="key"&&(s[r]=i[r])}else s=i;return i=s.ref,{$$typeof:a,type:n,key:o,ref:i!==void 0?i:null,props:s}}return Mh.Fragment=e,Mh.jsx=t,Mh.jsxs=t,Mh}var DS;function L9(){return DS||(DS=1,KG.exports=z9()),KG.exports}var de=L9(),FG={exports:{}},pn={};/**
 * @license React
 * react.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var kS;function _9(){if(kS)return pn;kS=1;var a=Symbol.for("react.transitional.element"),e=Symbol.for("react.portal"),t=Symbol.for("react.fragment"),n=Symbol.for("react.strict_mode"),i=Symbol.for("react.profiler"),s=Symbol.for("react.consumer"),o=Symbol.for("react.context"),r=Symbol.for("react.forward_ref"),g=Symbol.for("react.suspense"),u=Symbol.for("react.memo"),C=Symbol.for("react.lazy"),h=Symbol.iterator;function f(L){return L===null||typeof L!="object"?null:(L=h&&L[h]||L["@@iterator"],typeof L=="function"?L:null)}var p={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},y=Object.assign,v={};function G(L,D,ne){this.props=L,this.context=D,this.refs=v,this.updater=ne||p}G.prototype.isReactComponent={},G.prototype.setState=function(L,D){if(typeof L!="object"&&typeof L!="function"&&L!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,L,D,"setState")},G.prototype.forceUpdate=function(L){this.updater.enqueueForceUpdate(this,L,"forceUpdate")};function B(){}B.prototype=G.prototype;function R(L,D,ne){this.props=L,this.context=D,this.refs=v,this.updater=ne||p}var x=R.prototype=new B;x.constructor=R,y(x,G.prototype),x.isPureReactComponent=!0;var w=Array.isArray,M={H:null,A:null,T:null,S:null,V:null},H=Object.prototype.hasOwnProperty;function N(L,D,ne,oe,j,re){return ne=re.ref,{$$typeof:a,type:L,key:D,ref:ne!==void 0?ne:null,props:re}}function F(L,D){return N(L.type,D,void 0,void 0,void 0,L.props)}function Y(L){return typeof L=="object"&&L!==null&&L.$$typeof===a}function X(L){var D={"=":"=0",":":"=2"};return"$"+L.replace(/[=:]/g,function(ne){return D[ne]})}var U=/\/+/g;function O(L,D){return typeof L=="object"&&L!==null&&L.key!=null?X(""+L.key):D.toString(36)}function P(){}function ie(L){switch(L.status){case"fulfilled":return L.value;case"rejected":throw L.reason;default:switch(typeof L.status=="string"?L.then(P,P):(L.status="pending",L.then(function(D){L.status==="pending"&&(L.status="fulfilled",L.value=D)},function(D){L.status==="pending"&&(L.status="rejected",L.reason=D)})),L.status){case"fulfilled":return L.value;case"rejected":throw L.reason}}throw L}function le(L,D,ne,oe,j){var re=typeof L;(re==="undefined"||re==="boolean")&&(L=null);var pe=!1;if(L===null)pe=!0;else switch(re){case"bigint":case"string":case"number":pe=!0;break;case"object":switch(L.$$typeof){case a:case e:pe=!0;break;case C:return pe=L._init,le(pe(L._payload),D,ne,oe,j)}}if(pe)return j=j(L),pe=oe===""?"."+O(L,0):oe,w(j)?(ne="",pe!=null&&(ne=pe.replace(U,"$&/")+"/"),le(j,D,ne,"",function($e){return $e})):j!=null&&(Y(j)&&(j=F(j,ne+(j.key==null||L&&L.key===j.key?"":(""+j.key).replace(U,"$&/")+"/")+pe)),D.push(j)),1;pe=0;var me=oe===""?".":oe+":";if(w(L))for(var be=0;be<L.length;be++)oe=L[be],re=me+O(oe,be),pe+=le(oe,D,ne,re,j);else if(be=f(L),typeof be=="function")for(L=be.call(L),be=0;!(oe=L.next()).done;)oe=oe.value,re=me+O(oe,be++),pe+=le(oe,D,ne,re,j);else if(re==="object"){if(typeof L.then=="function")return le(ie(L),D,ne,oe,j);throw D=String(L),Error("Objects are not valid as a React child (found: "+(D==="[object Object]"?"object with keys {"+Object.keys(L).join(", ")+"}":D)+"). If you meant to render a collection of children, use an array instead.")}return pe}function T(L,D,ne){if(L==null)return L;var oe=[],j=0;return le(L,oe,"","",function(re){return D.call(ne,re,j++)}),oe}function J(L){if(L._status===-1){var D=L._result;D=D(),D.then(function(ne){(L._status===0||L._status===-1)&&(L._status=1,L._result=ne)},function(ne){(L._status===0||L._status===-1)&&(L._status=2,L._result=ne)}),L._status===-1&&(L._status=0,L._result=D)}if(L._status===1)return L._result.default;throw L._result}var Q=typeof reportError=="function"?reportError:function(L){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var D=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof L=="object"&&L!==null&&typeof L.message=="string"?String(L.message):String(L),error:L});if(!window.dispatchEvent(D))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",L);return}console.error(L)};function se(){}return pn.Children={map:T,forEach:function(L,D,ne){T(L,function(){D.apply(this,arguments)},ne)},count:function(L){var D=0;return T(L,function(){D++}),D},toArray:function(L){return T(L,function(D){return D})||[]},only:function(L){if(!Y(L))throw Error("React.Children.only expected to receive a single React element child.");return L}},pn.Component=G,pn.Fragment=t,pn.Profiler=i,pn.PureComponent=R,pn.StrictMode=n,pn.Suspense=g,pn.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=M,pn.__COMPILER_RUNTIME={__proto__:null,c:function(L){return M.H.useMemoCache(L)}},pn.cache=function(L){return function(){return L.apply(null,arguments)}},pn.cloneElement=function(L,D,ne){if(L==null)throw Error("The argument must be a React element, but you passed "+L+".");var oe=y({},L.props),j=L.key,re=void 0;if(D!=null)for(pe in D.ref!==void 0&&(re=void 0),D.key!==void 0&&(j=""+D.key),D)!H.call(D,pe)||pe==="key"||pe==="__self"||pe==="__source"||pe==="ref"&&D.ref===void 0||(oe[pe]=D[pe]);var pe=arguments.length-2;if(pe===1)oe.children=ne;else if(1<pe){for(var me=Array(pe),be=0;be<pe;be++)me[be]=arguments[be+2];oe.children=me}return N(L.type,j,void 0,void 0,re,oe)},pn.createContext=function(L){return L={$$typeof:o,_currentValue:L,_currentValue2:L,_threadCount:0,Provider:null,Consumer:null},L.Provider=L,L.Consumer={$$typeof:s,_context:L},L},pn.createElement=function(L,D,ne){var oe,j={},re=null;if(D!=null)for(oe in D.key!==void 0&&(re=""+D.key),D)H.call(D,oe)&&oe!=="key"&&oe!=="__self"&&oe!=="__source"&&(j[oe]=D[oe]);var pe=arguments.length-2;if(pe===1)j.children=ne;else if(1<pe){for(var me=Array(pe),be=0;be<pe;be++)me[be]=arguments[be+2];j.children=me}if(L&&L.defaultProps)for(oe in pe=L.defaultProps,pe)j[oe]===void 0&&(j[oe]=pe[oe]);return N(L,re,void 0,void 0,null,j)},pn.createRef=function(){return{current:null}},pn.forwardRef=function(L){return{$$typeof:r,render:L}},pn.isValidElement=Y,pn.lazy=function(L){return{$$typeof:C,_payload:{_status:-1,_result:L},_init:J}},pn.memo=function(L,D){return{$$typeof:u,type:L,compare:D===void 0?null:D}},pn.startTransition=function(L){var D=M.T,ne={};M.T=ne;try{var oe=L(),j=M.S;j!==null&&j(ne,oe),typeof oe=="object"&&oe!==null&&typeof oe.then=="function"&&oe.then(se,Q)}catch(re){Q(re)}finally{M.T=D}},pn.unstable_useCacheRefresh=function(){return M.H.useCacheRefresh()},pn.use=function(L){return M.H.use(L)},pn.useActionState=function(L,D,ne){return M.H.useActionState(L,D,ne)},pn.useCallback=function(L,D){return M.H.useCallback(L,D)},pn.useContext=function(L){return M.H.useContext(L)},pn.useDebugValue=function(){},pn.useDeferredValue=function(L,D){return M.H.useDeferredValue(L,D)},pn.useEffect=function(L,D,ne){var oe=M.H;if(typeof ne=="function")throw Error("useEffect CRUD overload is not enabled in this build of React.");return oe.useEffect(L,D)},pn.useId=function(){return M.H.useId()},pn.useImperativeHandle=function(L,D,ne){return M.H.useImperativeHandle(L,D,ne)},pn.useInsertionEffect=function(L,D){return M.H.useInsertionEffect(L,D)},pn.useLayoutEffect=function(L,D){return M.H.useLayoutEffect(L,D)},pn.useMemo=function(L,D){return M.H.useMemo(L,D)},pn.useOptimistic=function(L,D){return M.H.useOptimistic(L,D)},pn.useReducer=function(L,D,ne){return M.H.useReducer(L,D,ne)},pn.useRef=function(L){return M.H.useRef(L)},pn.useState=function(L){return M.H.useState(L)},pn.useSyncExternalStore=function(L,D,ne){return M.H.useSyncExternalStore(L,D,ne)},pn.useTransition=function(){return M.H.useTransition()},pn.version="19.1.0",pn}var OS;function uA(){return OS||(OS=1,FG.exports=_9()),FG.exports}var E=uA();const fe=CC(E),U9=T9({__proto__:null,default:fe},[E]);var EG={exports:{}},Hh={},TG={exports:{}},zG={};/**
 * @license React
 * scheduler.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var JS;function D9(){return JS||(JS=1,function(a){function e(T,J){var Q=T.length;T.push(J);e:for(;0<Q;){var se=Q-1>>>1,L=T[se];if(0<i(L,J))T[se]=J,T[Q]=L,Q=se;else break e}}function t(T){return T.length===0?null:T[0]}function n(T){if(T.length===0)return null;var J=T[0],Q=T.pop();if(Q!==J){T[0]=Q;e:for(var se=0,L=T.length,D=L>>>1;se<D;){var ne=2*(se+1)-1,oe=T[ne],j=ne+1,re=T[j];if(0>i(oe,Q))j<L&&0>i(re,oe)?(T[se]=re,T[j]=Q,se=j):(T[se]=oe,T[ne]=Q,se=ne);else if(j<L&&0>i(re,Q))T[se]=re,T[j]=Q,se=j;else break e}}return J}function i(T,J){var Q=T.sortIndex-J.sortIndex;return Q!==0?Q:T.id-J.id}if(a.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var s=performance;a.unstable_now=function(){return s.now()}}else{var o=Date,r=o.now();a.unstable_now=function(){return o.now()-r}}var g=[],u=[],C=1,h=null,f=3,p=!1,y=!1,v=!1,G=!1,B=typeof setTimeout=="function"?setTimeout:null,R=typeof clearTimeout=="function"?clearTimeout:null,x=typeof setImmediate<"u"?setImmediate:null;function w(T){for(var J=t(u);J!==null;){if(J.callback===null)n(u);else if(J.startTime<=T)n(u),J.sortIndex=J.expirationTime,e(g,J);else break;J=t(u)}}function M(T){if(v=!1,w(T),!y)if(t(g)!==null)y=!0,H||(H=!0,O());else{var J=t(u);J!==null&&le(M,J.startTime-T)}}var H=!1,N=-1,F=5,Y=-1;function X(){return G?!0:!(a.unstable_now()-Y<F)}function U(){if(G=!1,H){var T=a.unstable_now();Y=T;var J=!0;try{e:{y=!1,v&&(v=!1,R(N),N=-1),p=!0;var Q=f;try{t:{for(w(T),h=t(g);h!==null&&!(h.expirationTime>T&&X());){var se=h.callback;if(typeof se=="function"){h.callback=null,f=h.priorityLevel;var L=se(h.expirationTime<=T);if(T=a.unstable_now(),typeof L=="function"){h.callback=L,w(T),J=!0;break t}h===t(g)&&n(g),w(T)}else n(g);h=t(g)}if(h!==null)J=!0;else{var D=t(u);D!==null&&le(M,D.startTime-T),J=!1}}break e}finally{h=null,f=Q,p=!1}J=void 0}}finally{J?O():H=!1}}}var O;if(typeof x=="function")O=function(){x(U)};else if(typeof MessageChannel<"u"){var P=new MessageChannel,ie=P.port2;P.port1.onmessage=U,O=function(){ie.postMessage(null)}}else O=function(){B(U,0)};function le(T,J){N=B(function(){T(a.unstable_now())},J)}a.unstable_IdlePriority=5,a.unstable_ImmediatePriority=1,a.unstable_LowPriority=4,a.unstable_NormalPriority=3,a.unstable_Profiling=null,a.unstable_UserBlockingPriority=2,a.unstable_cancelCallback=function(T){T.callback=null},a.unstable_forceFrameRate=function(T){0>T||125<T?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):F=0<T?Math.floor(1e3/T):5},a.unstable_getCurrentPriorityLevel=function(){return f},a.unstable_next=function(T){switch(f){case 1:case 2:case 3:var J=3;break;default:J=f}var Q=f;f=J;try{return T()}finally{f=Q}},a.unstable_requestPaint=function(){G=!0},a.unstable_runWithPriority=function(T,J){switch(T){case 1:case 2:case 3:case 4:case 5:break;default:T=3}var Q=f;f=T;try{return J()}finally{f=Q}},a.unstable_scheduleCallback=function(T,J,Q){var se=a.unstable_now();switch(typeof Q=="object"&&Q!==null?(Q=Q.delay,Q=typeof Q=="number"&&0<Q?se+Q:se):Q=se,T){case 1:var L=-1;break;case 2:L=250;break;case 5:L=1073741823;break;case 4:L=1e4;break;default:L=5e3}return L=Q+L,T={id:C++,callback:J,priorityLevel:T,startTime:Q,expirationTime:L,sortIndex:-1},Q>se?(T.sortIndex=Q,e(u,T),t(g)===null&&T===t(u)&&(v?(R(N),N=-1):v=!0,le(M,Q-se))):(T.sortIndex=L,e(g,T),y||p||(y=!0,H||(H=!0,O()))),T},a.unstable_shouldYield=X,a.unstable_wrapCallback=function(T){var J=f;return function(){var Q=f;f=J;try{return T.apply(this,arguments)}finally{f=Q}}}}(zG)),zG}var PS;function k9(){return PS||(PS=1,TG.exports=D9()),TG.exports}var LG={exports:{}},As={};/**
 * @license React
 * react-dom.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var QS;function O9(){if(QS)return As;QS=1;var a=uA();function e(g){var u="https://react.dev/errors/"+g;if(1<arguments.length){u+="?args[]="+encodeURIComponent(arguments[1]);for(var C=2;C<arguments.length;C++)u+="&args[]="+encodeURIComponent(arguments[C])}return"Minified React error #"+g+"; visit "+u+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function t(){}var n={d:{f:t,r:function(){throw Error(e(522))},D:t,C:t,L:t,m:t,X:t,S:t,M:t},p:0,findDOMNode:null},i=Symbol.for("react.portal");function s(g,u,C){var h=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:i,key:h==null?null:""+h,children:g,containerInfo:u,implementation:C}}var o=a.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function r(g,u){if(g==="font")return"";if(typeof u=="string")return u==="use-credentials"?u:""}return As.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=n,As.createPortal=function(g,u){var C=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!u||u.nodeType!==1&&u.nodeType!==9&&u.nodeType!==11)throw Error(e(299));return s(g,u,null,C)},As.flushSync=function(g){var u=o.T,C=n.p;try{if(o.T=null,n.p=2,g)return g()}finally{o.T=u,n.p=C,n.d.f()}},As.preconnect=function(g,u){typeof g=="string"&&(u?(u=u.crossOrigin,u=typeof u=="string"?u==="use-credentials"?u:"":void 0):u=null,n.d.C(g,u))},As.prefetchDNS=function(g){typeof g=="string"&&n.d.D(g)},As.preinit=function(g,u){if(typeof g=="string"&&u&&typeof u.as=="string"){var C=u.as,h=r(C,u.crossOrigin),f=typeof u.integrity=="string"?u.integrity:void 0,p=typeof u.fetchPriority=="string"?u.fetchPriority:void 0;C==="style"?n.d.S(g,typeof u.precedence=="string"?u.precedence:void 0,{crossOrigin:h,integrity:f,fetchPriority:p}):C==="script"&&n.d.X(g,{crossOrigin:h,integrity:f,fetchPriority:p,nonce:typeof u.nonce=="string"?u.nonce:void 0})}},As.preinitModule=function(g,u){if(typeof g=="string")if(typeof u=="object"&&u!==null){if(u.as==null||u.as==="script"){var C=r(u.as,u.crossOrigin);n.d.M(g,{crossOrigin:C,integrity:typeof u.integrity=="string"?u.integrity:void 0,nonce:typeof u.nonce=="string"?u.nonce:void 0})}}else u==null&&n.d.M(g)},As.preload=function(g,u){if(typeof g=="string"&&typeof u=="object"&&u!==null&&typeof u.as=="string"){var C=u.as,h=r(C,u.crossOrigin);n.d.L(g,C,{crossOrigin:h,integrity:typeof u.integrity=="string"?u.integrity:void 0,nonce:typeof u.nonce=="string"?u.nonce:void 0,type:typeof u.type=="string"?u.type:void 0,fetchPriority:typeof u.fetchPriority=="string"?u.fetchPriority:void 0,referrerPolicy:typeof u.referrerPolicy=="string"?u.referrerPolicy:void 0,imageSrcSet:typeof u.imageSrcSet=="string"?u.imageSrcSet:void 0,imageSizes:typeof u.imageSizes=="string"?u.imageSizes:void 0,media:typeof u.media=="string"?u.media:void 0})}},As.preloadModule=function(g,u){if(typeof g=="string")if(u){var C=r(u.as,u.crossOrigin);n.d.m(g,{as:typeof u.as=="string"&&u.as!=="script"?u.as:void 0,crossOrigin:C,integrity:typeof u.integrity=="string"?u.integrity:void 0})}else n.d.m(g)},As.requestFormReset=function(g){n.d.r(g)},As.unstable_batchedUpdates=function(g,u){return g(u)},As.useFormState=function(g,u,C){return o.H.useFormState(g,u,C)},As.useFormStatus=function(){return o.H.useHostTransitionStatus()},As.version="19.1.0",As}var jS;function EW(){if(jS)return LG.exports;jS=1;function a(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(a)}catch(e){console.error(e)}}return a(),LG.exports=O9(),LG.exports}/**
 * @license React
 * react-dom-client.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var qS;function J9(){if(qS)return Hh;qS=1;var a=k9(),e=uA(),t=EW();function n(l){var c="https://react.dev/errors/"+l;if(1<arguments.length){c+="?args[]="+encodeURIComponent(arguments[1]);for(var A=2;A<arguments.length;A++)c+="&args[]="+encodeURIComponent(arguments[A])}return"Minified React error #"+l+"; visit "+c+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function i(l){return!(!l||l.nodeType!==1&&l.nodeType!==9&&l.nodeType!==11)}function s(l){var c=l,A=l;if(l.alternate)for(;c.return;)c=c.return;else{l=c;do c=l,(c.flags&4098)!==0&&(A=c.return),l=c.return;while(l)}return c.tag===3?A:null}function o(l){if(l.tag===13){var c=l.memoizedState;if(c===null&&(l=l.alternate,l!==null&&(c=l.memoizedState)),c!==null)return c.dehydrated}return null}function r(l){if(s(l)!==l)throw Error(n(188))}function g(l){var c=l.alternate;if(!c){if(c=s(l),c===null)throw Error(n(188));return c!==l?null:l}for(var A=l,m=c;;){var Z=A.return;if(Z===null)break;var W=Z.alternate;if(W===null){if(m=Z.return,m!==null){A=m;continue}break}if(Z.child===W.child){for(W=Z.child;W;){if(W===A)return r(Z),l;if(W===m)return r(Z),c;W=W.sibling}throw Error(n(188))}if(A.return!==m.return)A=Z,m=W;else{for(var _=!1,ee=Z.child;ee;){if(ee===A){_=!0,A=Z,m=W;break}if(ee===m){_=!0,m=Z,A=W;break}ee=ee.sibling}if(!_){for(ee=W.child;ee;){if(ee===A){_=!0,A=W,m=Z;break}if(ee===m){_=!0,m=W,A=Z;break}ee=ee.sibling}if(!_)throw Error(n(189))}}if(A.alternate!==m)throw Error(n(190))}if(A.tag!==3)throw Error(n(188));return A.stateNode.current===A?l:c}function u(l){var c=l.tag;if(c===5||c===26||c===27||c===6)return l;for(l=l.child;l!==null;){if(c=u(l),c!==null)return c;l=l.sibling}return null}var C=Object.assign,h=Symbol.for("react.element"),f=Symbol.for("react.transitional.element"),p=Symbol.for("react.portal"),y=Symbol.for("react.fragment"),v=Symbol.for("react.strict_mode"),G=Symbol.for("react.profiler"),B=Symbol.for("react.provider"),R=Symbol.for("react.consumer"),x=Symbol.for("react.context"),w=Symbol.for("react.forward_ref"),M=Symbol.for("react.suspense"),H=Symbol.for("react.suspense_list"),N=Symbol.for("react.memo"),F=Symbol.for("react.lazy"),Y=Symbol.for("react.activity"),X=Symbol.for("react.memo_cache_sentinel"),U=Symbol.iterator;function O(l){return l===null||typeof l!="object"?null:(l=U&&l[U]||l["@@iterator"],typeof l=="function"?l:null)}var P=Symbol.for("react.client.reference");function ie(l){if(l==null)return null;if(typeof l=="function")return l.$$typeof===P?null:l.displayName||l.name||null;if(typeof l=="string")return l;switch(l){case y:return"Fragment";case G:return"Profiler";case v:return"StrictMode";case M:return"Suspense";case H:return"SuspenseList";case Y:return"Activity"}if(typeof l=="object")switch(l.$$typeof){case p:return"Portal";case x:return(l.displayName||"Context")+".Provider";case R:return(l._context.displayName||"Context")+".Consumer";case w:var c=l.render;return l=l.displayName,l||(l=c.displayName||c.name||"",l=l!==""?"ForwardRef("+l+")":"ForwardRef"),l;case N:return c=l.displayName||null,c!==null?c:ie(l.type)||"Memo";case F:c=l._payload,l=l._init;try{return ie(l(c))}catch{}}return null}var le=Array.isArray,T=e.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,J=t.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,Q={pending:!1,data:null,method:null,action:null},se=[],L=-1;function D(l){return{current:l}}function ne(l){0>L||(l.current=se[L],se[L]=null,L--)}function oe(l,c){L++,se[L]=l.current,l.current=c}var j=D(null),re=D(null),pe=D(null),me=D(null);function be(l,c){switch(oe(pe,c),oe(re,l),oe(j,null),c.nodeType){case 9:case 11:l=(l=c.documentElement)&&(l=l.namespaceURI)?pS(l):0;break;default:if(l=c.tagName,c=c.namespaceURI)c=pS(c),l=mS(c,l);else switch(l){case"svg":l=1;break;case"math":l=2;break;default:l=0}}ne(j),oe(j,l)}function $e(){ne(j),ne(re),ne(pe)}function qe(l){l.memoizedState!==null&&oe(me,l);var c=j.current,A=mS(c,l.type);c!==A&&(oe(re,l),oe(j,A))}function ke(l){re.current===l&&(ne(j),ne(re)),me.current===l&&(ne(me),Rh._currentValue=Q)}var Te=Object.prototype.hasOwnProperty,ut=a.unstable_scheduleCallback,q=a.unstable_cancelCallback,De=a.unstable_shouldYield,Ke=a.unstable_requestPaint,Ee=a.unstable_now,ye=a.unstable_getCurrentPriorityLevel,Je=a.unstable_ImmediatePriority,Me=a.unstable_UserBlockingPriority,Ze=a.unstable_NormalPriority,gt=a.unstable_LowPriority,k=a.unstable_IdlePriority,z=a.log,Ce=a.unstable_setDisableYieldValue,Ve=null,Ge=null;function we(l){if(typeof z=="function"&&Ce(l),Ge&&typeof Ge.setStrictMode=="function")try{Ge.setStrictMode(Ve,l)}catch{}}var et=Math.clz32?Math.clz32:At,lt=Math.log,Ct=Math.LN2;function At(l){return l>>>=0,l===0?32:31-(lt(l)/Ct|0)|0}var Ne=256,tt=4194304;function nt(l){var c=l&42;if(c!==0)return c;switch(l&-l){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return l&4194048;case 4194304:case 8388608:case 16777216:case 33554432:return l&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return l}}function ue(l,c,A){var m=l.pendingLanes;if(m===0)return 0;var Z=0,W=l.suspendedLanes,_=l.pingedLanes;l=l.warmLanes;var ee=m&134217727;return ee!==0?(m=ee&~W,m!==0?Z=nt(m):(_&=ee,_!==0?Z=nt(_):A||(A=ee&~l,A!==0&&(Z=nt(A))))):(ee=m&~W,ee!==0?Z=nt(ee):_!==0?Z=nt(_):A||(A=m&~l,A!==0&&(Z=nt(A)))),Z===0?0:c!==0&&c!==Z&&(c&W)===0&&(W=Z&-Z,A=c&-c,W>=A||W===32&&(A&4194048)!==0)?c:Z}function xe(l,c){return(l.pendingLanes&~(l.suspendedLanes&~l.pingedLanes)&c)===0}function ct(l,c){switch(l){case 1:case 2:case 4:case 8:case 64:return c+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return c+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function Ie(){var l=Ne;return Ne<<=1,(Ne&4194048)===0&&(Ne=256),l}function Qe(){var l=tt;return tt<<=1,(tt&62914560)===0&&(tt=4194304),l}function je(l){for(var c=[],A=0;31>A;A++)c.push(l);return c}function mt(l,c){l.pendingLanes|=c,c!==268435456&&(l.suspendedLanes=0,l.pingedLanes=0,l.warmLanes=0)}function it(l,c,A,m,Z,W){var _=l.pendingLanes;l.pendingLanes=A,l.suspendedLanes=0,l.pingedLanes=0,l.warmLanes=0,l.expiredLanes&=A,l.entangledLanes&=A,l.errorRecoveryDisabledLanes&=A,l.shellSuspendCounter=0;var ee=l.entanglements,Ae=l.expirationTimes,Fe=l.hiddenUpdates;for(A=_&~A;0<A;){var ot=31-et(A),It=1<<ot;ee[ot]=0,Ae[ot]=-1;var Ue=Fe[ot];if(Ue!==null)for(Fe[ot]=null,ot=0;ot<Ue.length;ot++){var Oe=Ue[ot];Oe!==null&&(Oe.lane&=-536870913)}A&=~It}m!==0&&_e(l,m,0),W!==0&&Z===0&&l.tag!==0&&(l.suspendedLanes|=W&~(_&~c))}function _e(l,c,A){l.pendingLanes|=c,l.suspendedLanes&=~c;var m=31-et(c);l.entangledLanes|=c,l.entanglements[m]=l.entanglements[m]|1073741824|A&4194090}function ht(l,c){var A=l.entangledLanes|=c;for(l=l.entanglements;A;){var m=31-et(A),Z=1<<m;Z&c|l[m]&c&&(l[m]|=c),A&=~Z}}function yt(l){switch(l){case 2:l=1;break;case 8:l=4;break;case 32:l=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:l=128;break;case 268435456:l=134217728;break;default:l=0}return l}function Bt(l){return l&=-l,2<l?8<l?(l&134217727)!==0?32:268435456:8:2}function xt(){var l=J.p;return l!==0?l:(l=window.event,l===void 0?32:FS(l.type))}function Gn(l,c){var A=J.p;try{return J.p=l,c()}finally{J.p=A}}var gn=Math.random().toString(36).slice(2),Cn="__reactFiber$"+gn,Kn="__reactProps$"+gn,ui="__reactContainer$"+gn,hi="__reactEvents$"+gn,$a="__reactListeners$"+gn,aa="__reactHandles$"+gn,Ii="__reactResources$"+gn,Jn="__reactMarker$"+gn;function Bn(l){delete l[Cn],delete l[Kn],delete l[hi],delete l[$a],delete l[aa]}function es(l){var c=l[Cn];if(c)return c;for(var A=l.parentNode;A;){if(c=A[ui]||A[Cn]){if(A=c.alternate,c.child!==null||A!==null&&A.child!==null)for(l=BS(l);l!==null;){if(A=l[Cn])return A;l=BS(l)}return c}l=A,A=l.parentNode}return null}function Ea(l){if(l=l[Cn]||l[ui]){var c=l.tag;if(c===5||c===6||c===13||c===26||c===27||c===3)return l}return null}function jo(l){var c=l.tag;if(c===5||c===26||c===27||c===6)return l.stateNode;throw Error(n(33))}function no(l){var c=l[Ii];return c||(c=l[Ii]={hoistableStyles:new Map,hoistableScripts:new Map}),c}function Ci(l){l[Jn]=!0}var qo=new Set,Zr={};function ts(l,c){$(l,c),$(l+"Capture",c)}function $(l,c){for(Zr[l]=c,l=0;l<c.length;l++)qo.add(c[l])}var Se=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),ze={},Be={};function We(l){return Te.call(Be,l)?!0:Te.call(ze,l)?!1:Se.test(l)?Be[l]=!0:(ze[l]=!0,!1)}function dt(l,c,A){if(We(c))if(A===null)l.removeAttribute(c);else{switch(typeof A){case"undefined":case"function":case"symbol":l.removeAttribute(c);return;case"boolean":var m=c.toLowerCase().slice(0,5);if(m!=="data-"&&m!=="aria-"){l.removeAttribute(c);return}}l.setAttribute(c,""+A)}}function bt(l,c,A){if(A===null)l.removeAttribute(c);else{switch(typeof A){case"undefined":case"function":case"symbol":case"boolean":l.removeAttribute(c);return}l.setAttribute(c,""+A)}}function vt(l,c,A,m){if(m===null)l.removeAttribute(A);else{switch(typeof m){case"undefined":case"function":case"symbol":case"boolean":l.removeAttribute(A);return}l.setAttributeNS(c,A,""+m)}}var Zt,Tt;function Xt(l){if(Zt===void 0)try{throw Error()}catch(A){var c=A.stack.trim().match(/\n( *(at )?)/);Zt=c&&c[1]||"",Tt=-1<A.stack.indexOf(`
    at`)?" (<anonymous>)":-1<A.stack.indexOf("@")?"@unknown:0:0":""}return`
`+Zt+l+Tt}var Wt=!1;function en(l,c){if(!l||Wt)return"";Wt=!0;var A=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var m={DetermineComponentFrameRoot:function(){try{if(c){var It=function(){throw Error()};if(Object.defineProperty(It.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(It,[])}catch(Oe){var Ue=Oe}Reflect.construct(l,[],It)}else{try{It.call()}catch(Oe){Ue=Oe}l.call(It.prototype)}}else{try{throw Error()}catch(Oe){Ue=Oe}(It=l())&&typeof It.catch=="function"&&It.catch(function(){})}}catch(Oe){if(Oe&&Ue&&typeof Oe.stack=="string")return[Oe.stack,Ue.stack]}return[null,null]}};m.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var Z=Object.getOwnPropertyDescriptor(m.DetermineComponentFrameRoot,"name");Z&&Z.configurable&&Object.defineProperty(m.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var W=m.DetermineComponentFrameRoot(),_=W[0],ee=W[1];if(_&&ee){var Ae=_.split(`
`),Fe=ee.split(`
`);for(Z=m=0;m<Ae.length&&!Ae[m].includes("DetermineComponentFrameRoot");)m++;for(;Z<Fe.length&&!Fe[Z].includes("DetermineComponentFrameRoot");)Z++;if(m===Ae.length||Z===Fe.length)for(m=Ae.length-1,Z=Fe.length-1;1<=m&&0<=Z&&Ae[m]!==Fe[Z];)Z--;for(;1<=m&&0<=Z;m--,Z--)if(Ae[m]!==Fe[Z]){if(m!==1||Z!==1)do if(m--,Z--,0>Z||Ae[m]!==Fe[Z]){var ot=`
`+Ae[m].replace(" at new "," at ");return l.displayName&&ot.includes("<anonymous>")&&(ot=ot.replace("<anonymous>",l.displayName)),ot}while(1<=m&&0<=Z);break}}}finally{Wt=!1,Error.prepareStackTrace=A}return(A=l?l.displayName||l.name:"")?Xt(A):""}function bn(l){switch(l.tag){case 26:case 27:case 5:return Xt(l.type);case 16:return Xt("Lazy");case 13:return Xt("Suspense");case 19:return Xt("SuspenseList");case 0:case 15:return en(l.type,!1);case 11:return en(l.type.render,!1);case 1:return en(l.type,!0);case 31:return Xt("Activity");default:return""}}function Tn(l){try{var c="";do c+=bn(l),l=l.return;while(l);return c}catch(A){return`
Error generating stack: `+A.message+`
`+A.stack}}function cn(l){switch(typeof l){case"bigint":case"boolean":case"number":case"string":case"undefined":return l;case"object":return l;default:return""}}function fn(l){var c=l.type;return(l=l.nodeName)&&l.toLowerCase()==="input"&&(c==="checkbox"||c==="radio")}function Nt(l){var c=fn(l)?"checked":"value",A=Object.getOwnPropertyDescriptor(l.constructor.prototype,c),m=""+l[c];if(!l.hasOwnProperty(c)&&typeof A<"u"&&typeof A.get=="function"&&typeof A.set=="function"){var Z=A.get,W=A.set;return Object.defineProperty(l,c,{configurable:!0,get:function(){return Z.call(this)},set:function(_){m=""+_,W.call(this,_)}}),Object.defineProperty(l,c,{enumerable:A.enumerable}),{getValue:function(){return m},setValue:function(_){m=""+_},stopTracking:function(){l._valueTracker=null,delete l[c]}}}}function Pn(l){l._valueTracker||(l._valueTracker=Nt(l))}function un(l){if(!l)return!1;var c=l._valueTracker;if(!c)return!0;var A=c.getValue(),m="";return l&&(m=fn(l)?l.checked?"true":"false":l.value),l=m,l!==A?(c.setValue(l),!0):!1}function Ni(l){if(l=l||(typeof document<"u"?document:void 0),typeof l>"u")return null;try{return l.activeElement||l.body}catch{return l.body}}var ns=/[\n"\\]/g;function Fn(l){return l.replace(ns,function(c){return"\\"+c.charCodeAt(0).toString(16)+" "})}function Yi(l,c,A,m,Z,W,_,ee){l.name="",_!=null&&typeof _!="function"&&typeof _!="symbol"&&typeof _!="boolean"?l.type=_:l.removeAttribute("type"),c!=null?_==="number"?(c===0&&l.value===""||l.value!=c)&&(l.value=""+cn(c)):l.value!==""+cn(c)&&(l.value=""+cn(c)):_!=="submit"&&_!=="reset"||l.removeAttribute("value"),c!=null?Si(l,_,cn(c)):A!=null?Si(l,_,cn(A)):m!=null&&l.removeAttribute("value"),Z==null&&W!=null&&(l.defaultChecked=!!W),Z!=null&&(l.checked=Z&&typeof Z!="function"&&typeof Z!="symbol"),ee!=null&&typeof ee!="function"&&typeof ee!="symbol"&&typeof ee!="boolean"?l.name=""+cn(ee):l.removeAttribute("name")}function zn(l,c,A,m,Z,W,_,ee){if(W!=null&&typeof W!="function"&&typeof W!="symbol"&&typeof W!="boolean"&&(l.type=W),c!=null||A!=null){if(!(W!=="submit"&&W!=="reset"||c!=null))return;A=A!=null?""+cn(A):"",c=c!=null?""+cn(c):A,ee||c===l.value||(l.value=c),l.defaultValue=c}m=m??Z,m=typeof m!="function"&&typeof m!="symbol"&&!!m,l.checked=ee?l.checked:!!m,l.defaultChecked=!!m,_!=null&&typeof _!="function"&&typeof _!="symbol"&&typeof _!="boolean"&&(l.name=_)}function Si(l,c,A){c==="number"&&Ni(l.ownerDocument)===l||l.defaultValue===""+A||(l.defaultValue=""+A)}function ti(l,c,A,m){if(l=l.options,c){c={};for(var Z=0;Z<A.length;Z++)c["$"+A[Z]]=!0;for(A=0;A<l.length;A++)Z=c.hasOwnProperty("$"+l[A].value),l[A].selected!==Z&&(l[A].selected=Z),Z&&m&&(l[A].defaultSelected=!0)}else{for(A=""+cn(A),c=null,Z=0;Z<l.length;Z++){if(l[Z].value===A){l[Z].selected=!0,m&&(l[Z].defaultSelected=!0);return}c!==null||l[Z].disabled||(c=l[Z])}c!==null&&(c.selected=!0)}}function Ki(l,c,A){if(c!=null&&(c=""+cn(c),c!==l.value&&(l.value=c),A==null)){l.defaultValue!==c&&(l.defaultValue=c);return}l.defaultValue=A!=null?""+cn(A):""}function bi(l,c,A,m){if(c==null){if(m!=null){if(A!=null)throw Error(n(92));if(le(m)){if(1<m.length)throw Error(n(93));m=m[0]}A=m}A==null&&(A=""),c=A}A=cn(c),l.defaultValue=A,m=l.textContent,m===A&&m!==""&&m!==null&&(l.value=m)}function Pi(l,c){if(c){var A=l.firstChild;if(A&&A===l.lastChild&&A.nodeType===3){A.nodeValue=c;return}}l.textContent=c}var is=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function Sr(l,c,A){var m=c.indexOf("--")===0;A==null||typeof A=="boolean"||A===""?m?l.setProperty(c,""):c==="float"?l.cssFloat="":l[c]="":m?l.setProperty(c,A):typeof A!="number"||A===0||is.has(c)?c==="float"?l.cssFloat=A:l[c]=(""+A).trim():l[c]=A+"px"}function Rr(l,c,A){if(c!=null&&typeof c!="object")throw Error(n(62));if(l=l.style,A!=null){for(var m in A)!A.hasOwnProperty(m)||c!=null&&c.hasOwnProperty(m)||(m.indexOf("--")===0?l.setProperty(m,""):m==="float"?l.cssFloat="":l[m]="");for(var Z in c)m=c[Z],c.hasOwnProperty(Z)&&A[Z]!==m&&Sr(l,Z,m)}else for(var W in c)c.hasOwnProperty(W)&&Sr(l,W,c[W])}function wr(l){if(l.indexOf("-")===-1)return!1;switch(l){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Vl=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),Hu=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function $o(l){return Hu.test(""+l)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":l}var Vo=null;function Mo(l){return l=l.target||l.srcElement||window,l.correspondingUseElement&&(l=l.correspondingUseElement),l.nodeType===3?l.parentNode:l}var as=null,el=null;function Ml(l){var c=Ea(l);if(c&&(l=c.stateNode)){var A=l[Kn]||null;e:switch(l=c.stateNode,c.type){case"input":if(Yi(l,A.value,A.defaultValue,A.defaultValue,A.checked,A.defaultChecked,A.type,A.name),c=A.name,A.type==="radio"&&c!=null){for(A=l;A.parentNode;)A=A.parentNode;for(A=A.querySelectorAll('input[name="'+Fn(""+c)+'"][type="radio"]'),c=0;c<A.length;c++){var m=A[c];if(m!==l&&m.form===l.form){var Z=m[Kn]||null;if(!Z)throw Error(n(90));Yi(m,Z.value,Z.defaultValue,Z.defaultValue,Z.checked,Z.defaultChecked,Z.type,Z.name)}}for(c=0;c<A.length;c++)m=A[c],m.form===l.form&&un(m)}break e;case"textarea":Ki(l,A.value,A.defaultValue);break e;case"select":c=A.value,c!=null&&ti(l,!!A.multiple,c,!1)}}}var Hl=!1;function yg(l,c,A){if(Hl)return l(c,A);Hl=!0;try{var m=l(c);return m}finally{if(Hl=!1,(as!==null||el!==null)&&(Al(),as&&(c=as,l=el,el=as=null,Ml(c),l)))for(c=0;c<l.length;c++)Ml(l[c])}}function Xl(l,c){var A=l.stateNode;if(A===null)return null;var m=A[Kn]||null;if(m===null)return null;A=m[c];e:switch(c){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(m=!m.disabled)||(l=l.type,m=!(l==="button"||l==="input"||l==="select"||l==="textarea")),l=!m;break e;default:l=!1}if(l)return null;if(A&&typeof A!="function")throw Error(n(231,c,typeof A));return A}var Ta=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),Nl=!1;if(Ta)try{var Yl={};Object.defineProperty(Yl,"passive",{get:function(){Nl=!0}}),window.addEventListener("test",Yl,Yl),window.removeEventListener("test",Yl,Yl)}catch{Nl=!1}var Fi=null,Gg=null,Bg=null;function Bc(){if(Bg)return Bg;var l,c=Gg,A=c.length,m,Z="value"in Fi?Fi.value:Fi.textContent,W=Z.length;for(l=0;l<A&&c[l]===Z[l];l++);var _=A-l;for(m=1;m<=_&&c[A-m]===Z[W-m];m++);return Bg=Z.slice(l,1<m?1-m:void 0)}function io(l){var c=l.keyCode;return"charCode"in l?(l=l.charCode,l===0&&c===13&&(l=13)):l=c,l===10&&(l=13),32<=l||l===13?l:0}function Kl(){return!0}function xr(){return!1}function Ei(l){function c(A,m,Z,W,_){this._reactName=A,this._targetInst=Z,this.type=m,this.nativeEvent=W,this.target=_,this.currentTarget=null;for(var ee in l)l.hasOwnProperty(ee)&&(A=l[ee],this[ee]=A?A(W):W[ee]);return this.isDefaultPrevented=(W.defaultPrevented!=null?W.defaultPrevented:W.returnValue===!1)?Kl:xr,this.isPropagationStopped=xr,this}return C(c.prototype,{preventDefault:function(){this.defaultPrevented=!0;var A=this.nativeEvent;A&&(A.preventDefault?A.preventDefault():typeof A.returnValue!="unknown"&&(A.returnValue=!1),this.isDefaultPrevented=Kl)},stopPropagation:function(){var A=this.nativeEvent;A&&(A.stopPropagation?A.stopPropagation():typeof A.cancelBubble!="unknown"&&(A.cancelBubble=!0),this.isPropagationStopped=Kl)},persist:function(){},isPersistent:Kl}),c}var ss={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(l){return l.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},za=Ei(ss),Fl=C({},ss,{view:0,detail:0}),vc=Ei(Fl),Rs,ao,El,so=C({},Fl,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Yu,button:0,buttons:0,relatedTarget:function(l){return l.relatedTarget===void 0?l.fromElement===l.srcElement?l.toElement:l.fromElement:l.relatedTarget},movementX:function(l){return"movementX"in l?l.movementX:(l!==El&&(El&&l.type==="mousemove"?(Rs=l.screenX-El.screenX,ao=l.screenY-El.screenY):ao=Rs=0,El=l),Rs)},movementY:function(l){return"movementY"in l?l.movementY:ao}}),vg=Ei(so),Wa=C({},so,{dataTransfer:0}),vA=Ei(Wa),Ri=C({},Fl,{relatedTarget:0}),Tl=Ei(Ri),Xu=C({},ss,{animationName:0,elapsedTime:0,pseudoElement:0}),bC=Ei(Xu),pa=C({},ss,{clipboardData:function(l){return"clipboardData"in l?l.clipboardData:window.clipboardData}}),os=Ei(pa),Qi=C({},ss,{data:0}),ws=Ei(Qi),Nu={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},cp={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},up={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function ZA(l){var c=this.nativeEvent;return c.getModifierState?c.getModifierState(l):(l=up[l])?!!c[l]:!1}function Yu(){return ZA}var Ip=C({},Fl,{key:function(l){if(l.key){var c=Nu[l.key]||l.key;if(c!=="Unidentified")return c}return l.type==="keypress"?(l=io(l),l===13?"Enter":String.fromCharCode(l)):l.type==="keydown"||l.type==="keyup"?cp[l.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Yu,charCode:function(l){return l.type==="keypress"?io(l):0},keyCode:function(l){return l.type==="keydown"||l.type==="keyup"?l.keyCode:0},which:function(l){return l.type==="keypress"?io(l):l.type==="keydown"||l.type==="keyup"?l.keyCode:0}}),SA=Ei(Ip),RA=C({},so,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),yC=Ei(RA),Cp=C({},Fl,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Yu}),wA=Ei(Cp),dp=C({},ss,{propertyName:0,elapsedTime:0,pseudoElement:0}),zl=Ei(dp),xA=C({},so,{deltaX:function(l){return"deltaX"in l?l.deltaX:"wheelDeltaX"in l?-l.wheelDeltaX:0},deltaY:function(l){return"deltaY"in l?l.deltaY:"wheelDeltaY"in l?-l.wheelDeltaY:"wheelDelta"in l?-l.wheelDelta:0},deltaZ:0,deltaMode:0}),nG=Ei(xA),Ap=C({},ss,{newState:0,oldState:0}),Wr=Ei(Ap),Ll=[9,13,27,32],Ku=Ta&&"CompositionEvent"in window,Zg=null;Ta&&"documentMode"in document&&(Zg=document.documentMode);var Fu=Ta&&"TextEvent"in window&&!Zg,Eu=Ta&&(!Ku||Zg&&8<Zg&&11>=Zg),Vr=" ",ma=!1;function Tu(l,c){switch(l){case"keyup":return Ll.indexOf(c.keyCode)!==-1;case"keydown":return c.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function WA(l){return l=l.detail,typeof l=="object"&&"data"in l?l.data:null}var Mr=!1;function zu(l,c){switch(l){case"compositionend":return WA(c);case"keypress":return c.which!==32?null:(ma=!0,Vr);case"textInput":return l=c.data,l===Vr&&ma?null:l;default:return null}}function VA(l,c){if(Mr)return l==="compositionend"||!Ku&&Tu(l,c)?(l=Bc(),Bg=Gg=Fi=null,Mr=!1,l):null;switch(l){case"paste":return null;case"keypress":if(!(c.ctrlKey||c.altKey||c.metaKey)||c.ctrlKey&&c.altKey){if(c.char&&1<c.char.length)return c.char;if(c.which)return String.fromCharCode(c.which)}return null;case"compositionend":return Eu&&c.locale!=="ko"?null:c.data;default:return null}}var GC={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function MA(l){var c=l&&l.nodeName&&l.nodeName.toLowerCase();return c==="input"?!!GC[l.type]:c==="textarea"}function ls(l,c,A,m){as?el?el.push(m):el=[m]:as=m,c=dm(c,"onChange"),0<c.length&&(A=new za("onChange","change",null,A,m),l.push({event:A,listeners:c}))}var Zc=null,Sg=null;function hp(l){CS(l,0)}function Lu(l){var c=jo(l);if(un(c))return l}function BC(l,c){if(l==="change")return c}var vC=!1;if(Ta){var ZC;if(Ta){var Sc="oninput"in document;if(!Sc){var Rc=document.createElement("div");Rc.setAttribute("oninput","return;"),Sc=typeof Rc.oninput=="function"}ZC=Sc}else ZC=!1;vC=ZC&&(!document.documentMode||9<document.documentMode)}function fi(){Zc&&(Zc.detachEvent("onpropertychange",fp),Sg=Zc=null)}function fp(l){if(l.propertyName==="value"&&Lu(Sg)){var c=[];ls(c,Sg,l,Mo(l)),yg(hp,c)}}function iG(l,c,A){l==="focusin"?(fi(),Zc=c,Sg=A,Zc.attachEvent("onpropertychange",fp)):l==="focusout"&&fi()}function pp(l){if(l==="selectionchange"||l==="keyup"||l==="keydown")return Lu(Sg)}function _u(l,c){if(l==="click")return Lu(c)}function Hr(l,c){if(l==="input"||l==="change")return Lu(c)}function mp(l,c){return l===c&&(l!==0||1/l===1/c)||l!==l&&c!==c}var rs=typeof Object.is=="function"?Object.is:mp;function Ho(l,c){if(rs(l,c))return!0;if(typeof l!="object"||l===null||typeof c!="object"||c===null)return!1;var A=Object.keys(l),m=Object.keys(c);if(A.length!==m.length)return!1;for(m=0;m<A.length;m++){var Z=A[m];if(!Te.call(c,Z)||!rs(l[Z],c[Z]))return!1}return!0}function gs(l){for(;l&&l.firstChild;)l=l.firstChild;return l}function HA(l,c){var A=gs(l);l=0;for(var m;A;){if(A.nodeType===3){if(m=l+A.textContent.length,l<=c&&m>=c)return{node:A,offset:c-l};l=m}e:{for(;A;){if(A.nextSibling){A=A.nextSibling;break e}A=A.parentNode}A=void 0}A=gs(A)}}function XA(l,c){return l&&c?l===c?!0:l&&l.nodeType===3?!1:c&&c.nodeType===3?XA(l,c.parentNode):"contains"in l?l.contains(c):l.compareDocumentPosition?!!(l.compareDocumentPosition(c)&16):!1:!1}function NA(l){l=l!=null&&l.ownerDocument!=null&&l.ownerDocument.defaultView!=null?l.ownerDocument.defaultView:window;for(var c=Ni(l.document);c instanceof l.HTMLIFrameElement;){try{var A=typeof c.contentWindow.location.href=="string"}catch{A=!1}if(A)l=c.contentWindow;else break;c=Ni(l.document)}return c}function Uu(l){var c=l&&l.nodeName&&l.nodeName.toLowerCase();return c&&(c==="input"&&(l.type==="text"||l.type==="search"||l.type==="tel"||l.type==="url"||l.type==="password")||c==="textarea"||l.contentEditable==="true")}var YA=Ta&&"documentMode"in document&&11>=document.documentMode,_l=null,SC=null,Du=null,RC=!1;function KA(l,c,A){var m=A.window===A?A.document:A.nodeType===9?A:A.ownerDocument;RC||_l==null||_l!==Ni(m)||(m=_l,"selectionStart"in m&&Uu(m)?m={start:m.selectionStart,end:m.selectionEnd}:(m=(m.ownerDocument&&m.ownerDocument.defaultView||window).getSelection(),m={anchorNode:m.anchorNode,anchorOffset:m.anchorOffset,focusNode:m.focusNode,focusOffset:m.focusOffset}),Du&&Ho(Du,m)||(Du=m,m=dm(SC,"onSelect"),0<m.length&&(c=new za("onSelect","select",null,c,A),l.push({event:c,listeners:m}),c.target=_l)))}function ba(l,c){var A={};return A[l.toLowerCase()]=c.toLowerCase(),A["Webkit"+l]="webkit"+c,A["Moz"+l]="moz"+c,A}var Xr={animationend:ba("Animation","AnimationEnd"),animationiteration:ba("Animation","AnimationIteration"),animationstart:ba("Animation","AnimationStart"),transitionrun:ba("Transition","TransitionRun"),transitionstart:ba("Transition","TransitionStart"),transitioncancel:ba("Transition","TransitionCancel"),transitionend:ba("Transition","TransitionEnd")},wC={},bp={};Ta&&(bp=document.createElement("div").style,"AnimationEvent"in window||(delete Xr.animationend.animation,delete Xr.animationiteration.animation,delete Xr.animationstart.animation),"TransitionEvent"in window||delete Xr.transitionend.transition);function Ul(l){if(wC[l])return wC[l];if(!Xr[l])return l;var c=Xr[l],A;for(A in c)if(c.hasOwnProperty(A)&&A in bp)return wC[l]=c[A];return l}var La=Ul("animationend"),FA=Ul("animationiteration"),cs=Ul("animationstart"),yp=Ul("transitionrun"),Dl=Ul("transitionstart"),wc=Ul("transitioncancel"),kl=Ul("transitionend"),xC=new Map,ku="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");ku.push("scrollEnd");function ua(l,c){xC.set(l,c),ts(c,[l])}var EA=new WeakMap;function ya(l,c){if(typeof l=="object"&&l!==null){var A=EA.get(l);return A!==void 0?A:(c={value:l,source:c,stack:Tn(c)},EA.set(l,c),c)}return{value:l,source:c,stack:Tn(c)}}var Va=[],oo=0,WC=0;function Ou(){for(var l=oo,c=WC=oo=0;c<l;){var A=Va[c];Va[c++]=null;var m=Va[c];Va[c++]=null;var Z=Va[c];Va[c++]=null;var W=Va[c];if(Va[c++]=null,m!==null&&Z!==null){var _=m.pending;_===null?Z.next=Z:(Z.next=_.next,_.next=Z),m.pending=Z}W!==0&&TA(A,Z,W)}}function Nr(l,c,A,m){Va[oo++]=l,Va[oo++]=c,Va[oo++]=A,Va[oo++]=m,WC|=m,l.lanes|=m,l=l.alternate,l!==null&&(l.lanes|=m)}function VC(l,c,A,m){return Nr(l,c,A,m),xc(l)}function Ol(l,c){return Nr(l,null,null,c),xc(l)}function TA(l,c,A){l.lanes|=A;var m=l.alternate;m!==null&&(m.lanes|=A);for(var Z=!1,W=l.return;W!==null;)W.childLanes|=A,m=W.alternate,m!==null&&(m.childLanes|=A),W.tag===22&&(l=W.stateNode,l===null||l._visibility&1||(Z=!0)),l=W,W=W.return;return l.tag===3?(W=l.stateNode,Z&&c!==null&&(Z=31-et(A),l=W.hiddenUpdates,m=l[Z],m===null?l[Z]=[c]:m.push(c),c.lane=A|536870912),W):null}function xc(l){if(50<dl)throw dl=0,Ug=null,Error(n(185));for(var c=l.return;c!==null;)l=c,c=l.return;return l.tag===3?l.stateNode:null}var Yr={};function zA(l,c,A,m){this.tag=l,this.key=A,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=c,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=m,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function us(l,c,A,m){return new zA(l,c,A,m)}function Ju(l){return l=l.prototype,!(!l||!l.isReactComponent)}function Ti(l,c){var A=l.alternate;return A===null?(A=us(l.tag,c,l.key,l.mode),A.elementType=l.elementType,A.type=l.type,A.stateNode=l.stateNode,A.alternate=l,l.alternate=A):(A.pendingProps=c,A.type=l.type,A.flags=0,A.subtreeFlags=0,A.deletions=null),A.flags=l.flags&65011712,A.childLanes=l.childLanes,A.lanes=l.lanes,A.child=l.child,A.memoizedProps=l.memoizedProps,A.memoizedState=l.memoizedState,A.updateQueue=l.updateQueue,c=l.dependencies,A.dependencies=c===null?null:{lanes:c.lanes,firstContext:c.firstContext},A.sibling=l.sibling,A.index=l.index,A.ref=l.ref,A.refCleanup=l.refCleanup,A}function LA(l,c){l.flags&=65011714;var A=l.alternate;return A===null?(l.childLanes=0,l.lanes=c,l.child=null,l.subtreeFlags=0,l.memoizedProps=null,l.memoizedState=null,l.updateQueue=null,l.dependencies=null,l.stateNode=null):(l.childLanes=A.childLanes,l.lanes=A.lanes,l.child=A.child,l.subtreeFlags=0,l.deletions=null,l.memoizedProps=A.memoizedProps,l.memoizedState=A.memoizedState,l.updateQueue=A.updateQueue,l.type=A.type,c=A.dependencies,l.dependencies=c===null?null:{lanes:c.lanes,firstContext:c.firstContext}),l}function Ia(l,c,A,m,Z,W){var _=0;if(m=l,typeof l=="function")Ju(l)&&(_=1);else if(typeof l=="string")_=R9(l,A,j.current)?26:l==="html"||l==="head"||l==="body"?27:5;else e:switch(l){case Y:return l=us(31,A,c,Z),l.elementType=Y,l.lanes=W,l;case y:return Kr(A.children,Z,W,c);case v:_=8,Z|=24;break;case G:return l=us(12,A,c,Z|2),l.elementType=G,l.lanes=W,l;case M:return l=us(13,A,c,Z),l.elementType=M,l.lanes=W,l;case H:return l=us(19,A,c,Z),l.elementType=H,l.lanes=W,l;default:if(typeof l=="object"&&l!==null)switch(l.$$typeof){case B:case x:_=10;break e;case R:_=9;break e;case w:_=11;break e;case N:_=14;break e;case F:_=16,m=null;break e}_=29,A=Error(n(130,l===null?"null":typeof l,"")),m=null}return c=us(_,A,c,Z),c.elementType=l,c.type=m,c.lanes=W,c}function Kr(l,c,A,m){return l=us(7,l,m,c),l.lanes=A,l}function Pu(l,c,A){return l=us(6,l,null,c),l.lanes=A,l}function MC(l,c,A){return c=us(4,l.children!==null?l.children:[],l.key,c),c.lanes=A,c.stateNode={containerInfo:l.containerInfo,pendingChildren:null,implementation:l.implementation},c}var Wc=[],Is=0,Qu=null,Vc=0,Ga=[],xs=0,Fr=null,tl=1,nl="";function Jl(l,c){Wc[Is++]=Vc,Wc[Is++]=Qu,Qu=l,Vc=c}function HC(l,c,A){Ga[xs++]=tl,Ga[xs++]=nl,Ga[xs++]=Fr,Fr=l;var m=tl;l=nl;var Z=32-et(m)-1;m&=~(1<<Z),A+=1;var W=32-et(c)+Z;if(30<W){var _=Z-Z%5;W=(m&(1<<_)-1).toString(32),m>>=_,Z-=_,tl=1<<32-et(c)+Z|A<<Z|m,nl=W+l}else tl=1<<W|A<<Z|m,nl=l}function _A(l){l.return!==null&&(Jl(l,1),HC(l,1,0))}function UA(l){for(;l===Qu;)Qu=Wc[--Is],Wc[Is]=null,Vc=Wc[--Is],Wc[Is]=null;for(;l===Fr;)Fr=Ga[--xs],Ga[xs]=null,nl=Ga[--xs],Ga[xs]=null,tl=Ga[--xs],Ga[xs]=null}var _a=null,yi=null,Xn=!1,lo=null,Ws=!1,XC=Error(n(519));function Er(l){var c=Error(n(418,""));throw Rg(ya(c,l)),XC}function Gp(l){var c=l.stateNode,A=l.type,m=l.memoizedProps;switch(c[Cn]=l,c[Kn]=m,A){case"dialog":Sn("cancel",c),Sn("close",c);break;case"iframe":case"object":case"embed":Sn("load",c);break;case"video":case"audio":for(A=0;A<yh.length;A++)Sn(yh[A],c);break;case"source":Sn("error",c);break;case"img":case"image":case"link":Sn("error",c),Sn("load",c);break;case"details":Sn("toggle",c);break;case"input":Sn("invalid",c),zn(c,m.value,m.defaultValue,m.checked,m.defaultChecked,m.type,m.name,!0),Pn(c);break;case"select":Sn("invalid",c);break;case"textarea":Sn("invalid",c),bi(c,m.value,m.defaultValue,m.children),Pn(c)}A=m.children,typeof A!="string"&&typeof A!="number"&&typeof A!="bigint"||c.textContent===""+A||m.suppressHydrationWarning===!0||fS(c.textContent,A)?(m.popover!=null&&(Sn("beforetoggle",c),Sn("toggle",c)),m.onScroll!=null&&Sn("scroll",c),m.onScrollEnd!=null&&Sn("scrollend",c),m.onClick!=null&&(c.onclick=Am),c=!0):c=!1,c||Er(l)}function DA(l){for(_a=l.return;_a;)switch(_a.tag){case 5:case 13:Ws=!1;return;case 27:case 3:Ws=!0;return;default:_a=_a.return}}function Xo(l){if(l!==_a)return!1;if(!Xn)return DA(l),Xn=!0,!1;var c=l.tag,A;if((A=c!==3&&c!==27)&&((A=c===5)&&(A=l.type,A=!(A!=="form"&&A!=="button")||BG(l.type,l.memoizedProps)),A=!A),A&&yi&&Er(l),DA(l),c===13){if(l=l.memoizedState,l=l!==null?l.dehydrated:null,!l)throw Error(n(317));e:{for(l=l.nextSibling,c=0;l;){if(l.nodeType===8)if(A=l.data,A==="/$"){if(c===0){yi=rr(l.nextSibling);break e}c--}else A!=="$"&&A!=="$!"&&A!=="$?"||c++;l=l.nextSibling}yi=null}}else c===27?(c=yi,nu(l.type)?(l=RG,RG=null,yi=l):yi=c):yi=_a?rr(l.stateNode.nextSibling):null;return!0}function Mc(){yi=_a=null,Xn=!1}function Ln(){var l=lo;return l!==null&&(Ut===null?Ut=l:Ut.push.apply(Ut,l),lo=null),l}function Rg(l){lo===null?lo=[l]:lo.push(l)}var kA=D(null),Tr=null,Pl=null;function zr(l,c,A){oe(kA,c._currentValue),c._currentValue=A}function Ql(l){l._currentValue=kA.current,ne(kA)}function OA(l,c,A){for(;l!==null;){var m=l.alternate;if((l.childLanes&c)!==c?(l.childLanes|=c,m!==null&&(m.childLanes|=c)):m!==null&&(m.childLanes&c)!==c&&(m.childLanes|=c),l===A)break;l=l.return}}function ju(l,c,A,m){var Z=l.child;for(Z!==null&&(Z.return=l);Z!==null;){var W=Z.dependencies;if(W!==null){var _=Z.child;W=W.firstContext;e:for(;W!==null;){var ee=W;W=Z;for(var Ae=0;Ae<c.length;Ae++)if(ee.context===c[Ae]){W.lanes|=A,ee=W.alternate,ee!==null&&(ee.lanes|=A),OA(W.return,A,l),m||(_=null);break e}W=ee.next}}else if(Z.tag===18){if(_=Z.return,_===null)throw Error(n(341));_.lanes|=A,W=_.alternate,W!==null&&(W.lanes|=A),OA(_,A,l),_=null}else _=Z.child;if(_!==null)_.return=Z;else for(_=Z;_!==null;){if(_===l){_=null;break}if(Z=_.sibling,Z!==null){Z.return=_.return,_=Z;break}_=_.return}Z=_}}function ro(l,c,A,m){l=null;for(var Z=c,W=!1;Z!==null;){if(!W){if((Z.flags&524288)!==0)W=!0;else if((Z.flags&262144)!==0)break}if(Z.tag===10){var _=Z.alternate;if(_===null)throw Error(n(387));if(_=_.memoizedProps,_!==null){var ee=Z.type;rs(Z.pendingProps.value,_.value)||(l!==null?l.push(ee):l=[ee])}}else if(Z===me.current){if(_=Z.alternate,_===null)throw Error(n(387));_.memoizedState.memoizedState!==Z.memoizedState.memoizedState&&(l!==null?l.push(Rh):l=[Rh])}Z=Z.return}l!==null&&ju(c,l,A,m),c.flags|=262144}function qu(l){for(l=l.firstContext;l!==null;){if(!rs(l.context._currentValue,l.memoizedValue))return!0;l=l.next}return!1}function il(l){Tr=l,Pl=null,l=l.dependencies,l!==null&&(l.firstContext=null)}function wi(l){return NC(Tr,l)}function $u(l,c){return Tr===null&&il(l),NC(l,c)}function NC(l,c){var A=c._currentValue;if(c={context:c,memoizedValue:A,next:null},Pl===null){if(l===null)throw Error(n(308));Pl=c,l.dependencies={lanes:0,firstContext:c},l.flags|=524288}else Pl=Pl.next=c;return A}var JA=typeof AbortController<"u"?AbortController:function(){var l=[],c=this.signal={aborted:!1,addEventListener:function(A,m){l.push(m)}};this.abort=function(){c.aborted=!0,l.forEach(function(A){return A()})}},aG=a.unstable_scheduleCallback,Bp=a.unstable_NormalPriority,ji={$$typeof:x,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function YC(){return{controller:new JA,data:new Map,refCount:0}}function Hc(l){l.refCount--,l.refCount===0&&aG(Bp,function(){l.controller.abort()})}var Xc=null,eI=0,an=0,Nc=null;function Vs(l,c){if(Xc===null){var A=Xc=[];eI=0,an=dG(),Nc={status:"pending",value:void 0,then:function(m){A.push(m)}}}return eI++,c.then(KC,KC),c}function KC(){if(--eI===0&&Xc!==null){Nc!==null&&(Nc.status="fulfilled");var l=Xc;Xc=null,an=0,Nc=null;for(var c=0;c<l.length;c++)(0,l[c])()}}function sG(l,c){var A=[],m={status:"pending",value:null,reason:null,then:function(Z){A.push(Z)}};return l.then(function(){m.status="fulfilled",m.value=c;for(var Z=0;Z<A.length;Z++)(0,A[Z])(c)},function(Z){for(m.status="rejected",m.reason=Z,Z=0;Z<A.length;Z++)(0,A[Z])(void 0)}),m}var tI=T.S;T.S=function(l,c){typeof c=="object"&&c!==null&&typeof c.then=="function"&&Vs(l,c),tI!==null&&tI(l,c)};var go=D(null);function Lr(){var l=go.current;return l!==null?l:tn.pooledCache}function nI(l,c){c===null?oe(go,go.current):oe(go,c.pool)}function FC(){var l=Lr();return l===null?null:{parent:ji._currentValue,pool:l}}var iI=Error(n(460)),PA=Error(n(474)),No=Error(n(542)),aI={then:function(){}};function EC(l){return l=l.status,l==="fulfilled"||l==="rejected"}function Yc(){}function TC(l,c,A){switch(A=l[A],A===void 0?l.push(c):A!==c&&(c.then(Yc,Yc),c=A),c.status){case"fulfilled":return c.value;case"rejected":throw l=c.reason,vp(l),l;default:if(typeof c.status=="string")c.then(Yc,Yc);else{if(l=tn,l!==null&&100<l.shellSuspendCounter)throw Error(n(482));l=c,l.status="pending",l.then(function(m){if(c.status==="pending"){var Z=c;Z.status="fulfilled",Z.value=m}},function(m){if(c.status==="pending"){var Z=c;Z.status="rejected",Z.reason=m}})}switch(c.status){case"fulfilled":return c.value;case"rejected":throw l=c.reason,vp(l),l}throw co=c,iI}}var co=null;function QA(){if(co===null)throw Error(n(459));var l=co;return co=null,l}function vp(l){if(l===iI||l===No)throw Error(n(483))}var jl=!1;function jA(l){l.updateQueue={baseState:l.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function Pt(l,c){l=l.updateQueue,c.updateQueue===l&&(c.updateQueue={baseState:l.baseState,firstBaseUpdate:l.firstBaseUpdate,lastBaseUpdate:l.lastBaseUpdate,shared:l.shared,callbacks:null})}function al(l){return{lane:l,tag:0,payload:null,callback:null,next:null}}function ql(l,c,A){var m=l.updateQueue;if(m===null)return null;if(m=m.shared,(_n&2)!==0){var Z=m.pending;return Z===null?c.next=c:(c.next=Z.next,Z.next=c),m.pending=c,c=xc(l),TA(l,null,A),c}return Nr(l,m,c,A),xc(l)}function wg(l,c,A){if(c=c.updateQueue,c!==null&&(c=c.shared,(A&4194048)!==0)){var m=c.lanes;m&=l.pendingLanes,A|=m,c.lanes=A,ht(l,A)}}function Kc(l,c){var A=l.updateQueue,m=l.alternate;if(m!==null&&(m=m.updateQueue,A===m)){var Z=null,W=null;if(A=A.firstBaseUpdate,A!==null){do{var _={lane:A.lane,tag:A.tag,payload:A.payload,callback:null,next:null};W===null?Z=W=_:W=W.next=_,A=A.next}while(A!==null);W===null?Z=W=c:W=W.next=c}else Z=W=c;A={baseState:m.baseState,firstBaseUpdate:Z,lastBaseUpdate:W,shared:m.shared,callbacks:m.callbacks},l.updateQueue=A;return}l=A.lastBaseUpdate,l===null?A.firstBaseUpdate=c:l.next=c,A.lastBaseUpdate=c}var qA=!1;function sI(){if(qA){var l=Nc;if(l!==null)throw l}}function Fc(l,c,A,m){qA=!1;var Z=l.updateQueue;jl=!1;var W=Z.firstBaseUpdate,_=Z.lastBaseUpdate,ee=Z.shared.pending;if(ee!==null){Z.shared.pending=null;var Ae=ee,Fe=Ae.next;Ae.next=null,_===null?W=Fe:_.next=Fe,_=Ae;var ot=l.alternate;ot!==null&&(ot=ot.updateQueue,ee=ot.lastBaseUpdate,ee!==_&&(ee===null?ot.firstBaseUpdate=Fe:ee.next=Fe,ot.lastBaseUpdate=Ae))}if(W!==null){var It=Z.baseState;_=0,ot=Fe=Ae=null,ee=W;do{var Ue=ee.lane&-536870913,Oe=Ue!==ee.lane;if(Oe?(Lt&Ue)===Ue:(m&Ue)===Ue){Ue!==0&&Ue===an&&(qA=!0),ot!==null&&(ot=ot.next={lane:0,tag:ee.tag,payload:ee.payload,callback:null,next:null});e:{var qt=l,Ot=ee;Ue=c;var oi=A;switch(Ot.tag){case 1:if(qt=Ot.payload,typeof qt=="function"){It=qt.call(oi,It,Ue);break e}It=qt;break e;case 3:qt.flags=qt.flags&-65537|128;case 0:if(qt=Ot.payload,Ue=typeof qt=="function"?qt.call(oi,It,Ue):qt,Ue==null)break e;It=C({},It,Ue);break e;case 2:jl=!0}}Ue=ee.callback,Ue!==null&&(l.flags|=64,Oe&&(l.flags|=8192),Oe=Z.callbacks,Oe===null?Z.callbacks=[Ue]:Oe.push(Ue))}else Oe={lane:Ue,tag:ee.tag,payload:ee.payload,callback:ee.callback,next:null},ot===null?(Fe=ot=Oe,Ae=It):ot=ot.next=Oe,_|=Ue;if(ee=ee.next,ee===null){if(ee=Z.shared.pending,ee===null)break;Oe=ee,ee=Oe.next,Oe.next=null,Z.lastBaseUpdate=Oe,Z.shared.pending=null}}while(!0);ot===null&&(Ae=It),Z.baseState=Ae,Z.firstBaseUpdate=Fe,Z.lastBaseUpdate=ot,W===null&&(Z.shared.lanes=0),_o|=_,l.lanes=_,l.memoizedState=It}}function Ec(l,c){if(typeof l!="function")throw Error(n(191,l));l.call(c)}function Zp(l,c){var A=l.callbacks;if(A!==null)for(l.callbacks=null,l=0;l<A.length;l++)Ec(A[l],c)}var Tc=D(null),zC=D(0);function Sp(l,c){l=fo,oe(zC,l),oe(Tc,c),fo=l|c.baseLanes}function $A(){oe(zC,fo),oe(Tc,Tc.current)}function oI(){fo=zC.current,ne(Tc),ne(zC)}var $l=0,sn=null,kn=null,qi=null,LC=!1,_r=!1,Ua=!1,sa=0,uo=0,Ba=null,Rp=0;function zi(){throw Error(n(321))}function Ma(l,c){if(c===null)return!1;for(var A=0;A<c.length&&A<l.length;A++)if(!rs(l[A],c[A]))return!1;return!0}function er(l,c,A,m,Z,W){return $l=W,sn=c,c.memoizedState=null,c.updateQueue=null,c.lanes=0,T.H=l===null||l.memoizedState===null?jC:Ah,Ua=!1,W=A(m,Z),Ua=!1,_r&&(W=xp(c,A,m,Z)),wp(l),W}function wp(l){T.H=gI;var c=kn!==null&&kn.next!==null;if($l=0,qi=kn=sn=null,LC=!1,uo=0,Ba=null,c)throw Error(n(300));l===null||Ca||(l=l.dependencies,l!==null&&qu(l)&&(Ca=!0))}function xp(l,c,A,m){sn=l;var Z=0;do{if(_r&&(Ba=null),uo=0,_r=!1,25<=Z)throw Error(n(301));if(Z+=1,qi=kn=null,l.updateQueue!=null){var W=l.updateQueue;W.lastEffect=null,W.events=null,W.stores=null,W.memoCache!=null&&(W.memoCache.index=0)}T.H=tm,W=c(A,m)}while(_r);return W}function oG(){var l=T.H,c=l.useState()[0];return c=typeof c.then=="function"?Yo(c):c,l=l.useState()[0],(kn!==null?kn.memoizedState:null)!==l&&(sn.flags|=1024),c}function eh(){var l=sa!==0;return sa=0,l}function _C(l,c,A){c.updateQueue=l.updateQueue,c.flags&=-2053,l.lanes&=~A}function th(l){if(LC){for(l=l.memoizedState;l!==null;){var c=l.queue;c!==null&&(c.pending=null),l=l.next}LC=!1}$l=0,qi=kn=sn=null,_r=!1,uo=sa=0,Ba=null}function Da(){var l={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return qi===null?sn.memoizedState=qi=l:qi=qi.next=l,qi}function $i(){if(kn===null){var l=sn.alternate;l=l!==null?l.memoizedState:null}else l=kn.next;var c=qi===null?sn.memoizedState:qi.next;if(c!==null)qi=c,kn=l;else{if(l===null)throw sn.alternate===null?Error(n(467)):Error(n(310));kn=l,l={memoizedState:kn.memoizedState,baseState:kn.baseState,baseQueue:kn.baseQueue,queue:kn.queue,next:null},qi===null?sn.memoizedState=qi=l:qi=qi.next=l}return qi}function Ur(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function Yo(l){var c=uo;return uo+=1,Ba===null&&(Ba=[]),l=TC(Ba,l,c),c=sn,(qi===null?c.memoizedState:qi.next)===null&&(c=c.alternate,T.H=c===null||c.memoizedState===null?jC:Ah),l}function UC(l){if(l!==null&&typeof l=="object"){if(typeof l.then=="function")return Yo(l);if(l.$$typeof===x)return wi(l)}throw Error(n(438,String(l)))}function nh(l){var c=null,A=sn.updateQueue;if(A!==null&&(c=A.memoCache),c==null){var m=sn.alternate;m!==null&&(m=m.updateQueue,m!==null&&(m=m.memoCache,m!=null&&(c={data:m.data.map(function(Z){return Z.slice()}),index:0})))}if(c==null&&(c={data:[],index:0}),A===null&&(A=Ur(),sn.updateQueue=A),A.memoCache=c,A=c.data[c.index],A===void 0)for(A=c.data[c.index]=Array(l),m=0;m<l;m++)A[m]=X;return c.index++,A}function tr(l,c){return typeof c=="function"?c(l):c}function Dr(l){var c=$i();return ih(c,kn,l)}function ih(l,c,A){var m=l.queue;if(m===null)throw Error(n(311));m.lastRenderedReducer=A;var Z=l.baseQueue,W=m.pending;if(W!==null){if(Z!==null){var _=Z.next;Z.next=W.next,W.next=_}c.baseQueue=Z=W,m.pending=null}if(W=l.baseState,Z===null)l.memoizedState=W;else{c=Z.next;var ee=_=null,Ae=null,Fe=c,ot=!1;do{var It=Fe.lane&-536870913;if(It!==Fe.lane?(Lt&It)===It:($l&It)===It){var Ue=Fe.revertLane;if(Ue===0)Ae!==null&&(Ae=Ae.next={lane:0,revertLane:0,action:Fe.action,hasEagerState:Fe.hasEagerState,eagerState:Fe.eagerState,next:null}),It===an&&(ot=!0);else if(($l&Ue)===Ue){Fe=Fe.next,Ue===an&&(ot=!0);continue}else It={lane:0,revertLane:Fe.revertLane,action:Fe.action,hasEagerState:Fe.hasEagerState,eagerState:Fe.eagerState,next:null},Ae===null?(ee=Ae=It,_=W):Ae=Ae.next=It,sn.lanes|=Ue,_o|=Ue;It=Fe.action,Ua&&A(W,It),W=Fe.hasEagerState?Fe.eagerState:A(W,It)}else Ue={lane:It,revertLane:Fe.revertLane,action:Fe.action,hasEagerState:Fe.hasEagerState,eagerState:Fe.eagerState,next:null},Ae===null?(ee=Ae=Ue,_=W):Ae=Ae.next=Ue,sn.lanes|=It,_o|=It;Fe=Fe.next}while(Fe!==null&&Fe!==c);if(Ae===null?_=W:Ae.next=ee,!rs(W,l.memoizedState)&&(Ca=!0,ot&&(A=Nc,A!==null)))throw A;l.memoizedState=W,l.baseState=_,l.baseQueue=Ae,m.lastRenderedState=W}return Z===null&&(m.lanes=0),[l.memoizedState,m.dispatch]}function ah(l){var c=$i(),A=c.queue;if(A===null)throw Error(n(311));A.lastRenderedReducer=l;var m=A.dispatch,Z=A.pending,W=c.memoizedState;if(Z!==null){A.pending=null;var _=Z=Z.next;do W=l(W,_.action),_=_.next;while(_!==Z);rs(W,c.memoizedState)||(Ca=!0),c.memoizedState=W,c.baseQueue===null&&(c.baseState=W),A.lastRenderedState=W}return[W,m]}function Wp(l,c,A){var m=sn,Z=$i(),W=Xn;if(W){if(A===void 0)throw Error(n(407));A=A()}else A=c();var _=!rs((kn||Z).memoizedState,A);_&&(Z.memoizedState=A,Ca=!0),Z=Z.queue;var ee=Mp.bind(null,m,Z,l);if(_c(2048,8,ee,[l]),Z.getSnapshot!==c||_||qi!==null&&qi.memoizedState.tag&1){if(m.flags|=2048,Lc(9,lI(),Vp.bind(null,m,Z,A,c),null),tn===null)throw Error(n(349));W||($l&124)!==0||zc(m,c,A)}return A}function zc(l,c,A){l.flags|=16384,l={getSnapshot:c,value:A},c=sn.updateQueue,c===null?(c=Ur(),sn.updateQueue=c,c.stores=[l]):(A=c.stores,A===null?c.stores=[l]:A.push(l))}function Vp(l,c,A,m){c.value=A,c.getSnapshot=m,Hp(c)&&Xp(l)}function Mp(l,c,A){return A(function(){Hp(c)&&Xp(l)})}function Hp(l){var c=l.getSnapshot;l=l.value;try{var A=c();return!rs(l,A)}catch{return!0}}function Xp(l){var c=Ol(l,2);c!==null&&Ja(c,l,2)}function sh(l){var c=Da();if(typeof l=="function"){var A=l;if(l=A(),Ua){we(!0);try{A()}finally{we(!1)}}}return c.memoizedState=c.baseState=l,c.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:tr,lastRenderedState:l},c}function Np(l,c,A,m){return l.baseState=A,ih(l,kn,typeof m=="function"?m:tr)}function lG(l,c,A,m,Z){if(QC(l))throw Error(n(485));if(l=c.action,l!==null){var W={payload:Z,action:l,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(_){W.listeners.push(_)}};T.T!==null?A(!0):W.isTransition=!1,m(W),A=c.pending,A===null?(W.next=c.pending=W,Yp(c,W)):(W.next=A.next,c.pending=A.next=W)}}function Yp(l,c){var A=c.action,m=c.payload,Z=l.state;if(c.isTransition){var W=T.T,_={};T.T=_;try{var ee=A(Z,m),Ae=T.S;Ae!==null&&Ae(_,ee),Kp(l,c,ee)}catch(Fe){oh(l,c,Fe)}finally{T.T=W}}else try{W=A(Z,m),Kp(l,c,W)}catch(Fe){oh(l,c,Fe)}}function Kp(l,c,A){A!==null&&typeof A=="object"&&typeof A.then=="function"?A.then(function(m){Fp(l,c,m)},function(m){return oh(l,c,m)}):Fp(l,c,A)}function Fp(l,c,A){c.status="fulfilled",c.value=A,Ep(c),l.state=A,c=l.pending,c!==null&&(A=c.next,A===c?l.pending=null:(A=A.next,c.next=A,Yp(l,A)))}function oh(l,c,A){var m=l.pending;if(l.pending=null,m!==null){m=m.next;do c.status="rejected",c.reason=A,Ep(c),c=c.next;while(c!==m)}l.action=null}function Ep(l){l=l.listeners;for(var c=0;c<l.length;c++)(0,l[c])()}function lh(l,c){return c}function Tp(l,c){if(Xn){var A=tn.formState;if(A!==null){e:{var m=sn;if(Xn){if(yi){t:{for(var Z=yi,W=Ws;Z.nodeType!==8;){if(!W){Z=null;break t}if(Z=rr(Z.nextSibling),Z===null){Z=null;break t}}W=Z.data,Z=W==="F!"||W==="F"?Z:null}if(Z){yi=rr(Z.nextSibling),m=Z.data==="F!";break e}}Er(m)}m=!1}m&&(c=A[0])}}return A=Da(),A.memoizedState=A.baseState=c,m={pending:null,lanes:0,dispatch:null,lastRenderedReducer:lh,lastRenderedState:c},A.queue=m,A=$p.bind(null,sn,m),m.dispatch=A,m=sh(!1),W=PC.bind(null,sn,!1,m.queue),m=Da(),Z={state:c,dispatch:null,action:l,pending:null},m.queue=Z,A=lG.bind(null,sn,Z,W,A),Z.dispatch=A,m.memoizedState=l,[c,A,!1]}function zp(l){var c=$i();return Lp(c,kn,l)}function Lp(l,c,A){if(c=ih(l,c,lh)[0],l=Dr(tr)[0],typeof c=="object"&&c!==null&&typeof c.then=="function")try{var m=Yo(c)}catch(_){throw _===iI?No:_}else m=c;c=$i();var Z=c.queue,W=Z.dispatch;return A!==c.memoizedState&&(sn.flags|=2048,Lc(9,lI(),rG.bind(null,Z,A),null)),[m,W,l]}function rG(l,c){l.action=c}function _p(l){var c=$i(),A=kn;if(A!==null)return Lp(c,A,l);$i(),c=c.memoizedState,A=$i();var m=A.queue.dispatch;return A.memoizedState=l,[c,m,!1]}function Lc(l,c,A,m){return l={tag:l,create:A,deps:m,inst:c,next:null},c=sn.updateQueue,c===null&&(c=Ur(),sn.updateQueue=c),A=c.lastEffect,A===null?c.lastEffect=l.next=l:(m=A.next,A.next=l,l.next=m,c.lastEffect=l),l}function lI(){return{destroy:void 0,resource:void 0}}function rh(){return $i().memoizedState}function DC(l,c,A,m){var Z=Da();m=m===void 0?null:m,sn.flags|=l,Z.memoizedState=Lc(1|c,lI(),A,m)}function _c(l,c,A,m){var Z=$i();m=m===void 0?null:m;var W=Z.memoizedState.inst;kn!==null&&m!==null&&Ma(m,kn.memoizedState.deps)?Z.memoizedState=Lc(c,W,A,m):(sn.flags|=l,Z.memoizedState=Lc(1|c,W,A,m))}function gh(l,c){DC(8390656,8,l,c)}function ch(l,c){_c(2048,8,l,c)}function kC(l,c){return _c(4,2,l,c)}function OC(l,c){return _c(4,4,l,c)}function Up(l,c){if(typeof c=="function"){l=l();var A=c(l);return function(){typeof A=="function"?A():c(null)}}if(c!=null)return l=l(),c.current=l,function(){c.current=null}}function Dp(l,c,A){A=A!=null?A.concat([l]):null,_c(4,4,Up.bind(null,c,l),A)}function uh(){}function kp(l,c){var A=$i();c=c===void 0?null:c;var m=A.memoizedState;return c!==null&&Ma(c,m[1])?m[0]:(A.memoizedState=[l,c],l)}function Ih(l,c){var A=$i();c=c===void 0?null:c;var m=A.memoizedState;if(c!==null&&Ma(c,m[1]))return m[0];if(m=l(),Ua){we(!0);try{l()}finally{we(!1)}}return A.memoizedState=[m,c],m}function JC(l,c,A){return A===void 0||($l&1073741824)!==0?l.memoizedState=c:(l.memoizedState=A,l=rd(),sn.lanes|=l,_o|=l,A)}function Op(l,c,A,m){return rs(A,c)?A:Tc.current!==null?(l=JC(l,A,m),rs(l,c)||(Ca=!0),l):($l&42)===0?(Ca=!0,l.memoizedState=A):(l=rd(),sn.lanes|=l,_o|=l,c)}function Jp(l,c,A,m,Z){var W=J.p;J.p=W!==0&&8>W?W:8;var _=T.T,ee={};T.T=ee,PC(l,!1,c,A);try{var Ae=Z(),Fe=T.S;if(Fe!==null&&Fe(ee,Ae),Ae!==null&&typeof Ae=="object"&&typeof Ae.then=="function"){var ot=sG(Ae,m);rI(l,c,ot,Vi(l))}else rI(l,c,m,Vi(l))}catch(It){rI(l,c,{then:function(){},status:"rejected",reason:It},Vi())}finally{J.p=W,T.T=_}}function gG(){}function Ch(l,c,A,m){if(l.tag!==5)throw Error(n(476));var Z=Pp(l).queue;Jp(l,Z,c,Q,A===null?gG:function(){return Qp(l),A(m)})}function Pp(l){var c=l.memoizedState;if(c!==null)return c;c={memoizedState:Q,baseState:Q,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:tr,lastRenderedState:Q},next:null};var A={};return c.next={memoizedState:A,baseState:A,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:tr,lastRenderedState:A},next:null},l.memoizedState=c,l=l.alternate,l!==null&&(l.memoizedState=c),c}function Qp(l){var c=Pp(l).next.queue;rI(l,c,{},Vi())}function dh(){return wi(Rh)}function jp(){return $i().memoizedState}function qp(){return $i().memoizedState}function cG(l){for(var c=l.return;c!==null;){switch(c.tag){case 24:case 3:var A=Vi();l=al(A);var m=ql(c,l,A);m!==null&&(Ja(m,c,A),wg(m,c,A)),c={cache:YC()},l.payload=c;return}c=c.return}}function uG(l,c,A){var m=Vi();A={lane:m,revertLane:0,action:A,hasEagerState:!1,eagerState:null,next:null},QC(l)?em(c,A):(A=VC(l,c,A,m),A!==null&&(Ja(A,l,m),Ms(A,c,m)))}function $p(l,c,A){var m=Vi();rI(l,c,A,m)}function rI(l,c,A,m){var Z={lane:m,revertLane:0,action:A,hasEagerState:!1,eagerState:null,next:null};if(QC(l))em(c,Z);else{var W=l.alternate;if(l.lanes===0&&(W===null||W.lanes===0)&&(W=c.lastRenderedReducer,W!==null))try{var _=c.lastRenderedState,ee=W(_,A);if(Z.hasEagerState=!0,Z.eagerState=ee,rs(ee,_))return Nr(l,c,Z,0),tn===null&&Ou(),!1}catch{}finally{}if(A=VC(l,c,Z,m),A!==null)return Ja(A,l,m),Ms(A,c,m),!0}return!1}function PC(l,c,A,m){if(m={lane:2,revertLane:dG(),action:m,hasEagerState:!1,eagerState:null,next:null},QC(l)){if(c)throw Error(n(479))}else c=VC(l,A,m,2),c!==null&&Ja(c,l,2)}function QC(l){var c=l.alternate;return l===sn||c!==null&&c===sn}function em(l,c){_r=LC=!0;var A=l.pending;A===null?c.next=c:(c.next=A.next,A.next=c),l.pending=c}function Ms(l,c,A){if((A&4194048)!==0){var m=c.lanes;m&=l.pendingLanes,A|=m,c.lanes=A,ht(l,A)}}var gI={readContext:wi,use:UC,useCallback:zi,useContext:zi,useEffect:zi,useImperativeHandle:zi,useLayoutEffect:zi,useInsertionEffect:zi,useMemo:zi,useReducer:zi,useRef:zi,useState:zi,useDebugValue:zi,useDeferredValue:zi,useTransition:zi,useSyncExternalStore:zi,useId:zi,useHostTransitionStatus:zi,useFormState:zi,useActionState:zi,useOptimistic:zi,useMemoCache:zi,useCacheRefresh:zi},jC={readContext:wi,use:UC,useCallback:function(l,c){return Da().memoizedState=[l,c===void 0?null:c],l},useContext:wi,useEffect:gh,useImperativeHandle:function(l,c,A){A=A!=null?A.concat([l]):null,DC(4194308,4,Up.bind(null,c,l),A)},useLayoutEffect:function(l,c){return DC(4194308,4,l,c)},useInsertionEffect:function(l,c){DC(4,2,l,c)},useMemo:function(l,c){var A=Da();c=c===void 0?null:c;var m=l();if(Ua){we(!0);try{l()}finally{we(!1)}}return A.memoizedState=[m,c],m},useReducer:function(l,c,A){var m=Da();if(A!==void 0){var Z=A(c);if(Ua){we(!0);try{A(c)}finally{we(!1)}}}else Z=c;return m.memoizedState=m.baseState=Z,l={pending:null,lanes:0,dispatch:null,lastRenderedReducer:l,lastRenderedState:Z},m.queue=l,l=l.dispatch=uG.bind(null,sn,l),[m.memoizedState,l]},useRef:function(l){var c=Da();return l={current:l},c.memoizedState=l},useState:function(l){l=sh(l);var c=l.queue,A=$p.bind(null,sn,c);return c.dispatch=A,[l.memoizedState,A]},useDebugValue:uh,useDeferredValue:function(l,c){var A=Da();return JC(A,l,c)},useTransition:function(){var l=sh(!1);return l=Jp.bind(null,sn,l.queue,!0,!1),Da().memoizedState=l,[!1,l]},useSyncExternalStore:function(l,c,A){var m=sn,Z=Da();if(Xn){if(A===void 0)throw Error(n(407));A=A()}else{if(A=c(),tn===null)throw Error(n(349));(Lt&124)!==0||zc(m,c,A)}Z.memoizedState=A;var W={value:A,getSnapshot:c};return Z.queue=W,gh(Mp.bind(null,m,W,l),[l]),m.flags|=2048,Lc(9,lI(),Vp.bind(null,m,W,A,c),null),A},useId:function(){var l=Da(),c=tn.identifierPrefix;if(Xn){var A=nl,m=tl;A=(m&~(1<<32-et(m)-1)).toString(32)+A,c=""+c+"R"+A,A=sa++,0<A&&(c+="H"+A.toString(32)),c+=""}else A=Rp++,c=""+c+"r"+A.toString(32)+"";return l.memoizedState=c},useHostTransitionStatus:dh,useFormState:Tp,useActionState:Tp,useOptimistic:function(l){var c=Da();c.memoizedState=c.baseState=l;var A={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return c.queue=A,c=PC.bind(null,sn,!0,A),A.dispatch=c,[l,c]},useMemoCache:nh,useCacheRefresh:function(){return Da().memoizedState=cG.bind(null,sn)}},Ah={readContext:wi,use:UC,useCallback:kp,useContext:wi,useEffect:ch,useImperativeHandle:Dp,useInsertionEffect:kC,useLayoutEffect:OC,useMemo:Ih,useReducer:Dr,useRef:rh,useState:function(){return Dr(tr)},useDebugValue:uh,useDeferredValue:function(l,c){var A=$i();return Op(A,kn.memoizedState,l,c)},useTransition:function(){var l=Dr(tr)[0],c=$i().memoizedState;return[typeof l=="boolean"?l:Yo(l),c]},useSyncExternalStore:Wp,useId:jp,useHostTransitionStatus:dh,useFormState:zp,useActionState:zp,useOptimistic:function(l,c){var A=$i();return Np(A,kn,l,c)},useMemoCache:nh,useCacheRefresh:qp},tm={readContext:wi,use:UC,useCallback:kp,useContext:wi,useEffect:ch,useImperativeHandle:Dp,useInsertionEffect:kC,useLayoutEffect:OC,useMemo:Ih,useReducer:ah,useRef:rh,useState:function(){return ah(tr)},useDebugValue:uh,useDeferredValue:function(l,c){var A=$i();return kn===null?JC(A,l,c):Op(A,kn.memoizedState,l,c)},useTransition:function(){var l=ah(tr)[0],c=$i().memoizedState;return[typeof l=="boolean"?l:Yo(l),c]},useSyncExternalStore:Wp,useId:jp,useHostTransitionStatus:dh,useFormState:_p,useActionState:_p,useOptimistic:function(l,c){var A=$i();return kn!==null?Np(A,kn,l,c):(A.baseState=l,[l,A.queue.dispatch])},useMemoCache:nh,useCacheRefresh:qp},xg=null,cI=0;function uI(l){var c=cI;return cI+=1,xg===null&&(xg=[]),TC(xg,l,c)}function Uc(l,c){c=c.props.ref,l.ref=c!==void 0?c:null}function qC(l,c){throw c.$$typeof===h?Error(n(525)):(l=Object.prototype.toString.call(c),Error(n(31,l==="[object Object]"?"object with keys {"+Object.keys(c).join(", ")+"}":l)))}function nm(l){var c=l._init;return c(l._payload)}function im(l){function c(He,Re){if(l){var Ye=He.deletions;Ye===null?(He.deletions=[Re],He.flags|=16):Ye.push(Re)}}function A(He,Re){if(!l)return null;for(;Re!==null;)c(He,Re),Re=Re.sibling;return null}function m(He){for(var Re=new Map;He!==null;)He.key!==null?Re.set(He.key,He):Re.set(He.index,He),He=He.sibling;return Re}function Z(He,Re){return He=Ti(He,Re),He.index=0,He.sibling=null,He}function W(He,Re,Ye){return He.index=Ye,l?(Ye=He.alternate,Ye!==null?(Ye=Ye.index,Ye<Re?(He.flags|=67108866,Re):Ye):(He.flags|=67108866,Re)):(He.flags|=1048576,Re)}function _(He){return l&&He.alternate===null&&(He.flags|=67108866),He}function ee(He,Re,Ye,rt){return Re===null||Re.tag!==6?(Re=Pu(Ye,He.mode,rt),Re.return=He,Re):(Re=Z(Re,Ye),Re.return=He,Re)}function Ae(He,Re,Ye,rt){var Mt=Ye.type;return Mt===y?ot(He,Re,Ye.props.children,rt,Ye.key):Re!==null&&(Re.elementType===Mt||typeof Mt=="object"&&Mt!==null&&Mt.$$typeof===F&&nm(Mt)===Re.type)?(Re=Z(Re,Ye.props),Uc(Re,Ye),Re.return=He,Re):(Re=Ia(Ye.type,Ye.key,Ye.props,null,He.mode,rt),Uc(Re,Ye),Re.return=He,Re)}function Fe(He,Re,Ye,rt){return Re===null||Re.tag!==4||Re.stateNode.containerInfo!==Ye.containerInfo||Re.stateNode.implementation!==Ye.implementation?(Re=MC(Ye,He.mode,rt),Re.return=He,Re):(Re=Z(Re,Ye.children||[]),Re.return=He,Re)}function ot(He,Re,Ye,rt,Mt){return Re===null||Re.tag!==7?(Re=Kr(Ye,He.mode,rt,Mt),Re.return=He,Re):(Re=Z(Re,Ye),Re.return=He,Re)}function It(He,Re,Ye){if(typeof Re=="string"&&Re!==""||typeof Re=="number"||typeof Re=="bigint")return Re=Pu(""+Re,He.mode,Ye),Re.return=He,Re;if(typeof Re=="object"&&Re!==null){switch(Re.$$typeof){case f:return Ye=Ia(Re.type,Re.key,Re.props,null,He.mode,Ye),Uc(Ye,Re),Ye.return=He,Ye;case p:return Re=MC(Re,He.mode,Ye),Re.return=He,Re;case F:var rt=Re._init;return Re=rt(Re._payload),It(He,Re,Ye)}if(le(Re)||O(Re))return Re=Kr(Re,He.mode,Ye,null),Re.return=He,Re;if(typeof Re.then=="function")return It(He,uI(Re),Ye);if(Re.$$typeof===x)return It(He,$u(He,Re),Ye);qC(He,Re)}return null}function Ue(He,Re,Ye,rt){var Mt=Re!==null?Re.key:null;if(typeof Ye=="string"&&Ye!==""||typeof Ye=="number"||typeof Ye=="bigint")return Mt!==null?null:ee(He,Re,""+Ye,rt);if(typeof Ye=="object"&&Ye!==null){switch(Ye.$$typeof){case f:return Ye.key===Mt?Ae(He,Re,Ye,rt):null;case p:return Ye.key===Mt?Fe(He,Re,Ye,rt):null;case F:return Mt=Ye._init,Ye=Mt(Ye._payload),Ue(He,Re,Ye,rt)}if(le(Ye)||O(Ye))return Mt!==null?null:ot(He,Re,Ye,rt,null);if(typeof Ye.then=="function")return Ue(He,Re,uI(Ye),rt);if(Ye.$$typeof===x)return Ue(He,Re,$u(He,Ye),rt);qC(He,Ye)}return null}function Oe(He,Re,Ye,rt,Mt){if(typeof rt=="string"&&rt!==""||typeof rt=="number"||typeof rt=="bigint")return He=He.get(Ye)||null,ee(Re,He,""+rt,Mt);if(typeof rt=="object"&&rt!==null){switch(rt.$$typeof){case f:return He=He.get(rt.key===null?Ye:rt.key)||null,Ae(Re,He,rt,Mt);case p:return He=He.get(rt.key===null?Ye:rt.key)||null,Fe(Re,He,rt,Mt);case F:var Zn=rt._init;return rt=Zn(rt._payload),Oe(He,Re,Ye,rt,Mt)}if(le(rt)||O(rt))return He=He.get(Ye)||null,ot(Re,He,rt,Mt,null);if(typeof rt.then=="function")return Oe(He,Re,Ye,uI(rt),Mt);if(rt.$$typeof===x)return Oe(He,Re,Ye,$u(Re,rt),Mt);qC(Re,rt)}return null}function qt(He,Re,Ye,rt){for(var Mt=null,Zn=null,zt=Re,Jt=Re=0,Na=null;zt!==null&&Jt<Ye.length;Jt++){zt.index>Jt?(Na=zt,zt=null):Na=zt.sibling;var Dn=Ue(He,zt,Ye[Jt],rt);if(Dn===null){zt===null&&(zt=Na);break}l&&zt&&Dn.alternate===null&&c(He,zt),Re=W(Dn,Re,Jt),Zn===null?Mt=Dn:Zn.sibling=Dn,Zn=Dn,zt=Na}if(Jt===Ye.length)return A(He,zt),Xn&&Jl(He,Jt),Mt;if(zt===null){for(;Jt<Ye.length;Jt++)zt=It(He,Ye[Jt],rt),zt!==null&&(Re=W(zt,Re,Jt),Zn===null?Mt=zt:Zn.sibling=zt,Zn=zt);return Xn&&Jl(He,Jt),Mt}for(zt=m(zt);Jt<Ye.length;Jt++)Na=Oe(zt,He,Jt,Ye[Jt],rt),Na!==null&&(l&&Na.alternate!==null&&zt.delete(Na.key===null?Jt:Na.key),Re=W(Na,Re,Jt),Zn===null?Mt=Na:Zn.sibling=Na,Zn=Na);return l&&zt.forEach(function(lu){return c(He,lu)}),Xn&&Jl(He,Jt),Mt}function Ot(He,Re,Ye,rt){if(Ye==null)throw Error(n(151));for(var Mt=null,Zn=null,zt=Re,Jt=Re=0,Na=null,Dn=Ye.next();zt!==null&&!Dn.done;Jt++,Dn=Ye.next()){zt.index>Jt?(Na=zt,zt=null):Na=zt.sibling;var lu=Ue(He,zt,Dn.value,rt);if(lu===null){zt===null&&(zt=Na);break}l&&zt&&lu.alternate===null&&c(He,zt),Re=W(lu,Re,Jt),Zn===null?Mt=lu:Zn.sibling=lu,Zn=lu,zt=Na}if(Dn.done)return A(He,zt),Xn&&Jl(He,Jt),Mt;if(zt===null){for(;!Dn.done;Jt++,Dn=Ye.next())Dn=It(He,Dn.value,rt),Dn!==null&&(Re=W(Dn,Re,Jt),Zn===null?Mt=Dn:Zn.sibling=Dn,Zn=Dn);return Xn&&Jl(He,Jt),Mt}for(zt=m(zt);!Dn.done;Jt++,Dn=Ye.next())Dn=Oe(zt,He,Jt,Dn.value,rt),Dn!==null&&(l&&Dn.alternate!==null&&zt.delete(Dn.key===null?Jt:Dn.key),Re=W(Dn,Re,Jt),Zn===null?Mt=Dn:Zn.sibling=Dn,Zn=Dn);return l&&zt.forEach(function(E9){return c(He,E9)}),Xn&&Jl(He,Jt),Mt}function oi(He,Re,Ye,rt){if(typeof Ye=="object"&&Ye!==null&&Ye.type===y&&Ye.key===null&&(Ye=Ye.props.children),typeof Ye=="object"&&Ye!==null){switch(Ye.$$typeof){case f:e:{for(var Mt=Ye.key;Re!==null;){if(Re.key===Mt){if(Mt=Ye.type,Mt===y){if(Re.tag===7){A(He,Re.sibling),rt=Z(Re,Ye.props.children),rt.return=He,He=rt;break e}}else if(Re.elementType===Mt||typeof Mt=="object"&&Mt!==null&&Mt.$$typeof===F&&nm(Mt)===Re.type){A(He,Re.sibling),rt=Z(Re,Ye.props),Uc(rt,Ye),rt.return=He,He=rt;break e}A(He,Re);break}else c(He,Re);Re=Re.sibling}Ye.type===y?(rt=Kr(Ye.props.children,He.mode,rt,Ye.key),rt.return=He,He=rt):(rt=Ia(Ye.type,Ye.key,Ye.props,null,He.mode,rt),Uc(rt,Ye),rt.return=He,He=rt)}return _(He);case p:e:{for(Mt=Ye.key;Re!==null;){if(Re.key===Mt)if(Re.tag===4&&Re.stateNode.containerInfo===Ye.containerInfo&&Re.stateNode.implementation===Ye.implementation){A(He,Re.sibling),rt=Z(Re,Ye.children||[]),rt.return=He,He=rt;break e}else{A(He,Re);break}else c(He,Re);Re=Re.sibling}rt=MC(Ye,He.mode,rt),rt.return=He,He=rt}return _(He);case F:return Mt=Ye._init,Ye=Mt(Ye._payload),oi(He,Re,Ye,rt)}if(le(Ye))return qt(He,Re,Ye,rt);if(O(Ye)){if(Mt=O(Ye),typeof Mt!="function")throw Error(n(150));return Ye=Mt.call(Ye),Ot(He,Re,Ye,rt)}if(typeof Ye.then=="function")return oi(He,Re,uI(Ye),rt);if(Ye.$$typeof===x)return oi(He,Re,$u(He,Ye),rt);qC(He,Ye)}return typeof Ye=="string"&&Ye!==""||typeof Ye=="number"||typeof Ye=="bigint"?(Ye=""+Ye,Re!==null&&Re.tag===6?(A(He,Re.sibling),rt=Z(Re,Ye),rt.return=He,He=rt):(A(He,Re),rt=Pu(Ye,He.mode,rt),rt.return=He,He=rt),_(He)):A(He,Re)}return function(He,Re,Ye,rt){try{cI=0;var Mt=oi(He,Re,Ye,rt);return xg=null,Mt}catch(zt){if(zt===iI||zt===No)throw zt;var Zn=us(29,zt,null,He.mode);return Zn.lanes=rt,Zn.return=He,Zn}finally{}}}var Wg=im(!0),am=im(!1),Qn=D(null),Ko=null;function kr(l){var c=l.alternate;oe(Li,Li.current&1),oe(Qn,l),Ko===null&&(c===null||Tc.current!==null||c.memoizedState!==null)&&(Ko=l)}function sm(l){if(l.tag===22){if(oe(Li,Li.current),oe(Qn,l),Ko===null){var c=l.alternate;c!==null&&c.memoizedState!==null&&(Ko=l)}}else Or()}function Or(){oe(Li,Li.current),oe(Qn,Qn.current)}function sl(l){ne(Qn),Ko===l&&(Ko=null),ne(Li)}var Li=D(0);function nr(l){for(var c=l;c!==null;){if(c.tag===13){var A=c.memoizedState;if(A!==null&&(A=A.dehydrated,A===null||A.data==="$?"||SG(A)))return c}else if(c.tag===19&&c.memoizedProps.revealOrder!==void 0){if((c.flags&128)!==0)return c}else if(c.child!==null){c.child.return=c,c=c.child;continue}if(c===l)break;for(;c.sibling===null;){if(c.return===null||c.return===l)return null;c=c.return}c.sibling.return=c.return,c=c.sibling}return null}function Jr(l,c,A,m){c=l.memoizedState,A=A(m,c),A=A==null?c:C({},c,A),l.memoizedState=A,l.lanes===0&&(l.updateQueue.baseState=A)}var ka={enqueueSetState:function(l,c,A){l=l._reactInternals;var m=Vi(),Z=al(m);Z.payload=c,A!=null&&(Z.callback=A),c=ql(l,Z,m),c!==null&&(Ja(c,l,m),wg(c,l,m))},enqueueReplaceState:function(l,c,A){l=l._reactInternals;var m=Vi(),Z=al(m);Z.tag=1,Z.payload=c,A!=null&&(Z.callback=A),c=ql(l,Z,m),c!==null&&(Ja(c,l,m),wg(c,l,m))},enqueueForceUpdate:function(l,c){l=l._reactInternals;var A=Vi(),m=al(A);m.tag=2,c!=null&&(m.callback=c),c=ql(l,m,A),c!==null&&(Ja(c,l,A),wg(c,l,A))}};function om(l,c,A,m,Z,W,_){return l=l.stateNode,typeof l.shouldComponentUpdate=="function"?l.shouldComponentUpdate(m,W,_):c.prototype&&c.prototype.isPureReactComponent?!Ho(A,m)||!Ho(Z,W):!0}function lm(l,c,A,m){l=c.state,typeof c.componentWillReceiveProps=="function"&&c.componentWillReceiveProps(A,m),typeof c.UNSAFE_componentWillReceiveProps=="function"&&c.UNSAFE_componentWillReceiveProps(A,m),c.state!==l&&ka.enqueueReplaceState(c,c.state,null)}function ol(l,c){var A=c;if("ref"in c){A={};for(var m in c)m!=="ref"&&(A[m]=c[m])}if(l=l.defaultProps){A===c&&(A=C({},A));for(var Z in l)A[Z]===void 0&&(A[Z]=l[Z])}return A}var Vg=typeof reportError=="function"?reportError:function(l){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var c=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof l=="object"&&l!==null&&typeof l.message=="string"?String(l.message):String(l),error:l});if(!window.dispatchEvent(c))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",l);return}console.error(l)};function II(l){Vg(l)}function $C(l){console.error(l)}function rm(l){Vg(l)}function ed(l,c){try{var A=l.onUncaughtError;A(c.value,{componentStack:c.stack})}catch(m){setTimeout(function(){throw m})}}function Io(l,c,A){try{var m=l.onCaughtError;m(A.value,{componentStack:A.stack,errorBoundary:c.tag===1?c.stateNode:null})}catch(Z){setTimeout(function(){throw Z})}}function td(l,c,A){return A=al(A),A.tag=3,A.payload={element:null},A.callback=function(){ed(l,c)},A}function gm(l){return l=al(l),l.tag=3,l}function nd(l,c,A,m){var Z=A.type.getDerivedStateFromError;if(typeof Z=="function"){var W=m.value;l.payload=function(){return Z(W)},l.callback=function(){Io(c,A,m)}}var _=A.stateNode;_!==null&&typeof _.componentDidCatch=="function"&&(l.callback=function(){Io(c,A,m),typeof Z!="function"&&(Ts===null?Ts=new Set([this]):Ts.add(this));var ee=m.stack;this.componentDidCatch(m.value,{componentStack:ee!==null?ee:""})})}function IG(l,c,A,m,Z){if(A.flags|=32768,m!==null&&typeof m=="object"&&typeof m.then=="function"){if(c=A.alternate,c!==null&&ro(c,A,Z,!0),A=Qn.current,A!==null){switch(A.tag){case 13:return Ko===null?I():A.alternate===null&&di===0&&(di=3),A.flags&=-257,A.flags|=65536,A.lanes=Z,m===aI?A.flags|=16384:(c=A.updateQueue,c===null?A.updateQueue=new Set([m]):c.add(m),Pe(l,m,Z)),!1;case 22:return A.flags|=65536,m===aI?A.flags|=16384:(c=A.updateQueue,c===null?(c={transitions:null,markerInstances:null,retryQueue:new Set([m])},A.updateQueue=c):(A=c.retryQueue,A===null?c.retryQueue=new Set([m]):A.add(m)),Pe(l,m,Z)),!1}throw Error(n(435,A.tag))}return Pe(l,m,Z),I(),!1}if(Xn)return c=Qn.current,c!==null?((c.flags&65536)===0&&(c.flags|=256),c.flags|=65536,c.lanes=Z,m!==XC&&(l=Error(n(422),{cause:m}),Rg(ya(l,A)))):(m!==XC&&(c=Error(n(423),{cause:m}),Rg(ya(c,A))),l=l.current.alternate,l.flags|=65536,Z&=-Z,l.lanes|=Z,m=ya(m,A),Z=td(l.stateNode,m,Z),Kc(l,Z),di!==4&&(di=2)),!1;var W=Error(n(520),{cause:m});if(W=ya(W,A),Un===null?Un=[W]:Un.push(W),di!==4&&(di=2),c===null)return!0;m=ya(m,A),A=c;do{switch(A.tag){case 3:return A.flags|=65536,l=Z&-Z,A.lanes|=l,l=td(A.stateNode,m,l),Kc(A,l),!1;case 1:if(c=A.type,W=A.stateNode,(A.flags&128)===0&&(typeof c.getDerivedStateFromError=="function"||W!==null&&typeof W.componentDidCatch=="function"&&(Ts===null||!Ts.has(W))))return A.flags|=65536,Z&=-Z,A.lanes|=Z,Z=gm(Z),nd(Z,l,A,m),Kc(A,Z),!1}A=A.return}while(A!==null);return!1}var cm=Error(n(461)),Ca=!1;function _i(l,c,A,m){c.child=l===null?am(c,null,A,m):Wg(c,l.child,A,m)}function Cs(l,c,A,m,Z){A=A.render;var W=c.ref;if("ref"in m){var _={};for(var ee in m)ee!=="ref"&&(_[ee]=m[ee])}else _=m;return il(c),m=er(l,c,A,_,W,Z),ee=eh(),l!==null&&!Ca?(_C(l,c,Z),da(l,c,Z)):(Xn&&ee&&_A(c),c.flags|=1,_i(l,c,m,Z),c.child)}function ds(l,c,A,m,Z){if(l===null){var W=A.type;return typeof W=="function"&&!Ju(W)&&W.defaultProps===void 0&&A.compare===null?(c.tag=15,c.type=W,hh(l,c,W,m,Z)):(l=Ia(A.type,null,m,c,c.mode,Z),l.ref=c.ref,l.return=c,c.child=l)}if(W=l.child,!CI(l,Z)){var _=W.memoizedProps;if(A=A.compare,A=A!==null?A:Ho,A(_,m)&&l.ref===c.ref)return da(l,c,Z)}return c.flags|=1,l=Ti(W,m),l.ref=c.ref,l.return=c,c.child=l}function hh(l,c,A,m,Z){if(l!==null){var W=l.memoizedProps;if(Ho(W,m)&&l.ref===c.ref)if(Ca=!1,c.pendingProps=m=W,CI(l,Z))(l.flags&131072)!==0&&(Ca=!0);else return c.lanes=l.lanes,da(l,c,Z)}return Dc(l,c,A,m,Z)}function Mg(l,c,A){var m=c.pendingProps,Z=m.children,W=l!==null?l.memoizedState:null;if(m.mode==="hidden"){if((c.flags&128)!==0){if(m=W!==null?W.baseLanes|A:A,l!==null){for(Z=c.child=l.child,W=0;Z!==null;)W=W|Z.lanes|Z.childLanes,Z=Z.sibling;c.childLanes=W&~m}else c.childLanes=0,c.child=null;return Hg(l,c,m,A)}if((A&536870912)!==0)c.memoizedState={baseLanes:0,cachePool:null},l!==null&&nI(c,W!==null?W.cachePool:null),W!==null?Sp(c,W):$A(),sm(c);else return c.lanes=c.childLanes=536870912,Hg(l,c,W!==null?W.baseLanes|A:A,A)}else W!==null?(nI(c,W.cachePool),Sp(c,W),Or(),c.memoizedState=null):(l!==null&&nI(c,null),$A(),Or());return _i(l,c,Z,A),c.child}function Hg(l,c,A,m){var Z=Lr();return Z=Z===null?null:{parent:ji._currentValue,pool:Z},c.memoizedState={baseLanes:A,cachePool:Z},l!==null&&nI(c,null),$A(),sm(c),l!==null&&ro(l,c,m,!0),null}function Xg(l,c){var A=c.ref;if(A===null)l!==null&&l.ref!==null&&(c.flags|=4194816);else{if(typeof A!="function"&&typeof A!="object")throw Error(n(284));(l===null||l.ref!==A)&&(c.flags|=4194816)}}function Dc(l,c,A,m,Z){return il(c),A=er(l,c,A,m,void 0,Z),m=eh(),l!==null&&!Ca?(_C(l,c,Z),da(l,c,Z)):(Xn&&m&&_A(c),c.flags|=1,_i(l,c,A,Z),c.child)}function Hs(l,c,A,m,Z,W){return il(c),c.updateQueue=null,A=xp(c,m,A,Z),wp(l),m=eh(),l!==null&&!Ca?(_C(l,c,W),da(l,c,W)):(Xn&&m&&_A(c),c.flags|=1,_i(l,c,A,W),c.child)}function Xs(l,c,A,m,Z){if(il(c),c.stateNode===null){var W=Yr,_=A.contextType;typeof _=="object"&&_!==null&&(W=wi(_)),W=new A(m,W),c.memoizedState=W.state!==null&&W.state!==void 0?W.state:null,W.updater=ka,c.stateNode=W,W._reactInternals=c,W=c.stateNode,W.props=m,W.state=c.memoizedState,W.refs={},jA(c),_=A.contextType,W.context=typeof _=="object"&&_!==null?wi(_):Yr,W.state=c.memoizedState,_=A.getDerivedStateFromProps,typeof _=="function"&&(Jr(c,A,_,m),W.state=c.memoizedState),typeof A.getDerivedStateFromProps=="function"||typeof W.getSnapshotBeforeUpdate=="function"||typeof W.UNSAFE_componentWillMount!="function"&&typeof W.componentWillMount!="function"||(_=W.state,typeof W.componentWillMount=="function"&&W.componentWillMount(),typeof W.UNSAFE_componentWillMount=="function"&&W.UNSAFE_componentWillMount(),_!==W.state&&ka.enqueueReplaceState(W,W.state,null),Fc(c,m,W,Z),sI(),W.state=c.memoizedState),typeof W.componentDidMount=="function"&&(c.flags|=4194308),m=!0}else if(l===null){W=c.stateNode;var ee=c.memoizedProps,Ae=ol(A,ee);W.props=Ae;var Fe=W.context,ot=A.contextType;_=Yr,typeof ot=="object"&&ot!==null&&(_=wi(ot));var It=A.getDerivedStateFromProps;ot=typeof It=="function"||typeof W.getSnapshotBeforeUpdate=="function",ee=c.pendingProps!==ee,ot||typeof W.UNSAFE_componentWillReceiveProps!="function"&&typeof W.componentWillReceiveProps!="function"||(ee||Fe!==_)&&lm(c,W,m,_),jl=!1;var Ue=c.memoizedState;W.state=Ue,Fc(c,m,W,Z),sI(),Fe=c.memoizedState,ee||Ue!==Fe||jl?(typeof It=="function"&&(Jr(c,A,It,m),Fe=c.memoizedState),(Ae=jl||om(c,A,Ae,m,Ue,Fe,_))?(ot||typeof W.UNSAFE_componentWillMount!="function"&&typeof W.componentWillMount!="function"||(typeof W.componentWillMount=="function"&&W.componentWillMount(),typeof W.UNSAFE_componentWillMount=="function"&&W.UNSAFE_componentWillMount()),typeof W.componentDidMount=="function"&&(c.flags|=4194308)):(typeof W.componentDidMount=="function"&&(c.flags|=4194308),c.memoizedProps=m,c.memoizedState=Fe),W.props=m,W.state=Fe,W.context=_,m=Ae):(typeof W.componentDidMount=="function"&&(c.flags|=4194308),m=!1)}else{W=c.stateNode,Pt(l,c),_=c.memoizedProps,ot=ol(A,_),W.props=ot,It=c.pendingProps,Ue=W.context,Fe=A.contextType,Ae=Yr,typeof Fe=="object"&&Fe!==null&&(Ae=wi(Fe)),ee=A.getDerivedStateFromProps,(Fe=typeof ee=="function"||typeof W.getSnapshotBeforeUpdate=="function")||typeof W.UNSAFE_componentWillReceiveProps!="function"&&typeof W.componentWillReceiveProps!="function"||(_!==It||Ue!==Ae)&&lm(c,W,m,Ae),jl=!1,Ue=c.memoizedState,W.state=Ue,Fc(c,m,W,Z),sI();var Oe=c.memoizedState;_!==It||Ue!==Oe||jl||l!==null&&l.dependencies!==null&&qu(l.dependencies)?(typeof ee=="function"&&(Jr(c,A,ee,m),Oe=c.memoizedState),(ot=jl||om(c,A,ot,m,Ue,Oe,Ae)||l!==null&&l.dependencies!==null&&qu(l.dependencies))?(Fe||typeof W.UNSAFE_componentWillUpdate!="function"&&typeof W.componentWillUpdate!="function"||(typeof W.componentWillUpdate=="function"&&W.componentWillUpdate(m,Oe,Ae),typeof W.UNSAFE_componentWillUpdate=="function"&&W.UNSAFE_componentWillUpdate(m,Oe,Ae)),typeof W.componentDidUpdate=="function"&&(c.flags|=4),typeof W.getSnapshotBeforeUpdate=="function"&&(c.flags|=1024)):(typeof W.componentDidUpdate!="function"||_===l.memoizedProps&&Ue===l.memoizedState||(c.flags|=4),typeof W.getSnapshotBeforeUpdate!="function"||_===l.memoizedProps&&Ue===l.memoizedState||(c.flags|=1024),c.memoizedProps=m,c.memoizedState=Oe),W.props=m,W.state=Oe,W.context=Ae,m=ot):(typeof W.componentDidUpdate!="function"||_===l.memoizedProps&&Ue===l.memoizedState||(c.flags|=4),typeof W.getSnapshotBeforeUpdate!="function"||_===l.memoizedProps&&Ue===l.memoizedState||(c.flags|=1024),m=!1)}return W=m,Xg(l,c),m=(c.flags&128)!==0,W||m?(W=c.stateNode,A=m&&typeof A.getDerivedStateFromError!="function"?null:W.render(),c.flags|=1,l!==null&&m?(c.child=Wg(c,l.child,null,Z),c.child=Wg(c,null,A,Z)):_i(l,c,A,Z),c.memoizedState=W.state,l=c.child):l=da(l,c,Z),l}function Pr(l,c,A,m){return Mc(),c.flags|=256,_i(l,c,A,m),c.child}var Fo={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function Eo(l){return{baseLanes:l,cachePool:FC()}}function oa(l,c,A){return l=l!==null?l.childLanes&~A:0,c&&(l|=po),l}function kc(l,c,A){var m=c.pendingProps,Z=!1,W=(c.flags&128)!==0,_;if((_=W)||(_=l!==null&&l.memoizedState===null?!1:(Li.current&2)!==0),_&&(Z=!0,c.flags&=-129),_=(c.flags&32)!==0,c.flags&=-33,l===null){if(Xn){if(Z?kr(c):Or(),Xn){var ee=yi,Ae;if(Ae=ee){e:{for(Ae=ee,ee=Ws;Ae.nodeType!==8;){if(!ee){ee=null;break e}if(Ae=rr(Ae.nextSibling),Ae===null){ee=null;break e}}ee=Ae}ee!==null?(c.memoizedState={dehydrated:ee,treeContext:Fr!==null?{id:tl,overflow:nl}:null,retryLane:536870912,hydrationErrors:null},Ae=us(18,null,null,0),Ae.stateNode=ee,Ae.return=c,c.child=Ae,_a=c,yi=null,Ae=!0):Ae=!1}Ae||Er(c)}if(ee=c.memoizedState,ee!==null&&(ee=ee.dehydrated,ee!==null))return SG(ee)?c.lanes=32:c.lanes=536870912,null;sl(c)}return ee=m.children,m=m.fallback,Z?(Or(),Z=c.mode,ee=Ng({mode:"hidden",children:ee},Z),m=Kr(m,Z,A,null),ee.return=c,m.return=c,ee.sibling=m,c.child=ee,Z=c.child,Z.memoizedState=Eo(A),Z.childLanes=oa(l,_,A),c.memoizedState=Fo,m):(kr(c),ll(c,ee))}if(Ae=l.memoizedState,Ae!==null&&(ee=Ae.dehydrated,ee!==null)){if(W)c.flags&256?(kr(c),c.flags&=-257,c=va(l,c,A)):c.memoizedState!==null?(Or(),c.child=l.child,c.flags|=128,c=null):(Or(),Z=m.fallback,ee=c.mode,m=Ng({mode:"visible",children:m.children},ee),Z=Kr(Z,ee,A,null),Z.flags|=2,m.return=c,Z.return=c,m.sibling=Z,c.child=m,Wg(c,l.child,null,A),m=c.child,m.memoizedState=Eo(A),m.childLanes=oa(l,_,A),c.memoizedState=Fo,c=Z);else if(kr(c),SG(ee)){if(_=ee.nextSibling&&ee.nextSibling.dataset,_)var Fe=_.dgst;_=Fe,m=Error(n(419)),m.stack="",m.digest=_,Rg({value:m,source:null,stack:null}),c=va(l,c,A)}else if(Ca||ro(l,c,A,!1),_=(A&l.childLanes)!==0,Ca||_){if(_=tn,_!==null&&(m=A&-A,m=(m&42)!==0?1:yt(m),m=(m&(_.suspendedLanes|A))!==0?0:m,m!==0&&m!==Ae.retryLane))throw Ae.retryLane=m,Ol(l,m),Ja(_,l,m),cm;ee.data==="$?"||I(),c=va(l,c,A)}else ee.data==="$?"?(c.flags|=192,c.child=l.child,c=null):(l=Ae.treeContext,yi=rr(ee.nextSibling),_a=c,Xn=!0,lo=null,Ws=!1,l!==null&&(Ga[xs++]=tl,Ga[xs++]=nl,Ga[xs++]=Fr,tl=l.id,nl=l.overflow,Fr=c),c=ll(c,m.children),c.flags|=4096);return c}return Z?(Or(),Z=m.fallback,ee=c.mode,Ae=l.child,Fe=Ae.sibling,m=Ti(Ae,{mode:"hidden",children:m.children}),m.subtreeFlags=Ae.subtreeFlags&65011712,Fe!==null?Z=Ti(Fe,Z):(Z=Kr(Z,ee,A,null),Z.flags|=2),Z.return=c,m.return=c,m.sibling=Z,c.child=m,m=Z,Z=c.child,ee=l.child.memoizedState,ee===null?ee=Eo(A):(Ae=ee.cachePool,Ae!==null?(Fe=ji._currentValue,Ae=Ae.parent!==Fe?{parent:Fe,pool:Fe}:Ae):Ae=FC(),ee={baseLanes:ee.baseLanes|A,cachePool:Ae}),Z.memoizedState=ee,Z.childLanes=oa(l,_,A),c.memoizedState=Fo,m):(kr(c),A=l.child,l=A.sibling,A=Ti(A,{mode:"visible",children:m.children}),A.return=c,A.sibling=null,l!==null&&(_=c.deletions,_===null?(c.deletions=[l],c.flags|=16):_.push(l)),c.child=A,c.memoizedState=null,A)}function ll(l,c){return c=Ng({mode:"visible",children:c},l.mode),c.return=l,l.child=c}function Ng(l,c){return l=us(22,l,null,c),l.lanes=0,l.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null},l}function va(l,c,A){return Wg(c,l.child,null,A),l=ll(c,c.pendingProps.children),l.flags|=2,c.memoizedState=null,l}function Za(l,c,A){l.lanes|=c;var m=l.alternate;m!==null&&(m.lanes|=c),OA(l.return,c,A)}function xn(l,c,A,m,Z){var W=l.memoizedState;W===null?l.memoizedState={isBackwards:c,rendering:null,renderingStartTime:0,last:m,tail:A,tailMode:Z}:(W.isBackwards=c,W.rendering=null,W.renderingStartTime=0,W.last=m,W.tail=A,W.tailMode=Z)}function Co(l,c,A){var m=c.pendingProps,Z=m.revealOrder,W=m.tail;if(_i(l,c,m.children,A),m=Li.current,(m&2)!==0)m=m&1|2,c.flags|=128;else{if(l!==null&&(l.flags&128)!==0)e:for(l=c.child;l!==null;){if(l.tag===13)l.memoizedState!==null&&Za(l,A,c);else if(l.tag===19)Za(l,A,c);else if(l.child!==null){l.child.return=l,l=l.child;continue}if(l===c)break e;for(;l.sibling===null;){if(l.return===null||l.return===c)break e;l=l.return}l.sibling.return=l.return,l=l.sibling}m&=1}switch(oe(Li,m),Z){case"forwards":for(A=c.child,Z=null;A!==null;)l=A.alternate,l!==null&&nr(l)===null&&(Z=A),A=A.sibling;A=Z,A===null?(Z=c.child,c.child=null):(Z=A.sibling,A.sibling=null),xn(c,!1,Z,A,W);break;case"backwards":for(A=null,Z=c.child,c.child=null;Z!==null;){if(l=Z.alternate,l!==null&&nr(l)===null){c.child=Z;break}l=Z.sibling,Z.sibling=A,A=Z,Z=l}xn(c,!0,A,null,W);break;case"together":xn(c,!1,null,null,void 0);break;default:c.memoizedState=null}return c.child}function da(l,c,A){if(l!==null&&(c.dependencies=l.dependencies),_o|=c.lanes,(A&c.childLanes)===0)if(l!==null){if(ro(l,c,A,!1),(A&c.childLanes)===0)return null}else return null;if(l!==null&&c.child!==l.child)throw Error(n(153));if(c.child!==null){for(l=c.child,A=Ti(l,l.pendingProps),c.child=A,A.return=c;l.sibling!==null;)l=l.sibling,A=A.sibling=Ti(l,l.pendingProps),A.return=c;A.sibling=null}return c.child}function CI(l,c){return(l.lanes&c)!==0?!0:(l=l.dependencies,!!(l!==null&&qu(l)))}function Ao(l,c,A){switch(c.tag){case 3:be(c,c.stateNode.containerInfo),zr(c,ji,l.memoizedState.cache),Mc();break;case 27:case 5:qe(c);break;case 4:be(c,c.stateNode.containerInfo);break;case 10:zr(c,c.type,c.memoizedProps.value);break;case 13:var m=c.memoizedState;if(m!==null)return m.dehydrated!==null?(kr(c),c.flags|=128,null):(A&c.child.childLanes)!==0?kc(l,c,A):(kr(c),l=da(l,c,A),l!==null?l.sibling:null);kr(c);break;case 19:var Z=(l.flags&128)!==0;if(m=(A&c.childLanes)!==0,m||(ro(l,c,A,!1),m=(A&c.childLanes)!==0),Z){if(m)return Co(l,c,A);c.flags|=128}if(Z=c.memoizedState,Z!==null&&(Z.rendering=null,Z.tail=null,Z.lastEffect=null),oe(Li,Li.current),m)break;return null;case 22:case 23:return c.lanes=0,Mg(l,c,A);case 24:zr(c,ji,l.memoizedState.cache)}return da(l,c,A)}function Yg(l,c,A){if(l!==null)if(l.memoizedProps!==c.pendingProps)Ca=!0;else{if(!CI(l,A)&&(c.flags&128)===0)return Ca=!1,Ao(l,c,A);Ca=(l.flags&131072)!==0}else Ca=!1,Xn&&(c.flags&1048576)!==0&&HC(c,Vc,c.index);switch(c.lanes=0,c.tag){case 16:e:{l=c.pendingProps;var m=c.elementType,Z=m._init;if(m=Z(m._payload),c.type=m,typeof m=="function")Ju(m)?(l=ol(m,l),c.tag=1,c=Xs(null,c,m,l,A)):(c.tag=0,c=Dc(null,c,m,l,A));else{if(m!=null){if(Z=m.$$typeof,Z===w){c.tag=11,c=Cs(null,c,m,l,A);break e}else if(Z===N){c.tag=14,c=ds(null,c,m,l,A);break e}}throw c=ie(m)||m,Error(n(306,c,""))}}return c;case 0:return Dc(l,c,c.type,c.pendingProps,A);case 1:return m=c.type,Z=ol(m,c.pendingProps),Xs(l,c,m,Z,A);case 3:e:{if(be(c,c.stateNode.containerInfo),l===null)throw Error(n(387));m=c.pendingProps;var W=c.memoizedState;Z=W.element,Pt(l,c),Fc(c,m,null,A);var _=c.memoizedState;if(m=_.cache,zr(c,ji,m),m!==W.cache&&ju(c,[ji],A,!0),sI(),m=_.element,W.isDehydrated)if(W={element:m,isDehydrated:!1,cache:_.cache},c.updateQueue.baseState=W,c.memoizedState=W,c.flags&256){c=Pr(l,c,m,A);break e}else if(m!==Z){Z=ya(Error(n(424)),c),Rg(Z),c=Pr(l,c,m,A);break e}else{switch(l=c.stateNode.containerInfo,l.nodeType){case 9:l=l.body;break;default:l=l.nodeName==="HTML"?l.ownerDocument.body:l}for(yi=rr(l.firstChild),_a=c,Xn=!0,lo=null,Ws=!0,A=am(c,null,m,A),c.child=A;A;)A.flags=A.flags&-3|4096,A=A.sibling}else{if(Mc(),m===Z){c=da(l,c,A);break e}_i(l,c,m,A)}c=c.child}return c;case 26:return Xg(l,c),l===null?(A=RS(c.type,null,c.pendingProps,null))?c.memoizedState=A:Xn||(A=c.type,l=c.pendingProps,m=hm(pe.current).createElement(A),m[Cn]=c,m[Kn]=l,Pa(m,A,l),Ci(m),c.stateNode=m):c.memoizedState=RS(c.type,l.memoizedProps,c.pendingProps,l.memoizedState),null;case 27:return qe(c),l===null&&Xn&&(m=c.stateNode=vS(c.type,c.pendingProps,pe.current),_a=c,Ws=!0,Z=yi,nu(c.type)?(RG=Z,yi=rr(m.firstChild)):yi=Z),_i(l,c,c.pendingProps.children,A),Xg(l,c),l===null&&(c.flags|=4194304),c.child;case 5:return l===null&&Xn&&((Z=m=yi)&&(m=d9(m,c.type,c.pendingProps,Ws),m!==null?(c.stateNode=m,_a=c,yi=rr(m.firstChild),Ws=!1,Z=!0):Z=!1),Z||Er(c)),qe(c),Z=c.type,W=c.pendingProps,_=l!==null?l.memoizedProps:null,m=W.children,BG(Z,W)?m=null:_!==null&&BG(Z,_)&&(c.flags|=32),c.memoizedState!==null&&(Z=er(l,c,oG,null,null,A),Rh._currentValue=Z),Xg(l,c),_i(l,c,m,A),c.child;case 6:return l===null&&Xn&&((l=A=yi)&&(A=A9(A,c.pendingProps,Ws),A!==null?(c.stateNode=A,_a=c,yi=null,l=!0):l=!1),l||Er(c)),null;case 13:return kc(l,c,A);case 4:return be(c,c.stateNode.containerInfo),m=c.pendingProps,l===null?c.child=Wg(c,null,m,A):_i(l,c,m,A),c.child;case 11:return Cs(l,c,c.type,c.pendingProps,A);case 7:return _i(l,c,c.pendingProps,A),c.child;case 8:return _i(l,c,c.pendingProps.children,A),c.child;case 12:return _i(l,c,c.pendingProps.children,A),c.child;case 10:return m=c.pendingProps,zr(c,c.type,m.value),_i(l,c,m.children,A),c.child;case 9:return Z=c.type._context,m=c.pendingProps.children,il(c),Z=wi(Z),m=m(Z),c.flags|=1,_i(l,c,m,A),c.child;case 14:return ds(l,c,c.type,c.pendingProps,A);case 15:return hh(l,c,c.type,c.pendingProps,A);case 19:return Co(l,c,A);case 31:return m=c.pendingProps,A=c.mode,m={mode:m.mode,children:m.children},l===null?(A=Ng(m,A),A.ref=c.ref,c.child=A,A.return=c,c=A):(A=Ti(l.child,m),A.ref=c.ref,c.child=A,A.return=c,c=A),c;case 22:return Mg(l,c,A);case 24:return il(c),m=wi(ji),l===null?(Z=Lr(),Z===null&&(Z=tn,W=YC(),Z.pooledCache=W,W.refCount++,W!==null&&(Z.pooledCacheLanes|=A),Z=W),c.memoizedState={parent:m,cache:Z},jA(c),zr(c,ji,Z)):((l.lanes&A)!==0&&(Pt(l,c),Fc(c,null,null,A),sI()),Z=l.memoizedState,W=c.memoizedState,Z.parent!==m?(Z={parent:m,cache:m},c.memoizedState=Z,c.lanes===0&&(c.memoizedState=c.updateQueue.baseState=Z),zr(c,ji,m)):(m=W.cache,zr(c,ji,m),m!==Z.cache&&ju(c,[ji],A,!0))),_i(l,c,c.pendingProps.children,A),c.child;case 29:throw c.pendingProps}throw Error(n(156,c.tag))}function To(l){l.flags|=4}function dI(l,c){if(c.type!=="stylesheet"||(c.state.loading&4)!==0)l.flags&=-16777217;else if(l.flags|=16777216,!MS(c)){if(c=Qn.current,c!==null&&((Lt&4194048)===Lt?Ko!==null:(Lt&62914560)!==Lt&&(Lt&536870912)===0||c!==Ko))throw co=aI,PA;l.flags|=8192}}function ir(l,c){c!==null&&(l.flags|=4),l.flags&16384&&(c=l.tag!==22?Qe():536870912,l.lanes|=c,Vn|=c)}function Kg(l,c){if(!Xn)switch(l.tailMode){case"hidden":c=l.tail;for(var A=null;c!==null;)c.alternate!==null&&(A=c),c=c.sibling;A===null?l.tail=null:A.sibling=null;break;case"collapsed":A=l.tail;for(var m=null;A!==null;)A.alternate!==null&&(m=A),A=A.sibling;m===null?c||l.tail===null?l.tail=null:l.tail.sibling=null:m.sibling=null}}function ni(l){var c=l.alternate!==null&&l.alternate.child===l.child,A=0,m=0;if(c)for(var Z=l.child;Z!==null;)A|=Z.lanes|Z.childLanes,m|=Z.subtreeFlags&65011712,m|=Z.flags&65011712,Z.return=l,Z=Z.sibling;else for(Z=l.child;Z!==null;)A|=Z.lanes|Z.childLanes,m|=Z.subtreeFlags,m|=Z.flags,Z.return=l,Z=Z.sibling;return l.subtreeFlags|=m,l.childLanes=A,c}function fh(l,c,A){var m=c.pendingProps;switch(UA(c),c.tag){case 31:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return ni(c),null;case 1:return ni(c),null;case 3:return A=c.stateNode,m=null,l!==null&&(m=l.memoizedState.cache),c.memoizedState.cache!==m&&(c.flags|=2048),Ql(ji),$e(),A.pendingContext&&(A.context=A.pendingContext,A.pendingContext=null),(l===null||l.child===null)&&(Xo(c)?To(c):l===null||l.memoizedState.isDehydrated&&(c.flags&256)===0||(c.flags|=1024,Ln())),ni(c),null;case 26:return A=c.memoizedState,l===null?(To(c),A!==null?(ni(c),dI(c,A)):(ni(c),c.flags&=-16777217)):A?A!==l.memoizedState?(To(c),ni(c),dI(c,A)):(ni(c),c.flags&=-16777217):(l.memoizedProps!==m&&To(c),ni(c),c.flags&=-16777217),null;case 27:ke(c),A=pe.current;var Z=c.type;if(l!==null&&c.stateNode!=null)l.memoizedProps!==m&&To(c);else{if(!m){if(c.stateNode===null)throw Error(n(166));return ni(c),null}l=j.current,Xo(c)?Gp(c):(l=vS(Z,m,A),c.stateNode=l,To(c))}return ni(c),null;case 5:if(ke(c),A=c.type,l!==null&&c.stateNode!=null)l.memoizedProps!==m&&To(c);else{if(!m){if(c.stateNode===null)throw Error(n(166));return ni(c),null}if(l=j.current,Xo(c))Gp(c);else{switch(Z=hm(pe.current),l){case 1:l=Z.createElementNS("http://www.w3.org/2000/svg",A);break;case 2:l=Z.createElementNS("http://www.w3.org/1998/Math/MathML",A);break;default:switch(A){case"svg":l=Z.createElementNS("http://www.w3.org/2000/svg",A);break;case"math":l=Z.createElementNS("http://www.w3.org/1998/Math/MathML",A);break;case"script":l=Z.createElement("div"),l.innerHTML="<script><\/script>",l=l.removeChild(l.firstChild);break;case"select":l=typeof m.is=="string"?Z.createElement("select",{is:m.is}):Z.createElement("select"),m.multiple?l.multiple=!0:m.size&&(l.size=m.size);break;default:l=typeof m.is=="string"?Z.createElement(A,{is:m.is}):Z.createElement(A)}}l[Cn]=c,l[Kn]=m;e:for(Z=c.child;Z!==null;){if(Z.tag===5||Z.tag===6)l.appendChild(Z.stateNode);else if(Z.tag!==4&&Z.tag!==27&&Z.child!==null){Z.child.return=Z,Z=Z.child;continue}if(Z===c)break e;for(;Z.sibling===null;){if(Z.return===null||Z.return===c)break e;Z=Z.return}Z.sibling.return=Z.return,Z=Z.sibling}c.stateNode=l;e:switch(Pa(l,A,m),A){case"button":case"input":case"select":case"textarea":l=!!m.autoFocus;break e;case"img":l=!0;break e;default:l=!1}l&&To(c)}}return ni(c),c.flags&=-16777217,null;case 6:if(l&&c.stateNode!=null)l.memoizedProps!==m&&To(c);else{if(typeof m!="string"&&c.stateNode===null)throw Error(n(166));if(l=pe.current,Xo(c)){if(l=c.stateNode,A=c.memoizedProps,m=null,Z=_a,Z!==null)switch(Z.tag){case 27:case 5:m=Z.memoizedProps}l[Cn]=c,l=!!(l.nodeValue===A||m!==null&&m.suppressHydrationWarning===!0||fS(l.nodeValue,A)),l||Er(c)}else l=hm(l).createTextNode(m),l[Cn]=c,c.stateNode=l}return ni(c),null;case 13:if(m=c.memoizedState,l===null||l.memoizedState!==null&&l.memoizedState.dehydrated!==null){if(Z=Xo(c),m!==null&&m.dehydrated!==null){if(l===null){if(!Z)throw Error(n(318));if(Z=c.memoizedState,Z=Z!==null?Z.dehydrated:null,!Z)throw Error(n(317));Z[Cn]=c}else Mc(),(c.flags&128)===0&&(c.memoizedState=null),c.flags|=4;ni(c),Z=!1}else Z=Ln(),l!==null&&l.memoizedState!==null&&(l.memoizedState.hydrationErrors=Z),Z=!0;if(!Z)return c.flags&256?(sl(c),c):(sl(c),null)}if(sl(c),(c.flags&128)!==0)return c.lanes=A,c;if(A=m!==null,l=l!==null&&l.memoizedState!==null,A){m=c.child,Z=null,m.alternate!==null&&m.alternate.memoizedState!==null&&m.alternate.memoizedState.cachePool!==null&&(Z=m.alternate.memoizedState.cachePool.pool);var W=null;m.memoizedState!==null&&m.memoizedState.cachePool!==null&&(W=m.memoizedState.cachePool.pool),W!==Z&&(m.flags|=2048)}return A!==l&&A&&(c.child.flags|=8192),ir(c,c.updateQueue),ni(c),null;case 4:return $e(),l===null&&pG(c.stateNode.containerInfo),ni(c),null;case 10:return Ql(c.type),ni(c),null;case 19:if(ne(Li),Z=c.memoizedState,Z===null)return ni(c),null;if(m=(c.flags&128)!==0,W=Z.rendering,W===null)if(m)Kg(Z,!1);else{if(di!==0||l!==null&&(l.flags&128)!==0)for(l=c.child;l!==null;){if(W=nr(l),W!==null){for(c.flags|=128,Kg(Z,!1),l=W.updateQueue,c.updateQueue=l,ir(c,l),c.subtreeFlags=0,l=A,A=c.child;A!==null;)LA(A,l),A=A.sibling;return oe(Li,Li.current&1|2),c.child}l=l.sibling}Z.tail!==null&&Ee()>Ha&&(c.flags|=128,m=!0,Kg(Z,!1),c.lanes=4194304)}else{if(!m)if(l=nr(W),l!==null){if(c.flags|=128,m=!0,l=l.updateQueue,c.updateQueue=l,ir(c,l),Kg(Z,!0),Z.tail===null&&Z.tailMode==="hidden"&&!W.alternate&&!Xn)return ni(c),null}else 2*Ee()-Z.renderingStartTime>Ha&&A!==536870912&&(c.flags|=128,m=!0,Kg(Z,!1),c.lanes=4194304);Z.isBackwards?(W.sibling=c.child,c.child=W):(l=Z.last,l!==null?l.sibling=W:c.child=W,Z.last=W)}return Z.tail!==null?(c=Z.tail,Z.rendering=c,Z.tail=c.sibling,Z.renderingStartTime=Ee(),c.sibling=null,l=Li.current,oe(Li,m?l&1|2:l&1),c):(ni(c),null);case 22:case 23:return sl(c),oI(),m=c.memoizedState!==null,l!==null?l.memoizedState!==null!==m&&(c.flags|=8192):m&&(c.flags|=8192),m?(A&536870912)!==0&&(c.flags&128)===0&&(ni(c),c.subtreeFlags&6&&(c.flags|=8192)):ni(c),A=c.updateQueue,A!==null&&ir(c,A.retryQueue),A=null,l!==null&&l.memoizedState!==null&&l.memoizedState.cachePool!==null&&(A=l.memoizedState.cachePool.pool),m=null,c.memoizedState!==null&&c.memoizedState.cachePool!==null&&(m=c.memoizedState.cachePool.pool),m!==A&&(c.flags|=2048),l!==null&&ne(go),null;case 24:return A=null,l!==null&&(A=l.memoizedState.cache),c.memoizedState.cache!==A&&(c.flags|=2048),Ql(ji),ni(c),null;case 25:return null;case 30:return null}throw Error(n(156,c.tag))}function Oc(l,c){switch(UA(c),c.tag){case 1:return l=c.flags,l&65536?(c.flags=l&-65537|128,c):null;case 3:return Ql(ji),$e(),l=c.flags,(l&65536)!==0&&(l&128)===0?(c.flags=l&-65537|128,c):null;case 26:case 27:case 5:return ke(c),null;case 13:if(sl(c),l=c.memoizedState,l!==null&&l.dehydrated!==null){if(c.alternate===null)throw Error(n(340));Mc()}return l=c.flags,l&65536?(c.flags=l&-65537|128,c):null;case 19:return ne(Li),null;case 4:return $e(),null;case 10:return Ql(c.type),null;case 22:case 23:return sl(c),oI(),l!==null&&ne(go),l=c.flags,l&65536?(c.flags=l&-65537|128,c):null;case 24:return Ql(ji),null;case 25:return null;default:return null}}function Jc(l,c){switch(UA(c),c.tag){case 3:Ql(ji),$e();break;case 26:case 27:case 5:ke(c);break;case 4:$e();break;case 13:sl(c);break;case 19:ne(Li);break;case 10:Ql(c.type);break;case 22:case 23:sl(c),oI(),l!==null&&ne(go);break;case 24:Ql(ji)}}function Fg(l,c){try{var A=c.updateQueue,m=A!==null?A.lastEffect:null;if(m!==null){var Z=m.next;A=Z;do{if((A.tag&l)===l){m=void 0;var W=A.create,_=A.inst;m=W(),_.destroy=m}A=A.next}while(A!==Z)}}catch(ee){ve(c,c.return,ee)}}function Ns(l,c,A){try{var m=c.updateQueue,Z=m!==null?m.lastEffect:null;if(Z!==null){var W=Z.next;m=W;do{if((m.tag&l)===l){var _=m.inst,ee=_.destroy;if(ee!==void 0){_.destroy=void 0,Z=c;var Ae=A,Fe=ee;try{Fe()}catch(ot){ve(Z,Ae,ot)}}}m=m.next}while(m!==W)}}catch(ot){ve(c,c.return,ot)}}function Eg(l){var c=l.updateQueue;if(c!==null){var A=l.stateNode;try{Zp(c,A)}catch(m){ve(l,l.return,m)}}}function ar(l,c,A){A.props=ol(l.type,l.memoizedProps),A.state=l.memoizedState;try{A.componentWillUnmount()}catch(m){ve(l,c,m)}}function Tg(l,c){try{var A=l.ref;if(A!==null){switch(l.tag){case 26:case 27:case 5:var m=l.stateNode;break;case 30:m=l.stateNode;break;default:m=l.stateNode}typeof A=="function"?l.refCleanup=A(m):A.current=m}}catch(Z){ve(l,c,Z)}}function rl(l,c){var A=l.ref,m=l.refCleanup;if(A!==null)if(typeof m=="function")try{m()}catch(Z){ve(l,c,Z)}finally{l.refCleanup=null,l=l.alternate,l!=null&&(l.refCleanup=null)}else if(typeof A=="function")try{A(null)}catch(Z){ve(l,c,Z)}else A.current=null}function Pc(l){var c=l.type,A=l.memoizedProps,m=l.stateNode;try{e:switch(c){case"button":case"input":case"select":case"textarea":A.autoFocus&&m.focus();break e;case"img":A.src?m.src=A.src:A.srcSet&&(m.srcset=A.srcSet)}}catch(Z){ve(l,l.return,Z)}}function AI(l,c,A){try{var m=l.stateNode;g9(m,l.type,A,c),m[Kn]=c}catch(Z){ve(l,l.return,Z)}}function hI(l){return l.tag===5||l.tag===3||l.tag===26||l.tag===27&&nu(l.type)||l.tag===4}function Qr(l){e:for(;;){for(;l.sibling===null;){if(l.return===null||hI(l.return))return null;l=l.return}for(l.sibling.return=l.return,l=l.sibling;l.tag!==5&&l.tag!==6&&l.tag!==18;){if(l.tag===27&&nu(l.type)||l.flags&2||l.child===null||l.tag===4)continue e;l.child.return=l,l=l.child}if(!(l.flags&2))return l.stateNode}}function jr(l,c,A){var m=l.tag;if(m===5||m===6)l=l.stateNode,c?(A.nodeType===9?A.body:A.nodeName==="HTML"?A.ownerDocument.body:A).insertBefore(l,c):(c=A.nodeType===9?A.body:A.nodeName==="HTML"?A.ownerDocument.body:A,c.appendChild(l),A=A._reactRootContainer,A!=null||c.onclick!==null||(c.onclick=Am));else if(m!==4&&(m===27&&nu(l.type)&&(A=l.stateNode,c=null),l=l.child,l!==null))for(jr(l,c,A),l=l.sibling;l!==null;)jr(l,c,A),l=l.sibling}function qr(l,c,A){var m=l.tag;if(m===5||m===6)l=l.stateNode,c?A.insertBefore(l,c):A.appendChild(l);else if(m!==4&&(m===27&&nu(l.type)&&(A=l.stateNode),l=l.child,l!==null))for(qr(l,c,A),l=l.sibling;l!==null;)qr(l,c,A),l=l.sibling}function $r(l){var c=l.stateNode,A=l.memoizedProps;try{for(var m=l.type,Z=c.attributes;Z.length;)c.removeAttributeNode(Z[0]);Pa(c,m,A),c[Cn]=l,c[Kn]=A}catch(W){ve(l,l.return,W)}}var gl=!1,ii=!1,Qc=!1,Ys=typeof WeakSet=="function"?WeakSet:Set,jn=null;function la(l,c){if(l=l.containerInfo,yG=Gm,l=NA(l),Uu(l)){if("selectionStart"in l)var A={start:l.selectionStart,end:l.selectionEnd};else e:{A=(A=l.ownerDocument)&&A.defaultView||window;var m=A.getSelection&&A.getSelection();if(m&&m.rangeCount!==0){A=m.anchorNode;var Z=m.anchorOffset,W=m.focusNode;m=m.focusOffset;try{A.nodeType,W.nodeType}catch{A=null;break e}var _=0,ee=-1,Ae=-1,Fe=0,ot=0,It=l,Ue=null;t:for(;;){for(var Oe;It!==A||Z!==0&&It.nodeType!==3||(ee=_+Z),It!==W||m!==0&&It.nodeType!==3||(Ae=_+m),It.nodeType===3&&(_+=It.nodeValue.length),(Oe=It.firstChild)!==null;)Ue=It,It=Oe;for(;;){if(It===l)break t;if(Ue===A&&++Fe===Z&&(ee=_),Ue===W&&++ot===m&&(Ae=_),(Oe=It.nextSibling)!==null)break;It=Ue,Ue=It.parentNode}It=Oe}A=ee===-1||Ae===-1?null:{start:ee,end:Ae}}else A=null}A=A||{start:0,end:0}}else A=null;for(GG={focusedElem:l,selectionRange:A},Gm=!1,jn=c;jn!==null;)if(c=jn,l=c.child,(c.subtreeFlags&1024)!==0&&l!==null)l.return=c,jn=l;else for(;jn!==null;){switch(c=jn,W=c.alternate,l=c.flags,c.tag){case 0:break;case 11:case 15:break;case 1:if((l&1024)!==0&&W!==null){l=void 0,A=c,Z=W.memoizedProps,W=W.memoizedState,m=A.stateNode;try{var qt=ol(A.type,Z,A.elementType===A.type);l=m.getSnapshotBeforeUpdate(qt,W),m.__reactInternalSnapshotBeforeUpdate=l}catch(Ot){ve(A,A.return,Ot)}}break;case 3:if((l&1024)!==0){if(l=c.stateNode.containerInfo,A=l.nodeType,A===9)ZG(l);else if(A===1)switch(l.nodeName){case"HEAD":case"HTML":case"BODY":ZG(l);break;default:l.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((l&1024)!==0)throw Error(n(163))}if(l=c.sibling,l!==null){l.return=c.return,jn=l;break}jn=c.return}}function sr(l,c,A){var m=A.flags;switch(A.tag){case 0:case 11:case 15:Oa(l,A),m&4&&Fg(5,A);break;case 1:if(Oa(l,A),m&4)if(l=A.stateNode,c===null)try{l.componentDidMount()}catch(_){ve(A,A.return,_)}else{var Z=ol(A.type,c.memoizedProps);c=c.memoizedState;try{l.componentDidUpdate(Z,c,l.__reactInternalSnapshotBeforeUpdate)}catch(_){ve(A,A.return,_)}}m&64&&Eg(A),m&512&&Tg(A,A.return);break;case 3:if(Oa(l,A),m&64&&(l=A.updateQueue,l!==null)){if(c=null,A.child!==null)switch(A.child.tag){case 27:case 5:c=A.child.stateNode;break;case 1:c=A.child.stateNode}try{Zp(l,c)}catch(_){ve(A,A.return,_)}}break;case 27:c===null&&m&4&&$r(A);case 26:case 5:Oa(l,A),c===null&&m&4&&Pc(A),m&512&&Tg(A,A.return);break;case 12:Oa(l,A);break;case 13:Oa(l,A),m&4&&eg(l,A),m&64&&(l=A.memoizedState,l!==null&&(l=l.dehydrated,l!==null&&(A=Ai.bind(null,A),h9(l,A))));break;case 22:if(m=A.memoizedState!==null||gl,!m){c=c!==null&&c.memoizedState!==null||ii,Z=gl;var W=ii;gl=m,(ii=c)&&!W?cl(l,A,(A.subtreeFlags&8772)!==0):Oa(l,A),gl=Z,ii=W}break;case 30:break;default:Oa(l,A)}}function dn(l){var c=l.alternate;c!==null&&(l.alternate=null,dn(c)),l.child=null,l.deletions=null,l.sibling=null,l.tag===5&&(c=l.stateNode,c!==null&&Bn(c)),l.stateNode=null,l.return=null,l.dependencies=null,l.memoizedProps=null,l.memoizedState=null,l.pendingProps=null,l.stateNode=null,l.updateQueue=null}var _t=null,Wn=!1;function ho(l,c,A){for(A=A.child;A!==null;)zg(l,c,A),A=A.sibling}function zg(l,c,A){if(Ge&&typeof Ge.onCommitFiberUnmount=="function")try{Ge.onCommitFiberUnmount(Ve,A)}catch{}switch(A.tag){case 26:ii||rl(A,c),ho(l,c,A),A.memoizedState?A.memoizedState.count--:A.stateNode&&(A=A.stateNode,A.parentNode.removeChild(A));break;case 27:ii||rl(A,c);var m=_t,Z=Wn;nu(A.type)&&(_t=A.stateNode,Wn=!1),ho(l,c,A),Bh(A.stateNode),_t=m,Wn=Z;break;case 5:ii||rl(A,c);case 6:if(m=_t,Z=Wn,_t=null,ho(l,c,A),_t=m,Wn=Z,_t!==null)if(Wn)try{(_t.nodeType===9?_t.body:_t.nodeName==="HTML"?_t.ownerDocument.body:_t).removeChild(A.stateNode)}catch(W){ve(A,c,W)}else try{_t.removeChild(A.stateNode)}catch(W){ve(A,c,W)}break;case 18:_t!==null&&(Wn?(l=_t,GS(l.nodeType===9?l.body:l.nodeName==="HTML"?l.ownerDocument.body:l,A.stateNode),Vh(l)):GS(_t,A.stateNode));break;case 4:m=_t,Z=Wn,_t=A.stateNode.containerInfo,Wn=!0,ho(l,c,A),_t=m,Wn=Z;break;case 0:case 11:case 14:case 15:ii||Ns(2,A,c),ii||Ns(4,A,c),ho(l,c,A);break;case 1:ii||(rl(A,c),m=A.stateNode,typeof m.componentWillUnmount=="function"&&ar(A,c,m)),ho(l,c,A);break;case 21:ho(l,c,A);break;case 22:ii=(m=ii)||A.memoizedState!==null,ho(l,c,A),ii=m;break;default:ho(l,c,A)}}function eg(l,c){if(c.memoizedState===null&&(l=c.alternate,l!==null&&(l=l.memoizedState,l!==null&&(l=l.dehydrated,l!==null))))try{Vh(l)}catch(A){ve(c,c.return,A)}}function id(l){switch(l.tag){case 13:case 19:var c=l.stateNode;return c===null&&(c=l.stateNode=new Ys),c;case 22:return l=l.stateNode,c=l._retryCache,c===null&&(c=l._retryCache=new Ys),c;default:throw Error(n(435,l.tag))}}function Lg(l,c){var A=id(l);c.forEach(function(m){var Z=Qt.bind(null,l,m);A.has(m)||(A.add(m),m.then(Z,Z))})}function Aa(l,c){var A=c.deletions;if(A!==null)for(var m=0;m<A.length;m++){var Z=A[m],W=l,_=c,ee=_;e:for(;ee!==null;){switch(ee.tag){case 27:if(nu(ee.type)){_t=ee.stateNode,Wn=!1;break e}break;case 5:_t=ee.stateNode,Wn=!1;break e;case 3:case 4:_t=ee.stateNode.containerInfo,Wn=!0;break e}ee=ee.return}if(_t===null)throw Error(n(160));zg(W,_,Z),_t=null,Wn=!1,W=Z.alternate,W!==null&&(W.return=null),Z.return=null}if(c.subtreeFlags&13878)for(c=c.child;c!==null;)ad(c,l),c=c.sibling}var zo=null;function ad(l,c){var A=l.alternate,m=l.flags;switch(l.tag){case 0:case 11:case 14:case 15:Aa(c,l),xi(l),m&4&&(Ns(3,l,l.return),Fg(3,l),Ns(5,l,l.return));break;case 1:Aa(c,l),xi(l),m&512&&(ii||A===null||rl(A,A.return)),m&64&&gl&&(l=l.updateQueue,l!==null&&(m=l.callbacks,m!==null&&(A=l.shared.hiddenCallbacks,l.shared.hiddenCallbacks=A===null?m:A.concat(m))));break;case 26:var Z=zo;if(Aa(c,l),xi(l),m&512&&(ii||A===null||rl(A,A.return)),m&4){var W=A!==null?A.memoizedState:null;if(m=l.memoizedState,A===null)if(m===null)if(l.stateNode===null){e:{m=l.type,A=l.memoizedProps,Z=Z.ownerDocument||Z;t:switch(m){case"title":W=Z.getElementsByTagName("title")[0],(!W||W[Jn]||W[Cn]||W.namespaceURI==="http://www.w3.org/2000/svg"||W.hasAttribute("itemprop"))&&(W=Z.createElement(m),Z.head.insertBefore(W,Z.querySelector("head > title"))),Pa(W,m,A),W[Cn]=l,Ci(W),m=W;break e;case"link":var _=WS("link","href",Z).get(m+(A.href||""));if(_){for(var ee=0;ee<_.length;ee++)if(W=_[ee],W.getAttribute("href")===(A.href==null||A.href===""?null:A.href)&&W.getAttribute("rel")===(A.rel==null?null:A.rel)&&W.getAttribute("title")===(A.title==null?null:A.title)&&W.getAttribute("crossorigin")===(A.crossOrigin==null?null:A.crossOrigin)){_.splice(ee,1);break t}}W=Z.createElement(m),Pa(W,m,A),Z.head.appendChild(W);break;case"meta":if(_=WS("meta","content",Z).get(m+(A.content||""))){for(ee=0;ee<_.length;ee++)if(W=_[ee],W.getAttribute("content")===(A.content==null?null:""+A.content)&&W.getAttribute("name")===(A.name==null?null:A.name)&&W.getAttribute("property")===(A.property==null?null:A.property)&&W.getAttribute("http-equiv")===(A.httpEquiv==null?null:A.httpEquiv)&&W.getAttribute("charset")===(A.charSet==null?null:A.charSet)){_.splice(ee,1);break t}}W=Z.createElement(m),Pa(W,m,A),Z.head.appendChild(W);break;default:throw Error(n(468,m))}W[Cn]=l,Ci(W),m=W}l.stateNode=m}else VS(Z,l.type,l.stateNode);else l.stateNode=xS(Z,m,l.memoizedProps);else W!==m?(W===null?A.stateNode!==null&&(A=A.stateNode,A.parentNode.removeChild(A)):W.count--,m===null?VS(Z,l.type,l.stateNode):xS(Z,m,l.memoizedProps)):m===null&&l.stateNode!==null&&AI(l,l.memoizedProps,A.memoizedProps)}break;case 27:Aa(c,l),xi(l),m&512&&(ii||A===null||rl(A,A.return)),A!==null&&m&4&&AI(l,l.memoizedProps,A.memoizedProps);break;case 5:if(Aa(c,l),xi(l),m&512&&(ii||A===null||rl(A,A.return)),l.flags&32){Z=l.stateNode;try{Pi(Z,"")}catch(Oe){ve(l,l.return,Oe)}}m&4&&l.stateNode!=null&&(Z=l.memoizedProps,AI(l,Z,A!==null?A.memoizedProps:Z)),m&1024&&(Qc=!0);break;case 6:if(Aa(c,l),xi(l),m&4){if(l.stateNode===null)throw Error(n(162));m=l.memoizedProps,A=l.stateNode;try{A.nodeValue=m}catch(Oe){ve(l,l.return,Oe)}}break;case 3:if(mm=null,Z=zo,zo=fm(c.containerInfo),Aa(c,l),zo=Z,xi(l),m&4&&A!==null&&A.memoizedState.isDehydrated)try{Vh(c.containerInfo)}catch(Oe){ve(l,l.return,Oe)}Qc&&(Qc=!1,tg(l));break;case 4:m=zo,zo=fm(l.stateNode.containerInfo),Aa(c,l),xi(l),zo=m;break;case 12:Aa(c,l),xi(l);break;case 13:Aa(c,l),xi(l),l.child.flags&8192&&l.memoizedState!==null!=(A!==null&&A.memoizedState!==null)&&(On=Ee()),m&4&&(m=l.updateQueue,m!==null&&(l.updateQueue=null,Lg(l,m)));break;case 22:Z=l.memoizedState!==null;var Ae=A!==null&&A.memoizedState!==null,Fe=gl,ot=ii;if(gl=Fe||Z,ii=ot||Ae,Aa(c,l),ii=ot,gl=Fe,xi(l),m&8192)e:for(c=l.stateNode,c._visibility=Z?c._visibility&-2:c._visibility|1,Z&&(A===null||Ae||gl||ii||Ks(l)),A=null,c=l;;){if(c.tag===5||c.tag===26){if(A===null){Ae=A=c;try{if(W=Ae.stateNode,Z)_=W.style,typeof _.setProperty=="function"?_.setProperty("display","none","important"):_.display="none";else{ee=Ae.stateNode;var It=Ae.memoizedProps.style,Ue=It!=null&&It.hasOwnProperty("display")?It.display:null;ee.style.display=Ue==null||typeof Ue=="boolean"?"":(""+Ue).trim()}}catch(Oe){ve(Ae,Ae.return,Oe)}}}else if(c.tag===6){if(A===null){Ae=c;try{Ae.stateNode.nodeValue=Z?"":Ae.memoizedProps}catch(Oe){ve(Ae,Ae.return,Oe)}}}else if((c.tag!==22&&c.tag!==23||c.memoizedState===null||c===l)&&c.child!==null){c.child.return=c,c=c.child;continue}if(c===l)break e;for(;c.sibling===null;){if(c.return===null||c.return===l)break e;A===c&&(A=null),c=c.return}A===c&&(A=null),c.sibling.return=c.return,c=c.sibling}m&4&&(m=l.updateQueue,m!==null&&(A=m.retryQueue,A!==null&&(m.retryQueue=null,Lg(l,A))));break;case 19:Aa(c,l),xi(l),m&4&&(m=l.updateQueue,m!==null&&(l.updateQueue=null,Lg(l,m)));break;case 30:break;case 21:break;default:Aa(c,l),xi(l)}}function xi(l){var c=l.flags;if(c&2){try{for(var A,m=l.return;m!==null;){if(hI(m)){A=m;break}m=m.return}if(A==null)throw Error(n(160));switch(A.tag){case 27:var Z=A.stateNode,W=Qr(l);qr(l,W,Z);break;case 5:var _=A.stateNode;A.flags&32&&(Pi(_,""),A.flags&=-33);var ee=Qr(l);qr(l,ee,_);break;case 3:case 4:var Ae=A.stateNode.containerInfo,Fe=Qr(l);jr(l,Fe,Ae);break;default:throw Error(n(161))}}catch(ot){ve(l,l.return,ot)}l.flags&=-3}c&4096&&(l.flags&=-4097)}function tg(l){if(l.subtreeFlags&1024)for(l=l.child;l!==null;){var c=l;tg(c),c.tag===5&&c.flags&1024&&c.stateNode.reset(),l=l.sibling}}function Oa(l,c){if(c.subtreeFlags&8772)for(c=c.child;c!==null;)sr(l,c.alternate,c),c=c.sibling}function Ks(l){for(l=l.child;l!==null;){var c=l;switch(c.tag){case 0:case 11:case 14:case 15:Ns(4,c,c.return),Ks(c);break;case 1:rl(c,c.return);var A=c.stateNode;typeof A.componentWillUnmount=="function"&&ar(c,c.return,A),Ks(c);break;case 27:Bh(c.stateNode);case 26:case 5:rl(c,c.return),Ks(c);break;case 22:c.memoizedState===null&&Ks(c);break;case 30:Ks(c);break;default:Ks(c)}l=l.sibling}}function cl(l,c,A){for(A=A&&(c.subtreeFlags&8772)!==0,c=c.child;c!==null;){var m=c.alternate,Z=l,W=c,_=W.flags;switch(W.tag){case 0:case 11:case 15:cl(Z,W,A),Fg(4,W);break;case 1:if(cl(Z,W,A),m=W,Z=m.stateNode,typeof Z.componentDidMount=="function")try{Z.componentDidMount()}catch(Fe){ve(m,m.return,Fe)}if(m=W,Z=m.updateQueue,Z!==null){var ee=m.stateNode;try{var Ae=Z.shared.hiddenCallbacks;if(Ae!==null)for(Z.shared.hiddenCallbacks=null,Z=0;Z<Ae.length;Z++)Ec(Ae[Z],ee)}catch(Fe){ve(m,m.return,Fe)}}A&&_&64&&Eg(W),Tg(W,W.return);break;case 27:$r(W);case 26:case 5:cl(Z,W,A),A&&m===null&&_&4&&Pc(W),Tg(W,W.return);break;case 12:cl(Z,W,A);break;case 13:cl(Z,W,A),A&&_&4&&eg(Z,W);break;case 22:W.memoizedState===null&&cl(Z,W,A),Tg(W,W.return);break;case 30:break;default:cl(Z,W,A)}c=c.sibling}}function sd(l,c){var A=null;l!==null&&l.memoizedState!==null&&l.memoizedState.cachePool!==null&&(A=l.memoizedState.cachePool.pool),l=null,c.memoizedState!==null&&c.memoizedState.cachePool!==null&&(l=c.memoizedState.cachePool.pool),l!==A&&(l!=null&&l.refCount++,A!=null&&Hc(A))}function od(l,c){l=null,c.alternate!==null&&(l=c.alternate.memoizedState.cache),c=c.memoizedState.cache,c!==l&&(c.refCount++,l!=null&&Hc(l))}function qn(l,c,A,m){if(c.subtreeFlags&10256)for(c=c.child;c!==null;)ld(l,c,A,m),c=c.sibling}function ld(l,c,A,m){var Z=c.flags;switch(c.tag){case 0:case 11:case 15:qn(l,c,A,m),Z&2048&&Fg(9,c);break;case 1:qn(l,c,A,m);break;case 3:qn(l,c,A,m),Z&2048&&(l=null,c.alternate!==null&&(l=c.alternate.memoizedState.cache),c=c.memoizedState.cache,c!==l&&(c.refCount++,l!=null&&Hc(l)));break;case 12:if(Z&2048){qn(l,c,A,m),l=c.stateNode;try{var W=c.memoizedProps,_=W.id,ee=W.onPostCommit;typeof ee=="function"&&ee(_,c.alternate===null?"mount":"update",l.passiveEffectDuration,-0)}catch(Ae){ve(c,c.return,Ae)}}else qn(l,c,A,m);break;case 13:qn(l,c,A,m);break;case 23:break;case 22:W=c.stateNode,_=c.alternate,c.memoizedState!==null?W._visibility&2?qn(l,c,A,m):Lo(l,c):W._visibility&2?qn(l,c,A,m):(W._visibility|=2,or(l,c,A,m,(c.subtreeFlags&10256)!==0)),Z&2048&&sd(_,c);break;case 24:qn(l,c,A,m),Z&2048&&od(c.alternate,c);break;default:qn(l,c,A,m)}}function or(l,c,A,m,Z){for(Z=Z&&(c.subtreeFlags&10256)!==0,c=c.child;c!==null;){var W=l,_=c,ee=A,Ae=m,Fe=_.flags;switch(_.tag){case 0:case 11:case 15:or(W,_,ee,Ae,Z),Fg(8,_);break;case 23:break;case 22:var ot=_.stateNode;_.memoizedState!==null?ot._visibility&2?or(W,_,ee,Ae,Z):Lo(W,_):(ot._visibility|=2,or(W,_,ee,Ae,Z)),Z&&Fe&2048&&sd(_.alternate,_);break;case 24:or(W,_,ee,Ae,Z),Z&&Fe&2048&&od(_.alternate,_);break;default:or(W,_,ee,Ae,Z)}c=c.sibling}}function Lo(l,c){if(c.subtreeFlags&10256)for(c=c.child;c!==null;){var A=l,m=c,Z=m.flags;switch(m.tag){case 22:Lo(A,m),Z&2048&&sd(m.alternate,m);break;case 24:Lo(A,m),Z&2048&&od(m.alternate,m);break;default:Lo(A,m)}c=c.sibling}}var Fs=8192;function jc(l){if(l.subtreeFlags&Fs)for(l=l.child;l!==null;)um(l),l=l.sibling}function um(l){switch(l.tag){case 26:jc(l),l.flags&Fs&&l.memoizedState!==null&&x9(zo,l.memoizedState,l.memoizedProps);break;case 5:jc(l);break;case 3:case 4:var c=zo;zo=fm(l.stateNode.containerInfo),jc(l),zo=c;break;case 22:l.memoizedState===null&&(c=l.alternate,c!==null&&c.memoizedState!==null?(c=Fs,Fs=16777216,jc(l),Fs=c):jc(l));break;default:jc(l)}}function Im(l){var c=l.alternate;if(c!==null&&(l=c.child,l!==null)){c.child=null;do c=l.sibling,l.sibling=null,l=c;while(l!==null)}}function ai(l){var c=l.deletions;if((l.flags&16)!==0){if(c!==null)for(var A=0;A<c.length;A++){var m=c[A];jn=m,Il(m,l)}Im(l)}if(l.subtreeFlags&10256)for(l=l.child;l!==null;)ph(l),l=l.sibling}function ph(l){switch(l.tag){case 0:case 11:case 15:ai(l),l.flags&2048&&Ns(9,l,l.return);break;case 3:ai(l);break;case 12:ai(l);break;case 22:var c=l.stateNode;l.memoizedState!==null&&c._visibility&2&&(l.return===null||l.return.tag!==13)?(c._visibility&=-3,ul(l)):ai(l);break;default:ai(l)}}function ul(l){var c=l.deletions;if((l.flags&16)!==0){if(c!==null)for(var A=0;A<c.length;A++){var m=c[A];jn=m,Il(m,l)}Im(l)}for(l=l.child;l!==null;){switch(c=l,c.tag){case 0:case 11:case 15:Ns(8,c,c.return),ul(c);break;case 22:A=c.stateNode,A._visibility&2&&(A._visibility&=-3,ul(c));break;default:ul(c)}l=l.sibling}}function Il(l,c){for(;jn!==null;){var A=jn;switch(A.tag){case 0:case 11:case 15:Ns(8,A,c);break;case 23:case 22:if(A.memoizedState!==null&&A.memoizedState.cachePool!==null){var m=A.memoizedState.cachePool.pool;m!=null&&m.refCount++}break;case 24:Hc(A.memoizedState.cache)}if(m=A.child,m!==null)m.return=A,jn=m;else e:for(A=l;jn!==null;){m=jn;var Z=m.sibling,W=m.return;if(dn(m),m===A){jn=null;break e}if(Z!==null){Z.return=W,jn=Z;break e}jn=W}}}var Wi={getCacheForType:function(l){var c=wi(ji),A=c.data.get(l);return A===void 0&&(A=l(),c.data.set(l,A)),A}},mh=typeof WeakMap=="function"?WeakMap:Map,_n=0,tn=null,mn=null,Lt=0,In=0,Gi=null,Es=!1,qc=!1,$c=!1,fo=0,di=0,_o=0,Cl=0,_g=0,po=0,Vn=0,Un=null,Ut=null,vn=!1,On=0,Ha=1/0,mo=null,Ts=null,ra=0,Xa=null,$n=null,zs=0,lr=0,fI=null,Ls=null,dl=0,Ug=null;function Vi(){if((_n&2)!==0&&Lt!==0)return Lt&-Lt;if(T.T!==null){var l=an;return l!==0?l:dG()}return xt()}function rd(){po===0&&(po=(Lt&536870912)===0||Xn?Ie():536870912);var l=Qn.current;return l!==null&&(l.flags|=32),po}function Ja(l,c,A){(l===tn&&(In===2||In===9)||l.cancelPendingCommit!==null)&&(ig(l,0),Uo(l,Lt,po,!1)),mt(l,A),((_n&2)===0||l!==tn)&&(l===tn&&((_n&2)===0&&(Cl|=A),di===4&&Uo(l,Lt,po,!1)),og(l))}function eu(l,c,A){if((_n&6)!==0)throw Error(n(327));var m=!A&&(c&124)===0&&(c&l.expiredLanes)===0||xe(l,c),Z=m?S(l,c):d(l,c,!0),W=m;do{if(Z===0){qc&&!m&&Uo(l,c,0,!1);break}else{if(A=l.current.alternate,W&&!ng(A)){Z=d(l,c,!1),W=!1;continue}if(Z===2){if(W=c,l.errorRecoveryDisabledLanes&W)var _=0;else _=l.pendingLanes&-536870913,_=_!==0?_:_&536870912?536870912:0;if(_!==0){c=_;e:{var ee=l;Z=Un;var Ae=ee.current.memoizedState.isDehydrated;if(Ae&&(ig(ee,_).flags|=256),_=d(ee,_,!1),_!==2){if($c&&!Ae){ee.errorRecoveryDisabledLanes|=W,Cl|=W,Z=4;break e}W=Ut,Ut=Z,W!==null&&(Ut===null?Ut=W:Ut.push.apply(Ut,W))}Z=_}if(W=!1,Z!==2)continue}}if(Z===1){ig(l,0),Uo(l,c,0,!0);break}e:{switch(m=l,W=Z,W){case 0:case 1:throw Error(n(345));case 4:if((c&4194048)!==c)break;case 6:Uo(m,c,po,!Es);break e;case 2:Ut=null;break;case 3:case 5:break;default:throw Error(n(329))}if((c&62914560)===c&&(Z=On+300-Ee(),10<Z)){if(Uo(m,c,po,!Es),ue(m,0,!0)!==0)break e;m.timeoutHandle=bS(pI.bind(null,m,A,Ut,mo,vn,c,po,Cl,Vn,Es,W,2,-0,0),Z);break e}pI(m,A,Ut,mo,vn,c,po,Cl,Vn,Es,W,0,-0,0)}}break}while(!0);og(l)}function pI(l,c,A,m,Z,W,_,ee,Ae,Fe,ot,It,Ue,Oe){if(l.timeoutHandle=-1,It=c.subtreeFlags,(It&8192||(It&16785408)===16785408)&&(Sh={stylesheets:null,count:0,unsuspend:w9},um(c),It=W9(),It!==null)){l.cancelPendingCommit=It(pt.bind(null,l,c,W,A,m,Z,_,ee,Ae,ot,1,Ue,Oe)),Uo(l,W,_,!Fe);return}pt(l,c,W,A,m,Z,_,ee,Ae)}function ng(l){for(var c=l;;){var A=c.tag;if((A===0||A===11||A===15)&&c.flags&16384&&(A=c.updateQueue,A!==null&&(A=A.stores,A!==null)))for(var m=0;m<A.length;m++){var Z=A[m],W=Z.getSnapshot;Z=Z.value;try{if(!rs(W(),Z))return!1}catch{return!1}}if(A=c.child,c.subtreeFlags&16384&&A!==null)A.return=c,c=A;else{if(c===l)break;for(;c.sibling===null;){if(c.return===null||c.return===l)return!0;c=c.return}c.sibling.return=c.return,c=c.sibling}}return!0}function Uo(l,c,A,m){c&=~_g,c&=~Cl,l.suspendedLanes|=c,l.pingedLanes&=~c,m&&(l.warmLanes|=c),m=l.expirationTimes;for(var Z=c;0<Z;){var W=31-et(Z),_=1<<W;m[W]=-1,Z&=~_}A!==0&&_e(l,A,c)}function Al(){return(_n&6)===0?(bh(0),!1):!0}function Dg(){if(mn!==null){if(In===0)var l=mn.return;else l=mn,Pl=Tr=null,th(l),xg=null,cI=0,l=mn;for(;l!==null;)Jc(l.alternate,l),l=l.return;mn=null}}function ig(l,c){var A=l.timeoutHandle;A!==-1&&(l.timeoutHandle=-1,u9(A)),A=l.cancelPendingCommit,A!==null&&(l.cancelPendingCommit=null,A()),Dg(),tn=l,mn=A=Ti(l.current,null),Lt=c,In=0,Gi=null,Es=!1,qc=xe(l,c),$c=!1,Vn=po=_g=Cl=_o=di=0,Ut=Un=null,vn=!1,(c&8)!==0&&(c|=c&32);var m=l.entangledLanes;if(m!==0)for(l=l.entanglements,m&=c;0<m;){var Z=31-et(m),W=1<<Z;c|=l[Z],m&=~W}return fo=c,Ou(),A}function gd(l,c){sn=null,T.H=gI,c===iI||c===No?(c=QA(),In=3):c===PA?(c=QA(),In=4):In=c===cm?8:c!==null&&typeof c=="object"&&typeof c.then=="function"?6:1,Gi=c,mn===null&&(di=1,ed(l,ya(c,l.current)))}function tu(){var l=T.H;return T.H=gI,l===null?gI:l}function cd(){var l=T.A;return T.A=Wi,l}function I(){di=4,Es||(Lt&4194048)!==Lt&&Qn.current!==null||(qc=!0),(_o&134217727)===0&&(Cl&134217727)===0||tn===null||Uo(tn,Lt,po,!1)}function d(l,c,A){var m=_n;_n|=2;var Z=tu(),W=cd();(tn!==l||Lt!==c)&&(mo=null,ig(l,c)),c=!1;var _=di;e:do try{if(In!==0&&mn!==null){var ee=mn,Ae=Gi;switch(In){case 8:Dg(),_=6;break e;case 3:case 2:case 9:case 6:Qn.current===null&&(c=!0);var Fe=In;if(In=0,Gi=null,he(l,ee,Ae,Fe),A&&qc){_=0;break e}break;default:Fe=In,In=0,Gi=null,he(l,ee,Ae,Fe)}}b(),_=di;break}catch(ot){gd(l,ot)}while(!0);return c&&l.shellSuspendCounter++,Pl=Tr=null,_n=m,T.H=Z,T.A=W,mn===null&&(tn=null,Lt=0,Ou()),_}function b(){for(;mn!==null;)K(mn)}function S(l,c){var A=_n;_n|=2;var m=tu(),Z=cd();tn!==l||Lt!==c?(mo=null,Ha=Ee()+500,ig(l,c)):qc=xe(l,c);e:do try{if(In!==0&&mn!==null){c=mn;var W=Gi;t:switch(In){case 1:In=0,Gi=null,he(l,c,W,1);break;case 2:case 9:if(EC(W)){In=0,Gi=null,te(c);break}c=function(){In!==2&&In!==9||tn!==l||(In=7),og(l)},W.then(c,c);break e;case 3:In=7;break e;case 4:In=5;break e;case 7:EC(W)?(In=0,Gi=null,te(c)):(In=0,Gi=null,he(l,c,W,7));break;case 5:var _=null;switch(mn.tag){case 26:_=mn.memoizedState;case 5:case 27:var ee=mn;if(!_||MS(_)){In=0,Gi=null;var Ae=ee.sibling;if(Ae!==null)mn=Ae;else{var Fe=ee.return;Fe!==null?(mn=Fe,Xe(Fe)):mn=null}break t}}In=0,Gi=null,he(l,c,W,5);break;case 6:In=0,Gi=null,he(l,c,W,6);break;case 8:Dg(),di=6;break e;default:throw Error(n(462))}}V();break}catch(ot){gd(l,ot)}while(!0);return Pl=Tr=null,T.H=m,T.A=Z,_n=A,mn!==null?0:(tn=null,Lt=0,Ou(),di)}function V(){for(;mn!==null&&!De();)K(mn)}function K(l){var c=Yg(l.alternate,l,fo);l.memoizedProps=l.pendingProps,c===null?Xe(l):mn=c}function te(l){var c=l,A=c.alternate;switch(c.tag){case 15:case 0:c=Hs(A,c,c.pendingProps,c.type,void 0,Lt);break;case 11:c=Hs(A,c,c.pendingProps,c.type.render,c.ref,Lt);break;case 5:th(c);default:Jc(A,c),c=mn=LA(c,fo),c=Yg(A,c,fo)}l.memoizedProps=l.pendingProps,c===null?Xe(l):mn=c}function he(l,c,A,m){Pl=Tr=null,th(c),xg=null,cI=0;var Z=c.return;try{if(IG(l,Z,c,A,Lt)){di=1,ed(l,ya(A,l.current)),mn=null;return}}catch(W){if(Z!==null)throw mn=Z,W;di=1,ed(l,ya(A,l.current)),mn=null;return}c.flags&32768?(Xn||m===1?l=!0:qc||(Lt&536870912)!==0?l=!1:(Es=l=!0,(m===2||m===9||m===3||m===6)&&(m=Qn.current,m!==null&&m.tag===13&&(m.flags|=16384))),st(c,l)):Xe(c)}function Xe(l){var c=l;do{if((c.flags&32768)!==0){st(c,Es);return}l=c.return;var A=fh(c.alternate,c,fo);if(A!==null){mn=A;return}if(c=c.sibling,c!==null){mn=c;return}mn=c=l}while(c!==null);di===0&&(di=5)}function st(l,c){do{var A=Oc(l.alternate,l);if(A!==null){A.flags&=32767,mn=A;return}if(A=l.return,A!==null&&(A.flags|=32768,A.subtreeFlags=0,A.deletions=null),!c&&(l=l.sibling,l!==null)){mn=l;return}mn=l=A}while(l!==null);di=6,mn=null}function pt(l,c,A,m,Z,W,_,ee,Ae){l.cancelPendingCommit=null;do ag();while(ra!==0);if((_n&6)!==0)throw Error(n(327));if(c!==null){if(c===l.current)throw Error(n(177));if(W=c.lanes|c.childLanes,W|=WC,it(l,A,W,_,ee,Ae),l===tn&&(mn=tn=null,Lt=0),$n=c,Xa=l,zs=A,lr=W,fI=Z,Ls=m,(c.subtreeFlags&10256)!==0||(c.flags&10256)!==0?(l.callbackNode=null,l.callbackPriority=0,Nn(Ze,function(){return sg(),null})):(l.callbackNode=null,l.callbackPriority=0),m=(c.flags&13878)!==0,(c.subtreeFlags&13878)!==0||m){m=T.T,T.T=null,Z=J.p,J.p=2,_=_n,_n|=4;try{la(l,c,A)}finally{_n=_,J.p=Z,T.T=m}}ra=1,St(),wt(),nn()}}function St(){if(ra===1){ra=0;var l=Xa,c=$n,A=(c.flags&13878)!==0;if((c.subtreeFlags&13878)!==0||A){A=T.T,T.T=null;var m=J.p;J.p=2;var Z=_n;_n|=4;try{ad(c,l);var W=GG,_=NA(l.containerInfo),ee=W.focusedElem,Ae=W.selectionRange;if(_!==ee&&ee&&ee.ownerDocument&&XA(ee.ownerDocument.documentElement,ee)){if(Ae!==null&&Uu(ee)){var Fe=Ae.start,ot=Ae.end;if(ot===void 0&&(ot=Fe),"selectionStart"in ee)ee.selectionStart=Fe,ee.selectionEnd=Math.min(ot,ee.value.length);else{var It=ee.ownerDocument||document,Ue=It&&It.defaultView||window;if(Ue.getSelection){var Oe=Ue.getSelection(),qt=ee.textContent.length,Ot=Math.min(Ae.start,qt),oi=Ae.end===void 0?Ot:Math.min(Ae.end,qt);!Oe.extend&&Ot>oi&&(_=oi,oi=Ot,Ot=_);var He=HA(ee,Ot),Re=HA(ee,oi);if(He&&Re&&(Oe.rangeCount!==1||Oe.anchorNode!==He.node||Oe.anchorOffset!==He.offset||Oe.focusNode!==Re.node||Oe.focusOffset!==Re.offset)){var Ye=It.createRange();Ye.setStart(He.node,He.offset),Oe.removeAllRanges(),Ot>oi?(Oe.addRange(Ye),Oe.extend(Re.node,Re.offset)):(Ye.setEnd(Re.node,Re.offset),Oe.addRange(Ye))}}}}for(It=[],Oe=ee;Oe=Oe.parentNode;)Oe.nodeType===1&&It.push({element:Oe,left:Oe.scrollLeft,top:Oe.scrollTop});for(typeof ee.focus=="function"&&ee.focus(),ee=0;ee<It.length;ee++){var rt=It[ee];rt.element.scrollLeft=rt.left,rt.element.scrollTop=rt.top}}Gm=!!yG,GG=yG=null}finally{_n=Z,J.p=m,T.T=A}}l.current=c,ra=2}}function wt(){if(ra===2){ra=0;var l=Xa,c=$n,A=(c.flags&8772)!==0;if((c.subtreeFlags&8772)!==0||A){A=T.T,T.T=null;var m=J.p;J.p=2;var Z=_n;_n|=4;try{sr(l,c.alternate,c)}finally{_n=Z,J.p=m,T.T=A}}ra=3}}function nn(){if(ra===4||ra===3){ra=0,Ke();var l=Xa,c=$n,A=zs,m=Ls;(c.subtreeFlags&10256)!==0||(c.flags&10256)!==0?ra=5:(ra=0,$n=Xa=null,_s(l,l.pendingLanes));var Z=l.pendingLanes;if(Z===0&&(Ts=null),Bt(A),c=c.stateNode,Ge&&typeof Ge.onCommitFiberRoot=="function")try{Ge.onCommitFiberRoot(Ve,c,void 0,(c.current.flags&128)===128)}catch{}if(m!==null){c=T.T,Z=J.p,J.p=2,T.T=null;try{for(var W=l.onRecoverableError,_=0;_<m.length;_++){var ee=m[_];W(ee.value,{componentStack:ee.stack})}}finally{T.T=c,J.p=Z}}(zs&3)!==0&&ag(),og(l),Z=l.pendingLanes,(A&4194090)!==0&&(Z&42)!==0?l===Ug?dl++:(dl=0,Ug=l):dl=0,bh(0)}}function _s(l,c){(l.pooledCacheLanes&=c)===0&&(c=l.pooledCache,c!=null&&(l.pooledCache=null,Hc(c)))}function ag(l){return St(),wt(),nn(),sg()}function sg(){if(ra!==5)return!1;var l=Xa,c=lr;lr=0;var A=Bt(zs),m=T.T,Z=J.p;try{J.p=32>A?32:A,T.T=null,A=fI,fI=null;var W=Xa,_=zs;if(ra=0,$n=Xa=null,zs=0,(_n&6)!==0)throw Error(n(331));var ee=_n;if(_n|=4,ph(W.current),ld(W,W.current,_,A),_n=ee,bh(0,!1),Ge&&typeof Ge.onPostCommitFiberRoot=="function")try{Ge.onPostCommitFiberRoot(Ve,W)}catch{}return!0}finally{J.p=Z,T.T=m,_s(l,c)}}function Le(l,c,A){c=ya(A,c),c=td(l.stateNode,c,2),l=ql(l,c,2),l!==null&&(mt(l,2),og(l))}function ve(l,c,A){if(l.tag===3)Le(l,l,A);else for(;c!==null;){if(c.tag===3){Le(c,l,A);break}else if(c.tag===1){var m=c.stateNode;if(typeof c.type.getDerivedStateFromError=="function"||typeof m.componentDidCatch=="function"&&(Ts===null||!Ts.has(m))){l=ya(A,l),A=gm(2),m=ql(c,A,2),m!==null&&(nd(A,m,c,l),mt(m,2),og(m));break}}c=c.return}}function Pe(l,c,A){var m=l.pingCache;if(m===null){m=l.pingCache=new mh;var Z=new Set;m.set(c,Z)}else Z=m.get(c),Z===void 0&&(Z=new Set,m.set(c,Z));Z.has(A)||($c=!0,Z.add(A),l=ft.bind(null,l,c,A),c.then(l,l))}function ft(l,c,A){var m=l.pingCache;m!==null&&m.delete(c),l.pingedLanes|=l.suspendedLanes&A,l.warmLanes&=~A,tn===l&&(Lt&A)===A&&(di===4||di===3&&(Lt&62914560)===Lt&&300>Ee()-On?(_n&2)===0&&ig(l,0):_g|=A,Vn===Lt&&(Vn=0)),og(l)}function Kt(l,c){c===0&&(c=Qe()),l=Ol(l,c),l!==null&&(mt(l,c),og(l))}function Ai(l){var c=l.memoizedState,A=0;c!==null&&(A=c.retryLane),Kt(l,A)}function Qt(l,c){var A=0;switch(l.tag){case 13:var m=l.stateNode,Z=l.memoizedState;Z!==null&&(A=Z.retryLane);break;case 19:m=l.stateNode;break;case 22:m=l.stateNode._retryCache;break;default:throw Error(n(314))}m!==null&&m.delete(c),Kt(l,A)}function Nn(l,c){return ut(l,c)}var Ui=null,yn=null,hl=!1,ud=!1,CG=!1,mI=0;function og(l){l!==yn&&l.next===null&&(yn===null?Ui=yn=l:yn=yn.next=l),ud=!0,hl||(hl=!0,n9())}function bh(l,c){if(!CG&&ud){CG=!0;do for(var A=!1,m=Ui;m!==null;){if(l!==0){var Z=m.pendingLanes;if(Z===0)var W=0;else{var _=m.suspendedLanes,ee=m.pingedLanes;W=(1<<31-et(42|l)+1)-1,W&=Z&~(_&~ee),W=W&201326741?W&201326741|1:W?W|2:0}W!==0&&(A=!0,cS(m,W))}else W=Lt,W=ue(m,m===tn?W:0,m.cancelPendingCommit!==null||m.timeoutHandle!==-1),(W&3)===0||xe(m,W)||(A=!0,cS(m,W));m=m.next}while(A);CG=!1}}function t9(){lS()}function lS(){ud=hl=!1;var l=0;mI!==0&&(c9()&&(l=mI),mI=0);for(var c=Ee(),A=null,m=Ui;m!==null;){var Z=m.next,W=rS(m,c);W===0?(m.next=null,A===null?Ui=Z:A.next=Z,Z===null&&(yn=A)):(A=m,(l!==0||(W&3)!==0)&&(ud=!0)),m=Z}bh(l)}function rS(l,c){for(var A=l.suspendedLanes,m=l.pingedLanes,Z=l.expirationTimes,W=l.pendingLanes&-62914561;0<W;){var _=31-et(W),ee=1<<_,Ae=Z[_];Ae===-1?((ee&A)===0||(ee&m)!==0)&&(Z[_]=ct(ee,c)):Ae<=c&&(l.expiredLanes|=ee),W&=~ee}if(c=tn,A=Lt,A=ue(l,l===c?A:0,l.cancelPendingCommit!==null||l.timeoutHandle!==-1),m=l.callbackNode,A===0||l===c&&(In===2||In===9)||l.cancelPendingCommit!==null)return m!==null&&m!==null&&q(m),l.callbackNode=null,l.callbackPriority=0;if((A&3)===0||xe(l,A)){if(c=A&-A,c===l.callbackPriority)return c;switch(m!==null&&q(m),Bt(A)){case 2:case 8:A=Me;break;case 32:A=Ze;break;case 268435456:A=k;break;default:A=Ze}return m=gS.bind(null,l),A=ut(A,m),l.callbackPriority=c,l.callbackNode=A,c}return m!==null&&m!==null&&q(m),l.callbackPriority=2,l.callbackNode=null,2}function gS(l,c){if(ra!==0&&ra!==5)return l.callbackNode=null,l.callbackPriority=0,null;var A=l.callbackNode;if(ag()&&l.callbackNode!==A)return null;var m=Lt;return m=ue(l,l===tn?m:0,l.cancelPendingCommit!==null||l.timeoutHandle!==-1),m===0?null:(eu(l,m,c),rS(l,Ee()),l.callbackNode!=null&&l.callbackNode===A?gS.bind(null,l):null)}function cS(l,c){if(ag())return null;eu(l,c,!0)}function n9(){I9(function(){(_n&6)!==0?ut(Je,t9):lS()})}function dG(){return mI===0&&(mI=Ie()),mI}function uS(l){return l==null||typeof l=="symbol"||typeof l=="boolean"?null:typeof l=="function"?l:$o(""+l)}function IS(l,c){var A=c.ownerDocument.createElement("input");return A.name=c.name,A.value=c.value,l.id&&A.setAttribute("form",l.id),c.parentNode.insertBefore(A,c),l=new FormData(l),A.parentNode.removeChild(A),l}function i9(l,c,A,m,Z){if(c==="submit"&&A&&A.stateNode===Z){var W=uS((Z[Kn]||null).action),_=m.submitter;_&&(c=(c=_[Kn]||null)?uS(c.formAction):_.getAttribute("formAction"),c!==null&&(W=c,_=null));var ee=new za("action","action",null,m,Z);l.push({event:ee,listeners:[{instance:null,listener:function(){if(m.defaultPrevented){if(mI!==0){var Ae=_?IS(Z,_):new FormData(Z);Ch(A,{pending:!0,data:Ae,method:Z.method,action:W},null,Ae)}}else typeof W=="function"&&(ee.preventDefault(),Ae=_?IS(Z,_):new FormData(Z),Ch(A,{pending:!0,data:Ae,method:Z.method,action:W},W,Ae))},currentTarget:Z}]})}}for(var AG=0;AG<ku.length;AG++){var hG=ku[AG],a9=hG.toLowerCase(),s9=hG[0].toUpperCase()+hG.slice(1);ua(a9,"on"+s9)}ua(La,"onAnimationEnd"),ua(FA,"onAnimationIteration"),ua(cs,"onAnimationStart"),ua("dblclick","onDoubleClick"),ua("focusin","onFocus"),ua("focusout","onBlur"),ua(yp,"onTransitionRun"),ua(Dl,"onTransitionStart"),ua(wc,"onTransitionCancel"),ua(kl,"onTransitionEnd"),$("onMouseEnter",["mouseout","mouseover"]),$("onMouseLeave",["mouseout","mouseover"]),$("onPointerEnter",["pointerout","pointerover"]),$("onPointerLeave",["pointerout","pointerover"]),ts("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),ts("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),ts("onBeforeInput",["compositionend","keypress","textInput","paste"]),ts("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),ts("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),ts("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var yh="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),o9=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(yh));function CS(l,c){c=(c&4)!==0;for(var A=0;A<l.length;A++){var m=l[A],Z=m.event;m=m.listeners;e:{var W=void 0;if(c)for(var _=m.length-1;0<=_;_--){var ee=m[_],Ae=ee.instance,Fe=ee.currentTarget;if(ee=ee.listener,Ae!==W&&Z.isPropagationStopped())break e;W=ee,Z.currentTarget=Fe;try{W(Z)}catch(ot){Vg(ot)}Z.currentTarget=null,W=Ae}else for(_=0;_<m.length;_++){if(ee=m[_],Ae=ee.instance,Fe=ee.currentTarget,ee=ee.listener,Ae!==W&&Z.isPropagationStopped())break e;W=ee,Z.currentTarget=Fe;try{W(Z)}catch(ot){Vg(ot)}Z.currentTarget=null,W=Ae}}}}function Sn(l,c){var A=c[hi];A===void 0&&(A=c[hi]=new Set);var m=l+"__bubble";A.has(m)||(dS(c,l,2,!1),A.add(m))}function fG(l,c,A){var m=0;c&&(m|=4),dS(A,l,m,c)}var Cm="_reactListening"+Math.random().toString(36).slice(2);function pG(l){if(!l[Cm]){l[Cm]=!0,qo.forEach(function(A){A!=="selectionchange"&&(o9.has(A)||fG(A,!1,l),fG(A,!0,l))});var c=l.nodeType===9?l:l.ownerDocument;c===null||c[Cm]||(c[Cm]=!0,fG("selectionchange",!1,c))}}function dS(l,c,A,m){switch(FS(c)){case 2:var Z=H9;break;case 8:Z=X9;break;default:Z=MG}A=Z.bind(null,c,A,l),Z=void 0,!Nl||c!=="touchstart"&&c!=="touchmove"&&c!=="wheel"||(Z=!0),m?Z!==void 0?l.addEventListener(c,A,{capture:!0,passive:Z}):l.addEventListener(c,A,!0):Z!==void 0?l.addEventListener(c,A,{passive:Z}):l.addEventListener(c,A,!1)}function mG(l,c,A,m,Z){var W=m;if((c&1)===0&&(c&2)===0&&m!==null)e:for(;;){if(m===null)return;var _=m.tag;if(_===3||_===4){var ee=m.stateNode.containerInfo;if(ee===Z)break;if(_===4)for(_=m.return;_!==null;){var Ae=_.tag;if((Ae===3||Ae===4)&&_.stateNode.containerInfo===Z)return;_=_.return}for(;ee!==null;){if(_=es(ee),_===null)return;if(Ae=_.tag,Ae===5||Ae===6||Ae===26||Ae===27){m=W=_;continue e}ee=ee.parentNode}}m=m.return}yg(function(){var Fe=W,ot=Mo(A),It=[];e:{var Ue=xC.get(l);if(Ue!==void 0){var Oe=za,qt=l;switch(l){case"keypress":if(io(A)===0)break e;case"keydown":case"keyup":Oe=SA;break;case"focusin":qt="focus",Oe=Tl;break;case"focusout":qt="blur",Oe=Tl;break;case"beforeblur":case"afterblur":Oe=Tl;break;case"click":if(A.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":Oe=vg;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":Oe=vA;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":Oe=wA;break;case La:case FA:case cs:Oe=bC;break;case kl:Oe=zl;break;case"scroll":case"scrollend":Oe=vc;break;case"wheel":Oe=nG;break;case"copy":case"cut":case"paste":Oe=os;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":Oe=yC;break;case"toggle":case"beforetoggle":Oe=Wr}var Ot=(c&4)!==0,oi=!Ot&&(l==="scroll"||l==="scrollend"),He=Ot?Ue!==null?Ue+"Capture":null:Ue;Ot=[];for(var Re=Fe,Ye;Re!==null;){var rt=Re;if(Ye=rt.stateNode,rt=rt.tag,rt!==5&&rt!==26&&rt!==27||Ye===null||He===null||(rt=Xl(Re,He),rt!=null&&Ot.push(Gh(Re,rt,Ye))),oi)break;Re=Re.return}0<Ot.length&&(Ue=new Oe(Ue,qt,null,A,ot),It.push({event:Ue,listeners:Ot}))}}if((c&7)===0){e:{if(Ue=l==="mouseover"||l==="pointerover",Oe=l==="mouseout"||l==="pointerout",Ue&&A!==Vo&&(qt=A.relatedTarget||A.fromElement)&&(es(qt)||qt[ui]))break e;if((Oe||Ue)&&(Ue=ot.window===ot?ot:(Ue=ot.ownerDocument)?Ue.defaultView||Ue.parentWindow:window,Oe?(qt=A.relatedTarget||A.toElement,Oe=Fe,qt=qt?es(qt):null,qt!==null&&(oi=s(qt),Ot=qt.tag,qt!==oi||Ot!==5&&Ot!==27&&Ot!==6)&&(qt=null)):(Oe=null,qt=Fe),Oe!==qt)){if(Ot=vg,rt="onMouseLeave",He="onMouseEnter",Re="mouse",(l==="pointerout"||l==="pointerover")&&(Ot=yC,rt="onPointerLeave",He="onPointerEnter",Re="pointer"),oi=Oe==null?Ue:jo(Oe),Ye=qt==null?Ue:jo(qt),Ue=new Ot(rt,Re+"leave",Oe,A,ot),Ue.target=oi,Ue.relatedTarget=Ye,rt=null,es(ot)===Fe&&(Ot=new Ot(He,Re+"enter",qt,A,ot),Ot.target=Ye,Ot.relatedTarget=oi,rt=Ot),oi=rt,Oe&&qt)t:{for(Ot=Oe,He=qt,Re=0,Ye=Ot;Ye;Ye=Id(Ye))Re++;for(Ye=0,rt=He;rt;rt=Id(rt))Ye++;for(;0<Re-Ye;)Ot=Id(Ot),Re--;for(;0<Ye-Re;)He=Id(He),Ye--;for(;Re--;){if(Ot===He||He!==null&&Ot===He.alternate)break t;Ot=Id(Ot),He=Id(He)}Ot=null}else Ot=null;Oe!==null&&AS(It,Ue,Oe,Ot,!1),qt!==null&&oi!==null&&AS(It,oi,qt,Ot,!0)}}e:{if(Ue=Fe?jo(Fe):window,Oe=Ue.nodeName&&Ue.nodeName.toLowerCase(),Oe==="select"||Oe==="input"&&Ue.type==="file")var Mt=BC;else if(MA(Ue))if(vC)Mt=Hr;else{Mt=pp;var Zn=iG}else Oe=Ue.nodeName,!Oe||Oe.toLowerCase()!=="input"||Ue.type!=="checkbox"&&Ue.type!=="radio"?Fe&&wr(Fe.elementType)&&(Mt=BC):Mt=_u;if(Mt&&(Mt=Mt(l,Fe))){ls(It,Mt,A,ot);break e}Zn&&Zn(l,Ue,Fe),l==="focusout"&&Fe&&Ue.type==="number"&&Fe.memoizedProps.value!=null&&Si(Ue,"number",Ue.value)}switch(Zn=Fe?jo(Fe):window,l){case"focusin":(MA(Zn)||Zn.contentEditable==="true")&&(_l=Zn,SC=Fe,Du=null);break;case"focusout":Du=SC=_l=null;break;case"mousedown":RC=!0;break;case"contextmenu":case"mouseup":case"dragend":RC=!1,KA(It,A,ot);break;case"selectionchange":if(YA)break;case"keydown":case"keyup":KA(It,A,ot)}var zt;if(Ku)e:{switch(l){case"compositionstart":var Jt="onCompositionStart";break e;case"compositionend":Jt="onCompositionEnd";break e;case"compositionupdate":Jt="onCompositionUpdate";break e}Jt=void 0}else Mr?Tu(l,A)&&(Jt="onCompositionEnd"):l==="keydown"&&A.keyCode===229&&(Jt="onCompositionStart");Jt&&(Eu&&A.locale!=="ko"&&(Mr||Jt!=="onCompositionStart"?Jt==="onCompositionEnd"&&Mr&&(zt=Bc()):(Fi=ot,Gg="value"in Fi?Fi.value:Fi.textContent,Mr=!0)),Zn=dm(Fe,Jt),0<Zn.length&&(Jt=new ws(Jt,l,null,A,ot),It.push({event:Jt,listeners:Zn}),zt?Jt.data=zt:(zt=WA(A),zt!==null&&(Jt.data=zt)))),(zt=Fu?zu(l,A):VA(l,A))&&(Jt=dm(Fe,"onBeforeInput"),0<Jt.length&&(Zn=new ws("onBeforeInput","beforeinput",null,A,ot),It.push({event:Zn,listeners:Jt}),Zn.data=zt)),i9(It,l,Fe,A,ot)}CS(It,c)})}function Gh(l,c,A){return{instance:l,listener:c,currentTarget:A}}function dm(l,c){for(var A=c+"Capture",m=[];l!==null;){var Z=l,W=Z.stateNode;if(Z=Z.tag,Z!==5&&Z!==26&&Z!==27||W===null||(Z=Xl(l,A),Z!=null&&m.unshift(Gh(l,Z,W)),Z=Xl(l,c),Z!=null&&m.push(Gh(l,Z,W))),l.tag===3)return m;l=l.return}return[]}function Id(l){if(l===null)return null;do l=l.return;while(l&&l.tag!==5&&l.tag!==27);return l||null}function AS(l,c,A,m,Z){for(var W=c._reactName,_=[];A!==null&&A!==m;){var ee=A,Ae=ee.alternate,Fe=ee.stateNode;if(ee=ee.tag,Ae!==null&&Ae===m)break;ee!==5&&ee!==26&&ee!==27||Fe===null||(Ae=Fe,Z?(Fe=Xl(A,W),Fe!=null&&_.unshift(Gh(A,Fe,Ae))):Z||(Fe=Xl(A,W),Fe!=null&&_.push(Gh(A,Fe,Ae)))),A=A.return}_.length!==0&&l.push({event:c,listeners:_})}var l9=/\r\n?/g,r9=/\u0000|\uFFFD/g;function hS(l){return(typeof l=="string"?l:""+l).replace(l9,`
`).replace(r9,"")}function fS(l,c){return c=hS(c),hS(l)===c}function Am(){}function si(l,c,A,m,Z,W){switch(A){case"children":typeof m=="string"?c==="body"||c==="textarea"&&m===""||Pi(l,m):(typeof m=="number"||typeof m=="bigint")&&c!=="body"&&Pi(l,""+m);break;case"className":bt(l,"class",m);break;case"tabIndex":bt(l,"tabindex",m);break;case"dir":case"role":case"viewBox":case"width":case"height":bt(l,A,m);break;case"style":Rr(l,m,W);break;case"data":if(c!=="object"){bt(l,"data",m);break}case"src":case"href":if(m===""&&(c!=="a"||A!=="href")){l.removeAttribute(A);break}if(m==null||typeof m=="function"||typeof m=="symbol"||typeof m=="boolean"){l.removeAttribute(A);break}m=$o(""+m),l.setAttribute(A,m);break;case"action":case"formAction":if(typeof m=="function"){l.setAttribute(A,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof W=="function"&&(A==="formAction"?(c!=="input"&&si(l,c,"name",Z.name,Z,null),si(l,c,"formEncType",Z.formEncType,Z,null),si(l,c,"formMethod",Z.formMethod,Z,null),si(l,c,"formTarget",Z.formTarget,Z,null)):(si(l,c,"encType",Z.encType,Z,null),si(l,c,"method",Z.method,Z,null),si(l,c,"target",Z.target,Z,null)));if(m==null||typeof m=="symbol"||typeof m=="boolean"){l.removeAttribute(A);break}m=$o(""+m),l.setAttribute(A,m);break;case"onClick":m!=null&&(l.onclick=Am);break;case"onScroll":m!=null&&Sn("scroll",l);break;case"onScrollEnd":m!=null&&Sn("scrollend",l);break;case"dangerouslySetInnerHTML":if(m!=null){if(typeof m!="object"||!("__html"in m))throw Error(n(61));if(A=m.__html,A!=null){if(Z.children!=null)throw Error(n(60));l.innerHTML=A}}break;case"multiple":l.multiple=m&&typeof m!="function"&&typeof m!="symbol";break;case"muted":l.muted=m&&typeof m!="function"&&typeof m!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(m==null||typeof m=="function"||typeof m=="boolean"||typeof m=="symbol"){l.removeAttribute("xlink:href");break}A=$o(""+m),l.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",A);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":m!=null&&typeof m!="function"&&typeof m!="symbol"?l.setAttribute(A,""+m):l.removeAttribute(A);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":m&&typeof m!="function"&&typeof m!="symbol"?l.setAttribute(A,""):l.removeAttribute(A);break;case"capture":case"download":m===!0?l.setAttribute(A,""):m!==!1&&m!=null&&typeof m!="function"&&typeof m!="symbol"?l.setAttribute(A,m):l.removeAttribute(A);break;case"cols":case"rows":case"size":case"span":m!=null&&typeof m!="function"&&typeof m!="symbol"&&!isNaN(m)&&1<=m?l.setAttribute(A,m):l.removeAttribute(A);break;case"rowSpan":case"start":m==null||typeof m=="function"||typeof m=="symbol"||isNaN(m)?l.removeAttribute(A):l.setAttribute(A,m);break;case"popover":Sn("beforetoggle",l),Sn("toggle",l),dt(l,"popover",m);break;case"xlinkActuate":vt(l,"http://www.w3.org/1999/xlink","xlink:actuate",m);break;case"xlinkArcrole":vt(l,"http://www.w3.org/1999/xlink","xlink:arcrole",m);break;case"xlinkRole":vt(l,"http://www.w3.org/1999/xlink","xlink:role",m);break;case"xlinkShow":vt(l,"http://www.w3.org/1999/xlink","xlink:show",m);break;case"xlinkTitle":vt(l,"http://www.w3.org/1999/xlink","xlink:title",m);break;case"xlinkType":vt(l,"http://www.w3.org/1999/xlink","xlink:type",m);break;case"xmlBase":vt(l,"http://www.w3.org/XML/1998/namespace","xml:base",m);break;case"xmlLang":vt(l,"http://www.w3.org/XML/1998/namespace","xml:lang",m);break;case"xmlSpace":vt(l,"http://www.w3.org/XML/1998/namespace","xml:space",m);break;case"is":dt(l,"is",m);break;case"innerText":case"textContent":break;default:(!(2<A.length)||A[0]!=="o"&&A[0]!=="O"||A[1]!=="n"&&A[1]!=="N")&&(A=Vl.get(A)||A,dt(l,A,m))}}function bG(l,c,A,m,Z,W){switch(A){case"style":Rr(l,m,W);break;case"dangerouslySetInnerHTML":if(m!=null){if(typeof m!="object"||!("__html"in m))throw Error(n(61));if(A=m.__html,A!=null){if(Z.children!=null)throw Error(n(60));l.innerHTML=A}}break;case"children":typeof m=="string"?Pi(l,m):(typeof m=="number"||typeof m=="bigint")&&Pi(l,""+m);break;case"onScroll":m!=null&&Sn("scroll",l);break;case"onScrollEnd":m!=null&&Sn("scrollend",l);break;case"onClick":m!=null&&(l.onclick=Am);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!Zr.hasOwnProperty(A))e:{if(A[0]==="o"&&A[1]==="n"&&(Z=A.endsWith("Capture"),c=A.slice(2,Z?A.length-7:void 0),W=l[Kn]||null,W=W!=null?W[A]:null,typeof W=="function"&&l.removeEventListener(c,W,Z),typeof m=="function")){typeof W!="function"&&W!==null&&(A in l?l[A]=null:l.hasAttribute(A)&&l.removeAttribute(A)),l.addEventListener(c,m,Z);break e}A in l?l[A]=m:m===!0?l.setAttribute(A,""):dt(l,A,m)}}}function Pa(l,c,A){switch(c){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":Sn("error",l),Sn("load",l);var m=!1,Z=!1,W;for(W in A)if(A.hasOwnProperty(W)){var _=A[W];if(_!=null)switch(W){case"src":m=!0;break;case"srcSet":Z=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(n(137,c));default:si(l,c,W,_,A,null)}}Z&&si(l,c,"srcSet",A.srcSet,A,null),m&&si(l,c,"src",A.src,A,null);return;case"input":Sn("invalid",l);var ee=W=_=Z=null,Ae=null,Fe=null;for(m in A)if(A.hasOwnProperty(m)){var ot=A[m];if(ot!=null)switch(m){case"name":Z=ot;break;case"type":_=ot;break;case"checked":Ae=ot;break;case"defaultChecked":Fe=ot;break;case"value":W=ot;break;case"defaultValue":ee=ot;break;case"children":case"dangerouslySetInnerHTML":if(ot!=null)throw Error(n(137,c));break;default:si(l,c,m,ot,A,null)}}zn(l,W,ee,Ae,Fe,_,Z,!1),Pn(l);return;case"select":Sn("invalid",l),m=_=W=null;for(Z in A)if(A.hasOwnProperty(Z)&&(ee=A[Z],ee!=null))switch(Z){case"value":W=ee;break;case"defaultValue":_=ee;break;case"multiple":m=ee;default:si(l,c,Z,ee,A,null)}c=W,A=_,l.multiple=!!m,c!=null?ti(l,!!m,c,!1):A!=null&&ti(l,!!m,A,!0);return;case"textarea":Sn("invalid",l),W=Z=m=null;for(_ in A)if(A.hasOwnProperty(_)&&(ee=A[_],ee!=null))switch(_){case"value":m=ee;break;case"defaultValue":Z=ee;break;case"children":W=ee;break;case"dangerouslySetInnerHTML":if(ee!=null)throw Error(n(91));break;default:si(l,c,_,ee,A,null)}bi(l,m,Z,W),Pn(l);return;case"option":for(Ae in A)if(A.hasOwnProperty(Ae)&&(m=A[Ae],m!=null))switch(Ae){case"selected":l.selected=m&&typeof m!="function"&&typeof m!="symbol";break;default:si(l,c,Ae,m,A,null)}return;case"dialog":Sn("beforetoggle",l),Sn("toggle",l),Sn("cancel",l),Sn("close",l);break;case"iframe":case"object":Sn("load",l);break;case"video":case"audio":for(m=0;m<yh.length;m++)Sn(yh[m],l);break;case"image":Sn("error",l),Sn("load",l);break;case"details":Sn("toggle",l);break;case"embed":case"source":case"link":Sn("error",l),Sn("load",l);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(Fe in A)if(A.hasOwnProperty(Fe)&&(m=A[Fe],m!=null))switch(Fe){case"children":case"dangerouslySetInnerHTML":throw Error(n(137,c));default:si(l,c,Fe,m,A,null)}return;default:if(wr(c)){for(ot in A)A.hasOwnProperty(ot)&&(m=A[ot],m!==void 0&&bG(l,c,ot,m,A,void 0));return}}for(ee in A)A.hasOwnProperty(ee)&&(m=A[ee],m!=null&&si(l,c,ee,m,A,null))}function g9(l,c,A,m){switch(c){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var Z=null,W=null,_=null,ee=null,Ae=null,Fe=null,ot=null;for(Oe in A){var It=A[Oe];if(A.hasOwnProperty(Oe)&&It!=null)switch(Oe){case"checked":break;case"value":break;case"defaultValue":Ae=It;default:m.hasOwnProperty(Oe)||si(l,c,Oe,null,m,It)}}for(var Ue in m){var Oe=m[Ue];if(It=A[Ue],m.hasOwnProperty(Ue)&&(Oe!=null||It!=null))switch(Ue){case"type":W=Oe;break;case"name":Z=Oe;break;case"checked":Fe=Oe;break;case"defaultChecked":ot=Oe;break;case"value":_=Oe;break;case"defaultValue":ee=Oe;break;case"children":case"dangerouslySetInnerHTML":if(Oe!=null)throw Error(n(137,c));break;default:Oe!==It&&si(l,c,Ue,Oe,m,It)}}Yi(l,_,ee,Ae,Fe,ot,W,Z);return;case"select":Oe=_=ee=Ue=null;for(W in A)if(Ae=A[W],A.hasOwnProperty(W)&&Ae!=null)switch(W){case"value":break;case"multiple":Oe=Ae;default:m.hasOwnProperty(W)||si(l,c,W,null,m,Ae)}for(Z in m)if(W=m[Z],Ae=A[Z],m.hasOwnProperty(Z)&&(W!=null||Ae!=null))switch(Z){case"value":Ue=W;break;case"defaultValue":ee=W;break;case"multiple":_=W;default:W!==Ae&&si(l,c,Z,W,m,Ae)}c=ee,A=_,m=Oe,Ue!=null?ti(l,!!A,Ue,!1):!!m!=!!A&&(c!=null?ti(l,!!A,c,!0):ti(l,!!A,A?[]:"",!1));return;case"textarea":Oe=Ue=null;for(ee in A)if(Z=A[ee],A.hasOwnProperty(ee)&&Z!=null&&!m.hasOwnProperty(ee))switch(ee){case"value":break;case"children":break;default:si(l,c,ee,null,m,Z)}for(_ in m)if(Z=m[_],W=A[_],m.hasOwnProperty(_)&&(Z!=null||W!=null))switch(_){case"value":Ue=Z;break;case"defaultValue":Oe=Z;break;case"children":break;case"dangerouslySetInnerHTML":if(Z!=null)throw Error(n(91));break;default:Z!==W&&si(l,c,_,Z,m,W)}Ki(l,Ue,Oe);return;case"option":for(var qt in A)if(Ue=A[qt],A.hasOwnProperty(qt)&&Ue!=null&&!m.hasOwnProperty(qt))switch(qt){case"selected":l.selected=!1;break;default:si(l,c,qt,null,m,Ue)}for(Ae in m)if(Ue=m[Ae],Oe=A[Ae],m.hasOwnProperty(Ae)&&Ue!==Oe&&(Ue!=null||Oe!=null))switch(Ae){case"selected":l.selected=Ue&&typeof Ue!="function"&&typeof Ue!="symbol";break;default:si(l,c,Ae,Ue,m,Oe)}return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var Ot in A)Ue=A[Ot],A.hasOwnProperty(Ot)&&Ue!=null&&!m.hasOwnProperty(Ot)&&si(l,c,Ot,null,m,Ue);for(Fe in m)if(Ue=m[Fe],Oe=A[Fe],m.hasOwnProperty(Fe)&&Ue!==Oe&&(Ue!=null||Oe!=null))switch(Fe){case"children":case"dangerouslySetInnerHTML":if(Ue!=null)throw Error(n(137,c));break;default:si(l,c,Fe,Ue,m,Oe)}return;default:if(wr(c)){for(var oi in A)Ue=A[oi],A.hasOwnProperty(oi)&&Ue!==void 0&&!m.hasOwnProperty(oi)&&bG(l,c,oi,void 0,m,Ue);for(ot in m)Ue=m[ot],Oe=A[ot],!m.hasOwnProperty(ot)||Ue===Oe||Ue===void 0&&Oe===void 0||bG(l,c,ot,Ue,m,Oe);return}}for(var He in A)Ue=A[He],A.hasOwnProperty(He)&&Ue!=null&&!m.hasOwnProperty(He)&&si(l,c,He,null,m,Ue);for(It in m)Ue=m[It],Oe=A[It],!m.hasOwnProperty(It)||Ue===Oe||Ue==null&&Oe==null||si(l,c,It,Ue,m,Oe)}var yG=null,GG=null;function hm(l){return l.nodeType===9?l:l.ownerDocument}function pS(l){switch(l){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function mS(l,c){if(l===0)switch(c){case"svg":return 1;case"math":return 2;default:return 0}return l===1&&c==="foreignObject"?0:l}function BG(l,c){return l==="textarea"||l==="noscript"||typeof c.children=="string"||typeof c.children=="number"||typeof c.children=="bigint"||typeof c.dangerouslySetInnerHTML=="object"&&c.dangerouslySetInnerHTML!==null&&c.dangerouslySetInnerHTML.__html!=null}var vG=null;function c9(){var l=window.event;return l&&l.type==="popstate"?l===vG?!1:(vG=l,!0):(vG=null,!1)}var bS=typeof setTimeout=="function"?setTimeout:void 0,u9=typeof clearTimeout=="function"?clearTimeout:void 0,yS=typeof Promise=="function"?Promise:void 0,I9=typeof queueMicrotask=="function"?queueMicrotask:typeof yS<"u"?function(l){return yS.resolve(null).then(l).catch(C9)}:bS;function C9(l){setTimeout(function(){throw l})}function nu(l){return l==="head"}function GS(l,c){var A=c,m=0,Z=0;do{var W=A.nextSibling;if(l.removeChild(A),W&&W.nodeType===8)if(A=W.data,A==="/$"){if(0<m&&8>m){A=m;var _=l.ownerDocument;if(A&1&&Bh(_.documentElement),A&2&&Bh(_.body),A&4)for(A=_.head,Bh(A),_=A.firstChild;_;){var ee=_.nextSibling,Ae=_.nodeName;_[Jn]||Ae==="SCRIPT"||Ae==="STYLE"||Ae==="LINK"&&_.rel.toLowerCase()==="stylesheet"||A.removeChild(_),_=ee}}if(Z===0){l.removeChild(W),Vh(c);return}Z--}else A==="$"||A==="$?"||A==="$!"?Z++:m=A.charCodeAt(0)-48;else m=0;A=W}while(A);Vh(c)}function ZG(l){var c=l.firstChild;for(c&&c.nodeType===10&&(c=c.nextSibling);c;){var A=c;switch(c=c.nextSibling,A.nodeName){case"HTML":case"HEAD":case"BODY":ZG(A),Bn(A);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(A.rel.toLowerCase()==="stylesheet")continue}l.removeChild(A)}}function d9(l,c,A,m){for(;l.nodeType===1;){var Z=A;if(l.nodeName.toLowerCase()!==c.toLowerCase()){if(!m&&(l.nodeName!=="INPUT"||l.type!=="hidden"))break}else if(m){if(!l[Jn])switch(c){case"meta":if(!l.hasAttribute("itemprop"))break;return l;case"link":if(W=l.getAttribute("rel"),W==="stylesheet"&&l.hasAttribute("data-precedence"))break;if(W!==Z.rel||l.getAttribute("href")!==(Z.href==null||Z.href===""?null:Z.href)||l.getAttribute("crossorigin")!==(Z.crossOrigin==null?null:Z.crossOrigin)||l.getAttribute("title")!==(Z.title==null?null:Z.title))break;return l;case"style":if(l.hasAttribute("data-precedence"))break;return l;case"script":if(W=l.getAttribute("src"),(W!==(Z.src==null?null:Z.src)||l.getAttribute("type")!==(Z.type==null?null:Z.type)||l.getAttribute("crossorigin")!==(Z.crossOrigin==null?null:Z.crossOrigin))&&W&&l.hasAttribute("async")&&!l.hasAttribute("itemprop"))break;return l;default:return l}}else if(c==="input"&&l.type==="hidden"){var W=Z.name==null?null:""+Z.name;if(Z.type==="hidden"&&l.getAttribute("name")===W)return l}else return l;if(l=rr(l.nextSibling),l===null)break}return null}function A9(l,c,A){if(c==="")return null;for(;l.nodeType!==3;)if((l.nodeType!==1||l.nodeName!=="INPUT"||l.type!=="hidden")&&!A||(l=rr(l.nextSibling),l===null))return null;return l}function SG(l){return l.data==="$!"||l.data==="$?"&&l.ownerDocument.readyState==="complete"}function h9(l,c){var A=l.ownerDocument;if(l.data!=="$?"||A.readyState==="complete")c();else{var m=function(){c(),A.removeEventListener("DOMContentLoaded",m)};A.addEventListener("DOMContentLoaded",m),l._reactRetry=m}}function rr(l){for(;l!=null;l=l.nextSibling){var c=l.nodeType;if(c===1||c===3)break;if(c===8){if(c=l.data,c==="$"||c==="$!"||c==="$?"||c==="F!"||c==="F")break;if(c==="/$")return null}}return l}var RG=null;function BS(l){l=l.previousSibling;for(var c=0;l;){if(l.nodeType===8){var A=l.data;if(A==="$"||A==="$!"||A==="$?"){if(c===0)return l;c--}else A==="/$"&&c++}l=l.previousSibling}return null}function vS(l,c,A){switch(c=hm(A),l){case"html":if(l=c.documentElement,!l)throw Error(n(452));return l;case"head":if(l=c.head,!l)throw Error(n(453));return l;case"body":if(l=c.body,!l)throw Error(n(454));return l;default:throw Error(n(451))}}function Bh(l){for(var c=l.attributes;c.length;)l.removeAttributeNode(c[0]);Bn(l)}var fl=new Map,ZS=new Set;function fm(l){return typeof l.getRootNode=="function"?l.getRootNode():l.nodeType===9?l:l.ownerDocument}var kg=J.d;J.d={f:f9,r:p9,D:m9,C:b9,L:y9,m:G9,X:v9,S:B9,M:Z9};function f9(){var l=kg.f(),c=Al();return l||c}function p9(l){var c=Ea(l);c!==null&&c.tag===5&&c.type==="form"?Qp(c):kg.r(l)}var Cd=typeof document>"u"?null:document;function SS(l,c,A){var m=Cd;if(m&&typeof c=="string"&&c){var Z=Fn(c);Z='link[rel="'+l+'"][href="'+Z+'"]',typeof A=="string"&&(Z+='[crossorigin="'+A+'"]'),ZS.has(Z)||(ZS.add(Z),l={rel:l,crossOrigin:A,href:c},m.querySelector(Z)===null&&(c=m.createElement("link"),Pa(c,"link",l),Ci(c),m.head.appendChild(c)))}}function m9(l){kg.D(l),SS("dns-prefetch",l,null)}function b9(l,c){kg.C(l,c),SS("preconnect",l,c)}function y9(l,c,A){kg.L(l,c,A);var m=Cd;if(m&&l&&c){var Z='link[rel="preload"][as="'+Fn(c)+'"]';c==="image"&&A&&A.imageSrcSet?(Z+='[imagesrcset="'+Fn(A.imageSrcSet)+'"]',typeof A.imageSizes=="string"&&(Z+='[imagesizes="'+Fn(A.imageSizes)+'"]')):Z+='[href="'+Fn(l)+'"]';var W=Z;switch(c){case"style":W=dd(l);break;case"script":W=Ad(l)}fl.has(W)||(l=C({rel:"preload",href:c==="image"&&A&&A.imageSrcSet?void 0:l,as:c},A),fl.set(W,l),m.querySelector(Z)!==null||c==="style"&&m.querySelector(vh(W))||c==="script"&&m.querySelector(Zh(W))||(c=m.createElement("link"),Pa(c,"link",l),Ci(c),m.head.appendChild(c)))}}function G9(l,c){kg.m(l,c);var A=Cd;if(A&&l){var m=c&&typeof c.as=="string"?c.as:"script",Z='link[rel="modulepreload"][as="'+Fn(m)+'"][href="'+Fn(l)+'"]',W=Z;switch(m){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":W=Ad(l)}if(!fl.has(W)&&(l=C({rel:"modulepreload",href:l},c),fl.set(W,l),A.querySelector(Z)===null)){switch(m){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(A.querySelector(Zh(W)))return}m=A.createElement("link"),Pa(m,"link",l),Ci(m),A.head.appendChild(m)}}}function B9(l,c,A){kg.S(l,c,A);var m=Cd;if(m&&l){var Z=no(m).hoistableStyles,W=dd(l);c=c||"default";var _=Z.get(W);if(!_){var ee={loading:0,preload:null};if(_=m.querySelector(vh(W)))ee.loading=5;else{l=C({rel:"stylesheet",href:l,"data-precedence":c},A),(A=fl.get(W))&&wG(l,A);var Ae=_=m.createElement("link");Ci(Ae),Pa(Ae,"link",l),Ae._p=new Promise(function(Fe,ot){Ae.onload=Fe,Ae.onerror=ot}),Ae.addEventListener("load",function(){ee.loading|=1}),Ae.addEventListener("error",function(){ee.loading|=2}),ee.loading|=4,pm(_,c,m)}_={type:"stylesheet",instance:_,count:1,state:ee},Z.set(W,_)}}}function v9(l,c){kg.X(l,c);var A=Cd;if(A&&l){var m=no(A).hoistableScripts,Z=Ad(l),W=m.get(Z);W||(W=A.querySelector(Zh(Z)),W||(l=C({src:l,async:!0},c),(c=fl.get(Z))&&xG(l,c),W=A.createElement("script"),Ci(W),Pa(W,"link",l),A.head.appendChild(W)),W={type:"script",instance:W,count:1,state:null},m.set(Z,W))}}function Z9(l,c){kg.M(l,c);var A=Cd;if(A&&l){var m=no(A).hoistableScripts,Z=Ad(l),W=m.get(Z);W||(W=A.querySelector(Zh(Z)),W||(l=C({src:l,async:!0,type:"module"},c),(c=fl.get(Z))&&xG(l,c),W=A.createElement("script"),Ci(W),Pa(W,"link",l),A.head.appendChild(W)),W={type:"script",instance:W,count:1,state:null},m.set(Z,W))}}function RS(l,c,A,m){var Z=(Z=pe.current)?fm(Z):null;if(!Z)throw Error(n(446));switch(l){case"meta":case"title":return null;case"style":return typeof A.precedence=="string"&&typeof A.href=="string"?(c=dd(A.href),A=no(Z).hoistableStyles,m=A.get(c),m||(m={type:"style",instance:null,count:0,state:null},A.set(c,m)),m):{type:"void",instance:null,count:0,state:null};case"link":if(A.rel==="stylesheet"&&typeof A.href=="string"&&typeof A.precedence=="string"){l=dd(A.href);var W=no(Z).hoistableStyles,_=W.get(l);if(_||(Z=Z.ownerDocument||Z,_={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},W.set(l,_),(W=Z.querySelector(vh(l)))&&!W._p&&(_.instance=W,_.state.loading=5),fl.has(l)||(A={rel:"preload",as:"style",href:A.href,crossOrigin:A.crossOrigin,integrity:A.integrity,media:A.media,hrefLang:A.hrefLang,referrerPolicy:A.referrerPolicy},fl.set(l,A),W||S9(Z,l,A,_.state))),c&&m===null)throw Error(n(528,""));return _}if(c&&m!==null)throw Error(n(529,""));return null;case"script":return c=A.async,A=A.src,typeof A=="string"&&c&&typeof c!="function"&&typeof c!="symbol"?(c=Ad(A),A=no(Z).hoistableScripts,m=A.get(c),m||(m={type:"script",instance:null,count:0,state:null},A.set(c,m)),m):{type:"void",instance:null,count:0,state:null};default:throw Error(n(444,l))}}function dd(l){return'href="'+Fn(l)+'"'}function vh(l){return'link[rel="stylesheet"]['+l+"]"}function wS(l){return C({},l,{"data-precedence":l.precedence,precedence:null})}function S9(l,c,A,m){l.querySelector('link[rel="preload"][as="style"]['+c+"]")?m.loading=1:(c=l.createElement("link"),m.preload=c,c.addEventListener("load",function(){return m.loading|=1}),c.addEventListener("error",function(){return m.loading|=2}),Pa(c,"link",A),Ci(c),l.head.appendChild(c))}function Ad(l){return'[src="'+Fn(l)+'"]'}function Zh(l){return"script[async]"+l}function xS(l,c,A){if(c.count++,c.instance===null)switch(c.type){case"style":var m=l.querySelector('style[data-href~="'+Fn(A.href)+'"]');if(m)return c.instance=m,Ci(m),m;var Z=C({},A,{"data-href":A.href,"data-precedence":A.precedence,href:null,precedence:null});return m=(l.ownerDocument||l).createElement("style"),Ci(m),Pa(m,"style",Z),pm(m,A.precedence,l),c.instance=m;case"stylesheet":Z=dd(A.href);var W=l.querySelector(vh(Z));if(W)return c.state.loading|=4,c.instance=W,Ci(W),W;m=wS(A),(Z=fl.get(Z))&&wG(m,Z),W=(l.ownerDocument||l).createElement("link"),Ci(W);var _=W;return _._p=new Promise(function(ee,Ae){_.onload=ee,_.onerror=Ae}),Pa(W,"link",m),c.state.loading|=4,pm(W,A.precedence,l),c.instance=W;case"script":return W=Ad(A.src),(Z=l.querySelector(Zh(W)))?(c.instance=Z,Ci(Z),Z):(m=A,(Z=fl.get(W))&&(m=C({},A),xG(m,Z)),l=l.ownerDocument||l,Z=l.createElement("script"),Ci(Z),Pa(Z,"link",m),l.head.appendChild(Z),c.instance=Z);case"void":return null;default:throw Error(n(443,c.type))}else c.type==="stylesheet"&&(c.state.loading&4)===0&&(m=c.instance,c.state.loading|=4,pm(m,A.precedence,l));return c.instance}function pm(l,c,A){for(var m=A.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),Z=m.length?m[m.length-1]:null,W=Z,_=0;_<m.length;_++){var ee=m[_];if(ee.dataset.precedence===c)W=ee;else if(W!==Z)break}W?W.parentNode.insertBefore(l,W.nextSibling):(c=A.nodeType===9?A.head:A,c.insertBefore(l,c.firstChild))}function wG(l,c){l.crossOrigin==null&&(l.crossOrigin=c.crossOrigin),l.referrerPolicy==null&&(l.referrerPolicy=c.referrerPolicy),l.title==null&&(l.title=c.title)}function xG(l,c){l.crossOrigin==null&&(l.crossOrigin=c.crossOrigin),l.referrerPolicy==null&&(l.referrerPolicy=c.referrerPolicy),l.integrity==null&&(l.integrity=c.integrity)}var mm=null;function WS(l,c,A){if(mm===null){var m=new Map,Z=mm=new Map;Z.set(A,m)}else Z=mm,m=Z.get(A),m||(m=new Map,Z.set(A,m));if(m.has(l))return m;for(m.set(l,null),A=A.getElementsByTagName(l),Z=0;Z<A.length;Z++){var W=A[Z];if(!(W[Jn]||W[Cn]||l==="link"&&W.getAttribute("rel")==="stylesheet")&&W.namespaceURI!=="http://www.w3.org/2000/svg"){var _=W.getAttribute(c)||"";_=l+_;var ee=m.get(_);ee?ee.push(W):m.set(_,[W])}}return m}function VS(l,c,A){l=l.ownerDocument||l,l.head.insertBefore(A,c==="title"?l.querySelector("head > title"):null)}function R9(l,c,A){if(A===1||c.itemProp!=null)return!1;switch(l){case"meta":case"title":return!0;case"style":if(typeof c.precedence!="string"||typeof c.href!="string"||c.href==="")break;return!0;case"link":if(typeof c.rel!="string"||typeof c.href!="string"||c.href===""||c.onLoad||c.onError)break;switch(c.rel){case"stylesheet":return l=c.disabled,typeof c.precedence=="string"&&l==null;default:return!0}case"script":if(c.async&&typeof c.async!="function"&&typeof c.async!="symbol"&&!c.onLoad&&!c.onError&&c.src&&typeof c.src=="string")return!0}return!1}function MS(l){return!(l.type==="stylesheet"&&(l.state.loading&3)===0)}var Sh=null;function w9(){}function x9(l,c,A){if(Sh===null)throw Error(n(475));var m=Sh;if(c.type==="stylesheet"&&(typeof A.media!="string"||matchMedia(A.media).matches!==!1)&&(c.state.loading&4)===0){if(c.instance===null){var Z=dd(A.href),W=l.querySelector(vh(Z));if(W){l=W._p,l!==null&&typeof l=="object"&&typeof l.then=="function"&&(m.count++,m=bm.bind(m),l.then(m,m)),c.state.loading|=4,c.instance=W,Ci(W);return}W=l.ownerDocument||l,A=wS(A),(Z=fl.get(Z))&&wG(A,Z),W=W.createElement("link"),Ci(W);var _=W;_._p=new Promise(function(ee,Ae){_.onload=ee,_.onerror=Ae}),Pa(W,"link",A),c.instance=W}m.stylesheets===null&&(m.stylesheets=new Map),m.stylesheets.set(c,l),(l=c.state.preload)&&(c.state.loading&3)===0&&(m.count++,c=bm.bind(m),l.addEventListener("load",c),l.addEventListener("error",c))}}function W9(){if(Sh===null)throw Error(n(475));var l=Sh;return l.stylesheets&&l.count===0&&WG(l,l.stylesheets),0<l.count?function(c){var A=setTimeout(function(){if(l.stylesheets&&WG(l,l.stylesheets),l.unsuspend){var m=l.unsuspend;l.unsuspend=null,m()}},6e4);return l.unsuspend=c,function(){l.unsuspend=null,clearTimeout(A)}}:null}function bm(){if(this.count--,this.count===0){if(this.stylesheets)WG(this,this.stylesheets);else if(this.unsuspend){var l=this.unsuspend;this.unsuspend=null,l()}}}var ym=null;function WG(l,c){l.stylesheets=null,l.unsuspend!==null&&(l.count++,ym=new Map,c.forEach(V9,l),ym=null,bm.call(l))}function V9(l,c){if(!(c.state.loading&4)){var A=ym.get(l);if(A)var m=A.get(null);else{A=new Map,ym.set(l,A);for(var Z=l.querySelectorAll("link[data-precedence],style[data-precedence]"),W=0;W<Z.length;W++){var _=Z[W];(_.nodeName==="LINK"||_.getAttribute("media")!=="not all")&&(A.set(_.dataset.precedence,_),m=_)}m&&A.set(null,m)}Z=c.instance,_=Z.getAttribute("data-precedence"),W=A.get(_)||m,W===m&&A.set(null,Z),A.set(_,Z),this.count++,m=bm.bind(this),Z.addEventListener("load",m),Z.addEventListener("error",m),W?W.parentNode.insertBefore(Z,W.nextSibling):(l=l.nodeType===9?l.head:l,l.insertBefore(Z,l.firstChild)),c.state.loading|=4}}var Rh={$$typeof:x,Provider:null,Consumer:null,_currentValue:Q,_currentValue2:Q,_threadCount:0};function M9(l,c,A,m,Z,W,_,ee){this.tag=1,this.containerInfo=l,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=je(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=je(0),this.hiddenUpdates=je(null),this.identifierPrefix=m,this.onUncaughtError=Z,this.onCaughtError=W,this.onRecoverableError=_,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=ee,this.incompleteTransitions=new Map}function HS(l,c,A,m,Z,W,_,ee,Ae,Fe,ot,It){return l=new M9(l,c,A,_,ee,Ae,Fe,It),c=1,W===!0&&(c|=24),W=us(3,null,null,c),l.current=W,W.stateNode=l,c=YC(),c.refCount++,l.pooledCache=c,c.refCount++,W.memoizedState={element:m,isDehydrated:A,cache:c},jA(W),l}function XS(l){return l?(l=Yr,l):Yr}function NS(l,c,A,m,Z,W){Z=XS(Z),m.context===null?m.context=Z:m.pendingContext=Z,m=al(c),m.payload={element:A},W=W===void 0?null:W,W!==null&&(m.callback=W),A=ql(l,m,c),A!==null&&(Ja(A,l,c),wg(A,l,c))}function YS(l,c){if(l=l.memoizedState,l!==null&&l.dehydrated!==null){var A=l.retryLane;l.retryLane=A!==0&&A<c?A:c}}function VG(l,c){YS(l,c),(l=l.alternate)&&YS(l,c)}function KS(l){if(l.tag===13){var c=Ol(l,67108864);c!==null&&Ja(c,l,67108864),VG(l,67108864)}}var Gm=!0;function H9(l,c,A,m){var Z=T.T;T.T=null;var W=J.p;try{J.p=2,MG(l,c,A,m)}finally{J.p=W,T.T=Z}}function X9(l,c,A,m){var Z=T.T;T.T=null;var W=J.p;try{J.p=8,MG(l,c,A,m)}finally{J.p=W,T.T=Z}}function MG(l,c,A,m){if(Gm){var Z=HG(m);if(Z===null)mG(l,c,m,Bm,A),ES(l,m);else if(Y9(Z,l,c,A,m))m.stopPropagation();else if(ES(l,m),c&4&&-1<N9.indexOf(l)){for(;Z!==null;){var W=Ea(Z);if(W!==null)switch(W.tag){case 3:if(W=W.stateNode,W.current.memoizedState.isDehydrated){var _=nt(W.pendingLanes);if(_!==0){var ee=W;for(ee.pendingLanes|=2,ee.entangledLanes|=2;_;){var Ae=1<<31-et(_);ee.entanglements[1]|=Ae,_&=~Ae}og(W),(_n&6)===0&&(Ha=Ee()+500,bh(0))}}break;case 13:ee=Ol(W,2),ee!==null&&Ja(ee,W,2),Al(),VG(W,2)}if(W=HG(m),W===null&&mG(l,c,m,Bm,A),W===Z)break;Z=W}Z!==null&&m.stopPropagation()}else mG(l,c,m,null,A)}}function HG(l){return l=Mo(l),XG(l)}var Bm=null;function XG(l){if(Bm=null,l=es(l),l!==null){var c=s(l);if(c===null)l=null;else{var A=c.tag;if(A===13){if(l=o(c),l!==null)return l;l=null}else if(A===3){if(c.stateNode.current.memoizedState.isDehydrated)return c.tag===3?c.stateNode.containerInfo:null;l=null}else c!==l&&(l=null)}}return Bm=l,null}function FS(l){switch(l){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(ye()){case Je:return 2;case Me:return 8;case Ze:case gt:return 32;case k:return 268435456;default:return 32}default:return 32}}var NG=!1,iu=null,au=null,su=null,wh=new Map,xh=new Map,ou=[],N9="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function ES(l,c){switch(l){case"focusin":case"focusout":iu=null;break;case"dragenter":case"dragleave":au=null;break;case"mouseover":case"mouseout":su=null;break;case"pointerover":case"pointerout":wh.delete(c.pointerId);break;case"gotpointercapture":case"lostpointercapture":xh.delete(c.pointerId)}}function Wh(l,c,A,m,Z,W){return l===null||l.nativeEvent!==W?(l={blockedOn:c,domEventName:A,eventSystemFlags:m,nativeEvent:W,targetContainers:[Z]},c!==null&&(c=Ea(c),c!==null&&KS(c)),l):(l.eventSystemFlags|=m,c=l.targetContainers,Z!==null&&c.indexOf(Z)===-1&&c.push(Z),l)}function Y9(l,c,A,m,Z){switch(c){case"focusin":return iu=Wh(iu,l,c,A,m,Z),!0;case"dragenter":return au=Wh(au,l,c,A,m,Z),!0;case"mouseover":return su=Wh(su,l,c,A,m,Z),!0;case"pointerover":var W=Z.pointerId;return wh.set(W,Wh(wh.get(W)||null,l,c,A,m,Z)),!0;case"gotpointercapture":return W=Z.pointerId,xh.set(W,Wh(xh.get(W)||null,l,c,A,m,Z)),!0}return!1}function TS(l){var c=es(l.target);if(c!==null){var A=s(c);if(A!==null){if(c=A.tag,c===13){if(c=o(A),c!==null){l.blockedOn=c,Gn(l.priority,function(){if(A.tag===13){var m=Vi();m=yt(m);var Z=Ol(A,m);Z!==null&&Ja(Z,A,m),VG(A,m)}});return}}else if(c===3&&A.stateNode.current.memoizedState.isDehydrated){l.blockedOn=A.tag===3?A.stateNode.containerInfo:null;return}}}l.blockedOn=null}function vm(l){if(l.blockedOn!==null)return!1;for(var c=l.targetContainers;0<c.length;){var A=HG(l.nativeEvent);if(A===null){A=l.nativeEvent;var m=new A.constructor(A.type,A);Vo=m,A.target.dispatchEvent(m),Vo=null}else return c=Ea(A),c!==null&&KS(c),l.blockedOn=A,!1;c.shift()}return!0}function zS(l,c,A){vm(l)&&A.delete(c)}function K9(){NG=!1,iu!==null&&vm(iu)&&(iu=null),au!==null&&vm(au)&&(au=null),su!==null&&vm(su)&&(su=null),wh.forEach(zS),xh.forEach(zS)}function Zm(l,c){l.blockedOn===c&&(l.blockedOn=null,NG||(NG=!0,a.unstable_scheduleCallback(a.unstable_NormalPriority,K9)))}var Sm=null;function LS(l){Sm!==l&&(Sm=l,a.unstable_scheduleCallback(a.unstable_NormalPriority,function(){Sm===l&&(Sm=null);for(var c=0;c<l.length;c+=3){var A=l[c],m=l[c+1],Z=l[c+2];if(typeof m!="function"){if(XG(m||A)===null)continue;break}var W=Ea(A);W!==null&&(l.splice(c,3),c-=3,Ch(W,{pending:!0,data:Z,method:A.method,action:m},m,Z))}}))}function Vh(l){function c(Ae){return Zm(Ae,l)}iu!==null&&Zm(iu,l),au!==null&&Zm(au,l),su!==null&&Zm(su,l),wh.forEach(c),xh.forEach(c);for(var A=0;A<ou.length;A++){var m=ou[A];m.blockedOn===l&&(m.blockedOn=null)}for(;0<ou.length&&(A=ou[0],A.blockedOn===null);)TS(A),A.blockedOn===null&&ou.shift();if(A=(l.ownerDocument||l).$$reactFormReplay,A!=null)for(m=0;m<A.length;m+=3){var Z=A[m],W=A[m+1],_=Z[Kn]||null;if(typeof W=="function")_||LS(A);else if(_){var ee=null;if(W&&W.hasAttribute("formAction")){if(Z=W,_=W[Kn]||null)ee=_.formAction;else if(XG(Z)!==null)continue}else ee=_.action;typeof ee=="function"?A[m+1]=ee:(A.splice(m,3),m-=3),LS(A)}}}function YG(l){this._internalRoot=l}Rm.prototype.render=YG.prototype.render=function(l){var c=this._internalRoot;if(c===null)throw Error(n(409));var A=c.current,m=Vi();NS(A,m,l,c,null,null)},Rm.prototype.unmount=YG.prototype.unmount=function(){var l=this._internalRoot;if(l!==null){this._internalRoot=null;var c=l.containerInfo;NS(l.current,2,null,l,null,null),Al(),c[ui]=null}};function Rm(l){this._internalRoot=l}Rm.prototype.unstable_scheduleHydration=function(l){if(l){var c=xt();l={blockedOn:null,target:l,priority:c};for(var A=0;A<ou.length&&c!==0&&c<ou[A].priority;A++);ou.splice(A,0,l),A===0&&TS(l)}};var _S=e.version;if(_S!=="19.1.0")throw Error(n(527,_S,"19.1.0"));J.findDOMNode=function(l){var c=l._reactInternals;if(c===void 0)throw typeof l.render=="function"?Error(n(188)):(l=Object.keys(l).join(","),Error(n(268,l)));return l=g(c),l=l!==null?u(l):null,l=l===null?null:l.stateNode,l};var F9={bundleType:0,version:"19.1.0",rendererPackageName:"react-dom",currentDispatcherRef:T,reconcilerVersion:"19.1.0"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var wm=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!wm.isDisabled&&wm.supportsFiber)try{Ve=wm.inject(F9),Ge=wm}catch{}}return Hh.createRoot=function(l,c){if(!i(l))throw Error(n(299));var A=!1,m="",Z=II,W=$C,_=rm,ee=null;return c!=null&&(c.unstable_strictMode===!0&&(A=!0),c.identifierPrefix!==void 0&&(m=c.identifierPrefix),c.onUncaughtError!==void 0&&(Z=c.onUncaughtError),c.onCaughtError!==void 0&&(W=c.onCaughtError),c.onRecoverableError!==void 0&&(_=c.onRecoverableError),c.unstable_transitionCallbacks!==void 0&&(ee=c.unstable_transitionCallbacks)),c=HS(l,1,!1,null,null,A,m,Z,W,_,ee,null),l[ui]=c.current,pG(l),new YG(c)},Hh.hydrateRoot=function(l,c,A){if(!i(l))throw Error(n(299));var m=!1,Z="",W=II,_=$C,ee=rm,Ae=null,Fe=null;return A!=null&&(A.unstable_strictMode===!0&&(m=!0),A.identifierPrefix!==void 0&&(Z=A.identifierPrefix),A.onUncaughtError!==void 0&&(W=A.onUncaughtError),A.onCaughtError!==void 0&&(_=A.onCaughtError),A.onRecoverableError!==void 0&&(ee=A.onRecoverableError),A.unstable_transitionCallbacks!==void 0&&(Ae=A.unstable_transitionCallbacks),A.formState!==void 0&&(Fe=A.formState)),c=HS(l,1,!0,c,A??null,m,Z,W,_,ee,Ae,Fe),c.context=XS(null),A=c.current,m=Vi(),m=yt(m),Z=al(m),Z.callback=null,ql(A,Z,m),A=m,c.current.lanes=A,mt(c,A),og(c),l[ui]=c.current,pG(l),new Rm(c)},Hh.version="19.1.0",Hh}var $S;function P9(){if($S)return EG.exports;$S=1;function a(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(a)}catch(e){console.error(e)}}return a(),EG.exports=J9(),EG.exports}var E2=P9();/**
 * @license
 * Copyright 2010-2025 Three.js Authors
 * SPDX-License-Identifier: MIT
 */const Lf="177",YI={LEFT:0,MIDDLE:1,RIGHT:2,ROTATE:0,DOLLY:1,PAN:2},KI={ROTATE:0,PAN:1,DOLLY_PAN:2,DOLLY_ROTATE:3},TW=0,Yv=1,zW=2,Q9=3,LW=0,sy=1,cf=2,Ar=3,fg=0,eo=1,Oo=2,cc=0,qI=1,Kv=2,Fv=3,Ev=4,_W=5,fu=100,UW=101,DW=102,kW=103,OW=104,JW=200,PW=201,QW=202,jW=203,jb=204,qb=205,qW=206,$W=207,eV=208,tV=209,nV=210,iV=211,aV=212,sV=213,oV=214,$b=0,e0=1,t0=2,sC=3,n0=4,i0=5,a0=6,s0=7,_f=0,lV=1,rV=2,Ag=0,gV=1,cV=2,uV=3,T2=4,IV=5,CV=6,dV=7,Tv="attached",AV="detached",oy=300,hc=301,Gu=302,Sf=303,Rf=304,IA=306,Bu=1e3,Jo=1001,Qd=1002,Fa=1003,ly=1004,j9=1004,UI=1005,q9=1005,Bi=1006,Ud=1007,$9=1007,yl=1008,e3=1008,vl=1009,z2=1010,L2=1011,jd=1012,ry=1013,fc=1014,qs=1015,dC=1016,gy=1017,cy=1018,qd=1020,_2=35902,U2=1021,D2=1022,Gs=1023,$d=1026,eA=1027,uy=1028,Uf=1029,k2=1030,Iy=1031,t3=1032,Cy=1033,uf=33776,If=33777,Cf=33778,df=33779,o0=35840,l0=35841,r0=35842,g0=35843,c0=36196,u0=37492,I0=37496,C0=37808,d0=37809,A0=37810,h0=37811,f0=37812,p0=37813,m0=37814,b0=37815,y0=37816,G0=37817,B0=37818,v0=37819,Z0=37820,S0=37821,Af=36492,R0=36494,w0=36495,O2=36283,x0=36284,W0=36285,V0=36286,hV=2200,fV=2201,pV=2202,tA=2300,nA=2301,zb=2302,DI=2400,kI=2401,wf=2402,dy=2500,J2=2501,mV=0,P2=1,M0=2,bV=3200,Q2=3201,n3=3202,i3=3203,xu=0,yV=1,ac="",ys="srgb",vu="srgb-linear",xf="linear",ei="srgb",a3=0,FI=7680,s3=7681,o3=7682,l3=7683,r3=34055,g3=34056,c3=5386,u3=512,I3=513,C3=514,d3=515,A3=516,h3=517,f3=518,zv=519,GV=512,BV=513,vV=514,j2=515,ZV=516,SV=517,RV=518,wV=519,Wf=35044,H0=35048,p3=35040,m3=35045,b3=35049,y3=35041,G3=35046,B3=35050,v3=35042,Z3="100",Lv="300 es",Gl=2e3,Vf=2001,S3={COMPUTE:"compute",RENDER:"render"},R3={PERSPECTIVE:"perspective",LINEAR:"linear",FLAT:"flat"},w3={NORMAL:"normal",CENTROID:"centroid",SAMPLE:"sample",FLAT_FIRST:"flat first",FLAT_EITHER:"flat either"};let bg=class{addEventListener(e,t){this._listeners===void 0&&(this._listeners={});const n=this._listeners;n[e]===void 0&&(n[e]=[]),n[e].indexOf(t)===-1&&n[e].push(t)}hasEventListener(e,t){const n=this._listeners;return n===void 0?!1:n[e]!==void 0&&n[e].indexOf(t)!==-1}removeEventListener(e,t){const n=this._listeners;if(n===void 0)return;const i=n[e];if(i!==void 0){const s=i.indexOf(t);s!==-1&&i.splice(s,1)}}dispatchEvent(e){const t=this._listeners;if(t===void 0)return;const n=t[e.type];if(n!==void 0){e.target=this;const i=n.slice(0);for(let s=0,o=i.length;s<o;s++)i[s].call(this,e);e.target=null}}};const hs=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"];let eR=1234567;const $I=Math.PI/180,iA=180/Math.PI;function Po(){const a=Math.random()*4294967295|0,e=Math.random()*4294967295|0,t=Math.random()*4294967295|0,n=Math.random()*4294967295|0;return(hs[a&255]+hs[a>>8&255]+hs[a>>16&255]+hs[a>>24&255]+"-"+hs[e&255]+hs[e>>8&255]+"-"+hs[e>>16&15|64]+hs[e>>24&255]+"-"+hs[t&63|128]+hs[t>>8&255]+"-"+hs[t>>16&255]+hs[t>>24&255]+hs[n&255]+hs[n>>8&255]+hs[n>>16&255]+hs[n>>24&255]).toLowerCase()}function ln(a,e,t){return Math.max(e,Math.min(t,a))}function q2(a,e){return(a%e+e)%e}function x3(a,e,t,n,i){return n+(a-e)*(i-n)/(t-e)}function W3(a,e,t){return a!==e?(t-a)/(e-a):0}function hf(a,e,t){return(1-t)*a+t*e}function V3(a,e,t,n){return hf(a,e,1-Math.exp(-t*n))}function M3(a,e=1){return e-Math.abs(q2(a,e*2)-e)}function H3(a,e,t){return a<=e?0:a>=t?1:(a=(a-e)/(t-e),a*a*(3-2*a))}function X3(a,e,t){return a<=e?0:a>=t?1:(a=(a-e)/(t-e),a*a*a*(a*(a*6-15)+10))}function N3(a,e){return a+Math.floor(Math.random()*(e-a+1))}function Y3(a,e){return a+Math.random()*(e-a)}function K3(a){return a*(.5-Math.random())}function F3(a){a!==void 0&&(eR=a);let e=eR+=1831565813;return e=Math.imul(e^e>>>15,e|1),e^=e+Math.imul(e^e>>>7,e|61),((e^e>>>14)>>>0)/4294967296}function E3(a){return a*$I}function T3(a){return a*iA}function z3(a){return(a&a-1)===0&&a!==0}function L3(a){return Math.pow(2,Math.ceil(Math.log(a)/Math.LN2))}function _3(a){return Math.pow(2,Math.floor(Math.log(a)/Math.LN2))}function U3(a,e,t,n,i){const s=Math.cos,o=Math.sin,r=s(t/2),g=o(t/2),u=s((e+n)/2),C=o((e+n)/2),h=s((e-n)/2),f=o((e-n)/2),p=s((n-e)/2),y=o((n-e)/2);switch(i){case"XYX":a.set(r*C,g*h,g*f,r*u);break;case"YZY":a.set(g*f,r*C,g*h,r*u);break;case"ZXZ":a.set(g*h,g*f,r*C,r*u);break;case"XZX":a.set(r*C,g*y,g*p,r*u);break;case"YXY":a.set(g*p,r*C,g*y,r*u);break;case"ZYZ":a.set(g*y,g*p,r*C,r*u);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+i)}}function js(a,e){switch(e.constructor){case Float32Array:return a;case Uint32Array:return a/4294967295;case Uint16Array:return a/65535;case Uint8Array:return a/255;case Int32Array:return Math.max(a/2147483647,-1);case Int16Array:return Math.max(a/32767,-1);case Int8Array:return Math.max(a/127,-1);default:throw new Error("Invalid component type.")}}function hn(a,e){switch(e.constructor){case Float32Array:return a;case Uint32Array:return Math.round(a*4294967295);case Uint16Array:return Math.round(a*65535);case Uint8Array:return Math.round(a*255);case Int32Array:return Math.round(a*2147483647);case Int16Array:return Math.round(a*32767);case Int8Array:return Math.round(a*127);default:throw new Error("Invalid component type.")}}const OI={DEG2RAD:$I,RAD2DEG:iA,generateUUID:Po,clamp:ln,euclideanModulo:q2,mapLinear:x3,inverseLerp:W3,lerp:hf,damp:V3,pingpong:M3,smoothstep:H3,smootherstep:X3,randInt:N3,randFloat:Y3,randFloatSpread:K3,seededRandom:F3,degToRad:E3,radToDeg:T3,isPowerOfTwo:z3,ceilPowerOfTwo:L3,floorPowerOfTwo:_3,setQuaternionFromProperEuler:U3,normalize:hn,denormalize:js};class at{constructor(e=0,t=0){at.prototype.isVector2=!0,this.x=e,this.y=t}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,t){return this.x=e,this.y=t,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e){return this.x+=e.x,this.y+=e.y,this}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix3(e){const t=this.x,n=this.y,i=e.elements;return this.x=i[0]*t+i[3]*n+i[6],this.y=i[1]*t+i[4]*n+i[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,t){return this.x=ln(this.x,e.x,t.x),this.y=ln(this.y,e.y,t.y),this}clampScalar(e,t){return this.x=ln(this.x,e,t),this.y=ln(this.y,e,t),this}clampLength(e,t){const n=this.length();return this.divideScalar(n||1).multiplyScalar(ln(n,e,t))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(t===0)return Math.PI/2;const n=this.dot(e)/t;return Math.acos(ln(n,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,n=this.y-e.y;return t*t+n*n}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this}rotateAround(e,t){const n=Math.cos(t),i=Math.sin(t),s=this.x-e.x,o=this.y-e.y;return this.x=s*n-o*i+e.x,this.y=s*i+o*n+e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}let ca=class{constructor(e=0,t=0,n=0,i=1){this.isQuaternion=!0,this._x=e,this._y=t,this._z=n,this._w=i}static slerpFlat(e,t,n,i,s,o,r){let g=n[i+0],u=n[i+1],C=n[i+2],h=n[i+3];const f=s[o+0],p=s[o+1],y=s[o+2],v=s[o+3];if(r===0){e[t+0]=g,e[t+1]=u,e[t+2]=C,e[t+3]=h;return}if(r===1){e[t+0]=f,e[t+1]=p,e[t+2]=y,e[t+3]=v;return}if(h!==v||g!==f||u!==p||C!==y){let G=1-r;const B=g*f+u*p+C*y+h*v,R=B>=0?1:-1,x=1-B*B;if(x>Number.EPSILON){const M=Math.sqrt(x),H=Math.atan2(M,B*R);G=Math.sin(G*H)/M,r=Math.sin(r*H)/M}const w=r*R;if(g=g*G+f*w,u=u*G+p*w,C=C*G+y*w,h=h*G+v*w,G===1-r){const M=1/Math.sqrt(g*g+u*u+C*C+h*h);g*=M,u*=M,C*=M,h*=M}}e[t]=g,e[t+1]=u,e[t+2]=C,e[t+3]=h}static multiplyQuaternionsFlat(e,t,n,i,s,o){const r=n[i],g=n[i+1],u=n[i+2],C=n[i+3],h=s[o],f=s[o+1],p=s[o+2],y=s[o+3];return e[t]=r*y+C*h+g*p-u*f,e[t+1]=g*y+C*f+u*h-r*p,e[t+2]=u*y+C*p+r*f-g*h,e[t+3]=C*y-r*h-g*f-u*p,e}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get w(){return this._w}set w(e){this._w=e,this._onChangeCallback()}set(e,t,n,i){return this._x=e,this._y=t,this._z=n,this._w=i,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this}setFromEuler(e,t=!0){const n=e._x,i=e._y,s=e._z,o=e._order,r=Math.cos,g=Math.sin,u=r(n/2),C=r(i/2),h=r(s/2),f=g(n/2),p=g(i/2),y=g(s/2);switch(o){case"XYZ":this._x=f*C*h+u*p*y,this._y=u*p*h-f*C*y,this._z=u*C*y+f*p*h,this._w=u*C*h-f*p*y;break;case"YXZ":this._x=f*C*h+u*p*y,this._y=u*p*h-f*C*y,this._z=u*C*y-f*p*h,this._w=u*C*h+f*p*y;break;case"ZXY":this._x=f*C*h-u*p*y,this._y=u*p*h+f*C*y,this._z=u*C*y+f*p*h,this._w=u*C*h-f*p*y;break;case"ZYX":this._x=f*C*h-u*p*y,this._y=u*p*h+f*C*y,this._z=u*C*y-f*p*h,this._w=u*C*h+f*p*y;break;case"YZX":this._x=f*C*h+u*p*y,this._y=u*p*h+f*C*y,this._z=u*C*y-f*p*h,this._w=u*C*h-f*p*y;break;case"XZY":this._x=f*C*h-u*p*y,this._y=u*p*h-f*C*y,this._z=u*C*y+f*p*h,this._w=u*C*h+f*p*y;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+o)}return t===!0&&this._onChangeCallback(),this}setFromAxisAngle(e,t){const n=t/2,i=Math.sin(n);return this._x=e.x*i,this._y=e.y*i,this._z=e.z*i,this._w=Math.cos(n),this._onChangeCallback(),this}setFromRotationMatrix(e){const t=e.elements,n=t[0],i=t[4],s=t[8],o=t[1],r=t[5],g=t[9],u=t[2],C=t[6],h=t[10],f=n+r+h;if(f>0){const p=.5/Math.sqrt(f+1);this._w=.25/p,this._x=(C-g)*p,this._y=(s-u)*p,this._z=(o-i)*p}else if(n>r&&n>h){const p=2*Math.sqrt(1+n-r-h);this._w=(C-g)/p,this._x=.25*p,this._y=(i+o)/p,this._z=(s+u)/p}else if(r>h){const p=2*Math.sqrt(1+r-n-h);this._w=(s-u)/p,this._x=(i+o)/p,this._y=.25*p,this._z=(g+C)/p}else{const p=2*Math.sqrt(1+h-n-r);this._w=(o-i)/p,this._x=(s+u)/p,this._y=(g+C)/p,this._z=.25*p}return this._onChangeCallback(),this}setFromUnitVectors(e,t){let n=e.dot(t)+1;return n<Number.EPSILON?(n=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=n):(this._x=0,this._y=-e.z,this._z=e.y,this._w=n)):(this._x=e.y*t.z-e.z*t.y,this._y=e.z*t.x-e.x*t.z,this._z=e.x*t.y-e.y*t.x,this._w=n),this.normalize()}angleTo(e){return 2*Math.acos(Math.abs(ln(this.dot(e),-1,1)))}rotateTowards(e,t){const n=this.angleTo(e);if(n===0)return this;const i=Math.min(1,t/n);return this.slerp(e,i),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let e=this.length();return e===0?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this}multiply(e){return this.multiplyQuaternions(this,e)}premultiply(e){return this.multiplyQuaternions(e,this)}multiplyQuaternions(e,t){const n=e._x,i=e._y,s=e._z,o=e._w,r=t._x,g=t._y,u=t._z,C=t._w;return this._x=n*C+o*r+i*u-s*g,this._y=i*C+o*g+s*r-n*u,this._z=s*C+o*u+n*g-i*r,this._w=o*C-n*r-i*g-s*u,this._onChangeCallback(),this}slerp(e,t){if(t===0)return this;if(t===1)return this.copy(e);const n=this._x,i=this._y,s=this._z,o=this._w;let r=o*e._w+n*e._x+i*e._y+s*e._z;if(r<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,r=-r):this.copy(e),r>=1)return this._w=o,this._x=n,this._y=i,this._z=s,this;const g=1-r*r;if(g<=Number.EPSILON){const p=1-t;return this._w=p*o+t*this._w,this._x=p*n+t*this._x,this._y=p*i+t*this._y,this._z=p*s+t*this._z,this.normalize(),this}const u=Math.sqrt(g),C=Math.atan2(u,r),h=Math.sin((1-t)*C)/u,f=Math.sin(t*C)/u;return this._w=o*h+this._w*f,this._x=n*h+this._x*f,this._y=i*h+this._y*f,this._z=s*h+this._z*f,this._onChangeCallback(),this}slerpQuaternions(e,t,n){return this.copy(e).slerp(t,n)}random(){const e=2*Math.PI*Math.random(),t=2*Math.PI*Math.random(),n=Math.random(),i=Math.sqrt(1-n),s=Math.sqrt(n);return this.set(i*Math.sin(e),i*Math.cos(e),s*Math.sin(t),s*Math.cos(t))}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}fromArray(e,t=0){return this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e}fromBufferAttribute(e,t){return this._x=e.getX(t),this._y=e.getY(t),this._z=e.getZ(t),this._w=e.getW(t),this._onChangeCallback(),this}toJSON(){return this.toArray()}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}};class ae{constructor(e=0,t=0,n=0){ae.prototype.isVector3=!0,this.x=e,this.y=t,this.z=n}set(e,t,n){return n===void 0&&(n=this.z),this.x=e,this.y=t,this.z=n,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this}multiplyVectors(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this}applyEuler(e){return this.applyQuaternion(tR.setFromEuler(e))}applyAxisAngle(e,t){return this.applyQuaternion(tR.setFromAxisAngle(e,t))}applyMatrix3(e){const t=this.x,n=this.y,i=this.z,s=e.elements;return this.x=s[0]*t+s[3]*n+s[6]*i,this.y=s[1]*t+s[4]*n+s[7]*i,this.z=s[2]*t+s[5]*n+s[8]*i,this}applyNormalMatrix(e){return this.applyMatrix3(e).normalize()}applyMatrix4(e){const t=this.x,n=this.y,i=this.z,s=e.elements,o=1/(s[3]*t+s[7]*n+s[11]*i+s[15]);return this.x=(s[0]*t+s[4]*n+s[8]*i+s[12])*o,this.y=(s[1]*t+s[5]*n+s[9]*i+s[13])*o,this.z=(s[2]*t+s[6]*n+s[10]*i+s[14])*o,this}applyQuaternion(e){const t=this.x,n=this.y,i=this.z,s=e.x,o=e.y,r=e.z,g=e.w,u=2*(o*i-r*n),C=2*(r*t-s*i),h=2*(s*n-o*t);return this.x=t+g*u+o*h-r*C,this.y=n+g*C+r*u-s*h,this.z=i+g*h+s*C-o*u,this}project(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}unproject(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}transformDirection(e){const t=this.x,n=this.y,i=this.z,s=e.elements;return this.x=s[0]*t+s[4]*n+s[8]*i,this.y=s[1]*t+s[5]*n+s[9]*i,this.z=s[2]*t+s[6]*n+s[10]*i,this.normalize()}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}divideScalar(e){return this.multiplyScalar(1/e)}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}clamp(e,t){return this.x=ln(this.x,e.x,t.x),this.y=ln(this.y,e.y,t.y),this.z=ln(this.z,e.z,t.z),this}clampScalar(e,t){return this.x=ln(this.x,e,t),this.y=ln(this.y,e,t),this.z=ln(this.z,e,t),this}clampLength(e,t){const n=this.length();return this.divideScalar(n||1).multiplyScalar(ln(n,e,t))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this.z=e.z+(t.z-e.z)*n,this}cross(e){return this.crossVectors(this,e)}crossVectors(e,t){const n=e.x,i=e.y,s=e.z,o=t.x,r=t.y,g=t.z;return this.x=i*g-s*r,this.y=s*o-n*g,this.z=n*r-i*o,this}projectOnVector(e){const t=e.lengthSq();if(t===0)return this.set(0,0,0);const n=e.dot(this)/t;return this.copy(e).multiplyScalar(n)}projectOnPlane(e){return _G.copy(this).projectOnVector(e),this.sub(_G)}reflect(e){return this.sub(_G.copy(e).multiplyScalar(2*this.dot(e)))}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(t===0)return Math.PI/2;const n=this.dot(e)/t;return Math.acos(ln(n,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,n=this.y-e.y,i=this.z-e.z;return t*t+n*n+i*i}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}setFromSpherical(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}setFromSphericalCoords(e,t,n){const i=Math.sin(t)*e;return this.x=i*Math.sin(n),this.y=Math.cos(t)*e,this.z=i*Math.cos(n),this}setFromCylindrical(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}setFromCylindricalCoords(e,t,n){return this.x=e*Math.sin(t),this.y=n,this.z=e*Math.cos(t),this}setFromMatrixPosition(e){const t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this}setFromMatrixScale(e){const t=this.setFromMatrixColumn(e,0).length(),n=this.setFromMatrixColumn(e,1).length(),i=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=n,this.z=i,this}setFromMatrixColumn(e,t){return this.fromArray(e.elements,t*4)}setFromMatrix3Column(e,t){return this.fromArray(e.elements,t*3)}setFromEuler(e){return this.x=e._x,this.y=e._y,this.z=e._z,this}setFromColor(e){return this.x=e.r,this.y=e.g,this.z=e.b,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const e=Math.random()*Math.PI*2,t=Math.random()*2-1,n=Math.sqrt(1-t*t);return this.x=n*Math.cos(e),this.y=t,this.z=n*Math.sin(e),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}const _G=new ae,tR=new ca;class on{constructor(e,t,n,i,s,o,r,g,u){on.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],e!==void 0&&this.set(e,t,n,i,s,o,r,g,u)}set(e,t,n,i,s,o,r,g,u){const C=this.elements;return C[0]=e,C[1]=i,C[2]=r,C[3]=t,C[4]=s,C[5]=g,C[6]=n,C[7]=o,C[8]=u,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(e){const t=this.elements,n=e.elements;return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],this}extractBasis(e,t,n){return e.setFromMatrix3Column(this,0),t.setFromMatrix3Column(this,1),n.setFromMatrix3Column(this,2),this}setFromMatrix4(e){const t=e.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const n=e.elements,i=t.elements,s=this.elements,o=n[0],r=n[3],g=n[6],u=n[1],C=n[4],h=n[7],f=n[2],p=n[5],y=n[8],v=i[0],G=i[3],B=i[6],R=i[1],x=i[4],w=i[7],M=i[2],H=i[5],N=i[8];return s[0]=o*v+r*R+g*M,s[3]=o*G+r*x+g*H,s[6]=o*B+r*w+g*N,s[1]=u*v+C*R+h*M,s[4]=u*G+C*x+h*H,s[7]=u*B+C*w+h*N,s[2]=f*v+p*R+y*M,s[5]=f*G+p*x+y*H,s[8]=f*B+p*w+y*N,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this}determinant(){const e=this.elements,t=e[0],n=e[1],i=e[2],s=e[3],o=e[4],r=e[5],g=e[6],u=e[7],C=e[8];return t*o*C-t*r*u-n*s*C+n*r*g+i*s*u-i*o*g}invert(){const e=this.elements,t=e[0],n=e[1],i=e[2],s=e[3],o=e[4],r=e[5],g=e[6],u=e[7],C=e[8],h=C*o-r*u,f=r*g-C*s,p=u*s-o*g,y=t*h+n*f+i*p;if(y===0)return this.set(0,0,0,0,0,0,0,0,0);const v=1/y;return e[0]=h*v,e[1]=(i*u-C*n)*v,e[2]=(r*n-i*o)*v,e[3]=f*v,e[4]=(C*t-i*g)*v,e[5]=(i*s-r*t)*v,e[6]=p*v,e[7]=(n*g-u*t)*v,e[8]=(o*t-n*s)*v,this}transpose(){let e;const t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}transposeIntoArray(e){const t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this}setUvTransform(e,t,n,i,s,o,r){const g=Math.cos(s),u=Math.sin(s);return this.set(n*g,n*u,-n*(g*o+u*r)+o+e,-i*u,i*g,-i*(-u*o+g*r)+r+t,0,0,1),this}scale(e,t){return this.premultiply(UG.makeScale(e,t)),this}rotate(e){return this.premultiply(UG.makeRotation(-e)),this}translate(e,t){return this.premultiply(UG.makeTranslation(e,t)),this}makeTranslation(e,t){return e.isVector2?this.set(1,0,e.x,0,1,e.y,0,0,1):this.set(1,0,e,0,1,t,0,0,1),this}makeRotation(e){const t=Math.cos(e),n=Math.sin(e);return this.set(t,-n,0,n,t,0,0,0,1),this}makeScale(e,t){return this.set(e,0,0,0,t,0,0,0,1),this}equals(e){const t=this.elements,n=e.elements;for(let i=0;i<9;i++)if(t[i]!==n[i])return!1;return!0}fromArray(e,t=0){for(let n=0;n<9;n++)this.elements[n]=e[n+t];return this}toArray(e=[],t=0){const n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e}clone(){return new this.constructor().fromArray(this.elements)}}const UG=new on;function xV(a){for(let e=a.length-1;e>=0;--e)if(a[e]>=65535)return!0;return!1}const D3={Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array};function zd(a,e){return new D3[a](e)}function Mf(a){return document.createElementNS("http://www.w3.org/1999/xhtml",a)}function WV(){const a=Mf("canvas");return a.style.display="block",a}const nR={};function Dd(a){a in nR||(nR[a]=!0,console.warn(a))}function k3(a,e,t){return new Promise(function(n,i){function s(){switch(a.clientWaitSync(e,a.SYNC_FLUSH_COMMANDS_BIT,0)){case a.WAIT_FAILED:i();break;case a.TIMEOUT_EXPIRED:setTimeout(s,t);break;default:n()}}setTimeout(s,t)})}function O3(a){const e=a.elements;e[2]=.5*e[2]+.5*e[3],e[6]=.5*e[6]+.5*e[7],e[10]=.5*e[10]+.5*e[11],e[14]=.5*e[14]+.5*e[15]}function J3(a){const e=a.elements;e[11]===-1?(e[10]=-e[10]-1,e[14]=-e[14]):(e[10]=-e[10],e[14]=-e[14]+1)}const iR=new on().set(.4123908,.3575843,.1804808,.212639,.7151687,.0721923,.0193308,.1191948,.9505322),aR=new on().set(3.2409699,-1.5373832,-.4986108,-.9692436,1.8759675,.0415551,.0556301,-.203977,1.0569715);function P3(){const a={enabled:!0,workingColorSpace:vu,spaces:{},convert:function(i,s,o){return this.enabled===!1||s===o||!s||!o||(this.spaces[s].transfer===ei&&(i.r=uc(i.r),i.g=uc(i.g),i.b=uc(i.b)),this.spaces[s].primaries!==this.spaces[o].primaries&&(i.applyMatrix3(this.spaces[s].toXYZ),i.applyMatrix3(this.spaces[o].fromXYZ)),this.spaces[o].transfer===ei&&(i.r=kd(i.r),i.g=kd(i.g),i.b=kd(i.b))),i},workingToColorSpace:function(i,s){return this.convert(i,this.workingColorSpace,s)},colorSpaceToWorking:function(i,s){return this.convert(i,s,this.workingColorSpace)},getPrimaries:function(i){return this.spaces[i].primaries},getTransfer:function(i){return i===ac?xf:this.spaces[i].transfer},getLuminanceCoefficients:function(i,s=this.workingColorSpace){return i.fromArray(this.spaces[s].luminanceCoefficients)},define:function(i){Object.assign(this.spaces,i)},_getMatrix:function(i,s,o){return i.copy(this.spaces[s].toXYZ).multiply(this.spaces[o].fromXYZ)},_getDrawingBufferColorSpace:function(i){return this.spaces[i].outputColorSpaceConfig.drawingBufferColorSpace},_getUnpackColorSpace:function(i=this.workingColorSpace){return this.spaces[i].workingColorSpaceConfig.unpackColorSpace},fromWorkingColorSpace:function(i,s){return Dd("THREE.ColorManagement: .fromWorkingColorSpace() has been renamed to .workingToColorSpace()."),a.workingToColorSpace(i,s)},toWorkingColorSpace:function(i,s){return Dd("THREE.ColorManagement: .toWorkingColorSpace() has been renamed to .colorSpaceToWorking()."),a.colorSpaceToWorking(i,s)}},e=[.64,.33,.3,.6,.15,.06],t=[.2126,.7152,.0722],n=[.3127,.329];return a.define({[vu]:{primaries:e,whitePoint:n,transfer:xf,toXYZ:iR,fromXYZ:aR,luminanceCoefficients:t,workingColorSpaceConfig:{unpackColorSpace:ys},outputColorSpaceConfig:{drawingBufferColorSpace:ys}},[ys]:{primaries:e,whitePoint:n,transfer:ei,toXYZ:iR,fromXYZ:aR,luminanceCoefficients:t,outputColorSpaceConfig:{drawingBufferColorSpace:ys}}}),a}const Mn=P3();function uc(a){return a<.04045?a*.0773993808:Math.pow(a*.9478672986+.0521327014,2.4)}function kd(a){return a<.0031308?a*12.92:1.055*Math.pow(a,.41666)-.055}let hd;class VV{static getDataURL(e,t="image/png"){if(/^data:/i.test(e.src)||typeof HTMLCanvasElement>"u")return e.src;let n;if(e instanceof HTMLCanvasElement)n=e;else{hd===void 0&&(hd=Mf("canvas")),hd.width=e.width,hd.height=e.height;const i=hd.getContext("2d");e instanceof ImageData?i.putImageData(e,0,0):i.drawImage(e,0,0,e.width,e.height),n=hd}return n.toDataURL(t)}static sRGBToLinear(e){if(typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&e instanceof ImageBitmap){const t=Mf("canvas");t.width=e.width,t.height=e.height;const n=t.getContext("2d");n.drawImage(e,0,0,e.width,e.height);const i=n.getImageData(0,0,e.width,e.height),s=i.data;for(let o=0;o<s.length;o++)s[o]=uc(s[o]/255)*255;return n.putImageData(i,0,0),t}else if(e.data){const t=e.data.slice(0);for(let n=0;n<t.length;n++)t instanceof Uint8Array||t instanceof Uint8ClampedArray?t[n]=Math.floor(uc(t[n]/255)*255):t[n]=uc(t[n]);return{data:t,width:e.width,height:e.height}}else return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),e}}let Q3=0;class mu{constructor(e=null){this.isSource=!0,Object.defineProperty(this,"id",{value:Q3++}),this.uuid=Po(),this.data=e,this.dataReady=!0,this.version=0}getSize(e){const t=this.data;return t instanceof HTMLVideoElement?e.set(t.videoWidth,t.videoHeight):t!==null?e.set(t.width,t.height,t.depth||0):e.set(0,0,0),e}set needsUpdate(e){e===!0&&this.version++}toJSON(e){const t=e===void 0||typeof e=="string";if(!t&&e.images[this.uuid]!==void 0)return e.images[this.uuid];const n={uuid:this.uuid,url:""},i=this.data;if(i!==null){let s;if(Array.isArray(i)){s=[];for(let o=0,r=i.length;o<r;o++)i[o].isDataTexture?s.push(DG(i[o].image)):s.push(DG(i[o]))}else s=DG(i);n.url=s}return t||(e.images[this.uuid]=n),n}}function DG(a){return typeof HTMLImageElement<"u"&&a instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&a instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&a instanceof ImageBitmap?VV.getDataURL(a):a.data?{data:Array.from(a.data),width:a.width,height:a.height,type:a.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}let j3=0;const kG=new ae;class Zi extends bg{constructor(e=Zi.DEFAULT_IMAGE,t=Zi.DEFAULT_MAPPING,n=Jo,i=Jo,s=Bi,o=yl,r=Gs,g=vl,u=Zi.DEFAULT_ANISOTROPY,C=ac){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:j3++}),this.uuid=Po(),this.name="",this.source=new mu(e),this.mipmaps=[],this.mapping=t,this.channel=0,this.wrapS=n,this.wrapT=i,this.magFilter=s,this.minFilter=o,this.anisotropy=u,this.format=r,this.internalFormat=null,this.type=g,this.offset=new at(0,0),this.repeat=new at(1,1),this.center=new at(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new on,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.colorSpace=C,this.userData={},this.updateRanges=[],this.version=0,this.onUpdate=null,this.renderTarget=null,this.isRenderTargetTexture=!1,this.isArrayTexture=!!(e&&e.depth&&e.depth>1),this.pmremVersion=0}get width(){return this.source.getSize(kG).x}get height(){return this.source.getSize(kG).y}get depth(){return this.source.getSize(kG).z}get image(){return this.source.data}set image(e=null){this.source.data=e}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}addUpdateRange(e,t){this.updateRanges.push({start:e,count:t})}clearUpdateRanges(){this.updateRanges.length=0}clone(){return new this.constructor().copy(this)}copy(e){return this.name=e.name,this.source=e.source,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.channel=e.channel,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.colorSpace=e.colorSpace,this.renderTarget=e.renderTarget,this.isRenderTargetTexture=e.isRenderTargetTexture,this.isArrayTexture=e.isArrayTexture,this.userData=JSON.parse(JSON.stringify(e.userData)),this.needsUpdate=!0,this}setValues(e){for(const t in e){const n=e[t];if(n===void 0){console.warn(`THREE.Texture.setValues(): parameter '${t}' has value of undefined.`);continue}const i=this[t];if(i===void 0){console.warn(`THREE.Texture.setValues(): property '${t}' does not exist.`);continue}i&&n&&i.isVector2&&n.isVector2||i&&n&&i.isVector3&&n.isVector3||i&&n&&i.isMatrix3&&n.isMatrix3?i.copy(n):this[t]=n}}toJSON(e){const t=e===void 0||typeof e=="string";if(!t&&e.textures[this.uuid]!==void 0)return e.textures[this.uuid];const n={metadata:{version:4.7,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(e).uuid,mapping:this.mapping,channel:this.channel,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,internalFormat:this.internalFormat,type:this.type,colorSpace:this.colorSpace,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return Object.keys(this.userData).length>0&&(n.userData=this.userData),t||(e.textures[this.uuid]=n),n}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(e){if(this.mapping!==oy)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case Bu:e.x=e.x-Math.floor(e.x);break;case Jo:e.x=e.x<0?0:1;break;case Qd:Math.abs(Math.floor(e.x)%2)===1?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x);break}if(e.y<0||e.y>1)switch(this.wrapT){case Bu:e.y=e.y-Math.floor(e.y);break;case Jo:e.y=e.y<0?0:1;break;case Qd:Math.abs(Math.floor(e.y)%2)===1?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y);break}return this.flipY&&(e.y=1-e.y),e}set needsUpdate(e){e===!0&&(this.version++,this.source.needsUpdate=!0)}set needsPMREMUpdate(e){e===!0&&this.pmremVersion++}}Zi.DEFAULT_IMAGE=null;Zi.DEFAULT_MAPPING=oy;Zi.DEFAULT_ANISOTROPY=1;class Hn{constructor(e=0,t=0,n=0,i=1){Hn.prototype.isVector4=!0,this.x=e,this.y=t,this.z=n,this.w=i}get width(){return this.z}set width(e){this.z=e}get height(){return this.w}set height(e){this.w=e}set(e,t,n,i){return this.x=e,this.y=t,this.z=n,this.w=i,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this.w=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setW(e){return this.w=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w!==void 0?e.w:1,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this.w+=e.w*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}applyMatrix4(e){const t=this.x,n=this.y,i=this.z,s=this.w,o=e.elements;return this.x=o[0]*t+o[4]*n+o[8]*i+o[12]*s,this.y=o[1]*t+o[5]*n+o[9]*i+o[13]*s,this.z=o[2]*t+o[6]*n+o[10]*i+o[14]*s,this.w=o[3]*t+o[7]*n+o[11]*i+o[15]*s,this}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this.w/=e.w,this}divideScalar(e){return this.multiplyScalar(1/e)}setAxisAngleFromQuaternion(e){this.w=2*Math.acos(e.w);const t=Math.sqrt(1-e.w*e.w);return t<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this}setAxisAngleFromRotationMatrix(e){let t,n,i,s;const g=e.elements,u=g[0],C=g[4],h=g[8],f=g[1],p=g[5],y=g[9],v=g[2],G=g[6],B=g[10];if(Math.abs(C-f)<.01&&Math.abs(h-v)<.01&&Math.abs(y-G)<.01){if(Math.abs(C+f)<.1&&Math.abs(h+v)<.1&&Math.abs(y+G)<.1&&Math.abs(u+p+B-3)<.1)return this.set(1,0,0,0),this;t=Math.PI;const x=(u+1)/2,w=(p+1)/2,M=(B+1)/2,H=(C+f)/4,N=(h+v)/4,F=(y+G)/4;return x>w&&x>M?x<.01?(n=0,i=.707106781,s=.707106781):(n=Math.sqrt(x),i=H/n,s=N/n):w>M?w<.01?(n=.707106781,i=0,s=.707106781):(i=Math.sqrt(w),n=H/i,s=F/i):M<.01?(n=.707106781,i=.707106781,s=0):(s=Math.sqrt(M),n=N/s,i=F/s),this.set(n,i,s,t),this}let R=Math.sqrt((G-y)*(G-y)+(h-v)*(h-v)+(f-C)*(f-C));return Math.abs(R)<.001&&(R=1),this.x=(G-y)/R,this.y=(h-v)/R,this.z=(f-C)/R,this.w=Math.acos((u+p+B-1)/2),this}setFromMatrixPosition(e){const t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this.w=t[15],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this}clamp(e,t){return this.x=ln(this.x,e.x,t.x),this.y=ln(this.y,e.y,t.y),this.z=ln(this.z,e.z,t.z),this.w=ln(this.w,e.w,t.w),this}clampScalar(e,t){return this.x=ln(this.x,e,t),this.y=ln(this.y,e,t),this.z=ln(this.z,e,t),this.w=ln(this.w,e,t),this}clampLength(e,t){const n=this.length();return this.divideScalar(n||1).multiplyScalar(ln(n,e,t))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this.w=Math.trunc(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this.z=e.z+(t.z-e.z)*n,this.w=e.w+(t.w-e.w)*n,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this.w=e.getW(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}}class $2 extends bg{constructor(e=1,t=1,n={}){super(),n=Object.assign({generateMipmaps:!1,internalFormat:null,minFilter:Bi,depthBuffer:!0,stencilBuffer:!1,resolveDepthBuffer:!0,resolveStencilBuffer:!0,depthTexture:null,samples:0,count:1,depth:1,multiview:!1},n),this.isRenderTarget=!0,this.width=e,this.height=t,this.depth=n.depth,this.scissor=new Hn(0,0,e,t),this.scissorTest=!1,this.viewport=new Hn(0,0,e,t);const i={width:e,height:t,depth:n.depth},s=new Zi(i);this.textures=[];const o=n.count;for(let r=0;r<o;r++)this.textures[r]=s.clone(),this.textures[r].isRenderTargetTexture=!0,this.textures[r].renderTarget=this;this._setTextureOptions(n),this.depthBuffer=n.depthBuffer,this.stencilBuffer=n.stencilBuffer,this.resolveDepthBuffer=n.resolveDepthBuffer,this.resolveStencilBuffer=n.resolveStencilBuffer,this._depthTexture=null,this.depthTexture=n.depthTexture,this.samples=n.samples,this.multiview=n.multiview}_setTextureOptions(e={}){const t={minFilter:Bi,generateMipmaps:!1,flipY:!1,internalFormat:null};e.mapping!==void 0&&(t.mapping=e.mapping),e.wrapS!==void 0&&(t.wrapS=e.wrapS),e.wrapT!==void 0&&(t.wrapT=e.wrapT),e.wrapR!==void 0&&(t.wrapR=e.wrapR),e.magFilter!==void 0&&(t.magFilter=e.magFilter),e.minFilter!==void 0&&(t.minFilter=e.minFilter),e.format!==void 0&&(t.format=e.format),e.type!==void 0&&(t.type=e.type),e.anisotropy!==void 0&&(t.anisotropy=e.anisotropy),e.colorSpace!==void 0&&(t.colorSpace=e.colorSpace),e.flipY!==void 0&&(t.flipY=e.flipY),e.generateMipmaps!==void 0&&(t.generateMipmaps=e.generateMipmaps),e.internalFormat!==void 0&&(t.internalFormat=e.internalFormat);for(let n=0;n<this.textures.length;n++)this.textures[n].setValues(t)}get texture(){return this.textures[0]}set texture(e){this.textures[0]=e}set depthTexture(e){this._depthTexture!==null&&(this._depthTexture.renderTarget=null),e!==null&&(e.renderTarget=this),this._depthTexture=e}get depthTexture(){return this._depthTexture}setSize(e,t,n=1){if(this.width!==e||this.height!==t||this.depth!==n){this.width=e,this.height=t,this.depth=n;for(let i=0,s=this.textures.length;i<s;i++)this.textures[i].image.width=e,this.textures[i].image.height=t,this.textures[i].image.depth=n,this.textures[i].isArrayTexture=this.textures[i].image.depth>1;this.dispose()}this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t)}clone(){return new this.constructor().copy(this)}copy(e){this.width=e.width,this.height=e.height,this.depth=e.depth,this.scissor.copy(e.scissor),this.scissorTest=e.scissorTest,this.viewport.copy(e.viewport),this.textures.length=0;for(let t=0,n=e.textures.length;t<n;t++){this.textures[t]=e.textures[t].clone(),this.textures[t].isRenderTargetTexture=!0,this.textures[t].renderTarget=this;const i=Object.assign({},e.textures[t].image);this.textures[t].source=new mu(i)}return this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,this.resolveDepthBuffer=e.resolveDepthBuffer,this.resolveStencilBuffer=e.resolveStencilBuffer,e.depthTexture!==null&&(this.depthTexture=e.depthTexture.clone()),this.samples=e.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}}class br extends $2{constructor(e=1,t=1,n={}){super(e,t,n),this.isWebGLRenderTarget=!0}}class Ay extends Zi{constructor(e=null,t=1,n=1,i=1){super(null),this.isDataArrayTexture=!0,this.image={data:e,width:t,height:n,depth:i},this.magFilter=Fa,this.minFilter=Fa,this.wrapR=Jo,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.layerUpdates=new Set}addLayerUpdate(e){this.layerUpdates.add(e)}clearLayerUpdates(){this.layerUpdates.clear()}}class q3 extends br{constructor(e=1,t=1,n=1,i={}){super(e,t,i),this.isWebGLArrayRenderTarget=!0,this.depth=n,this.texture=new Ay(null,e,t,n),this._setTextureOptions(i),this.texture.isRenderTargetTexture=!0}}class hy extends Zi{constructor(e=null,t=1,n=1,i=1){super(null),this.isData3DTexture=!0,this.image={data:e,width:t,height:n,depth:i},this.magFilter=Fa,this.minFilter=Fa,this.wrapR=Jo,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class $3 extends br{constructor(e=1,t=1,n=1,i={}){super(e,t,i),this.isWebGL3DRenderTarget=!0,this.depth=n,this.texture=new hy(null,e,t,n),this._setTextureOptions(i),this.texture.isRenderTargetTexture=!0}}class Sa{constructor(e=new ae(1/0,1/0,1/0),t=new ae(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromArray(e){this.makeEmpty();for(let t=0,n=e.length;t<n;t+=3)this.expandByPoint(gr.fromArray(e,t));return this}setFromBufferAttribute(e){this.makeEmpty();for(let t=0,n=e.count;t<n;t++)this.expandByPoint(gr.fromBufferAttribute(e,t));return this}setFromPoints(e){this.makeEmpty();for(let t=0,n=e.length;t<n;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){const n=gr.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(n),this.max.copy(e).add(n),this}setFromObject(e,t=!1){return this.makeEmpty(),this.expandByObject(e,t)}clone(){return new this.constructor().copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(e){return this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}expandByObject(e,t=!1){e.updateWorldMatrix(!1,!1);const n=e.geometry;if(n!==void 0){const s=n.getAttribute("position");if(t===!0&&s!==void 0&&e.isInstancedMesh!==!0)for(let o=0,r=s.count;o<r;o++)e.isMesh===!0?e.getVertexPosition(o,gr):gr.fromBufferAttribute(s,o),gr.applyMatrix4(e.matrixWorld),this.expandByPoint(gr);else e.boundingBox!==void 0?(e.boundingBox===null&&e.computeBoundingBox(),xm.copy(e.boundingBox)):(n.boundingBox===null&&n.computeBoundingBox(),xm.copy(n.boundingBox)),xm.applyMatrix4(e.matrixWorld),this.union(xm)}const i=e.children;for(let s=0,o=i.length;s<o;s++)this.expandByObject(i[s],t);return this}containsPoint(e){return e.x>=this.min.x&&e.x<=this.max.x&&e.y>=this.min.y&&e.y<=this.max.y&&e.z>=this.min.z&&e.z<=this.max.z}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z}getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(e){return e.max.x>=this.min.x&&e.min.x<=this.max.x&&e.max.y>=this.min.y&&e.min.y<=this.max.y&&e.max.z>=this.min.z&&e.min.z<=this.max.z}intersectsSphere(e){return this.clampPoint(e.center,gr),gr.distanceToSquared(e.center)<=e.radius*e.radius}intersectsPlane(e){let t,n;return e.normal.x>0?(t=e.normal.x*this.min.x,n=e.normal.x*this.max.x):(t=e.normal.x*this.max.x,n=e.normal.x*this.min.x),e.normal.y>0?(t+=e.normal.y*this.min.y,n+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,n+=e.normal.y*this.min.y),e.normal.z>0?(t+=e.normal.z*this.min.z,n+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,n+=e.normal.z*this.min.z),t<=-e.constant&&n>=-e.constant}intersectsTriangle(e){if(this.isEmpty())return!1;this.getCenter(Xh),Wm.subVectors(this.max,Xh),fd.subVectors(e.a,Xh),pd.subVectors(e.b,Xh),md.subVectors(e.c,Xh),ru.subVectors(pd,fd),gu.subVectors(md,pd),bI.subVectors(fd,md);let t=[0,-ru.z,ru.y,0,-gu.z,gu.y,0,-bI.z,bI.y,ru.z,0,-ru.x,gu.z,0,-gu.x,bI.z,0,-bI.x,-ru.y,ru.x,0,-gu.y,gu.x,0,-bI.y,bI.x,0];return!OG(t,fd,pd,md,Wm)||(t=[1,0,0,0,1,0,0,0,1],!OG(t,fd,pd,md,Wm))?!1:(Vm.crossVectors(ru,gu),t=[Vm.x,Vm.y,Vm.z],OG(t,fd,pd,md,Wm))}clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return this.clampPoint(e,gr).distanceTo(e)}getBoundingSphere(e){return this.isEmpty()?e.makeEmpty():(this.getCenter(e.center),e.radius=this.getSize(gr).length()*.5),e}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}applyMatrix4(e){return this.isEmpty()?this:(Og[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),Og[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),Og[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),Og[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),Og[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),Og[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),Og[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),Og[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(Og),this)}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}toJSON(){return{min:this.min.toArray(),max:this.max.toArray()}}fromJSON(e){return this.min.fromArray(e.min),this.max.fromArray(e.max),this}}const Og=[new ae,new ae,new ae,new ae,new ae,new ae,new ae,new ae],gr=new ae,xm=new Sa,fd=new ae,pd=new ae,md=new ae,ru=new ae,gu=new ae,bI=new ae,Xh=new ae,Wm=new ae,Vm=new ae,yI=new ae;function OG(a,e,t,n,i){for(let s=0,o=a.length-3;s<=o;s+=3){yI.fromArray(a,s);const r=i.x*Math.abs(yI.x)+i.y*Math.abs(yI.y)+i.z*Math.abs(yI.z),g=e.dot(yI),u=t.dot(yI),C=n.dot(yI);if(Math.max(-Math.max(g,u,C),Math.min(g,u,C))>r)return!1}return!0}const eY=new Sa,Nh=new ae,JG=new ae;class Ra{constructor(e=new ae,t=-1){this.isSphere=!0,this.center=e,this.radius=t}set(e,t){return this.center.copy(e),this.radius=t,this}setFromPoints(e,t){const n=this.center;t!==void 0?n.copy(t):eY.setFromPoints(e).getCenter(n);let i=0;for(let s=0,o=e.length;s<o;s++)i=Math.max(i,n.distanceToSquared(e[s]));return this.radius=Math.sqrt(i),this}copy(e){return this.center.copy(e.center),this.radius=e.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(e){return e.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(e){return e.distanceTo(this.center)-this.radius}intersectsSphere(e){const t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t}intersectsBox(e){return e.intersectsSphere(this)}intersectsPlane(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius}clampPoint(e,t){const n=this.center.distanceToSquared(e);return t.copy(e),n>this.radius*this.radius&&(t.sub(this.center).normalize(),t.multiplyScalar(this.radius).add(this.center)),t}getBoundingBox(e){return this.isEmpty()?(e.makeEmpty(),e):(e.set(this.center,this.center),e.expandByScalar(this.radius),e)}applyMatrix4(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this}translate(e){return this.center.add(e),this}expandByPoint(e){if(this.isEmpty())return this.center.copy(e),this.radius=0,this;Nh.subVectors(e,this.center);const t=Nh.lengthSq();if(t>this.radius*this.radius){const n=Math.sqrt(t),i=(n-this.radius)*.5;this.center.addScaledVector(Nh,i/n),this.radius+=i}return this}union(e){return e.isEmpty()?this:this.isEmpty()?(this.copy(e),this):(this.center.equals(e.center)===!0?this.radius=Math.max(this.radius,e.radius):(JG.subVectors(e.center,this.center).setLength(e.radius),this.expandByPoint(Nh.copy(e.center).add(JG)),this.expandByPoint(Nh.copy(e.center).sub(JG))),this)}equals(e){return e.center.equals(this.center)&&e.radius===this.radius}clone(){return new this.constructor().copy(this)}toJSON(){return{radius:this.radius,center:this.center.toArray()}}fromJSON(e){return this.radius=e.radius,this.center.fromArray(e.center),this}}const Jg=new ae,PG=new ae,Mm=new ae,cu=new ae,QG=new ae,Hm=new ae,jG=new ae;let AC=class{constructor(e=new ae,t=new ae(0,0,-1)){this.origin=e,this.direction=t}set(e,t){return this.origin.copy(e),this.direction.copy(t),this}copy(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this}at(e,t){return t.copy(this.origin).addScaledVector(this.direction,e)}lookAt(e){return this.direction.copy(e).sub(this.origin).normalize(),this}recast(e){return this.origin.copy(this.at(e,Jg)),this}closestPointToPoint(e,t){t.subVectors(e,this.origin);const n=t.dot(this.direction);return n<0?t.copy(this.origin):t.copy(this.origin).addScaledVector(this.direction,n)}distanceToPoint(e){return Math.sqrt(this.distanceSqToPoint(e))}distanceSqToPoint(e){const t=Jg.subVectors(e,this.origin).dot(this.direction);return t<0?this.origin.distanceToSquared(e):(Jg.copy(this.origin).addScaledVector(this.direction,t),Jg.distanceToSquared(e))}distanceSqToSegment(e,t,n,i){PG.copy(e).add(t).multiplyScalar(.5),Mm.copy(t).sub(e).normalize(),cu.copy(this.origin).sub(PG);const s=e.distanceTo(t)*.5,o=-this.direction.dot(Mm),r=cu.dot(this.direction),g=-cu.dot(Mm),u=cu.lengthSq(),C=Math.abs(1-o*o);let h,f,p,y;if(C>0)if(h=o*g-r,f=o*r-g,y=s*C,h>=0)if(f>=-y)if(f<=y){const v=1/C;h*=v,f*=v,p=h*(h+o*f+2*r)+f*(o*h+f+2*g)+u}else f=s,h=Math.max(0,-(o*f+r)),p=-h*h+f*(f+2*g)+u;else f=-s,h=Math.max(0,-(o*f+r)),p=-h*h+f*(f+2*g)+u;else f<=-y?(h=Math.max(0,-(-o*s+r)),f=h>0?-s:Math.min(Math.max(-s,-g),s),p=-h*h+f*(f+2*g)+u):f<=y?(h=0,f=Math.min(Math.max(-s,-g),s),p=f*(f+2*g)+u):(h=Math.max(0,-(o*s+r)),f=h>0?s:Math.min(Math.max(-s,-g),s),p=-h*h+f*(f+2*g)+u);else f=o>0?-s:s,h=Math.max(0,-(o*f+r)),p=-h*h+f*(f+2*g)+u;return n&&n.copy(this.origin).addScaledVector(this.direction,h),i&&i.copy(PG).addScaledVector(Mm,f),p}intersectSphere(e,t){Jg.subVectors(e.center,this.origin);const n=Jg.dot(this.direction),i=Jg.dot(Jg)-n*n,s=e.radius*e.radius;if(i>s)return null;const o=Math.sqrt(s-i),r=n-o,g=n+o;return g<0?null:r<0?this.at(g,t):this.at(r,t)}intersectsSphere(e){return e.radius<0?!1:this.distanceSqToPoint(e.center)<=e.radius*e.radius}distanceToPlane(e){const t=e.normal.dot(this.direction);if(t===0)return e.distanceToPoint(this.origin)===0?0:null;const n=-(this.origin.dot(e.normal)+e.constant)/t;return n>=0?n:null}intersectPlane(e,t){const n=this.distanceToPlane(e);return n===null?null:this.at(n,t)}intersectsPlane(e){const t=e.distanceToPoint(this.origin);return t===0||e.normal.dot(this.direction)*t<0}intersectBox(e,t){let n,i,s,o,r,g;const u=1/this.direction.x,C=1/this.direction.y,h=1/this.direction.z,f=this.origin;return u>=0?(n=(e.min.x-f.x)*u,i=(e.max.x-f.x)*u):(n=(e.max.x-f.x)*u,i=(e.min.x-f.x)*u),C>=0?(s=(e.min.y-f.y)*C,o=(e.max.y-f.y)*C):(s=(e.max.y-f.y)*C,o=(e.min.y-f.y)*C),n>o||s>i||((s>n||isNaN(n))&&(n=s),(o<i||isNaN(i))&&(i=o),h>=0?(r=(e.min.z-f.z)*h,g=(e.max.z-f.z)*h):(r=(e.max.z-f.z)*h,g=(e.min.z-f.z)*h),n>g||r>i)||((r>n||n!==n)&&(n=r),(g<i||i!==i)&&(i=g),i<0)?null:this.at(n>=0?n:i,t)}intersectsBox(e){return this.intersectBox(e,Jg)!==null}intersectTriangle(e,t,n,i,s){QG.subVectors(t,e),Hm.subVectors(n,e),jG.crossVectors(QG,Hm);let o=this.direction.dot(jG),r;if(o>0){if(i)return null;r=1}else if(o<0)r=-1,o=-o;else return null;cu.subVectors(this.origin,e);const g=r*this.direction.dot(Hm.crossVectors(cu,Hm));if(g<0)return null;const u=r*this.direction.dot(QG.cross(cu));if(u<0||g+u>o)return null;const C=-r*cu.dot(jG);return C<0?null:this.at(C/o,s)}applyMatrix4(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this}equals(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}clone(){return new this.constructor().copy(this)}};class Yt{constructor(e,t,n,i,s,o,r,g,u,C,h,f,p,y,v,G){Yt.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],e!==void 0&&this.set(e,t,n,i,s,o,r,g,u,C,h,f,p,y,v,G)}set(e,t,n,i,s,o,r,g,u,C,h,f,p,y,v,G){const B=this.elements;return B[0]=e,B[4]=t,B[8]=n,B[12]=i,B[1]=s,B[5]=o,B[9]=r,B[13]=g,B[2]=u,B[6]=C,B[10]=h,B[14]=f,B[3]=p,B[7]=y,B[11]=v,B[15]=G,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return new Yt().fromArray(this.elements)}copy(e){const t=this.elements,n=e.elements;return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],t[9]=n[9],t[10]=n[10],t[11]=n[11],t[12]=n[12],t[13]=n[13],t[14]=n[14],t[15]=n[15],this}copyPosition(e){const t=this.elements,n=e.elements;return t[12]=n[12],t[13]=n[13],t[14]=n[14],this}setFromMatrix3(e){const t=e.elements;return this.set(t[0],t[3],t[6],0,t[1],t[4],t[7],0,t[2],t[5],t[8],0,0,0,0,1),this}extractBasis(e,t,n){return e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),n.setFromMatrixColumn(this,2),this}makeBasis(e,t,n){return this.set(e.x,t.x,n.x,0,e.y,t.y,n.y,0,e.z,t.z,n.z,0,0,0,0,1),this}extractRotation(e){const t=this.elements,n=e.elements,i=1/bd.setFromMatrixColumn(e,0).length(),s=1/bd.setFromMatrixColumn(e,1).length(),o=1/bd.setFromMatrixColumn(e,2).length();return t[0]=n[0]*i,t[1]=n[1]*i,t[2]=n[2]*i,t[3]=0,t[4]=n[4]*s,t[5]=n[5]*s,t[6]=n[6]*s,t[7]=0,t[8]=n[8]*o,t[9]=n[9]*o,t[10]=n[10]*o,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromEuler(e){const t=this.elements,n=e.x,i=e.y,s=e.z,o=Math.cos(n),r=Math.sin(n),g=Math.cos(i),u=Math.sin(i),C=Math.cos(s),h=Math.sin(s);if(e.order==="XYZ"){const f=o*C,p=o*h,y=r*C,v=r*h;t[0]=g*C,t[4]=-g*h,t[8]=u,t[1]=p+y*u,t[5]=f-v*u,t[9]=-r*g,t[2]=v-f*u,t[6]=y+p*u,t[10]=o*g}else if(e.order==="YXZ"){const f=g*C,p=g*h,y=u*C,v=u*h;t[0]=f+v*r,t[4]=y*r-p,t[8]=o*u,t[1]=o*h,t[5]=o*C,t[9]=-r,t[2]=p*r-y,t[6]=v+f*r,t[10]=o*g}else if(e.order==="ZXY"){const f=g*C,p=g*h,y=u*C,v=u*h;t[0]=f-v*r,t[4]=-o*h,t[8]=y+p*r,t[1]=p+y*r,t[5]=o*C,t[9]=v-f*r,t[2]=-o*u,t[6]=r,t[10]=o*g}else if(e.order==="ZYX"){const f=o*C,p=o*h,y=r*C,v=r*h;t[0]=g*C,t[4]=y*u-p,t[8]=f*u+v,t[1]=g*h,t[5]=v*u+f,t[9]=p*u-y,t[2]=-u,t[6]=r*g,t[10]=o*g}else if(e.order==="YZX"){const f=o*g,p=o*u,y=r*g,v=r*u;t[0]=g*C,t[4]=v-f*h,t[8]=y*h+p,t[1]=h,t[5]=o*C,t[9]=-r*C,t[2]=-u*C,t[6]=p*h+y,t[10]=f-v*h}else if(e.order==="XZY"){const f=o*g,p=o*u,y=r*g,v=r*u;t[0]=g*C,t[4]=-h,t[8]=u*C,t[1]=f*h+v,t[5]=o*C,t[9]=p*h-y,t[2]=y*h-p,t[6]=r*C,t[10]=v*h+f}return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromQuaternion(e){return this.compose(tY,e,nY)}lookAt(e,t,n){const i=this.elements;return Do.subVectors(e,t),Do.lengthSq()===0&&(Do.z=1),Do.normalize(),uu.crossVectors(n,Do),uu.lengthSq()===0&&(Math.abs(n.z)===1?Do.x+=1e-4:Do.z+=1e-4,Do.normalize(),uu.crossVectors(n,Do)),uu.normalize(),Xm.crossVectors(Do,uu),i[0]=uu.x,i[4]=Xm.x,i[8]=Do.x,i[1]=uu.y,i[5]=Xm.y,i[9]=Do.y,i[2]=uu.z,i[6]=Xm.z,i[10]=Do.z,this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const n=e.elements,i=t.elements,s=this.elements,o=n[0],r=n[4],g=n[8],u=n[12],C=n[1],h=n[5],f=n[9],p=n[13],y=n[2],v=n[6],G=n[10],B=n[14],R=n[3],x=n[7],w=n[11],M=n[15],H=i[0],N=i[4],F=i[8],Y=i[12],X=i[1],U=i[5],O=i[9],P=i[13],ie=i[2],le=i[6],T=i[10],J=i[14],Q=i[3],se=i[7],L=i[11],D=i[15];return s[0]=o*H+r*X+g*ie+u*Q,s[4]=o*N+r*U+g*le+u*se,s[8]=o*F+r*O+g*T+u*L,s[12]=o*Y+r*P+g*J+u*D,s[1]=C*H+h*X+f*ie+p*Q,s[5]=C*N+h*U+f*le+p*se,s[9]=C*F+h*O+f*T+p*L,s[13]=C*Y+h*P+f*J+p*D,s[2]=y*H+v*X+G*ie+B*Q,s[6]=y*N+v*U+G*le+B*se,s[10]=y*F+v*O+G*T+B*L,s[14]=y*Y+v*P+G*J+B*D,s[3]=R*H+x*X+w*ie+M*Q,s[7]=R*N+x*U+w*le+M*se,s[11]=R*F+x*O+w*T+M*L,s[15]=R*Y+x*P+w*J+M*D,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this}determinant(){const e=this.elements,t=e[0],n=e[4],i=e[8],s=e[12],o=e[1],r=e[5],g=e[9],u=e[13],C=e[2],h=e[6],f=e[10],p=e[14],y=e[3],v=e[7],G=e[11],B=e[15];return y*(+s*g*h-i*u*h-s*r*f+n*u*f+i*r*p-n*g*p)+v*(+t*g*p-t*u*f+s*o*f-i*o*p+i*u*C-s*g*C)+G*(+t*u*h-t*r*p-s*o*h+n*o*p+s*r*C-n*u*C)+B*(-i*r*C-t*g*h+t*r*f+i*o*h-n*o*f+n*g*C)}transpose(){const e=this.elements;let t;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this}setPosition(e,t,n){const i=this.elements;return e.isVector3?(i[12]=e.x,i[13]=e.y,i[14]=e.z):(i[12]=e,i[13]=t,i[14]=n),this}invert(){const e=this.elements,t=e[0],n=e[1],i=e[2],s=e[3],o=e[4],r=e[5],g=e[6],u=e[7],C=e[8],h=e[9],f=e[10],p=e[11],y=e[12],v=e[13],G=e[14],B=e[15],R=h*G*u-v*f*u+v*g*p-r*G*p-h*g*B+r*f*B,x=y*f*u-C*G*u-y*g*p+o*G*p+C*g*B-o*f*B,w=C*v*u-y*h*u+y*r*p-o*v*p-C*r*B+o*h*B,M=y*h*g-C*v*g-y*r*f+o*v*f+C*r*G-o*h*G,H=t*R+n*x+i*w+s*M;if(H===0)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const N=1/H;return e[0]=R*N,e[1]=(v*f*s-h*G*s-v*i*p+n*G*p+h*i*B-n*f*B)*N,e[2]=(r*G*s-v*g*s+v*i*u-n*G*u-r*i*B+n*g*B)*N,e[3]=(h*g*s-r*f*s-h*i*u+n*f*u+r*i*p-n*g*p)*N,e[4]=x*N,e[5]=(C*G*s-y*f*s+y*i*p-t*G*p-C*i*B+t*f*B)*N,e[6]=(y*g*s-o*G*s-y*i*u+t*G*u+o*i*B-t*g*B)*N,e[7]=(o*f*s-C*g*s+C*i*u-t*f*u-o*i*p+t*g*p)*N,e[8]=w*N,e[9]=(y*h*s-C*v*s-y*n*p+t*v*p+C*n*B-t*h*B)*N,e[10]=(o*v*s-y*r*s+y*n*u-t*v*u-o*n*B+t*r*B)*N,e[11]=(C*r*s-o*h*s-C*n*u+t*h*u+o*n*p-t*r*p)*N,e[12]=M*N,e[13]=(C*v*i-y*h*i+y*n*f-t*v*f-C*n*G+t*h*G)*N,e[14]=(y*r*i-o*v*i-y*n*g+t*v*g+o*n*G-t*r*G)*N,e[15]=(o*h*i-C*r*i+C*n*g-t*h*g-o*n*f+t*r*f)*N,this}scale(e){const t=this.elements,n=e.x,i=e.y,s=e.z;return t[0]*=n,t[4]*=i,t[8]*=s,t[1]*=n,t[5]*=i,t[9]*=s,t[2]*=n,t[6]*=i,t[10]*=s,t[3]*=n,t[7]*=i,t[11]*=s,this}getMaxScaleOnAxis(){const e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],n=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],i=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,n,i))}makeTranslation(e,t,n){return e.isVector3?this.set(1,0,0,e.x,0,1,0,e.y,0,0,1,e.z,0,0,0,1):this.set(1,0,0,e,0,1,0,t,0,0,1,n,0,0,0,1),this}makeRotationX(e){const t=Math.cos(e),n=Math.sin(e);return this.set(1,0,0,0,0,t,-n,0,0,n,t,0,0,0,0,1),this}makeRotationY(e){const t=Math.cos(e),n=Math.sin(e);return this.set(t,0,n,0,0,1,0,0,-n,0,t,0,0,0,0,1),this}makeRotationZ(e){const t=Math.cos(e),n=Math.sin(e);return this.set(t,-n,0,0,n,t,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(e,t){const n=Math.cos(t),i=Math.sin(t),s=1-n,o=e.x,r=e.y,g=e.z,u=s*o,C=s*r;return this.set(u*o+n,u*r-i*g,u*g+i*r,0,u*r+i*g,C*r+n,C*g-i*o,0,u*g-i*r,C*g+i*o,s*g*g+n,0,0,0,0,1),this}makeScale(e,t,n){return this.set(e,0,0,0,0,t,0,0,0,0,n,0,0,0,0,1),this}makeShear(e,t,n,i,s,o){return this.set(1,n,s,0,e,1,o,0,t,i,1,0,0,0,0,1),this}compose(e,t,n){const i=this.elements,s=t._x,o=t._y,r=t._z,g=t._w,u=s+s,C=o+o,h=r+r,f=s*u,p=s*C,y=s*h,v=o*C,G=o*h,B=r*h,R=g*u,x=g*C,w=g*h,M=n.x,H=n.y,N=n.z;return i[0]=(1-(v+B))*M,i[1]=(p+w)*M,i[2]=(y-x)*M,i[3]=0,i[4]=(p-w)*H,i[5]=(1-(f+B))*H,i[6]=(G+R)*H,i[7]=0,i[8]=(y+x)*N,i[9]=(G-R)*N,i[10]=(1-(f+v))*N,i[11]=0,i[12]=e.x,i[13]=e.y,i[14]=e.z,i[15]=1,this}decompose(e,t,n){const i=this.elements;let s=bd.set(i[0],i[1],i[2]).length();const o=bd.set(i[4],i[5],i[6]).length(),r=bd.set(i[8],i[9],i[10]).length();this.determinant()<0&&(s=-s),e.x=i[12],e.y=i[13],e.z=i[14],cr.copy(this);const u=1/s,C=1/o,h=1/r;return cr.elements[0]*=u,cr.elements[1]*=u,cr.elements[2]*=u,cr.elements[4]*=C,cr.elements[5]*=C,cr.elements[6]*=C,cr.elements[8]*=h,cr.elements[9]*=h,cr.elements[10]*=h,t.setFromRotationMatrix(cr),n.x=s,n.y=o,n.z=r,this}makePerspective(e,t,n,i,s,o,r=Gl){const g=this.elements,u=2*s/(t-e),C=2*s/(n-i),h=(t+e)/(t-e),f=(n+i)/(n-i);let p,y;if(r===Gl)p=-(o+s)/(o-s),y=-2*o*s/(o-s);else if(r===Vf)p=-o/(o-s),y=-o*s/(o-s);else throw new Error("THREE.Matrix4.makePerspective(): Invalid coordinate system: "+r);return g[0]=u,g[4]=0,g[8]=h,g[12]=0,g[1]=0,g[5]=C,g[9]=f,g[13]=0,g[2]=0,g[6]=0,g[10]=p,g[14]=y,g[3]=0,g[7]=0,g[11]=-1,g[15]=0,this}makeOrthographic(e,t,n,i,s,o,r=Gl){const g=this.elements,u=1/(t-e),C=1/(n-i),h=1/(o-s),f=(t+e)*u,p=(n+i)*C;let y,v;if(r===Gl)y=(o+s)*h,v=-2*h;else if(r===Vf)y=s*h,v=-1*h;else throw new Error("THREE.Matrix4.makeOrthographic(): Invalid coordinate system: "+r);return g[0]=2*u,g[4]=0,g[8]=0,g[12]=-f,g[1]=0,g[5]=2*C,g[9]=0,g[13]=-p,g[2]=0,g[6]=0,g[10]=v,g[14]=-y,g[3]=0,g[7]=0,g[11]=0,g[15]=1,this}equals(e){const t=this.elements,n=e.elements;for(let i=0;i<16;i++)if(t[i]!==n[i])return!1;return!0}fromArray(e,t=0){for(let n=0;n<16;n++)this.elements[n]=e[n+t];return this}toArray(e=[],t=0){const n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e[t+9]=n[9],e[t+10]=n[10],e[t+11]=n[11],e[t+12]=n[12],e[t+13]=n[13],e[t+14]=n[14],e[t+15]=n[15],e}}const bd=new ae,cr=new Yt,tY=new ae(0,0,0),nY=new ae(1,1,1),uu=new ae,Xm=new ae,Do=new ae,sR=new Yt,oR=new ca;class to{constructor(e=0,t=0,n=0,i=to.DEFAULT_ORDER){this.isEuler=!0,this._x=e,this._y=t,this._z=n,this._order=i}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get order(){return this._order}set order(e){this._order=e,this._onChangeCallback()}set(e,t,n,i=this._order){return this._x=e,this._y=t,this._z=n,this._order=i,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this}setFromRotationMatrix(e,t=this._order,n=!0){const i=e.elements,s=i[0],o=i[4],r=i[8],g=i[1],u=i[5],C=i[9],h=i[2],f=i[6],p=i[10];switch(t){case"XYZ":this._y=Math.asin(ln(r,-1,1)),Math.abs(r)<.9999999?(this._x=Math.atan2(-C,p),this._z=Math.atan2(-o,s)):(this._x=Math.atan2(f,u),this._z=0);break;case"YXZ":this._x=Math.asin(-ln(C,-1,1)),Math.abs(C)<.9999999?(this._y=Math.atan2(r,p),this._z=Math.atan2(g,u)):(this._y=Math.atan2(-h,s),this._z=0);break;case"ZXY":this._x=Math.asin(ln(f,-1,1)),Math.abs(f)<.9999999?(this._y=Math.atan2(-h,p),this._z=Math.atan2(-o,u)):(this._y=0,this._z=Math.atan2(g,s));break;case"ZYX":this._y=Math.asin(-ln(h,-1,1)),Math.abs(h)<.9999999?(this._x=Math.atan2(f,p),this._z=Math.atan2(g,s)):(this._x=0,this._z=Math.atan2(-o,u));break;case"YZX":this._z=Math.asin(ln(g,-1,1)),Math.abs(g)<.9999999?(this._x=Math.atan2(-C,u),this._y=Math.atan2(-h,s)):(this._x=0,this._y=Math.atan2(r,p));break;case"XZY":this._z=Math.asin(-ln(o,-1,1)),Math.abs(o)<.9999999?(this._x=Math.atan2(f,u),this._y=Math.atan2(r,s)):(this._x=Math.atan2(-C,p),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+t)}return this._order=t,n===!0&&this._onChangeCallback(),this}setFromQuaternion(e,t,n){return sR.makeRotationFromQuaternion(e),this.setFromRotationMatrix(sR,t,n)}setFromVector3(e,t=this._order){return this.set(e.x,e.y,e.z,t)}reorder(e){return oR.setFromEuler(this),this.setFromQuaternion(oR,e)}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order}fromArray(e){return this._x=e[0],this._y=e[1],this._z=e[2],e[3]!==void 0&&(this._order=e[3]),this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._order,e}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}}to.DEFAULT_ORDER="XYZ";class aA{constructor(){this.mask=1}set(e){this.mask=(1<<e|0)>>>0}enable(e){this.mask|=1<<e|0}enableAll(){this.mask=-1}toggle(e){this.mask^=1<<e|0}disable(e){this.mask&=~(1<<e|0)}disableAll(){this.mask=0}test(e){return(this.mask&e.mask)!==0}isEnabled(e){return(this.mask&(1<<e|0))!==0}}let iY=0;const lR=new ae,yd=new ca,Pg=new Yt,Nm=new ae,Yh=new ae,aY=new ae,sY=new ca,rR=new ae(1,0,0),gR=new ae(0,1,0),cR=new ae(0,0,1),uR={type:"added"},oY={type:"removed"},Gd={type:"childadded",child:null},qG={type:"childremoved",child:null};class wn extends bg{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:iY++}),this.uuid=Po(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=wn.DEFAULT_UP.clone();const e=new ae,t=new to,n=new ca,i=new ae(1,1,1);function s(){n.setFromEuler(t,!1)}function o(){t.setFromQuaternion(n,void 0,!1)}t._onChange(s),n._onChange(o),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:e},rotation:{configurable:!0,enumerable:!0,value:t},quaternion:{configurable:!0,enumerable:!0,value:n},scale:{configurable:!0,enumerable:!0,value:i},modelViewMatrix:{value:new Yt},normalMatrix:{value:new on}}),this.matrix=new Yt,this.matrixWorld=new Yt,this.matrixAutoUpdate=wn.DEFAULT_MATRIX_AUTO_UPDATE,this.matrixWorldAutoUpdate=wn.DEFAULT_MATRIX_WORLD_AUTO_UPDATE,this.matrixWorldNeedsUpdate=!1,this.layers=new aA,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.customDepthMaterial=void 0,this.customDistanceMaterial=void 0,this.userData={}}onBeforeShadow(){}onAfterShadow(){}onBeforeRender(){}onAfterRender(){}applyMatrix4(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(e){return this.quaternion.premultiply(e),this}setRotationFromAxisAngle(e,t){this.quaternion.setFromAxisAngle(e,t)}setRotationFromEuler(e){this.quaternion.setFromEuler(e,!0)}setRotationFromMatrix(e){this.quaternion.setFromRotationMatrix(e)}setRotationFromQuaternion(e){this.quaternion.copy(e)}rotateOnAxis(e,t){return yd.setFromAxisAngle(e,t),this.quaternion.multiply(yd),this}rotateOnWorldAxis(e,t){return yd.setFromAxisAngle(e,t),this.quaternion.premultiply(yd),this}rotateX(e){return this.rotateOnAxis(rR,e)}rotateY(e){return this.rotateOnAxis(gR,e)}rotateZ(e){return this.rotateOnAxis(cR,e)}translateOnAxis(e,t){return lR.copy(e).applyQuaternion(this.quaternion),this.position.add(lR.multiplyScalar(t)),this}translateX(e){return this.translateOnAxis(rR,e)}translateY(e){return this.translateOnAxis(gR,e)}translateZ(e){return this.translateOnAxis(cR,e)}localToWorld(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(this.matrixWorld)}worldToLocal(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(Pg.copy(this.matrixWorld).invert())}lookAt(e,t,n){e.isVector3?Nm.copy(e):Nm.set(e,t,n);const i=this.parent;this.updateWorldMatrix(!0,!1),Yh.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?Pg.lookAt(Yh,Nm,this.up):Pg.lookAt(Nm,Yh,this.up),this.quaternion.setFromRotationMatrix(Pg),i&&(Pg.extractRotation(i.matrixWorld),yd.setFromRotationMatrix(Pg),this.quaternion.premultiply(yd.invert()))}add(e){if(arguments.length>1){for(let t=0;t<arguments.length;t++)this.add(arguments[t]);return this}return e===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",e),this):(e&&e.isObject3D?(e.removeFromParent(),e.parent=this,this.children.push(e),e.dispatchEvent(uR),Gd.child=e,this.dispatchEvent(Gd),Gd.child=null):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e),this)}remove(e){if(arguments.length>1){for(let n=0;n<arguments.length;n++)this.remove(arguments[n]);return this}const t=this.children.indexOf(e);return t!==-1&&(e.parent=null,this.children.splice(t,1),e.dispatchEvent(oY),qG.child=e,this.dispatchEvent(qG),qG.child=null),this}removeFromParent(){const e=this.parent;return e!==null&&e.remove(this),this}clear(){return this.remove(...this.children)}attach(e){return this.updateWorldMatrix(!0,!1),Pg.copy(this.matrixWorld).invert(),e.parent!==null&&(e.parent.updateWorldMatrix(!0,!1),Pg.multiply(e.parent.matrixWorld)),e.applyMatrix4(Pg),e.removeFromParent(),e.parent=this,this.children.push(e),e.updateWorldMatrix(!1,!0),e.dispatchEvent(uR),Gd.child=e,this.dispatchEvent(Gd),Gd.child=null,this}getObjectById(e){return this.getObjectByProperty("id",e)}getObjectByName(e){return this.getObjectByProperty("name",e)}getObjectByProperty(e,t){if(this[e]===t)return this;for(let n=0,i=this.children.length;n<i;n++){const o=this.children[n].getObjectByProperty(e,t);if(o!==void 0)return o}}getObjectsByProperty(e,t,n=[]){this[e]===t&&n.push(this);const i=this.children;for(let s=0,o=i.length;s<o;s++)i[s].getObjectsByProperty(e,t,n);return n}getWorldPosition(e){return this.updateWorldMatrix(!0,!1),e.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Yh,e,aY),e}getWorldScale(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Yh,sY,e),e}getWorldDirection(e){this.updateWorldMatrix(!0,!1);const t=this.matrixWorld.elements;return e.set(t[8],t[9],t[10]).normalize()}raycast(){}traverse(e){e(this);const t=this.children;for(let n=0,i=t.length;n<i;n++)t[n].traverse(e)}traverseVisible(e){if(this.visible===!1)return;e(this);const t=this.children;for(let n=0,i=t.length;n<i;n++)t[n].traverseVisible(e)}traverseAncestors(e){const t=this.parent;t!==null&&(e(t),t.traverseAncestors(e))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(this.matrixWorldAutoUpdate===!0&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),this.matrixWorldNeedsUpdate=!1,e=!0);const t=this.children;for(let n=0,i=t.length;n<i;n++)t[n].updateMatrixWorld(e)}updateWorldMatrix(e,t){const n=this.parent;if(e===!0&&n!==null&&n.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),this.matrixWorldAutoUpdate===!0&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),t===!0){const i=this.children;for(let s=0,o=i.length;s<o;s++)i[s].updateWorldMatrix(!1,!0)}}toJSON(e){const t=e===void 0||typeof e=="string",n={};t&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},n.metadata={version:4.7,type:"Object",generator:"Object3D.toJSON"});const i={};i.uuid=this.uuid,i.type=this.type,this.name!==""&&(i.name=this.name),this.castShadow===!0&&(i.castShadow=!0),this.receiveShadow===!0&&(i.receiveShadow=!0),this.visible===!1&&(i.visible=!1),this.frustumCulled===!1&&(i.frustumCulled=!1),this.renderOrder!==0&&(i.renderOrder=this.renderOrder),Object.keys(this.userData).length>0&&(i.userData=this.userData),i.layers=this.layers.mask,i.matrix=this.matrix.toArray(),i.up=this.up.toArray(),this.matrixAutoUpdate===!1&&(i.matrixAutoUpdate=!1),this.isInstancedMesh&&(i.type="InstancedMesh",i.count=this.count,i.instanceMatrix=this.instanceMatrix.toJSON(),this.instanceColor!==null&&(i.instanceColor=this.instanceColor.toJSON())),this.isBatchedMesh&&(i.type="BatchedMesh",i.perObjectFrustumCulled=this.perObjectFrustumCulled,i.sortObjects=this.sortObjects,i.drawRanges=this._drawRanges,i.reservedRanges=this._reservedRanges,i.geometryInfo=this._geometryInfo.map(r=>({...r,boundingBox:r.boundingBox?r.boundingBox.toJSON():void 0,boundingSphere:r.boundingSphere?r.boundingSphere.toJSON():void 0})),i.instanceInfo=this._instanceInfo.map(r=>({...r})),i.availableInstanceIds=this._availableInstanceIds.slice(),i.availableGeometryIds=this._availableGeometryIds.slice(),i.nextIndexStart=this._nextIndexStart,i.nextVertexStart=this._nextVertexStart,i.geometryCount=this._geometryCount,i.maxInstanceCount=this._maxInstanceCount,i.maxVertexCount=this._maxVertexCount,i.maxIndexCount=this._maxIndexCount,i.geometryInitialized=this._geometryInitialized,i.matricesTexture=this._matricesTexture.toJSON(e),i.indirectTexture=this._indirectTexture.toJSON(e),this._colorsTexture!==null&&(i.colorsTexture=this._colorsTexture.toJSON(e)),this.boundingSphere!==null&&(i.boundingSphere=this.boundingSphere.toJSON()),this.boundingBox!==null&&(i.boundingBox=this.boundingBox.toJSON()));function s(r,g){return r[g.uuid]===void 0&&(r[g.uuid]=g.toJSON(e)),g.uuid}if(this.isScene)this.background&&(this.background.isColor?i.background=this.background.toJSON():this.background.isTexture&&(i.background=this.background.toJSON(e).uuid)),this.environment&&this.environment.isTexture&&this.environment.isRenderTargetTexture!==!0&&(i.environment=this.environment.toJSON(e).uuid);else if(this.isMesh||this.isLine||this.isPoints){i.geometry=s(e.geometries,this.geometry);const r=this.geometry.parameters;if(r!==void 0&&r.shapes!==void 0){const g=r.shapes;if(Array.isArray(g))for(let u=0,C=g.length;u<C;u++){const h=g[u];s(e.shapes,h)}else s(e.shapes,g)}}if(this.isSkinnedMesh&&(i.bindMode=this.bindMode,i.bindMatrix=this.bindMatrix.toArray(),this.skeleton!==void 0&&(s(e.skeletons,this.skeleton),i.skeleton=this.skeleton.uuid)),this.material!==void 0)if(Array.isArray(this.material)){const r=[];for(let g=0,u=this.material.length;g<u;g++)r.push(s(e.materials,this.material[g]));i.material=r}else i.material=s(e.materials,this.material);if(this.children.length>0){i.children=[];for(let r=0;r<this.children.length;r++)i.children.push(this.children[r].toJSON(e).object)}if(this.animations.length>0){i.animations=[];for(let r=0;r<this.animations.length;r++){const g=this.animations[r];i.animations.push(s(e.animations,g))}}if(t){const r=o(e.geometries),g=o(e.materials),u=o(e.textures),C=o(e.images),h=o(e.shapes),f=o(e.skeletons),p=o(e.animations),y=o(e.nodes);r.length>0&&(n.geometries=r),g.length>0&&(n.materials=g),u.length>0&&(n.textures=u),C.length>0&&(n.images=C),h.length>0&&(n.shapes=h),f.length>0&&(n.skeletons=f),p.length>0&&(n.animations=p),y.length>0&&(n.nodes=y)}return n.object=i,n;function o(r){const g=[];for(const u in r){const C=r[u];delete C.metadata,g.push(C)}return g}}clone(e){return new this.constructor().copy(this,e)}copy(e,t=!0){if(this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.rotation.order=e.rotation.order,this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldAutoUpdate=e.matrixWorldAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.animations=e.animations.slice(),this.userData=JSON.parse(JSON.stringify(e.userData)),t===!0)for(let n=0;n<e.children.length;n++){const i=e.children[n];this.add(i.clone())}return this}}wn.DEFAULT_UP=new ae(0,1,0);wn.DEFAULT_MATRIX_AUTO_UPDATE=!0;wn.DEFAULT_MATRIX_WORLD_AUTO_UPDATE=!0;const ur=new ae,Qg=new ae,$G=new ae,jg=new ae,Bd=new ae,vd=new ae,IR=new ae,eB=new ae,tB=new ae,nB=new ae,iB=new Hn,aB=new Hn,sB=new Hn;class Ro{constructor(e=new ae,t=new ae,n=new ae){this.a=e,this.b=t,this.c=n}static getNormal(e,t,n,i){i.subVectors(n,t),ur.subVectors(e,t),i.cross(ur);const s=i.lengthSq();return s>0?i.multiplyScalar(1/Math.sqrt(s)):i.set(0,0,0)}static getBarycoord(e,t,n,i,s){ur.subVectors(i,t),Qg.subVectors(n,t),$G.subVectors(e,t);const o=ur.dot(ur),r=ur.dot(Qg),g=ur.dot($G),u=Qg.dot(Qg),C=Qg.dot($G),h=o*u-r*r;if(h===0)return s.set(0,0,0),null;const f=1/h,p=(u*g-r*C)*f,y=(o*C-r*g)*f;return s.set(1-p-y,y,p)}static containsPoint(e,t,n,i){return this.getBarycoord(e,t,n,i,jg)===null?!1:jg.x>=0&&jg.y>=0&&jg.x+jg.y<=1}static getInterpolation(e,t,n,i,s,o,r,g){return this.getBarycoord(e,t,n,i,jg)===null?(g.x=0,g.y=0,"z"in g&&(g.z=0),"w"in g&&(g.w=0),null):(g.setScalar(0),g.addScaledVector(s,jg.x),g.addScaledVector(o,jg.y),g.addScaledVector(r,jg.z),g)}static getInterpolatedAttribute(e,t,n,i,s,o){return iB.setScalar(0),aB.setScalar(0),sB.setScalar(0),iB.fromBufferAttribute(e,t),aB.fromBufferAttribute(e,n),sB.fromBufferAttribute(e,i),o.setScalar(0),o.addScaledVector(iB,s.x),o.addScaledVector(aB,s.y),o.addScaledVector(sB,s.z),o}static isFrontFacing(e,t,n,i){return ur.subVectors(n,t),Qg.subVectors(e,t),ur.cross(Qg).dot(i)<0}set(e,t,n){return this.a.copy(e),this.b.copy(t),this.c.copy(n),this}setFromPointsAndIndices(e,t,n,i){return this.a.copy(e[t]),this.b.copy(e[n]),this.c.copy(e[i]),this}setFromAttributeAndIndices(e,t,n,i){return this.a.fromBufferAttribute(e,t),this.b.fromBufferAttribute(e,n),this.c.fromBufferAttribute(e,i),this}clone(){return new this.constructor().copy(this)}copy(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this}getArea(){return ur.subVectors(this.c,this.b),Qg.subVectors(this.a,this.b),ur.cross(Qg).length()*.5}getMidpoint(e){return e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(e){return Ro.getNormal(this.a,this.b,this.c,e)}getPlane(e){return e.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(e,t){return Ro.getBarycoord(e,this.a,this.b,this.c,t)}getInterpolation(e,t,n,i,s){return Ro.getInterpolation(e,this.a,this.b,this.c,t,n,i,s)}containsPoint(e){return Ro.containsPoint(e,this.a,this.b,this.c)}isFrontFacing(e){return Ro.isFrontFacing(this.a,this.b,this.c,e)}intersectsBox(e){return e.intersectsTriangle(this)}closestPointToPoint(e,t){const n=this.a,i=this.b,s=this.c;let o,r;Bd.subVectors(i,n),vd.subVectors(s,n),eB.subVectors(e,n);const g=Bd.dot(eB),u=vd.dot(eB);if(g<=0&&u<=0)return t.copy(n);tB.subVectors(e,i);const C=Bd.dot(tB),h=vd.dot(tB);if(C>=0&&h<=C)return t.copy(i);const f=g*h-C*u;if(f<=0&&g>=0&&C<=0)return o=g/(g-C),t.copy(n).addScaledVector(Bd,o);nB.subVectors(e,s);const p=Bd.dot(nB),y=vd.dot(nB);if(y>=0&&p<=y)return t.copy(s);const v=p*u-g*y;if(v<=0&&u>=0&&y<=0)return r=u/(u-y),t.copy(n).addScaledVector(vd,r);const G=C*y-p*h;if(G<=0&&h-C>=0&&p-y>=0)return IR.subVectors(s,i),r=(h-C)/(h-C+(p-y)),t.copy(i).addScaledVector(IR,r);const B=1/(G+v+f);return o=v*B,r=f*B,t.copy(n).addScaledVector(Bd,o).addScaledVector(vd,r)}equals(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}}const MV={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},Iu={h:0,s:0,l:0},Ym={h:0,s:0,l:0};function oB(a,e,t){return t<0&&(t+=1),t>1&&(t-=1),t<1/6?a+(e-a)*6*t:t<1/2?e:t<2/3?a+(e-a)*6*(2/3-t):a}let Gt=class{constructor(e,t,n){return this.isColor=!0,this.r=1,this.g=1,this.b=1,this.set(e,t,n)}set(e,t,n){if(t===void 0&&n===void 0){const i=e;i&&i.isColor?this.copy(i):typeof i=="number"?this.setHex(i):typeof i=="string"&&this.setStyle(i)}else this.setRGB(e,t,n);return this}setScalar(e){return this.r=e,this.g=e,this.b=e,this}setHex(e,t=ys){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(e&255)/255,Mn.colorSpaceToWorking(this,t),this}setRGB(e,t,n,i=Mn.workingColorSpace){return this.r=e,this.g=t,this.b=n,Mn.colorSpaceToWorking(this,i),this}setHSL(e,t,n,i=Mn.workingColorSpace){if(e=q2(e,1),t=ln(t,0,1),n=ln(n,0,1),t===0)this.r=this.g=this.b=n;else{const s=n<=.5?n*(1+t):n+t-n*t,o=2*n-s;this.r=oB(o,s,e+1/3),this.g=oB(o,s,e),this.b=oB(o,s,e-1/3)}return Mn.colorSpaceToWorking(this,i),this}setStyle(e,t=ys){function n(s){s!==void 0&&parseFloat(s)<1&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}let i;if(i=/^(\w+)\(([^\)]*)\)/.exec(e)){let s;const o=i[1],r=i[2];switch(o){case"rgb":case"rgba":if(s=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(r))return n(s[4]),this.setRGB(Math.min(255,parseInt(s[1],10))/255,Math.min(255,parseInt(s[2],10))/255,Math.min(255,parseInt(s[3],10))/255,t);if(s=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(r))return n(s[4]),this.setRGB(Math.min(100,parseInt(s[1],10))/100,Math.min(100,parseInt(s[2],10))/100,Math.min(100,parseInt(s[3],10))/100,t);break;case"hsl":case"hsla":if(s=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(r))return n(s[4]),this.setHSL(parseFloat(s[1])/360,parseFloat(s[2])/100,parseFloat(s[3])/100,t);break;default:console.warn("THREE.Color: Unknown color model "+e)}}else if(i=/^\#([A-Fa-f\d]+)$/.exec(e)){const s=i[1],o=s.length;if(o===3)return this.setRGB(parseInt(s.charAt(0),16)/15,parseInt(s.charAt(1),16)/15,parseInt(s.charAt(2),16)/15,t);if(o===6)return this.setHex(parseInt(s,16),t);console.warn("THREE.Color: Invalid hex color "+e)}else if(e&&e.length>0)return this.setColorName(e,t);return this}setColorName(e,t=ys){const n=MV[e.toLowerCase()];return n!==void 0?this.setHex(n,t):console.warn("THREE.Color: Unknown color "+e),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}copySRGBToLinear(e){return this.r=uc(e.r),this.g=uc(e.g),this.b=uc(e.b),this}copyLinearToSRGB(e){return this.r=kd(e.r),this.g=kd(e.g),this.b=kd(e.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(e=ys){return Mn.workingToColorSpace(fs.copy(this),e),Math.round(ln(fs.r*255,0,255))*65536+Math.round(ln(fs.g*255,0,255))*256+Math.round(ln(fs.b*255,0,255))}getHexString(e=ys){return("000000"+this.getHex(e).toString(16)).slice(-6)}getHSL(e,t=Mn.workingColorSpace){Mn.workingToColorSpace(fs.copy(this),t);const n=fs.r,i=fs.g,s=fs.b,o=Math.max(n,i,s),r=Math.min(n,i,s);let g,u;const C=(r+o)/2;if(r===o)g=0,u=0;else{const h=o-r;switch(u=C<=.5?h/(o+r):h/(2-o-r),o){case n:g=(i-s)/h+(i<s?6:0);break;case i:g=(s-n)/h+2;break;case s:g=(n-i)/h+4;break}g/=6}return e.h=g,e.s=u,e.l=C,e}getRGB(e,t=Mn.workingColorSpace){return Mn.workingToColorSpace(fs.copy(this),t),e.r=fs.r,e.g=fs.g,e.b=fs.b,e}getStyle(e=ys){Mn.workingToColorSpace(fs.copy(this),e);const t=fs.r,n=fs.g,i=fs.b;return e!==ys?`color(${e} ${t.toFixed(3)} ${n.toFixed(3)} ${i.toFixed(3)})`:`rgb(${Math.round(t*255)},${Math.round(n*255)},${Math.round(i*255)})`}offsetHSL(e,t,n){return this.getHSL(Iu),this.setHSL(Iu.h+e,Iu.s+t,Iu.l+n)}add(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}addColors(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this}addScalar(e){return this.r+=e,this.g+=e,this.b+=e,this}sub(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this}multiply(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}multiplyScalar(e){return this.r*=e,this.g*=e,this.b*=e,this}lerp(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this}lerpColors(e,t,n){return this.r=e.r+(t.r-e.r)*n,this.g=e.g+(t.g-e.g)*n,this.b=e.b+(t.b-e.b)*n,this}lerpHSL(e,t){this.getHSL(Iu),e.getHSL(Ym);const n=hf(Iu.h,Ym.h,t),i=hf(Iu.s,Ym.s,t),s=hf(Iu.l,Ym.l,t);return this.setHSL(n,i,s),this}setFromVector3(e){return this.r=e.x,this.g=e.y,this.b=e.z,this}applyMatrix3(e){const t=this.r,n=this.g,i=this.b,s=e.elements;return this.r=s[0]*t+s[3]*n+s[6]*i,this.g=s[1]*t+s[4]*n+s[7]*i,this.b=s[2]*t+s[5]*n+s[8]*i,this}equals(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}fromArray(e,t=0){return this.r=e[t],this.g=e[t+1],this.b=e[t+2],this}toArray(e=[],t=0){return e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e}fromBufferAttribute(e,t){return this.r=e.getX(t),this.g=e.getY(t),this.b=e.getZ(t),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}};const fs=new Gt;Gt.NAMES=MV;let lY=0;class fa extends bg{constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:lY++}),this.uuid=Po(),this.name="",this.type="Material",this.blending=qI,this.side=fg,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.alphaHash=!1,this.blendSrc=jb,this.blendDst=qb,this.blendEquation=fu,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.blendColor=new Gt(0,0,0),this.blendAlpha=0,this.depthFunc=sC,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=zv,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=FI,this.stencilZFail=FI,this.stencilZPass=FI,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.forceSinglePass=!1,this.allowOverride=!0,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(e){this._alphaTest>0!=e>0&&this.version++,this._alphaTest=e}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(e){if(e!==void 0)for(const t in e){const n=e[t];if(n===void 0){console.warn(`THREE.Material: parameter '${t}' has value of undefined.`);continue}const i=this[t];if(i===void 0){console.warn(`THREE.Material: '${t}' is not a property of THREE.${this.type}.`);continue}i&&i.isColor?i.set(n):i&&i.isVector3&&n&&n.isVector3?i.copy(n):this[t]=n}}toJSON(e){const t=e===void 0||typeof e=="string";t&&(e={textures:{},images:{}});const n={metadata:{version:4.7,type:"Material",generator:"Material.toJSON"}};n.uuid=this.uuid,n.type=this.type,this.name!==""&&(n.name=this.name),this.color&&this.color.isColor&&(n.color=this.color.getHex()),this.roughness!==void 0&&(n.roughness=this.roughness),this.metalness!==void 0&&(n.metalness=this.metalness),this.sheen!==void 0&&(n.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(n.sheenColor=this.sheenColor.getHex()),this.sheenRoughness!==void 0&&(n.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(n.emissive=this.emissive.getHex()),this.emissiveIntensity!==void 0&&this.emissiveIntensity!==1&&(n.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(n.specular=this.specular.getHex()),this.specularIntensity!==void 0&&(n.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(n.specularColor=this.specularColor.getHex()),this.shininess!==void 0&&(n.shininess=this.shininess),this.clearcoat!==void 0&&(n.clearcoat=this.clearcoat),this.clearcoatRoughness!==void 0&&(n.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(n.clearcoatMap=this.clearcoatMap.toJSON(e).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(n.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(e).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(n.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(e).uuid,n.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.dispersion!==void 0&&(n.dispersion=this.dispersion),this.iridescence!==void 0&&(n.iridescence=this.iridescence),this.iridescenceIOR!==void 0&&(n.iridescenceIOR=this.iridescenceIOR),this.iridescenceThicknessRange!==void 0&&(n.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(n.iridescenceMap=this.iridescenceMap.toJSON(e).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(n.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(e).uuid),this.anisotropy!==void 0&&(n.anisotropy=this.anisotropy),this.anisotropyRotation!==void 0&&(n.anisotropyRotation=this.anisotropyRotation),this.anisotropyMap&&this.anisotropyMap.isTexture&&(n.anisotropyMap=this.anisotropyMap.toJSON(e).uuid),this.map&&this.map.isTexture&&(n.map=this.map.toJSON(e).uuid),this.matcap&&this.matcap.isTexture&&(n.matcap=this.matcap.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(n.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(n.lightMap=this.lightMap.toJSON(e).uuid,n.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(n.aoMap=this.aoMap.toJSON(e).uuid,n.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(n.bumpMap=this.bumpMap.toJSON(e).uuid,n.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(n.normalMap=this.normalMap.toJSON(e).uuid,n.normalMapType=this.normalMapType,n.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(n.displacementMap=this.displacementMap.toJSON(e).uuid,n.displacementScale=this.displacementScale,n.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(n.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(n.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(n.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(n.specularMap=this.specularMap.toJSON(e).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(n.specularIntensityMap=this.specularIntensityMap.toJSON(e).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(n.specularColorMap=this.specularColorMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(n.envMap=this.envMap.toJSON(e).uuid,this.combine!==void 0&&(n.combine=this.combine)),this.envMapRotation!==void 0&&(n.envMapRotation=this.envMapRotation.toArray()),this.envMapIntensity!==void 0&&(n.envMapIntensity=this.envMapIntensity),this.reflectivity!==void 0&&(n.reflectivity=this.reflectivity),this.refractionRatio!==void 0&&(n.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(n.gradientMap=this.gradientMap.toJSON(e).uuid),this.transmission!==void 0&&(n.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(n.transmissionMap=this.transmissionMap.toJSON(e).uuid),this.thickness!==void 0&&(n.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(n.thicknessMap=this.thicknessMap.toJSON(e).uuid),this.attenuationDistance!==void 0&&this.attenuationDistance!==1/0&&(n.attenuationDistance=this.attenuationDistance),this.attenuationColor!==void 0&&(n.attenuationColor=this.attenuationColor.getHex()),this.size!==void 0&&(n.size=this.size),this.shadowSide!==null&&(n.shadowSide=this.shadowSide),this.sizeAttenuation!==void 0&&(n.sizeAttenuation=this.sizeAttenuation),this.blending!==qI&&(n.blending=this.blending),this.side!==fg&&(n.side=this.side),this.vertexColors===!0&&(n.vertexColors=!0),this.opacity<1&&(n.opacity=this.opacity),this.transparent===!0&&(n.transparent=!0),this.blendSrc!==jb&&(n.blendSrc=this.blendSrc),this.blendDst!==qb&&(n.blendDst=this.blendDst),this.blendEquation!==fu&&(n.blendEquation=this.blendEquation),this.blendSrcAlpha!==null&&(n.blendSrcAlpha=this.blendSrcAlpha),this.blendDstAlpha!==null&&(n.blendDstAlpha=this.blendDstAlpha),this.blendEquationAlpha!==null&&(n.blendEquationAlpha=this.blendEquationAlpha),this.blendColor&&this.blendColor.isColor&&(n.blendColor=this.blendColor.getHex()),this.blendAlpha!==0&&(n.blendAlpha=this.blendAlpha),this.depthFunc!==sC&&(n.depthFunc=this.depthFunc),this.depthTest===!1&&(n.depthTest=this.depthTest),this.depthWrite===!1&&(n.depthWrite=this.depthWrite),this.colorWrite===!1&&(n.colorWrite=this.colorWrite),this.stencilWriteMask!==255&&(n.stencilWriteMask=this.stencilWriteMask),this.stencilFunc!==zv&&(n.stencilFunc=this.stencilFunc),this.stencilRef!==0&&(n.stencilRef=this.stencilRef),this.stencilFuncMask!==255&&(n.stencilFuncMask=this.stencilFuncMask),this.stencilFail!==FI&&(n.stencilFail=this.stencilFail),this.stencilZFail!==FI&&(n.stencilZFail=this.stencilZFail),this.stencilZPass!==FI&&(n.stencilZPass=this.stencilZPass),this.stencilWrite===!0&&(n.stencilWrite=this.stencilWrite),this.rotation!==void 0&&this.rotation!==0&&(n.rotation=this.rotation),this.polygonOffset===!0&&(n.polygonOffset=!0),this.polygonOffsetFactor!==0&&(n.polygonOffsetFactor=this.polygonOffsetFactor),this.polygonOffsetUnits!==0&&(n.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth!==void 0&&this.linewidth!==1&&(n.linewidth=this.linewidth),this.dashSize!==void 0&&(n.dashSize=this.dashSize),this.gapSize!==void 0&&(n.gapSize=this.gapSize),this.scale!==void 0&&(n.scale=this.scale),this.dithering===!0&&(n.dithering=!0),this.alphaTest>0&&(n.alphaTest=this.alphaTest),this.alphaHash===!0&&(n.alphaHash=!0),this.alphaToCoverage===!0&&(n.alphaToCoverage=!0),this.premultipliedAlpha===!0&&(n.premultipliedAlpha=!0),this.forceSinglePass===!0&&(n.forceSinglePass=!0),this.wireframe===!0&&(n.wireframe=!0),this.wireframeLinewidth>1&&(n.wireframeLinewidth=this.wireframeLinewidth),this.wireframeLinecap!=="round"&&(n.wireframeLinecap=this.wireframeLinecap),this.wireframeLinejoin!=="round"&&(n.wireframeLinejoin=this.wireframeLinejoin),this.flatShading===!0&&(n.flatShading=!0),this.visible===!1&&(n.visible=!1),this.toneMapped===!1&&(n.toneMapped=!1),this.fog===!1&&(n.fog=!1),Object.keys(this.userData).length>0&&(n.userData=this.userData);function i(s){const o=[];for(const r in s){const g=s[r];delete g.metadata,o.push(g)}return o}if(t){const s=i(e.textures),o=i(e.images);s.length>0&&(n.textures=s),o.length>0&&(n.images=o)}return n}clone(){return new this.constructor().copy(this)}copy(e){this.name=e.name,this.blending=e.blending,this.side=e.side,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.blendColor.copy(e.blendColor),this.blendAlpha=e.blendAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.stencilWriteMask=e.stencilWriteMask,this.stencilFunc=e.stencilFunc,this.stencilRef=e.stencilRef,this.stencilFuncMask=e.stencilFuncMask,this.stencilFail=e.stencilFail,this.stencilZFail=e.stencilZFail,this.stencilZPass=e.stencilZPass,this.stencilWrite=e.stencilWrite;const t=e.clippingPlanes;let n=null;if(t!==null){const i=t.length;n=new Array(i);for(let s=0;s!==i;++s)n[s]=t[s].clone()}return this.clippingPlanes=n,this.clipIntersection=e.clipIntersection,this.clipShadows=e.clipShadows,this.shadowSide=e.shadowSide,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.alphaHash=e.alphaHash,this.alphaToCoverage=e.alphaToCoverage,this.premultipliedAlpha=e.premultipliedAlpha,this.forceSinglePass=e.forceSinglePass,this.visible=e.visible,this.toneMapped=e.toneMapped,this.userData=JSON.parse(JSON.stringify(e.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(e){e===!0&&this.version++}}class wo extends fa{constructor(e){super(),this.isMeshBasicMaterial=!0,this.type="MeshBasicMaterial",this.color=new Gt(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new to,this.combine=_f,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}}const sc=rY();function rY(){const a=new ArrayBuffer(4),e=new Float32Array(a),t=new Uint32Array(a),n=new Uint32Array(512),i=new Uint32Array(512);for(let g=0;g<256;++g){const u=g-127;u<-27?(n[g]=0,n[g|256]=32768,i[g]=24,i[g|256]=24):u<-14?(n[g]=1024>>-u-14,n[g|256]=1024>>-u-14|32768,i[g]=-u-1,i[g|256]=-u-1):u<=15?(n[g]=u+15<<10,n[g|256]=u+15<<10|32768,i[g]=13,i[g|256]=13):u<128?(n[g]=31744,n[g|256]=64512,i[g]=24,i[g|256]=24):(n[g]=31744,n[g|256]=64512,i[g]=13,i[g|256]=13)}const s=new Uint32Array(2048),o=new Uint32Array(64),r=new Uint32Array(64);for(let g=1;g<1024;++g){let u=g<<13,C=0;for(;(u&8388608)===0;)u<<=1,C-=8388608;u&=-8388609,C+=947912704,s[g]=u|C}for(let g=1024;g<2048;++g)s[g]=939524096+(g-1024<<13);for(let g=1;g<31;++g)o[g]=g<<23;o[31]=1199570944,o[32]=2147483648;for(let g=33;g<63;++g)o[g]=2147483648+(g-32<<23);o[63]=3347054592;for(let g=1;g<64;++g)g!==32&&(r[g]=1024);return{floatView:e,uint32View:t,baseTable:n,shiftTable:i,mantissaTable:s,exponentTable:o,offsetTable:r}}function Bo(a){Math.abs(a)>65504&&console.warn("THREE.DataUtils.toHalfFloat(): Value out of range."),a=ln(a,-65504,65504),sc.floatView[0]=a;const e=sc.uint32View[0],t=e>>23&511;return sc.baseTable[t]+((e&8388607)>>sc.shiftTable[t])}function af(a){const e=a>>10;return sc.uint32View[0]=sc.mantissaTable[sc.offsetTable[e]+(a&1023)]+sc.exponentTable[e],sc.floatView[0]}class gY{static toHalfFloat(e){return Bo(e)}static fromHalfFloat(e){return af(e)}}const ha=new ae,Km=new at;let cY=0;class En{constructor(e,t,n=!1){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,Object.defineProperty(this,"id",{value:cY++}),this.name="",this.array=e,this.itemSize=t,this.count=e!==void 0?e.length/t:0,this.normalized=n,this.usage=Wf,this.updateRanges=[],this.gpuType=qs,this.version=0}onUploadCallback(){}set needsUpdate(e){e===!0&&this.version++}setUsage(e){return this.usage=e,this}addUpdateRange(e,t){this.updateRanges.push({start:e,count:t})}clearUpdateRanges(){this.updateRanges.length=0}copy(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.usage=e.usage,this.gpuType=e.gpuType,this}copyAt(e,t,n){e*=this.itemSize,n*=t.itemSize;for(let i=0,s=this.itemSize;i<s;i++)this.array[e+i]=t.array[n+i];return this}copyArray(e){return this.array.set(e),this}applyMatrix3(e){if(this.itemSize===2)for(let t=0,n=this.count;t<n;t++)Km.fromBufferAttribute(this,t),Km.applyMatrix3(e),this.setXY(t,Km.x,Km.y);else if(this.itemSize===3)for(let t=0,n=this.count;t<n;t++)ha.fromBufferAttribute(this,t),ha.applyMatrix3(e),this.setXYZ(t,ha.x,ha.y,ha.z);return this}applyMatrix4(e){for(let t=0,n=this.count;t<n;t++)ha.fromBufferAttribute(this,t),ha.applyMatrix4(e),this.setXYZ(t,ha.x,ha.y,ha.z);return this}applyNormalMatrix(e){for(let t=0,n=this.count;t<n;t++)ha.fromBufferAttribute(this,t),ha.applyNormalMatrix(e),this.setXYZ(t,ha.x,ha.y,ha.z);return this}transformDirection(e){for(let t=0,n=this.count;t<n;t++)ha.fromBufferAttribute(this,t),ha.transformDirection(e),this.setXYZ(t,ha.x,ha.y,ha.z);return this}set(e,t=0){return this.array.set(e,t),this}getComponent(e,t){let n=this.array[e*this.itemSize+t];return this.normalized&&(n=js(n,this.array)),n}setComponent(e,t,n){return this.normalized&&(n=hn(n,this.array)),this.array[e*this.itemSize+t]=n,this}getX(e){let t=this.array[e*this.itemSize];return this.normalized&&(t=js(t,this.array)),t}setX(e,t){return this.normalized&&(t=hn(t,this.array)),this.array[e*this.itemSize]=t,this}getY(e){let t=this.array[e*this.itemSize+1];return this.normalized&&(t=js(t,this.array)),t}setY(e,t){return this.normalized&&(t=hn(t,this.array)),this.array[e*this.itemSize+1]=t,this}getZ(e){let t=this.array[e*this.itemSize+2];return this.normalized&&(t=js(t,this.array)),t}setZ(e,t){return this.normalized&&(t=hn(t,this.array)),this.array[e*this.itemSize+2]=t,this}getW(e){let t=this.array[e*this.itemSize+3];return this.normalized&&(t=js(t,this.array)),t}setW(e,t){return this.normalized&&(t=hn(t,this.array)),this.array[e*this.itemSize+3]=t,this}setXY(e,t,n){return e*=this.itemSize,this.normalized&&(t=hn(t,this.array),n=hn(n,this.array)),this.array[e+0]=t,this.array[e+1]=n,this}setXYZ(e,t,n,i){return e*=this.itemSize,this.normalized&&(t=hn(t,this.array),n=hn(n,this.array),i=hn(i,this.array)),this.array[e+0]=t,this.array[e+1]=n,this.array[e+2]=i,this}setXYZW(e,t,n,i,s){return e*=this.itemSize,this.normalized&&(t=hn(t,this.array),n=hn(n,this.array),i=hn(i,this.array),s=hn(s,this.array)),this.array[e+0]=t,this.array[e+1]=n,this.array[e+2]=i,this.array[e+3]=s,this}onUpload(e){return this.onUploadCallback=e,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const e={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return this.name!==""&&(e.name=this.name),this.usage!==Wf&&(e.usage=this.usage),e}}class uY extends En{constructor(e,t,n){super(new Int8Array(e),t,n)}}class IY extends En{constructor(e,t,n){super(new Uint8Array(e),t,n)}}class CY extends En{constructor(e,t,n){super(new Uint8ClampedArray(e),t,n)}}class dY extends En{constructor(e,t,n){super(new Int16Array(e),t,n)}}class eZ extends En{constructor(e,t,n){super(new Uint16Array(e),t,n)}}class AY extends En{constructor(e,t,n){super(new Int32Array(e),t,n)}}class tZ extends En{constructor(e,t,n){super(new Uint32Array(e),t,n)}}class hY extends En{constructor(e,t,n){super(new Uint16Array(e),t,n),this.isFloat16BufferAttribute=!0}getX(e){let t=af(this.array[e*this.itemSize]);return this.normalized&&(t=js(t,this.array)),t}setX(e,t){return this.normalized&&(t=hn(t,this.array)),this.array[e*this.itemSize]=Bo(t),this}getY(e){let t=af(this.array[e*this.itemSize+1]);return this.normalized&&(t=js(t,this.array)),t}setY(e,t){return this.normalized&&(t=hn(t,this.array)),this.array[e*this.itemSize+1]=Bo(t),this}getZ(e){let t=af(this.array[e*this.itemSize+2]);return this.normalized&&(t=js(t,this.array)),t}setZ(e,t){return this.normalized&&(t=hn(t,this.array)),this.array[e*this.itemSize+2]=Bo(t),this}getW(e){let t=af(this.array[e*this.itemSize+3]);return this.normalized&&(t=js(t,this.array)),t}setW(e,t){return this.normalized&&(t=hn(t,this.array)),this.array[e*this.itemSize+3]=Bo(t),this}setXY(e,t,n){return e*=this.itemSize,this.normalized&&(t=hn(t,this.array),n=hn(n,this.array)),this.array[e+0]=Bo(t),this.array[e+1]=Bo(n),this}setXYZ(e,t,n,i){return e*=this.itemSize,this.normalized&&(t=hn(t,this.array),n=hn(n,this.array),i=hn(i,this.array)),this.array[e+0]=Bo(t),this.array[e+1]=Bo(n),this.array[e+2]=Bo(i),this}setXYZW(e,t,n,i,s){return e*=this.itemSize,this.normalized&&(t=hn(t,this.array),n=hn(n,this.array),i=hn(i,this.array),s=hn(s,this.array)),this.array[e+0]=Bo(t),this.array[e+1]=Bo(n),this.array[e+2]=Bo(i),this.array[e+3]=Bo(s),this}}class Ht extends En{constructor(e,t,n){super(new Float32Array(e),t,n)}}let fY=0;const pl=new Yt,lB=new wn,Zd=new ae,ko=new Sa,Kh=new Sa,Ya=new ae;class rn extends bg{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:fY++}),this.uuid=Po(),this.name="",this.type="BufferGeometry",this.index=null,this.indirect=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(e){return Array.isArray(e)?this.index=new(xV(e)?tZ:eZ)(e,1):this.index=e,this}setIndirect(e){return this.indirect=e,this}getIndirect(){return this.indirect}getAttribute(e){return this.attributes[e]}setAttribute(e,t){return this.attributes[e]=t,this}deleteAttribute(e){return delete this.attributes[e],this}hasAttribute(e){return this.attributes[e]!==void 0}addGroup(e,t,n=0){this.groups.push({start:e,count:t,materialIndex:n})}clearGroups(){this.groups=[]}setDrawRange(e,t){this.drawRange.start=e,this.drawRange.count=t}applyMatrix4(e){const t=this.attributes.position;t!==void 0&&(t.applyMatrix4(e),t.needsUpdate=!0);const n=this.attributes.normal;if(n!==void 0){const s=new on().getNormalMatrix(e);n.applyNormalMatrix(s),n.needsUpdate=!0}const i=this.attributes.tangent;return i!==void 0&&(i.transformDirection(e),i.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}applyQuaternion(e){return pl.makeRotationFromQuaternion(e),this.applyMatrix4(pl),this}rotateX(e){return pl.makeRotationX(e),this.applyMatrix4(pl),this}rotateY(e){return pl.makeRotationY(e),this.applyMatrix4(pl),this}rotateZ(e){return pl.makeRotationZ(e),this.applyMatrix4(pl),this}translate(e,t,n){return pl.makeTranslation(e,t,n),this.applyMatrix4(pl),this}scale(e,t,n){return pl.makeScale(e,t,n),this.applyMatrix4(pl),this}lookAt(e){return lB.lookAt(e),lB.updateMatrix(),this.applyMatrix4(lB.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(Zd).negate(),this.translate(Zd.x,Zd.y,Zd.z),this}setFromPoints(e){const t=this.getAttribute("position");if(t===void 0){const n=[];for(let i=0,s=e.length;i<s;i++){const o=e[i];n.push(o.x,o.y,o.z||0)}this.setAttribute("position",new Ht(n,3))}else{const n=Math.min(e.length,t.count);for(let i=0;i<n;i++){const s=e[i];t.setXYZ(i,s.x,s.y,s.z||0)}e.length>t.count&&console.warn("THREE.BufferGeometry: Buffer size too small for points data. Use .dispose() and create a new geometry."),t.needsUpdate=!0}return this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new Sa);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){console.error("THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box.",this),this.boundingBox.set(new ae(-1/0,-1/0,-1/0),new ae(1/0,1/0,1/0));return}if(e!==void 0){if(this.boundingBox.setFromBufferAttribute(e),t)for(let n=0,i=t.length;n<i;n++){const s=t[n];ko.setFromBufferAttribute(s),this.morphTargetsRelative?(Ya.addVectors(this.boundingBox.min,ko.min),this.boundingBox.expandByPoint(Ya),Ya.addVectors(this.boundingBox.max,ko.max),this.boundingBox.expandByPoint(Ya)):(this.boundingBox.expandByPoint(ko.min),this.boundingBox.expandByPoint(ko.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new Ra);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){console.error("THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere.",this),this.boundingSphere.set(new ae,1/0);return}if(e){const n=this.boundingSphere.center;if(ko.setFromBufferAttribute(e),t)for(let s=0,o=t.length;s<o;s++){const r=t[s];Kh.setFromBufferAttribute(r),this.morphTargetsRelative?(Ya.addVectors(ko.min,Kh.min),ko.expandByPoint(Ya),Ya.addVectors(ko.max,Kh.max),ko.expandByPoint(Ya)):(ko.expandByPoint(Kh.min),ko.expandByPoint(Kh.max))}ko.getCenter(n);let i=0;for(let s=0,o=e.count;s<o;s++)Ya.fromBufferAttribute(e,s),i=Math.max(i,n.distanceToSquared(Ya));if(t)for(let s=0,o=t.length;s<o;s++){const r=t[s],g=this.morphTargetsRelative;for(let u=0,C=r.count;u<C;u++)Ya.fromBufferAttribute(r,u),g&&(Zd.fromBufferAttribute(e,u),Ya.add(Zd)),i=Math.max(i,n.distanceToSquared(Ya))}this.boundingSphere.radius=Math.sqrt(i),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const e=this.index,t=this.attributes;if(e===null||t.position===void 0||t.normal===void 0||t.uv===void 0){console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");return}const n=t.position,i=t.normal,s=t.uv;this.hasAttribute("tangent")===!1&&this.setAttribute("tangent",new En(new Float32Array(4*n.count),4));const o=this.getAttribute("tangent"),r=[],g=[];for(let F=0;F<n.count;F++)r[F]=new ae,g[F]=new ae;const u=new ae,C=new ae,h=new ae,f=new at,p=new at,y=new at,v=new ae,G=new ae;function B(F,Y,X){u.fromBufferAttribute(n,F),C.fromBufferAttribute(n,Y),h.fromBufferAttribute(n,X),f.fromBufferAttribute(s,F),p.fromBufferAttribute(s,Y),y.fromBufferAttribute(s,X),C.sub(u),h.sub(u),p.sub(f),y.sub(f);const U=1/(p.x*y.y-y.x*p.y);isFinite(U)&&(v.copy(C).multiplyScalar(y.y).addScaledVector(h,-p.y).multiplyScalar(U),G.copy(h).multiplyScalar(p.x).addScaledVector(C,-y.x).multiplyScalar(U),r[F].add(v),r[Y].add(v),r[X].add(v),g[F].add(G),g[Y].add(G),g[X].add(G))}let R=this.groups;R.length===0&&(R=[{start:0,count:e.count}]);for(let F=0,Y=R.length;F<Y;++F){const X=R[F],U=X.start,O=X.count;for(let P=U,ie=U+O;P<ie;P+=3)B(e.getX(P+0),e.getX(P+1),e.getX(P+2))}const x=new ae,w=new ae,M=new ae,H=new ae;function N(F){M.fromBufferAttribute(i,F),H.copy(M);const Y=r[F];x.copy(Y),x.sub(M.multiplyScalar(M.dot(Y))).normalize(),w.crossVectors(H,Y);const U=w.dot(g[F])<0?-1:1;o.setXYZW(F,x.x,x.y,x.z,U)}for(let F=0,Y=R.length;F<Y;++F){const X=R[F],U=X.start,O=X.count;for(let P=U,ie=U+O;P<ie;P+=3)N(e.getX(P+0)),N(e.getX(P+1)),N(e.getX(P+2))}}computeVertexNormals(){const e=this.index,t=this.getAttribute("position");if(t!==void 0){let n=this.getAttribute("normal");if(n===void 0)n=new En(new Float32Array(t.count*3),3),this.setAttribute("normal",n);else for(let f=0,p=n.count;f<p;f++)n.setXYZ(f,0,0,0);const i=new ae,s=new ae,o=new ae,r=new ae,g=new ae,u=new ae,C=new ae,h=new ae;if(e)for(let f=0,p=e.count;f<p;f+=3){const y=e.getX(f+0),v=e.getX(f+1),G=e.getX(f+2);i.fromBufferAttribute(t,y),s.fromBufferAttribute(t,v),o.fromBufferAttribute(t,G),C.subVectors(o,s),h.subVectors(i,s),C.cross(h),r.fromBufferAttribute(n,y),g.fromBufferAttribute(n,v),u.fromBufferAttribute(n,G),r.add(C),g.add(C),u.add(C),n.setXYZ(y,r.x,r.y,r.z),n.setXYZ(v,g.x,g.y,g.z),n.setXYZ(G,u.x,u.y,u.z)}else for(let f=0,p=t.count;f<p;f+=3)i.fromBufferAttribute(t,f+0),s.fromBufferAttribute(t,f+1),o.fromBufferAttribute(t,f+2),C.subVectors(o,s),h.subVectors(i,s),C.cross(h),n.setXYZ(f+0,C.x,C.y,C.z),n.setXYZ(f+1,C.x,C.y,C.z),n.setXYZ(f+2,C.x,C.y,C.z);this.normalizeNormals(),n.needsUpdate=!0}}normalizeNormals(){const e=this.attributes.normal;for(let t=0,n=e.count;t<n;t++)Ya.fromBufferAttribute(e,t),Ya.normalize(),e.setXYZ(t,Ya.x,Ya.y,Ya.z)}toNonIndexed(){function e(r,g){const u=r.array,C=r.itemSize,h=r.normalized,f=new u.constructor(g.length*C);let p=0,y=0;for(let v=0,G=g.length;v<G;v++){r.isInterleavedBufferAttribute?p=g[v]*r.data.stride+r.offset:p=g[v]*C;for(let B=0;B<C;B++)f[y++]=u[p++]}return new En(f,C,h)}if(this.index===null)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const t=new rn,n=this.index.array,i=this.attributes;for(const r in i){const g=i[r],u=e(g,n);t.setAttribute(r,u)}const s=this.morphAttributes;for(const r in s){const g=[],u=s[r];for(let C=0,h=u.length;C<h;C++){const f=u[C],p=e(f,n);g.push(p)}t.morphAttributes[r]=g}t.morphTargetsRelative=this.morphTargetsRelative;const o=this.groups;for(let r=0,g=o.length;r<g;r++){const u=o[r];t.addGroup(u.start,u.count,u.materialIndex)}return t}toJSON(){const e={metadata:{version:4.7,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,this.name!==""&&(e.name=this.name),Object.keys(this.userData).length>0&&(e.userData=this.userData),this.parameters!==void 0){const g=this.parameters;for(const u in g)g[u]!==void 0&&(e[u]=g[u]);return e}e.data={attributes:{}};const t=this.index;t!==null&&(e.data.index={type:t.array.constructor.name,array:Array.prototype.slice.call(t.array)});const n=this.attributes;for(const g in n){const u=n[g];e.data.attributes[g]=u.toJSON(e.data)}const i={};let s=!1;for(const g in this.morphAttributes){const u=this.morphAttributes[g],C=[];for(let h=0,f=u.length;h<f;h++){const p=u[h];C.push(p.toJSON(e.data))}C.length>0&&(i[g]=C,s=!0)}s&&(e.data.morphAttributes=i,e.data.morphTargetsRelative=this.morphTargetsRelative);const o=this.groups;o.length>0&&(e.data.groups=JSON.parse(JSON.stringify(o)));const r=this.boundingSphere;return r!==null&&(e.data.boundingSphere=r.toJSON()),e}clone(){return new this.constructor().copy(this)}copy(e){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const t={};this.name=e.name;const n=e.index;n!==null&&this.setIndex(n.clone());const i=e.attributes;for(const u in i){const C=i[u];this.setAttribute(u,C.clone(t))}const s=e.morphAttributes;for(const u in s){const C=[],h=s[u];for(let f=0,p=h.length;f<p;f++)C.push(h[f].clone(t));this.morphAttributes[u]=C}this.morphTargetsRelative=e.morphTargetsRelative;const o=e.groups;for(let u=0,C=o.length;u<C;u++){const h=o[u];this.addGroup(h.start,h.count,h.materialIndex)}const r=e.boundingBox;r!==null&&(this.boundingBox=r.clone());const g=e.boundingSphere;return g!==null&&(this.boundingSphere=g.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,this}dispose(){this.dispatchEvent({type:"dispose"})}}const CR=new Yt,GI=new AC,Fm=new Ra,dR=new ae,Em=new ae,Tm=new ae,zm=new ae,rB=new ae,Lm=new ae,AR=new ae,_m=new ae;class vi extends wn{constructor(e=new rn,t=new wo){super(),this.isMesh=!0,this.type="Mesh",this.geometry=e,this.material=t,this.morphTargetDictionary=void 0,this.morphTargetInfluences=void 0,this.count=1,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),e.morphTargetInfluences!==void 0&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),e.morphTargetDictionary!==void 0&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}updateMorphTargets(){const t=this.geometry.morphAttributes,n=Object.keys(t);if(n.length>0){const i=t[n[0]];if(i!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let s=0,o=i.length;s<o;s++){const r=i[s].name||String(s);this.morphTargetInfluences.push(0),this.morphTargetDictionary[r]=s}}}}getVertexPosition(e,t){const n=this.geometry,i=n.attributes.position,s=n.morphAttributes.position,o=n.morphTargetsRelative;t.fromBufferAttribute(i,e);const r=this.morphTargetInfluences;if(s&&r){Lm.set(0,0,0);for(let g=0,u=s.length;g<u;g++){const C=r[g],h=s[g];C!==0&&(rB.fromBufferAttribute(h,e),o?Lm.addScaledVector(rB,C):Lm.addScaledVector(rB.sub(t),C))}t.add(Lm)}return t}raycast(e,t){const n=this.geometry,i=this.material,s=this.matrixWorld;i!==void 0&&(n.boundingSphere===null&&n.computeBoundingSphere(),Fm.copy(n.boundingSphere),Fm.applyMatrix4(s),GI.copy(e.ray).recast(e.near),!(Fm.containsPoint(GI.origin)===!1&&(GI.intersectSphere(Fm,dR)===null||GI.origin.distanceToSquared(dR)>(e.far-e.near)**2))&&(CR.copy(s).invert(),GI.copy(e.ray).applyMatrix4(CR),!(n.boundingBox!==null&&GI.intersectsBox(n.boundingBox)===!1)&&this._computeIntersections(e,t,GI)))}_computeIntersections(e,t,n){let i;const s=this.geometry,o=this.material,r=s.index,g=s.attributes.position,u=s.attributes.uv,C=s.attributes.uv1,h=s.attributes.normal,f=s.groups,p=s.drawRange;if(r!==null)if(Array.isArray(o))for(let y=0,v=f.length;y<v;y++){const G=f[y],B=o[G.materialIndex],R=Math.max(G.start,p.start),x=Math.min(r.count,Math.min(G.start+G.count,p.start+p.count));for(let w=R,M=x;w<M;w+=3){const H=r.getX(w),N=r.getX(w+1),F=r.getX(w+2);i=Um(this,B,e,n,u,C,h,H,N,F),i&&(i.faceIndex=Math.floor(w/3),i.face.materialIndex=G.materialIndex,t.push(i))}}else{const y=Math.max(0,p.start),v=Math.min(r.count,p.start+p.count);for(let G=y,B=v;G<B;G+=3){const R=r.getX(G),x=r.getX(G+1),w=r.getX(G+2);i=Um(this,o,e,n,u,C,h,R,x,w),i&&(i.faceIndex=Math.floor(G/3),t.push(i))}}else if(g!==void 0)if(Array.isArray(o))for(let y=0,v=f.length;y<v;y++){const G=f[y],B=o[G.materialIndex],R=Math.max(G.start,p.start),x=Math.min(g.count,Math.min(G.start+G.count,p.start+p.count));for(let w=R,M=x;w<M;w+=3){const H=w,N=w+1,F=w+2;i=Um(this,B,e,n,u,C,h,H,N,F),i&&(i.faceIndex=Math.floor(w/3),i.face.materialIndex=G.materialIndex,t.push(i))}}else{const y=Math.max(0,p.start),v=Math.min(g.count,p.start+p.count);for(let G=y,B=v;G<B;G+=3){const R=G,x=G+1,w=G+2;i=Um(this,o,e,n,u,C,h,R,x,w),i&&(i.faceIndex=Math.floor(G/3),t.push(i))}}}}function pY(a,e,t,n,i,s,o,r){let g;if(e.side===eo?g=n.intersectTriangle(o,s,i,!0,r):g=n.intersectTriangle(i,s,o,e.side===fg,r),g===null)return null;_m.copy(r),_m.applyMatrix4(a.matrixWorld);const u=t.ray.origin.distanceTo(_m);return u<t.near||u>t.far?null:{distance:u,point:_m.clone(),object:a}}function Um(a,e,t,n,i,s,o,r,g,u){a.getVertexPosition(r,Em),a.getVertexPosition(g,Tm),a.getVertexPosition(u,zm);const C=pY(a,e,t,n,Em,Tm,zm,AR);if(C){const h=new ae;Ro.getBarycoord(AR,Em,Tm,zm,h),i&&(C.uv=Ro.getInterpolatedAttribute(i,r,g,u,h,new at)),s&&(C.uv1=Ro.getInterpolatedAttribute(s,r,g,u,h,new at)),o&&(C.normal=Ro.getInterpolatedAttribute(o,r,g,u,h,new ae),C.normal.dot(n.direction)>0&&C.normal.multiplyScalar(-1));const f={a:r,b:g,c:u,normal:new ae,materialIndex:0};Ro.getNormal(Em,Tm,zm,f.normal),C.face=f,C.barycoord=h}return C}class hC extends rn{constructor(e=1,t=1,n=1,i=1,s=1,o=1){super(),this.type="BoxGeometry",this.parameters={width:e,height:t,depth:n,widthSegments:i,heightSegments:s,depthSegments:o};const r=this;i=Math.floor(i),s=Math.floor(s),o=Math.floor(o);const g=[],u=[],C=[],h=[];let f=0,p=0;y("z","y","x",-1,-1,n,t,e,o,s,0),y("z","y","x",1,-1,n,t,-e,o,s,1),y("x","z","y",1,1,e,n,t,i,o,2),y("x","z","y",1,-1,e,n,-t,i,o,3),y("x","y","z",1,-1,e,t,n,i,s,4),y("x","y","z",-1,-1,e,t,-n,i,s,5),this.setIndex(g),this.setAttribute("position",new Ht(u,3)),this.setAttribute("normal",new Ht(C,3)),this.setAttribute("uv",new Ht(h,2));function y(v,G,B,R,x,w,M,H,N,F,Y){const X=w/N,U=M/F,O=w/2,P=M/2,ie=H/2,le=N+1,T=F+1;let J=0,Q=0;const se=new ae;for(let L=0;L<T;L++){const D=L*U-P;for(let ne=0;ne<le;ne++){const oe=ne*X-O;se[v]=oe*R,se[G]=D*x,se[B]=ie,u.push(se.x,se.y,se.z),se[v]=0,se[G]=0,se[B]=H>0?1:-1,C.push(se.x,se.y,se.z),h.push(ne/N),h.push(1-L/F),J+=1}}for(let L=0;L<F;L++)for(let D=0;D<N;D++){const ne=f+D+le*L,oe=f+D+le*(L+1),j=f+(D+1)+le*(L+1),re=f+(D+1)+le*L;g.push(ne,oe,re),g.push(oe,j,re),Q+=6}r.addGroup(p,Q,Y),p+=Q,f+=J}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new hC(e.width,e.height,e.depth,e.widthSegments,e.heightSegments,e.depthSegments)}}function sA(a){const e={};for(const t in a){e[t]={};for(const n in a[t]){const i=a[t][n];i&&(i.isColor||i.isMatrix3||i.isMatrix4||i.isVector2||i.isVector3||i.isVector4||i.isTexture||i.isQuaternion)?i.isRenderTargetTexture?(console.warn("UniformsUtils: Textures of render targets cannot be cloned via cloneUniforms() or mergeUniforms()."),e[t][n]=null):e[t][n]=i.clone():Array.isArray(i)?e[t][n]=i.slice():e[t][n]=i}}return e}function ks(a){const e={};for(let t=0;t<a.length;t++){const n=sA(a[t]);for(const i in n)e[i]=n[i]}return e}function mY(a){const e=[];for(let t=0;t<a.length;t++)e.push(a[t].clone());return e}function HV(a){const e=a.getRenderTarget();return e===null?a.outputColorSpace:e.isXRRenderTarget===!0?e.texture.colorSpace:Mn.workingColorSpace}const fy={clone:sA,merge:ks};var bY=`void main() {
	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}`,yY=`void main() {
	gl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );
}`;class Zl extends fa{constructor(e){super(),this.isShaderMaterial=!0,this.type="ShaderMaterial",this.defines={},this.uniforms={},this.uniformsGroups=[],this.vertexShader=bY,this.fragmentShader=yY,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.forceSinglePass=!0,this.extensions={clipCullDistance:!1,multiDraw:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv1:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,e!==void 0&&this.setValues(e)}copy(e){return super.copy(e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=sA(e.uniforms),this.uniformsGroups=mY(e.uniformsGroups),this.defines=Object.assign({},e.defines),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.fog=e.fog,this.lights=e.lights,this.clipping=e.clipping,this.extensions=Object.assign({},e.extensions),this.glslVersion=e.glslVersion,this}toJSON(e){const t=super.toJSON(e);t.glslVersion=this.glslVersion,t.uniforms={};for(const i in this.uniforms){const o=this.uniforms[i].value;o&&o.isTexture?t.uniforms[i]={type:"t",value:o.toJSON(e).uuid}:o&&o.isColor?t.uniforms[i]={type:"c",value:o.getHex()}:o&&o.isVector2?t.uniforms[i]={type:"v2",value:o.toArray()}:o&&o.isVector3?t.uniforms[i]={type:"v3",value:o.toArray()}:o&&o.isVector4?t.uniforms[i]={type:"v4",value:o.toArray()}:o&&o.isMatrix3?t.uniforms[i]={type:"m3",value:o.toArray()}:o&&o.isMatrix4?t.uniforms[i]={type:"m4",value:o.toArray()}:t.uniforms[i]={value:o}}Object.keys(this.defines).length>0&&(t.defines=this.defines),t.vertexShader=this.vertexShader,t.fragmentShader=this.fragmentShader,t.lights=this.lights,t.clipping=this.clipping;const n={};for(const i in this.extensions)this.extensions[i]===!0&&(n[i]=!0);return Object.keys(n).length>0&&(t.extensions=n),t}}class py extends wn{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new Yt,this.projectionMatrix=new Yt,this.projectionMatrixInverse=new Yt,this.coordinateSystem=Gl}copy(e,t){return super.copy(e,t),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this.coordinateSystem=e.coordinateSystem,this}getWorldDirection(e){return super.getWorldDirection(e).negate()}updateMatrixWorld(e){super.updateMatrixWorld(e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(e,t){super.updateWorldMatrix(e,t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return new this.constructor().copy(this)}}const Cu=new ae,hR=new at,fR=new at;let Xi=class extends py{constructor(e=50,t=1,n=.1,i=2e3){super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=e,this.zoom=1,this.near=n,this.far=i,this.focus=10,this.aspect=t,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=e.view===null?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this}setFocalLength(e){const t=.5*this.getFilmHeight()/e;this.fov=iA*2*Math.atan(t),this.updateProjectionMatrix()}getFocalLength(){const e=Math.tan($I*.5*this.fov);return .5*this.getFilmHeight()/e}getEffectiveFOV(){return iA*2*Math.atan(Math.tan($I*.5*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}getViewBounds(e,t,n){Cu.set(-1,-1,.5).applyMatrix4(this.projectionMatrixInverse),t.set(Cu.x,Cu.y).multiplyScalar(-e/Cu.z),Cu.set(1,1,.5).applyMatrix4(this.projectionMatrixInverse),n.set(Cu.x,Cu.y).multiplyScalar(-e/Cu.z)}getViewSize(e,t){return this.getViewBounds(e,hR,fR),t.subVectors(fR,hR)}setViewOffset(e,t,n,i,s,o){this.aspect=e/t,this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=n,this.view.offsetY=i,this.view.width=s,this.view.height=o,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=this.near;let t=e*Math.tan($I*.5*this.fov)/this.zoom,n=2*t,i=this.aspect*n,s=-.5*i;const o=this.view;if(this.view!==null&&this.view.enabled){const g=o.fullWidth,u=o.fullHeight;s+=o.offsetX*i/g,t-=o.offsetY*n/u,i*=o.width/g,n*=o.height/u}const r=this.filmOffset;r!==0&&(s+=e*r/this.getFilmWidth()),this.projectionMatrix.makePerspective(s,s+i,t,t-n,e,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.fov=this.fov,t.object.zoom=this.zoom,t.object.near=this.near,t.object.far=this.far,t.object.focus=this.focus,t.object.aspect=this.aspect,this.view!==null&&(t.object.view=Object.assign({},this.view)),t.object.filmGauge=this.filmGauge,t.object.filmOffset=this.filmOffset,t}};const Sd=-90,Rd=1;class XV extends wn{constructor(e,t,n){super(),this.type="CubeCamera",this.renderTarget=n,this.coordinateSystem=null,this.activeMipmapLevel=0;const i=new Xi(Sd,Rd,e,t);i.layers=this.layers,this.add(i);const s=new Xi(Sd,Rd,e,t);s.layers=this.layers,this.add(s);const o=new Xi(Sd,Rd,e,t);o.layers=this.layers,this.add(o);const r=new Xi(Sd,Rd,e,t);r.layers=this.layers,this.add(r);const g=new Xi(Sd,Rd,e,t);g.layers=this.layers,this.add(g);const u=new Xi(Sd,Rd,e,t);u.layers=this.layers,this.add(u)}updateCoordinateSystem(){const e=this.coordinateSystem,t=this.children.concat(),[n,i,s,o,r,g]=t;for(const u of t)this.remove(u);if(e===Gl)n.up.set(0,1,0),n.lookAt(1,0,0),i.up.set(0,1,0),i.lookAt(-1,0,0),s.up.set(0,0,-1),s.lookAt(0,1,0),o.up.set(0,0,1),o.lookAt(0,-1,0),r.up.set(0,1,0),r.lookAt(0,0,1),g.up.set(0,1,0),g.lookAt(0,0,-1);else if(e===Vf)n.up.set(0,-1,0),n.lookAt(-1,0,0),i.up.set(0,-1,0),i.lookAt(1,0,0),s.up.set(0,0,1),s.lookAt(0,1,0),o.up.set(0,0,-1),o.lookAt(0,-1,0),r.up.set(0,-1,0),r.lookAt(0,0,1),g.up.set(0,-1,0),g.lookAt(0,0,-1);else throw new Error("THREE.CubeCamera.updateCoordinateSystem(): Invalid coordinate system: "+e);for(const u of t)this.add(u),u.updateMatrixWorld()}update(e,t){this.parent===null&&this.updateMatrixWorld();const{renderTarget:n,activeMipmapLevel:i}=this;this.coordinateSystem!==e.coordinateSystem&&(this.coordinateSystem=e.coordinateSystem,this.updateCoordinateSystem());const[s,o,r,g,u,C]=this.children,h=e.getRenderTarget(),f=e.getActiveCubeFace(),p=e.getActiveMipmapLevel(),y=e.xr.enabled;e.xr.enabled=!1;const v=n.texture.generateMipmaps;n.texture.generateMipmaps=!1,e.setRenderTarget(n,0,i),e.render(t,s),e.setRenderTarget(n,1,i),e.render(t,o),e.setRenderTarget(n,2,i),e.render(t,r),e.setRenderTarget(n,3,i),e.render(t,g),e.setRenderTarget(n,4,i),e.render(t,u),n.texture.generateMipmaps=v,e.setRenderTarget(n,5,i),e.render(t,C),e.setRenderTarget(h,f,p),e.xr.enabled=y,n.texture.needsPMREMUpdate=!0}}class Df extends Zi{constructor(e=[],t=hc,n,i,s,o,r,g,u,C){super(e,t,n,i,s,o,r,g,u,C),this.isCubeTexture=!0,this.flipY=!1}get images(){return this.image}set images(e){this.image=e}}class NV extends br{constructor(e=1,t={}){super(e,e,t),this.isWebGLCubeRenderTarget=!0;const n={width:e,height:e,depth:1},i=[n,n,n,n,n,n];this.texture=new Df(i),this._setTextureOptions(t),this.texture.isRenderTargetTexture=!0}fromEquirectangularTexture(e,t){this.texture.type=t.type,this.texture.colorSpace=t.colorSpace,this.texture.generateMipmaps=t.generateMipmaps,this.texture.minFilter=t.minFilter,this.texture.magFilter=t.magFilter;const n={uniforms:{tEquirect:{value:null}},vertexShader:`

				varying vec3 vWorldDirection;

				vec3 transformDirection( in vec3 dir, in mat4 matrix ) {

					return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );

				}

				void main() {

					vWorldDirection = transformDirection( position, modelMatrix );

					#include <begin_vertex>
					#include <project_vertex>

				}
			`,fragmentShader:`

				uniform sampler2D tEquirect;

				varying vec3 vWorldDirection;

				#include <common>

				void main() {

					vec3 direction = normalize( vWorldDirection );

					vec2 sampleUV = equirectUv( direction );

					gl_FragColor = texture2D( tEquirect, sampleUV );

				}
			`},i=new hC(5,5,5),s=new Zl({name:"CubemapFromEquirect",uniforms:sA(n.uniforms),vertexShader:n.vertexShader,fragmentShader:n.fragmentShader,side:eo,blending:cc});s.uniforms.tEquirect.value=t;const o=new vi(i,s),r=t.minFilter;return t.minFilter===yl&&(t.minFilter=Bi),new XV(1,10,this).update(e,o),t.minFilter=r,o.geometry.dispose(),o.material.dispose(),this}clear(e,t=!0,n=!0,i=!0){const s=e.getRenderTarget();for(let o=0;o<6;o++)e.setRenderTarget(this,o),e.clear(t,n,i);e.setRenderTarget(s)}}class dg extends wn{constructor(){super(),this.isGroup=!0,this.type="Group"}}const GY={type:"move"};class Lb{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return this._hand===null&&(this._hand=new dg,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return this._targetRay===null&&(this._targetRay=new dg,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new ae,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new ae),this._targetRay}getGripSpace(){return this._grip===null&&(this._grip=new dg,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new ae,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new ae),this._grip}dispatchEvent(e){return this._targetRay!==null&&this._targetRay.dispatchEvent(e),this._grip!==null&&this._grip.dispatchEvent(e),this._hand!==null&&this._hand.dispatchEvent(e),this}connect(e){if(e&&e.hand){const t=this._hand;if(t)for(const n of e.hand.values())this._getHandJoint(t,n)}return this.dispatchEvent({type:"connected",data:e}),this}disconnect(e){return this.dispatchEvent({type:"disconnected",data:e}),this._targetRay!==null&&(this._targetRay.visible=!1),this._grip!==null&&(this._grip.visible=!1),this._hand!==null&&(this._hand.visible=!1),this}update(e,t,n){let i=null,s=null,o=null;const r=this._targetRay,g=this._grip,u=this._hand;if(e&&t.session.visibilityState!=="visible-blurred"){if(u&&e.hand){o=!0;for(const v of e.hand.values()){const G=t.getJointPose(v,n),B=this._getHandJoint(u,v);G!==null&&(B.matrix.fromArray(G.transform.matrix),B.matrix.decompose(B.position,B.rotation,B.scale),B.matrixWorldNeedsUpdate=!0,B.jointRadius=G.radius),B.visible=G!==null}const C=u.joints["index-finger-tip"],h=u.joints["thumb-tip"],f=C.position.distanceTo(h.position),p=.02,y=.005;u.inputState.pinching&&f>p+y?(u.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:e.handedness,target:this})):!u.inputState.pinching&&f<=p-y&&(u.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:e.handedness,target:this}))}else g!==null&&e.gripSpace&&(s=t.getPose(e.gripSpace,n),s!==null&&(g.matrix.fromArray(s.transform.matrix),g.matrix.decompose(g.position,g.rotation,g.scale),g.matrixWorldNeedsUpdate=!0,s.linearVelocity?(g.hasLinearVelocity=!0,g.linearVelocity.copy(s.linearVelocity)):g.hasLinearVelocity=!1,s.angularVelocity?(g.hasAngularVelocity=!0,g.angularVelocity.copy(s.angularVelocity)):g.hasAngularVelocity=!1));r!==null&&(i=t.getPose(e.targetRaySpace,n),i===null&&s!==null&&(i=s),i!==null&&(r.matrix.fromArray(i.transform.matrix),r.matrix.decompose(r.position,r.rotation,r.scale),r.matrixWorldNeedsUpdate=!0,i.linearVelocity?(r.hasLinearVelocity=!0,r.linearVelocity.copy(i.linearVelocity)):r.hasLinearVelocity=!1,i.angularVelocity?(r.hasAngularVelocity=!0,r.angularVelocity.copy(i.angularVelocity)):r.hasAngularVelocity=!1,this.dispatchEvent(GY)))}return r!==null&&(r.visible=i!==null),g!==null&&(g.visible=s!==null),u!==null&&(u.visible=o!==null),this}_getHandJoint(e,t){if(e.joints[t.jointName]===void 0){const n=new dg;n.matrixAutoUpdate=!1,n.visible=!1,e.joints[t.jointName]=n,e.add(n)}return e.joints[t.jointName]}}class my{constructor(e,t=25e-5){this.isFogExp2=!0,this.name="",this.color=new Gt(e),this.density=t}clone(){return new my(this.color,this.density)}toJSON(){return{type:"FogExp2",name:this.name,color:this.color.getHex(),density:this.density}}}class by{constructor(e,t=1,n=1e3){this.isFog=!0,this.name="",this.color=new Gt(e),this.near=t,this.far=n}clone(){return new by(this.color,this.near,this.far)}toJSON(){return{type:"Fog",name:this.name,color:this.color.getHex(),near:this.near,far:this.far}}}let nZ=class extends wn{constructor(){super(),this.isScene=!0,this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.backgroundBlurriness=0,this.backgroundIntensity=1,this.backgroundRotation=new to,this.environmentIntensity=1,this.environmentRotation=new to,this.overrideMaterial=null,typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(e,t){return super.copy(e,t),e.background!==null&&(this.background=e.background.clone()),e.environment!==null&&(this.environment=e.environment.clone()),e.fog!==null&&(this.fog=e.fog.clone()),this.backgroundBlurriness=e.backgroundBlurriness,this.backgroundIntensity=e.backgroundIntensity,this.backgroundRotation.copy(e.backgroundRotation),this.environmentIntensity=e.environmentIntensity,this.environmentRotation.copy(e.environmentRotation),e.overrideMaterial!==null&&(this.overrideMaterial=e.overrideMaterial.clone()),this.matrixAutoUpdate=e.matrixAutoUpdate,this}toJSON(e){const t=super.toJSON(e);return this.fog!==null&&(t.object.fog=this.fog.toJSON()),this.backgroundBlurriness>0&&(t.object.backgroundBlurriness=this.backgroundBlurriness),this.backgroundIntensity!==1&&(t.object.backgroundIntensity=this.backgroundIntensity),t.object.backgroundRotation=this.backgroundRotation.toArray(),this.environmentIntensity!==1&&(t.object.environmentIntensity=this.environmentIntensity),t.object.environmentRotation=this.environmentRotation.toArray(),t}};class kf{constructor(e,t){this.isInterleavedBuffer=!0,this.array=e,this.stride=t,this.count=e!==void 0?e.length/t:0,this.usage=Wf,this.updateRanges=[],this.version=0,this.uuid=Po()}onUploadCallback(){}set needsUpdate(e){e===!0&&this.version++}setUsage(e){return this.usage=e,this}addUpdateRange(e,t){this.updateRanges.push({start:e,count:t})}clearUpdateRanges(){this.updateRanges.length=0}copy(e){return this.array=new e.array.constructor(e.array),this.count=e.count,this.stride=e.stride,this.usage=e.usage,this}copyAt(e,t,n){e*=this.stride,n*=t.stride;for(let i=0,s=this.stride;i<s;i++)this.array[e+i]=t.array[n+i];return this}set(e,t=0){return this.array.set(e,t),this}clone(e){e.arrayBuffers===void 0&&(e.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=Po()),e.arrayBuffers[this.array.buffer._uuid]===void 0&&(e.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);const t=new this.array.constructor(e.arrayBuffers[this.array.buffer._uuid]),n=new this.constructor(t,this.stride);return n.setUsage(this.usage),n}onUpload(e){return this.onUploadCallback=e,this}toJSON(e){return e.arrayBuffers===void 0&&(e.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=Po()),e.arrayBuffers[this.array.buffer._uuid]===void 0&&(e.arrayBuffers[this.array.buffer._uuid]=Array.from(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}}const Us=new ae;class Zu{constructor(e,t,n,i=!1){this.isInterleavedBufferAttribute=!0,this.name="",this.data=e,this.itemSize=t,this.offset=n,this.normalized=i}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(e){this.data.needsUpdate=e}applyMatrix4(e){for(let t=0,n=this.data.count;t<n;t++)Us.fromBufferAttribute(this,t),Us.applyMatrix4(e),this.setXYZ(t,Us.x,Us.y,Us.z);return this}applyNormalMatrix(e){for(let t=0,n=this.count;t<n;t++)Us.fromBufferAttribute(this,t),Us.applyNormalMatrix(e),this.setXYZ(t,Us.x,Us.y,Us.z);return this}transformDirection(e){for(let t=0,n=this.count;t<n;t++)Us.fromBufferAttribute(this,t),Us.transformDirection(e),this.setXYZ(t,Us.x,Us.y,Us.z);return this}getComponent(e,t){let n=this.array[e*this.data.stride+this.offset+t];return this.normalized&&(n=js(n,this.array)),n}setComponent(e,t,n){return this.normalized&&(n=hn(n,this.array)),this.data.array[e*this.data.stride+this.offset+t]=n,this}setX(e,t){return this.normalized&&(t=hn(t,this.array)),this.data.array[e*this.data.stride+this.offset]=t,this}setY(e,t){return this.normalized&&(t=hn(t,this.array)),this.data.array[e*this.data.stride+this.offset+1]=t,this}setZ(e,t){return this.normalized&&(t=hn(t,this.array)),this.data.array[e*this.data.stride+this.offset+2]=t,this}setW(e,t){return this.normalized&&(t=hn(t,this.array)),this.data.array[e*this.data.stride+this.offset+3]=t,this}getX(e){let t=this.data.array[e*this.data.stride+this.offset];return this.normalized&&(t=js(t,this.array)),t}getY(e){let t=this.data.array[e*this.data.stride+this.offset+1];return this.normalized&&(t=js(t,this.array)),t}getZ(e){let t=this.data.array[e*this.data.stride+this.offset+2];return this.normalized&&(t=js(t,this.array)),t}getW(e){let t=this.data.array[e*this.data.stride+this.offset+3];return this.normalized&&(t=js(t,this.array)),t}setXY(e,t,n){return e=e*this.data.stride+this.offset,this.normalized&&(t=hn(t,this.array),n=hn(n,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=n,this}setXYZ(e,t,n,i){return e=e*this.data.stride+this.offset,this.normalized&&(t=hn(t,this.array),n=hn(n,this.array),i=hn(i,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=n,this.data.array[e+2]=i,this}setXYZW(e,t,n,i,s){return e=e*this.data.stride+this.offset,this.normalized&&(t=hn(t,this.array),n=hn(n,this.array),i=hn(i,this.array),s=hn(s,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=n,this.data.array[e+2]=i,this.data.array[e+3]=s,this}clone(e){if(e===void 0){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interleaved buffer attribute will de-interleave buffer data.");const t=[];for(let n=0;n<this.count;n++){const i=n*this.data.stride+this.offset;for(let s=0;s<this.itemSize;s++)t.push(this.data.array[i+s])}return new En(new this.array.constructor(t),this.itemSize,this.normalized)}else return e.interleavedBuffers===void 0&&(e.interleavedBuffers={}),e.interleavedBuffers[this.data.uuid]===void 0&&(e.interleavedBuffers[this.data.uuid]=this.data.clone(e)),new Zu(e.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}toJSON(e){if(e===void 0){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interleaved buffer attribute will de-interleave buffer data.");const t=[];for(let n=0;n<this.count;n++){const i=n*this.data.stride+this.offset;for(let s=0;s<this.itemSize;s++)t.push(this.data.array[i+s])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:t,normalized:this.normalized}}else return e.interleavedBuffers===void 0&&(e.interleavedBuffers={}),e.interleavedBuffers[this.data.uuid]===void 0&&(e.interleavedBuffers[this.data.uuid]=this.data.toJSON(e)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}}class iZ extends fa{constructor(e){super(),this.isSpriteMaterial=!0,this.type="SpriteMaterial",this.color=new Gt(16777215),this.map=null,this.alphaMap=null,this.rotation=0,this.sizeAttenuation=!0,this.transparent=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.rotation=e.rotation,this.sizeAttenuation=e.sizeAttenuation,this.fog=e.fog,this}}let wd;const Fh=new ae,xd=new ae,Wd=new ae,Vd=new at,Eh=new at,YV=new Yt,Dm=new ae,Th=new ae,km=new ae,pR=new at,gB=new at,mR=new at;class KV extends wn{constructor(e=new iZ){if(super(),this.isSprite=!0,this.type="Sprite",wd===void 0){wd=new rn;const t=new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]),n=new kf(t,5);wd.setIndex([0,1,2,0,2,3]),wd.setAttribute("position",new Zu(n,3,0,!1)),wd.setAttribute("uv",new Zu(n,2,3,!1))}this.geometry=wd,this.material=e,this.center=new at(.5,.5),this.count=1}raycast(e,t){e.camera===null&&console.error('THREE.Sprite: "Raycaster.camera" needs to be set in order to raycast against sprites.'),xd.setFromMatrixScale(this.matrixWorld),YV.copy(e.camera.matrixWorld),this.modelViewMatrix.multiplyMatrices(e.camera.matrixWorldInverse,this.matrixWorld),Wd.setFromMatrixPosition(this.modelViewMatrix),e.camera.isPerspectiveCamera&&this.material.sizeAttenuation===!1&&xd.multiplyScalar(-Wd.z);const n=this.material.rotation;let i,s;n!==0&&(s=Math.cos(n),i=Math.sin(n));const o=this.center;Om(Dm.set(-.5,-.5,0),Wd,o,xd,i,s),Om(Th.set(.5,-.5,0),Wd,o,xd,i,s),Om(km.set(.5,.5,0),Wd,o,xd,i,s),pR.set(0,0),gB.set(1,0),mR.set(1,1);let r=e.ray.intersectTriangle(Dm,Th,km,!1,Fh);if(r===null&&(Om(Th.set(-.5,.5,0),Wd,o,xd,i,s),gB.set(0,1),r=e.ray.intersectTriangle(Dm,km,Th,!1,Fh),r===null))return;const g=e.ray.origin.distanceTo(Fh);g<e.near||g>e.far||t.push({distance:g,point:Fh.clone(),uv:Ro.getInterpolation(Fh,Dm,Th,km,pR,gB,mR,new at),face:null,object:this})}copy(e,t){return super.copy(e,t),e.center!==void 0&&this.center.copy(e.center),this.material=e.material,this}}function Om(a,e,t,n,i,s){Vd.subVectors(a,t).addScalar(.5).multiply(n),i!==void 0?(Eh.x=s*Vd.x-i*Vd.y,Eh.y=i*Vd.x+s*Vd.y):Eh.copy(Vd),a.copy(e),a.x+=Eh.x,a.y+=Eh.y,a.applyMatrix4(YV)}const Jm=new ae,bR=new ae;class FV extends wn{constructor(){super(),this.isLOD=!0,this._currentLevel=0,this.type="LOD",Object.defineProperties(this,{levels:{enumerable:!0,value:[]}}),this.autoUpdate=!0}copy(e){super.copy(e,!1);const t=e.levels;for(let n=0,i=t.length;n<i;n++){const s=t[n];this.addLevel(s.object.clone(),s.distance,s.hysteresis)}return this.autoUpdate=e.autoUpdate,this}addLevel(e,t=0,n=0){t=Math.abs(t);const i=this.levels;let s;for(s=0;s<i.length&&!(t<i[s].distance);s++);return i.splice(s,0,{distance:t,hysteresis:n,object:e}),this.add(e),this}removeLevel(e){const t=this.levels;for(let n=0;n<t.length;n++)if(t[n].distance===e){const i=t.splice(n,1);return this.remove(i[0].object),!0}return!1}getCurrentLevel(){return this._currentLevel}getObjectForDistance(e){const t=this.levels;if(t.length>0){let n,i;for(n=1,i=t.length;n<i;n++){let s=t[n].distance;if(t[n].object.visible&&(s-=s*t[n].hysteresis),e<s)break}return t[n-1].object}return null}raycast(e,t){if(this.levels.length>0){Jm.setFromMatrixPosition(this.matrixWorld);const i=e.ray.origin.distanceTo(Jm);this.getObjectForDistance(i).raycast(e,t)}}update(e){const t=this.levels;if(t.length>1){Jm.setFromMatrixPosition(e.matrixWorld),bR.setFromMatrixPosition(this.matrixWorld);const n=Jm.distanceTo(bR)/e.zoom;t[0].object.visible=!0;let i,s;for(i=1,s=t.length;i<s;i++){let o=t[i].distance;if(t[i].object.visible&&(o-=o*t[i].hysteresis),n>=o)t[i-1].object.visible=!1,t[i].object.visible=!0;else break}for(this._currentLevel=i-1;i<s;i++)t[i].object.visible=!1}}toJSON(e){const t=super.toJSON(e);this.autoUpdate===!1&&(t.object.autoUpdate=!1),t.object.levels=[];const n=this.levels;for(let i=0,s=n.length;i<s;i++){const o=n[i];t.object.levels.push({object:o.object.uuid,distance:o.distance,hysteresis:o.hysteresis})}return t}}const yR=new ae,GR=new Hn,BR=new Hn,BY=new ae,vR=new Yt,Pm=new ae,cB=new Ra,ZR=new Yt,uB=new AC;class aZ extends vi{constructor(e,t){super(e,t),this.isSkinnedMesh=!0,this.type="SkinnedMesh",this.bindMode=Tv,this.bindMatrix=new Yt,this.bindMatrixInverse=new Yt,this.boundingBox=null,this.boundingSphere=null}computeBoundingBox(){const e=this.geometry;this.boundingBox===null&&(this.boundingBox=new Sa),this.boundingBox.makeEmpty();const t=e.getAttribute("position");for(let n=0;n<t.count;n++)this.getVertexPosition(n,Pm),this.boundingBox.expandByPoint(Pm)}computeBoundingSphere(){const e=this.geometry;this.boundingSphere===null&&(this.boundingSphere=new Ra),this.boundingSphere.makeEmpty();const t=e.getAttribute("position");for(let n=0;n<t.count;n++)this.getVertexPosition(n,Pm),this.boundingSphere.expandByPoint(Pm)}copy(e,t){return super.copy(e,t),this.bindMode=e.bindMode,this.bindMatrix.copy(e.bindMatrix),this.bindMatrixInverse.copy(e.bindMatrixInverse),this.skeleton=e.skeleton,e.boundingBox!==null&&(this.boundingBox=e.boundingBox.clone()),e.boundingSphere!==null&&(this.boundingSphere=e.boundingSphere.clone()),this}raycast(e,t){const n=this.material,i=this.matrixWorld;n!==void 0&&(this.boundingSphere===null&&this.computeBoundingSphere(),cB.copy(this.boundingSphere),cB.applyMatrix4(i),e.ray.intersectsSphere(cB)!==!1&&(ZR.copy(i).invert(),uB.copy(e.ray).applyMatrix4(ZR),!(this.boundingBox!==null&&uB.intersectsBox(this.boundingBox)===!1)&&this._computeIntersections(e,t,uB)))}getVertexPosition(e,t){return super.getVertexPosition(e,t),this.applyBoneTransform(e,t),t}bind(e,t){this.skeleton=e,t===void 0&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),t=this.matrixWorld),this.bindMatrix.copy(t),this.bindMatrixInverse.copy(t).invert()}pose(){this.skeleton.pose()}normalizeSkinWeights(){const e=new Hn,t=this.geometry.attributes.skinWeight;for(let n=0,i=t.count;n<i;n++){e.fromBufferAttribute(t,n);const s=1/e.manhattanLength();s!==1/0?e.multiplyScalar(s):e.set(1,0,0,0),t.setXYZW(n,e.x,e.y,e.z,e.w)}}updateMatrixWorld(e){super.updateMatrixWorld(e),this.bindMode===Tv?this.bindMatrixInverse.copy(this.matrixWorld).invert():this.bindMode===AV?this.bindMatrixInverse.copy(this.bindMatrix).invert():console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)}applyBoneTransform(e,t){const n=this.skeleton,i=this.geometry;GR.fromBufferAttribute(i.attributes.skinIndex,e),BR.fromBufferAttribute(i.attributes.skinWeight,e),yR.copy(t).applyMatrix4(this.bindMatrix),t.set(0,0,0);for(let s=0;s<4;s++){const o=BR.getComponent(s);if(o!==0){const r=GR.getComponent(s);vR.multiplyMatrices(n.bones[r].matrixWorld,n.boneInverses[r]),t.addScaledVector(BY.copy(yR).applyMatrix4(vR),o)}}return t.applyMatrix4(this.bindMatrixInverse)}}class yy extends wn{constructor(){super(),this.isBone=!0,this.type="Bone"}}class hg extends Zi{constructor(e=null,t=1,n=1,i,s,o,r,g,u=Fa,C=Fa,h,f){super(null,o,r,g,u,C,i,s,h,f),this.isDataTexture=!0,this.image={data:e,width:t,height:n},this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}const SR=new Yt,vY=new Yt;class Of{constructor(e=[],t=[]){this.uuid=Po(),this.bones=e.slice(0),this.boneInverses=t,this.boneMatrices=null,this.boneTexture=null,this.init()}init(){const e=this.bones,t=this.boneInverses;if(this.boneMatrices=new Float32Array(e.length*16),t.length===0)this.calculateInverses();else if(e.length!==t.length){console.warn("THREE.Skeleton: Number of inverse bone matrices does not match amount of bones."),this.boneInverses=[];for(let n=0,i=this.bones.length;n<i;n++)this.boneInverses.push(new Yt)}}calculateInverses(){this.boneInverses.length=0;for(let e=0,t=this.bones.length;e<t;e++){const n=new Yt;this.bones[e]&&n.copy(this.bones[e].matrixWorld).invert(),this.boneInverses.push(n)}}pose(){for(let e=0,t=this.bones.length;e<t;e++){const n=this.bones[e];n&&n.matrixWorld.copy(this.boneInverses[e]).invert()}for(let e=0,t=this.bones.length;e<t;e++){const n=this.bones[e];n&&(n.parent&&n.parent.isBone?(n.matrix.copy(n.parent.matrixWorld).invert(),n.matrix.multiply(n.matrixWorld)):n.matrix.copy(n.matrixWorld),n.matrix.decompose(n.position,n.quaternion,n.scale))}}update(){const e=this.bones,t=this.boneInverses,n=this.boneMatrices,i=this.boneTexture;for(let s=0,o=e.length;s<o;s++){const r=e[s]?e[s].matrixWorld:vY;SR.multiplyMatrices(r,t[s]),SR.toArray(n,s*16)}i!==null&&(i.needsUpdate=!0)}clone(){return new Of(this.bones,this.boneInverses)}computeBoneTexture(){let e=Math.sqrt(this.bones.length*4);e=Math.ceil(e/4)*4,e=Math.max(e,4);const t=new Float32Array(e*e*4);t.set(this.boneMatrices);const n=new hg(t,e,e,Gs,qs);return n.needsUpdate=!0,this.boneMatrices=t,this.boneTexture=n,this}getBoneByName(e){for(let t=0,n=this.bones.length;t<n;t++){const i=this.bones[t];if(i.name===e)return i}}dispose(){this.boneTexture!==null&&(this.boneTexture.dispose(),this.boneTexture=null)}fromJSON(e,t){this.uuid=e.uuid;for(let n=0,i=e.bones.length;n<i;n++){const s=e.bones[n];let o=t[s];o===void 0&&(console.warn("THREE.Skeleton: No bone found with UUID:",s),o=new yy),this.bones.push(o),this.boneInverses.push(new Yt().fromArray(e.boneInverses[n]))}return this.init(),this}toJSON(){const e={metadata:{version:4.7,type:"Skeleton",generator:"Skeleton.toJSON"},bones:[],boneInverses:[]};e.uuid=this.uuid;const t=this.bones,n=this.boneInverses;for(let i=0,s=t.length;i<s;i++){const o=t[i];e.bones.push(o.uuid);const r=n[i];e.boneInverses.push(r.toArray())}return e}}class Su extends En{constructor(e,t,n,i=1){super(e,t,n),this.isInstancedBufferAttribute=!0,this.meshPerAttribute=i}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}toJSON(){const e=super.toJSON();return e.meshPerAttribute=this.meshPerAttribute,e.isInstancedBufferAttribute=!0,e}}const Md=new Yt,RR=new Yt,Qm=[],wR=new Sa,ZY=new Yt,zh=new vi,Lh=new Ra;class eC extends vi{constructor(e,t,n){super(e,t),this.isInstancedMesh=!0,this.instanceMatrix=new Su(new Float32Array(n*16),16),this.instanceColor=null,this.morphTexture=null,this.count=n,this.boundingBox=null,this.boundingSphere=null;for(let i=0;i<n;i++)this.setMatrixAt(i,ZY)}computeBoundingBox(){const e=this.geometry,t=this.count;this.boundingBox===null&&(this.boundingBox=new Sa),e.boundingBox===null&&e.computeBoundingBox(),this.boundingBox.makeEmpty();for(let n=0;n<t;n++)this.getMatrixAt(n,Md),wR.copy(e.boundingBox).applyMatrix4(Md),this.boundingBox.union(wR)}computeBoundingSphere(){const e=this.geometry,t=this.count;this.boundingSphere===null&&(this.boundingSphere=new Ra),e.boundingSphere===null&&e.computeBoundingSphere(),this.boundingSphere.makeEmpty();for(let n=0;n<t;n++)this.getMatrixAt(n,Md),Lh.copy(e.boundingSphere).applyMatrix4(Md),this.boundingSphere.union(Lh)}copy(e,t){return super.copy(e,t),this.instanceMatrix.copy(e.instanceMatrix),e.morphTexture!==null&&(this.morphTexture=e.morphTexture.clone()),e.instanceColor!==null&&(this.instanceColor=e.instanceColor.clone()),this.count=e.count,e.boundingBox!==null&&(this.boundingBox=e.boundingBox.clone()),e.boundingSphere!==null&&(this.boundingSphere=e.boundingSphere.clone()),this}getColorAt(e,t){t.fromArray(this.instanceColor.array,e*3)}getMatrixAt(e,t){t.fromArray(this.instanceMatrix.array,e*16)}getMorphAt(e,t){const n=t.morphTargetInfluences,i=this.morphTexture.source.data.data,s=n.length+1,o=e*s+1;for(let r=0;r<n.length;r++)n[r]=i[o+r]}raycast(e,t){const n=this.matrixWorld,i=this.count;if(zh.geometry=this.geometry,zh.material=this.material,zh.material!==void 0&&(this.boundingSphere===null&&this.computeBoundingSphere(),Lh.copy(this.boundingSphere),Lh.applyMatrix4(n),e.ray.intersectsSphere(Lh)!==!1))for(let s=0;s<i;s++){this.getMatrixAt(s,Md),RR.multiplyMatrices(n,Md),zh.matrixWorld=RR,zh.raycast(e,Qm);for(let o=0,r=Qm.length;o<r;o++){const g=Qm[o];g.instanceId=s,g.object=this,t.push(g)}Qm.length=0}}setColorAt(e,t){this.instanceColor===null&&(this.instanceColor=new Su(new Float32Array(this.instanceMatrix.count*3).fill(1),3)),t.toArray(this.instanceColor.array,e*3)}setMatrixAt(e,t){t.toArray(this.instanceMatrix.array,e*16)}setMorphAt(e,t){const n=t.morphTargetInfluences,i=n.length+1;this.morphTexture===null&&(this.morphTexture=new hg(new Float32Array(i*this.count),i,this.count,uy,qs));const s=this.morphTexture.source.data.data;let o=0;for(let u=0;u<n.length;u++)o+=n[u];const r=this.geometry.morphTargetsRelative?1:1-o,g=i*e;s[g]=r,s.set(n,g+1)}updateMorphTargets(){}dispose(){this.dispatchEvent({type:"dispose"}),this.morphTexture!==null&&(this.morphTexture.dispose(),this.morphTexture=null)}}const IB=new ae,SY=new ae,RY=new on;let nc=class{constructor(e=new ae(1,0,0),t=0){this.isPlane=!0,this.normal=e,this.constant=t}set(e,t){return this.normal.copy(e),this.constant=t,this}setComponents(e,t,n,i){return this.normal.set(e,t,n),this.constant=i,this}setFromNormalAndCoplanarPoint(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this}setFromCoplanarPoints(e,t,n){const i=IB.subVectors(n,t).cross(SY.subVectors(e,t)).normalize();return this.setFromNormalAndCoplanarPoint(i,e),this}copy(e){return this.normal.copy(e.normal),this.constant=e.constant,this}normalize(){const e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(e){return this.normal.dot(e)+this.constant}distanceToSphere(e){return this.distanceToPoint(e.center)-e.radius}projectPoint(e,t){return t.copy(e).addScaledVector(this.normal,-this.distanceToPoint(e))}intersectLine(e,t){const n=e.delta(IB),i=this.normal.dot(n);if(i===0)return this.distanceToPoint(e.start)===0?t.copy(e.start):null;const s=-(e.start.dot(this.normal)+this.constant)/i;return s<0||s>1?null:t.copy(e.start).addScaledVector(n,s)}intersectsLine(e){const t=this.distanceToPoint(e.start),n=this.distanceToPoint(e.end);return t<0&&n>0||n<0&&t>0}intersectsBox(e){return e.intersectsPlane(this)}intersectsSphere(e){return e.intersectsPlane(this)}coplanarPoint(e){return e.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(e,t){const n=t||RY.getNormalMatrix(e),i=this.coplanarPoint(IB).applyMatrix4(e),s=this.normal.applyMatrix3(n).normalize();return this.constant=-i.dot(s),this}translate(e){return this.constant-=e.dot(this.normal),this}equals(e){return e.normal.equals(this.normal)&&e.constant===this.constant}clone(){return new this.constructor().copy(this)}};const BI=new Ra,jm=new ae;class CA{constructor(e=new nc,t=new nc,n=new nc,i=new nc,s=new nc,o=new nc){this.planes=[e,t,n,i,s,o]}set(e,t,n,i,s,o){const r=this.planes;return r[0].copy(e),r[1].copy(t),r[2].copy(n),r[3].copy(i),r[4].copy(s),r[5].copy(o),this}copy(e){const t=this.planes;for(let n=0;n<6;n++)t[n].copy(e.planes[n]);return this}setFromProjectionMatrix(e,t=Gl){const n=this.planes,i=e.elements,s=i[0],o=i[1],r=i[2],g=i[3],u=i[4],C=i[5],h=i[6],f=i[7],p=i[8],y=i[9],v=i[10],G=i[11],B=i[12],R=i[13],x=i[14],w=i[15];if(n[0].setComponents(g-s,f-u,G-p,w-B).normalize(),n[1].setComponents(g+s,f+u,G+p,w+B).normalize(),n[2].setComponents(g+o,f+C,G+y,w+R).normalize(),n[3].setComponents(g-o,f-C,G-y,w-R).normalize(),n[4].setComponents(g-r,f-h,G-v,w-x).normalize(),t===Gl)n[5].setComponents(g+r,f+h,G+v,w+x).normalize();else if(t===Vf)n[5].setComponents(r,h,v,x).normalize();else throw new Error("THREE.Frustum.setFromProjectionMatrix(): Invalid coordinate system: "+t);return this}intersectsObject(e){if(e.boundingSphere!==void 0)e.boundingSphere===null&&e.computeBoundingSphere(),BI.copy(e.boundingSphere).applyMatrix4(e.matrixWorld);else{const t=e.geometry;t.boundingSphere===null&&t.computeBoundingSphere(),BI.copy(t.boundingSphere).applyMatrix4(e.matrixWorld)}return this.intersectsSphere(BI)}intersectsSprite(e){return BI.center.set(0,0,0),BI.radius=.7071067811865476,BI.applyMatrix4(e.matrixWorld),this.intersectsSphere(BI)}intersectsSphere(e){const t=this.planes,n=e.center,i=-e.radius;for(let s=0;s<6;s++)if(t[s].distanceToPoint(n)<i)return!1;return!0}intersectsBox(e){const t=this.planes;for(let n=0;n<6;n++){const i=t[n];if(jm.x=i.normal.x>0?e.max.x:e.min.x,jm.y=i.normal.y>0?e.max.y:e.min.y,jm.z=i.normal.z>0?e.max.z:e.min.z,i.distanceToPoint(jm)<0)return!1}return!0}containsPoint(e){const t=this.planes;for(let n=0;n<6;n++)if(t[n].distanceToPoint(e)<0)return!1;return!0}clone(){return new this.constructor().copy(this)}}const lg=new Yt,rg=new CA;class Gy{constructor(){this.coordinateSystem=Gl}intersectsObject(e,t){if(!t.isArrayCamera||t.cameras.length===0)return!1;for(let n=0;n<t.cameras.length;n++){const i=t.cameras[n];if(lg.multiplyMatrices(i.projectionMatrix,i.matrixWorldInverse),rg.setFromProjectionMatrix(lg,this.coordinateSystem),rg.intersectsObject(e))return!0}return!1}intersectsSprite(e,t){if(!t||!t.cameras||t.cameras.length===0)return!1;for(let n=0;n<t.cameras.length;n++){const i=t.cameras[n];if(lg.multiplyMatrices(i.projectionMatrix,i.matrixWorldInverse),rg.setFromProjectionMatrix(lg,this.coordinateSystem),rg.intersectsSprite(e))return!0}return!1}intersectsSphere(e,t){if(!t||!t.cameras||t.cameras.length===0)return!1;for(let n=0;n<t.cameras.length;n++){const i=t.cameras[n];if(lg.multiplyMatrices(i.projectionMatrix,i.matrixWorldInverse),rg.setFromProjectionMatrix(lg,this.coordinateSystem),rg.intersectsSphere(e))return!0}return!1}intersectsBox(e,t){if(!t||!t.cameras||t.cameras.length===0)return!1;for(let n=0;n<t.cameras.length;n++){const i=t.cameras[n];if(lg.multiplyMatrices(i.projectionMatrix,i.matrixWorldInverse),rg.setFromProjectionMatrix(lg,this.coordinateSystem),rg.intersectsBox(e))return!0}return!1}containsPoint(e,t){if(!t||!t.cameras||t.cameras.length===0)return!1;for(let n=0;n<t.cameras.length;n++){const i=t.cameras[n];if(lg.multiplyMatrices(i.projectionMatrix,i.matrixWorldInverse),rg.setFromProjectionMatrix(lg,this.coordinateSystem),rg.containsPoint(e))return!0}return!1}clone(){return new Gy}}function CB(a,e){return a-e}function wY(a,e){return a.z-e.z}function xY(a,e){return e.z-a.z}class WY{constructor(){this.index=0,this.pool=[],this.list=[]}push(e,t,n,i){const s=this.pool,o=this.list;this.index>=s.length&&s.push({start:-1,count:-1,z:-1,index:-1});const r=s[this.index];o.push(r),this.index++,r.start=e,r.count=t,r.z=n,r.index=i}reset(){this.list.length=0,this.index=0}}const bo=new Yt,VY=new Gt(1,1,1),xR=new CA,MY=new Gy,qm=new Sa,vI=new Ra,_h=new ae,WR=new ae,HY=new ae,dB=new WY,ps=new vi,$m=[];function XY(a,e,t=0){const n=e.itemSize;if(a.isInterleavedBufferAttribute||a.array.constructor!==e.array.constructor){const i=a.count;for(let s=0;s<i;s++)for(let o=0;o<n;o++)e.setComponent(s+t,o,a.getComponent(s,o))}else e.array.set(a.array,t*n);e.needsUpdate=!0}function ZI(a,e){if(a.constructor!==e.constructor){const t=Math.min(a.length,e.length);for(let n=0;n<t;n++)e[n]=a[n]}else{const t=Math.min(a.length,e.length);e.set(new a.constructor(a.buffer,0,t))}}class EV extends vi{constructor(e,t,n=t*2,i){super(new rn,i),this.isBatchedMesh=!0,this.perObjectFrustumCulled=!0,this.sortObjects=!0,this.boundingBox=null,this.boundingSphere=null,this.customSort=null,this._instanceInfo=[],this._geometryInfo=[],this._availableInstanceIds=[],this._availableGeometryIds=[],this._nextIndexStart=0,this._nextVertexStart=0,this._geometryCount=0,this._visibilityChanged=!0,this._geometryInitialized=!1,this._maxInstanceCount=e,this._maxVertexCount=t,this._maxIndexCount=n,this._multiDrawCounts=new Int32Array(e),this._multiDrawStarts=new Int32Array(e),this._multiDrawCount=0,this._multiDrawInstances=null,this._matricesTexture=null,this._indirectTexture=null,this._colorsTexture=null,this._initMatricesTexture(),this._initIndirectTexture()}get maxInstanceCount(){return this._maxInstanceCount}get instanceCount(){return this._instanceInfo.length-this._availableInstanceIds.length}get unusedVertexCount(){return this._maxVertexCount-this._nextVertexStart}get unusedIndexCount(){return this._maxIndexCount-this._nextIndexStart}_initMatricesTexture(){let e=Math.sqrt(this._maxInstanceCount*4);e=Math.ceil(e/4)*4,e=Math.max(e,4);const t=new Float32Array(e*e*4),n=new hg(t,e,e,Gs,qs);this._matricesTexture=n}_initIndirectTexture(){let e=Math.sqrt(this._maxInstanceCount);e=Math.ceil(e);const t=new Uint32Array(e*e),n=new hg(t,e,e,Uf,fc);this._indirectTexture=n}_initColorsTexture(){let e=Math.sqrt(this._maxInstanceCount);e=Math.ceil(e);const t=new Float32Array(e*e*4).fill(1),n=new hg(t,e,e,Gs,qs);n.colorSpace=Mn.workingColorSpace,this._colorsTexture=n}_initializeGeometry(e){const t=this.geometry,n=this._maxVertexCount,i=this._maxIndexCount;if(this._geometryInitialized===!1){for(const s in e.attributes){const o=e.getAttribute(s),{array:r,itemSize:g,normalized:u}=o,C=new r.constructor(n*g),h=new En(C,g,u);t.setAttribute(s,h)}if(e.getIndex()!==null){const s=n>65535?new Uint32Array(i):new Uint16Array(i);t.setIndex(new En(s,1))}this._geometryInitialized=!0}}_validateGeometry(e){const t=this.geometry;if(!!e.getIndex()!=!!t.getIndex())throw new Error('THREE.BatchedMesh: All geometries must consistently have "index".');for(const n in t.attributes){if(!e.hasAttribute(n))throw new Error(`THREE.BatchedMesh: Added geometry missing "${n}". All geometries must have consistent attributes.`);const i=e.getAttribute(n),s=t.getAttribute(n);if(i.itemSize!==s.itemSize||i.normalized!==s.normalized)throw new Error("THREE.BatchedMesh: All attributes must have a consistent itemSize and normalized value.")}}validateInstanceId(e){const t=this._instanceInfo;if(e<0||e>=t.length||t[e].active===!1)throw new Error(`THREE.BatchedMesh: Invalid instanceId ${e}. Instance is either out of range or has been deleted.`)}validateGeometryId(e){const t=this._geometryInfo;if(e<0||e>=t.length||t[e].active===!1)throw new Error(`THREE.BatchedMesh: Invalid geometryId ${e}. Geometry is either out of range or has been deleted.`)}setCustomSort(e){return this.customSort=e,this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new Sa);const e=this.boundingBox,t=this._instanceInfo;e.makeEmpty();for(let n=0,i=t.length;n<i;n++){if(t[n].active===!1)continue;const s=t[n].geometryIndex;this.getMatrixAt(n,bo),this.getBoundingBoxAt(s,qm).applyMatrix4(bo),e.union(qm)}}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new Ra);const e=this.boundingSphere,t=this._instanceInfo;e.makeEmpty();for(let n=0,i=t.length;n<i;n++){if(t[n].active===!1)continue;const s=t[n].geometryIndex;this.getMatrixAt(n,bo),this.getBoundingSphereAt(s,vI).applyMatrix4(bo),e.union(vI)}}addInstance(e){if(this._instanceInfo.length>=this.maxInstanceCount&&this._availableInstanceIds.length===0)throw new Error("THREE.BatchedMesh: Maximum item count reached.");const n={visible:!0,active:!0,geometryIndex:e};let i=null;this._availableInstanceIds.length>0?(this._availableInstanceIds.sort(CB),i=this._availableInstanceIds.shift(),this._instanceInfo[i]=n):(i=this._instanceInfo.length,this._instanceInfo.push(n));const s=this._matricesTexture;bo.identity().toArray(s.image.data,i*16),s.needsUpdate=!0;const o=this._colorsTexture;return o&&(VY.toArray(o.image.data,i*4),o.needsUpdate=!0),this._visibilityChanged=!0,i}addGeometry(e,t=-1,n=-1){this._initializeGeometry(e),this._validateGeometry(e);const i={vertexStart:-1,vertexCount:-1,reservedVertexCount:-1,indexStart:-1,indexCount:-1,reservedIndexCount:-1,start:-1,count:-1,boundingBox:null,boundingSphere:null,active:!0},s=this._geometryInfo;i.vertexStart=this._nextVertexStart,i.reservedVertexCount=t===-1?e.getAttribute("position").count:t;const o=e.getIndex();if(o!==null&&(i.indexStart=this._nextIndexStart,i.reservedIndexCount=n===-1?o.count:n),i.indexStart!==-1&&i.indexStart+i.reservedIndexCount>this._maxIndexCount||i.vertexStart+i.reservedVertexCount>this._maxVertexCount)throw new Error("THREE.BatchedMesh: Reserved space request exceeds the maximum buffer size.");let g;return this._availableGeometryIds.length>0?(this._availableGeometryIds.sort(CB),g=this._availableGeometryIds.shift(),s[g]=i):(g=this._geometryCount,this._geometryCount++,s.push(i)),this.setGeometryAt(g,e),this._nextIndexStart=i.indexStart+i.reservedIndexCount,this._nextVertexStart=i.vertexStart+i.reservedVertexCount,g}setGeometryAt(e,t){if(e>=this._geometryCount)throw new Error("THREE.BatchedMesh: Maximum geometry count reached.");this._validateGeometry(t);const n=this.geometry,i=n.getIndex()!==null,s=n.getIndex(),o=t.getIndex(),r=this._geometryInfo[e];if(i&&o.count>r.reservedIndexCount||t.attributes.position.count>r.reservedVertexCount)throw new Error("THREE.BatchedMesh: Reserved space not large enough for provided geometry.");const g=r.vertexStart,u=r.reservedVertexCount;r.vertexCount=t.getAttribute("position").count;for(const C in n.attributes){const h=t.getAttribute(C),f=n.getAttribute(C);XY(h,f,g);const p=h.itemSize;for(let y=h.count,v=u;y<v;y++){const G=g+y;for(let B=0;B<p;B++)f.setComponent(G,B,0)}f.needsUpdate=!0,f.addUpdateRange(g*p,u*p)}if(i){const C=r.indexStart,h=r.reservedIndexCount;r.indexCount=t.getIndex().count;for(let f=0;f<o.count;f++)s.setX(C+f,g+o.getX(f));for(let f=o.count,p=h;f<p;f++)s.setX(C+f,g);s.needsUpdate=!0,s.addUpdateRange(C,r.reservedIndexCount)}return r.start=i?r.indexStart:r.vertexStart,r.count=i?r.indexCount:r.vertexCount,r.boundingBox=null,t.boundingBox!==null&&(r.boundingBox=t.boundingBox.clone()),r.boundingSphere=null,t.boundingSphere!==null&&(r.boundingSphere=t.boundingSphere.clone()),this._visibilityChanged=!0,e}deleteGeometry(e){const t=this._geometryInfo;if(e>=t.length||t[e].active===!1)return this;const n=this._instanceInfo;for(let i=0,s=n.length;i<s;i++)n[i].active&&n[i].geometryIndex===e&&this.deleteInstance(i);return t[e].active=!1,this._availableGeometryIds.push(e),this._visibilityChanged=!0,this}deleteInstance(e){return this.validateInstanceId(e),this._instanceInfo[e].active=!1,this._availableInstanceIds.push(e),this._visibilityChanged=!0,this}optimize(){let e=0,t=0;const n=this._geometryInfo,i=n.map((o,r)=>r).sort((o,r)=>n[o].vertexStart-n[r].vertexStart),s=this.geometry;for(let o=0,r=n.length;o<r;o++){const g=i[o],u=n[g];if(u.active!==!1){if(s.index!==null){if(u.indexStart!==t){const{indexStart:C,vertexStart:h,reservedIndexCount:f}=u,p=s.index,y=p.array,v=e-h;for(let G=C;G<C+f;G++)y[G]=y[G]+v;p.array.copyWithin(t,C,C+f),p.addUpdateRange(t,f),u.indexStart=t}t+=u.reservedIndexCount}if(u.vertexStart!==e){const{vertexStart:C,reservedVertexCount:h}=u,f=s.attributes;for(const p in f){const y=f[p],{array:v,itemSize:G}=y;v.copyWithin(e*G,C*G,(C+h)*G),y.addUpdateRange(e*G,h*G)}u.vertexStart=e}e+=u.reservedVertexCount,u.start=s.index?u.indexStart:u.vertexStart,this._nextIndexStart=s.index?u.indexStart+u.reservedIndexCount:0,this._nextVertexStart=u.vertexStart+u.reservedVertexCount}}return this}getBoundingBoxAt(e,t){if(e>=this._geometryCount)return null;const n=this.geometry,i=this._geometryInfo[e];if(i.boundingBox===null){const s=new Sa,o=n.index,r=n.attributes.position;for(let g=i.start,u=i.start+i.count;g<u;g++){let C=g;o&&(C=o.getX(C)),s.expandByPoint(_h.fromBufferAttribute(r,C))}i.boundingBox=s}return t.copy(i.boundingBox),t}getBoundingSphereAt(e,t){if(e>=this._geometryCount)return null;const n=this.geometry,i=this._geometryInfo[e];if(i.boundingSphere===null){const s=new Ra;this.getBoundingBoxAt(e,qm),qm.getCenter(s.center);const o=n.index,r=n.attributes.position;let g=0;for(let u=i.start,C=i.start+i.count;u<C;u++){let h=u;o&&(h=o.getX(h)),_h.fromBufferAttribute(r,h),g=Math.max(g,s.center.distanceToSquared(_h))}s.radius=Math.sqrt(g),i.boundingSphere=s}return t.copy(i.boundingSphere),t}setMatrixAt(e,t){this.validateInstanceId(e);const n=this._matricesTexture,i=this._matricesTexture.image.data;return t.toArray(i,e*16),n.needsUpdate=!0,this}getMatrixAt(e,t){return this.validateInstanceId(e),t.fromArray(this._matricesTexture.image.data,e*16)}setColorAt(e,t){return this.validateInstanceId(e),this._colorsTexture===null&&this._initColorsTexture(),t.toArray(this._colorsTexture.image.data,e*4),this._colorsTexture.needsUpdate=!0,this}getColorAt(e,t){return this.validateInstanceId(e),t.fromArray(this._colorsTexture.image.data,e*4)}setVisibleAt(e,t){return this.validateInstanceId(e),this._instanceInfo[e].visible===t?this:(this._instanceInfo[e].visible=t,this._visibilityChanged=!0,this)}getVisibleAt(e){return this.validateInstanceId(e),this._instanceInfo[e].visible}setGeometryIdAt(e,t){return this.validateInstanceId(e),this.validateGeometryId(t),this._instanceInfo[e].geometryIndex=t,this}getGeometryIdAt(e){return this.validateInstanceId(e),this._instanceInfo[e].geometryIndex}getGeometryRangeAt(e,t={}){this.validateGeometryId(e);const n=this._geometryInfo[e];return t.vertexStart=n.vertexStart,t.vertexCount=n.vertexCount,t.reservedVertexCount=n.reservedVertexCount,t.indexStart=n.indexStart,t.indexCount=n.indexCount,t.reservedIndexCount=n.reservedIndexCount,t.start=n.start,t.count=n.count,t}setInstanceCount(e){const t=this._availableInstanceIds,n=this._instanceInfo;for(t.sort(CB);t[t.length-1]===n.length;)n.pop(),t.pop();if(e<n.length)throw new Error(`BatchedMesh: Instance ids outside the range ${e} are being used. Cannot shrink instance count.`);const i=new Int32Array(e),s=new Int32Array(e);ZI(this._multiDrawCounts,i),ZI(this._multiDrawStarts,s),this._multiDrawCounts=i,this._multiDrawStarts=s,this._maxInstanceCount=e;const o=this._indirectTexture,r=this._matricesTexture,g=this._colorsTexture;o.dispose(),this._initIndirectTexture(),ZI(o.image.data,this._indirectTexture.image.data),r.dispose(),this._initMatricesTexture(),ZI(r.image.data,this._matricesTexture.image.data),g&&(g.dispose(),this._initColorsTexture(),ZI(g.image.data,this._colorsTexture.image.data))}setGeometrySize(e,t){const n=[...this._geometryInfo].filter(r=>r.active);if(Math.max(...n.map(r=>r.vertexStart+r.reservedVertexCount))>e)throw new Error(`BatchedMesh: Geometry vertex values are being used outside the range ${t}. Cannot shrink further.`);if(this.geometry.index&&Math.max(...n.map(g=>g.indexStart+g.reservedIndexCount))>t)throw new Error(`BatchedMesh: Geometry index values are being used outside the range ${t}. Cannot shrink further.`);const s=this.geometry;s.dispose(),this._maxVertexCount=e,this._maxIndexCount=t,this._geometryInitialized&&(this._geometryInitialized=!1,this.geometry=new rn,this._initializeGeometry(s));const o=this.geometry;s.index&&ZI(s.index.array,o.index.array);for(const r in s.attributes)ZI(s.attributes[r].array,o.attributes[r].array)}raycast(e,t){const n=this._instanceInfo,i=this._geometryInfo,s=this.matrixWorld,o=this.geometry;ps.material=this.material,ps.geometry.index=o.index,ps.geometry.attributes=o.attributes,ps.geometry.boundingBox===null&&(ps.geometry.boundingBox=new Sa),ps.geometry.boundingSphere===null&&(ps.geometry.boundingSphere=new Ra);for(let r=0,g=n.length;r<g;r++){if(!n[r].visible||!n[r].active)continue;const u=n[r].geometryIndex,C=i[u];ps.geometry.setDrawRange(C.start,C.count),this.getMatrixAt(r,ps.matrixWorld).premultiply(s),this.getBoundingBoxAt(u,ps.geometry.boundingBox),this.getBoundingSphereAt(u,ps.geometry.boundingSphere),ps.raycast(e,$m);for(let h=0,f=$m.length;h<f;h++){const p=$m[h];p.object=this,p.batchId=r,t.push(p)}$m.length=0}ps.material=null,ps.geometry.index=null,ps.geometry.attributes={},ps.geometry.setDrawRange(0,1/0)}copy(e){return super.copy(e),this.geometry=e.geometry.clone(),this.perObjectFrustumCulled=e.perObjectFrustumCulled,this.sortObjects=e.sortObjects,this.boundingBox=e.boundingBox!==null?e.boundingBox.clone():null,this.boundingSphere=e.boundingSphere!==null?e.boundingSphere.clone():null,this._geometryInfo=e._geometryInfo.map(t=>({...t,boundingBox:t.boundingBox!==null?t.boundingBox.clone():null,boundingSphere:t.boundingSphere!==null?t.boundingSphere.clone():null})),this._instanceInfo=e._instanceInfo.map(t=>({...t})),this._availableInstanceIds=e._availableInstanceIds.slice(),this._availableGeometryIds=e._availableGeometryIds.slice(),this._nextIndexStart=e._nextIndexStart,this._nextVertexStart=e._nextVertexStart,this._geometryCount=e._geometryCount,this._maxInstanceCount=e._maxInstanceCount,this._maxVertexCount=e._maxVertexCount,this._maxIndexCount=e._maxIndexCount,this._geometryInitialized=e._geometryInitialized,this._multiDrawCounts=e._multiDrawCounts.slice(),this._multiDrawStarts=e._multiDrawStarts.slice(),this._indirectTexture=e._indirectTexture.clone(),this._indirectTexture.image.data=this._indirectTexture.image.data.slice(),this._matricesTexture=e._matricesTexture.clone(),this._matricesTexture.image.data=this._matricesTexture.image.data.slice(),this._colorsTexture!==null&&(this._colorsTexture=e._colorsTexture.clone(),this._colorsTexture.image.data=this._colorsTexture.image.data.slice()),this}dispose(){this.geometry.dispose(),this._matricesTexture.dispose(),this._matricesTexture=null,this._indirectTexture.dispose(),this._indirectTexture=null,this._colorsTexture!==null&&(this._colorsTexture.dispose(),this._colorsTexture=null)}onBeforeRender(e,t,n,i,s){if(!this._visibilityChanged&&!this.perObjectFrustumCulled&&!this.sortObjects)return;const o=i.getIndex(),r=o===null?1:o.array.BYTES_PER_ELEMENT,g=this._instanceInfo,u=this._multiDrawStarts,C=this._multiDrawCounts,h=this._geometryInfo,f=this.perObjectFrustumCulled,p=this._indirectTexture,y=p.image.data,v=n.isArrayCamera?MY:xR;f&&!n.isArrayCamera&&(bo.multiplyMatrices(n.projectionMatrix,n.matrixWorldInverse).multiply(this.matrixWorld),xR.setFromProjectionMatrix(bo,e.coordinateSystem));let G=0;if(this.sortObjects){bo.copy(this.matrixWorld).invert(),_h.setFromMatrixPosition(n.matrixWorld).applyMatrix4(bo),WR.set(0,0,-1).transformDirection(n.matrixWorld).transformDirection(bo);for(let x=0,w=g.length;x<w;x++)if(g[x].visible&&g[x].active){const M=g[x].geometryIndex;this.getMatrixAt(x,bo),this.getBoundingSphereAt(M,vI).applyMatrix4(bo);let H=!1;if(f&&(H=!v.intersectsSphere(vI,n)),!H){const N=h[M],F=HY.subVectors(vI.center,_h).dot(WR);dB.push(N.start,N.count,F,x)}}const B=dB.list,R=this.customSort;R===null?B.sort(s.transparent?xY:wY):R.call(this,B,n);for(let x=0,w=B.length;x<w;x++){const M=B[x];u[G]=M.start*r,C[G]=M.count,y[G]=M.index,G++}dB.reset()}else for(let B=0,R=g.length;B<R;B++)if(g[B].visible&&g[B].active){const x=g[B].geometryIndex;let w=!1;if(f&&(this.getMatrixAt(B,bo),this.getBoundingSphereAt(x,vI).applyMatrix4(bo),w=!v.intersectsSphere(vI,n)),!w){const M=h[x];u[G]=M.start*r,C[G]=M.count,y[G]=B,G++}}p.needsUpdate=!0,this._multiDrawCount=G,this._visibilityChanged=!1}onBeforeShadow(e,t,n,i,s,o){this.onBeforeRender(e,null,i,s,o)}}class vs extends fa{constructor(e){super(),this.isLineBasicMaterial=!0,this.type="LineBasicMaterial",this.color=new Gt(16777215),this.map=null,this.linewidth=1,this.linecap="round",this.linejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.linewidth=e.linewidth,this.linecap=e.linecap,this.linejoin=e.linejoin,this.fog=e.fog,this}}const X0=new ae,N0=new ae,VR=new Yt,Uh=new AC,eb=new Ra,AB=new ae,MR=new ae;class pc extends wn{constructor(e=new rn,t=new vs){super(),this.isLine=!0,this.type="Line",this.geometry=e,this.material=t,this.morphTargetDictionary=void 0,this.morphTargetInfluences=void 0,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}computeLineDistances(){const e=this.geometry;if(e.index===null){const t=e.attributes.position,n=[0];for(let i=1,s=t.count;i<s;i++)X0.fromBufferAttribute(t,i-1),N0.fromBufferAttribute(t,i),n[i]=n[i-1],n[i]+=X0.distanceTo(N0);e.setAttribute("lineDistance",new Ht(n,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}raycast(e,t){const n=this.geometry,i=this.matrixWorld,s=e.params.Line.threshold,o=n.drawRange;if(n.boundingSphere===null&&n.computeBoundingSphere(),eb.copy(n.boundingSphere),eb.applyMatrix4(i),eb.radius+=s,e.ray.intersectsSphere(eb)===!1)return;VR.copy(i).invert(),Uh.copy(e.ray).applyMatrix4(VR);const r=s/((this.scale.x+this.scale.y+this.scale.z)/3),g=r*r,u=this.isLineSegments?2:1,C=n.index,f=n.attributes.position;if(C!==null){const p=Math.max(0,o.start),y=Math.min(C.count,o.start+o.count);for(let v=p,G=y-1;v<G;v+=u){const B=C.getX(v),R=C.getX(v+1),x=tb(this,e,Uh,g,B,R,v);x&&t.push(x)}if(this.isLineLoop){const v=C.getX(y-1),G=C.getX(p),B=tb(this,e,Uh,g,v,G,y-1);B&&t.push(B)}}else{const p=Math.max(0,o.start),y=Math.min(f.count,o.start+o.count);for(let v=p,G=y-1;v<G;v+=u){const B=tb(this,e,Uh,g,v,v+1,v);B&&t.push(B)}if(this.isLineLoop){const v=tb(this,e,Uh,g,y-1,p,y-1);v&&t.push(v)}}}updateMorphTargets(){const t=this.geometry.morphAttributes,n=Object.keys(t);if(n.length>0){const i=t[n[0]];if(i!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let s=0,o=i.length;s<o;s++){const r=i[s].name||String(s);this.morphTargetInfluences.push(0),this.morphTargetDictionary[r]=s}}}}}function tb(a,e,t,n,i,s,o){const r=a.geometry.attributes.position;if(X0.fromBufferAttribute(r,i),N0.fromBufferAttribute(r,s),t.distanceSqToSegment(X0,N0,AB,MR)>n)return;AB.applyMatrix4(a.matrixWorld);const u=e.ray.origin.distanceTo(AB);if(!(u<e.near||u>e.far))return{distance:u,point:MR.clone().applyMatrix4(a.matrixWorld),index:o,face:null,faceIndex:null,barycoord:null,object:a}}const HR=new ae,XR=new ae;class Gr extends pc{constructor(e,t){super(e,t),this.isLineSegments=!0,this.type="LineSegments"}computeLineDistances(){const e=this.geometry;if(e.index===null){const t=e.attributes.position,n=[];for(let i=0,s=t.count;i<s;i+=2)HR.fromBufferAttribute(t,i),XR.fromBufferAttribute(t,i+1),n[i]=i===0?0:n[i-1],n[i+1]=n[i]+HR.distanceTo(XR);e.setAttribute("lineDistance",new Ht(n,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}}class sZ extends pc{constructor(e,t){super(e,t),this.isLineLoop=!0,this.type="LineLoop"}}class By extends fa{constructor(e){super(),this.isPointsMaterial=!0,this.type="PointsMaterial",this.color=new Gt(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.size=e.size,this.sizeAttenuation=e.sizeAttenuation,this.fog=e.fog,this}}const NR=new Yt,_v=new AC,nb=new Ra,ib=new ae;class oZ extends wn{constructor(e=new rn,t=new By){super(),this.isPoints=!0,this.type="Points",this.geometry=e,this.material=t,this.morphTargetDictionary=void 0,this.morphTargetInfluences=void 0,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}raycast(e,t){const n=this.geometry,i=this.matrixWorld,s=e.params.Points.threshold,o=n.drawRange;if(n.boundingSphere===null&&n.computeBoundingSphere(),nb.copy(n.boundingSphere),nb.applyMatrix4(i),nb.radius+=s,e.ray.intersectsSphere(nb)===!1)return;NR.copy(i).invert(),_v.copy(e.ray).applyMatrix4(NR);const r=s/((this.scale.x+this.scale.y+this.scale.z)/3),g=r*r,u=n.index,h=n.attributes.position;if(u!==null){const f=Math.max(0,o.start),p=Math.min(u.count,o.start+o.count);for(let y=f,v=p;y<v;y++){const G=u.getX(y);ib.fromBufferAttribute(h,G),YR(ib,G,g,i,e,t,this)}}else{const f=Math.max(0,o.start),p=Math.min(h.count,o.start+o.count);for(let y=f,v=p;y<v;y++)ib.fromBufferAttribute(h,y),YR(ib,y,g,i,e,t,this)}}updateMorphTargets(){const t=this.geometry.morphAttributes,n=Object.keys(t);if(n.length>0){const i=t[n[0]];if(i!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let s=0,o=i.length;s<o;s++){const r=i[s].name||String(s);this.morphTargetInfluences.push(0),this.morphTargetDictionary[r]=s}}}}}function YR(a,e,t,n,i,s,o){const r=_v.distanceSqToPoint(a);if(r<t){const g=new ae;_v.closestPointToPoint(a,g),g.applyMatrix4(n);const u=i.ray.origin.distanceTo(g);if(u<i.near||u>i.far)return;s.push({distance:u,distanceToRay:Math.sqrt(r),point:g,index:e,face:null,faceIndex:null,barycoord:null,object:o})}}class TV extends Zi{constructor(e,t,n,i,s=Bi,o=Bi,r,g,u){super(e,t,n,i,s,o,r,g,u),this.isVideoTexture=!0,this.generateMipmaps=!1;const C=this;function h(){C.needsUpdate=!0,e.requestVideoFrameCallback(h)}"requestVideoFrameCallback"in e&&e.requestVideoFrameCallback(h)}clone(){return new this.constructor(this.image).copy(this)}update(){const e=this.image;"requestVideoFrameCallback"in e===!1&&e.readyState>=e.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}}class NY extends TV{constructor(e,t,n,i,s,o,r,g){super({},e,t,n,i,s,o,r,g),this.isVideoFrameTexture=!0}update(){}clone(){return new this.constructor().copy(this)}setFrame(e){this.image=e,this.needsUpdate=!0}}class YY extends Zi{constructor(e,t){super({width:e,height:t}),this.isFramebufferTexture=!0,this.magFilter=Fa,this.minFilter=Fa,this.generateMipmaps=!1,this.needsUpdate=!0}}class vy extends Zi{constructor(e,t,n,i,s,o,r,g,u,C,h,f){super(null,o,r,g,u,C,i,s,h,f),this.isCompressedTexture=!0,this.image={width:t,height:n},this.mipmaps=e,this.flipY=!1,this.generateMipmaps=!1}}class KY extends vy{constructor(e,t,n,i,s,o){super(e,t,n,s,o),this.isCompressedArrayTexture=!0,this.image.depth=i,this.wrapR=Jo,this.layerUpdates=new Set}addLayerUpdate(e){this.layerUpdates.add(e)}clearLayerUpdates(){this.layerUpdates.clear()}}class FY extends vy{constructor(e,t,n){super(void 0,e[0].width,e[0].height,t,n,hc),this.isCompressedCubeTexture=!0,this.isCubeTexture=!0,this.image=e}}class EY extends Zi{constructor(e,t,n,i,s,o,r,g,u){super(e,t,n,i,s,o,r,g,u),this.isCanvasTexture=!0,this.needsUpdate=!0}}class Zy extends Zi{constructor(e,t,n=fc,i,s,o,r=Fa,g=Fa,u,C=$d,h=1){if(C!==$d&&C!==eA)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");const f={width:e,height:t,depth:h};super(f,i,s,o,r,g,C,n,u),this.isDepthTexture=!0,this.flipY=!1,this.generateMipmaps=!1,this.compareFunction=null}copy(e){return super.copy(e),this.source=new mu(Object.assign({},e.image)),this.compareFunction=e.compareFunction,this}toJSON(e){const t=super.toJSON(e);return this.compareFunction!==null&&(t.compareFunction=this.compareFunction),t}}class Sy extends rn{constructor(e=1,t=1,n=4,i=8,s=1){super(),this.type="CapsuleGeometry",this.parameters={radius:e,height:t,capSegments:n,radialSegments:i,heightSegments:s},t=Math.max(0,t),n=Math.max(1,Math.floor(n)),i=Math.max(3,Math.floor(i)),s=Math.max(1,Math.floor(s));const o=[],r=[],g=[],u=[],C=t/2,h=Math.PI/2*e,f=t,p=2*h+f,y=n*2+s,v=i+1,G=new ae,B=new ae;for(let R=0;R<=y;R++){let x=0,w=0,M=0,H=0;if(R<=n){const Y=R/n,X=Y*Math.PI/2;w=-C-e*Math.cos(X),M=e*Math.sin(X),H=-e*Math.cos(X),x=Y*h}else if(R<=n+s){const Y=(R-n)/s;w=-C+Y*t,M=e,H=0,x=h+Y*f}else{const Y=(R-n-s)/n,X=Y*Math.PI/2;w=C+e*Math.sin(X),M=e*Math.cos(X),H=e*Math.sin(X),x=h+f+Y*h}const N=Math.max(0,Math.min(1,x/p));let F=0;R===0?F=.5/i:R===y&&(F=-.5/i);for(let Y=0;Y<=i;Y++){const X=Y/i,U=X*Math.PI*2,O=Math.sin(U),P=Math.cos(U);B.x=-M*P,B.y=w,B.z=M*O,r.push(B.x,B.y,B.z),G.set(-M*P,H,M*O),G.normalize(),g.push(G.x,G.y,G.z),u.push(X+F,N)}if(R>0){const Y=(R-1)*v;for(let X=0;X<i;X++){const U=Y+X,O=Y+X+1,P=R*v+X,ie=R*v+X+1;o.push(U,O,P),o.push(O,ie,P)}}}this.setIndex(o),this.setAttribute("position",new Ht(r,3)),this.setAttribute("normal",new Ht(g,3)),this.setAttribute("uv",new Ht(u,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Sy(e.radius,e.height,e.capSegments,e.radialSegments,e.heightSegments)}}class Ry extends rn{constructor(e=1,t=32,n=0,i=Math.PI*2){super(),this.type="CircleGeometry",this.parameters={radius:e,segments:t,thetaStart:n,thetaLength:i},t=Math.max(3,t);const s=[],o=[],r=[],g=[],u=new ae,C=new at;o.push(0,0,0),r.push(0,0,1),g.push(.5,.5);for(let h=0,f=3;h<=t;h++,f+=3){const p=n+h/t*i;u.x=e*Math.cos(p),u.y=e*Math.sin(p),o.push(u.x,u.y,u.z),r.push(0,0,1),C.x=(o[f]/e+1)/2,C.y=(o[f+1]/e+1)/2,g.push(C.x,C.y)}for(let h=1;h<=t;h++)s.push(h,h+1,0);this.setIndex(s),this.setAttribute("position",new Ht(o,3)),this.setAttribute("normal",new Ht(r,3)),this.setAttribute("uv",new Ht(g,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Ry(e.radius,e.segments,e.thetaStart,e.thetaLength)}}class Jf extends rn{constructor(e=1,t=1,n=1,i=32,s=1,o=!1,r=0,g=Math.PI*2){super(),this.type="CylinderGeometry",this.parameters={radiusTop:e,radiusBottom:t,height:n,radialSegments:i,heightSegments:s,openEnded:o,thetaStart:r,thetaLength:g};const u=this;i=Math.floor(i),s=Math.floor(s);const C=[],h=[],f=[],p=[];let y=0;const v=[],G=n/2;let B=0;R(),o===!1&&(e>0&&x(!0),t>0&&x(!1)),this.setIndex(C),this.setAttribute("position",new Ht(h,3)),this.setAttribute("normal",new Ht(f,3)),this.setAttribute("uv",new Ht(p,2));function R(){const w=new ae,M=new ae;let H=0;const N=(t-e)/n;for(let F=0;F<=s;F++){const Y=[],X=F/s,U=X*(t-e)+e;for(let O=0;O<=i;O++){const P=O/i,ie=P*g+r,le=Math.sin(ie),T=Math.cos(ie);M.x=U*le,M.y=-X*n+G,M.z=U*T,h.push(M.x,M.y,M.z),w.set(le,N,T).normalize(),f.push(w.x,w.y,w.z),p.push(P,1-X),Y.push(y++)}v.push(Y)}for(let F=0;F<i;F++)for(let Y=0;Y<s;Y++){const X=v[Y][F],U=v[Y+1][F],O=v[Y+1][F+1],P=v[Y][F+1];(e>0||Y!==0)&&(C.push(X,U,P),H+=3),(t>0||Y!==s-1)&&(C.push(U,O,P),H+=3)}u.addGroup(B,H,0),B+=H}function x(w){const M=y,H=new at,N=new ae;let F=0;const Y=w===!0?e:t,X=w===!0?1:-1;for(let O=1;O<=i;O++)h.push(0,G*X,0),f.push(0,X,0),p.push(.5,.5),y++;const U=y;for(let O=0;O<=i;O++){const ie=O/i*g+r,le=Math.cos(ie),T=Math.sin(ie);N.x=Y*T,N.y=G*X,N.z=Y*le,h.push(N.x,N.y,N.z),f.push(0,X,0),H.x=le*.5+.5,H.y=T*.5*X+.5,p.push(H.x,H.y),y++}for(let O=0;O<i;O++){const P=M+O,ie=U+O;w===!0?C.push(ie,ie+1,P):C.push(ie+1,ie,P),F+=3}u.addGroup(B,F,w===!0?1:2),B+=F}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Jf(e.radiusTop,e.radiusBottom,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}}class Pf extends Jf{constructor(e=1,t=1,n=32,i=1,s=!1,o=0,r=Math.PI*2){super(0,e,t,n,i,s,o,r),this.type="ConeGeometry",this.parameters={radius:e,height:t,radialSegments:n,heightSegments:i,openEnded:s,thetaStart:o,thetaLength:r}}static fromJSON(e){return new Pf(e.radius,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}}class Wu extends rn{constructor(e=[],t=[],n=1,i=0){super(),this.type="PolyhedronGeometry",this.parameters={vertices:e,indices:t,radius:n,detail:i};const s=[],o=[];r(i),u(n),C(),this.setAttribute("position",new Ht(s,3)),this.setAttribute("normal",new Ht(s.slice(),3)),this.setAttribute("uv",new Ht(o,2)),i===0?this.computeVertexNormals():this.normalizeNormals();function r(R){const x=new ae,w=new ae,M=new ae;for(let H=0;H<t.length;H+=3)p(t[H+0],x),p(t[H+1],w),p(t[H+2],M),g(x,w,M,R)}function g(R,x,w,M){const H=M+1,N=[];for(let F=0;F<=H;F++){N[F]=[];const Y=R.clone().lerp(w,F/H),X=x.clone().lerp(w,F/H),U=H-F;for(let O=0;O<=U;O++)O===0&&F===H?N[F][O]=Y:N[F][O]=Y.clone().lerp(X,O/U)}for(let F=0;F<H;F++)for(let Y=0;Y<2*(H-F)-1;Y++){const X=Math.floor(Y/2);Y%2===0?(f(N[F][X+1]),f(N[F+1][X]),f(N[F][X])):(f(N[F][X+1]),f(N[F+1][X+1]),f(N[F+1][X]))}}function u(R){const x=new ae;for(let w=0;w<s.length;w+=3)x.x=s[w+0],x.y=s[w+1],x.z=s[w+2],x.normalize().multiplyScalar(R),s[w+0]=x.x,s[w+1]=x.y,s[w+2]=x.z}function C(){const R=new ae;for(let x=0;x<s.length;x+=3){R.x=s[x+0],R.y=s[x+1],R.z=s[x+2];const w=G(R)/2/Math.PI+.5,M=B(R)/Math.PI+.5;o.push(w,1-M)}y(),h()}function h(){for(let R=0;R<o.length;R+=6){const x=o[R+0],w=o[R+2],M=o[R+4],H=Math.max(x,w,M),N=Math.min(x,w,M);H>.9&&N<.1&&(x<.2&&(o[R+0]+=1),w<.2&&(o[R+2]+=1),M<.2&&(o[R+4]+=1))}}function f(R){s.push(R.x,R.y,R.z)}function p(R,x){const w=R*3;x.x=e[w+0],x.y=e[w+1],x.z=e[w+2]}function y(){const R=new ae,x=new ae,w=new ae,M=new ae,H=new at,N=new at,F=new at;for(let Y=0,X=0;Y<s.length;Y+=9,X+=6){R.set(s[Y+0],s[Y+1],s[Y+2]),x.set(s[Y+3],s[Y+4],s[Y+5]),w.set(s[Y+6],s[Y+7],s[Y+8]),H.set(o[X+0],o[X+1]),N.set(o[X+2],o[X+3]),F.set(o[X+4],o[X+5]),M.copy(R).add(x).add(w).divideScalar(3);const U=G(M);v(H,X+0,R,U),v(N,X+2,x,U),v(F,X+4,w,U)}}function v(R,x,w,M){M<0&&R.x===1&&(o[x]=R.x-1),w.x===0&&w.z===0&&(o[x]=M/2/Math.PI+.5)}function G(R){return Math.atan2(R.z,-R.x)}function B(R){return Math.atan2(-R.y,Math.sqrt(R.x*R.x+R.z*R.z))}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Wu(e.vertices,e.indices,e.radius,e.details)}}class wy extends Wu{constructor(e=1,t=0){const n=(1+Math.sqrt(5))/2,i=1/n,s=[-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-i,-n,0,-i,n,0,i,-n,0,i,n,-i,-n,0,-i,n,0,i,-n,0,i,n,0,-n,0,-i,n,0,-i,-n,0,i,n,0,i],o=[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9];super(s,o,e,t),this.type="DodecahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new wy(e.radius,e.detail)}}const ab=new ae,sb=new ae,hB=new ae,ob=new Ro;class zV extends rn{constructor(e=null,t=1){if(super(),this.type="EdgesGeometry",this.parameters={geometry:e,thresholdAngle:t},e!==null){const i=Math.pow(10,4),s=Math.cos($I*t),o=e.getIndex(),r=e.getAttribute("position"),g=o?o.count:r.count,u=[0,0,0],C=["a","b","c"],h=new Array(3),f={},p=[];for(let y=0;y<g;y+=3){o?(u[0]=o.getX(y),u[1]=o.getX(y+1),u[2]=o.getX(y+2)):(u[0]=y,u[1]=y+1,u[2]=y+2);const{a:v,b:G,c:B}=ob;if(v.fromBufferAttribute(r,u[0]),G.fromBufferAttribute(r,u[1]),B.fromBufferAttribute(r,u[2]),ob.getNormal(hB),h[0]=`${Math.round(v.x*i)},${Math.round(v.y*i)},${Math.round(v.z*i)}`,h[1]=`${Math.round(G.x*i)},${Math.round(G.y*i)},${Math.round(G.z*i)}`,h[2]=`${Math.round(B.x*i)},${Math.round(B.y*i)},${Math.round(B.z*i)}`,!(h[0]===h[1]||h[1]===h[2]||h[2]===h[0]))for(let R=0;R<3;R++){const x=(R+1)%3,w=h[R],M=h[x],H=ob[C[R]],N=ob[C[x]],F=`${w}_${M}`,Y=`${M}_${w}`;Y in f&&f[Y]?(hB.dot(f[Y].normal)<=s&&(p.push(H.x,H.y,H.z),p.push(N.x,N.y,N.z)),f[Y]=null):F in f||(f[F]={index0:u[R],index1:u[x],normal:hB.clone()})}}for(const y in f)if(f[y]){const{index0:v,index1:G}=f[y];ab.fromBufferAttribute(r,v),sb.fromBufferAttribute(r,G),p.push(ab.x,ab.y,ab.z),p.push(sb.x,sb.y,sb.z)}this.setAttribute("position",new Ht(p,3))}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}}class Br{constructor(){this.type="Curve",this.arcLengthDivisions=200,this.needsUpdate=!1,this.cacheArcLengths=null}getPoint(){console.warn("THREE.Curve: .getPoint() not implemented.")}getPointAt(e,t){const n=this.getUtoTmapping(e);return this.getPoint(n,t)}getPoints(e=5){const t=[];for(let n=0;n<=e;n++)t.push(this.getPoint(n/e));return t}getSpacedPoints(e=5){const t=[];for(let n=0;n<=e;n++)t.push(this.getPointAt(n/e));return t}getLength(){const e=this.getLengths();return e[e.length-1]}getLengths(e=this.arcLengthDivisions){if(this.cacheArcLengths&&this.cacheArcLengths.length===e+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;const t=[];let n,i=this.getPoint(0),s=0;t.push(0);for(let o=1;o<=e;o++)n=this.getPoint(o/e),s+=n.distanceTo(i),t.push(s),i=n;return this.cacheArcLengths=t,t}updateArcLengths(){this.needsUpdate=!0,this.getLengths()}getUtoTmapping(e,t=null){const n=this.getLengths();let i=0;const s=n.length;let o;t?o=t:o=e*n[s-1];let r=0,g=s-1,u;for(;r<=g;)if(i=Math.floor(r+(g-r)/2),u=n[i]-o,u<0)r=i+1;else if(u>0)g=i-1;else{g=i;break}if(i=g,n[i]===o)return i/(s-1);const C=n[i],f=n[i+1]-C,p=(o-C)/f;return(i+p)/(s-1)}getTangent(e,t){let i=e-1e-4,s=e+1e-4;i<0&&(i=0),s>1&&(s=1);const o=this.getPoint(i),r=this.getPoint(s),g=t||(o.isVector2?new at:new ae);return g.copy(r).sub(o).normalize(),g}getTangentAt(e,t){const n=this.getUtoTmapping(e);return this.getTangent(n,t)}computeFrenetFrames(e,t=!1){const n=new ae,i=[],s=[],o=[],r=new ae,g=new Yt;for(let p=0;p<=e;p++){const y=p/e;i[p]=this.getTangentAt(y,new ae)}s[0]=new ae,o[0]=new ae;let u=Number.MAX_VALUE;const C=Math.abs(i[0].x),h=Math.abs(i[0].y),f=Math.abs(i[0].z);C<=u&&(u=C,n.set(1,0,0)),h<=u&&(u=h,n.set(0,1,0)),f<=u&&n.set(0,0,1),r.crossVectors(i[0],n).normalize(),s[0].crossVectors(i[0],r),o[0].crossVectors(i[0],s[0]);for(let p=1;p<=e;p++){if(s[p]=s[p-1].clone(),o[p]=o[p-1].clone(),r.crossVectors(i[p-1],i[p]),r.length()>Number.EPSILON){r.normalize();const y=Math.acos(ln(i[p-1].dot(i[p]),-1,1));s[p].applyMatrix4(g.makeRotationAxis(r,y))}o[p].crossVectors(i[p],s[p])}if(t===!0){let p=Math.acos(ln(s[0].dot(s[e]),-1,1));p/=e,i[0].dot(r.crossVectors(s[0],s[e]))>0&&(p=-p);for(let y=1;y<=e;y++)s[y].applyMatrix4(g.makeRotationAxis(i[y],p*y)),o[y].crossVectors(i[y],s[y])}return{tangents:i,normals:s,binormals:o}}clone(){return new this.constructor().copy(this)}copy(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}toJSON(){const e={metadata:{version:4.7,type:"Curve",generator:"Curve.toJSON"}};return e.arcLengthDivisions=this.arcLengthDivisions,e.type=this.type,e}fromJSON(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}}class xy extends Br{constructor(e=0,t=0,n=1,i=1,s=0,o=Math.PI*2,r=!1,g=0){super(),this.isEllipseCurve=!0,this.type="EllipseCurve",this.aX=e,this.aY=t,this.xRadius=n,this.yRadius=i,this.aStartAngle=s,this.aEndAngle=o,this.aClockwise=r,this.aRotation=g}getPoint(e,t=new at){const n=t,i=Math.PI*2;let s=this.aEndAngle-this.aStartAngle;const o=Math.abs(s)<Number.EPSILON;for(;s<0;)s+=i;for(;s>i;)s-=i;s<Number.EPSILON&&(o?s=0:s=i),this.aClockwise===!0&&!o&&(s===i?s=-i:s=s-i);const r=this.aStartAngle+e*s;let g=this.aX+this.xRadius*Math.cos(r),u=this.aY+this.yRadius*Math.sin(r);if(this.aRotation!==0){const C=Math.cos(this.aRotation),h=Math.sin(this.aRotation),f=g-this.aX,p=u-this.aY;g=f*C-p*h+this.aX,u=f*h+p*C+this.aY}return n.set(g,u)}copy(e){return super.copy(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}toJSON(){const e=super.toJSON();return e.aX=this.aX,e.aY=this.aY,e.xRadius=this.xRadius,e.yRadius=this.yRadius,e.aStartAngle=this.aStartAngle,e.aEndAngle=this.aEndAngle,e.aClockwise=this.aClockwise,e.aRotation=this.aRotation,e}fromJSON(e){return super.fromJSON(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}}class LV extends xy{constructor(e,t,n,i,s,o){super(e,t,n,n,i,s,o),this.isArcCurve=!0,this.type="ArcCurve"}}function lZ(){let a=0,e=0,t=0,n=0;function i(s,o,r,g){a=s,e=r,t=-3*s+3*o-2*r-g,n=2*s-2*o+r+g}return{initCatmullRom:function(s,o,r,g,u){i(o,r,u*(r-s),u*(g-o))},initNonuniformCatmullRom:function(s,o,r,g,u,C,h){let f=(o-s)/u-(r-s)/(u+C)+(r-o)/C,p=(r-o)/C-(g-o)/(C+h)+(g-r)/h;f*=C,p*=C,i(o,r,f,p)},calc:function(s){const o=s*s,r=o*s;return a+e*s+t*o+n*r}}}const lb=new ae,fB=new lZ,pB=new lZ,mB=new lZ;class _V extends Br{constructor(e=[],t=!1,n="centripetal",i=.5){super(),this.isCatmullRomCurve3=!0,this.type="CatmullRomCurve3",this.points=e,this.closed=t,this.curveType=n,this.tension=i}getPoint(e,t=new ae){const n=t,i=this.points,s=i.length,o=(s-(this.closed?0:1))*e;let r=Math.floor(o),g=o-r;this.closed?r+=r>0?0:(Math.floor(Math.abs(r)/s)+1)*s:g===0&&r===s-1&&(r=s-2,g=1);let u,C;this.closed||r>0?u=i[(r-1)%s]:(lb.subVectors(i[0],i[1]).add(i[0]),u=lb);const h=i[r%s],f=i[(r+1)%s];if(this.closed||r+2<s?C=i[(r+2)%s]:(lb.subVectors(i[s-1],i[s-2]).add(i[s-1]),C=lb),this.curveType==="centripetal"||this.curveType==="chordal"){const p=this.curveType==="chordal"?.5:.25;let y=Math.pow(u.distanceToSquared(h),p),v=Math.pow(h.distanceToSquared(f),p),G=Math.pow(f.distanceToSquared(C),p);v<1e-4&&(v=1),y<1e-4&&(y=v),G<1e-4&&(G=v),fB.initNonuniformCatmullRom(u.x,h.x,f.x,C.x,y,v,G),pB.initNonuniformCatmullRom(u.y,h.y,f.y,C.y,y,v,G),mB.initNonuniformCatmullRom(u.z,h.z,f.z,C.z,y,v,G)}else this.curveType==="catmullrom"&&(fB.initCatmullRom(u.x,h.x,f.x,C.x,this.tension),pB.initCatmullRom(u.y,h.y,f.y,C.y,this.tension),mB.initCatmullRom(u.z,h.z,f.z,C.z,this.tension));return n.set(fB.calc(g),pB.calc(g),mB.calc(g)),n}copy(e){super.copy(e),this.points=[];for(let t=0,n=e.points.length;t<n;t++){const i=e.points[t];this.points.push(i.clone())}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}toJSON(){const e=super.toJSON();e.points=[];for(let t=0,n=this.points.length;t<n;t++){const i=this.points[t];e.points.push(i.toArray())}return e.closed=this.closed,e.curveType=this.curveType,e.tension=this.tension,e}fromJSON(e){super.fromJSON(e),this.points=[];for(let t=0,n=e.points.length;t<n;t++){const i=e.points[t];this.points.push(new ae().fromArray(i))}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}}function KR(a,e,t,n,i){const s=(n-e)*.5,o=(i-t)*.5,r=a*a,g=a*r;return(2*t-2*n+s+o)*g+(-3*t+3*n-2*s-o)*r+s*a+t}function TY(a,e){const t=1-a;return t*t*e}function zY(a,e){return 2*(1-a)*a*e}function LY(a,e){return a*a*e}function ff(a,e,t,n){return TY(a,e)+zY(a,t)+LY(a,n)}function _Y(a,e){const t=1-a;return t*t*t*e}function UY(a,e){const t=1-a;return 3*t*t*a*e}function DY(a,e){return 3*(1-a)*a*a*e}function kY(a,e){return a*a*a*e}function pf(a,e,t,n,i){return _Y(a,e)+UY(a,t)+DY(a,n)+kY(a,i)}class rZ extends Br{constructor(e=new at,t=new at,n=new at,i=new at){super(),this.isCubicBezierCurve=!0,this.type="CubicBezierCurve",this.v0=e,this.v1=t,this.v2=n,this.v3=i}getPoint(e,t=new at){const n=t,i=this.v0,s=this.v1,o=this.v2,r=this.v3;return n.set(pf(e,i.x,s.x,o.x,r.x),pf(e,i.y,s.y,o.y,r.y)),n}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}}class UV extends Br{constructor(e=new ae,t=new ae,n=new ae,i=new ae){super(),this.isCubicBezierCurve3=!0,this.type="CubicBezierCurve3",this.v0=e,this.v1=t,this.v2=n,this.v3=i}getPoint(e,t=new ae){const n=t,i=this.v0,s=this.v1,o=this.v2,r=this.v3;return n.set(pf(e,i.x,s.x,o.x,r.x),pf(e,i.y,s.y,o.y,r.y),pf(e,i.z,s.z,o.z,r.z)),n}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}}class gZ extends Br{constructor(e=new at,t=new at){super(),this.isLineCurve=!0,this.type="LineCurve",this.v1=e,this.v2=t}getPoint(e,t=new at){const n=t;return e===1?n.copy(this.v2):(n.copy(this.v2).sub(this.v1),n.multiplyScalar(e).add(this.v1)),n}getPointAt(e,t){return this.getPoint(e,t)}getTangent(e,t=new at){return t.subVectors(this.v2,this.v1).normalize()}getTangentAt(e,t){return this.getTangent(e,t)}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class DV extends Br{constructor(e=new ae,t=new ae){super(),this.isLineCurve3=!0,this.type="LineCurve3",this.v1=e,this.v2=t}getPoint(e,t=new ae){const n=t;return e===1?n.copy(this.v2):(n.copy(this.v2).sub(this.v1),n.multiplyScalar(e).add(this.v1)),n}getPointAt(e,t){return this.getPoint(e,t)}getTangent(e,t=new ae){return t.subVectors(this.v2,this.v1).normalize()}getTangentAt(e,t){return this.getTangent(e,t)}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class cZ extends Br{constructor(e=new at,t=new at,n=new at){super(),this.isQuadraticBezierCurve=!0,this.type="QuadraticBezierCurve",this.v0=e,this.v1=t,this.v2=n}getPoint(e,t=new at){const n=t,i=this.v0,s=this.v1,o=this.v2;return n.set(ff(e,i.x,s.x,o.x),ff(e,i.y,s.y,o.y)),n}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class uZ extends Br{constructor(e=new ae,t=new ae,n=new ae){super(),this.isQuadraticBezierCurve3=!0,this.type="QuadraticBezierCurve3",this.v0=e,this.v1=t,this.v2=n}getPoint(e,t=new ae){const n=t,i=this.v0,s=this.v1,o=this.v2;return n.set(ff(e,i.x,s.x,o.x),ff(e,i.y,s.y,o.y),ff(e,i.z,s.z,o.z)),n}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class IZ extends Br{constructor(e=[]){super(),this.isSplineCurve=!0,this.type="SplineCurve",this.points=e}getPoint(e,t=new at){const n=t,i=this.points,s=(i.length-1)*e,o=Math.floor(s),r=s-o,g=i[o===0?o:o-1],u=i[o],C=i[o>i.length-2?i.length-1:o+1],h=i[o>i.length-3?i.length-1:o+2];return n.set(KR(r,g.x,u.x,C.x,h.x),KR(r,g.y,u.y,C.y,h.y)),n}copy(e){super.copy(e),this.points=[];for(let t=0,n=e.points.length;t<n;t++){const i=e.points[t];this.points.push(i.clone())}return this}toJSON(){const e=super.toJSON();e.points=[];for(let t=0,n=this.points.length;t<n;t++){const i=this.points[t];e.points.push(i.toArray())}return e}fromJSON(e){super.fromJSON(e),this.points=[];for(let t=0,n=e.points.length;t<n;t++){const i=e.points[t];this.points.push(new at().fromArray(i))}return this}}var Y0=Object.freeze({__proto__:null,ArcCurve:LV,CatmullRomCurve3:_V,CubicBezierCurve:rZ,CubicBezierCurve3:UV,EllipseCurve:xy,LineCurve:gZ,LineCurve3:DV,QuadraticBezierCurve:cZ,QuadraticBezierCurve3:uZ,SplineCurve:IZ});class kV extends Br{constructor(){super(),this.type="CurvePath",this.curves=[],this.autoClose=!1}add(e){this.curves.push(e)}closePath(){const e=this.curves[0].getPoint(0),t=this.curves[this.curves.length-1].getPoint(1);if(!e.equals(t)){const n=e.isVector2===!0?"LineCurve":"LineCurve3";this.curves.push(new Y0[n](t,e))}return this}getPoint(e,t){const n=e*this.getLength(),i=this.getCurveLengths();let s=0;for(;s<i.length;){if(i[s]>=n){const o=i[s]-n,r=this.curves[s],g=r.getLength(),u=g===0?0:1-o/g;return r.getPointAt(u,t)}s++}return null}getLength(){const e=this.getCurveLengths();return e[e.length-1]}updateArcLengths(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()}getCurveLengths(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;const e=[];let t=0;for(let n=0,i=this.curves.length;n<i;n++)t+=this.curves[n].getLength(),e.push(t);return this.cacheLengths=e,e}getSpacedPoints(e=40){const t=[];for(let n=0;n<=e;n++)t.push(this.getPoint(n/e));return this.autoClose&&t.push(t[0]),t}getPoints(e=12){const t=[];let n;for(let i=0,s=this.curves;i<s.length;i++){const o=s[i],r=o.isEllipseCurve?e*2:o.isLineCurve||o.isLineCurve3?1:o.isSplineCurve?e*o.points.length:e,g=o.getPoints(r);for(let u=0;u<g.length;u++){const C=g[u];n&&n.equals(C)||(t.push(C),n=C)}}return this.autoClose&&t.length>1&&!t[t.length-1].equals(t[0])&&t.push(t[0]),t}copy(e){super.copy(e),this.curves=[];for(let t=0,n=e.curves.length;t<n;t++){const i=e.curves[t];this.curves.push(i.clone())}return this.autoClose=e.autoClose,this}toJSON(){const e=super.toJSON();e.autoClose=this.autoClose,e.curves=[];for(let t=0,n=this.curves.length;t<n;t++){const i=this.curves[t];e.curves.push(i.toJSON())}return e}fromJSON(e){super.fromJSON(e),this.autoClose=e.autoClose,this.curves=[];for(let t=0,n=e.curves.length;t<n;t++){const i=e.curves[t];this.curves.push(new Y0[i.type]().fromJSON(i))}return this}}class K0 extends kV{constructor(e){super(),this.type="Path",this.currentPoint=new at,e&&this.setFromPoints(e)}setFromPoints(e){this.moveTo(e[0].x,e[0].y);for(let t=1,n=e.length;t<n;t++)this.lineTo(e[t].x,e[t].y);return this}moveTo(e,t){return this.currentPoint.set(e,t),this}lineTo(e,t){const n=new gZ(this.currentPoint.clone(),new at(e,t));return this.curves.push(n),this.currentPoint.set(e,t),this}quadraticCurveTo(e,t,n,i){const s=new cZ(this.currentPoint.clone(),new at(e,t),new at(n,i));return this.curves.push(s),this.currentPoint.set(n,i),this}bezierCurveTo(e,t,n,i,s,o){const r=new rZ(this.currentPoint.clone(),new at(e,t),new at(n,i),new at(s,o));return this.curves.push(r),this.currentPoint.set(s,o),this}splineThru(e){const t=[this.currentPoint.clone()].concat(e),n=new IZ(t);return this.curves.push(n),this.currentPoint.copy(e[e.length-1]),this}arc(e,t,n,i,s,o){const r=this.currentPoint.x,g=this.currentPoint.y;return this.absarc(e+r,t+g,n,i,s,o),this}absarc(e,t,n,i,s,o){return this.absellipse(e,t,n,n,i,s,o),this}ellipse(e,t,n,i,s,o,r,g){const u=this.currentPoint.x,C=this.currentPoint.y;return this.absellipse(e+u,t+C,n,i,s,o,r,g),this}absellipse(e,t,n,i,s,o,r,g){const u=new xy(e,t,n,i,s,o,r,g);if(this.curves.length>0){const h=u.getPoint(0);h.equals(this.currentPoint)||this.lineTo(h.x,h.y)}this.curves.push(u);const C=u.getPoint(1);return this.currentPoint.copy(C),this}copy(e){return super.copy(e),this.currentPoint.copy(e.currentPoint),this}toJSON(){const e=super.toJSON();return e.currentPoint=this.currentPoint.toArray(),e}fromJSON(e){return super.fromJSON(e),this.currentPoint.fromArray(e.currentPoint),this}}let tC=class extends K0{constructor(e){super(e),this.uuid=Po(),this.type="Shape",this.holes=[]}getPointsHoles(e){const t=[];for(let n=0,i=this.holes.length;n<i;n++)t[n]=this.holes[n].getPoints(e);return t}extractPoints(e){return{shape:this.getPoints(e),holes:this.getPointsHoles(e)}}copy(e){super.copy(e),this.holes=[];for(let t=0,n=e.holes.length;t<n;t++){const i=e.holes[t];this.holes.push(i.clone())}return this}toJSON(){const e=super.toJSON();e.uuid=this.uuid,e.holes=[];for(let t=0,n=this.holes.length;t<n;t++){const i=this.holes[t];e.holes.push(i.toJSON())}return e}fromJSON(e){super.fromJSON(e),this.uuid=e.uuid,this.holes=[];for(let t=0,n=e.holes.length;t<n;t++){const i=e.holes[t];this.holes.push(new K0().fromJSON(i))}return this}};function OY(a,e,t=2){const n=e&&e.length,i=n?e[0]*t:a.length;let s=OV(a,0,i,t,!0);const o=[];if(!s||s.next===s.prev)return o;let r,g,u;if(n&&(s=qY(a,e,s,t)),a.length>80*t){r=1/0,g=1/0;let C=-1/0,h=-1/0;for(let f=t;f<i;f+=t){const p=a[f],y=a[f+1];p<r&&(r=p),y<g&&(g=y),p>C&&(C=p),y>h&&(h=y)}u=Math.max(C-r,h-g),u=u!==0?32767/u:0}return Hf(s,o,t,r,g,u,0),o}function OV(a,e,t,n,i){let s;if(i===g5(a,e,t,n)>0)for(let o=e;o<t;o+=n)s=FR(o/n|0,a[o],a[o+1],s);else for(let o=t-n;o>=e;o-=n)s=FR(o/n|0,a[o],a[o+1],s);return s&&oA(s,s.next)&&(Nf(s),s=s.next),s}function oC(a,e){if(!a)return a;e||(e=a);let t=a,n;do if(n=!1,!t.steiner&&(oA(t,t.next)||Oi(t.prev,t,t.next)===0)){if(Nf(t),t=e=t.prev,t===t.next)break;n=!0}else t=t.next;while(n||t!==e);return e}function Hf(a,e,t,n,i,s,o){if(!a)return;!o&&s&&i5(a,n,i,s);let r=a;for(;a.prev!==a.next;){const g=a.prev,u=a.next;if(s?PY(a,n,i,s):JY(a)){e.push(g.i,a.i,u.i),Nf(a),a=u.next,r=u.next;continue}if(a=u,a===r){o?o===1?(a=QY(oC(a),e),Hf(a,e,t,n,i,s,2)):o===2&&jY(a,e,t,n,i,s):Hf(oC(a),e,t,n,i,s,1);break}}}function JY(a){const e=a.prev,t=a,n=a.next;if(Oi(e,t,n)>=0)return!1;const i=e.x,s=t.x,o=n.x,r=e.y,g=t.y,u=n.y,C=Math.min(i,s,o),h=Math.min(r,g,u),f=Math.max(i,s,o),p=Math.max(r,g,u);let y=n.next;for(;y!==e;){if(y.x>=C&&y.x<=f&&y.y>=h&&y.y<=p&&sf(i,r,s,g,o,u,y.x,y.y)&&Oi(y.prev,y,y.next)>=0)return!1;y=y.next}return!0}function PY(a,e,t,n){const i=a.prev,s=a,o=a.next;if(Oi(i,s,o)>=0)return!1;const r=i.x,g=s.x,u=o.x,C=i.y,h=s.y,f=o.y,p=Math.min(r,g,u),y=Math.min(C,h,f),v=Math.max(r,g,u),G=Math.max(C,h,f),B=Uv(p,y,e,t,n),R=Uv(v,G,e,t,n);let x=a.prevZ,w=a.nextZ;for(;x&&x.z>=B&&w&&w.z<=R;){if(x.x>=p&&x.x<=v&&x.y>=y&&x.y<=G&&x!==i&&x!==o&&sf(r,C,g,h,u,f,x.x,x.y)&&Oi(x.prev,x,x.next)>=0||(x=x.prevZ,w.x>=p&&w.x<=v&&w.y>=y&&w.y<=G&&w!==i&&w!==o&&sf(r,C,g,h,u,f,w.x,w.y)&&Oi(w.prev,w,w.next)>=0))return!1;w=w.nextZ}for(;x&&x.z>=B;){if(x.x>=p&&x.x<=v&&x.y>=y&&x.y<=G&&x!==i&&x!==o&&sf(r,C,g,h,u,f,x.x,x.y)&&Oi(x.prev,x,x.next)>=0)return!1;x=x.prevZ}for(;w&&w.z<=R;){if(w.x>=p&&w.x<=v&&w.y>=y&&w.y<=G&&w!==i&&w!==o&&sf(r,C,g,h,u,f,w.x,w.y)&&Oi(w.prev,w,w.next)>=0)return!1;w=w.nextZ}return!0}function QY(a,e){let t=a;do{const n=t.prev,i=t.next.next;!oA(n,i)&&PV(n,t,t.next,i)&&Xf(n,i)&&Xf(i,n)&&(e.push(n.i,t.i,i.i),Nf(t),Nf(t.next),t=a=i),t=t.next}while(t!==a);return oC(t)}function jY(a,e,t,n,i,s){let o=a;do{let r=o.next.next;for(;r!==o.prev;){if(o.i!==r.i&&o5(o,r)){let g=QV(o,r);o=oC(o,o.next),g=oC(g,g.next),Hf(o,e,t,n,i,s,0),Hf(g,e,t,n,i,s,0);return}r=r.next}o=o.next}while(o!==a)}function qY(a,e,t,n){const i=[];for(let s=0,o=e.length;s<o;s++){const r=e[s]*n,g=s<o-1?e[s+1]*n:a.length,u=OV(a,r,g,n,!1);u===u.next&&(u.steiner=!0),i.push(s5(u))}i.sort($Y);for(let s=0;s<i.length;s++)t=e5(i[s],t);return t}function $Y(a,e){let t=a.x-e.x;if(t===0&&(t=a.y-e.y,t===0)){const n=(a.next.y-a.y)/(a.next.x-a.x),i=(e.next.y-e.y)/(e.next.x-e.x);t=n-i}return t}function e5(a,e){const t=t5(a,e);if(!t)return e;const n=QV(t,a);return oC(n,n.next),oC(t,t.next)}function t5(a,e){let t=e;const n=a.x,i=a.y;let s=-1/0,o;if(oA(a,t))return t;do{if(oA(a,t.next))return t.next;if(i<=t.y&&i>=t.next.y&&t.next.y!==t.y){const h=t.x+(i-t.y)*(t.next.x-t.x)/(t.next.y-t.y);if(h<=n&&h>s&&(s=h,o=t.x<t.next.x?t:t.next,h===n))return o}t=t.next}while(t!==e);if(!o)return null;const r=o,g=o.x,u=o.y;let C=1/0;t=o;do{if(n>=t.x&&t.x>=g&&n!==t.x&&JV(i<u?n:s,i,g,u,i<u?s:n,i,t.x,t.y)){const h=Math.abs(i-t.y)/(n-t.x);Xf(t,a)&&(h<C||h===C&&(t.x>o.x||t.x===o.x&&n5(o,t)))&&(o=t,C=h)}t=t.next}while(t!==r);return o}function n5(a,e){return Oi(a.prev,a,e.prev)<0&&Oi(e.next,a,a.next)<0}function i5(a,e,t,n){let i=a;do i.z===0&&(i.z=Uv(i.x,i.y,e,t,n)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next;while(i!==a);i.prevZ.nextZ=null,i.prevZ=null,a5(i)}function a5(a){let e,t=1;do{let n=a,i;a=null;let s=null;for(e=0;n;){e++;let o=n,r=0;for(let u=0;u<t&&(r++,o=o.nextZ,!!o);u++);let g=t;for(;r>0||g>0&&o;)r!==0&&(g===0||!o||n.z<=o.z)?(i=n,n=n.nextZ,r--):(i=o,o=o.nextZ,g--),s?s.nextZ=i:a=i,i.prevZ=s,s=i;n=o}s.nextZ=null,t*=2}while(e>1);return a}function Uv(a,e,t,n,i){return a=(a-t)*i|0,e=(e-n)*i|0,a=(a|a<<8)&16711935,a=(a|a<<4)&252645135,a=(a|a<<2)&858993459,a=(a|a<<1)&1431655765,e=(e|e<<8)&16711935,e=(e|e<<4)&252645135,e=(e|e<<2)&858993459,e=(e|e<<1)&1431655765,a|e<<1}function s5(a){let e=a,t=a;do(e.x<t.x||e.x===t.x&&e.y<t.y)&&(t=e),e=e.next;while(e!==a);return t}function JV(a,e,t,n,i,s,o,r){return(i-o)*(e-r)>=(a-o)*(s-r)&&(a-o)*(n-r)>=(t-o)*(e-r)&&(t-o)*(s-r)>=(i-o)*(n-r)}function sf(a,e,t,n,i,s,o,r){return!(a===o&&e===r)&&JV(a,e,t,n,i,s,o,r)}function o5(a,e){return a.next.i!==e.i&&a.prev.i!==e.i&&!l5(a,e)&&(Xf(a,e)&&Xf(e,a)&&r5(a,e)&&(Oi(a.prev,a,e.prev)||Oi(a,e.prev,e))||oA(a,e)&&Oi(a.prev,a,a.next)>0&&Oi(e.prev,e,e.next)>0)}function Oi(a,e,t){return(e.y-a.y)*(t.x-e.x)-(e.x-a.x)*(t.y-e.y)}function oA(a,e){return a.x===e.x&&a.y===e.y}function PV(a,e,t,n){const i=gb(Oi(a,e,t)),s=gb(Oi(a,e,n)),o=gb(Oi(t,n,a)),r=gb(Oi(t,n,e));return!!(i!==s&&o!==r||i===0&&rb(a,t,e)||s===0&&rb(a,n,e)||o===0&&rb(t,a,n)||r===0&&rb(t,e,n))}function rb(a,e,t){return e.x<=Math.max(a.x,t.x)&&e.x>=Math.min(a.x,t.x)&&e.y<=Math.max(a.y,t.y)&&e.y>=Math.min(a.y,t.y)}function gb(a){return a>0?1:a<0?-1:0}function l5(a,e){let t=a;do{if(t.i!==a.i&&t.next.i!==a.i&&t.i!==e.i&&t.next.i!==e.i&&PV(t,t.next,a,e))return!0;t=t.next}while(t!==a);return!1}function Xf(a,e){return Oi(a.prev,a,a.next)<0?Oi(a,e,a.next)>=0&&Oi(a,a.prev,e)>=0:Oi(a,e,a.prev)<0||Oi(a,a.next,e)<0}function r5(a,e){let t=a,n=!1;const i=(a.x+e.x)/2,s=(a.y+e.y)/2;do t.y>s!=t.next.y>s&&t.next.y!==t.y&&i<(t.next.x-t.x)*(s-t.y)/(t.next.y-t.y)+t.x&&(n=!n),t=t.next;while(t!==a);return n}function QV(a,e){const t=Dv(a.i,a.x,a.y),n=Dv(e.i,e.x,e.y),i=a.next,s=e.prev;return a.next=e,e.prev=a,t.next=i,i.prev=t,n.next=t,t.prev=n,s.next=n,n.prev=s,n}function FR(a,e,t,n){const i=Dv(a,e,t);return n?(i.next=n.next,i.prev=n,n.next.prev=i,n.next=i):(i.prev=i,i.next=i),i}function Nf(a){a.next.prev=a.prev,a.prev.next=a.next,a.prevZ&&(a.prevZ.nextZ=a.nextZ),a.nextZ&&(a.nextZ.prevZ=a.prevZ)}function Dv(a,e,t){return{i:a,x:e,y:t,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}function g5(a,e,t,n){let i=0;for(let s=e,o=t-n;s<t;s+=n)i+=(a[o]-a[s])*(a[s+1]+a[o+1]),o=s;return i}class c5{static triangulate(e,t,n=2){return OY(e,t,n)}}class fr{static area(e){const t=e.length;let n=0;for(let i=t-1,s=0;s<t;i=s++)n+=e[i].x*e[s].y-e[s].x*e[i].y;return n*.5}static isClockWise(e){return fr.area(e)<0}static triangulateShape(e,t){const n=[],i=[],s=[];ER(e),TR(n,e);let o=e.length;t.forEach(ER);for(let g=0;g<t.length;g++)i.push(o),o+=t[g].length,TR(n,t[g]);const r=c5.triangulate(n,i);for(let g=0;g<r.length;g+=3)s.push(r.slice(g,g+3));return s}}function ER(a){const e=a.length;e>2&&a[e-1].equals(a[0])&&a.pop()}function TR(a,e){for(let t=0;t<e.length;t++)a.push(e[t].x),a.push(e[t].y)}class Wy extends rn{constructor(e=new tC([new at(.5,.5),new at(-.5,.5),new at(-.5,-.5),new at(.5,-.5)]),t={}){super(),this.type="ExtrudeGeometry",this.parameters={shapes:e,options:t},e=Array.isArray(e)?e:[e];const n=this,i=[],s=[];for(let r=0,g=e.length;r<g;r++){const u=e[r];o(u)}this.setAttribute("position",new Ht(i,3)),this.setAttribute("uv",new Ht(s,2)),this.computeVertexNormals();function o(r){const g=[],u=t.curveSegments!==void 0?t.curveSegments:12,C=t.steps!==void 0?t.steps:1,h=t.depth!==void 0?t.depth:1;let f=t.bevelEnabled!==void 0?t.bevelEnabled:!0,p=t.bevelThickness!==void 0?t.bevelThickness:.2,y=t.bevelSize!==void 0?t.bevelSize:p-.1,v=t.bevelOffset!==void 0?t.bevelOffset:0,G=t.bevelSegments!==void 0?t.bevelSegments:3;const B=t.extrudePath,R=t.UVGenerator!==void 0?t.UVGenerator:u5;let x,w=!1,M,H,N,F;B&&(x=B.getSpacedPoints(C),w=!0,f=!1,M=B.computeFrenetFrames(C,!1),H=new ae,N=new ae,F=new ae),f||(G=0,p=0,y=0,v=0);const Y=r.extractPoints(u);let X=Y.shape;const U=Y.holes;if(!fr.isClockWise(X)){X=X.reverse();for(let q=0,De=U.length;q<De;q++){const Ke=U[q];fr.isClockWise(Ke)&&(U[q]=Ke.reverse())}}function P(q){const Ke=10000000000000001e-36;let Ee=q[0];for(let ye=1;ye<=q.length;ye++){const Je=ye%q.length,Me=q[Je],Ze=Me.x-Ee.x,gt=Me.y-Ee.y,k=Ze*Ze+gt*gt,z=Math.max(Math.abs(Me.x),Math.abs(Me.y),Math.abs(Ee.x),Math.abs(Ee.y)),Ce=Ke*z*z;if(k<=Ce){q.splice(Je,1),ye--;continue}Ee=Me}}P(X),U.forEach(P);const ie=U.length,le=X;for(let q=0;q<ie;q++){const De=U[q];X=X.concat(De)}function T(q,De,Ke){return De||console.error("THREE.ExtrudeGeometry: vec does not exist"),q.clone().addScaledVector(De,Ke)}const J=X.length;function Q(q,De,Ke){let Ee,ye,Je;const Me=q.x-De.x,Ze=q.y-De.y,gt=Ke.x-q.x,k=Ke.y-q.y,z=Me*Me+Ze*Ze,Ce=Me*k-Ze*gt;if(Math.abs(Ce)>Number.EPSILON){const Ve=Math.sqrt(z),Ge=Math.sqrt(gt*gt+k*k),we=De.x-Ze/Ve,et=De.y+Me/Ve,lt=Ke.x-k/Ge,Ct=Ke.y+gt/Ge,At=((lt-we)*k-(Ct-et)*gt)/(Me*k-Ze*gt);Ee=we+Me*At-q.x,ye=et+Ze*At-q.y;const Ne=Ee*Ee+ye*ye;if(Ne<=2)return new at(Ee,ye);Je=Math.sqrt(Ne/2)}else{let Ve=!1;Me>Number.EPSILON?gt>Number.EPSILON&&(Ve=!0):Me<-Number.EPSILON?gt<-Number.EPSILON&&(Ve=!0):Math.sign(Ze)===Math.sign(k)&&(Ve=!0),Ve?(Ee=-Ze,ye=Me,Je=Math.sqrt(z)):(Ee=Me,ye=Ze,Je=Math.sqrt(z/2))}return new at(Ee/Je,ye/Je)}const se=[];for(let q=0,De=le.length,Ke=De-1,Ee=q+1;q<De;q++,Ke++,Ee++)Ke===De&&(Ke=0),Ee===De&&(Ee=0),se[q]=Q(le[q],le[Ke],le[Ee]);const L=[];let D,ne=se.concat();for(let q=0,De=ie;q<De;q++){const Ke=U[q];D=[];for(let Ee=0,ye=Ke.length,Je=ye-1,Me=Ee+1;Ee<ye;Ee++,Je++,Me++)Je===ye&&(Je=0),Me===ye&&(Me=0),D[Ee]=Q(Ke[Ee],Ke[Je],Ke[Me]);L.push(D),ne=ne.concat(D)}let oe;if(G===0)oe=fr.triangulateShape(le,U);else{const q=[],De=[];for(let Ke=0;Ke<G;Ke++){const Ee=Ke/G,ye=p*Math.cos(Ee*Math.PI/2),Je=y*Math.sin(Ee*Math.PI/2)+v;for(let Me=0,Ze=le.length;Me<Ze;Me++){const gt=T(le[Me],se[Me],Je);$e(gt.x,gt.y,-ye),Ee===0&&q.push(gt)}for(let Me=0,Ze=ie;Me<Ze;Me++){const gt=U[Me];D=L[Me];const k=[];for(let z=0,Ce=gt.length;z<Ce;z++){const Ve=T(gt[z],D[z],Je);$e(Ve.x,Ve.y,-ye),Ee===0&&k.push(Ve)}Ee===0&&De.push(k)}}oe=fr.triangulateShape(q,De)}const j=oe.length,re=y+v;for(let q=0;q<J;q++){const De=f?T(X[q],ne[q],re):X[q];w?(N.copy(M.normals[0]).multiplyScalar(De.x),H.copy(M.binormals[0]).multiplyScalar(De.y),F.copy(x[0]).add(N).add(H),$e(F.x,F.y,F.z)):$e(De.x,De.y,0)}for(let q=1;q<=C;q++)for(let De=0;De<J;De++){const Ke=f?T(X[De],ne[De],re):X[De];w?(N.copy(M.normals[q]).multiplyScalar(Ke.x),H.copy(M.binormals[q]).multiplyScalar(Ke.y),F.copy(x[q]).add(N).add(H),$e(F.x,F.y,F.z)):$e(Ke.x,Ke.y,h/C*q)}for(let q=G-1;q>=0;q--){const De=q/G,Ke=p*Math.cos(De*Math.PI/2),Ee=y*Math.sin(De*Math.PI/2)+v;for(let ye=0,Je=le.length;ye<Je;ye++){const Me=T(le[ye],se[ye],Ee);$e(Me.x,Me.y,h+Ke)}for(let ye=0,Je=U.length;ye<Je;ye++){const Me=U[ye];D=L[ye];for(let Ze=0,gt=Me.length;Ze<gt;Ze++){const k=T(Me[Ze],D[Ze],Ee);w?$e(k.x,k.y+x[C-1].y,x[C-1].x+Ke):$e(k.x,k.y,h+Ke)}}}pe(),me();function pe(){const q=i.length/3;if(f){let De=0,Ke=J*De;for(let Ee=0;Ee<j;Ee++){const ye=oe[Ee];qe(ye[2]+Ke,ye[1]+Ke,ye[0]+Ke)}De=C+G*2,Ke=J*De;for(let Ee=0;Ee<j;Ee++){const ye=oe[Ee];qe(ye[0]+Ke,ye[1]+Ke,ye[2]+Ke)}}else{for(let De=0;De<j;De++){const Ke=oe[De];qe(Ke[2],Ke[1],Ke[0])}for(let De=0;De<j;De++){const Ke=oe[De];qe(Ke[0]+J*C,Ke[1]+J*C,Ke[2]+J*C)}}n.addGroup(q,i.length/3-q,0)}function me(){const q=i.length/3;let De=0;be(le,De),De+=le.length;for(let Ke=0,Ee=U.length;Ke<Ee;Ke++){const ye=U[Ke];be(ye,De),De+=ye.length}n.addGroup(q,i.length/3-q,1)}function be(q,De){let Ke=q.length;for(;--Ke>=0;){const Ee=Ke;let ye=Ke-1;ye<0&&(ye=q.length-1);for(let Je=0,Me=C+G*2;Je<Me;Je++){const Ze=J*Je,gt=J*(Je+1),k=De+Ee+Ze,z=De+ye+Ze,Ce=De+ye+gt,Ve=De+Ee+gt;ke(k,z,Ce,Ve)}}}function $e(q,De,Ke){g.push(q),g.push(De),g.push(Ke)}function qe(q,De,Ke){Te(q),Te(De),Te(Ke);const Ee=i.length/3,ye=R.generateTopUV(n,i,Ee-3,Ee-2,Ee-1);ut(ye[0]),ut(ye[1]),ut(ye[2])}function ke(q,De,Ke,Ee){Te(q),Te(De),Te(Ee),Te(De),Te(Ke),Te(Ee);const ye=i.length/3,Je=R.generateSideWallUV(n,i,ye-6,ye-3,ye-2,ye-1);ut(Je[0]),ut(Je[1]),ut(Je[3]),ut(Je[1]),ut(Je[2]),ut(Je[3])}function Te(q){i.push(g[q*3+0]),i.push(g[q*3+1]),i.push(g[q*3+2])}function ut(q){s.push(q.x),s.push(q.y)}}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}toJSON(){const e=super.toJSON(),t=this.parameters.shapes,n=this.parameters.options;return I5(t,n,e)}static fromJSON(e,t){const n=[];for(let s=0,o=e.shapes.length;s<o;s++){const r=t[e.shapes[s]];n.push(r)}const i=e.options.extrudePath;return i!==void 0&&(e.options.extrudePath=new Y0[i.type]().fromJSON(i)),new Wy(n,e.options)}}const u5={generateTopUV:function(a,e,t,n,i){const s=e[t*3],o=e[t*3+1],r=e[n*3],g=e[n*3+1],u=e[i*3],C=e[i*3+1];return[new at(s,o),new at(r,g),new at(u,C)]},generateSideWallUV:function(a,e,t,n,i,s){const o=e[t*3],r=e[t*3+1],g=e[t*3+2],u=e[n*3],C=e[n*3+1],h=e[n*3+2],f=e[i*3],p=e[i*3+1],y=e[i*3+2],v=e[s*3],G=e[s*3+1],B=e[s*3+2];return Math.abs(r-C)<Math.abs(o-u)?[new at(o,1-g),new at(u,1-h),new at(f,1-y),new at(v,1-B)]:[new at(r,1-g),new at(C,1-h),new at(p,1-y),new at(G,1-B)]}};function I5(a,e,t){if(t.shapes=[],Array.isArray(a))for(let n=0,i=a.length;n<i;n++){const s=a[n];t.shapes.push(s.uuid)}else t.shapes.push(a.uuid);return t.options=Object.assign({},e),e.extrudePath!==void 0&&(t.options.extrudePath=e.extrudePath.toJSON()),t}class Vy extends Wu{constructor(e=1,t=0){const n=(1+Math.sqrt(5))/2,i=[-1,n,0,1,n,0,-1,-n,0,1,-n,0,0,-1,n,0,1,n,0,-1,-n,0,1,-n,n,0,-1,n,0,1,-n,0,-1,-n,0,1],s=[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1];super(i,s,e,t),this.type="IcosahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new Vy(e.radius,e.detail)}}class My extends rn{constructor(e=[new at(0,-.5),new at(.5,0),new at(0,.5)],t=12,n=0,i=Math.PI*2){super(),this.type="LatheGeometry",this.parameters={points:e,segments:t,phiStart:n,phiLength:i},t=Math.floor(t),i=ln(i,0,Math.PI*2);const s=[],o=[],r=[],g=[],u=[],C=1/t,h=new ae,f=new at,p=new ae,y=new ae,v=new ae;let G=0,B=0;for(let R=0;R<=e.length-1;R++)switch(R){case 0:G=e[R+1].x-e[R].x,B=e[R+1].y-e[R].y,p.x=B*1,p.y=-G,p.z=B*0,v.copy(p),p.normalize(),g.push(p.x,p.y,p.z);break;case e.length-1:g.push(v.x,v.y,v.z);break;default:G=e[R+1].x-e[R].x,B=e[R+1].y-e[R].y,p.x=B*1,p.y=-G,p.z=B*0,y.copy(p),p.x+=v.x,p.y+=v.y,p.z+=v.z,p.normalize(),g.push(p.x,p.y,p.z),v.copy(y)}for(let R=0;R<=t;R++){const x=n+R*C*i,w=Math.sin(x),M=Math.cos(x);for(let H=0;H<=e.length-1;H++){h.x=e[H].x*w,h.y=e[H].y,h.z=e[H].x*M,o.push(h.x,h.y,h.z),f.x=R/t,f.y=H/(e.length-1),r.push(f.x,f.y);const N=g[3*H+0]*w,F=g[3*H+1],Y=g[3*H+0]*M;u.push(N,F,Y)}}for(let R=0;R<t;R++)for(let x=0;x<e.length-1;x++){const w=x+R*e.length,M=w,H=w+e.length,N=w+e.length+1,F=w+1;s.push(M,H,F),s.push(N,F,H)}this.setIndex(s),this.setAttribute("position",new Ht(o,3)),this.setAttribute("uv",new Ht(r,2)),this.setAttribute("normal",new Ht(u,3))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new My(e.points,e.segments,e.phiStart,e.phiLength)}}class Qf extends Wu{constructor(e=1,t=0){const n=[1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],i=[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2];super(n,i,e,t),this.type="OctahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new Qf(e.radius,e.detail)}}class bc extends rn{constructor(e=1,t=1,n=1,i=1){super(),this.type="PlaneGeometry",this.parameters={width:e,height:t,widthSegments:n,heightSegments:i};const s=e/2,o=t/2,r=Math.floor(n),g=Math.floor(i),u=r+1,C=g+1,h=e/r,f=t/g,p=[],y=[],v=[],G=[];for(let B=0;B<C;B++){const R=B*f-o;for(let x=0;x<u;x++){const w=x*h-s;y.push(w,-R,0),v.push(0,0,1),G.push(x/r),G.push(1-B/g)}}for(let B=0;B<g;B++)for(let R=0;R<r;R++){const x=R+u*B,w=R+u*(B+1),M=R+1+u*(B+1),H=R+1+u*B;p.push(x,w,H),p.push(w,M,H)}this.setIndex(p),this.setAttribute("position",new Ht(y,3)),this.setAttribute("normal",new Ht(v,3)),this.setAttribute("uv",new Ht(G,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new bc(e.width,e.height,e.widthSegments,e.heightSegments)}}class Hy extends rn{constructor(e=.5,t=1,n=32,i=1,s=0,o=Math.PI*2){super(),this.type="RingGeometry",this.parameters={innerRadius:e,outerRadius:t,thetaSegments:n,phiSegments:i,thetaStart:s,thetaLength:o},n=Math.max(3,n),i=Math.max(1,i);const r=[],g=[],u=[],C=[];let h=e;const f=(t-e)/i,p=new ae,y=new at;for(let v=0;v<=i;v++){for(let G=0;G<=n;G++){const B=s+G/n*o;p.x=h*Math.cos(B),p.y=h*Math.sin(B),g.push(p.x,p.y,p.z),u.push(0,0,1),y.x=(p.x/t+1)/2,y.y=(p.y/t+1)/2,C.push(y.x,y.y)}h+=f}for(let v=0;v<i;v++){const G=v*(n+1);for(let B=0;B<n;B++){const R=B+G,x=R,w=R+n+1,M=R+n+2,H=R+1;r.push(x,w,H),r.push(w,M,H)}}this.setIndex(r),this.setAttribute("position",new Ht(g,3)),this.setAttribute("normal",new Ht(u,3)),this.setAttribute("uv",new Ht(C,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Hy(e.innerRadius,e.outerRadius,e.thetaSegments,e.phiSegments,e.thetaStart,e.thetaLength)}}class Xy extends rn{constructor(e=new tC([new at(0,.5),new at(-.5,-.5),new at(.5,-.5)]),t=12){super(),this.type="ShapeGeometry",this.parameters={shapes:e,curveSegments:t};const n=[],i=[],s=[],o=[];let r=0,g=0;if(Array.isArray(e)===!1)u(e);else for(let C=0;C<e.length;C++)u(e[C]),this.addGroup(r,g,C),r+=g,g=0;this.setIndex(n),this.setAttribute("position",new Ht(i,3)),this.setAttribute("normal",new Ht(s,3)),this.setAttribute("uv",new Ht(o,2));function u(C){const h=i.length/3,f=C.extractPoints(t);let p=f.shape;const y=f.holes;fr.isClockWise(p)===!1&&(p=p.reverse());for(let G=0,B=y.length;G<B;G++){const R=y[G];fr.isClockWise(R)===!0&&(y[G]=R.reverse())}const v=fr.triangulateShape(p,y);for(let G=0,B=y.length;G<B;G++){const R=y[G];p=p.concat(R)}for(let G=0,B=p.length;G<B;G++){const R=p[G];i.push(R.x,R.y,0),s.push(0,0,1),o.push(R.x,R.y)}for(let G=0,B=v.length;G<B;G++){const R=v[G],x=R[0]+h,w=R[1]+h,M=R[2]+h;n.push(x,w,M),g+=3}}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}toJSON(){const e=super.toJSON(),t=this.parameters.shapes;return C5(t,e)}static fromJSON(e,t){const n=[];for(let i=0,s=e.shapes.length;i<s;i++){const o=t[e.shapes[i]];n.push(o)}return new Xy(n,e.curveSegments)}}function C5(a,e){if(e.shapes=[],Array.isArray(a))for(let t=0,n=a.length;t<n;t++){const i=a[t];e.shapes.push(i.uuid)}else e.shapes.push(a.uuid);return e}class jf extends rn{constructor(e=1,t=32,n=16,i=0,s=Math.PI*2,o=0,r=Math.PI){super(),this.type="SphereGeometry",this.parameters={radius:e,widthSegments:t,heightSegments:n,phiStart:i,phiLength:s,thetaStart:o,thetaLength:r},t=Math.max(3,Math.floor(t)),n=Math.max(2,Math.floor(n));const g=Math.min(o+r,Math.PI);let u=0;const C=[],h=new ae,f=new ae,p=[],y=[],v=[],G=[];for(let B=0;B<=n;B++){const R=[],x=B/n;let w=0;B===0&&o===0?w=.5/t:B===n&&g===Math.PI&&(w=-.5/t);for(let M=0;M<=t;M++){const H=M/t;h.x=-e*Math.cos(i+H*s)*Math.sin(o+x*r),h.y=e*Math.cos(o+x*r),h.z=e*Math.sin(i+H*s)*Math.sin(o+x*r),y.push(h.x,h.y,h.z),f.copy(h).normalize(),v.push(f.x,f.y,f.z),G.push(H+w,1-x),R.push(u++)}C.push(R)}for(let B=0;B<n;B++)for(let R=0;R<t;R++){const x=C[B][R+1],w=C[B][R],M=C[B+1][R],H=C[B+1][R+1];(B!==0||o>0)&&p.push(x,w,H),(B!==n-1||g<Math.PI)&&p.push(w,M,H)}this.setIndex(p),this.setAttribute("position",new Ht(y,3)),this.setAttribute("normal",new Ht(v,3)),this.setAttribute("uv",new Ht(G,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new jf(e.radius,e.widthSegments,e.heightSegments,e.phiStart,e.phiLength,e.thetaStart,e.thetaLength)}}class Ny extends Wu{constructor(e=1,t=0){const n=[1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],i=[2,1,0,0,3,2,1,3,0,2,3,1];super(n,i,e,t),this.type="TetrahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new Ny(e.radius,e.detail)}}class Yy extends rn{constructor(e=1,t=.4,n=12,i=48,s=Math.PI*2){super(),this.type="TorusGeometry",this.parameters={radius:e,tube:t,radialSegments:n,tubularSegments:i,arc:s},n=Math.floor(n),i=Math.floor(i);const o=[],r=[],g=[],u=[],C=new ae,h=new ae,f=new ae;for(let p=0;p<=n;p++)for(let y=0;y<=i;y++){const v=y/i*s,G=p/n*Math.PI*2;h.x=(e+t*Math.cos(G))*Math.cos(v),h.y=(e+t*Math.cos(G))*Math.sin(v),h.z=t*Math.sin(G),r.push(h.x,h.y,h.z),C.x=e*Math.cos(v),C.y=e*Math.sin(v),f.subVectors(h,C).normalize(),g.push(f.x,f.y,f.z),u.push(y/i),u.push(p/n)}for(let p=1;p<=n;p++)for(let y=1;y<=i;y++){const v=(i+1)*p+y-1,G=(i+1)*(p-1)+y-1,B=(i+1)*(p-1)+y,R=(i+1)*p+y;o.push(v,G,R),o.push(G,B,R)}this.setIndex(o),this.setAttribute("position",new Ht(r,3)),this.setAttribute("normal",new Ht(g,3)),this.setAttribute("uv",new Ht(u,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Yy(e.radius,e.tube,e.radialSegments,e.tubularSegments,e.arc)}}class Ky extends rn{constructor(e=1,t=.4,n=64,i=8,s=2,o=3){super(),this.type="TorusKnotGeometry",this.parameters={radius:e,tube:t,tubularSegments:n,radialSegments:i,p:s,q:o},n=Math.floor(n),i=Math.floor(i);const r=[],g=[],u=[],C=[],h=new ae,f=new ae,p=new ae,y=new ae,v=new ae,G=new ae,B=new ae;for(let x=0;x<=n;++x){const w=x/n*s*Math.PI*2;R(w,s,o,e,p),R(w+.01,s,o,e,y),G.subVectors(y,p),B.addVectors(y,p),v.crossVectors(G,B),B.crossVectors(v,G),v.normalize(),B.normalize();for(let M=0;M<=i;++M){const H=M/i*Math.PI*2,N=-t*Math.cos(H),F=t*Math.sin(H);h.x=p.x+(N*B.x+F*v.x),h.y=p.y+(N*B.y+F*v.y),h.z=p.z+(N*B.z+F*v.z),g.push(h.x,h.y,h.z),f.subVectors(h,p).normalize(),u.push(f.x,f.y,f.z),C.push(x/n),C.push(M/i)}}for(let x=1;x<=n;x++)for(let w=1;w<=i;w++){const M=(i+1)*(x-1)+(w-1),H=(i+1)*x+(w-1),N=(i+1)*x+w,F=(i+1)*(x-1)+w;r.push(M,H,F),r.push(H,N,F)}this.setIndex(r),this.setAttribute("position",new Ht(g,3)),this.setAttribute("normal",new Ht(u,3)),this.setAttribute("uv",new Ht(C,2));function R(x,w,M,H,N){const F=Math.cos(x),Y=Math.sin(x),X=M/w*x,U=Math.cos(X);N.x=H*(2+U)*.5*F,N.y=H*(2+U)*Y*.5,N.z=H*Math.sin(X)*.5}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Ky(e.radius,e.tube,e.tubularSegments,e.radialSegments,e.p,e.q)}}class Fy extends rn{constructor(e=new uZ(new ae(-1,-1,0),new ae(-1,1,0),new ae(1,1,0)),t=64,n=1,i=8,s=!1){super(),this.type="TubeGeometry",this.parameters={path:e,tubularSegments:t,radius:n,radialSegments:i,closed:s};const o=e.computeFrenetFrames(t,s);this.tangents=o.tangents,this.normals=o.normals,this.binormals=o.binormals;const r=new ae,g=new ae,u=new at;let C=new ae;const h=[],f=[],p=[],y=[];v(),this.setIndex(y),this.setAttribute("position",new Ht(h,3)),this.setAttribute("normal",new Ht(f,3)),this.setAttribute("uv",new Ht(p,2));function v(){for(let x=0;x<t;x++)G(x);G(s===!1?t:0),R(),B()}function G(x){C=e.getPointAt(x/t,C);const w=o.normals[x],M=o.binormals[x];for(let H=0;H<=i;H++){const N=H/i*Math.PI*2,F=Math.sin(N),Y=-Math.cos(N);g.x=Y*w.x+F*M.x,g.y=Y*w.y+F*M.y,g.z=Y*w.z+F*M.z,g.normalize(),f.push(g.x,g.y,g.z),r.x=C.x+n*g.x,r.y=C.y+n*g.y,r.z=C.z+n*g.z,h.push(r.x,r.y,r.z)}}function B(){for(let x=1;x<=t;x++)for(let w=1;w<=i;w++){const M=(i+1)*(x-1)+(w-1),H=(i+1)*x+(w-1),N=(i+1)*x+w,F=(i+1)*(x-1)+w;y.push(M,H,F),y.push(H,N,F)}}function R(){for(let x=0;x<=t;x++)for(let w=0;w<=i;w++)u.x=x/t,u.y=w/i,p.push(u.x,u.y)}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}toJSON(){const e=super.toJSON();return e.path=this.parameters.path.toJSON(),e}static fromJSON(e){return new Fy(new Y0[e.path.type]().fromJSON(e.path),e.tubularSegments,e.radius,e.radialSegments,e.closed)}}class jV extends rn{constructor(e=null){if(super(),this.type="WireframeGeometry",this.parameters={geometry:e},e!==null){const t=[],n=new Set,i=new ae,s=new ae;if(e.index!==null){const o=e.attributes.position,r=e.index;let g=e.groups;g.length===0&&(g=[{start:0,count:r.count,materialIndex:0}]);for(let u=0,C=g.length;u<C;++u){const h=g[u],f=h.start,p=h.count;for(let y=f,v=f+p;y<v;y+=3)for(let G=0;G<3;G++){const B=r.getX(y+G),R=r.getX(y+(G+1)%3);i.fromBufferAttribute(o,B),s.fromBufferAttribute(o,R),zR(i,s,n)===!0&&(t.push(i.x,i.y,i.z),t.push(s.x,s.y,s.z))}}}else{const o=e.attributes.position;for(let r=0,g=o.count/3;r<g;r++)for(let u=0;u<3;u++){const C=3*r+u,h=3*r+(u+1)%3;i.fromBufferAttribute(o,C),s.fromBufferAttribute(o,h),zR(i,s,n)===!0&&(t.push(i.x,i.y,i.z),t.push(s.x,s.y,s.z))}}this.setAttribute("position",new Ht(t,3))}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}}function zR(a,e,t){const n=`${a.x},${a.y},${a.z}-${e.x},${e.y},${e.z}`,i=`${e.x},${e.y},${e.z}-${a.x},${a.y},${a.z}`;return t.has(n)===!0||t.has(i)===!0?!1:(t.add(n),t.add(i),!0)}var LR=Object.freeze({__proto__:null,BoxGeometry:hC,CapsuleGeometry:Sy,CircleGeometry:Ry,ConeGeometry:Pf,CylinderGeometry:Jf,DodecahedronGeometry:wy,EdgesGeometry:zV,ExtrudeGeometry:Wy,IcosahedronGeometry:Vy,LatheGeometry:My,OctahedronGeometry:Qf,PlaneGeometry:bc,PolyhedronGeometry:Wu,RingGeometry:Hy,ShapeGeometry:Xy,SphereGeometry:jf,TetrahedronGeometry:Ny,TorusGeometry:Yy,TorusKnotGeometry:Ky,TubeGeometry:Fy,WireframeGeometry:jV});class qV extends fa{constructor(e){super(),this.isShadowMaterial=!0,this.type="ShadowMaterial",this.color=new Gt(0),this.transparent=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.fog=e.fog,this}}class $V extends Zl{constructor(e){super(e),this.isRawShaderMaterial=!0,this.type="RawShaderMaterial"}}class qf extends fa{constructor(e){super(),this.isMeshStandardMaterial=!0,this.type="MeshStandardMaterial",this.defines={STANDARD:""},this.color=new Gt(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Gt(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=xu,this.normalScale=new at(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new to,this.envMapIntensity=1,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.defines={STANDARD:""},this.color.copy(e.color),this.roughness=e.roughness,this.metalness=e.metalness,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.roughnessMap=e.roughnessMap,this.metalnessMap=e.metalnessMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.envMapIntensity=e.envMapIntensity,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class Sl extends qf{constructor(e){super(),this.isMeshPhysicalMaterial=!0,this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.anisotropyRotation=0,this.anisotropyMap=null,this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new at(1,1),this.clearcoatNormalMap=null,this.ior=1.5,Object.defineProperty(this,"reflectivity",{get:function(){return ln(2.5*(this.ior-1)/(this.ior+1),0,1)},set:function(t){this.ior=(1+.4*t)/(1-.4*t)}}),this.iridescenceMap=null,this.iridescenceIOR=1.3,this.iridescenceThicknessRange=[100,400],this.iridescenceThicknessMap=null,this.sheenColor=new Gt(0),this.sheenColorMap=null,this.sheenRoughness=1,this.sheenRoughnessMap=null,this.transmissionMap=null,this.thickness=0,this.thicknessMap=null,this.attenuationDistance=1/0,this.attenuationColor=new Gt(1,1,1),this.specularIntensity=1,this.specularIntensityMap=null,this.specularColor=new Gt(1,1,1),this.specularColorMap=null,this._anisotropy=0,this._clearcoat=0,this._dispersion=0,this._iridescence=0,this._sheen=0,this._transmission=0,this.setValues(e)}get anisotropy(){return this._anisotropy}set anisotropy(e){this._anisotropy>0!=e>0&&this.version++,this._anisotropy=e}get clearcoat(){return this._clearcoat}set clearcoat(e){this._clearcoat>0!=e>0&&this.version++,this._clearcoat=e}get iridescence(){return this._iridescence}set iridescence(e){this._iridescence>0!=e>0&&this.version++,this._iridescence=e}get dispersion(){return this._dispersion}set dispersion(e){this._dispersion>0!=e>0&&this.version++,this._dispersion=e}get sheen(){return this._sheen}set sheen(e){this._sheen>0!=e>0&&this.version++,this._sheen=e}get transmission(){return this._transmission}set transmission(e){this._transmission>0!=e>0&&this.version++,this._transmission=e}copy(e){return super.copy(e),this.defines={STANDARD:"",PHYSICAL:""},this.anisotropy=e.anisotropy,this.anisotropyRotation=e.anisotropyRotation,this.anisotropyMap=e.anisotropyMap,this.clearcoat=e.clearcoat,this.clearcoatMap=e.clearcoatMap,this.clearcoatRoughness=e.clearcoatRoughness,this.clearcoatRoughnessMap=e.clearcoatRoughnessMap,this.clearcoatNormalMap=e.clearcoatNormalMap,this.clearcoatNormalScale.copy(e.clearcoatNormalScale),this.dispersion=e.dispersion,this.ior=e.ior,this.iridescence=e.iridescence,this.iridescenceMap=e.iridescenceMap,this.iridescenceIOR=e.iridescenceIOR,this.iridescenceThicknessRange=[...e.iridescenceThicknessRange],this.iridescenceThicknessMap=e.iridescenceThicknessMap,this.sheen=e.sheen,this.sheenColor.copy(e.sheenColor),this.sheenColorMap=e.sheenColorMap,this.sheenRoughness=e.sheenRoughness,this.sheenRoughnessMap=e.sheenRoughnessMap,this.transmission=e.transmission,this.transmissionMap=e.transmissionMap,this.thickness=e.thickness,this.thicknessMap=e.thicknessMap,this.attenuationDistance=e.attenuationDistance,this.attenuationColor.copy(e.attenuationColor),this.specularIntensity=e.specularIntensity,this.specularIntensityMap=e.specularIntensityMap,this.specularColor.copy(e.specularColor),this.specularColorMap=e.specularColorMap,this}}class eM extends fa{constructor(e){super(),this.isMeshPhongMaterial=!0,this.type="MeshPhongMaterial",this.color=new Gt(16777215),this.specular=new Gt(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Gt(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=xu,this.normalScale=new at(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new to,this.combine=_f,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.specular.copy(e.specular),this.shininess=e.shininess,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class tM extends fa{constructor(e){super(),this.isMeshToonMaterial=!0,this.defines={TOON:""},this.type="MeshToonMaterial",this.color=new Gt(16777215),this.map=null,this.gradientMap=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Gt(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=xu,this.normalScale=new at(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.gradientMap=e.gradientMap,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}}class nM extends fa{constructor(e){super(),this.isMeshNormalMaterial=!0,this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=xu,this.normalScale=new at(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.flatShading=!1,this.setValues(e)}copy(e){return super.copy(e),this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.flatShading=e.flatShading,this}}class iM extends fa{constructor(e){super(),this.isMeshLambertMaterial=!0,this.type="MeshLambertMaterial",this.color=new Gt(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Gt(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=xu,this.normalScale=new at(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new to,this.combine=_f,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class Ey extends fa{constructor(e){super(),this.isMeshDepthMaterial=!0,this.type="MeshDepthMaterial",this.depthPacking=bV,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(e)}copy(e){return super.copy(e),this.depthPacking=e.depthPacking,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this}}class Ty extends fa{constructor(e){super(),this.isMeshDistanceMaterial=!0,this.type="MeshDistanceMaterial",this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.setValues(e)}copy(e){return super.copy(e),this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this}}class aM extends fa{constructor(e){super(),this.isMeshMatcapMaterial=!0,this.defines={MATCAP:""},this.type="MeshMatcapMaterial",this.color=new Gt(16777215),this.matcap=null,this.map=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=xu,this.normalScale=new at(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.defines={MATCAP:""},this.color.copy(e.color),this.matcap=e.matcap,this.map=e.map,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.flatShading=e.flatShading,this.fog=e.fog,this}}class sM extends vs{constructor(e){super(),this.isLineDashedMaterial=!0,this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(e)}copy(e){return super.copy(e),this.scale=e.scale,this.dashSize=e.dashSize,this.gapSize=e.gapSize,this}}function JI(a,e){return!a||a.constructor===e?a:typeof e.BYTES_PER_ELEMENT=="number"?new e(a):Array.prototype.slice.call(a)}function oM(a){return ArrayBuffer.isView(a)&&!(a instanceof DataView)}function lM(a){function e(i,s){return a[i]-a[s]}const t=a.length,n=new Array(t);for(let i=0;i!==t;++i)n[i]=i;return n.sort(e),n}function kv(a,e,t){const n=a.length,i=new a.constructor(n);for(let s=0,o=0;o!==n;++s){const r=t[s]*e;for(let g=0;g!==e;++g)i[o++]=a[r+g]}return i}function CZ(a,e,t,n){let i=1,s=a[0];for(;s!==void 0&&s[n]===void 0;)s=a[i++];if(s===void 0)return;let o=s[n];if(o!==void 0)if(Array.isArray(o))do o=s[n],o!==void 0&&(e.push(s.time),t.push(...o)),s=a[i++];while(s!==void 0);else if(o.toArray!==void 0)do o=s[n],o!==void 0&&(e.push(s.time),o.toArray(t,t.length)),s=a[i++];while(s!==void 0);else do o=s[n],o!==void 0&&(e.push(s.time),t.push(o)),s=a[i++];while(s!==void 0)}function d5(a,e,t,n,i=30){const s=a.clone();s.name=e;const o=[];for(let g=0;g<s.tracks.length;++g){const u=s.tracks[g],C=u.getValueSize(),h=[],f=[];for(let p=0;p<u.times.length;++p){const y=u.times[p]*i;if(!(y<t||y>=n)){h.push(u.times[p]);for(let v=0;v<C;++v)f.push(u.values[p*C+v])}}h.length!==0&&(u.times=JI(h,u.times.constructor),u.values=JI(f,u.values.constructor),o.push(u))}s.tracks=o;let r=1/0;for(let g=0;g<s.tracks.length;++g)r>s.tracks[g].times[0]&&(r=s.tracks[g].times[0]);for(let g=0;g<s.tracks.length;++g)s.tracks[g].shift(-1*r);return s.resetDuration(),s}function A5(a,e=0,t=a,n=30){n<=0&&(n=30);const i=t.tracks.length,s=e/n;for(let o=0;o<i;++o){const r=t.tracks[o],g=r.ValueTypeName;if(g==="bool"||g==="string")continue;const u=a.tracks.find(function(B){return B.name===r.name&&B.ValueTypeName===g});if(u===void 0)continue;let C=0;const h=r.getValueSize();r.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(C=h/3);let f=0;const p=u.getValueSize();u.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(f=p/3);const y=r.times.length-1;let v;if(s<=r.times[0]){const B=C,R=h-C;v=r.values.slice(B,R)}else if(s>=r.times[y]){const B=y*h+C,R=B+h-C;v=r.values.slice(B,R)}else{const B=r.createInterpolant(),R=C,x=h-C;B.evaluate(s),v=B.resultBuffer.slice(R,x)}g==="quaternion"&&new ca().fromArray(v).normalize().conjugate().toArray(v);const G=u.times.length;for(let B=0;B<G;++B){const R=B*p+f;if(g==="quaternion")ca.multiplyQuaternionsFlat(u.values,R,v,0,u.values,R);else{const x=p-f*2;for(let w=0;w<x;++w)u.values[R+w]-=v[w]}}}return a.blendMode=J2,a}class h5{static convertArray(e,t){return JI(e,t)}static isTypedArray(e){return oM(e)}static getKeyframeOrder(e){return lM(e)}static sortedArray(e,t,n){return kv(e,t,n)}static flattenJSON(e,t,n,i){CZ(e,t,n,i)}static subclip(e,t,n,i,s=30){return d5(e,t,n,i,s)}static makeClipAdditive(e,t=0,n=e,i=30){return A5(e,t,n,i)}}class dA{constructor(e,t,n,i){this.parameterPositions=e,this._cachedIndex=0,this.resultBuffer=i!==void 0?i:new t.constructor(n),this.sampleValues=t,this.valueSize=n,this.settings=null,this.DefaultSettings_={}}evaluate(e){const t=this.parameterPositions;let n=this._cachedIndex,i=t[n],s=t[n-1];e:{t:{let o;n:{i:if(!(e<i)){for(let r=n+2;;){if(i===void 0){if(e<s)break i;return n=t.length,this._cachedIndex=n,this.copySampleValue_(n-1)}if(n===r)break;if(s=i,i=t[++n],e<i)break t}o=t.length;break n}if(!(e>=s)){const r=t[1];e<r&&(n=2,s=r);for(let g=n-2;;){if(s===void 0)return this._cachedIndex=0,this.copySampleValue_(0);if(n===g)break;if(i=s,s=t[--n-1],e>=s)break t}o=n,n=0;break n}break e}for(;n<o;){const r=n+o>>>1;e<t[r]?o=r:n=r+1}if(i=t[n],s=t[n-1],s===void 0)return this._cachedIndex=0,this.copySampleValue_(0);if(i===void 0)return n=t.length,this._cachedIndex=n,this.copySampleValue_(n-1)}this._cachedIndex=n,this.intervalChanged_(n,s,i)}return this.interpolate_(n,s,e,i)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(e){const t=this.resultBuffer,n=this.sampleValues,i=this.valueSize,s=e*i;for(let o=0;o!==i;++o)t[o]=n[s+o];return t}interpolate_(){throw new Error("call to abstract method")}intervalChanged_(){}}class rM extends dA{constructor(e,t,n,i){super(e,t,n,i),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:DI,endingEnd:DI}}intervalChanged_(e,t,n){const i=this.parameterPositions;let s=e-2,o=e+1,r=i[s],g=i[o];if(r===void 0)switch(this.getSettings_().endingStart){case kI:s=e,r=2*t-n;break;case wf:s=i.length-2,r=t+i[s]-i[s+1];break;default:s=e,r=n}if(g===void 0)switch(this.getSettings_().endingEnd){case kI:o=e,g=2*n-t;break;case wf:o=1,g=n+i[1]-i[0];break;default:o=e-1,g=t}const u=(n-t)*.5,C=this.valueSize;this._weightPrev=u/(t-r),this._weightNext=u/(g-n),this._offsetPrev=s*C,this._offsetNext=o*C}interpolate_(e,t,n,i){const s=this.resultBuffer,o=this.sampleValues,r=this.valueSize,g=e*r,u=g-r,C=this._offsetPrev,h=this._offsetNext,f=this._weightPrev,p=this._weightNext,y=(n-t)/(i-t),v=y*y,G=v*y,B=-f*G+2*f*v-f*y,R=(1+f)*G+(-1.5-2*f)*v+(-.5+f)*y+1,x=(-1-p)*G+(1.5+p)*v+.5*y,w=p*G-p*v;for(let M=0;M!==r;++M)s[M]=B*o[C+M]+R*o[u+M]+x*o[g+M]+w*o[h+M];return s}}class dZ extends dA{constructor(e,t,n,i){super(e,t,n,i)}interpolate_(e,t,n,i){const s=this.resultBuffer,o=this.sampleValues,r=this.valueSize,g=e*r,u=g-r,C=(n-t)/(i-t),h=1-C;for(let f=0;f!==r;++f)s[f]=o[u+f]*h+o[g+f]*C;return s}}class gM extends dA{constructor(e,t,n,i){super(e,t,n,i)}interpolate_(e){return this.copySampleValue_(e-1)}}class Rl{constructor(e,t,n,i){if(e===void 0)throw new Error("THREE.KeyframeTrack: track name is undefined");if(t===void 0||t.length===0)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+e);this.name=e,this.times=JI(t,this.TimeBufferType),this.values=JI(n,this.ValueBufferType),this.setInterpolation(i||this.DefaultInterpolation)}static toJSON(e){const t=e.constructor;let n;if(t.toJSON!==this.toJSON)n=t.toJSON(e);else{n={name:e.name,times:JI(e.times,Array),values:JI(e.values,Array)};const i=e.getInterpolation();i!==e.DefaultInterpolation&&(n.interpolation=i)}return n.type=e.ValueTypeName,n}InterpolantFactoryMethodDiscrete(e){return new gM(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodLinear(e){return new dZ(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodSmooth(e){return new rM(this.times,this.values,this.getValueSize(),e)}setInterpolation(e){let t;switch(e){case tA:t=this.InterpolantFactoryMethodDiscrete;break;case nA:t=this.InterpolantFactoryMethodLinear;break;case zb:t=this.InterpolantFactoryMethodSmooth;break}if(t===void 0){const n="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(this.createInterpolant===void 0)if(e!==this.DefaultInterpolation)this.setInterpolation(this.DefaultInterpolation);else throw new Error(n);return console.warn("THREE.KeyframeTrack:",n),this}return this.createInterpolant=t,this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return tA;case this.InterpolantFactoryMethodLinear:return nA;case this.InterpolantFactoryMethodSmooth:return zb}}getValueSize(){return this.values.length/this.times.length}shift(e){if(e!==0){const t=this.times;for(let n=0,i=t.length;n!==i;++n)t[n]+=e}return this}scale(e){if(e!==1){const t=this.times;for(let n=0,i=t.length;n!==i;++n)t[n]*=e}return this}trim(e,t){const n=this.times,i=n.length;let s=0,o=i-1;for(;s!==i&&n[s]<e;)++s;for(;o!==-1&&n[o]>t;)--o;if(++o,s!==0||o!==i){s>=o&&(o=Math.max(o,1),s=o-1);const r=this.getValueSize();this.times=n.slice(s,o),this.values=this.values.slice(s*r,o*r)}return this}validate(){let e=!0;const t=this.getValueSize();t-Math.floor(t)!==0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),e=!1);const n=this.times,i=this.values,s=n.length;s===0&&(console.error("THREE.KeyframeTrack: Track is empty.",this),e=!1);let o=null;for(let r=0;r!==s;r++){const g=n[r];if(typeof g=="number"&&isNaN(g)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,r,g),e=!1;break}if(o!==null&&o>g){console.error("THREE.KeyframeTrack: Out of order keys.",this,r,g,o),e=!1;break}o=g}if(i!==void 0&&oM(i))for(let r=0,g=i.length;r!==g;++r){const u=i[r];if(isNaN(u)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,r,u),e=!1;break}}return e}optimize(){const e=this.times.slice(),t=this.values.slice(),n=this.getValueSize(),i=this.getInterpolation()===zb,s=e.length-1;let o=1;for(let r=1;r<s;++r){let g=!1;const u=e[r],C=e[r+1];if(u!==C&&(r!==1||u!==e[0]))if(i)g=!0;else{const h=r*n,f=h-n,p=h+n;for(let y=0;y!==n;++y){const v=t[h+y];if(v!==t[f+y]||v!==t[p+y]){g=!0;break}}}if(g){if(r!==o){e[o]=e[r];const h=r*n,f=o*n;for(let p=0;p!==n;++p)t[f+p]=t[h+p]}++o}}if(s>0){e[o]=e[s];for(let r=s*n,g=o*n,u=0;u!==n;++u)t[g+u]=t[r+u];++o}return o!==e.length?(this.times=e.slice(0,o),this.values=t.slice(0,o*n)):(this.times=e,this.values=t),this}clone(){const e=this.times.slice(),t=this.values.slice(),n=this.constructor,i=new n(this.name,e,t);return i.createInterpolant=this.createInterpolant,i}}Rl.prototype.ValueTypeName="";Rl.prototype.TimeBufferType=Float32Array;Rl.prototype.ValueBufferType=Float32Array;Rl.prototype.DefaultInterpolation=nA;class fC extends Rl{constructor(e,t,n){super(e,t,n)}}fC.prototype.ValueTypeName="bool";fC.prototype.ValueBufferType=Array;fC.prototype.DefaultInterpolation=tA;fC.prototype.InterpolantFactoryMethodLinear=void 0;fC.prototype.InterpolantFactoryMethodSmooth=void 0;class AZ extends Rl{constructor(e,t,n,i){super(e,t,n,i)}}AZ.prototype.ValueTypeName="color";class lC extends Rl{constructor(e,t,n,i){super(e,t,n,i)}}lC.prototype.ValueTypeName="number";class cM extends dA{constructor(e,t,n,i){super(e,t,n,i)}interpolate_(e,t,n,i){const s=this.resultBuffer,o=this.sampleValues,r=this.valueSize,g=(n-t)/(i-t);let u=e*r;for(let C=u+r;u!==C;u+=4)ca.slerpFlat(s,0,o,u-r,o,u,g);return s}}class rC extends Rl{constructor(e,t,n,i){super(e,t,n,i)}InterpolantFactoryMethodLinear(e){return new cM(this.times,this.values,this.getValueSize(),e)}}rC.prototype.ValueTypeName="quaternion";rC.prototype.InterpolantFactoryMethodSmooth=void 0;class pC extends Rl{constructor(e,t,n){super(e,t,n)}}pC.prototype.ValueTypeName="string";pC.prototype.ValueBufferType=Array;pC.prototype.DefaultInterpolation=tA;pC.prototype.InterpolantFactoryMethodLinear=void 0;pC.prototype.InterpolantFactoryMethodSmooth=void 0;class gC extends Rl{constructor(e,t,n,i){super(e,t,n,i)}}gC.prototype.ValueTypeName="vector";class lA{constructor(e="",t=-1,n=[],i=dy){this.name=e,this.tracks=n,this.duration=t,this.blendMode=i,this.uuid=Po(),this.duration<0&&this.resetDuration()}static parse(e){const t=[],n=e.tracks,i=1/(e.fps||1);for(let o=0,r=n.length;o!==r;++o)t.push(p5(n[o]).scale(i));const s=new this(e.name,e.duration,t,e.blendMode);return s.uuid=e.uuid,s}static toJSON(e){const t=[],n=e.tracks,i={name:e.name,duration:e.duration,tracks:t,uuid:e.uuid,blendMode:e.blendMode};for(let s=0,o=n.length;s!==o;++s)t.push(Rl.toJSON(n[s]));return i}static CreateFromMorphTargetSequence(e,t,n,i){const s=t.length,o=[];for(let r=0;r<s;r++){let g=[],u=[];g.push((r+s-1)%s,r,(r+1)%s),u.push(0,1,0);const C=lM(g);g=kv(g,1,C),u=kv(u,1,C),!i&&g[0]===0&&(g.push(s),u.push(u[0])),o.push(new lC(".morphTargetInfluences["+t[r].name+"]",g,u).scale(1/n))}return new this(e,-1,o)}static findByName(e,t){let n=e;if(!Array.isArray(e)){const i=e;n=i.geometry&&i.geometry.animations||i.animations}for(let i=0;i<n.length;i++)if(n[i].name===t)return n[i];return null}static CreateClipsFromMorphTargetSequences(e,t,n){const i={},s=/^([\w-]*?)([\d]+)$/;for(let r=0,g=e.length;r<g;r++){const u=e[r],C=u.name.match(s);if(C&&C.length>1){const h=C[1];let f=i[h];f||(i[h]=f=[]),f.push(u)}}const o=[];for(const r in i)o.push(this.CreateFromMorphTargetSequence(r,i[r],t,n));return o}static parseAnimation(e,t){if(console.warn("THREE.AnimationClip: parseAnimation() is deprecated and will be removed with r185"),!e)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;const n=function(h,f,p,y,v){if(p.length!==0){const G=[],B=[];CZ(p,G,B,y),G.length!==0&&v.push(new h(f,G,B))}},i=[],s=e.name||"default",o=e.fps||30,r=e.blendMode;let g=e.length||-1;const u=e.hierarchy||[];for(let h=0;h<u.length;h++){const f=u[h].keys;if(!(!f||f.length===0))if(f[0].morphTargets){const p={};let y;for(y=0;y<f.length;y++)if(f[y].morphTargets)for(let v=0;v<f[y].morphTargets.length;v++)p[f[y].morphTargets[v]]=-1;for(const v in p){const G=[],B=[];for(let R=0;R!==f[y].morphTargets.length;++R){const x=f[y];G.push(x.time),B.push(x.morphTarget===v?1:0)}i.push(new lC(".morphTargetInfluence["+v+"]",G,B))}g=p.length*o}else{const p=".bones["+t[h].name+"]";n(gC,p+".position",f,"pos",i),n(rC,p+".quaternion",f,"rot",i),n(gC,p+".scale",f,"scl",i)}}return i.length===0?null:new this(s,g,i,r)}resetDuration(){const e=this.tracks;let t=0;for(let n=0,i=e.length;n!==i;++n){const s=this.tracks[n];t=Math.max(t,s.times[s.times.length-1])}return this.duration=t,this}trim(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].trim(0,this.duration);return this}validate(){let e=!0;for(let t=0;t<this.tracks.length;t++)e=e&&this.tracks[t].validate();return e}optimize(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].optimize();return this}clone(){const e=[];for(let t=0;t<this.tracks.length;t++)e.push(this.tracks[t].clone());return new this.constructor(this.name,this.duration,e,this.blendMode)}toJSON(){return this.constructor.toJSON(this)}}function f5(a){switch(a.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return lC;case"vector":case"vector2":case"vector3":case"vector4":return gC;case"color":return AZ;case"quaternion":return rC;case"bool":case"boolean":return fC;case"string":return pC}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+a)}function p5(a){if(a.type===void 0)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");const e=f5(a.type);if(a.times===void 0){const t=[],n=[];CZ(a.keys,t,n,"value"),a.times=t,a.values=n}return e.parse!==void 0?e.parse(a):new e(a.name,a.times,a.values,a.interpolation)}const lc={enabled:!1,files:{},add:function(a,e){this.enabled!==!1&&(this.files[a]=e)},get:function(a){if(this.enabled!==!1)return this.files[a]},remove:function(a){delete this.files[a]},clear:function(){this.files={}}};class hZ{constructor(e,t,n){const i=this;let s=!1,o=0,r=0,g;const u=[];this.onStart=void 0,this.onLoad=e,this.onProgress=t,this.onError=n,this.itemStart=function(C){r++,s===!1&&i.onStart!==void 0&&i.onStart(C,o,r),s=!0},this.itemEnd=function(C){o++,i.onProgress!==void 0&&i.onProgress(C,o,r),o===r&&(s=!1,i.onLoad!==void 0&&i.onLoad())},this.itemError=function(C){i.onError!==void 0&&i.onError(C)},this.resolveURL=function(C){return g?g(C):C},this.setURLModifier=function(C){return g=C,this},this.addHandler=function(C,h){return u.push(C,h),this},this.removeHandler=function(C){const h=u.indexOf(C);return h!==-1&&u.splice(h,2),this},this.getHandler=function(C){for(let h=0,f=u.length;h<f;h+=2){const p=u[h],y=u[h+1];if(p.global&&(p.lastIndex=0),p.test(C))return y}return null}}}const uM=new hZ;class Zs{constructor(e){this.manager=e!==void 0?e:uM,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(e,t){const n=this;return new Promise(function(i,s){n.load(e,i,t,s)})}parse(){}setCrossOrigin(e){return this.crossOrigin=e,this}setWithCredentials(e){return this.withCredentials=e,this}setPath(e){return this.path=e,this}setResourcePath(e){return this.resourcePath=e,this}setRequestHeader(e){return this.requestHeader=e,this}}Zs.DEFAULT_MATERIAL_NAME="__DEFAULT";const qg={};class m5 extends Error{constructor(e,t){super(e),this.response=t}}class Qo extends Zs{constructor(e){super(e),this.mimeType="",this.responseType=""}load(e,t,n,i){e===void 0&&(e=""),this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);const s=lc.get(e);if(s!==void 0)return this.manager.itemStart(e),setTimeout(()=>{t&&t(s),this.manager.itemEnd(e)},0),s;if(qg[e]!==void 0){qg[e].push({onLoad:t,onProgress:n,onError:i});return}qg[e]=[],qg[e].push({onLoad:t,onProgress:n,onError:i});const o=new Request(e,{headers:new Headers(this.requestHeader),credentials:this.withCredentials?"include":"same-origin"}),r=this.mimeType,g=this.responseType;fetch(o).then(u=>{if(u.status===200||u.status===0){if(u.status===0&&console.warn("THREE.FileLoader: HTTP Status 0 received."),typeof ReadableStream>"u"||u.body===void 0||u.body.getReader===void 0)return u;const C=qg[e],h=u.body.getReader(),f=u.headers.get("X-File-Size")||u.headers.get("Content-Length"),p=f?parseInt(f):0,y=p!==0;let v=0;const G=new ReadableStream({start(B){R();function R(){h.read().then(({done:x,value:w})=>{if(x)B.close();else{v+=w.byteLength;const M=new ProgressEvent("progress",{lengthComputable:y,loaded:v,total:p});for(let H=0,N=C.length;H<N;H++){const F=C[H];F.onProgress&&F.onProgress(M)}B.enqueue(w),R()}},x=>{B.error(x)})}}});return new Response(G)}else throw new m5(`fetch for "${u.url}" responded with ${u.status}: ${u.statusText}`,u)}).then(u=>{switch(g){case"arraybuffer":return u.arrayBuffer();case"blob":return u.blob();case"document":return u.text().then(C=>new DOMParser().parseFromString(C,r));case"json":return u.json();default:if(r==="")return u.text();{const h=/charset="?([^;"\s]*)"?/i.exec(r),f=h&&h[1]?h[1].toLowerCase():void 0,p=new TextDecoder(f);return u.arrayBuffer().then(y=>p.decode(y))}}}).then(u=>{lc.add(e,u);const C=qg[e];delete qg[e];for(let h=0,f=C.length;h<f;h++){const p=C[h];p.onLoad&&p.onLoad(u)}}).catch(u=>{const C=qg[e];if(C===void 0)throw this.manager.itemError(e),u;delete qg[e];for(let h=0,f=C.length;h<f;h++){const p=C[h];p.onError&&p.onError(u)}this.manager.itemError(e)}).finally(()=>{this.manager.itemEnd(e)}),this.manager.itemStart(e)}setResponseType(e){return this.responseType=e,this}setMimeType(e){return this.mimeType=e,this}}class b5 extends Zs{constructor(e){super(e)}load(e,t,n,i){const s=this,o=new Qo(this.manager);o.setPath(this.path),o.setRequestHeader(this.requestHeader),o.setWithCredentials(this.withCredentials),o.load(e,function(r){try{t(s.parse(JSON.parse(r)))}catch(g){i?i(g):console.error(g),s.manager.itemError(e)}},n,i)}parse(e){const t=[];for(let n=0;n<e.length;n++){const i=lA.parse(e[n]);t.push(i)}return t}}class y5 extends Zs{constructor(e){super(e)}load(e,t,n,i){const s=this,o=[],r=new vy,g=new Qo(this.manager);g.setPath(this.path),g.setResponseType("arraybuffer"),g.setRequestHeader(this.requestHeader),g.setWithCredentials(s.withCredentials);let u=0;function C(h){g.load(e[h],function(f){const p=s.parse(f,!0);o[h]={width:p.width,height:p.height,format:p.format,mipmaps:p.mipmaps},u+=1,u===6&&(p.mipmapCount===1&&(r.minFilter=Bi),r.image=o,r.format=p.format,r.needsUpdate=!0,t&&t(r))},n,i)}if(Array.isArray(e))for(let h=0,f=e.length;h<f;++h)C(h);else g.load(e,function(h){const f=s.parse(h,!0);if(f.isCubemap){const p=f.mipmaps.length/f.mipmapCount;for(let y=0;y<p;y++){o[y]={mipmaps:[]};for(let v=0;v<f.mipmapCount;v++)o[y].mipmaps.push(f.mipmaps[y*f.mipmapCount+v]),o[y].format=f.format,o[y].width=f.width,o[y].height=f.height}r.image=o}else r.image.width=f.width,r.image.height=f.height,r.mipmaps=f.mipmaps;f.mipmapCount===1&&(r.minFilter=Bi),r.format=f.format,r.needsUpdate=!0,t&&t(r)},n,i);return r}}class Yf extends Zs{constructor(e){super(e)}load(e,t,n,i){this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);const s=this,o=lc.get(e);if(o!==void 0)return s.manager.itemStart(e),setTimeout(function(){t&&t(o),s.manager.itemEnd(e)},0),o;const r=Mf("img");function g(){C(),lc.add(e,this),t&&t(this),s.manager.itemEnd(e)}function u(h){C(),i&&i(h),s.manager.itemError(e),s.manager.itemEnd(e)}function C(){r.removeEventListener("load",g,!1),r.removeEventListener("error",u,!1)}return r.addEventListener("load",g,!1),r.addEventListener("error",u,!1),e.slice(0,5)!=="data:"&&this.crossOrigin!==void 0&&(r.crossOrigin=this.crossOrigin),s.manager.itemStart(e),r.src=e,r}}class G5 extends Zs{constructor(e){super(e)}load(e,t,n,i){const s=new Df;s.colorSpace=ys;const o=new Yf(this.manager);o.setCrossOrigin(this.crossOrigin),o.setPath(this.path);let r=0;function g(u){o.load(e[u],function(C){s.images[u]=C,r++,r===6&&(s.needsUpdate=!0,t&&t(s))},void 0,i)}for(let u=0;u<e.length;++u)g(u);return s}}class B5 extends Zs{constructor(e){super(e)}load(e,t,n,i){const s=this,o=new hg,r=new Qo(this.manager);return r.setResponseType("arraybuffer"),r.setRequestHeader(this.requestHeader),r.setPath(this.path),r.setWithCredentials(s.withCredentials),r.load(e,function(g){let u;try{u=s.parse(g)}catch(C){if(i!==void 0)i(C);else{console.error(C);return}}u.image!==void 0?o.image=u.image:u.data!==void 0&&(o.image.width=u.width,o.image.height=u.height,o.image.data=u.data),o.wrapS=u.wrapS!==void 0?u.wrapS:Jo,o.wrapT=u.wrapT!==void 0?u.wrapT:Jo,o.magFilter=u.magFilter!==void 0?u.magFilter:Bi,o.minFilter=u.minFilter!==void 0?u.minFilter:Bi,o.anisotropy=u.anisotropy!==void 0?u.anisotropy:1,u.colorSpace!==void 0&&(o.colorSpace=u.colorSpace),u.flipY!==void 0&&(o.flipY=u.flipY),u.format!==void 0&&(o.format=u.format),u.type!==void 0&&(o.type=u.type),u.mipmaps!==void 0&&(o.mipmaps=u.mipmaps,o.minFilter=yl),u.mipmapCount===1&&(o.minFilter=Bi),u.generateMipmaps!==void 0&&(o.generateMipmaps=u.generateMipmaps),o.needsUpdate=!0,t&&t(o,u)},n,i),o}}class IM extends Zs{constructor(e){super(e)}load(e,t,n,i){const s=new Zi,o=new Yf(this.manager);return o.setCrossOrigin(this.crossOrigin),o.setPath(this.path),o.load(e,function(r){s.image=r,s.needsUpdate=!0,t!==void 0&&t(s)},n,i),s}}class Vu extends wn{constructor(e,t=1){super(),this.isLight=!0,this.type="Light",this.color=new Gt(e),this.intensity=t}dispose(){}copy(e,t){return super.copy(e,t),this.color.copy(e.color),this.intensity=e.intensity,this}toJSON(e){const t=super.toJSON(e);return t.object.color=this.color.getHex(),t.object.intensity=this.intensity,this.groundColor!==void 0&&(t.object.groundColor=this.groundColor.getHex()),this.distance!==void 0&&(t.object.distance=this.distance),this.angle!==void 0&&(t.object.angle=this.angle),this.decay!==void 0&&(t.object.decay=this.decay),this.penumbra!==void 0&&(t.object.penumbra=this.penumbra),this.shadow!==void 0&&(t.object.shadow=this.shadow.toJSON()),this.target!==void 0&&(t.object.target=this.target.uuid),t}}class CM extends Vu{constructor(e,t,n){super(e,n),this.isHemisphereLight=!0,this.type="HemisphereLight",this.position.copy(wn.DEFAULT_UP),this.updateMatrix(),this.groundColor=new Gt(t)}copy(e,t){return super.copy(e,t),this.groundColor.copy(e.groundColor),this}}const bB=new Yt,_R=new ae,UR=new ae;class fZ{constructor(e){this.camera=e,this.intensity=1,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new at(512,512),this.mapType=vl,this.map=null,this.mapPass=null,this.matrix=new Yt,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new CA,this._frameExtents=new at(1,1),this._viewportCount=1,this._viewports=[new Hn(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(e){const t=this.camera,n=this.matrix;_R.setFromMatrixPosition(e.matrixWorld),t.position.copy(_R),UR.setFromMatrixPosition(e.target.matrixWorld),t.lookAt(UR),t.updateMatrixWorld(),bB.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),this._frustum.setFromProjectionMatrix(bB),n.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),n.multiply(bB)}getViewport(e){return this._viewports[e]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(e){return this.camera=e.camera.clone(),this.intensity=e.intensity,this.bias=e.bias,this.radius=e.radius,this.autoUpdate=e.autoUpdate,this.needsUpdate=e.needsUpdate,this.normalBias=e.normalBias,this.blurSamples=e.blurSamples,this.mapSize.copy(e.mapSize),this}clone(){return new this.constructor().copy(this)}toJSON(){const e={};return this.intensity!==1&&(e.intensity=this.intensity),this.bias!==0&&(e.bias=this.bias),this.normalBias!==0&&(e.normalBias=this.normalBias),this.radius!==1&&(e.radius=this.radius),(this.mapSize.x!==512||this.mapSize.y!==512)&&(e.mapSize=this.mapSize.toArray()),e.camera=this.camera.toJSON(!1).object,delete e.camera.matrix,e}}class v5 extends fZ{constructor(){super(new Xi(50,1,.5,500)),this.isSpotLightShadow=!0,this.focus=1,this.aspect=1}updateMatrices(e){const t=this.camera,n=iA*2*e.angle*this.focus,i=this.mapSize.width/this.mapSize.height*this.aspect,s=e.distance||t.far;(n!==t.fov||i!==t.aspect||s!==t.far)&&(t.fov=n,t.aspect=i,t.far=s,t.updateProjectionMatrix()),super.updateMatrices(e)}copy(e){return super.copy(e),this.focus=e.focus,this}}class pZ extends Vu{constructor(e,t,n=0,i=Math.PI/3,s=0,o=2){super(e,t),this.isSpotLight=!0,this.type="SpotLight",this.position.copy(wn.DEFAULT_UP),this.updateMatrix(),this.target=new wn,this.distance=n,this.angle=i,this.penumbra=s,this.decay=o,this.map=null,this.shadow=new v5}get power(){return this.intensity*Math.PI}set power(e){this.intensity=e/Math.PI}dispose(){this.shadow.dispose()}copy(e,t){return super.copy(e,t),this.distance=e.distance,this.angle=e.angle,this.penumbra=e.penumbra,this.decay=e.decay,this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}const DR=new Yt,Dh=new ae,yB=new ae;class Z5 extends fZ{constructor(){super(new Xi(90,1,.5,500)),this.isPointLightShadow=!0,this._frameExtents=new at(4,2),this._viewportCount=6,this._viewports=[new Hn(2,1,1,1),new Hn(0,1,1,1),new Hn(3,1,1,1),new Hn(1,1,1,1),new Hn(3,0,1,1),new Hn(1,0,1,1)],this._cubeDirections=[new ae(1,0,0),new ae(-1,0,0),new ae(0,0,1),new ae(0,0,-1),new ae(0,1,0),new ae(0,-1,0)],this._cubeUps=[new ae(0,1,0),new ae(0,1,0),new ae(0,1,0),new ae(0,1,0),new ae(0,0,1),new ae(0,0,-1)]}updateMatrices(e,t=0){const n=this.camera,i=this.matrix,s=e.distance||n.far;s!==n.far&&(n.far=s,n.updateProjectionMatrix()),Dh.setFromMatrixPosition(e.matrixWorld),n.position.copy(Dh),yB.copy(n.position),yB.add(this._cubeDirections[t]),n.up.copy(this._cubeUps[t]),n.lookAt(yB),n.updateMatrixWorld(),i.makeTranslation(-Dh.x,-Dh.y,-Dh.z),DR.multiplyMatrices(n.projectionMatrix,n.matrixWorldInverse),this._frustum.setFromProjectionMatrix(DR)}}class mZ extends Vu{constructor(e,t,n=0,i=2){super(e,t),this.isPointLight=!0,this.type="PointLight",this.distance=n,this.decay=i,this.shadow=new Z5}get power(){return this.intensity*4*Math.PI}set power(e){this.intensity=e/(4*Math.PI)}dispose(){this.shadow.dispose()}copy(e,t){return super.copy(e,t),this.distance=e.distance,this.decay=e.decay,this.shadow=e.shadow.clone(),this}}class pr extends py{constructor(e=-1,t=1,n=1,i=-1,s=.1,o=2e3){super(),this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=e,this.right=t,this.top=n,this.bottom=i,this.near=s,this.far=o,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=e.view===null?null:Object.assign({},e.view),this}setViewOffset(e,t,n,i,s,o){this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=n,this.view.offsetY=i,this.view.width=s,this.view.height=o,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=(this.right-this.left)/(2*this.zoom),t=(this.top-this.bottom)/(2*this.zoom),n=(this.right+this.left)/2,i=(this.top+this.bottom)/2;let s=n-e,o=n+e,r=i+t,g=i-t;if(this.view!==null&&this.view.enabled){const u=(this.right-this.left)/this.view.fullWidth/this.zoom,C=(this.top-this.bottom)/this.view.fullHeight/this.zoom;s+=u*this.view.offsetX,o=s+u*this.view.width,r-=C*this.view.offsetY,g=r-C*this.view.height}this.projectionMatrix.makeOrthographic(s,o,r,g,this.near,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.zoom=this.zoom,t.object.left=this.left,t.object.right=this.right,t.object.top=this.top,t.object.bottom=this.bottom,t.object.near=this.near,t.object.far=this.far,this.view!==null&&(t.object.view=Object.assign({},this.view)),t}}class S5 extends fZ{constructor(){super(new pr(-5,5,5,-5,.5,500)),this.isDirectionalLightShadow=!0}}class bZ extends Vu{constructor(e,t){super(e,t),this.isDirectionalLight=!0,this.type="DirectionalLight",this.position.copy(wn.DEFAULT_UP),this.updateMatrix(),this.target=new wn,this.shadow=new S5}dispose(){this.shadow.dispose()}copy(e){return super.copy(e),this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}class dM extends Vu{constructor(e,t){super(e,t),this.isAmbientLight=!0,this.type="AmbientLight"}}class AM extends Vu{constructor(e,t,n=10,i=10){super(e,t),this.isRectAreaLight=!0,this.type="RectAreaLight",this.width=n,this.height=i}get power(){return this.intensity*this.width*this.height*Math.PI}set power(e){this.intensity=e/(this.width*this.height*Math.PI)}copy(e){return super.copy(e),this.width=e.width,this.height=e.height,this}toJSON(e){const t=super.toJSON(e);return t.object.width=this.width,t.object.height=this.height,t}}class hM{constructor(){this.isSphericalHarmonics3=!0,this.coefficients=[];for(let e=0;e<9;e++)this.coefficients.push(new ae)}set(e){for(let t=0;t<9;t++)this.coefficients[t].copy(e[t]);return this}zero(){for(let e=0;e<9;e++)this.coefficients[e].set(0,0,0);return this}getAt(e,t){const n=e.x,i=e.y,s=e.z,o=this.coefficients;return t.copy(o[0]).multiplyScalar(.282095),t.addScaledVector(o[1],.488603*i),t.addScaledVector(o[2],.488603*s),t.addScaledVector(o[3],.488603*n),t.addScaledVector(o[4],1.092548*(n*i)),t.addScaledVector(o[5],1.092548*(i*s)),t.addScaledVector(o[6],.315392*(3*s*s-1)),t.addScaledVector(o[7],1.092548*(n*s)),t.addScaledVector(o[8],.546274*(n*n-i*i)),t}getIrradianceAt(e,t){const n=e.x,i=e.y,s=e.z,o=this.coefficients;return t.copy(o[0]).multiplyScalar(.886227),t.addScaledVector(o[1],2*.511664*i),t.addScaledVector(o[2],2*.511664*s),t.addScaledVector(o[3],2*.511664*n),t.addScaledVector(o[4],2*.429043*n*i),t.addScaledVector(o[5],2*.429043*i*s),t.addScaledVector(o[6],.743125*s*s-.247708),t.addScaledVector(o[7],2*.429043*n*s),t.addScaledVector(o[8],.429043*(n*n-i*i)),t}add(e){for(let t=0;t<9;t++)this.coefficients[t].add(e.coefficients[t]);return this}addScaledSH(e,t){for(let n=0;n<9;n++)this.coefficients[n].addScaledVector(e.coefficients[n],t);return this}scale(e){for(let t=0;t<9;t++)this.coefficients[t].multiplyScalar(e);return this}lerp(e,t){for(let n=0;n<9;n++)this.coefficients[n].lerp(e.coefficients[n],t);return this}equals(e){for(let t=0;t<9;t++)if(!this.coefficients[t].equals(e.coefficients[t]))return!1;return!0}copy(e){return this.set(e.coefficients)}clone(){return new this.constructor().copy(this)}fromArray(e,t=0){const n=this.coefficients;for(let i=0;i<9;i++)n[i].fromArray(e,t+i*3);return this}toArray(e=[],t=0){const n=this.coefficients;for(let i=0;i<9;i++)n[i].toArray(e,t+i*3);return e}static getBasisAt(e,t){const n=e.x,i=e.y,s=e.z;t[0]=.282095,t[1]=.488603*i,t[2]=.488603*s,t[3]=.488603*n,t[4]=1.092548*n*i,t[5]=1.092548*i*s,t[6]=.315392*(3*s*s-1),t[7]=1.092548*n*s,t[8]=.546274*(n*n-i*i)}}class fM extends Vu{constructor(e=new hM,t=1){super(void 0,t),this.isLightProbe=!0,this.sh=e}copy(e){return super.copy(e),this.sh.copy(e.sh),this}fromJSON(e){return this.intensity=e.intensity,this.sh.fromArray(e.sh),this}toJSON(e){const t=super.toJSON(e);return t.object.sh=this.sh.toArray(),t}}class zy extends Zs{constructor(e){super(e),this.textures={}}load(e,t,n,i){const s=this,o=new Qo(s.manager);o.setPath(s.path),o.setRequestHeader(s.requestHeader),o.setWithCredentials(s.withCredentials),o.load(e,function(r){try{t(s.parse(JSON.parse(r)))}catch(g){i?i(g):console.error(g),s.manager.itemError(e)}},n,i)}parse(e){const t=this.textures;function n(s){return t[s]===void 0&&console.warn("THREE.MaterialLoader: Undefined texture",s),t[s]}const i=this.createMaterialFromType(e.type);if(e.uuid!==void 0&&(i.uuid=e.uuid),e.name!==void 0&&(i.name=e.name),e.color!==void 0&&i.color!==void 0&&i.color.setHex(e.color),e.roughness!==void 0&&(i.roughness=e.roughness),e.metalness!==void 0&&(i.metalness=e.metalness),e.sheen!==void 0&&(i.sheen=e.sheen),e.sheenColor!==void 0&&(i.sheenColor=new Gt().setHex(e.sheenColor)),e.sheenRoughness!==void 0&&(i.sheenRoughness=e.sheenRoughness),e.emissive!==void 0&&i.emissive!==void 0&&i.emissive.setHex(e.emissive),e.specular!==void 0&&i.specular!==void 0&&i.specular.setHex(e.specular),e.specularIntensity!==void 0&&(i.specularIntensity=e.specularIntensity),e.specularColor!==void 0&&i.specularColor!==void 0&&i.specularColor.setHex(e.specularColor),e.shininess!==void 0&&(i.shininess=e.shininess),e.clearcoat!==void 0&&(i.clearcoat=e.clearcoat),e.clearcoatRoughness!==void 0&&(i.clearcoatRoughness=e.clearcoatRoughness),e.dispersion!==void 0&&(i.dispersion=e.dispersion),e.iridescence!==void 0&&(i.iridescence=e.iridescence),e.iridescenceIOR!==void 0&&(i.iridescenceIOR=e.iridescenceIOR),e.iridescenceThicknessRange!==void 0&&(i.iridescenceThicknessRange=e.iridescenceThicknessRange),e.transmission!==void 0&&(i.transmission=e.transmission),e.thickness!==void 0&&(i.thickness=e.thickness),e.attenuationDistance!==void 0&&(i.attenuationDistance=e.attenuationDistance),e.attenuationColor!==void 0&&i.attenuationColor!==void 0&&i.attenuationColor.setHex(e.attenuationColor),e.anisotropy!==void 0&&(i.anisotropy=e.anisotropy),e.anisotropyRotation!==void 0&&(i.anisotropyRotation=e.anisotropyRotation),e.fog!==void 0&&(i.fog=e.fog),e.flatShading!==void 0&&(i.flatShading=e.flatShading),e.blending!==void 0&&(i.blending=e.blending),e.combine!==void 0&&(i.combine=e.combine),e.side!==void 0&&(i.side=e.side),e.shadowSide!==void 0&&(i.shadowSide=e.shadowSide),e.opacity!==void 0&&(i.opacity=e.opacity),e.transparent!==void 0&&(i.transparent=e.transparent),e.alphaTest!==void 0&&(i.alphaTest=e.alphaTest),e.alphaHash!==void 0&&(i.alphaHash=e.alphaHash),e.depthFunc!==void 0&&(i.depthFunc=e.depthFunc),e.depthTest!==void 0&&(i.depthTest=e.depthTest),e.depthWrite!==void 0&&(i.depthWrite=e.depthWrite),e.colorWrite!==void 0&&(i.colorWrite=e.colorWrite),e.blendSrc!==void 0&&(i.blendSrc=e.blendSrc),e.blendDst!==void 0&&(i.blendDst=e.blendDst),e.blendEquation!==void 0&&(i.blendEquation=e.blendEquation),e.blendSrcAlpha!==void 0&&(i.blendSrcAlpha=e.blendSrcAlpha),e.blendDstAlpha!==void 0&&(i.blendDstAlpha=e.blendDstAlpha),e.blendEquationAlpha!==void 0&&(i.blendEquationAlpha=e.blendEquationAlpha),e.blendColor!==void 0&&i.blendColor!==void 0&&i.blendColor.setHex(e.blendColor),e.blendAlpha!==void 0&&(i.blendAlpha=e.blendAlpha),e.stencilWriteMask!==void 0&&(i.stencilWriteMask=e.stencilWriteMask),e.stencilFunc!==void 0&&(i.stencilFunc=e.stencilFunc),e.stencilRef!==void 0&&(i.stencilRef=e.stencilRef),e.stencilFuncMask!==void 0&&(i.stencilFuncMask=e.stencilFuncMask),e.stencilFail!==void 0&&(i.stencilFail=e.stencilFail),e.stencilZFail!==void 0&&(i.stencilZFail=e.stencilZFail),e.stencilZPass!==void 0&&(i.stencilZPass=e.stencilZPass),e.stencilWrite!==void 0&&(i.stencilWrite=e.stencilWrite),e.wireframe!==void 0&&(i.wireframe=e.wireframe),e.wireframeLinewidth!==void 0&&(i.wireframeLinewidth=e.wireframeLinewidth),e.wireframeLinecap!==void 0&&(i.wireframeLinecap=e.wireframeLinecap),e.wireframeLinejoin!==void 0&&(i.wireframeLinejoin=e.wireframeLinejoin),e.rotation!==void 0&&(i.rotation=e.rotation),e.linewidth!==void 0&&(i.linewidth=e.linewidth),e.dashSize!==void 0&&(i.dashSize=e.dashSize),e.gapSize!==void 0&&(i.gapSize=e.gapSize),e.scale!==void 0&&(i.scale=e.scale),e.polygonOffset!==void 0&&(i.polygonOffset=e.polygonOffset),e.polygonOffsetFactor!==void 0&&(i.polygonOffsetFactor=e.polygonOffsetFactor),e.polygonOffsetUnits!==void 0&&(i.polygonOffsetUnits=e.polygonOffsetUnits),e.dithering!==void 0&&(i.dithering=e.dithering),e.alphaToCoverage!==void 0&&(i.alphaToCoverage=e.alphaToCoverage),e.premultipliedAlpha!==void 0&&(i.premultipliedAlpha=e.premultipliedAlpha),e.forceSinglePass!==void 0&&(i.forceSinglePass=e.forceSinglePass),e.visible!==void 0&&(i.visible=e.visible),e.toneMapped!==void 0&&(i.toneMapped=e.toneMapped),e.userData!==void 0&&(i.userData=e.userData),e.vertexColors!==void 0&&(typeof e.vertexColors=="number"?i.vertexColors=e.vertexColors>0:i.vertexColors=e.vertexColors),e.uniforms!==void 0)for(const s in e.uniforms){const o=e.uniforms[s];switch(i.uniforms[s]={},o.type){case"t":i.uniforms[s].value=n(o.value);break;case"c":i.uniforms[s].value=new Gt().setHex(o.value);break;case"v2":i.uniforms[s].value=new at().fromArray(o.value);break;case"v3":i.uniforms[s].value=new ae().fromArray(o.value);break;case"v4":i.uniforms[s].value=new Hn().fromArray(o.value);break;case"m3":i.uniforms[s].value=new on().fromArray(o.value);break;case"m4":i.uniforms[s].value=new Yt().fromArray(o.value);break;default:i.uniforms[s].value=o.value}}if(e.defines!==void 0&&(i.defines=e.defines),e.vertexShader!==void 0&&(i.vertexShader=e.vertexShader),e.fragmentShader!==void 0&&(i.fragmentShader=e.fragmentShader),e.glslVersion!==void 0&&(i.glslVersion=e.glslVersion),e.extensions!==void 0)for(const s in e.extensions)i.extensions[s]=e.extensions[s];if(e.lights!==void 0&&(i.lights=e.lights),e.clipping!==void 0&&(i.clipping=e.clipping),e.size!==void 0&&(i.size=e.size),e.sizeAttenuation!==void 0&&(i.sizeAttenuation=e.sizeAttenuation),e.map!==void 0&&(i.map=n(e.map)),e.matcap!==void 0&&(i.matcap=n(e.matcap)),e.alphaMap!==void 0&&(i.alphaMap=n(e.alphaMap)),e.bumpMap!==void 0&&(i.bumpMap=n(e.bumpMap)),e.bumpScale!==void 0&&(i.bumpScale=e.bumpScale),e.normalMap!==void 0&&(i.normalMap=n(e.normalMap)),e.normalMapType!==void 0&&(i.normalMapType=e.normalMapType),e.normalScale!==void 0){let s=e.normalScale;Array.isArray(s)===!1&&(s=[s,s]),i.normalScale=new at().fromArray(s)}return e.displacementMap!==void 0&&(i.displacementMap=n(e.displacementMap)),e.displacementScale!==void 0&&(i.displacementScale=e.displacementScale),e.displacementBias!==void 0&&(i.displacementBias=e.displacementBias),e.roughnessMap!==void 0&&(i.roughnessMap=n(e.roughnessMap)),e.metalnessMap!==void 0&&(i.metalnessMap=n(e.metalnessMap)),e.emissiveMap!==void 0&&(i.emissiveMap=n(e.emissiveMap)),e.emissiveIntensity!==void 0&&(i.emissiveIntensity=e.emissiveIntensity),e.specularMap!==void 0&&(i.specularMap=n(e.specularMap)),e.specularIntensityMap!==void 0&&(i.specularIntensityMap=n(e.specularIntensityMap)),e.specularColorMap!==void 0&&(i.specularColorMap=n(e.specularColorMap)),e.envMap!==void 0&&(i.envMap=n(e.envMap)),e.envMapRotation!==void 0&&i.envMapRotation.fromArray(e.envMapRotation),e.envMapIntensity!==void 0&&(i.envMapIntensity=e.envMapIntensity),e.reflectivity!==void 0&&(i.reflectivity=e.reflectivity),e.refractionRatio!==void 0&&(i.refractionRatio=e.refractionRatio),e.lightMap!==void 0&&(i.lightMap=n(e.lightMap)),e.lightMapIntensity!==void 0&&(i.lightMapIntensity=e.lightMapIntensity),e.aoMap!==void 0&&(i.aoMap=n(e.aoMap)),e.aoMapIntensity!==void 0&&(i.aoMapIntensity=e.aoMapIntensity),e.gradientMap!==void 0&&(i.gradientMap=n(e.gradientMap)),e.clearcoatMap!==void 0&&(i.clearcoatMap=n(e.clearcoatMap)),e.clearcoatRoughnessMap!==void 0&&(i.clearcoatRoughnessMap=n(e.clearcoatRoughnessMap)),e.clearcoatNormalMap!==void 0&&(i.clearcoatNormalMap=n(e.clearcoatNormalMap)),e.clearcoatNormalScale!==void 0&&(i.clearcoatNormalScale=new at().fromArray(e.clearcoatNormalScale)),e.iridescenceMap!==void 0&&(i.iridescenceMap=n(e.iridescenceMap)),e.iridescenceThicknessMap!==void 0&&(i.iridescenceThicknessMap=n(e.iridescenceThicknessMap)),e.transmissionMap!==void 0&&(i.transmissionMap=n(e.transmissionMap)),e.thicknessMap!==void 0&&(i.thicknessMap=n(e.thicknessMap)),e.anisotropyMap!==void 0&&(i.anisotropyMap=n(e.anisotropyMap)),e.sheenColorMap!==void 0&&(i.sheenColorMap=n(e.sheenColorMap)),e.sheenRoughnessMap!==void 0&&(i.sheenRoughnessMap=n(e.sheenRoughnessMap)),i}setTextures(e){return this.textures=e,this}createMaterialFromType(e){return zy.createMaterialFromType(e)}static createMaterialFromType(e){const t={ShadowMaterial:qV,SpriteMaterial:iZ,RawShaderMaterial:$V,ShaderMaterial:Zl,PointsMaterial:By,MeshPhysicalMaterial:Sl,MeshStandardMaterial:qf,MeshPhongMaterial:eM,MeshToonMaterial:tM,MeshNormalMaterial:nM,MeshLambertMaterial:iM,MeshDepthMaterial:Ey,MeshDistanceMaterial:Ty,MeshBasicMaterial:wo,MeshMatcapMaterial:aM,LineDashedMaterial:sM,LineBasicMaterial:vs,Material:fa};return new t[e]}}class bu{static extractUrlBase(e){const t=e.lastIndexOf("/");return t===-1?"./":e.slice(0,t+1)}static resolveURL(e,t){return typeof e!="string"||e===""?"":(/^https?:\/\//i.test(t)&&/^\//.test(e)&&(t=t.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(e)||/^data:.*,.*$/i.test(e)||/^blob:.*$/i.test(e)?e:t+e)}}class yZ extends rn{constructor(){super(),this.isInstancedBufferGeometry=!0,this.type="InstancedBufferGeometry",this.instanceCount=1/0}copy(e){return super.copy(e),this.instanceCount=e.instanceCount,this}toJSON(){const e=super.toJSON();return e.instanceCount=this.instanceCount,e.isInstancedBufferGeometry=!0,e}}class pM extends Zs{constructor(e){super(e)}load(e,t,n,i){const s=this,o=new Qo(s.manager);o.setPath(s.path),o.setRequestHeader(s.requestHeader),o.setWithCredentials(s.withCredentials),o.load(e,function(r){try{t(s.parse(JSON.parse(r)))}catch(g){i?i(g):console.error(g),s.manager.itemError(e)}},n,i)}parse(e){const t={},n={};function i(p,y){if(t[y]!==void 0)return t[y];const G=p.interleavedBuffers[y],B=s(p,G.buffer),R=zd(G.type,B),x=new kf(R,G.stride);return x.uuid=G.uuid,t[y]=x,x}function s(p,y){if(n[y]!==void 0)return n[y];const G=p.arrayBuffers[y],B=new Uint32Array(G).buffer;return n[y]=B,B}const o=e.isInstancedBufferGeometry?new yZ:new rn,r=e.data.index;if(r!==void 0){const p=zd(r.type,r.array);o.setIndex(new En(p,1))}const g=e.data.attributes;for(const p in g){const y=g[p];let v;if(y.isInterleavedBufferAttribute){const G=i(e.data,y.data);v=new Zu(G,y.itemSize,y.offset,y.normalized)}else{const G=zd(y.type,y.array),B=y.isInstancedBufferAttribute?Su:En;v=new B(G,y.itemSize,y.normalized)}y.name!==void 0&&(v.name=y.name),y.usage!==void 0&&v.setUsage(y.usage),o.setAttribute(p,v)}const u=e.data.morphAttributes;if(u)for(const p in u){const y=u[p],v=[];for(let G=0,B=y.length;G<B;G++){const R=y[G];let x;if(R.isInterleavedBufferAttribute){const w=i(e.data,R.data);x=new Zu(w,R.itemSize,R.offset,R.normalized)}else{const w=zd(R.type,R.array);x=new En(w,R.itemSize,R.normalized)}R.name!==void 0&&(x.name=R.name),v.push(x)}o.morphAttributes[p]=v}e.data.morphTargetsRelative&&(o.morphTargetsRelative=!0);const h=e.data.groups||e.data.drawcalls||e.data.offsets;if(h!==void 0)for(let p=0,y=h.length;p!==y;++p){const v=h[p];o.addGroup(v.start,v.count,v.materialIndex)}const f=e.data.boundingSphere;return f!==void 0&&(o.boundingSphere=new Ra().fromJSON(f)),e.name&&(o.name=e.name),e.userData&&(o.userData=e.userData),o}}class R5 extends Zs{constructor(e){super(e)}load(e,t,n,i){const s=this,o=this.path===""?bu.extractUrlBase(e):this.path;this.resourcePath=this.resourcePath||o;const r=new Qo(this.manager);r.setPath(this.path),r.setRequestHeader(this.requestHeader),r.setWithCredentials(this.withCredentials),r.load(e,function(g){let u=null;try{u=JSON.parse(g)}catch(h){i!==void 0&&i(h),console.error("THREE:ObjectLoader: Can't parse "+e+".",h.message);return}const C=u.metadata;if(C===void 0||C.type===void 0||C.type.toLowerCase()==="geometry"){i!==void 0&&i(new Error("THREE.ObjectLoader: Can't load "+e)),console.error("THREE.ObjectLoader: Can't load "+e);return}s.parse(u,t)},n,i)}async loadAsync(e,t){const n=this,i=this.path===""?bu.extractUrlBase(e):this.path;this.resourcePath=this.resourcePath||i;const s=new Qo(this.manager);s.setPath(this.path),s.setRequestHeader(this.requestHeader),s.setWithCredentials(this.withCredentials);const o=await s.loadAsync(e,t),r=JSON.parse(o),g=r.metadata;if(g===void 0||g.type===void 0||g.type.toLowerCase()==="geometry")throw new Error("THREE.ObjectLoader: Can't load "+e);return await n.parseAsync(r)}parse(e,t){const n=this.parseAnimations(e.animations),i=this.parseShapes(e.shapes),s=this.parseGeometries(e.geometries,i),o=this.parseImages(e.images,function(){t!==void 0&&t(u)}),r=this.parseTextures(e.textures,o),g=this.parseMaterials(e.materials,r),u=this.parseObject(e.object,s,g,r,n),C=this.parseSkeletons(e.skeletons,u);if(this.bindSkeletons(u,C),this.bindLightTargets(u),t!==void 0){let h=!1;for(const f in o)if(o[f].data instanceof HTMLImageElement){h=!0;break}h===!1&&t(u)}return u}async parseAsync(e){const t=this.parseAnimations(e.animations),n=this.parseShapes(e.shapes),i=this.parseGeometries(e.geometries,n),s=await this.parseImagesAsync(e.images),o=this.parseTextures(e.textures,s),r=this.parseMaterials(e.materials,o),g=this.parseObject(e.object,i,r,o,t),u=this.parseSkeletons(e.skeletons,g);return this.bindSkeletons(g,u),this.bindLightTargets(g),g}parseShapes(e){const t={};if(e!==void 0)for(let n=0,i=e.length;n<i;n++){const s=new tC().fromJSON(e[n]);t[s.uuid]=s}return t}parseSkeletons(e,t){const n={},i={};if(t.traverse(function(s){s.isBone&&(i[s.uuid]=s)}),e!==void 0)for(let s=0,o=e.length;s<o;s++){const r=new Of().fromJSON(e[s],i);n[r.uuid]=r}return n}parseGeometries(e,t){const n={};if(e!==void 0){const i=new pM;for(let s=0,o=e.length;s<o;s++){let r;const g=e[s];switch(g.type){case"BufferGeometry":case"InstancedBufferGeometry":r=i.parse(g);break;default:g.type in LR?r=LR[g.type].fromJSON(g,t):console.warn(`THREE.ObjectLoader: Unsupported geometry type "${g.type}"`)}r.uuid=g.uuid,g.name!==void 0&&(r.name=g.name),g.userData!==void 0&&(r.userData=g.userData),n[g.uuid]=r}}return n}parseMaterials(e,t){const n={},i={};if(e!==void 0){const s=new zy;s.setTextures(t);for(let o=0,r=e.length;o<r;o++){const g=e[o];n[g.uuid]===void 0&&(n[g.uuid]=s.parse(g)),i[g.uuid]=n[g.uuid]}}return i}parseAnimations(e){const t={};if(e!==void 0)for(let n=0;n<e.length;n++){const i=e[n],s=lA.parse(i);t[s.uuid]=s}return t}parseImages(e,t){const n=this,i={};let s;function o(g){return n.manager.itemStart(g),s.load(g,function(){n.manager.itemEnd(g)},void 0,function(){n.manager.itemError(g),n.manager.itemEnd(g)})}function r(g){if(typeof g=="string"){const u=g,C=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(u)?u:n.resourcePath+u;return o(C)}else return g.data?{data:zd(g.type,g.data),width:g.width,height:g.height}:null}if(e!==void 0&&e.length>0){const g=new hZ(t);s=new Yf(g),s.setCrossOrigin(this.crossOrigin);for(let u=0,C=e.length;u<C;u++){const h=e[u],f=h.url;if(Array.isArray(f)){const p=[];for(let y=0,v=f.length;y<v;y++){const G=f[y],B=r(G);B!==null&&(B instanceof HTMLImageElement?p.push(B):p.push(new hg(B.data,B.width,B.height)))}i[h.uuid]=new mu(p)}else{const p=r(h.url);i[h.uuid]=new mu(p)}}}return i}async parseImagesAsync(e){const t=this,n={};let i;async function s(o){if(typeof o=="string"){const r=o,g=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(r)?r:t.resourcePath+r;return await i.loadAsync(g)}else return o.data?{data:zd(o.type,o.data),width:o.width,height:o.height}:null}if(e!==void 0&&e.length>0){i=new Yf(this.manager),i.setCrossOrigin(this.crossOrigin);for(let o=0,r=e.length;o<r;o++){const g=e[o],u=g.url;if(Array.isArray(u)){const C=[];for(let h=0,f=u.length;h<f;h++){const p=u[h],y=await s(p);y!==null&&(y instanceof HTMLImageElement?C.push(y):C.push(new hg(y.data,y.width,y.height)))}n[g.uuid]=new mu(C)}else{const C=await s(g.url);n[g.uuid]=new mu(C)}}}return n}parseTextures(e,t){function n(s,o){return typeof s=="number"?s:(console.warn("THREE.ObjectLoader.parseTexture: Constant should be in numeric form.",s),o[s])}const i={};if(e!==void 0)for(let s=0,o=e.length;s<o;s++){const r=e[s];r.image===void 0&&console.warn('THREE.ObjectLoader: No "image" specified for',r.uuid),t[r.image]===void 0&&console.warn("THREE.ObjectLoader: Undefined image",r.image);const g=t[r.image],u=g.data;let C;Array.isArray(u)?(C=new Df,u.length===6&&(C.needsUpdate=!0)):(u&&u.data?C=new hg:C=new Zi,u&&(C.needsUpdate=!0)),C.source=g,C.uuid=r.uuid,r.name!==void 0&&(C.name=r.name),r.mapping!==void 0&&(C.mapping=n(r.mapping,w5)),r.channel!==void 0&&(C.channel=r.channel),r.offset!==void 0&&C.offset.fromArray(r.offset),r.repeat!==void 0&&C.repeat.fromArray(r.repeat),r.center!==void 0&&C.center.fromArray(r.center),r.rotation!==void 0&&(C.rotation=r.rotation),r.wrap!==void 0&&(C.wrapS=n(r.wrap[0],kR),C.wrapT=n(r.wrap[1],kR)),r.format!==void 0&&(C.format=r.format),r.internalFormat!==void 0&&(C.internalFormat=r.internalFormat),r.type!==void 0&&(C.type=r.type),r.colorSpace!==void 0&&(C.colorSpace=r.colorSpace),r.minFilter!==void 0&&(C.minFilter=n(r.minFilter,OR)),r.magFilter!==void 0&&(C.magFilter=n(r.magFilter,OR)),r.anisotropy!==void 0&&(C.anisotropy=r.anisotropy),r.flipY!==void 0&&(C.flipY=r.flipY),r.generateMipmaps!==void 0&&(C.generateMipmaps=r.generateMipmaps),r.premultiplyAlpha!==void 0&&(C.premultiplyAlpha=r.premultiplyAlpha),r.unpackAlignment!==void 0&&(C.unpackAlignment=r.unpackAlignment),r.compareFunction!==void 0&&(C.compareFunction=r.compareFunction),r.userData!==void 0&&(C.userData=r.userData),i[r.uuid]=C}return i}parseObject(e,t,n,i,s){let o;function r(f){return t[f]===void 0&&console.warn("THREE.ObjectLoader: Undefined geometry",f),t[f]}function g(f){if(f!==void 0){if(Array.isArray(f)){const p=[];for(let y=0,v=f.length;y<v;y++){const G=f[y];n[G]===void 0&&console.warn("THREE.ObjectLoader: Undefined material",G),p.push(n[G])}return p}return n[f]===void 0&&console.warn("THREE.ObjectLoader: Undefined material",f),n[f]}}function u(f){return i[f]===void 0&&console.warn("THREE.ObjectLoader: Undefined texture",f),i[f]}let C,h;switch(e.type){case"Scene":o=new nZ,e.background!==void 0&&(Number.isInteger(e.background)?o.background=new Gt(e.background):o.background=u(e.background)),e.environment!==void 0&&(o.environment=u(e.environment)),e.fog!==void 0&&(e.fog.type==="Fog"?o.fog=new by(e.fog.color,e.fog.near,e.fog.far):e.fog.type==="FogExp2"&&(o.fog=new my(e.fog.color,e.fog.density)),e.fog.name!==""&&(o.fog.name=e.fog.name)),e.backgroundBlurriness!==void 0&&(o.backgroundBlurriness=e.backgroundBlurriness),e.backgroundIntensity!==void 0&&(o.backgroundIntensity=e.backgroundIntensity),e.backgroundRotation!==void 0&&o.backgroundRotation.fromArray(e.backgroundRotation),e.environmentIntensity!==void 0&&(o.environmentIntensity=e.environmentIntensity),e.environmentRotation!==void 0&&o.environmentRotation.fromArray(e.environmentRotation);break;case"PerspectiveCamera":o=new Xi(e.fov,e.aspect,e.near,e.far),e.focus!==void 0&&(o.focus=e.focus),e.zoom!==void 0&&(o.zoom=e.zoom),e.filmGauge!==void 0&&(o.filmGauge=e.filmGauge),e.filmOffset!==void 0&&(o.filmOffset=e.filmOffset),e.view!==void 0&&(o.view=Object.assign({},e.view));break;case"OrthographicCamera":o=new pr(e.left,e.right,e.top,e.bottom,e.near,e.far),e.zoom!==void 0&&(o.zoom=e.zoom),e.view!==void 0&&(o.view=Object.assign({},e.view));break;case"AmbientLight":o=new dM(e.color,e.intensity);break;case"DirectionalLight":o=new bZ(e.color,e.intensity),o.target=e.target||"";break;case"PointLight":o=new mZ(e.color,e.intensity,e.distance,e.decay);break;case"RectAreaLight":o=new AM(e.color,e.intensity,e.width,e.height);break;case"SpotLight":o=new pZ(e.color,e.intensity,e.distance,e.angle,e.penumbra,e.decay),o.target=e.target||"";break;case"HemisphereLight":o=new CM(e.color,e.groundColor,e.intensity);break;case"LightProbe":o=new fM().fromJSON(e);break;case"SkinnedMesh":C=r(e.geometry),h=g(e.material),o=new aZ(C,h),e.bindMode!==void 0&&(o.bindMode=e.bindMode),e.bindMatrix!==void 0&&o.bindMatrix.fromArray(e.bindMatrix),e.skeleton!==void 0&&(o.skeleton=e.skeleton);break;case"Mesh":C=r(e.geometry),h=g(e.material),o=new vi(C,h);break;case"InstancedMesh":C=r(e.geometry),h=g(e.material);const f=e.count,p=e.instanceMatrix,y=e.instanceColor;o=new eC(C,h,f),o.instanceMatrix=new Su(new Float32Array(p.array),16),y!==void 0&&(o.instanceColor=new Su(new Float32Array(y.array),y.itemSize));break;case"BatchedMesh":C=r(e.geometry),h=g(e.material),o=new EV(e.maxInstanceCount,e.maxVertexCount,e.maxIndexCount,h),o.geometry=C,o.perObjectFrustumCulled=e.perObjectFrustumCulled,o.sortObjects=e.sortObjects,o._drawRanges=e.drawRanges,o._reservedRanges=e.reservedRanges,o._geometryInfo=e.geometryInfo.map(v=>{let G=null,B=null;return v.boundingBox!==void 0&&(G=new Sa().fromJSON(v.boundingBox)),v.boundingSphere!==void 0&&(B=new Ra().fromJSON(v.boundingSphere)),{...v,boundingBox:G,boundingSphere:B}}),o._instanceInfo=e.instanceInfo,o._availableInstanceIds=e._availableInstanceIds,o._availableGeometryIds=e._availableGeometryIds,o._nextIndexStart=e.nextIndexStart,o._nextVertexStart=e.nextVertexStart,o._geometryCount=e.geometryCount,o._maxInstanceCount=e.maxInstanceCount,o._maxVertexCount=e.maxVertexCount,o._maxIndexCount=e.maxIndexCount,o._geometryInitialized=e.geometryInitialized,o._matricesTexture=u(e.matricesTexture.uuid),o._indirectTexture=u(e.indirectTexture.uuid),e.colorsTexture!==void 0&&(o._colorsTexture=u(e.colorsTexture.uuid)),e.boundingSphere!==void 0&&(o.boundingSphere=new Ra().fromJSON(e.boundingSphere)),e.boundingBox!==void 0&&(o.boundingBox=new Sa().fromJSON(e.boundingBox));break;case"LOD":o=new FV;break;case"Line":o=new pc(r(e.geometry),g(e.material));break;case"LineLoop":o=new sZ(r(e.geometry),g(e.material));break;case"LineSegments":o=new Gr(r(e.geometry),g(e.material));break;case"PointCloud":case"Points":o=new oZ(r(e.geometry),g(e.material));break;case"Sprite":o=new KV(g(e.material));break;case"Group":o=new dg;break;case"Bone":o=new yy;break;default:o=new wn}if(o.uuid=e.uuid,e.name!==void 0&&(o.name=e.name),e.matrix!==void 0?(o.matrix.fromArray(e.matrix),e.matrixAutoUpdate!==void 0&&(o.matrixAutoUpdate=e.matrixAutoUpdate),o.matrixAutoUpdate&&o.matrix.decompose(o.position,o.quaternion,o.scale)):(e.position!==void 0&&o.position.fromArray(e.position),e.rotation!==void 0&&o.rotation.fromArray(e.rotation),e.quaternion!==void 0&&o.quaternion.fromArray(e.quaternion),e.scale!==void 0&&o.scale.fromArray(e.scale)),e.up!==void 0&&o.up.fromArray(e.up),e.castShadow!==void 0&&(o.castShadow=e.castShadow),e.receiveShadow!==void 0&&(o.receiveShadow=e.receiveShadow),e.shadow&&(e.shadow.intensity!==void 0&&(o.shadow.intensity=e.shadow.intensity),e.shadow.bias!==void 0&&(o.shadow.bias=e.shadow.bias),e.shadow.normalBias!==void 0&&(o.shadow.normalBias=e.shadow.normalBias),e.shadow.radius!==void 0&&(o.shadow.radius=e.shadow.radius),e.shadow.mapSize!==void 0&&o.shadow.mapSize.fromArray(e.shadow.mapSize),e.shadow.camera!==void 0&&(o.shadow.camera=this.parseObject(e.shadow.camera))),e.visible!==void 0&&(o.visible=e.visible),e.frustumCulled!==void 0&&(o.frustumCulled=e.frustumCulled),e.renderOrder!==void 0&&(o.renderOrder=e.renderOrder),e.userData!==void 0&&(o.userData=e.userData),e.layers!==void 0&&(o.layers.mask=e.layers),e.children!==void 0){const f=e.children;for(let p=0;p<f.length;p++)o.add(this.parseObject(f[p],t,n,i,s))}if(e.animations!==void 0){const f=e.animations;for(let p=0;p<f.length;p++){const y=f[p];o.animations.push(s[y])}}if(e.type==="LOD"){e.autoUpdate!==void 0&&(o.autoUpdate=e.autoUpdate);const f=e.levels;for(let p=0;p<f.length;p++){const y=f[p],v=o.getObjectByProperty("uuid",y.object);v!==void 0&&o.addLevel(v,y.distance,y.hysteresis)}}return o}bindSkeletons(e,t){Object.keys(t).length!==0&&e.traverse(function(n){if(n.isSkinnedMesh===!0&&n.skeleton!==void 0){const i=t[n.skeleton];i===void 0?console.warn("THREE.ObjectLoader: No skeleton found with UUID:",n.skeleton):n.bind(i,n.bindMatrix)}})}bindLightTargets(e){e.traverse(function(t){if(t.isDirectionalLight||t.isSpotLight){const n=t.target,i=e.getObjectByProperty("uuid",n);i!==void 0?t.target=i:t.target=new wn}})}}const w5={UVMapping:oy,CubeReflectionMapping:hc,CubeRefractionMapping:Gu,EquirectangularReflectionMapping:Sf,EquirectangularRefractionMapping:Rf,CubeUVReflectionMapping:IA},kR={RepeatWrapping:Bu,ClampToEdgeWrapping:Jo,MirroredRepeatWrapping:Qd},OR={NearestFilter:Fa,NearestMipmapNearestFilter:ly,NearestMipmapLinearFilter:UI,LinearFilter:Bi,LinearMipmapNearestFilter:Ud,LinearMipmapLinearFilter:yl},GB=new WeakMap;class mM extends Zs{constructor(e){super(e),this.isImageBitmapLoader=!0,typeof createImageBitmap>"u"&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),typeof fetch>"u"&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),this.options={premultiplyAlpha:"none"}}setOptions(e){return this.options=e,this}load(e,t,n,i){e===void 0&&(e=""),this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);const s=this,o=lc.get(e);if(o!==void 0){if(s.manager.itemStart(e),o.then){o.then(u=>{if(GB.has(o)===!0)i&&i(GB.get(o)),s.manager.itemError(e),s.manager.itemEnd(e);else return t&&t(u),s.manager.itemEnd(e),u});return}return setTimeout(function(){t&&t(o),s.manager.itemEnd(e)},0),o}const r={};r.credentials=this.crossOrigin==="anonymous"?"same-origin":"include",r.headers=this.requestHeader;const g=fetch(e,r).then(function(u){return u.blob()}).then(function(u){return createImageBitmap(u,Object.assign(s.options,{colorSpaceConversion:"none"}))}).then(function(u){return lc.add(e,u),t&&t(u),s.manager.itemEnd(e),u}).catch(function(u){i&&i(u),GB.set(g,u),lc.remove(e),s.manager.itemError(e),s.manager.itemEnd(e)});lc.add(e,g),s.manager.itemStart(e)}}let cb;class GZ{static getContext(){return cb===void 0&&(cb=new(window.AudioContext||window.webkitAudioContext)),cb}static setContext(e){cb=e}}class x5 extends Zs{constructor(e){super(e)}load(e,t,n,i){const s=this,o=new Qo(this.manager);o.setResponseType("arraybuffer"),o.setPath(this.path),o.setRequestHeader(this.requestHeader),o.setWithCredentials(this.withCredentials),o.load(e,function(g){try{const u=g.slice(0);GZ.getContext().decodeAudioData(u,function(h){t(h)}).catch(r)}catch(u){r(u)}},n,i);function r(g){i?i(g):console.error(g),s.manager.itemError(e)}}}const JR=new Yt,PR=new Yt,SI=new Yt;class W5{constructor(){this.type="StereoCamera",this.aspect=1,this.eyeSep=.064,this.cameraL=new Xi,this.cameraL.layers.enable(1),this.cameraL.matrixAutoUpdate=!1,this.cameraR=new Xi,this.cameraR.layers.enable(2),this.cameraR.matrixAutoUpdate=!1,this._cache={focus:null,fov:null,aspect:null,near:null,far:null,zoom:null,eyeSep:null}}update(e){const t=this._cache;if(t.focus!==e.focus||t.fov!==e.fov||t.aspect!==e.aspect*this.aspect||t.near!==e.near||t.far!==e.far||t.zoom!==e.zoom||t.eyeSep!==this.eyeSep){t.focus=e.focus,t.fov=e.fov,t.aspect=e.aspect*this.aspect,t.near=e.near,t.far=e.far,t.zoom=e.zoom,t.eyeSep=this.eyeSep,SI.copy(e.projectionMatrix);const i=t.eyeSep/2,s=i*t.near/t.focus,o=t.near*Math.tan($I*t.fov*.5)/t.zoom;let r,g;PR.elements[12]=-i,JR.elements[12]=i,r=-o*t.aspect+s,g=o*t.aspect+s,SI.elements[0]=2*t.near/(g-r),SI.elements[8]=(g+r)/(g-r),this.cameraL.projectionMatrix.copy(SI),r=-o*t.aspect-s,g=o*t.aspect-s,SI.elements[0]=2*t.near/(g-r),SI.elements[8]=(g+r)/(g-r),this.cameraR.projectionMatrix.copy(SI)}this.cameraL.matrixWorld.copy(e.matrixWorld).multiply(PR),this.cameraR.matrixWorld.copy(e.matrixWorld).multiply(JR)}}class bM extends Xi{constructor(e=[]){super(),this.isArrayCamera=!0,this.isMultiViewCamera=!1,this.cameras=e}}class BZ{constructor(e=!0){this.autoStart=e,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}start(){this.startTime=QR(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}stop(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}getElapsedTime(){return this.getDelta(),this.elapsedTime}getDelta(){let e=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){const t=QR();e=(t-this.oldTime)/1e3,this.oldTime=t,this.elapsedTime+=e}return e}}function QR(){return performance.now()}const RI=new ae,BB=new ca,V5=new ae,wI=new ae,xI=new ae;class M5 extends wn{constructor(){super(),this.type="AudioListener",this.context=GZ.getContext(),this.gain=this.context.createGain(),this.gain.connect(this.context.destination),this.filter=null,this.timeDelta=0,this._clock=new BZ}getInput(){return this.gain}removeFilter(){return this.filter!==null&&(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination),this.gain.connect(this.context.destination),this.filter=null),this}getFilter(){return this.filter}setFilter(e){return this.filter!==null?(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination)):this.gain.disconnect(this.context.destination),this.filter=e,this.gain.connect(this.filter),this.filter.connect(this.context.destination),this}getMasterVolume(){return this.gain.gain.value}setMasterVolume(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this}updateMatrixWorld(e){super.updateMatrixWorld(e);const t=this.context.listener;if(this.timeDelta=this._clock.getDelta(),this.matrixWorld.decompose(RI,BB,V5),wI.set(0,0,-1).applyQuaternion(BB),xI.set(0,1,0).applyQuaternion(BB),t.positionX){const n=this.context.currentTime+this.timeDelta;t.positionX.linearRampToValueAtTime(RI.x,n),t.positionY.linearRampToValueAtTime(RI.y,n),t.positionZ.linearRampToValueAtTime(RI.z,n),t.forwardX.linearRampToValueAtTime(wI.x,n),t.forwardY.linearRampToValueAtTime(wI.y,n),t.forwardZ.linearRampToValueAtTime(wI.z,n),t.upX.linearRampToValueAtTime(xI.x,n),t.upY.linearRampToValueAtTime(xI.y,n),t.upZ.linearRampToValueAtTime(xI.z,n)}else t.setPosition(RI.x,RI.y,RI.z),t.setOrientation(wI.x,wI.y,wI.z,xI.x,xI.y,xI.z)}}class yM extends wn{constructor(e){super(),this.type="Audio",this.listener=e,this.context=e.context,this.gain=this.context.createGain(),this.gain.connect(e.getInput()),this.autoplay=!1,this.buffer=null,this.detune=0,this.loop=!1,this.loopStart=0,this.loopEnd=0,this.offset=0,this.duration=void 0,this.playbackRate=1,this.isPlaying=!1,this.hasPlaybackControl=!0,this.source=null,this.sourceType="empty",this._startedAt=0,this._progress=0,this._connected=!1,this.filters=[]}getOutput(){return this.gain}setNodeSource(e){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=e,this.connect(),this}setMediaElementSource(e){return this.hasPlaybackControl=!1,this.sourceType="mediaNode",this.source=this.context.createMediaElementSource(e),this.connect(),this}setMediaStreamSource(e){return this.hasPlaybackControl=!1,this.sourceType="mediaStreamNode",this.source=this.context.createMediaStreamSource(e),this.connect(),this}setBuffer(e){return this.buffer=e,this.sourceType="buffer",this.autoplay&&this.play(),this}play(e=0){if(this.isPlaying===!0){console.warn("THREE.Audio: Audio is already playing.");return}if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}this._startedAt=this.context.currentTime+e;const t=this.context.createBufferSource();return t.buffer=this.buffer,t.loop=this.loop,t.loopStart=this.loopStart,t.loopEnd=this.loopEnd,t.onended=this.onEnded.bind(this),t.start(this._startedAt,this._progress+this.offset,this.duration),this.isPlaying=!0,this.source=t,this.setDetune(this.detune),this.setPlaybackRate(this.playbackRate),this.connect()}pause(){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this.isPlaying===!0&&(this._progress+=Math.max(this.context.currentTime-this._startedAt,0)*this.playbackRate,this.loop===!0&&(this._progress=this._progress%(this.duration||this.buffer.duration)),this.source.stop(),this.source.onended=null,this.isPlaying=!1),this}stop(e=0){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this._progress=0,this.source!==null&&(this.source.stop(this.context.currentTime+e),this.source.onended=null),this.isPlaying=!1,this}connect(){if(this.filters.length>0){this.source.connect(this.filters[0]);for(let e=1,t=this.filters.length;e<t;e++)this.filters[e-1].connect(this.filters[e]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this._connected=!0,this}disconnect(){if(this._connected!==!1){if(this.filters.length>0){this.source.disconnect(this.filters[0]);for(let e=1,t=this.filters.length;e<t;e++)this.filters[e-1].disconnect(this.filters[e]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this._connected=!1,this}}getFilters(){return this.filters}setFilters(e){return e||(e=[]),this._connected===!0?(this.disconnect(),this.filters=e.slice(),this.connect()):this.filters=e.slice(),this}setDetune(e){return this.detune=e,this.isPlaying===!0&&this.source.detune!==void 0&&this.source.detune.setTargetAtTime(this.detune,this.context.currentTime,.01),this}getDetune(){return this.detune}getFilter(){return this.getFilters()[0]}setFilter(e){return this.setFilters(e?[e]:[])}setPlaybackRate(e){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this.playbackRate=e,this.isPlaying===!0&&this.source.playbackRate.setTargetAtTime(this.playbackRate,this.context.currentTime,.01),this}getPlaybackRate(){return this.playbackRate}onEnded(){this.isPlaying=!1,this._progress=0}getLoop(){return this.hasPlaybackControl===!1?(console.warn("THREE.Audio: this Audio has no playback control."),!1):this.loop}setLoop(e){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this.loop=e,this.isPlaying===!0&&(this.source.loop=this.loop),this}setLoopStart(e){return this.loopStart=e,this}setLoopEnd(e){return this.loopEnd=e,this}getVolume(){return this.gain.gain.value}setVolume(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this}copy(e,t){return super.copy(e,t),e.sourceType!=="buffer"?(console.warn("THREE.Audio: Audio source type cannot be copied."),this):(this.autoplay=e.autoplay,this.buffer=e.buffer,this.detune=e.detune,this.loop=e.loop,this.loopStart=e.loopStart,this.loopEnd=e.loopEnd,this.offset=e.offset,this.duration=e.duration,this.playbackRate=e.playbackRate,this.hasPlaybackControl=e.hasPlaybackControl,this.sourceType=e.sourceType,this.filters=e.filters.slice(),this)}clone(e){return new this.constructor(this.listener).copy(this,e)}}const WI=new ae,jR=new ca,H5=new ae,VI=new ae;class X5 extends yM{constructor(e){super(e),this.panner=this.context.createPanner(),this.panner.panningModel="HRTF",this.panner.connect(this.gain)}connect(){return super.connect(),this.panner.connect(this.gain),this}disconnect(){return super.disconnect(),this.panner.disconnect(this.gain),this}getOutput(){return this.panner}getRefDistance(){return this.panner.refDistance}setRefDistance(e){return this.panner.refDistance=e,this}getRolloffFactor(){return this.panner.rolloffFactor}setRolloffFactor(e){return this.panner.rolloffFactor=e,this}getDistanceModel(){return this.panner.distanceModel}setDistanceModel(e){return this.panner.distanceModel=e,this}getMaxDistance(){return this.panner.maxDistance}setMaxDistance(e){return this.panner.maxDistance=e,this}setDirectionalCone(e,t,n){return this.panner.coneInnerAngle=e,this.panner.coneOuterAngle=t,this.panner.coneOuterGain=n,this}updateMatrixWorld(e){if(super.updateMatrixWorld(e),this.hasPlaybackControl===!0&&this.isPlaying===!1)return;this.matrixWorld.decompose(WI,jR,H5),VI.set(0,0,1).applyQuaternion(jR);const t=this.panner;if(t.positionX){const n=this.context.currentTime+this.listener.timeDelta;t.positionX.linearRampToValueAtTime(WI.x,n),t.positionY.linearRampToValueAtTime(WI.y,n),t.positionZ.linearRampToValueAtTime(WI.z,n),t.orientationX.linearRampToValueAtTime(VI.x,n),t.orientationY.linearRampToValueAtTime(VI.y,n),t.orientationZ.linearRampToValueAtTime(VI.z,n)}else t.setPosition(WI.x,WI.y,WI.z),t.setOrientation(VI.x,VI.y,VI.z)}}class N5{constructor(e,t=2048){this.analyser=e.context.createAnalyser(),this.analyser.fftSize=t,this.data=new Uint8Array(this.analyser.frequencyBinCount),e.getOutput().connect(this.analyser)}getFrequencyData(){return this.analyser.getByteFrequencyData(this.data),this.data}getAverageFrequency(){let e=0;const t=this.getFrequencyData();for(let n=0;n<t.length;n++)e+=t[n];return e/t.length}}class GM{constructor(e,t,n){this.binding=e,this.valueSize=n;let i,s,o;switch(t){case"quaternion":i=this._slerp,s=this._slerpAdditive,o=this._setAdditiveIdentityQuaternion,this.buffer=new Float64Array(n*6),this._workIndex=5;break;case"string":case"bool":i=this._select,s=this._select,o=this._setAdditiveIdentityOther,this.buffer=new Array(n*5);break;default:i=this._lerp,s=this._lerpAdditive,o=this._setAdditiveIdentityNumeric,this.buffer=new Float64Array(n*5)}this._mixBufferRegion=i,this._mixBufferRegionAdditive=s,this._setIdentity=o,this._origIndex=3,this._addIndex=4,this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,this.useCount=0,this.referenceCount=0}accumulate(e,t){const n=this.buffer,i=this.valueSize,s=e*i+i;let o=this.cumulativeWeight;if(o===0){for(let r=0;r!==i;++r)n[s+r]=n[r];o=t}else{o+=t;const r=t/o;this._mixBufferRegion(n,s,0,r,i)}this.cumulativeWeight=o}accumulateAdditive(e){const t=this.buffer,n=this.valueSize,i=n*this._addIndex;this.cumulativeWeightAdditive===0&&this._setIdentity(),this._mixBufferRegionAdditive(t,i,0,e,n),this.cumulativeWeightAdditive+=e}apply(e){const t=this.valueSize,n=this.buffer,i=e*t+t,s=this.cumulativeWeight,o=this.cumulativeWeightAdditive,r=this.binding;if(this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,s<1){const g=t*this._origIndex;this._mixBufferRegion(n,i,g,1-s,t)}o>0&&this._mixBufferRegionAdditive(n,i,this._addIndex*t,1,t);for(let g=t,u=t+t;g!==u;++g)if(n[g]!==n[g+t]){r.setValue(n,i);break}}saveOriginalState(){const e=this.binding,t=this.buffer,n=this.valueSize,i=n*this._origIndex;e.getValue(t,i);for(let s=n,o=i;s!==o;++s)t[s]=t[i+s%n];this._setIdentity(),this.cumulativeWeight=0,this.cumulativeWeightAdditive=0}restoreOriginalState(){const e=this.valueSize*3;this.binding.setValue(this.buffer,e)}_setAdditiveIdentityNumeric(){const e=this._addIndex*this.valueSize,t=e+this.valueSize;for(let n=e;n<t;n++)this.buffer[n]=0}_setAdditiveIdentityQuaternion(){this._setAdditiveIdentityNumeric(),this.buffer[this._addIndex*this.valueSize+3]=1}_setAdditiveIdentityOther(){const e=this._origIndex*this.valueSize,t=this._addIndex*this.valueSize;for(let n=0;n<this.valueSize;n++)this.buffer[t+n]=this.buffer[e+n]}_select(e,t,n,i,s){if(i>=.5)for(let o=0;o!==s;++o)e[t+o]=e[n+o]}_slerp(e,t,n,i){ca.slerpFlat(e,t,e,t,e,n,i)}_slerpAdditive(e,t,n,i,s){const o=this._workIndex*s;ca.multiplyQuaternionsFlat(e,o,e,t,e,n),ca.slerpFlat(e,t,e,t,e,o,i)}_lerp(e,t,n,i,s){const o=1-i;for(let r=0;r!==s;++r){const g=t+r;e[g]=e[g]*o+e[n+r]*i}}_lerpAdditive(e,t,n,i,s){for(let o=0;o!==s;++o){const r=t+o;e[r]=e[r]+e[n+o]*i}}}const vZ="\\[\\]\\.:\\/",Y5=new RegExp("["+vZ+"]","g"),ZZ="[^"+vZ+"]",K5="[^"+vZ.replace("\\.","")+"]",F5=/((?:WC+[\/:])*)/.source.replace("WC",ZZ),E5=/(WCOD+)?/.source.replace("WCOD",K5),T5=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",ZZ),z5=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",ZZ),L5=new RegExp("^"+F5+E5+T5+z5+"$"),_5=["material","materials","bones","map"];class U5{constructor(e,t,n){const i=n||Yn.parseTrackName(t);this._targetGroup=e,this._bindings=e.subscribe_(t,i)}getValue(e,t){this.bind();const n=this._targetGroup.nCachedObjects_,i=this._bindings[n];i!==void 0&&i.getValue(e,t)}setValue(e,t){const n=this._bindings;for(let i=this._targetGroup.nCachedObjects_,s=n.length;i!==s;++i)n[i].setValue(e,t)}bind(){const e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,n=e.length;t!==n;++t)e[t].bind()}unbind(){const e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,n=e.length;t!==n;++t)e[t].unbind()}}class Yn{constructor(e,t,n){this.path=t,this.parsedPath=n||Yn.parseTrackName(t),this.node=Yn.findNode(e,this.parsedPath.nodeName),this.rootNode=e,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(e,t,n){return e&&e.isAnimationObjectGroup?new Yn.Composite(e,t,n):new Yn(e,t,n)}static sanitizeNodeName(e){return e.replace(/\s/g,"_").replace(Y5,"")}static parseTrackName(e){const t=L5.exec(e);if(t===null)throw new Error("PropertyBinding: Cannot parse trackName: "+e);const n={nodeName:t[2],objectName:t[3],objectIndex:t[4],propertyName:t[5],propertyIndex:t[6]},i=n.nodeName&&n.nodeName.lastIndexOf(".");if(i!==void 0&&i!==-1){const s=n.nodeName.substring(i+1);_5.indexOf(s)!==-1&&(n.nodeName=n.nodeName.substring(0,i),n.objectName=s)}if(n.propertyName===null||n.propertyName.length===0)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+e);return n}static findNode(e,t){if(t===void 0||t===""||t==="."||t===-1||t===e.name||t===e.uuid)return e;if(e.skeleton){const n=e.skeleton.getBoneByName(t);if(n!==void 0)return n}if(e.children){const n=function(s){for(let o=0;o<s.length;o++){const r=s[o];if(r.name===t||r.uuid===t)return r;const g=n(r.children);if(g)return g}return null},i=n(e.children);if(i)return i}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(e,t){e[t]=this.targetObject[this.propertyName]}_getValue_array(e,t){const n=this.resolvedProperty;for(let i=0,s=n.length;i!==s;++i)e[t++]=n[i]}_getValue_arrayElement(e,t){e[t]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(e,t){this.resolvedProperty.toArray(e,t)}_setValue_direct(e,t){this.targetObject[this.propertyName]=e[t]}_setValue_direct_setNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(e,t){const n=this.resolvedProperty;for(let i=0,s=n.length;i!==s;++i)n[i]=e[t++]}_setValue_array_setNeedsUpdate(e,t){const n=this.resolvedProperty;for(let i=0,s=n.length;i!==s;++i)n[i]=e[t++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(e,t){const n=this.resolvedProperty;for(let i=0,s=n.length;i!==s;++i)n[i]=e[t++];this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_arrayElement(e,t){this.resolvedProperty[this.propertyIndex]=e[t]}_setValue_arrayElement_setNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(e,t){this.resolvedProperty.fromArray(e,t)}_setValue_fromArray_setNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(e,t){this.bind(),this.getValue(e,t)}_setValue_unbound(e,t){this.bind(),this.setValue(e,t)}bind(){let e=this.node;const t=this.parsedPath,n=t.objectName,i=t.propertyName;let s=t.propertyIndex;if(e||(e=Yn.findNode(this.rootNode,t.nodeName),this.node=e),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!e){console.warn("THREE.PropertyBinding: No target node found for track: "+this.path+".");return}if(n){let u=t.objectIndex;switch(n){case"materials":if(!e.material){console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);return}if(!e.material.materials){console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);return}e=e.material.materials;break;case"bones":if(!e.skeleton){console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);return}e=e.skeleton.bones;for(let C=0;C<e.length;C++)if(e[C].name===u){u=C;break}break;case"map":if("map"in e){e=e.map;break}if(!e.material){console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);return}if(!e.material.map){console.error("THREE.PropertyBinding: Can not bind to material.map as node.material does not have a map.",this);return}e=e.material.map;break;default:if(e[n]===void 0){console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);return}e=e[n]}if(u!==void 0){if(e[u]===void 0){console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,e);return}e=e[u]}}const o=e[i];if(o===void 0){const u=t.nodeName;console.error("THREE.PropertyBinding: Trying to update property for track: "+u+"."+i+" but it wasn't found.",e);return}let r=this.Versioning.None;this.targetObject=e,e.isMaterial===!0?r=this.Versioning.NeedsUpdate:e.isObject3D===!0&&(r=this.Versioning.MatrixWorldNeedsUpdate);let g=this.BindingType.Direct;if(s!==void 0){if(i==="morphTargetInfluences"){if(!e.geometry){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);return}if(!e.geometry.morphAttributes){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);return}e.morphTargetDictionary[s]!==void 0&&(s=e.morphTargetDictionary[s])}g=this.BindingType.ArrayElement,this.resolvedProperty=o,this.propertyIndex=s}else o.fromArray!==void 0&&o.toArray!==void 0?(g=this.BindingType.HasFromToArray,this.resolvedProperty=o):Array.isArray(o)?(g=this.BindingType.EntireArray,this.resolvedProperty=o):this.propertyName=i;this.getValue=this.GetterByBindingType[g],this.setValue=this.SetterByBindingTypeAndVersioning[g][r]}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}Yn.Composite=U5;Yn.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3};Yn.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2};Yn.prototype.GetterByBindingType=[Yn.prototype._getValue_direct,Yn.prototype._getValue_array,Yn.prototype._getValue_arrayElement,Yn.prototype._getValue_toArray];Yn.prototype.SetterByBindingTypeAndVersioning=[[Yn.prototype._setValue_direct,Yn.prototype._setValue_direct_setNeedsUpdate,Yn.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[Yn.prototype._setValue_array,Yn.prototype._setValue_array_setNeedsUpdate,Yn.prototype._setValue_array_setMatrixWorldNeedsUpdate],[Yn.prototype._setValue_arrayElement,Yn.prototype._setValue_arrayElement_setNeedsUpdate,Yn.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[Yn.prototype._setValue_fromArray,Yn.prototype._setValue_fromArray_setNeedsUpdate,Yn.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]];class D5{constructor(){this.isAnimationObjectGroup=!0,this.uuid=Po(),this._objects=Array.prototype.slice.call(arguments),this.nCachedObjects_=0;const e={};this._indicesByUUID=e;for(let n=0,i=arguments.length;n!==i;++n)e[arguments[n].uuid]=n;this._paths=[],this._parsedPaths=[],this._bindings=[],this._bindingsIndicesByPath={};const t=this;this.stats={objects:{get total(){return t._objects.length},get inUse(){return this.total-t.nCachedObjects_}},get bindingsPerObject(){return t._bindings.length}}}add(){const e=this._objects,t=this._indicesByUUID,n=this._paths,i=this._parsedPaths,s=this._bindings,o=s.length;let r,g=e.length,u=this.nCachedObjects_;for(let C=0,h=arguments.length;C!==h;++C){const f=arguments[C],p=f.uuid;let y=t[p];if(y===void 0){y=g++,t[p]=y,e.push(f);for(let v=0,G=o;v!==G;++v)s[v].push(new Yn(f,n[v],i[v]))}else if(y<u){r=e[y];const v=--u,G=e[v];t[G.uuid]=y,e[y]=G,t[p]=v,e[v]=f;for(let B=0,R=o;B!==R;++B){const x=s[B],w=x[v];let M=x[y];x[y]=w,M===void 0&&(M=new Yn(f,n[B],i[B])),x[v]=M}}else e[y]!==r&&console.error("THREE.AnimationObjectGroup: Different objects with the same UUID detected. Clean the caches or recreate your infrastructure when reloading scenes.")}this.nCachedObjects_=u}remove(){const e=this._objects,t=this._indicesByUUID,n=this._bindings,i=n.length;let s=this.nCachedObjects_;for(let o=0,r=arguments.length;o!==r;++o){const g=arguments[o],u=g.uuid,C=t[u];if(C!==void 0&&C>=s){const h=s++,f=e[h];t[f.uuid]=C,e[C]=f,t[u]=h,e[h]=g;for(let p=0,y=i;p!==y;++p){const v=n[p],G=v[h],B=v[C];v[C]=G,v[h]=B}}}this.nCachedObjects_=s}uncache(){const e=this._objects,t=this._indicesByUUID,n=this._bindings,i=n.length;let s=this.nCachedObjects_,o=e.length;for(let r=0,g=arguments.length;r!==g;++r){const u=arguments[r],C=u.uuid,h=t[C];if(h!==void 0)if(delete t[C],h<s){const f=--s,p=e[f],y=--o,v=e[y];t[p.uuid]=h,e[h]=p,t[v.uuid]=f,e[f]=v,e.pop();for(let G=0,B=i;G!==B;++G){const R=n[G],x=R[f],w=R[y];R[h]=x,R[f]=w,R.pop()}}else{const f=--o,p=e[f];f>0&&(t[p.uuid]=h),e[h]=p,e.pop();for(let y=0,v=i;y!==v;++y){const G=n[y];G[h]=G[f],G.pop()}}}this.nCachedObjects_=s}subscribe_(e,t){const n=this._bindingsIndicesByPath;let i=n[e];const s=this._bindings;if(i!==void 0)return s[i];const o=this._paths,r=this._parsedPaths,g=this._objects,u=g.length,C=this.nCachedObjects_,h=new Array(u);i=s.length,n[e]=i,o.push(e),r.push(t),s.push(h);for(let f=C,p=g.length;f!==p;++f){const y=g[f];h[f]=new Yn(y,e,t)}return h}unsubscribe_(e){const t=this._bindingsIndicesByPath,n=t[e];if(n!==void 0){const i=this._paths,s=this._parsedPaths,o=this._bindings,r=o.length-1,g=o[r],u=e[r];t[u]=n,o[n]=g,o.pop(),s[n]=s[r],s.pop(),i[n]=i[r],i.pop()}}}class BM{constructor(e,t,n=null,i=t.blendMode){this._mixer=e,this._clip=t,this._localRoot=n,this.blendMode=i;const s=t.tracks,o=s.length,r=new Array(o),g={endingStart:DI,endingEnd:DI};for(let u=0;u!==o;++u){const C=s[u].createInterpolant(null);r[u]=C,C.settings=g}this._interpolantSettings=g,this._interpolants=r,this._propertyBindings=new Array(o),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=fV,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}play(){return this._mixer._activateAction(this),this}stop(){return this._mixer._deactivateAction(this),this.reset()}reset(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()}isRunning(){return this.enabled&&!this.paused&&this.timeScale!==0&&this._startTime===null&&this._mixer._isActiveAction(this)}isScheduled(){return this._mixer._isActiveAction(this)}startAt(e){return this._startTime=e,this}setLoop(e,t){return this.loop=e,this.repetitions=t,this}setEffectiveWeight(e){return this.weight=e,this._effectiveWeight=this.enabled?e:0,this.stopFading()}getEffectiveWeight(){return this._effectiveWeight}fadeIn(e){return this._scheduleFading(e,0,1)}fadeOut(e){return this._scheduleFading(e,1,0)}crossFadeFrom(e,t,n=!1){if(e.fadeOut(t),this.fadeIn(t),n===!0){const i=this._clip.duration,s=e._clip.duration,o=s/i,r=i/s;e.warp(1,o,t),this.warp(r,1,t)}return this}crossFadeTo(e,t,n=!1){return e.crossFadeFrom(this,t,n)}stopFading(){const e=this._weightInterpolant;return e!==null&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}setEffectiveTimeScale(e){return this.timeScale=e,this._effectiveTimeScale=this.paused?0:e,this.stopWarping()}getEffectiveTimeScale(){return this._effectiveTimeScale}setDuration(e){return this.timeScale=this._clip.duration/e,this.stopWarping()}syncWith(e){return this.time=e.time,this.timeScale=e.timeScale,this.stopWarping()}halt(e){return this.warp(this._effectiveTimeScale,0,e)}warp(e,t,n){const i=this._mixer,s=i.time,o=this.timeScale;let r=this._timeScaleInterpolant;r===null&&(r=i._lendControlInterpolant(),this._timeScaleInterpolant=r);const g=r.parameterPositions,u=r.sampleValues;return g[0]=s,g[1]=s+n,u[0]=e/o,u[1]=t/o,this}stopWarping(){const e=this._timeScaleInterpolant;return e!==null&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}getMixer(){return this._mixer}getClip(){return this._clip}getRoot(){return this._localRoot||this._mixer._root}_update(e,t,n,i){if(!this.enabled){this._updateWeight(e);return}const s=this._startTime;if(s!==null){const g=(e-s)*n;g<0||n===0?t=0:(this._startTime=null,t=n*g)}t*=this._updateTimeScale(e);const o=this._updateTime(t),r=this._updateWeight(e);if(r>0){const g=this._interpolants,u=this._propertyBindings;switch(this.blendMode){case J2:for(let C=0,h=g.length;C!==h;++C)g[C].evaluate(o),u[C].accumulateAdditive(r);break;case dy:default:for(let C=0,h=g.length;C!==h;++C)g[C].evaluate(o),u[C].accumulate(i,r)}}}_updateWeight(e){let t=0;if(this.enabled){t=this.weight;const n=this._weightInterpolant;if(n!==null){const i=n.evaluate(e)[0];t*=i,e>n.parameterPositions[1]&&(this.stopFading(),i===0&&(this.enabled=!1))}}return this._effectiveWeight=t,t}_updateTimeScale(e){let t=0;if(!this.paused){t=this.timeScale;const n=this._timeScaleInterpolant;if(n!==null){const i=n.evaluate(e)[0];t*=i,e>n.parameterPositions[1]&&(this.stopWarping(),t===0?this.paused=!0:this.timeScale=t)}}return this._effectiveTimeScale=t,t}_updateTime(e){const t=this._clip.duration,n=this.loop;let i=this.time+e,s=this._loopCount;const o=n===pV;if(e===0)return s===-1?i:o&&(s&1)===1?t-i:i;if(n===hV){s===-1&&(this._loopCount=0,this._setEndings(!0,!0,!1));e:{if(i>=t)i=t;else if(i<0)i=0;else{this.time=i;break e}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=i,this._mixer.dispatchEvent({type:"finished",action:this,direction:e<0?-1:1})}}else{if(s===-1&&(e>=0?(s=0,this._setEndings(!0,this.repetitions===0,o)):this._setEndings(this.repetitions===0,!0,o)),i>=t||i<0){const r=Math.floor(i/t);i-=t*r,s+=Math.abs(r);const g=this.repetitions-s;if(g<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,i=e>0?t:0,this.time=i,this._mixer.dispatchEvent({type:"finished",action:this,direction:e>0?1:-1});else{if(g===1){const u=e<0;this._setEndings(u,!u,o)}else this._setEndings(!1,!1,o);this._loopCount=s,this.time=i,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:r})}}else this.time=i;if(o&&(s&1)===1)return t-i}return i}_setEndings(e,t,n){const i=this._interpolantSettings;n?(i.endingStart=kI,i.endingEnd=kI):(e?i.endingStart=this.zeroSlopeAtStart?kI:DI:i.endingStart=wf,t?i.endingEnd=this.zeroSlopeAtEnd?kI:DI:i.endingEnd=wf)}_scheduleFading(e,t,n){const i=this._mixer,s=i.time;let o=this._weightInterpolant;o===null&&(o=i._lendControlInterpolant(),this._weightInterpolant=o);const r=o.parameterPositions,g=o.sampleValues;return r[0]=s,g[0]=t,r[1]=s+e,g[1]=n,this}}const k5=new Float32Array(1);class O5 extends bg{constructor(e){super(),this._root=e,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}_bindAction(e,t){const n=e._localRoot||this._root,i=e._clip.tracks,s=i.length,o=e._propertyBindings,r=e._interpolants,g=n.uuid,u=this._bindingsByRootAndName;let C=u[g];C===void 0&&(C={},u[g]=C);for(let h=0;h!==s;++h){const f=i[h],p=f.name;let y=C[p];if(y!==void 0)++y.referenceCount,o[h]=y;else{if(y=o[h],y!==void 0){y._cacheIndex===null&&(++y.referenceCount,this._addInactiveBinding(y,g,p));continue}const v=t&&t._propertyBindings[h].binding.parsedPath;y=new GM(Yn.create(n,p,v),f.ValueTypeName,f.getValueSize()),++y.referenceCount,this._addInactiveBinding(y,g,p),o[h]=y}r[h].resultBuffer=y.buffer}}_activateAction(e){if(!this._isActiveAction(e)){if(e._cacheIndex===null){const n=(e._localRoot||this._root).uuid,i=e._clip.uuid,s=this._actionsByClip[i];this._bindAction(e,s&&s.knownActions[0]),this._addInactiveAction(e,i,n)}const t=e._propertyBindings;for(let n=0,i=t.length;n!==i;++n){const s=t[n];s.useCount++===0&&(this._lendBinding(s),s.saveOriginalState())}this._lendAction(e)}}_deactivateAction(e){if(this._isActiveAction(e)){const t=e._propertyBindings;for(let n=0,i=t.length;n!==i;++n){const s=t[n];--s.useCount===0&&(s.restoreOriginalState(),this._takeBackBinding(s))}this._takeBackAction(e)}}_initMemoryManager(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;const e=this;this.stats={actions:{get total(){return e._actions.length},get inUse(){return e._nActiveActions}},bindings:{get total(){return e._bindings.length},get inUse(){return e._nActiveBindings}},controlInterpolants:{get total(){return e._controlInterpolants.length},get inUse(){return e._nActiveControlInterpolants}}}}_isActiveAction(e){const t=e._cacheIndex;return t!==null&&t<this._nActiveActions}_addInactiveAction(e,t,n){const i=this._actions,s=this._actionsByClip;let o=s[t];if(o===void 0)o={knownActions:[e],actionByRoot:{}},e._byClipCacheIndex=0,s[t]=o;else{const r=o.knownActions;e._byClipCacheIndex=r.length,r.push(e)}e._cacheIndex=i.length,i.push(e),o.actionByRoot[n]=e}_removeInactiveAction(e){const t=this._actions,n=t[t.length-1],i=e._cacheIndex;n._cacheIndex=i,t[i]=n,t.pop(),e._cacheIndex=null;const s=e._clip.uuid,o=this._actionsByClip,r=o[s],g=r.knownActions,u=g[g.length-1],C=e._byClipCacheIndex;u._byClipCacheIndex=C,g[C]=u,g.pop(),e._byClipCacheIndex=null;const h=r.actionByRoot,f=(e._localRoot||this._root).uuid;delete h[f],g.length===0&&delete o[s],this._removeInactiveBindingsForAction(e)}_removeInactiveBindingsForAction(e){const t=e._propertyBindings;for(let n=0,i=t.length;n!==i;++n){const s=t[n];--s.referenceCount===0&&this._removeInactiveBinding(s)}}_lendAction(e){const t=this._actions,n=e._cacheIndex,i=this._nActiveActions++,s=t[i];e._cacheIndex=i,t[i]=e,s._cacheIndex=n,t[n]=s}_takeBackAction(e){const t=this._actions,n=e._cacheIndex,i=--this._nActiveActions,s=t[i];e._cacheIndex=i,t[i]=e,s._cacheIndex=n,t[n]=s}_addInactiveBinding(e,t,n){const i=this._bindingsByRootAndName,s=this._bindings;let o=i[t];o===void 0&&(o={},i[t]=o),o[n]=e,e._cacheIndex=s.length,s.push(e)}_removeInactiveBinding(e){const t=this._bindings,n=e.binding,i=n.rootNode.uuid,s=n.path,o=this._bindingsByRootAndName,r=o[i],g=t[t.length-1],u=e._cacheIndex;g._cacheIndex=u,t[u]=g,t.pop(),delete r[s],Object.keys(r).length===0&&delete o[i]}_lendBinding(e){const t=this._bindings,n=e._cacheIndex,i=this._nActiveBindings++,s=t[i];e._cacheIndex=i,t[i]=e,s._cacheIndex=n,t[n]=s}_takeBackBinding(e){const t=this._bindings,n=e._cacheIndex,i=--this._nActiveBindings,s=t[i];e._cacheIndex=i,t[i]=e,s._cacheIndex=n,t[n]=s}_lendControlInterpolant(){const e=this._controlInterpolants,t=this._nActiveControlInterpolants++;let n=e[t];return n===void 0&&(n=new dZ(new Float32Array(2),new Float32Array(2),1,k5),n.__cacheIndex=t,e[t]=n),n}_takeBackControlInterpolant(e){const t=this._controlInterpolants,n=e.__cacheIndex,i=--this._nActiveControlInterpolants,s=t[i];e.__cacheIndex=i,t[i]=e,s.__cacheIndex=n,t[n]=s}clipAction(e,t,n){const i=t||this._root,s=i.uuid;let o=typeof e=="string"?lA.findByName(i,e):e;const r=o!==null?o.uuid:e,g=this._actionsByClip[r];let u=null;if(n===void 0&&(o!==null?n=o.blendMode:n=dy),g!==void 0){const h=g.actionByRoot[s];if(h!==void 0&&h.blendMode===n)return h;u=g.knownActions[0],o===null&&(o=u._clip)}if(o===null)return null;const C=new BM(this,o,t,n);return this._bindAction(C,u),this._addInactiveAction(C,r,s),C}existingAction(e,t){const n=t||this._root,i=n.uuid,s=typeof e=="string"?lA.findByName(n,e):e,o=s?s.uuid:e,r=this._actionsByClip[o];return r!==void 0&&r.actionByRoot[i]||null}stopAllAction(){const e=this._actions,t=this._nActiveActions;for(let n=t-1;n>=0;--n)e[n].stop();return this}update(e){e*=this.timeScale;const t=this._actions,n=this._nActiveActions,i=this.time+=e,s=Math.sign(e),o=this._accuIndex^=1;for(let u=0;u!==n;++u)t[u]._update(i,e,s,o);const r=this._bindings,g=this._nActiveBindings;for(let u=0;u!==g;++u)r[u].apply(o);return this}setTime(e){this.time=0;for(let t=0;t<this._actions.length;t++)this._actions[t].time=0;return this.update(e)}getRoot(){return this._root}uncacheClip(e){const t=this._actions,n=e.uuid,i=this._actionsByClip,s=i[n];if(s!==void 0){const o=s.knownActions;for(let r=0,g=o.length;r!==g;++r){const u=o[r];this._deactivateAction(u);const C=u._cacheIndex,h=t[t.length-1];u._cacheIndex=null,u._byClipCacheIndex=null,h._cacheIndex=C,t[C]=h,t.pop(),this._removeInactiveBindingsForAction(u)}delete i[n]}}uncacheRoot(e){const t=e.uuid,n=this._actionsByClip;for(const o in n){const r=n[o].actionByRoot,g=r[t];g!==void 0&&(this._deactivateAction(g),this._removeInactiveAction(g))}const i=this._bindingsByRootAndName,s=i[t];if(s!==void 0)for(const o in s){const r=s[o];r.restoreOriginalState(),this._removeInactiveBinding(r)}}uncacheAction(e,t){const n=this.existingAction(e,t);n!==null&&(this._deactivateAction(n),this._removeInactiveAction(n))}}class J5 extends $2{constructor(e=1,t=1,n=1,i={}){super(e,t,i),this.isRenderTarget3D=!0,this.depth=n,this.texture=new hy(null,e,t,n),this._setTextureOptions(i),this.texture.isRenderTargetTexture=!0}}class Ly{constructor(e){this.value=e}clone(){return new Ly(this.value.clone===void 0?this.value:this.value.clone())}}let P5=0;class Q5 extends bg{constructor(){super(),this.isUniformsGroup=!0,Object.defineProperty(this,"id",{value:P5++}),this.name="",this.usage=Wf,this.uniforms=[]}add(e){return this.uniforms.push(e),this}remove(e){const t=this.uniforms.indexOf(e);return t!==-1&&this.uniforms.splice(t,1),this}setName(e){return this.name=e,this}setUsage(e){return this.usage=e,this}dispose(){this.dispatchEvent({type:"dispose"})}copy(e){this.name=e.name,this.usage=e.usage;const t=e.uniforms;this.uniforms.length=0;for(let n=0,i=t.length;n<i;n++){const s=Array.isArray(t[n])?t[n]:[t[n]];for(let o=0;o<s.length;o++)this.uniforms.push(s[o].clone())}return this}clone(){return new this.constructor().copy(this)}}class j5 extends kf{constructor(e,t,n=1){super(e,t),this.isInstancedInterleavedBuffer=!0,this.meshPerAttribute=n}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}clone(e){const t=super.clone(e);return t.meshPerAttribute=this.meshPerAttribute,t}toJSON(e){const t=super.toJSON(e);return t.isInstancedInterleavedBuffer=!0,t.meshPerAttribute=this.meshPerAttribute,t}}class q5{constructor(e,t,n,i,s){this.isGLBufferAttribute=!0,this.name="",this.buffer=e,this.type=t,this.itemSize=n,this.elementSize=i,this.count=s,this.version=0}set needsUpdate(e){e===!0&&this.version++}setBuffer(e){return this.buffer=e,this}setType(e,t){return this.type=e,this.elementSize=t,this}setItemSize(e){return this.itemSize=e,this}setCount(e){return this.count=e,this}}const qR=new Yt;class vM{constructor(e,t,n=0,i=1/0){this.ray=new AC(e,t),this.near=n,this.far=i,this.camera=null,this.layers=new aA,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}}}set(e,t){this.ray.set(e,t)}setFromCamera(e,t){t.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(t.matrixWorld),this.ray.direction.set(e.x,e.y,.5).unproject(t).sub(this.ray.origin).normalize(),this.camera=t):t.isOrthographicCamera?(this.ray.origin.set(e.x,e.y,(t.near+t.far)/(t.near-t.far)).unproject(t),this.ray.direction.set(0,0,-1).transformDirection(t.matrixWorld),this.camera=t):console.error("THREE.Raycaster: Unsupported camera type: "+t.type)}setFromXRController(e){return qR.identity().extractRotation(e.matrixWorld),this.ray.origin.setFromMatrixPosition(e.matrixWorld),this.ray.direction.set(0,0,-1).applyMatrix4(qR),this}intersectObject(e,t=!0,n=[]){return Ov(e,this,n,t),n.sort($R),n}intersectObjects(e,t=!0,n=[]){for(let i=0,s=e.length;i<s;i++)Ov(e[i],this,n,t);return n.sort($R),n}}function $R(a,e){return a.distance-e.distance}function Ov(a,e,t,n){let i=!0;if(a.layers.test(e.layers)&&a.raycast(e,t)===!1&&(i=!1),i===!0&&n===!0){const s=a.children;for(let o=0,r=s.length;o<r;o++)Ov(s[o],e,t,!0)}}class Jv{constructor(e=1,t=0,n=0){this.radius=e,this.phi=t,this.theta=n}set(e,t,n){return this.radius=e,this.phi=t,this.theta=n,this}copy(e){return this.radius=e.radius,this.phi=e.phi,this.theta=e.theta,this}makeSafe(){return this.phi=ln(this.phi,1e-6,Math.PI-1e-6),this}setFromVector3(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}setFromCartesianCoords(e,t,n){return this.radius=Math.sqrt(e*e+t*t+n*n),this.radius===0?(this.theta=0,this.phi=0):(this.theta=Math.atan2(e,n),this.phi=Math.acos(ln(t/this.radius,-1,1))),this}clone(){return new this.constructor().copy(this)}}class $5{constructor(e=1,t=0,n=0){this.radius=e,this.theta=t,this.y=n}set(e,t,n){return this.radius=e,this.theta=t,this.y=n,this}copy(e){return this.radius=e.radius,this.theta=e.theta,this.y=e.y,this}setFromVector3(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}setFromCartesianCoords(e,t,n){return this.radius=Math.sqrt(e*e+n*n),this.theta=Math.atan2(e,n),this.y=t,this}clone(){return new this.constructor().copy(this)}}class SZ{constructor(e,t,n,i){SZ.prototype.isMatrix2=!0,this.elements=[1,0,0,1],e!==void 0&&this.set(e,t,n,i)}identity(){return this.set(1,0,0,1),this}fromArray(e,t=0){for(let n=0;n<4;n++)this.elements[n]=e[n+t];return this}set(e,t,n,i){const s=this.elements;return s[0]=e,s[2]=t,s[1]=n,s[3]=i,this}}const ew=new at;class eK{constructor(e=new at(1/0,1/0),t=new at(-1/0,-1/0)){this.isBox2=!0,this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromPoints(e){this.makeEmpty();for(let t=0,n=e.length;t<n;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){const n=ew.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(n),this.max.copy(e).add(n),this}clone(){return new this.constructor().copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y}getCenter(e){return this.isEmpty()?e.set(0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}containsPoint(e){return e.x>=this.min.x&&e.x<=this.max.x&&e.y>=this.min.y&&e.y<=this.max.y}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y}getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y))}intersectsBox(e){return e.max.x>=this.min.x&&e.min.x<=this.max.x&&e.max.y>=this.min.y&&e.min.y<=this.max.y}clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return this.clampPoint(e,ew).distanceTo(e)}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}const tw=new ae,ub=new ae;class tK{constructor(e=new ae,t=new ae){this.start=e,this.end=t}set(e,t){return this.start.copy(e),this.end.copy(t),this}copy(e){return this.start.copy(e.start),this.end.copy(e.end),this}getCenter(e){return e.addVectors(this.start,this.end).multiplyScalar(.5)}delta(e){return e.subVectors(this.end,this.start)}distanceSq(){return this.start.distanceToSquared(this.end)}distance(){return this.start.distanceTo(this.end)}at(e,t){return this.delta(t).multiplyScalar(e).add(this.start)}closestPointToPointParameter(e,t){tw.subVectors(e,this.start),ub.subVectors(this.end,this.start);const n=ub.dot(ub);let s=ub.dot(tw)/n;return t&&(s=ln(s,0,1)),s}closestPointToPoint(e,t,n){const i=this.closestPointToPointParameter(e,t);return this.delta(n).multiplyScalar(i).add(this.start)}applyMatrix4(e){return this.start.applyMatrix4(e),this.end.applyMatrix4(e),this}equals(e){return e.start.equals(this.start)&&e.end.equals(this.end)}clone(){return new this.constructor().copy(this)}}const nw=new ae;class nK extends wn{constructor(e,t){super(),this.light=e,this.matrixAutoUpdate=!1,this.color=t,this.type="SpotLightHelper";const n=new rn,i=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1];for(let o=0,r=1,g=32;o<g;o++,r++){const u=o/g*Math.PI*2,C=r/g*Math.PI*2;i.push(Math.cos(u),Math.sin(u),1,Math.cos(C),Math.sin(C),1)}n.setAttribute("position",new Ht(i,3));const s=new vs({fog:!1,toneMapped:!1});this.cone=new Gr(n,s),this.add(this.cone),this.update()}dispose(){this.cone.geometry.dispose(),this.cone.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.light.target.updateWorldMatrix(!0,!1),this.parent?(this.parent.updateWorldMatrix(!0),this.matrix.copy(this.parent.matrixWorld).invert().multiply(this.light.matrixWorld)):this.matrix.copy(this.light.matrixWorld),this.matrixWorld.copy(this.light.matrixWorld);const e=this.light.distance?this.light.distance:1e3,t=e*Math.tan(this.light.angle);this.cone.scale.set(t,t,e),nw.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(nw),this.color!==void 0?this.cone.material.color.set(this.color):this.cone.material.color.copy(this.light.color)}}const du=new ae,Ib=new Yt,vB=new Yt;class iK extends Gr{constructor(e){const t=ZM(e),n=new rn,i=[],s=[],o=new Gt(0,0,1),r=new Gt(0,1,0);for(let u=0;u<t.length;u++){const C=t[u];C.parent&&C.parent.isBone&&(i.push(0,0,0),i.push(0,0,0),s.push(o.r,o.g,o.b),s.push(r.r,r.g,r.b))}n.setAttribute("position",new Ht(i,3)),n.setAttribute("color",new Ht(s,3));const g=new vs({vertexColors:!0,depthTest:!1,depthWrite:!1,toneMapped:!1,transparent:!0});super(n,g),this.isSkeletonHelper=!0,this.type="SkeletonHelper",this.root=e,this.bones=t,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1}updateMatrixWorld(e){const t=this.bones,n=this.geometry,i=n.getAttribute("position");vB.copy(this.root.matrixWorld).invert();for(let s=0,o=0;s<t.length;s++){const r=t[s];r.parent&&r.parent.isBone&&(Ib.multiplyMatrices(vB,r.matrixWorld),du.setFromMatrixPosition(Ib),i.setXYZ(o,du.x,du.y,du.z),Ib.multiplyMatrices(vB,r.parent.matrixWorld),du.setFromMatrixPosition(Ib),i.setXYZ(o+1,du.x,du.y,du.z),o+=2)}n.getAttribute("position").needsUpdate=!0,super.updateMatrixWorld(e)}dispose(){this.geometry.dispose(),this.material.dispose()}}function ZM(a){const e=[];a.isBone===!0&&e.push(a);for(let t=0;t<a.children.length;t++)e.push(...ZM(a.children[t]));return e}class aK extends vi{constructor(e,t,n){const i=new jf(t,4,2),s=new wo({wireframe:!0,fog:!1,toneMapped:!1});super(i,s),this.light=e,this.color=n,this.type="PointLightHelper",this.matrix=this.light.matrixWorld,this.matrixAutoUpdate=!1,this.update()}dispose(){this.geometry.dispose(),this.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.color!==void 0?this.material.color.set(this.color):this.material.color.copy(this.light.color)}}const sK=new ae,iw=new Gt,aw=new Gt;class oK extends wn{constructor(e,t,n){super(),this.light=e,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=n,this.type="HemisphereLightHelper";const i=new Qf(t);i.rotateY(Math.PI*.5),this.material=new wo({wireframe:!0,fog:!1,toneMapped:!1}),this.color===void 0&&(this.material.vertexColors=!0);const s=i.getAttribute("position"),o=new Float32Array(s.count*3);i.setAttribute("color",new En(o,3)),this.add(new vi(i,this.material)),this.update()}dispose(){this.children[0].geometry.dispose(),this.children[0].material.dispose()}update(){const e=this.children[0];if(this.color!==void 0)this.material.color.set(this.color);else{const t=e.geometry.getAttribute("color");iw.copy(this.light.color),aw.copy(this.light.groundColor);for(let n=0,i=t.count;n<i;n++){const s=n<i/2?iw:aw;t.setXYZ(n,s.r,s.g,s.b)}t.needsUpdate=!0}this.light.updateWorldMatrix(!0,!1),e.lookAt(sK.setFromMatrixPosition(this.light.matrixWorld).negate())}}class lK extends Gr{constructor(e=10,t=10,n=4473924,i=8947848){n=new Gt(n),i=new Gt(i);const s=t/2,o=e/t,r=e/2,g=[],u=[];for(let f=0,p=0,y=-r;f<=t;f++,y+=o){g.push(-r,0,y,r,0,y),g.push(y,0,-r,y,0,r);const v=f===s?n:i;v.toArray(u,p),p+=3,v.toArray(u,p),p+=3,v.toArray(u,p),p+=3,v.toArray(u,p),p+=3}const C=new rn;C.setAttribute("position",new Ht(g,3)),C.setAttribute("color",new Ht(u,3));const h=new vs({vertexColors:!0,toneMapped:!1});super(C,h),this.type="GridHelper"}dispose(){this.geometry.dispose(),this.material.dispose()}}class rK extends Gr{constructor(e=10,t=16,n=8,i=64,s=4473924,o=8947848){s=new Gt(s),o=new Gt(o);const r=[],g=[];if(t>1)for(let h=0;h<t;h++){const f=h/t*(Math.PI*2),p=Math.sin(f)*e,y=Math.cos(f)*e;r.push(0,0,0),r.push(p,0,y);const v=h&1?s:o;g.push(v.r,v.g,v.b),g.push(v.r,v.g,v.b)}for(let h=0;h<n;h++){const f=h&1?s:o,p=e-e/n*h;for(let y=0;y<i;y++){let v=y/i*(Math.PI*2),G=Math.sin(v)*p,B=Math.cos(v)*p;r.push(G,0,B),g.push(f.r,f.g,f.b),v=(y+1)/i*(Math.PI*2),G=Math.sin(v)*p,B=Math.cos(v)*p,r.push(G,0,B),g.push(f.r,f.g,f.b)}}const u=new rn;u.setAttribute("position",new Ht(r,3)),u.setAttribute("color",new Ht(g,3));const C=new vs({vertexColors:!0,toneMapped:!1});super(u,C),this.type="PolarGridHelper"}dispose(){this.geometry.dispose(),this.material.dispose()}}const sw=new ae,Cb=new ae,ow=new ae;class gK extends wn{constructor(e,t,n){super(),this.light=e,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=n,this.type="DirectionalLightHelper",t===void 0&&(t=1);let i=new rn;i.setAttribute("position",new Ht([-t,t,0,t,t,0,t,-t,0,-t,-t,0,-t,t,0],3));const s=new vs({fog:!1,toneMapped:!1});this.lightPlane=new pc(i,s),this.add(this.lightPlane),i=new rn,i.setAttribute("position",new Ht([0,0,0,0,0,1],3)),this.targetLine=new pc(i,s),this.add(this.targetLine),this.update()}dispose(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.light.target.updateWorldMatrix(!0,!1),sw.setFromMatrixPosition(this.light.matrixWorld),Cb.setFromMatrixPosition(this.light.target.matrixWorld),ow.subVectors(Cb,sw),this.lightPlane.lookAt(Cb),this.color!==void 0?(this.lightPlane.material.color.set(this.color),this.targetLine.material.color.set(this.color)):(this.lightPlane.material.color.copy(this.light.color),this.targetLine.material.color.copy(this.light.color)),this.targetLine.lookAt(Cb),this.targetLine.scale.z=ow.length()}}const db=new ae,ea=new py;class cK extends Gr{constructor(e){const t=new rn,n=new vs({color:16777215,vertexColors:!0,toneMapped:!1}),i=[],s=[],o={};r("n1","n2"),r("n2","n4"),r("n4","n3"),r("n3","n1"),r("f1","f2"),r("f2","f4"),r("f4","f3"),r("f3","f1"),r("n1","f1"),r("n2","f2"),r("n3","f3"),r("n4","f4"),r("p","n1"),r("p","n2"),r("p","n3"),r("p","n4"),r("u1","u2"),r("u2","u3"),r("u3","u1"),r("c","t"),r("p","c"),r("cn1","cn2"),r("cn3","cn4"),r("cf1","cf2"),r("cf3","cf4");function r(y,v){g(y),g(v)}function g(y){i.push(0,0,0),s.push(0,0,0),o[y]===void 0&&(o[y]=[]),o[y].push(i.length/3-1)}t.setAttribute("position",new Ht(i,3)),t.setAttribute("color",new Ht(s,3)),super(t,n),this.type="CameraHelper",this.camera=e,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=o,this.update();const u=new Gt(16755200),C=new Gt(16711680),h=new Gt(43775),f=new Gt(16777215),p=new Gt(3355443);this.setColors(u,C,h,f,p)}setColors(e,t,n,i,s){const r=this.geometry.getAttribute("color");r.setXYZ(0,e.r,e.g,e.b),r.setXYZ(1,e.r,e.g,e.b),r.setXYZ(2,e.r,e.g,e.b),r.setXYZ(3,e.r,e.g,e.b),r.setXYZ(4,e.r,e.g,e.b),r.setXYZ(5,e.r,e.g,e.b),r.setXYZ(6,e.r,e.g,e.b),r.setXYZ(7,e.r,e.g,e.b),r.setXYZ(8,e.r,e.g,e.b),r.setXYZ(9,e.r,e.g,e.b),r.setXYZ(10,e.r,e.g,e.b),r.setXYZ(11,e.r,e.g,e.b),r.setXYZ(12,e.r,e.g,e.b),r.setXYZ(13,e.r,e.g,e.b),r.setXYZ(14,e.r,e.g,e.b),r.setXYZ(15,e.r,e.g,e.b),r.setXYZ(16,e.r,e.g,e.b),r.setXYZ(17,e.r,e.g,e.b),r.setXYZ(18,e.r,e.g,e.b),r.setXYZ(19,e.r,e.g,e.b),r.setXYZ(20,e.r,e.g,e.b),r.setXYZ(21,e.r,e.g,e.b),r.setXYZ(22,e.r,e.g,e.b),r.setXYZ(23,e.r,e.g,e.b),r.setXYZ(24,t.r,t.g,t.b),r.setXYZ(25,t.r,t.g,t.b),r.setXYZ(26,t.r,t.g,t.b),r.setXYZ(27,t.r,t.g,t.b),r.setXYZ(28,t.r,t.g,t.b),r.setXYZ(29,t.r,t.g,t.b),r.setXYZ(30,t.r,t.g,t.b),r.setXYZ(31,t.r,t.g,t.b),r.setXYZ(32,n.r,n.g,n.b),r.setXYZ(33,n.r,n.g,n.b),r.setXYZ(34,n.r,n.g,n.b),r.setXYZ(35,n.r,n.g,n.b),r.setXYZ(36,n.r,n.g,n.b),r.setXYZ(37,n.r,n.g,n.b),r.setXYZ(38,i.r,i.g,i.b),r.setXYZ(39,i.r,i.g,i.b),r.setXYZ(40,s.r,s.g,s.b),r.setXYZ(41,s.r,s.g,s.b),r.setXYZ(42,s.r,s.g,s.b),r.setXYZ(43,s.r,s.g,s.b),r.setXYZ(44,s.r,s.g,s.b),r.setXYZ(45,s.r,s.g,s.b),r.setXYZ(46,s.r,s.g,s.b),r.setXYZ(47,s.r,s.g,s.b),r.setXYZ(48,s.r,s.g,s.b),r.setXYZ(49,s.r,s.g,s.b),r.needsUpdate=!0}update(){const e=this.geometry,t=this.pointMap,n=1,i=1;ea.projectionMatrixInverse.copy(this.camera.projectionMatrixInverse);const s=this.camera.coordinateSystem===Gl?-1:0;ga("c",t,e,ea,0,0,s),ga("t",t,e,ea,0,0,1),ga("n1",t,e,ea,-1,-1,s),ga("n2",t,e,ea,n,-1,s),ga("n3",t,e,ea,-1,i,s),ga("n4",t,e,ea,n,i,s),ga("f1",t,e,ea,-1,-1,1),ga("f2",t,e,ea,n,-1,1),ga("f3",t,e,ea,-1,i,1),ga("f4",t,e,ea,n,i,1),ga("u1",t,e,ea,n*.7,i*1.1,s),ga("u2",t,e,ea,-1*.7,i*1.1,s),ga("u3",t,e,ea,0,i*2,s),ga("cf1",t,e,ea,-1,0,1),ga("cf2",t,e,ea,n,0,1),ga("cf3",t,e,ea,0,-1,1),ga("cf4",t,e,ea,0,i,1),ga("cn1",t,e,ea,-1,0,s),ga("cn2",t,e,ea,n,0,s),ga("cn3",t,e,ea,0,-1,s),ga("cn4",t,e,ea,0,i,s),e.getAttribute("position").needsUpdate=!0}dispose(){this.geometry.dispose(),this.material.dispose()}}function ga(a,e,t,n,i,s,o){db.set(i,s,o).unproject(n);const r=e[a];if(r!==void 0){const g=t.getAttribute("position");for(let u=0,C=r.length;u<C;u++)g.setXYZ(r[u],db.x,db.y,db.z)}}const Ab=new Sa;class uK extends Gr{constructor(e,t=16776960){const n=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),i=new Float32Array(8*3),s=new rn;s.setIndex(new En(n,1)),s.setAttribute("position",new En(i,3)),super(s,new vs({color:t,toneMapped:!1})),this.object=e,this.type="BoxHelper",this.matrixAutoUpdate=!1,this.update()}update(){if(this.object!==void 0&&Ab.setFromObject(this.object),Ab.isEmpty())return;const e=Ab.min,t=Ab.max,n=this.geometry.attributes.position,i=n.array;i[0]=t.x,i[1]=t.y,i[2]=t.z,i[3]=e.x,i[4]=t.y,i[5]=t.z,i[6]=e.x,i[7]=e.y,i[8]=t.z,i[9]=t.x,i[10]=e.y,i[11]=t.z,i[12]=t.x,i[13]=t.y,i[14]=e.z,i[15]=e.x,i[16]=t.y,i[17]=e.z,i[18]=e.x,i[19]=e.y,i[20]=e.z,i[21]=t.x,i[22]=e.y,i[23]=e.z,n.needsUpdate=!0,this.geometry.computeBoundingSphere()}setFromObject(e){return this.object=e,this.update(),this}copy(e,t){return super.copy(e,t),this.object=e.object,this}dispose(){this.geometry.dispose(),this.material.dispose()}}class IK extends Gr{constructor(e,t=16776960){const n=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),i=[1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1],s=new rn;s.setIndex(new En(n,1)),s.setAttribute("position",new Ht(i,3)),super(s,new vs({color:t,toneMapped:!1})),this.box=e,this.type="Box3Helper",this.geometry.computeBoundingSphere()}updateMatrixWorld(e){const t=this.box;t.isEmpty()||(t.getCenter(this.position),t.getSize(this.scale),this.scale.multiplyScalar(.5),super.updateMatrixWorld(e))}dispose(){this.geometry.dispose(),this.material.dispose()}}class CK extends pc{constructor(e,t=1,n=16776960){const i=n,s=[1,-1,0,-1,1,0,-1,-1,0,1,1,0,-1,1,0,-1,-1,0,1,-1,0,1,1,0],o=new rn;o.setAttribute("position",new Ht(s,3)),o.computeBoundingSphere(),super(o,new vs({color:i,toneMapped:!1})),this.type="PlaneHelper",this.plane=e,this.size=t;const r=[1,1,0,-1,1,0,-1,-1,0,1,1,0,-1,-1,0,1,-1,0],g=new rn;g.setAttribute("position",new Ht(r,3)),g.computeBoundingSphere(),this.add(new vi(g,new wo({color:i,opacity:.2,transparent:!0,depthWrite:!1,toneMapped:!1})))}updateMatrixWorld(e){this.position.set(0,0,0),this.scale.set(.5*this.size,.5*this.size,1),this.lookAt(this.plane.normal),this.translateZ(-this.plane.constant),super.updateMatrixWorld(e)}dispose(){this.geometry.dispose(),this.material.dispose(),this.children[0].geometry.dispose(),this.children[0].material.dispose()}}const lw=new ae;let hb,ZB;class dK extends wn{constructor(e=new ae(0,0,1),t=new ae(0,0,0),n=1,i=16776960,s=n*.2,o=s*.2){super(),this.type="ArrowHelper",hb===void 0&&(hb=new rn,hb.setAttribute("position",new Ht([0,0,0,0,1,0],3)),ZB=new Pf(.5,1,5,1),ZB.translate(0,-.5,0)),this.position.copy(t),this.line=new pc(hb,new vs({color:i,toneMapped:!1})),this.line.matrixAutoUpdate=!1,this.add(this.line),this.cone=new vi(ZB,new wo({color:i,toneMapped:!1})),this.cone.matrixAutoUpdate=!1,this.add(this.cone),this.setDirection(e),this.setLength(n,s,o)}setDirection(e){if(e.y>.99999)this.quaternion.set(0,0,0,1);else if(e.y<-.99999)this.quaternion.set(1,0,0,0);else{lw.set(e.z,0,-e.x).normalize();const t=Math.acos(e.y);this.quaternion.setFromAxisAngle(lw,t)}}setLength(e,t=e*.2,n=t*.2){this.line.scale.set(1,Math.max(1e-4,e-t),1),this.line.updateMatrix(),this.cone.scale.set(n,t,n),this.cone.position.y=e,this.cone.updateMatrix()}setColor(e){this.line.material.color.set(e),this.cone.material.color.set(e)}copy(e){return super.copy(e,!1),this.line.copy(e.line),this.cone.copy(e.cone),this}dispose(){this.line.geometry.dispose(),this.line.material.dispose(),this.cone.geometry.dispose(),this.cone.material.dispose()}}class AK extends Gr{constructor(e=1){const t=[0,0,0,e,0,0,0,0,0,0,e,0,0,0,0,0,0,e],n=[1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],i=new rn;i.setAttribute("position",new Ht(t,3)),i.setAttribute("color",new Ht(n,3));const s=new vs({vertexColors:!0,toneMapped:!1});super(i,s),this.type="AxesHelper"}setColors(e,t,n){const i=new Gt,s=this.geometry.attributes.color.array;return i.set(e),i.toArray(s,0),i.toArray(s,3),i.set(t),i.toArray(s,6),i.toArray(s,9),i.set(n),i.toArray(s,12),i.toArray(s,15),this.geometry.attributes.color.needsUpdate=!0,this}dispose(){this.geometry.dispose(),this.material.dispose()}}class hK{constructor(){this.type="ShapePath",this.color=new Gt,this.subPaths=[],this.currentPath=null}moveTo(e,t){return this.currentPath=new K0,this.subPaths.push(this.currentPath),this.currentPath.moveTo(e,t),this}lineTo(e,t){return this.currentPath.lineTo(e,t),this}quadraticCurveTo(e,t,n,i){return this.currentPath.quadraticCurveTo(e,t,n,i),this}bezierCurveTo(e,t,n,i,s,o){return this.currentPath.bezierCurveTo(e,t,n,i,s,o),this}splineThru(e){return this.currentPath.splineThru(e),this}toShapes(e){function t(B){const R=[];for(let x=0,w=B.length;x<w;x++){const M=B[x],H=new tC;H.curves=M.curves,R.push(H)}return R}function n(B,R){const x=R.length;let w=!1;for(let M=x-1,H=0;H<x;M=H++){let N=R[M],F=R[H],Y=F.x-N.x,X=F.y-N.y;if(Math.abs(X)>Number.EPSILON){if(X<0&&(N=R[H],Y=-Y,F=R[M],X=-X),B.y<N.y||B.y>F.y)continue;if(B.y===N.y){if(B.x===N.x)return!0}else{const U=X*(B.x-N.x)-Y*(B.y-N.y);if(U===0)return!0;if(U<0)continue;w=!w}}else{if(B.y!==N.y)continue;if(F.x<=B.x&&B.x<=N.x||N.x<=B.x&&B.x<=F.x)return!0}}return w}const i=fr.isClockWise,s=this.subPaths;if(s.length===0)return[];let o,r,g;const u=[];if(s.length===1)return r=s[0],g=new tC,g.curves=r.curves,u.push(g),u;let C=!i(s[0].getPoints());C=e?!C:C;const h=[],f=[];let p=[],y=0,v;f[y]=void 0,p[y]=[];for(let B=0,R=s.length;B<R;B++)r=s[B],v=r.getPoints(),o=i(v),o=e?!o:o,o?(!C&&f[y]&&y++,f[y]={s:new tC,p:v},f[y].s.curves=r.curves,C&&y++,p[y]=[]):p[y].push({h:r,p:v[0]});if(!f[0])return t(s);if(f.length>1){let B=!1,R=0;for(let x=0,w=f.length;x<w;x++)h[x]=[];for(let x=0,w=f.length;x<w;x++){const M=p[x];for(let H=0;H<M.length;H++){const N=M[H];let F=!0;for(let Y=0;Y<f.length;Y++)n(N.p,f[Y].p)&&(x!==Y&&R++,F?(F=!1,h[Y].push(N)):B=!0);F&&h[x].push(N)}}R>0&&B===!1&&(p=h)}let G;for(let B=0,R=f.length;B<R;B++){g=f[B].s,u.push(g),G=p[B];for(let x=0,w=G.length;x<w;x++)g.holes.push(G[x].h)}return u}}class fK extends bg{constructor(e,t=null){super(),this.object=e,this.domElement=t,this.enabled=!0,this.state=-1,this.keys={},this.mouseButtons={LEFT:null,MIDDLE:null,RIGHT:null},this.touches={ONE:null,TWO:null}}connect(e){if(e===void 0){console.warn("THREE.Controls: connect() now requires an element.");return}this.domElement!==null&&this.disconnect(),this.domElement=e}disconnect(){}dispose(){}update(){}}function pK(a,e){const t=a.image&&a.image.width?a.image.width/a.image.height:1;return t>e?(a.repeat.x=1,a.repeat.y=t/e,a.offset.x=0,a.offset.y=(1-a.repeat.y)/2):(a.repeat.x=e/t,a.repeat.y=1,a.offset.x=(1-a.repeat.x)/2,a.offset.y=0),a}function mK(a,e){const t=a.image&&a.image.width?a.image.width/a.image.height:1;return t>e?(a.repeat.x=e/t,a.repeat.y=1,a.offset.x=(1-a.repeat.x)/2,a.offset.y=0):(a.repeat.x=1,a.repeat.y=t/e,a.offset.x=0,a.offset.y=(1-a.repeat.y)/2),a}function bK(a){return a.repeat.x=1,a.repeat.y=1,a.offset.x=0,a.offset.y=0,a}function Pv(a,e,t,n){const i=yK(n);switch(t){case U2:return a*e;case uy:return a*e/i.components*i.byteLength;case Uf:return a*e/i.components*i.byteLength;case k2:return a*e*2/i.components*i.byteLength;case Iy:return a*e*2/i.components*i.byteLength;case D2:return a*e*3/i.components*i.byteLength;case Gs:return a*e*4/i.components*i.byteLength;case Cy:return a*e*4/i.components*i.byteLength;case uf:case If:return Math.floor((a+3)/4)*Math.floor((e+3)/4)*8;case Cf:case df:return Math.floor((a+3)/4)*Math.floor((e+3)/4)*16;case l0:case g0:return Math.max(a,16)*Math.max(e,8)/4;case o0:case r0:return Math.max(a,8)*Math.max(e,8)/2;case c0:case u0:return Math.floor((a+3)/4)*Math.floor((e+3)/4)*8;case I0:return Math.floor((a+3)/4)*Math.floor((e+3)/4)*16;case C0:return Math.floor((a+3)/4)*Math.floor((e+3)/4)*16;case d0:return Math.floor((a+4)/5)*Math.floor((e+3)/4)*16;case A0:return Math.floor((a+4)/5)*Math.floor((e+4)/5)*16;case h0:return Math.floor((a+5)/6)*Math.floor((e+4)/5)*16;case f0:return Math.floor((a+5)/6)*Math.floor((e+5)/6)*16;case p0:return Math.floor((a+7)/8)*Math.floor((e+4)/5)*16;case m0:return Math.floor((a+7)/8)*Math.floor((e+5)/6)*16;case b0:return Math.floor((a+7)/8)*Math.floor((e+7)/8)*16;case y0:return Math.floor((a+9)/10)*Math.floor((e+4)/5)*16;case G0:return Math.floor((a+9)/10)*Math.floor((e+5)/6)*16;case B0:return Math.floor((a+9)/10)*Math.floor((e+7)/8)*16;case v0:return Math.floor((a+9)/10)*Math.floor((e+9)/10)*16;case Z0:return Math.floor((a+11)/12)*Math.floor((e+9)/10)*16;case S0:return Math.floor((a+11)/12)*Math.floor((e+11)/12)*16;case Af:case R0:case w0:return Math.ceil(a/4)*Math.ceil(e/4)*16;case O2:case x0:return Math.ceil(a/4)*Math.ceil(e/4)*8;case W0:case V0:return Math.ceil(a/4)*Math.ceil(e/4)*16}throw new Error(`Unable to determine texture byte length for ${t} format.`)}function yK(a){switch(a){case vl:case z2:return{byteLength:1,components:1};case jd:case L2:case dC:return{byteLength:2,components:1};case gy:case cy:return{byteLength:2,components:4};case fc:case ry:case qs:return{byteLength:4,components:1};case _2:return{byteLength:4,components:3}}throw new Error(`Unknown texture type ${a}.`)}class GK{static contain(e,t){return pK(e,t)}static cover(e,t){return mK(e,t)}static fill(e){return bK(e)}static getByteLength(e,t,n,i){return Pv(e,t,n,i)}}typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:Lf}}));typeof window<"u"&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=Lf);/**
 * @license
 * Copyright 2010-2025 Three.js Authors
 * SPDX-License-Identifier: MIT
 */function SM(){let a=null,e=!1,t=null,n=null;function i(s,o){t(s,o),n=a.requestAnimationFrame(i)}return{start:function(){e!==!0&&t!==null&&(n=a.requestAnimationFrame(i),e=!0)},stop:function(){a.cancelAnimationFrame(n),e=!1},setAnimationLoop:function(s){t=s},setContext:function(s){a=s}}}function BK(a){const e=new WeakMap;function t(r,g){const u=r.array,C=r.usage,h=u.byteLength,f=a.createBuffer();a.bindBuffer(g,f),a.bufferData(g,u,C),r.onUploadCallback();let p;if(u instanceof Float32Array)p=a.FLOAT;else if(u instanceof Uint16Array)r.isFloat16BufferAttribute?p=a.HALF_FLOAT:p=a.UNSIGNED_SHORT;else if(u instanceof Int16Array)p=a.SHORT;else if(u instanceof Uint32Array)p=a.UNSIGNED_INT;else if(u instanceof Int32Array)p=a.INT;else if(u instanceof Int8Array)p=a.BYTE;else if(u instanceof Uint8Array)p=a.UNSIGNED_BYTE;else if(u instanceof Uint8ClampedArray)p=a.UNSIGNED_BYTE;else throw new Error("THREE.WebGLAttributes: Unsupported buffer data format: "+u);return{buffer:f,type:p,bytesPerElement:u.BYTES_PER_ELEMENT,version:r.version,size:h}}function n(r,g,u){const C=g.array,h=g.updateRanges;if(a.bindBuffer(u,r),h.length===0)a.bufferSubData(u,0,C);else{h.sort((p,y)=>p.start-y.start);let f=0;for(let p=1;p<h.length;p++){const y=h[f],v=h[p];v.start<=y.start+y.count+1?y.count=Math.max(y.count,v.start+v.count-y.start):(++f,h[f]=v)}h.length=f+1;for(let p=0,y=h.length;p<y;p++){const v=h[p];a.bufferSubData(u,v.start*C.BYTES_PER_ELEMENT,C,v.start,v.count)}g.clearUpdateRanges()}g.onUploadCallback()}function i(r){return r.isInterleavedBufferAttribute&&(r=r.data),e.get(r)}function s(r){r.isInterleavedBufferAttribute&&(r=r.data);const g=e.get(r);g&&(a.deleteBuffer(g.buffer),e.delete(r))}function o(r,g){if(r.isInterleavedBufferAttribute&&(r=r.data),r.isGLBufferAttribute){const C=e.get(r);(!C||C.version<r.version)&&e.set(r,{buffer:r.buffer,type:r.type,bytesPerElement:r.elementSize,version:r.version});return}const u=e.get(r);if(u===void 0)e.set(r,t(r,g));else if(u.version<r.version){if(u.size!==r.array.byteLength)throw new Error("THREE.WebGLAttributes: The size of the buffer attribute's array buffer does not match the original size. Resizing buffer attributes is not supported.");n(u.buffer,r,g),u.version=r.version}}return{get:i,remove:s,update:o}}var vK=`#ifdef USE_ALPHAHASH
	if ( diffuseColor.a < getAlphaHashThreshold( vPosition ) ) discard;
#endif`,ZK=`#ifdef USE_ALPHAHASH
	const float ALPHA_HASH_SCALE = 0.05;
	float hash2D( vec2 value ) {
		return fract( 1.0e4 * sin( 17.0 * value.x + 0.1 * value.y ) * ( 0.1 + abs( sin( 13.0 * value.y + value.x ) ) ) );
	}
	float hash3D( vec3 value ) {
		return hash2D( vec2( hash2D( value.xy ), value.z ) );
	}
	float getAlphaHashThreshold( vec3 position ) {
		float maxDeriv = max(
			length( dFdx( position.xyz ) ),
			length( dFdy( position.xyz ) )
		);
		float pixScale = 1.0 / ( ALPHA_HASH_SCALE * maxDeriv );
		vec2 pixScales = vec2(
			exp2( floor( log2( pixScale ) ) ),
			exp2( ceil( log2( pixScale ) ) )
		);
		vec2 alpha = vec2(
			hash3D( floor( pixScales.x * position.xyz ) ),
			hash3D( floor( pixScales.y * position.xyz ) )
		);
		float lerpFactor = fract( log2( pixScale ) );
		float x = ( 1.0 - lerpFactor ) * alpha.x + lerpFactor * alpha.y;
		float a = min( lerpFactor, 1.0 - lerpFactor );
		vec3 cases = vec3(
			x * x / ( 2.0 * a * ( 1.0 - a ) ),
			( x - 0.5 * a ) / ( 1.0 - a ),
			1.0 - ( ( 1.0 - x ) * ( 1.0 - x ) / ( 2.0 * a * ( 1.0 - a ) ) )
		);
		float threshold = ( x < ( 1.0 - a ) )
			? ( ( x < a ) ? cases.x : cases.y )
			: cases.z;
		return clamp( threshold , 1.0e-6, 1.0 );
	}
#endif`,SK=`#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, vAlphaMapUv ).g;
#endif`,RK=`#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,wK=`#ifdef USE_ALPHATEST
	#ifdef ALPHA_TO_COVERAGE
	diffuseColor.a = smoothstep( alphaTest, alphaTest + fwidth( diffuseColor.a ), diffuseColor.a );
	if ( diffuseColor.a == 0.0 ) discard;
	#else
	if ( diffuseColor.a < alphaTest ) discard;
	#endif
#endif`,xK=`#ifdef USE_ALPHATEST
	uniform float alphaTest;
#endif`,WK=`#ifdef USE_AOMAP
	float ambientOcclusion = ( texture2D( aoMap, vAoMapUv ).r - 1.0 ) * aoMapIntensity + 1.0;
	reflectedLight.indirectDiffuse *= ambientOcclusion;
	#if defined( USE_CLEARCOAT ) 
		clearcoatSpecularIndirect *= ambientOcclusion;
	#endif
	#if defined( USE_SHEEN ) 
		sheenSpecularIndirect *= ambientOcclusion;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD )
		float dotNV = saturate( dot( geometryNormal, geometryViewDir ) );
		reflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );
	#endif
#endif`,VK=`#ifdef USE_AOMAP
	uniform sampler2D aoMap;
	uniform float aoMapIntensity;
#endif`,MK=`#ifdef USE_BATCHING
	#if ! defined( GL_ANGLE_multi_draw )
	#define gl_DrawID _gl_DrawID
	uniform int _gl_DrawID;
	#endif
	uniform highp sampler2D batchingTexture;
	uniform highp usampler2D batchingIdTexture;
	mat4 getBatchingMatrix( const in float i ) {
		int size = textureSize( batchingTexture, 0 ).x;
		int j = int( i ) * 4;
		int x = j % size;
		int y = j / size;
		vec4 v1 = texelFetch( batchingTexture, ivec2( x, y ), 0 );
		vec4 v2 = texelFetch( batchingTexture, ivec2( x + 1, y ), 0 );
		vec4 v3 = texelFetch( batchingTexture, ivec2( x + 2, y ), 0 );
		vec4 v4 = texelFetch( batchingTexture, ivec2( x + 3, y ), 0 );
		return mat4( v1, v2, v3, v4 );
	}
	float getIndirectIndex( const in int i ) {
		int size = textureSize( batchingIdTexture, 0 ).x;
		int x = i % size;
		int y = i / size;
		return float( texelFetch( batchingIdTexture, ivec2( x, y ), 0 ).r );
	}
#endif
#ifdef USE_BATCHING_COLOR
	uniform sampler2D batchingColorTexture;
	vec3 getBatchingColor( const in float i ) {
		int size = textureSize( batchingColorTexture, 0 ).x;
		int j = int( i );
		int x = j % size;
		int y = j / size;
		return texelFetch( batchingColorTexture, ivec2( x, y ), 0 ).rgb;
	}
#endif`,HK=`#ifdef USE_BATCHING
	mat4 batchingMatrix = getBatchingMatrix( getIndirectIndex( gl_DrawID ) );
#endif`,XK=`vec3 transformed = vec3( position );
#ifdef USE_ALPHAHASH
	vPosition = vec3( position );
#endif`,NK=`vec3 objectNormal = vec3( normal );
#ifdef USE_TANGENT
	vec3 objectTangent = vec3( tangent.xyz );
#endif`,YK=`float G_BlinnPhong_Implicit( ) {
	return 0.25;
}
float D_BlinnPhong( const in float shininess, const in float dotNH ) {
	return RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );
}
vec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( specularColor, 1.0, dotVH );
	float G = G_BlinnPhong_Implicit( );
	float D = D_BlinnPhong( shininess, dotNH );
	return F * ( G * D );
} // validated`,KK=`#ifdef USE_IRIDESCENCE
	const mat3 XYZ_TO_REC709 = mat3(
		 3.2404542, -0.9692660,  0.0556434,
		-1.5371385,  1.8760108, -0.2040259,
		-0.4985314,  0.0415560,  1.0572252
	);
	vec3 Fresnel0ToIor( vec3 fresnel0 ) {
		vec3 sqrtF0 = sqrt( fresnel0 );
		return ( vec3( 1.0 ) + sqrtF0 ) / ( vec3( 1.0 ) - sqrtF0 );
	}
	vec3 IorToFresnel0( vec3 transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - vec3( incidentIor ) ) / ( transmittedIor + vec3( incidentIor ) ) );
	}
	float IorToFresnel0( float transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - incidentIor ) / ( transmittedIor + incidentIor ));
	}
	vec3 evalSensitivity( float OPD, vec3 shift ) {
		float phase = 2.0 * PI * OPD * 1.0e-9;
		vec3 val = vec3( 5.4856e-13, 4.4201e-13, 5.2481e-13 );
		vec3 pos = vec3( 1.6810e+06, 1.7953e+06, 2.2084e+06 );
		vec3 var = vec3( 4.3278e+09, 9.3046e+09, 6.6121e+09 );
		vec3 xyz = val * sqrt( 2.0 * PI * var ) * cos( pos * phase + shift ) * exp( - pow2( phase ) * var );
		xyz.x += 9.7470e-14 * sqrt( 2.0 * PI * 4.5282e+09 ) * cos( 2.2399e+06 * phase + shift[ 0 ] ) * exp( - 4.5282e+09 * pow2( phase ) );
		xyz /= 1.0685e-7;
		vec3 rgb = XYZ_TO_REC709 * xyz;
		return rgb;
	}
	vec3 evalIridescence( float outsideIOR, float eta2, float cosTheta1, float thinFilmThickness, vec3 baseF0 ) {
		vec3 I;
		float iridescenceIOR = mix( outsideIOR, eta2, smoothstep( 0.0, 0.03, thinFilmThickness ) );
		float sinTheta2Sq = pow2( outsideIOR / iridescenceIOR ) * ( 1.0 - pow2( cosTheta1 ) );
		float cosTheta2Sq = 1.0 - sinTheta2Sq;
		if ( cosTheta2Sq < 0.0 ) {
			return vec3( 1.0 );
		}
		float cosTheta2 = sqrt( cosTheta2Sq );
		float R0 = IorToFresnel0( iridescenceIOR, outsideIOR );
		float R12 = F_Schlick( R0, 1.0, cosTheta1 );
		float T121 = 1.0 - R12;
		float phi12 = 0.0;
		if ( iridescenceIOR < outsideIOR ) phi12 = PI;
		float phi21 = PI - phi12;
		vec3 baseIOR = Fresnel0ToIor( clamp( baseF0, 0.0, 0.9999 ) );		vec3 R1 = IorToFresnel0( baseIOR, iridescenceIOR );
		vec3 R23 = F_Schlick( R1, 1.0, cosTheta2 );
		vec3 phi23 = vec3( 0.0 );
		if ( baseIOR[ 0 ] < iridescenceIOR ) phi23[ 0 ] = PI;
		if ( baseIOR[ 1 ] < iridescenceIOR ) phi23[ 1 ] = PI;
		if ( baseIOR[ 2 ] < iridescenceIOR ) phi23[ 2 ] = PI;
		float OPD = 2.0 * iridescenceIOR * thinFilmThickness * cosTheta2;
		vec3 phi = vec3( phi21 ) + phi23;
		vec3 R123 = clamp( R12 * R23, 1e-5, 0.9999 );
		vec3 r123 = sqrt( R123 );
		vec3 Rs = pow2( T121 ) * R23 / ( vec3( 1.0 ) - R123 );
		vec3 C0 = R12 + Rs;
		I = C0;
		vec3 Cm = Rs - T121;
		for ( int m = 1; m <= 2; ++ m ) {
			Cm *= r123;
			vec3 Sm = 2.0 * evalSensitivity( float( m ) * OPD, float( m ) * phi );
			I += Cm * Sm;
		}
		return max( I, vec3( 0.0 ) );
	}
#endif`,FK=`#ifdef USE_BUMPMAP
	uniform sampler2D bumpMap;
	uniform float bumpScale;
	vec2 dHdxy_fwd() {
		vec2 dSTdx = dFdx( vBumpMapUv );
		vec2 dSTdy = dFdy( vBumpMapUv );
		float Hll = bumpScale * texture2D( bumpMap, vBumpMapUv ).x;
		float dBx = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdx ).x - Hll;
		float dBy = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdy ).x - Hll;
		return vec2( dBx, dBy );
	}
	vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {
		vec3 vSigmaX = normalize( dFdx( surf_pos.xyz ) );
		vec3 vSigmaY = normalize( dFdy( surf_pos.xyz ) );
		vec3 vN = surf_norm;
		vec3 R1 = cross( vSigmaY, vN );
		vec3 R2 = cross( vN, vSigmaX );
		float fDet = dot( vSigmaX, R1 ) * faceDirection;
		vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );
		return normalize( abs( fDet ) * surf_norm - vGrad );
	}
#endif`,EK=`#if NUM_CLIPPING_PLANES > 0
	vec4 plane;
	#ifdef ALPHA_TO_COVERAGE
		float distanceToPlane, distanceGradient;
		float clipOpacity = 1.0;
		#pragma unroll_loop_start
		for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			distanceToPlane = - dot( vClipPosition, plane.xyz ) + plane.w;
			distanceGradient = fwidth( distanceToPlane ) / 2.0;
			clipOpacity *= smoothstep( - distanceGradient, distanceGradient, distanceToPlane );
			if ( clipOpacity == 0.0 ) discard;
		}
		#pragma unroll_loop_end
		#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
			float unionClipOpacity = 1.0;
			#pragma unroll_loop_start
			for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
				plane = clippingPlanes[ i ];
				distanceToPlane = - dot( vClipPosition, plane.xyz ) + plane.w;
				distanceGradient = fwidth( distanceToPlane ) / 2.0;
				unionClipOpacity *= 1.0 - smoothstep( - distanceGradient, distanceGradient, distanceToPlane );
			}
			#pragma unroll_loop_end
			clipOpacity *= 1.0 - unionClipOpacity;
		#endif
		diffuseColor.a *= clipOpacity;
		if ( diffuseColor.a == 0.0 ) discard;
	#else
		#pragma unroll_loop_start
		for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			if ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;
		}
		#pragma unroll_loop_end
		#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
			bool clipped = true;
			#pragma unroll_loop_start
			for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
				plane = clippingPlanes[ i ];
				clipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;
			}
			#pragma unroll_loop_end
			if ( clipped ) discard;
		#endif
	#endif
#endif`,TK=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
	uniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];
#endif`,zK=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
#endif`,LK=`#if NUM_CLIPPING_PLANES > 0
	vClipPosition = - mvPosition.xyz;
#endif`,_K=`#if defined( USE_COLOR_ALPHA )
	diffuseColor *= vColor;
#elif defined( USE_COLOR )
	diffuseColor.rgb *= vColor;
#endif`,UK=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR )
	varying vec3 vColor;
#endif`,DK=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR ) || defined( USE_BATCHING_COLOR )
	varying vec3 vColor;
#endif`,kK=`#if defined( USE_COLOR_ALPHA )
	vColor = vec4( 1.0 );
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR ) || defined( USE_BATCHING_COLOR )
	vColor = vec3( 1.0 );
#endif
#ifdef USE_COLOR
	vColor *= color;
#endif
#ifdef USE_INSTANCING_COLOR
	vColor.xyz *= instanceColor.xyz;
#endif
#ifdef USE_BATCHING_COLOR
	vec3 batchingColor = getBatchingColor( getIndirectIndex( gl_DrawID ) );
	vColor.xyz *= batchingColor.xyz;
#endif`,OK=`#define PI 3.141592653589793
#define PI2 6.283185307179586
#define PI_HALF 1.5707963267948966
#define RECIPROCAL_PI 0.3183098861837907
#define RECIPROCAL_PI2 0.15915494309189535
#define EPSILON 1e-6
#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
#define whiteComplement( a ) ( 1.0 - saturate( a ) )
float pow2( const in float x ) { return x*x; }
vec3 pow2( const in vec3 x ) { return x*x; }
float pow3( const in float x ) { return x*x*x; }
float pow4( const in float x ) { float x2 = x*x; return x2*x2; }
float max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }
float average( const in vec3 v ) { return dot( v, vec3( 0.3333333 ) ); }
highp float rand( const in vec2 uv ) {
	const highp float a = 12.9898, b = 78.233, c = 43758.5453;
	highp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );
	return fract( sin( sn ) * c );
}
#ifdef HIGH_PRECISION
	float precisionSafeLength( vec3 v ) { return length( v ); }
#else
	float precisionSafeLength( vec3 v ) {
		float maxComponent = max3( abs( v ) );
		return length( v / maxComponent ) * maxComponent;
	}
#endif
struct IncidentLight {
	vec3 color;
	vec3 direction;
	bool visible;
};
struct ReflectedLight {
	vec3 directDiffuse;
	vec3 directSpecular;
	vec3 indirectDiffuse;
	vec3 indirectSpecular;
};
#ifdef USE_ALPHAHASH
	varying vec3 vPosition;
#endif
vec3 transformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );
}
vec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );
}
mat3 transposeMat3( const in mat3 m ) {
	mat3 tmp;
	tmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );
	tmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );
	tmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );
	return tmp;
}
bool isPerspectiveMatrix( mat4 m ) {
	return m[ 2 ][ 3 ] == - 1.0;
}
vec2 equirectUv( in vec3 dir ) {
	float u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;
	float v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;
	return vec2( u, v );
}
vec3 BRDF_Lambert( const in vec3 diffuseColor ) {
	return RECIPROCAL_PI * diffuseColor;
}
vec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
}
float F_Schlick( const in float f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
} // validated`,JK=`#ifdef ENVMAP_TYPE_CUBE_UV
	#define cubeUV_minMipLevel 4.0
	#define cubeUV_minTileSize 16.0
	float getFace( vec3 direction ) {
		vec3 absDirection = abs( direction );
		float face = - 1.0;
		if ( absDirection.x > absDirection.z ) {
			if ( absDirection.x > absDirection.y )
				face = direction.x > 0.0 ? 0.0 : 3.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		} else {
			if ( absDirection.z > absDirection.y )
				face = direction.z > 0.0 ? 2.0 : 5.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		}
		return face;
	}
	vec2 getUV( vec3 direction, float face ) {
		vec2 uv;
		if ( face == 0.0 ) {
			uv = vec2( direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 1.0 ) {
			uv = vec2( - direction.x, - direction.z ) / abs( direction.y );
		} else if ( face == 2.0 ) {
			uv = vec2( - direction.x, direction.y ) / abs( direction.z );
		} else if ( face == 3.0 ) {
			uv = vec2( - direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 4.0 ) {
			uv = vec2( - direction.x, direction.z ) / abs( direction.y );
		} else {
			uv = vec2( direction.x, direction.y ) / abs( direction.z );
		}
		return 0.5 * ( uv + 1.0 );
	}
	vec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {
		float face = getFace( direction );
		float filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );
		mipInt = max( mipInt, cubeUV_minMipLevel );
		float faceSize = exp2( mipInt );
		highp vec2 uv = getUV( direction, face ) * ( faceSize - 2.0 ) + 1.0;
		if ( face > 2.0 ) {
			uv.y += faceSize;
			face -= 3.0;
		}
		uv.x += face * faceSize;
		uv.x += filterInt * 3.0 * cubeUV_minTileSize;
		uv.y += 4.0 * ( exp2( CUBEUV_MAX_MIP ) - faceSize );
		uv.x *= CUBEUV_TEXEL_WIDTH;
		uv.y *= CUBEUV_TEXEL_HEIGHT;
		#ifdef texture2DGradEXT
			return texture2DGradEXT( envMap, uv, vec2( 0.0 ), vec2( 0.0 ) ).rgb;
		#else
			return texture2D( envMap, uv ).rgb;
		#endif
	}
	#define cubeUV_r0 1.0
	#define cubeUV_m0 - 2.0
	#define cubeUV_r1 0.8
	#define cubeUV_m1 - 1.0
	#define cubeUV_r4 0.4
	#define cubeUV_m4 2.0
	#define cubeUV_r5 0.305
	#define cubeUV_m5 3.0
	#define cubeUV_r6 0.21
	#define cubeUV_m6 4.0
	float roughnessToMip( float roughness ) {
		float mip = 0.0;
		if ( roughness >= cubeUV_r1 ) {
			mip = ( cubeUV_r0 - roughness ) * ( cubeUV_m1 - cubeUV_m0 ) / ( cubeUV_r0 - cubeUV_r1 ) + cubeUV_m0;
		} else if ( roughness >= cubeUV_r4 ) {
			mip = ( cubeUV_r1 - roughness ) * ( cubeUV_m4 - cubeUV_m1 ) / ( cubeUV_r1 - cubeUV_r4 ) + cubeUV_m1;
		} else if ( roughness >= cubeUV_r5 ) {
			mip = ( cubeUV_r4 - roughness ) * ( cubeUV_m5 - cubeUV_m4 ) / ( cubeUV_r4 - cubeUV_r5 ) + cubeUV_m4;
		} else if ( roughness >= cubeUV_r6 ) {
			mip = ( cubeUV_r5 - roughness ) * ( cubeUV_m6 - cubeUV_m5 ) / ( cubeUV_r5 - cubeUV_r6 ) + cubeUV_m5;
		} else {
			mip = - 2.0 * log2( 1.16 * roughness );		}
		return mip;
	}
	vec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {
		float mip = clamp( roughnessToMip( roughness ), cubeUV_m0, CUBEUV_MAX_MIP );
		float mipF = fract( mip );
		float mipInt = floor( mip );
		vec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );
		if ( mipF == 0.0 ) {
			return vec4( color0, 1.0 );
		} else {
			vec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );
			return vec4( mix( color0, color1, mipF ), 1.0 );
		}
	}
#endif`,PK=`vec3 transformedNormal = objectNormal;
#ifdef USE_TANGENT
	vec3 transformedTangent = objectTangent;
#endif
#ifdef USE_BATCHING
	mat3 bm = mat3( batchingMatrix );
	transformedNormal /= vec3( dot( bm[ 0 ], bm[ 0 ] ), dot( bm[ 1 ], bm[ 1 ] ), dot( bm[ 2 ], bm[ 2 ] ) );
	transformedNormal = bm * transformedNormal;
	#ifdef USE_TANGENT
		transformedTangent = bm * transformedTangent;
	#endif
#endif
#ifdef USE_INSTANCING
	mat3 im = mat3( instanceMatrix );
	transformedNormal /= vec3( dot( im[ 0 ], im[ 0 ] ), dot( im[ 1 ], im[ 1 ] ), dot( im[ 2 ], im[ 2 ] ) );
	transformedNormal = im * transformedNormal;
	#ifdef USE_TANGENT
		transformedTangent = im * transformedTangent;
	#endif
#endif
transformedNormal = normalMatrix * transformedNormal;
#ifdef FLIP_SIDED
	transformedNormal = - transformedNormal;
#endif
#ifdef USE_TANGENT
	transformedTangent = ( modelViewMatrix * vec4( transformedTangent, 0.0 ) ).xyz;
	#ifdef FLIP_SIDED
		transformedTangent = - transformedTangent;
	#endif
#endif`,QK=`#ifdef USE_DISPLACEMENTMAP
	uniform sampler2D displacementMap;
	uniform float displacementScale;
	uniform float displacementBias;
#endif`,jK=`#ifdef USE_DISPLACEMENTMAP
	transformed += normalize( objectNormal ) * ( texture2D( displacementMap, vDisplacementMapUv ).x * displacementScale + displacementBias );
#endif`,qK=`#ifdef USE_EMISSIVEMAP
	vec4 emissiveColor = texture2D( emissiveMap, vEmissiveMapUv );
	#ifdef DECODE_VIDEO_TEXTURE_EMISSIVE
		emissiveColor = sRGBTransferEOTF( emissiveColor );
	#endif
	totalEmissiveRadiance *= emissiveColor.rgb;
#endif`,$K=`#ifdef USE_EMISSIVEMAP
	uniform sampler2D emissiveMap;
#endif`,eF="gl_FragColor = linearToOutputTexel( gl_FragColor );",tF=`vec4 LinearTransferOETF( in vec4 value ) {
	return value;
}
vec4 sRGBTransferEOTF( in vec4 value ) {
	return vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.a );
}
vec4 sRGBTransferOETF( in vec4 value ) {
	return vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );
}`,nF=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vec3 cameraToFrag;
		if ( isOrthographic ) {
			cameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToFrag = normalize( vWorldPosition - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vec3 reflectVec = reflect( cameraToFrag, worldNormal );
		#else
			vec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );
		#endif
	#else
		vec3 reflectVec = vReflect;
	#endif
	#ifdef ENVMAP_TYPE_CUBE
		vec4 envColor = textureCube( envMap, envMapRotation * vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );
	#else
		vec4 envColor = vec4( 0.0 );
	#endif
	#ifdef ENVMAP_BLENDING_MULTIPLY
		outgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_MIX )
		outgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_ADD )
		outgoingLight += envColor.xyz * specularStrength * reflectivity;
	#endif
#endif`,iF=`#ifdef USE_ENVMAP
	uniform float envMapIntensity;
	uniform float flipEnvMap;
	uniform mat3 envMapRotation;
	#ifdef ENVMAP_TYPE_CUBE
		uniform samplerCube envMap;
	#else
		uniform sampler2D envMap;
	#endif
	
#endif`,aF=`#ifdef USE_ENVMAP
	uniform float reflectivity;
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		varying vec3 vWorldPosition;
		uniform float refractionRatio;
	#else
		varying vec3 vReflect;
	#endif
#endif`,sF=`#ifdef USE_ENVMAP
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		
		varying vec3 vWorldPosition;
	#else
		varying vec3 vReflect;
		uniform float refractionRatio;
	#endif
#endif`,oF=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vWorldPosition = worldPosition.xyz;
	#else
		vec3 cameraToVertex;
		if ( isOrthographic ) {
			cameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToVertex = normalize( worldPosition.xyz - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vReflect = reflect( cameraToVertex, worldNormal );
		#else
			vReflect = refract( cameraToVertex, worldNormal, refractionRatio );
		#endif
	#endif
#endif`,lF=`#ifdef USE_FOG
	vFogDepth = - mvPosition.z;
#endif`,rF=`#ifdef USE_FOG
	varying float vFogDepth;
#endif`,gF=`#ifdef USE_FOG
	#ifdef FOG_EXP2
		float fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );
	#else
		float fogFactor = smoothstep( fogNear, fogFar, vFogDepth );
	#endif
	gl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );
#endif`,cF=`#ifdef USE_FOG
	uniform vec3 fogColor;
	varying float vFogDepth;
	#ifdef FOG_EXP2
		uniform float fogDensity;
	#else
		uniform float fogNear;
		uniform float fogFar;
	#endif
#endif`,uF=`#ifdef USE_GRADIENTMAP
	uniform sampler2D gradientMap;
#endif
vec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {
	float dotNL = dot( normal, lightDirection );
	vec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );
	#ifdef USE_GRADIENTMAP
		return vec3( texture2D( gradientMap, coord ).r );
	#else
		vec2 fw = fwidth( coord ) * 0.5;
		return mix( vec3( 0.7 ), vec3( 1.0 ), smoothstep( 0.7 - fw.x, 0.7 + fw.x, coord.x ) );
	#endif
}`,IF=`#ifdef USE_LIGHTMAP
	uniform sampler2D lightMap;
	uniform float lightMapIntensity;
#endif`,CF=`LambertMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularStrength = specularStrength;`,dF=`varying vec3 vViewPosition;
struct LambertMaterial {
	vec3 diffuseColor;
	float specularStrength;
};
void RE_Direct_Lambert( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Lambert( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Lambert
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Lambert`,AF=`uniform bool receiveShadow;
uniform vec3 ambientLightColor;
#if defined( USE_LIGHT_PROBES )
	uniform vec3 lightProbe[ 9 ];
#endif
vec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {
	float x = normal.x, y = normal.y, z = normal.z;
	vec3 result = shCoefficients[ 0 ] * 0.886227;
	result += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;
	result += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;
	result += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;
	result += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;
	result += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;
	result += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );
	result += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;
	result += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );
	return result;
}
vec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {
	vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
	vec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );
	return irradiance;
}
vec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {
	vec3 irradiance = ambientLightColor;
	return irradiance;
}
float getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {
	float distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );
	if ( cutoffDistance > 0.0 ) {
		distanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );
	}
	return distanceFalloff;
}
float getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {
	return smoothstep( coneCosine, penumbraCosine, angleCosine );
}
#if NUM_DIR_LIGHTS > 0
	struct DirectionalLight {
		vec3 direction;
		vec3 color;
	};
	uniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];
	void getDirectionalLightInfo( const in DirectionalLight directionalLight, out IncidentLight light ) {
		light.color = directionalLight.color;
		light.direction = directionalLight.direction;
		light.visible = true;
	}
#endif
#if NUM_POINT_LIGHTS > 0
	struct PointLight {
		vec3 position;
		vec3 color;
		float distance;
		float decay;
	};
	uniform PointLight pointLights[ NUM_POINT_LIGHTS ];
	void getPointLightInfo( const in PointLight pointLight, const in vec3 geometryPosition, out IncidentLight light ) {
		vec3 lVector = pointLight.position - geometryPosition;
		light.direction = normalize( lVector );
		float lightDistance = length( lVector );
		light.color = pointLight.color;
		light.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );
		light.visible = ( light.color != vec3( 0.0 ) );
	}
#endif
#if NUM_SPOT_LIGHTS > 0
	struct SpotLight {
		vec3 position;
		vec3 direction;
		vec3 color;
		float distance;
		float decay;
		float coneCos;
		float penumbraCos;
	};
	uniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];
	void getSpotLightInfo( const in SpotLight spotLight, const in vec3 geometryPosition, out IncidentLight light ) {
		vec3 lVector = spotLight.position - geometryPosition;
		light.direction = normalize( lVector );
		float angleCos = dot( light.direction, spotLight.direction );
		float spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );
		if ( spotAttenuation > 0.0 ) {
			float lightDistance = length( lVector );
			light.color = spotLight.color * spotAttenuation;
			light.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );
			light.visible = ( light.color != vec3( 0.0 ) );
		} else {
			light.color = vec3( 0.0 );
			light.visible = false;
		}
	}
#endif
#if NUM_RECT_AREA_LIGHTS > 0
	struct RectAreaLight {
		vec3 color;
		vec3 position;
		vec3 halfWidth;
		vec3 halfHeight;
	};
	uniform sampler2D ltc_1;	uniform sampler2D ltc_2;
	uniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];
#endif
#if NUM_HEMI_LIGHTS > 0
	struct HemisphereLight {
		vec3 direction;
		vec3 skyColor;
		vec3 groundColor;
	};
	uniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];
	vec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {
		float dotNL = dot( normal, hemiLight.direction );
		float hemiDiffuseWeight = 0.5 * dotNL + 0.5;
		vec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );
		return irradiance;
	}
#endif`,hF=`#ifdef USE_ENVMAP
	vec3 getIBLIrradiance( const in vec3 normal ) {
		#ifdef ENVMAP_TYPE_CUBE_UV
			vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, envMapRotation * worldNormal, 1.0 );
			return PI * envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	vec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {
		#ifdef ENVMAP_TYPE_CUBE_UV
			vec3 reflectVec = reflect( - viewDir, normal );
			reflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );
			reflectVec = inverseTransformDirection( reflectVec, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, envMapRotation * reflectVec, roughness );
			return envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	#ifdef USE_ANISOTROPY
		vec3 getIBLAnisotropyRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness, const in vec3 bitangent, const in float anisotropy ) {
			#ifdef ENVMAP_TYPE_CUBE_UV
				vec3 bentNormal = cross( bitangent, viewDir );
				bentNormal = normalize( cross( bentNormal, bitangent ) );
				bentNormal = normalize( mix( bentNormal, normal, pow2( pow2( 1.0 - anisotropy * ( 1.0 - roughness ) ) ) ) );
				return getIBLRadiance( viewDir, bentNormal, roughness );
			#else
				return vec3( 0.0 );
			#endif
		}
	#endif
#endif`,fF=`ToonMaterial material;
material.diffuseColor = diffuseColor.rgb;`,pF=`varying vec3 vViewPosition;
struct ToonMaterial {
	vec3 diffuseColor;
};
void RE_Direct_Toon( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	vec3 irradiance = getGradientIrradiance( geometryNormal, directLight.direction ) * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Toon
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Toon`,mF=`BlinnPhongMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularColor = specular;
material.specularShininess = shininess;
material.specularStrength = specularStrength;`,bF=`varying vec3 vViewPosition;
struct BlinnPhongMaterial {
	vec3 diffuseColor;
	vec3 specularColor;
	float specularShininess;
	float specularStrength;
};
void RE_Direct_BlinnPhong( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
	reflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometryViewDir, geometryNormal, material.specularColor, material.specularShininess ) * material.specularStrength;
}
void RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_BlinnPhong
#define RE_IndirectDiffuse		RE_IndirectDiffuse_BlinnPhong`,yF=`PhysicalMaterial material;
material.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );
vec3 dxy = max( abs( dFdx( nonPerturbedNormal ) ), abs( dFdy( nonPerturbedNormal ) ) );
float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );
material.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;
material.roughness = min( material.roughness, 1.0 );
#ifdef IOR
	material.ior = ior;
	#ifdef USE_SPECULAR
		float specularIntensityFactor = specularIntensity;
		vec3 specularColorFactor = specularColor;
		#ifdef USE_SPECULAR_COLORMAP
			specularColorFactor *= texture2D( specularColorMap, vSpecularColorMapUv ).rgb;
		#endif
		#ifdef USE_SPECULAR_INTENSITYMAP
			specularIntensityFactor *= texture2D( specularIntensityMap, vSpecularIntensityMapUv ).a;
		#endif
		material.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );
	#else
		float specularIntensityFactor = 1.0;
		vec3 specularColorFactor = vec3( 1.0 );
		material.specularF90 = 1.0;
	#endif
	material.specularColor = mix( min( pow2( ( material.ior - 1.0 ) / ( material.ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );
#else
	material.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );
	material.specularF90 = 1.0;
#endif
#ifdef USE_CLEARCOAT
	material.clearcoat = clearcoat;
	material.clearcoatRoughness = clearcoatRoughness;
	material.clearcoatF0 = vec3( 0.04 );
	material.clearcoatF90 = 1.0;
	#ifdef USE_CLEARCOATMAP
		material.clearcoat *= texture2D( clearcoatMap, vClearcoatMapUv ).x;
	#endif
	#ifdef USE_CLEARCOAT_ROUGHNESSMAP
		material.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vClearcoatRoughnessMapUv ).y;
	#endif
	material.clearcoat = saturate( material.clearcoat );	material.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );
	material.clearcoatRoughness += geometryRoughness;
	material.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );
#endif
#ifdef USE_DISPERSION
	material.dispersion = dispersion;
#endif
#ifdef USE_IRIDESCENCE
	material.iridescence = iridescence;
	material.iridescenceIOR = iridescenceIOR;
	#ifdef USE_IRIDESCENCEMAP
		material.iridescence *= texture2D( iridescenceMap, vIridescenceMapUv ).r;
	#endif
	#ifdef USE_IRIDESCENCE_THICKNESSMAP
		material.iridescenceThickness = (iridescenceThicknessMaximum - iridescenceThicknessMinimum) * texture2D( iridescenceThicknessMap, vIridescenceThicknessMapUv ).g + iridescenceThicknessMinimum;
	#else
		material.iridescenceThickness = iridescenceThicknessMaximum;
	#endif
#endif
#ifdef USE_SHEEN
	material.sheenColor = sheenColor;
	#ifdef USE_SHEEN_COLORMAP
		material.sheenColor *= texture2D( sheenColorMap, vSheenColorMapUv ).rgb;
	#endif
	material.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );
	#ifdef USE_SHEEN_ROUGHNESSMAP
		material.sheenRoughness *= texture2D( sheenRoughnessMap, vSheenRoughnessMapUv ).a;
	#endif
#endif
#ifdef USE_ANISOTROPY
	#ifdef USE_ANISOTROPYMAP
		mat2 anisotropyMat = mat2( anisotropyVector.x, anisotropyVector.y, - anisotropyVector.y, anisotropyVector.x );
		vec3 anisotropyPolar = texture2D( anisotropyMap, vAnisotropyMapUv ).rgb;
		vec2 anisotropyV = anisotropyMat * normalize( 2.0 * anisotropyPolar.rg - vec2( 1.0 ) ) * anisotropyPolar.b;
	#else
		vec2 anisotropyV = anisotropyVector;
	#endif
	material.anisotropy = length( anisotropyV );
	if( material.anisotropy == 0.0 ) {
		anisotropyV = vec2( 1.0, 0.0 );
	} else {
		anisotropyV /= material.anisotropy;
		material.anisotropy = saturate( material.anisotropy );
	}
	material.alphaT = mix( pow2( material.roughness ), 1.0, pow2( material.anisotropy ) );
	material.anisotropyT = tbn[ 0 ] * anisotropyV.x + tbn[ 1 ] * anisotropyV.y;
	material.anisotropyB = tbn[ 1 ] * anisotropyV.x - tbn[ 0 ] * anisotropyV.y;
#endif`,GF=`struct PhysicalMaterial {
	vec3 diffuseColor;
	float roughness;
	vec3 specularColor;
	float specularF90;
	float dispersion;
	#ifdef USE_CLEARCOAT
		float clearcoat;
		float clearcoatRoughness;
		vec3 clearcoatF0;
		float clearcoatF90;
	#endif
	#ifdef USE_IRIDESCENCE
		float iridescence;
		float iridescenceIOR;
		float iridescenceThickness;
		vec3 iridescenceFresnel;
		vec3 iridescenceF0;
	#endif
	#ifdef USE_SHEEN
		vec3 sheenColor;
		float sheenRoughness;
	#endif
	#ifdef IOR
		float ior;
	#endif
	#ifdef USE_TRANSMISSION
		float transmission;
		float transmissionAlpha;
		float thickness;
		float attenuationDistance;
		vec3 attenuationColor;
	#endif
	#ifdef USE_ANISOTROPY
		float anisotropy;
		float alphaT;
		vec3 anisotropyT;
		vec3 anisotropyB;
	#endif
};
vec3 clearcoatSpecularDirect = vec3( 0.0 );
vec3 clearcoatSpecularIndirect = vec3( 0.0 );
vec3 sheenSpecularDirect = vec3( 0.0 );
vec3 sheenSpecularIndirect = vec3(0.0 );
vec3 Schlick_to_F0( const in vec3 f, const in float f90, const in float dotVH ) {
    float x = clamp( 1.0 - dotVH, 0.0, 1.0 );
    float x2 = x * x;
    float x5 = clamp( x * x2 * x2, 0.0, 0.9999 );
    return ( f - vec3( f90 ) * x5 ) / ( 1.0 - x5 );
}
float V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {
	float a2 = pow2( alpha );
	float gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );
	float gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );
	return 0.5 / max( gv + gl, EPSILON );
}
float D_GGX( const in float alpha, const in float dotNH ) {
	float a2 = pow2( alpha );
	float denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;
	return RECIPROCAL_PI * a2 / pow2( denom );
}
#ifdef USE_ANISOTROPY
	float V_GGX_SmithCorrelated_Anisotropic( const in float alphaT, const in float alphaB, const in float dotTV, const in float dotBV, const in float dotTL, const in float dotBL, const in float dotNV, const in float dotNL ) {
		float gv = dotNL * length( vec3( alphaT * dotTV, alphaB * dotBV, dotNV ) );
		float gl = dotNV * length( vec3( alphaT * dotTL, alphaB * dotBL, dotNL ) );
		float v = 0.5 / ( gv + gl );
		return saturate(v);
	}
	float D_GGX_Anisotropic( const in float alphaT, const in float alphaB, const in float dotNH, const in float dotTH, const in float dotBH ) {
		float a2 = alphaT * alphaB;
		highp vec3 v = vec3( alphaB * dotTH, alphaT * dotBH, a2 * dotNH );
		highp float v2 = dot( v, v );
		float w2 = a2 / v2;
		return RECIPROCAL_PI * a2 * pow2 ( w2 );
	}
#endif
#ifdef USE_CLEARCOAT
	vec3 BRDF_GGX_Clearcoat( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material) {
		vec3 f0 = material.clearcoatF0;
		float f90 = material.clearcoatF90;
		float roughness = material.clearcoatRoughness;
		float alpha = pow2( roughness );
		vec3 halfDir = normalize( lightDir + viewDir );
		float dotNL = saturate( dot( normal, lightDir ) );
		float dotNV = saturate( dot( normal, viewDir ) );
		float dotNH = saturate( dot( normal, halfDir ) );
		float dotVH = saturate( dot( viewDir, halfDir ) );
		vec3 F = F_Schlick( f0, f90, dotVH );
		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
		float D = D_GGX( alpha, dotNH );
		return F * ( V * D );
	}
#endif
vec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material ) {
	vec3 f0 = material.specularColor;
	float f90 = material.specularF90;
	float roughness = material.roughness;
	float alpha = pow2( roughness );
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( f0, f90, dotVH );
	#ifdef USE_IRIDESCENCE
		F = mix( F, material.iridescenceFresnel, material.iridescence );
	#endif
	#ifdef USE_ANISOTROPY
		float dotTL = dot( material.anisotropyT, lightDir );
		float dotTV = dot( material.anisotropyT, viewDir );
		float dotTH = dot( material.anisotropyT, halfDir );
		float dotBL = dot( material.anisotropyB, lightDir );
		float dotBV = dot( material.anisotropyB, viewDir );
		float dotBH = dot( material.anisotropyB, halfDir );
		float V = V_GGX_SmithCorrelated_Anisotropic( material.alphaT, alpha, dotTV, dotBV, dotTL, dotBL, dotNV, dotNL );
		float D = D_GGX_Anisotropic( material.alphaT, alpha, dotNH, dotTH, dotBH );
	#else
		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
		float D = D_GGX( alpha, dotNH );
	#endif
	return F * ( V * D );
}
vec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {
	const float LUT_SIZE = 64.0;
	const float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;
	const float LUT_BIAS = 0.5 / LUT_SIZE;
	float dotNV = saturate( dot( N, V ) );
	vec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );
	uv = uv * LUT_SCALE + LUT_BIAS;
	return uv;
}
float LTC_ClippedSphereFormFactor( const in vec3 f ) {
	float l = length( f );
	return max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );
}
vec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {
	float x = dot( v1, v2 );
	float y = abs( x );
	float a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;
	float b = 3.4175940 + ( 4.1616724 + y ) * y;
	float v = a / b;
	float theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;
	return cross( v1, v2 ) * theta_sintheta;
}
vec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {
	vec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];
	vec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];
	vec3 lightNormal = cross( v1, v2 );
	if( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );
	vec3 T1, T2;
	T1 = normalize( V - N * dot( V, N ) );
	T2 = - cross( N, T1 );
	mat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );
	vec3 coords[ 4 ];
	coords[ 0 ] = mat * ( rectCoords[ 0 ] - P );
	coords[ 1 ] = mat * ( rectCoords[ 1 ] - P );
	coords[ 2 ] = mat * ( rectCoords[ 2 ] - P );
	coords[ 3 ] = mat * ( rectCoords[ 3 ] - P );
	coords[ 0 ] = normalize( coords[ 0 ] );
	coords[ 1 ] = normalize( coords[ 1 ] );
	coords[ 2 ] = normalize( coords[ 2 ] );
	coords[ 3 ] = normalize( coords[ 3 ] );
	vec3 vectorFormFactor = vec3( 0.0 );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );
	float result = LTC_ClippedSphereFormFactor( vectorFormFactor );
	return vec3( result );
}
#if defined( USE_SHEEN )
float D_Charlie( float roughness, float dotNH ) {
	float alpha = pow2( roughness );
	float invAlpha = 1.0 / alpha;
	float cos2h = dotNH * dotNH;
	float sin2h = max( 1.0 - cos2h, 0.0078125 );
	return ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );
}
float V_Neubelt( float dotNV, float dotNL ) {
	return saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );
}
vec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float D = D_Charlie( sheenRoughness, dotNH );
	float V = V_Neubelt( dotNV, dotNL );
	return sheenColor * ( D * V );
}
#endif
float IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	float r2 = roughness * roughness;
	float a = roughness < 0.25 ? -339.2 * r2 + 161.4 * roughness - 25.9 : -8.48 * r2 + 14.3 * roughness - 9.95;
	float b = roughness < 0.25 ? 44.0 * r2 - 23.7 * roughness + 3.26 : 1.97 * r2 - 3.27 * roughness + 0.72;
	float DG = exp( a * dotNV + b ) + ( roughness < 0.25 ? 0.0 : 0.1 * ( roughness - 0.25 ) );
	return saturate( DG * RECIPROCAL_PI );
}
vec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	const vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );
	const vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );
	vec4 r = roughness * c0 + c1;
	float a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;
	vec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;
	return fab;
}
vec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	return specularColor * fab.x + specularF90 * fab.y;
}
#ifdef USE_IRIDESCENCE
void computeMultiscatteringIridescence( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float iridescence, const in vec3 iridescenceF0, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#else
void computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#endif
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	#ifdef USE_IRIDESCENCE
		vec3 Fr = mix( specularColor, iridescenceF0, iridescence );
	#else
		vec3 Fr = specularColor;
	#endif
	vec3 FssEss = Fr * fab.x + specularF90 * fab.y;
	float Ess = fab.x + fab.y;
	float Ems = 1.0 - Ess;
	vec3 Favg = Fr + ( 1.0 - Fr ) * 0.047619;	vec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );
	singleScatter += FssEss;
	multiScatter += Fms * Ems;
}
#if NUM_RECT_AREA_LIGHTS > 0
	void RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
		vec3 normal = geometryNormal;
		vec3 viewDir = geometryViewDir;
		vec3 position = geometryPosition;
		vec3 lightPos = rectAreaLight.position;
		vec3 halfWidth = rectAreaLight.halfWidth;
		vec3 halfHeight = rectAreaLight.halfHeight;
		vec3 lightColor = rectAreaLight.color;
		float roughness = material.roughness;
		vec3 rectCoords[ 4 ];
		rectCoords[ 0 ] = lightPos + halfWidth - halfHeight;		rectCoords[ 1 ] = lightPos - halfWidth - halfHeight;
		rectCoords[ 2 ] = lightPos - halfWidth + halfHeight;
		rectCoords[ 3 ] = lightPos + halfWidth + halfHeight;
		vec2 uv = LTC_Uv( normal, viewDir, roughness );
		vec4 t1 = texture2D( ltc_1, uv );
		vec4 t2 = texture2D( ltc_2, uv );
		mat3 mInv = mat3(
			vec3( t1.x, 0, t1.y ),
			vec3(    0, 1,    0 ),
			vec3( t1.z, 0, t1.w )
		);
		vec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );
		reflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );
		reflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );
	}
#endif
void RE_Direct_Physical( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	#ifdef USE_CLEARCOAT
		float dotNLcc = saturate( dot( geometryClearcoatNormal, directLight.direction ) );
		vec3 ccIrradiance = dotNLcc * directLight.color;
		clearcoatSpecularDirect += ccIrradiance * BRDF_GGX_Clearcoat( directLight.direction, geometryViewDir, geometryClearcoatNormal, material );
	#endif
	#ifdef USE_SHEEN
		sheenSpecularDirect += irradiance * BRDF_Sheen( directLight.direction, geometryViewDir, geometryNormal, material.sheenColor, material.sheenRoughness );
	#endif
	reflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometryViewDir, geometryNormal, material );
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {
	#ifdef USE_CLEARCOAT
		clearcoatSpecularIndirect += clearcoatRadiance * EnvironmentBRDF( geometryClearcoatNormal, geometryViewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );
	#endif
	#ifdef USE_SHEEN
		sheenSpecularIndirect += irradiance * material.sheenColor * IBLSheenBRDF( geometryNormal, geometryViewDir, material.sheenRoughness );
	#endif
	vec3 singleScattering = vec3( 0.0 );
	vec3 multiScattering = vec3( 0.0 );
	vec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;
	#ifdef USE_IRIDESCENCE
		computeMultiscatteringIridescence( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness, singleScattering, multiScattering );
	#else
		computeMultiscattering( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );
	#endif
	vec3 totalScattering = singleScattering + multiScattering;
	vec3 diffuse = material.diffuseColor * ( 1.0 - max( max( totalScattering.r, totalScattering.g ), totalScattering.b ) );
	reflectedLight.indirectSpecular += radiance * singleScattering;
	reflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;
	reflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;
}
#define RE_Direct				RE_Direct_Physical
#define RE_Direct_RectArea		RE_Direct_RectArea_Physical
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Physical
#define RE_IndirectSpecular		RE_IndirectSpecular_Physical
float computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {
	return saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );
}`,BF=`
vec3 geometryPosition = - vViewPosition;
vec3 geometryNormal = normal;
vec3 geometryViewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );
vec3 geometryClearcoatNormal = vec3( 0.0 );
#ifdef USE_CLEARCOAT
	geometryClearcoatNormal = clearcoatNormal;
#endif
#ifdef USE_IRIDESCENCE
	float dotNVi = saturate( dot( normal, geometryViewDir ) );
	if ( material.iridescenceThickness == 0.0 ) {
		material.iridescence = 0.0;
	} else {
		material.iridescence = saturate( material.iridescence );
	}
	if ( material.iridescence > 0.0 ) {
		material.iridescenceFresnel = evalIridescence( 1.0, material.iridescenceIOR, dotNVi, material.iridescenceThickness, material.specularColor );
		material.iridescenceF0 = Schlick_to_F0( material.iridescenceFresnel, 1.0, dotNVi );
	}
#endif
IncidentLight directLight;
#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )
	PointLight pointLight;
	#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {
		pointLight = pointLights[ i ];
		getPointLightInfo( pointLight, geometryPosition, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )
		pointLightShadow = pointLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowIntensity, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )
	SpotLight spotLight;
	vec4 spotColor;
	vec3 spotLightCoord;
	bool inSpotLightMap;
	#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {
		spotLight = spotLights[ i ];
		getSpotLightInfo( spotLight, geometryPosition, directLight );
		#if ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#define SPOT_LIGHT_MAP_INDEX UNROLLED_LOOP_INDEX
		#elif ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		#define SPOT_LIGHT_MAP_INDEX NUM_SPOT_LIGHT_MAPS
		#else
		#define SPOT_LIGHT_MAP_INDEX ( UNROLLED_LOOP_INDEX - NUM_SPOT_LIGHT_SHADOWS + NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#endif
		#if ( SPOT_LIGHT_MAP_INDEX < NUM_SPOT_LIGHT_MAPS )
			spotLightCoord = vSpotLightCoord[ i ].xyz / vSpotLightCoord[ i ].w;
			inSpotLightMap = all( lessThan( abs( spotLightCoord * 2. - 1. ), vec3( 1.0 ) ) );
			spotColor = texture2D( spotLightMap[ SPOT_LIGHT_MAP_INDEX ], spotLightCoord.xy );
			directLight.color = inSpotLightMap ? directLight.color * spotColor.rgb : directLight.color;
		#endif
		#undef SPOT_LIGHT_MAP_INDEX
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		spotLightShadow = spotLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowIntensity, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )
	DirectionalLight directionalLight;
	#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {
		directionalLight = directionalLights[ i ];
		getDirectionalLightInfo( directionalLight, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )
		directionalLightShadow = directionalLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowIntensity, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )
	RectAreaLight rectAreaLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {
		rectAreaLight = rectAreaLights[ i ];
		RE_Direct_RectArea( rectAreaLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if defined( RE_IndirectDiffuse )
	vec3 iblIrradiance = vec3( 0.0 );
	vec3 irradiance = getAmbientLightIrradiance( ambientLightColor );
	#if defined( USE_LIGHT_PROBES )
		irradiance += getLightProbeIrradiance( lightProbe, geometryNormal );
	#endif
	#if ( NUM_HEMI_LIGHTS > 0 )
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {
			irradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometryNormal );
		}
		#pragma unroll_loop_end
	#endif
#endif
#if defined( RE_IndirectSpecular )
	vec3 radiance = vec3( 0.0 );
	vec3 clearcoatRadiance = vec3( 0.0 );
#endif`,vF=`#if defined( RE_IndirectDiffuse )
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
		vec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;
		irradiance += lightMapIrradiance;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )
		iblIrradiance += getIBLIrradiance( geometryNormal );
	#endif
#endif
#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )
	#ifdef USE_ANISOTROPY
		radiance += getIBLAnisotropyRadiance( geometryViewDir, geometryNormal, material.roughness, material.anisotropyB, material.anisotropy );
	#else
		radiance += getIBLRadiance( geometryViewDir, geometryNormal, material.roughness );
	#endif
	#ifdef USE_CLEARCOAT
		clearcoatRadiance += getIBLRadiance( geometryViewDir, geometryClearcoatNormal, material.clearcoatRoughness );
	#endif
#endif`,ZF=`#if defined( RE_IndirectDiffuse )
	RE_IndirectDiffuse( irradiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
#endif
#if defined( RE_IndirectSpecular )
	RE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
#endif`,SF=`#if defined( USE_LOGDEPTHBUF )
	gl_FragDepth = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;
#endif`,RF=`#if defined( USE_LOGDEPTHBUF )
	uniform float logDepthBufFC;
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,wF=`#ifdef USE_LOGDEPTHBUF
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,xF=`#ifdef USE_LOGDEPTHBUF
	vFragDepth = 1.0 + gl_Position.w;
	vIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );
#endif`,WF=`#ifdef USE_MAP
	vec4 sampledDiffuseColor = texture2D( map, vMapUv );
	#ifdef DECODE_VIDEO_TEXTURE
		sampledDiffuseColor = sRGBTransferEOTF( sampledDiffuseColor );
	#endif
	diffuseColor *= sampledDiffuseColor;
#endif`,VF=`#ifdef USE_MAP
	uniform sampler2D map;
#endif`,MF=`#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
	#if defined( USE_POINTS_UV )
		vec2 uv = vUv;
	#else
		vec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;
	#endif
#endif
#ifdef USE_MAP
	diffuseColor *= texture2D( map, uv );
#endif
#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, uv ).g;
#endif`,HF=`#if defined( USE_POINTS_UV )
	varying vec2 vUv;
#else
	#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
		uniform mat3 uvTransform;
	#endif
#endif
#ifdef USE_MAP
	uniform sampler2D map;
#endif
#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,XF=`float metalnessFactor = metalness;
#ifdef USE_METALNESSMAP
	vec4 texelMetalness = texture2D( metalnessMap, vMetalnessMapUv );
	metalnessFactor *= texelMetalness.b;
#endif`,NF=`#ifdef USE_METALNESSMAP
	uniform sampler2D metalnessMap;
#endif`,YF=`#ifdef USE_INSTANCING_MORPH
	float morphTargetInfluences[ MORPHTARGETS_COUNT ];
	float morphTargetBaseInfluence = texelFetch( morphTexture, ivec2( 0, gl_InstanceID ), 0 ).r;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		morphTargetInfluences[i] =  texelFetch( morphTexture, ivec2( i + 1, gl_InstanceID ), 0 ).r;
	}
#endif`,KF=`#if defined( USE_MORPHCOLORS )
	vColor *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		#if defined( USE_COLOR_ALPHA )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ) * morphTargetInfluences[ i ];
		#elif defined( USE_COLOR )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ).rgb * morphTargetInfluences[ i ];
		#endif
	}
#endif`,FF=`#ifdef USE_MORPHNORMALS
	objectNormal *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		if ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1 ).xyz * morphTargetInfluences[ i ];
	}
#endif`,EF=`#ifdef USE_MORPHTARGETS
	#ifndef USE_INSTANCING_MORPH
		uniform float morphTargetBaseInfluence;
		uniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];
	#endif
	uniform sampler2DArray morphTargetsTexture;
	uniform ivec2 morphTargetsTextureSize;
	vec4 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset ) {
		int texelIndex = vertexIndex * MORPHTARGETS_TEXTURE_STRIDE + offset;
		int y = texelIndex / morphTargetsTextureSize.x;
		int x = texelIndex - y * morphTargetsTextureSize.x;
		ivec3 morphUV = ivec3( x, y, morphTargetIndex );
		return texelFetch( morphTargetsTexture, morphUV, 0 );
	}
#endif`,TF=`#ifdef USE_MORPHTARGETS
	transformed *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		if ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0 ).xyz * morphTargetInfluences[ i ];
	}
#endif`,zF=`float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;
#ifdef FLAT_SHADED
	vec3 fdx = dFdx( vViewPosition );
	vec3 fdy = dFdy( vViewPosition );
	vec3 normal = normalize( cross( fdx, fdy ) );
#else
	vec3 normal = normalize( vNormal );
	#ifdef DOUBLE_SIDED
		normal *= faceDirection;
	#endif
#endif
#if defined( USE_NORMALMAP_TANGENTSPACE ) || defined( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY )
	#ifdef USE_TANGENT
		mat3 tbn = mat3( normalize( vTangent ), normalize( vBitangent ), normal );
	#else
		mat3 tbn = getTangentFrame( - vViewPosition, normal,
		#if defined( USE_NORMALMAP )
			vNormalMapUv
		#elif defined( USE_CLEARCOAT_NORMALMAP )
			vClearcoatNormalMapUv
		#else
			vUv
		#endif
		);
	#endif
	#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )
		tbn[0] *= faceDirection;
		tbn[1] *= faceDirection;
	#endif
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	#ifdef USE_TANGENT
		mat3 tbn2 = mat3( normalize( vTangent ), normalize( vBitangent ), normal );
	#else
		mat3 tbn2 = getTangentFrame( - vViewPosition, normal, vClearcoatNormalMapUv );
	#endif
	#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )
		tbn2[0] *= faceDirection;
		tbn2[1] *= faceDirection;
	#endif
#endif
vec3 nonPerturbedNormal = normal;`,LF=`#ifdef USE_NORMALMAP_OBJECTSPACE
	normal = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;
	#ifdef FLIP_SIDED
		normal = - normal;
	#endif
	#ifdef DOUBLE_SIDED
		normal = normal * faceDirection;
	#endif
	normal = normalize( normalMatrix * normal );
#elif defined( USE_NORMALMAP_TANGENTSPACE )
	vec3 mapN = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;
	mapN.xy *= normalScale;
	normal = normalize( tbn * mapN );
#elif defined( USE_BUMPMAP )
	normal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );
#endif`,_F=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,UF=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,DF=`#ifndef FLAT_SHADED
	vNormal = normalize( transformedNormal );
	#ifdef USE_TANGENT
		vTangent = normalize( transformedTangent );
		vBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );
	#endif
#endif`,kF=`#ifdef USE_NORMALMAP
	uniform sampler2D normalMap;
	uniform vec2 normalScale;
#endif
#ifdef USE_NORMALMAP_OBJECTSPACE
	uniform mat3 normalMatrix;
#endif
#if ! defined ( USE_TANGENT ) && ( defined ( USE_NORMALMAP_TANGENTSPACE ) || defined ( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY ) )
	mat3 getTangentFrame( vec3 eye_pos, vec3 surf_norm, vec2 uv ) {
		vec3 q0 = dFdx( eye_pos.xyz );
		vec3 q1 = dFdy( eye_pos.xyz );
		vec2 st0 = dFdx( uv.st );
		vec2 st1 = dFdy( uv.st );
		vec3 N = surf_norm;
		vec3 q1perp = cross( q1, N );
		vec3 q0perp = cross( N, q0 );
		vec3 T = q1perp * st0.x + q0perp * st1.x;
		vec3 B = q1perp * st0.y + q0perp * st1.y;
		float det = max( dot( T, T ), dot( B, B ) );
		float scale = ( det == 0.0 ) ? 0.0 : inversesqrt( det );
		return mat3( T * scale, B * scale, N );
	}
#endif`,OF=`#ifdef USE_CLEARCOAT
	vec3 clearcoatNormal = nonPerturbedNormal;
#endif`,JF=`#ifdef USE_CLEARCOAT_NORMALMAP
	vec3 clearcoatMapN = texture2D( clearcoatNormalMap, vClearcoatNormalMapUv ).xyz * 2.0 - 1.0;
	clearcoatMapN.xy *= clearcoatNormalScale;
	clearcoatNormal = normalize( tbn2 * clearcoatMapN );
#endif`,PF=`#ifdef USE_CLEARCOATMAP
	uniform sampler2D clearcoatMap;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform sampler2D clearcoatNormalMap;
	uniform vec2 clearcoatNormalScale;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform sampler2D clearcoatRoughnessMap;
#endif`,QF=`#ifdef USE_IRIDESCENCEMAP
	uniform sampler2D iridescenceMap;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform sampler2D iridescenceThicknessMap;
#endif`,jF=`#ifdef OPAQUE
diffuseColor.a = 1.0;
#endif
#ifdef USE_TRANSMISSION
diffuseColor.a *= material.transmissionAlpha;
#endif
gl_FragColor = vec4( outgoingLight, diffuseColor.a );`,qF=`vec3 packNormalToRGB( const in vec3 normal ) {
	return normalize( normal ) * 0.5 + 0.5;
}
vec3 unpackRGBToNormal( const in vec3 rgb ) {
	return 2.0 * rgb.xyz - 1.0;
}
const float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;const float ShiftRight8 = 1. / 256.;
const float Inv255 = 1. / 255.;
const vec4 PackFactors = vec4( 1.0, 256.0, 256.0 * 256.0, 256.0 * 256.0 * 256.0 );
const vec2 UnpackFactors2 = vec2( UnpackDownscale, 1.0 / PackFactors.g );
const vec3 UnpackFactors3 = vec3( UnpackDownscale / PackFactors.rg, 1.0 / PackFactors.b );
const vec4 UnpackFactors4 = vec4( UnpackDownscale / PackFactors.rgb, 1.0 / PackFactors.a );
vec4 packDepthToRGBA( const in float v ) {
	if( v <= 0.0 )
		return vec4( 0., 0., 0., 0. );
	if( v >= 1.0 )
		return vec4( 1., 1., 1., 1. );
	float vuf;
	float af = modf( v * PackFactors.a, vuf );
	float bf = modf( vuf * ShiftRight8, vuf );
	float gf = modf( vuf * ShiftRight8, vuf );
	return vec4( vuf * Inv255, gf * PackUpscale, bf * PackUpscale, af );
}
vec3 packDepthToRGB( const in float v ) {
	if( v <= 0.0 )
		return vec3( 0., 0., 0. );
	if( v >= 1.0 )
		return vec3( 1., 1., 1. );
	float vuf;
	float bf = modf( v * PackFactors.b, vuf );
	float gf = modf( vuf * ShiftRight8, vuf );
	return vec3( vuf * Inv255, gf * PackUpscale, bf );
}
vec2 packDepthToRG( const in float v ) {
	if( v <= 0.0 )
		return vec2( 0., 0. );
	if( v >= 1.0 )
		return vec2( 1., 1. );
	float vuf;
	float gf = modf( v * 256., vuf );
	return vec2( vuf * Inv255, gf );
}
float unpackRGBAToDepth( const in vec4 v ) {
	return dot( v, UnpackFactors4 );
}
float unpackRGBToDepth( const in vec3 v ) {
	return dot( v, UnpackFactors3 );
}
float unpackRGToDepth( const in vec2 v ) {
	return v.r * UnpackFactors2.r + v.g * UnpackFactors2.g;
}
vec4 pack2HalfToRGBA( const in vec2 v ) {
	vec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );
	return vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );
}
vec2 unpackRGBATo2Half( const in vec4 v ) {
	return vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );
}
float viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {
	return ( viewZ + near ) / ( near - far );
}
float orthographicDepthToViewZ( const in float depth, const in float near, const in float far ) {
	return depth * ( near - far ) - near;
}
float viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {
	return ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );
}
float perspectiveDepthToViewZ( const in float depth, const in float near, const in float far ) {
	return ( near * far ) / ( ( far - near ) * depth - far );
}`,$F=`#ifdef PREMULTIPLIED_ALPHA
	gl_FragColor.rgb *= gl_FragColor.a;
#endif`,eE=`vec4 mvPosition = vec4( transformed, 1.0 );
#ifdef USE_BATCHING
	mvPosition = batchingMatrix * mvPosition;
#endif
#ifdef USE_INSTANCING
	mvPosition = instanceMatrix * mvPosition;
#endif
mvPosition = modelViewMatrix * mvPosition;
gl_Position = projectionMatrix * mvPosition;`,tE=`#ifdef DITHERING
	gl_FragColor.rgb = dithering( gl_FragColor.rgb );
#endif`,nE=`#ifdef DITHERING
	vec3 dithering( vec3 color ) {
		float grid_position = rand( gl_FragCoord.xy );
		vec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );
		dither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );
		return color + dither_shift_RGB;
	}
#endif`,iE=`float roughnessFactor = roughness;
#ifdef USE_ROUGHNESSMAP
	vec4 texelRoughness = texture2D( roughnessMap, vRoughnessMapUv );
	roughnessFactor *= texelRoughness.g;
#endif`,aE=`#ifdef USE_ROUGHNESSMAP
	uniform sampler2D roughnessMap;
#endif`,sE=`#if NUM_SPOT_LIGHT_COORDS > 0
	varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#if NUM_SPOT_LIGHT_MAPS > 0
	uniform sampler2D spotLightMap[ NUM_SPOT_LIGHT_MAPS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		uniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];
		struct SpotLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
	float texture2DCompare( sampler2D depths, vec2 uv, float compare ) {
		return step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );
	}
	vec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {
		return unpackRGBATo2Half( texture2D( shadow, uv ) );
	}
	float VSMShadow (sampler2D shadow, vec2 uv, float compare ){
		float occlusion = 1.0;
		vec2 distribution = texture2DDistribution( shadow, uv );
		float hard_shadow = step( compare , distribution.x );
		if (hard_shadow != 1.0 ) {
			float distance = compare - distribution.x ;
			float variance = max( 0.00000, distribution.y * distribution.y );
			float softness_probability = variance / (variance + distance * distance );			softness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );			occlusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );
		}
		return occlusion;
	}
	float getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowIntensity, float shadowBias, float shadowRadius, vec4 shadowCoord ) {
		float shadow = 1.0;
		shadowCoord.xyz /= shadowCoord.w;
		shadowCoord.z += shadowBias;
		bool inFrustum = shadowCoord.x >= 0.0 && shadowCoord.x <= 1.0 && shadowCoord.y >= 0.0 && shadowCoord.y <= 1.0;
		bool frustumTest = inFrustum && shadowCoord.z <= 1.0;
		if ( frustumTest ) {
		#if defined( SHADOWMAP_TYPE_PCF )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx0 = - texelSize.x * shadowRadius;
			float dy0 = - texelSize.y * shadowRadius;
			float dx1 = + texelSize.x * shadowRadius;
			float dy1 = + texelSize.y * shadowRadius;
			float dx2 = dx0 / 2.0;
			float dy2 = dy0 / 2.0;
			float dx3 = dx1 / 2.0;
			float dy3 = dy1 / 2.0;
			shadow = (
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )
			) * ( 1.0 / 17.0 );
		#elif defined( SHADOWMAP_TYPE_PCF_SOFT )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx = texelSize.x;
			float dy = texelSize.y;
			vec2 uv = shadowCoord.xy;
			vec2 f = fract( uv * shadowMapSize + 0.5 );
			uv -= f * texelSize;
			shadow = (
				texture2DCompare( shadowMap, uv, shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),
						  f.x ),
					 mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),
						  f.x ),
					 f.y )
			) * ( 1.0 / 9.0 );
		#elif defined( SHADOWMAP_TYPE_VSM )
			shadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );
		#else
			shadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );
		#endif
		}
		return mix( 1.0, shadow, shadowIntensity );
	}
	vec2 cubeToUV( vec3 v, float texelSizeY ) {
		vec3 absV = abs( v );
		float scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );
		absV *= scaleToCube;
		v *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );
		vec2 planar = v.xy;
		float almostATexel = 1.5 * texelSizeY;
		float almostOne = 1.0 - almostATexel;
		if ( absV.z >= almostOne ) {
			if ( v.z > 0.0 )
				planar.x = 4.0 - v.x;
		} else if ( absV.x >= almostOne ) {
			float signX = sign( v.x );
			planar.x = v.z * signX + 2.0 * signX;
		} else if ( absV.y >= almostOne ) {
			float signY = sign( v.y );
			planar.x = v.x + 2.0 * signY + 2.0;
			planar.y = v.z * signY - 2.0;
		}
		return vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );
	}
	float getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowIntensity, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {
		float shadow = 1.0;
		vec3 lightToPosition = shadowCoord.xyz;
		
		float lightToPositionLength = length( lightToPosition );
		if ( lightToPositionLength - shadowCameraFar <= 0.0 && lightToPositionLength - shadowCameraNear >= 0.0 ) {
			float dp = ( lightToPositionLength - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );			dp += shadowBias;
			vec3 bd3D = normalize( lightToPosition );
			vec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );
			#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )
				vec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;
				shadow = (
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )
				) * ( 1.0 / 9.0 );
			#else
				shadow = texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );
			#endif
		}
		return mix( 1.0, shadow, shadowIntensity );
	}
#endif`,oE=`#if NUM_SPOT_LIGHT_COORDS > 0
	uniform mat4 spotLightMatrix[ NUM_SPOT_LIGHT_COORDS ];
	varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		struct SpotLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
#endif`,lE=`#if ( defined( USE_SHADOWMAP ) && ( NUM_DIR_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0 ) ) || ( NUM_SPOT_LIGHT_COORDS > 0 )
	vec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
	vec4 shadowWorldPosition;
#endif
#if defined( USE_SHADOWMAP )
	#if NUM_DIR_LIGHT_SHADOWS > 0
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );
			vDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;
		}
		#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );
			vPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;
		}
		#pragma unroll_loop_end
	#endif
#endif
#if NUM_SPOT_LIGHT_COORDS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_COORDS; i ++ ) {
		shadowWorldPosition = worldPosition;
		#if ( defined( USE_SHADOWMAP ) && UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
			shadowWorldPosition.xyz += shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias;
		#endif
		vSpotLightCoord[ i ] = spotLightMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
#endif`,rE=`float getShadowMask() {
	float shadow = 1.0;
	#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
		directionalLight = directionalLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowIntensity, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {
		spotLight = spotLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowIntensity, spotLight.shadowBias, spotLight.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
		pointLight = pointLightShadows[ i ];
		shadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowIntensity, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#endif
	return shadow;
}`,gE=`#ifdef USE_SKINNING
	mat4 boneMatX = getBoneMatrix( skinIndex.x );
	mat4 boneMatY = getBoneMatrix( skinIndex.y );
	mat4 boneMatZ = getBoneMatrix( skinIndex.z );
	mat4 boneMatW = getBoneMatrix( skinIndex.w );
#endif`,cE=`#ifdef USE_SKINNING
	uniform mat4 bindMatrix;
	uniform mat4 bindMatrixInverse;
	uniform highp sampler2D boneTexture;
	mat4 getBoneMatrix( const in float i ) {
		int size = textureSize( boneTexture, 0 ).x;
		int j = int( i ) * 4;
		int x = j % size;
		int y = j / size;
		vec4 v1 = texelFetch( boneTexture, ivec2( x, y ), 0 );
		vec4 v2 = texelFetch( boneTexture, ivec2( x + 1, y ), 0 );
		vec4 v3 = texelFetch( boneTexture, ivec2( x + 2, y ), 0 );
		vec4 v4 = texelFetch( boneTexture, ivec2( x + 3, y ), 0 );
		return mat4( v1, v2, v3, v4 );
	}
#endif`,uE=`#ifdef USE_SKINNING
	vec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );
	vec4 skinned = vec4( 0.0 );
	skinned += boneMatX * skinVertex * skinWeight.x;
	skinned += boneMatY * skinVertex * skinWeight.y;
	skinned += boneMatZ * skinVertex * skinWeight.z;
	skinned += boneMatW * skinVertex * skinWeight.w;
	transformed = ( bindMatrixInverse * skinned ).xyz;
#endif`,IE=`#ifdef USE_SKINNING
	mat4 skinMatrix = mat4( 0.0 );
	skinMatrix += skinWeight.x * boneMatX;
	skinMatrix += skinWeight.y * boneMatY;
	skinMatrix += skinWeight.z * boneMatZ;
	skinMatrix += skinWeight.w * boneMatW;
	skinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;
	objectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;
	#ifdef USE_TANGENT
		objectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#endif
#endif`,CE=`float specularStrength;
#ifdef USE_SPECULARMAP
	vec4 texelSpecular = texture2D( specularMap, vSpecularMapUv );
	specularStrength = texelSpecular.r;
#else
	specularStrength = 1.0;
#endif`,dE=`#ifdef USE_SPECULARMAP
	uniform sampler2D specularMap;
#endif`,AE=`#if defined( TONE_MAPPING )
	gl_FragColor.rgb = toneMapping( gl_FragColor.rgb );
#endif`,hE=`#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
uniform float toneMappingExposure;
vec3 LinearToneMapping( vec3 color ) {
	return saturate( toneMappingExposure * color );
}
vec3 ReinhardToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	return saturate( color / ( vec3( 1.0 ) + color ) );
}
vec3 CineonToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	color = max( vec3( 0.0 ), color - 0.004 );
	return pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );
}
vec3 RRTAndODTFit( vec3 v ) {
	vec3 a = v * ( v + 0.0245786 ) - 0.000090537;
	vec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;
	return a / b;
}
vec3 ACESFilmicToneMapping( vec3 color ) {
	const mat3 ACESInputMat = mat3(
		vec3( 0.59719, 0.07600, 0.02840 ),		vec3( 0.35458, 0.90834, 0.13383 ),
		vec3( 0.04823, 0.01566, 0.83777 )
	);
	const mat3 ACESOutputMat = mat3(
		vec3(  1.60475, -0.10208, -0.00327 ),		vec3( -0.53108,  1.10813, -0.07276 ),
		vec3( -0.07367, -0.00605,  1.07602 )
	);
	color *= toneMappingExposure / 0.6;
	color = ACESInputMat * color;
	color = RRTAndODTFit( color );
	color = ACESOutputMat * color;
	return saturate( color );
}
const mat3 LINEAR_REC2020_TO_LINEAR_SRGB = mat3(
	vec3( 1.6605, - 0.1246, - 0.0182 ),
	vec3( - 0.5876, 1.1329, - 0.1006 ),
	vec3( - 0.0728, - 0.0083, 1.1187 )
);
const mat3 LINEAR_SRGB_TO_LINEAR_REC2020 = mat3(
	vec3( 0.6274, 0.0691, 0.0164 ),
	vec3( 0.3293, 0.9195, 0.0880 ),
	vec3( 0.0433, 0.0113, 0.8956 )
);
vec3 agxDefaultContrastApprox( vec3 x ) {
	vec3 x2 = x * x;
	vec3 x4 = x2 * x2;
	return + 15.5 * x4 * x2
		- 40.14 * x4 * x
		+ 31.96 * x4
		- 6.868 * x2 * x
		+ 0.4298 * x2
		+ 0.1191 * x
		- 0.00232;
}
vec3 AgXToneMapping( vec3 color ) {
	const mat3 AgXInsetMatrix = mat3(
		vec3( 0.856627153315983, 0.137318972929847, 0.11189821299995 ),
		vec3( 0.0951212405381588, 0.761241990602591, 0.0767994186031903 ),
		vec3( 0.0482516061458583, 0.101439036467562, 0.811302368396859 )
	);
	const mat3 AgXOutsetMatrix = mat3(
		vec3( 1.1271005818144368, - 0.1413297634984383, - 0.14132976349843826 ),
		vec3( - 0.11060664309660323, 1.157823702216272, - 0.11060664309660294 ),
		vec3( - 0.016493938717834573, - 0.016493938717834257, 1.2519364065950405 )
	);
	const float AgxMinEv = - 12.47393;	const float AgxMaxEv = 4.026069;
	color *= toneMappingExposure;
	color = LINEAR_SRGB_TO_LINEAR_REC2020 * color;
	color = AgXInsetMatrix * color;
	color = max( color, 1e-10 );	color = log2( color );
	color = ( color - AgxMinEv ) / ( AgxMaxEv - AgxMinEv );
	color = clamp( color, 0.0, 1.0 );
	color = agxDefaultContrastApprox( color );
	color = AgXOutsetMatrix * color;
	color = pow( max( vec3( 0.0 ), color ), vec3( 2.2 ) );
	color = LINEAR_REC2020_TO_LINEAR_SRGB * color;
	color = clamp( color, 0.0, 1.0 );
	return color;
}
vec3 NeutralToneMapping( vec3 color ) {
	const float StartCompression = 0.8 - 0.04;
	const float Desaturation = 0.15;
	color *= toneMappingExposure;
	float x = min( color.r, min( color.g, color.b ) );
	float offset = x < 0.08 ? x - 6.25 * x * x : 0.04;
	color -= offset;
	float peak = max( color.r, max( color.g, color.b ) );
	if ( peak < StartCompression ) return color;
	float d = 1. - StartCompression;
	float newPeak = 1. - d * d / ( peak + d - StartCompression );
	color *= newPeak / peak;
	float g = 1. - 1. / ( Desaturation * ( peak - newPeak ) + 1. );
	return mix( color, vec3( newPeak ), g );
}
vec3 CustomToneMapping( vec3 color ) { return color; }`,fE=`#ifdef USE_TRANSMISSION
	material.transmission = transmission;
	material.transmissionAlpha = 1.0;
	material.thickness = thickness;
	material.attenuationDistance = attenuationDistance;
	material.attenuationColor = attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		material.transmission *= texture2D( transmissionMap, vTransmissionMapUv ).r;
	#endif
	#ifdef USE_THICKNESSMAP
		material.thickness *= texture2D( thicknessMap, vThicknessMapUv ).g;
	#endif
	vec3 pos = vWorldPosition;
	vec3 v = normalize( cameraPosition - pos );
	vec3 n = inverseTransformDirection( normal, viewMatrix );
	vec4 transmitted = getIBLVolumeRefraction(
		n, v, material.roughness, material.diffuseColor, material.specularColor, material.specularF90,
		pos, modelMatrix, viewMatrix, projectionMatrix, material.dispersion, material.ior, material.thickness,
		material.attenuationColor, material.attenuationDistance );
	material.transmissionAlpha = mix( material.transmissionAlpha, transmitted.a, material.transmission );
	totalDiffuse = mix( totalDiffuse, transmitted.rgb, material.transmission );
#endif`,pE=`#ifdef USE_TRANSMISSION
	uniform float transmission;
	uniform float thickness;
	uniform float attenuationDistance;
	uniform vec3 attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		uniform sampler2D transmissionMap;
	#endif
	#ifdef USE_THICKNESSMAP
		uniform sampler2D thicknessMap;
	#endif
	uniform vec2 transmissionSamplerSize;
	uniform sampler2D transmissionSamplerMap;
	uniform mat4 modelMatrix;
	uniform mat4 projectionMatrix;
	varying vec3 vWorldPosition;
	float w0( float a ) {
		return ( 1.0 / 6.0 ) * ( a * ( a * ( - a + 3.0 ) - 3.0 ) + 1.0 );
	}
	float w1( float a ) {
		return ( 1.0 / 6.0 ) * ( a *  a * ( 3.0 * a - 6.0 ) + 4.0 );
	}
	float w2( float a ){
		return ( 1.0 / 6.0 ) * ( a * ( a * ( - 3.0 * a + 3.0 ) + 3.0 ) + 1.0 );
	}
	float w3( float a ) {
		return ( 1.0 / 6.0 ) * ( a * a * a );
	}
	float g0( float a ) {
		return w0( a ) + w1( a );
	}
	float g1( float a ) {
		return w2( a ) + w3( a );
	}
	float h0( float a ) {
		return - 1.0 + w1( a ) / ( w0( a ) + w1( a ) );
	}
	float h1( float a ) {
		return 1.0 + w3( a ) / ( w2( a ) + w3( a ) );
	}
	vec4 bicubic( sampler2D tex, vec2 uv, vec4 texelSize, float lod ) {
		uv = uv * texelSize.zw + 0.5;
		vec2 iuv = floor( uv );
		vec2 fuv = fract( uv );
		float g0x = g0( fuv.x );
		float g1x = g1( fuv.x );
		float h0x = h0( fuv.x );
		float h1x = h1( fuv.x );
		float h0y = h0( fuv.y );
		float h1y = h1( fuv.y );
		vec2 p0 = ( vec2( iuv.x + h0x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;
		vec2 p1 = ( vec2( iuv.x + h1x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;
		vec2 p2 = ( vec2( iuv.x + h0x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;
		vec2 p3 = ( vec2( iuv.x + h1x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;
		return g0( fuv.y ) * ( g0x * textureLod( tex, p0, lod ) + g1x * textureLod( tex, p1, lod ) ) +
			g1( fuv.y ) * ( g0x * textureLod( tex, p2, lod ) + g1x * textureLod( tex, p3, lod ) );
	}
	vec4 textureBicubic( sampler2D sampler, vec2 uv, float lod ) {
		vec2 fLodSize = vec2( textureSize( sampler, int( lod ) ) );
		vec2 cLodSize = vec2( textureSize( sampler, int( lod + 1.0 ) ) );
		vec2 fLodSizeInv = 1.0 / fLodSize;
		vec2 cLodSizeInv = 1.0 / cLodSize;
		vec4 fSample = bicubic( sampler, uv, vec4( fLodSizeInv, fLodSize ), floor( lod ) );
		vec4 cSample = bicubic( sampler, uv, vec4( cLodSizeInv, cLodSize ), ceil( lod ) );
		return mix( fSample, cSample, fract( lod ) );
	}
	vec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {
		vec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );
		vec3 modelScale;
		modelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );
		modelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );
		modelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );
		return normalize( refractionVector ) * thickness * modelScale;
	}
	float applyIorToRoughness( const in float roughness, const in float ior ) {
		return roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );
	}
	vec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {
		float lod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );
		return textureBicubic( transmissionSamplerMap, fragCoord.xy, lod );
	}
	vec3 volumeAttenuation( const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {
		if ( isinf( attenuationDistance ) ) {
			return vec3( 1.0 );
		} else {
			vec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;
			vec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );			return transmittance;
		}
	}
	vec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,
		const in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,
		const in mat4 viewMatrix, const in mat4 projMatrix, const in float dispersion, const in float ior, const in float thickness,
		const in vec3 attenuationColor, const in float attenuationDistance ) {
		vec4 transmittedLight;
		vec3 transmittance;
		#ifdef USE_DISPERSION
			float halfSpread = ( ior - 1.0 ) * 0.025 * dispersion;
			vec3 iors = vec3( ior - halfSpread, ior, ior + halfSpread );
			for ( int i = 0; i < 3; i ++ ) {
				vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, iors[ i ], modelMatrix );
				vec3 refractedRayExit = position + transmissionRay;
				vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );
				vec2 refractionCoords = ndcPos.xy / ndcPos.w;
				refractionCoords += 1.0;
				refractionCoords /= 2.0;
				vec4 transmissionSample = getTransmissionSample( refractionCoords, roughness, iors[ i ] );
				transmittedLight[ i ] = transmissionSample[ i ];
				transmittedLight.a += transmissionSample.a;
				transmittance[ i ] = diffuseColor[ i ] * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance )[ i ];
			}
			transmittedLight.a /= 3.0;
		#else
			vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );
			vec3 refractedRayExit = position + transmissionRay;
			vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );
			vec2 refractionCoords = ndcPos.xy / ndcPos.w;
			refractionCoords += 1.0;
			refractionCoords /= 2.0;
			transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );
			transmittance = diffuseColor * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance );
		#endif
		vec3 attenuatedColor = transmittance * transmittedLight.rgb;
		vec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );
		float transmittanceFactor = ( transmittance.r + transmittance.g + transmittance.b ) / 3.0;
		return vec4( ( 1.0 - F ) * attenuatedColor, 1.0 - ( 1.0 - transmittedLight.a ) * transmittanceFactor );
	}
#endif`,mE=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	varying vec2 vUv;
#endif
#ifdef USE_MAP
	varying vec2 vMapUv;
#endif
#ifdef USE_ALPHAMAP
	varying vec2 vAlphaMapUv;
#endif
#ifdef USE_LIGHTMAP
	varying vec2 vLightMapUv;
#endif
#ifdef USE_AOMAP
	varying vec2 vAoMapUv;
#endif
#ifdef USE_BUMPMAP
	varying vec2 vBumpMapUv;
#endif
#ifdef USE_NORMALMAP
	varying vec2 vNormalMapUv;
#endif
#ifdef USE_EMISSIVEMAP
	varying vec2 vEmissiveMapUv;
#endif
#ifdef USE_METALNESSMAP
	varying vec2 vMetalnessMapUv;
#endif
#ifdef USE_ROUGHNESSMAP
	varying vec2 vRoughnessMapUv;
#endif
#ifdef USE_ANISOTROPYMAP
	varying vec2 vAnisotropyMapUv;
#endif
#ifdef USE_CLEARCOATMAP
	varying vec2 vClearcoatMapUv;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	varying vec2 vClearcoatNormalMapUv;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	varying vec2 vClearcoatRoughnessMapUv;
#endif
#ifdef USE_IRIDESCENCEMAP
	varying vec2 vIridescenceMapUv;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	varying vec2 vIridescenceThicknessMapUv;
#endif
#ifdef USE_SHEEN_COLORMAP
	varying vec2 vSheenColorMapUv;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	varying vec2 vSheenRoughnessMapUv;
#endif
#ifdef USE_SPECULARMAP
	varying vec2 vSpecularMapUv;
#endif
#ifdef USE_SPECULAR_COLORMAP
	varying vec2 vSpecularColorMapUv;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	varying vec2 vSpecularIntensityMapUv;
#endif
#ifdef USE_TRANSMISSIONMAP
	uniform mat3 transmissionMapTransform;
	varying vec2 vTransmissionMapUv;
#endif
#ifdef USE_THICKNESSMAP
	uniform mat3 thicknessMapTransform;
	varying vec2 vThicknessMapUv;
#endif`,bE=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	varying vec2 vUv;
#endif
#ifdef USE_MAP
	uniform mat3 mapTransform;
	varying vec2 vMapUv;
#endif
#ifdef USE_ALPHAMAP
	uniform mat3 alphaMapTransform;
	varying vec2 vAlphaMapUv;
#endif
#ifdef USE_LIGHTMAP
	uniform mat3 lightMapTransform;
	varying vec2 vLightMapUv;
#endif
#ifdef USE_AOMAP
	uniform mat3 aoMapTransform;
	varying vec2 vAoMapUv;
#endif
#ifdef USE_BUMPMAP
	uniform mat3 bumpMapTransform;
	varying vec2 vBumpMapUv;
#endif
#ifdef USE_NORMALMAP
	uniform mat3 normalMapTransform;
	varying vec2 vNormalMapUv;
#endif
#ifdef USE_DISPLACEMENTMAP
	uniform mat3 displacementMapTransform;
	varying vec2 vDisplacementMapUv;
#endif
#ifdef USE_EMISSIVEMAP
	uniform mat3 emissiveMapTransform;
	varying vec2 vEmissiveMapUv;
#endif
#ifdef USE_METALNESSMAP
	uniform mat3 metalnessMapTransform;
	varying vec2 vMetalnessMapUv;
#endif
#ifdef USE_ROUGHNESSMAP
	uniform mat3 roughnessMapTransform;
	varying vec2 vRoughnessMapUv;
#endif
#ifdef USE_ANISOTROPYMAP
	uniform mat3 anisotropyMapTransform;
	varying vec2 vAnisotropyMapUv;
#endif
#ifdef USE_CLEARCOATMAP
	uniform mat3 clearcoatMapTransform;
	varying vec2 vClearcoatMapUv;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform mat3 clearcoatNormalMapTransform;
	varying vec2 vClearcoatNormalMapUv;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform mat3 clearcoatRoughnessMapTransform;
	varying vec2 vClearcoatRoughnessMapUv;
#endif
#ifdef USE_SHEEN_COLORMAP
	uniform mat3 sheenColorMapTransform;
	varying vec2 vSheenColorMapUv;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	uniform mat3 sheenRoughnessMapTransform;
	varying vec2 vSheenRoughnessMapUv;
#endif
#ifdef USE_IRIDESCENCEMAP
	uniform mat3 iridescenceMapTransform;
	varying vec2 vIridescenceMapUv;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform mat3 iridescenceThicknessMapTransform;
	varying vec2 vIridescenceThicknessMapUv;
#endif
#ifdef USE_SPECULARMAP
	uniform mat3 specularMapTransform;
	varying vec2 vSpecularMapUv;
#endif
#ifdef USE_SPECULAR_COLORMAP
	uniform mat3 specularColorMapTransform;
	varying vec2 vSpecularColorMapUv;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	uniform mat3 specularIntensityMapTransform;
	varying vec2 vSpecularIntensityMapUv;
#endif
#ifdef USE_TRANSMISSIONMAP
	uniform mat3 transmissionMapTransform;
	varying vec2 vTransmissionMapUv;
#endif
#ifdef USE_THICKNESSMAP
	uniform mat3 thicknessMapTransform;
	varying vec2 vThicknessMapUv;
#endif`,yE=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	vUv = vec3( uv, 1 ).xy;
#endif
#ifdef USE_MAP
	vMapUv = ( mapTransform * vec3( MAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ALPHAMAP
	vAlphaMapUv = ( alphaMapTransform * vec3( ALPHAMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_LIGHTMAP
	vLightMapUv = ( lightMapTransform * vec3( LIGHTMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_AOMAP
	vAoMapUv = ( aoMapTransform * vec3( AOMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_BUMPMAP
	vBumpMapUv = ( bumpMapTransform * vec3( BUMPMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_NORMALMAP
	vNormalMapUv = ( normalMapTransform * vec3( NORMALMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_DISPLACEMENTMAP
	vDisplacementMapUv = ( displacementMapTransform * vec3( DISPLACEMENTMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_EMISSIVEMAP
	vEmissiveMapUv = ( emissiveMapTransform * vec3( EMISSIVEMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_METALNESSMAP
	vMetalnessMapUv = ( metalnessMapTransform * vec3( METALNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ROUGHNESSMAP
	vRoughnessMapUv = ( roughnessMapTransform * vec3( ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ANISOTROPYMAP
	vAnisotropyMapUv = ( anisotropyMapTransform * vec3( ANISOTROPYMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOATMAP
	vClearcoatMapUv = ( clearcoatMapTransform * vec3( CLEARCOATMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	vClearcoatNormalMapUv = ( clearcoatNormalMapTransform * vec3( CLEARCOAT_NORMALMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	vClearcoatRoughnessMapUv = ( clearcoatRoughnessMapTransform * vec3( CLEARCOAT_ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_IRIDESCENCEMAP
	vIridescenceMapUv = ( iridescenceMapTransform * vec3( IRIDESCENCEMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	vIridescenceThicknessMapUv = ( iridescenceThicknessMapTransform * vec3( IRIDESCENCE_THICKNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SHEEN_COLORMAP
	vSheenColorMapUv = ( sheenColorMapTransform * vec3( SHEEN_COLORMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	vSheenRoughnessMapUv = ( sheenRoughnessMapTransform * vec3( SHEEN_ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULARMAP
	vSpecularMapUv = ( specularMapTransform * vec3( SPECULARMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULAR_COLORMAP
	vSpecularColorMapUv = ( specularColorMapTransform * vec3( SPECULAR_COLORMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	vSpecularIntensityMapUv = ( specularIntensityMapTransform * vec3( SPECULAR_INTENSITYMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_TRANSMISSIONMAP
	vTransmissionMapUv = ( transmissionMapTransform * vec3( TRANSMISSIONMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_THICKNESSMAP
	vThicknessMapUv = ( thicknessMapTransform * vec3( THICKNESSMAP_UV, 1 ) ).xy;
#endif`,GE=`#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION ) || NUM_SPOT_LIGHT_COORDS > 0
	vec4 worldPosition = vec4( transformed, 1.0 );
	#ifdef USE_BATCHING
		worldPosition = batchingMatrix * worldPosition;
	#endif
	#ifdef USE_INSTANCING
		worldPosition = instanceMatrix * worldPosition;
	#endif
	worldPosition = modelMatrix * worldPosition;
#endif`;const BE=`varying vec2 vUv;
uniform mat3 uvTransform;
void main() {
	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	gl_Position = vec4( position.xy, 1.0, 1.0 );
}`,vE=`uniform sampler2D t2D;
uniform float backgroundIntensity;
varying vec2 vUv;
void main() {
	vec4 texColor = texture2D( t2D, vUv );
	#ifdef DECODE_VIDEO_TEXTURE
		texColor = vec4( mix( pow( texColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), texColor.rgb * 0.0773993808, vec3( lessThanEqual( texColor.rgb, vec3( 0.04045 ) ) ) ), texColor.w );
	#endif
	texColor.rgb *= backgroundIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,ZE=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,SE=`#ifdef ENVMAP_TYPE_CUBE
	uniform samplerCube envMap;
#elif defined( ENVMAP_TYPE_CUBE_UV )
	uniform sampler2D envMap;
#endif
uniform float flipEnvMap;
uniform float backgroundBlurriness;
uniform float backgroundIntensity;
uniform mat3 backgroundRotation;
varying vec3 vWorldDirection;
#include <cube_uv_reflection_fragment>
void main() {
	#ifdef ENVMAP_TYPE_CUBE
		vec4 texColor = textureCube( envMap, backgroundRotation * vec3( flipEnvMap * vWorldDirection.x, vWorldDirection.yz ) );
	#elif defined( ENVMAP_TYPE_CUBE_UV )
		vec4 texColor = textureCubeUV( envMap, backgroundRotation * vWorldDirection, backgroundBlurriness );
	#else
		vec4 texColor = vec4( 0.0, 0.0, 0.0, 1.0 );
	#endif
	texColor.rgb *= backgroundIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,RE=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,wE=`uniform samplerCube tCube;
uniform float tFlip;
uniform float opacity;
varying vec3 vWorldDirection;
void main() {
	vec4 texColor = textureCube( tCube, vec3( tFlip * vWorldDirection.x, vWorldDirection.yz ) );
	gl_FragColor = texColor;
	gl_FragColor.a *= opacity;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,xE=`#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
varying vec2 vHighPrecisionZW;
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <skinbase_vertex>
	#include <morphinstance_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vHighPrecisionZW = gl_Position.zw;
}`,WE=`#if DEPTH_PACKING == 3200
	uniform float opacity;
#endif
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
varying vec2 vHighPrecisionZW;
void main() {
	vec4 diffuseColor = vec4( 1.0 );
	#include <clipping_planes_fragment>
	#if DEPTH_PACKING == 3200
		diffuseColor.a = opacity;
	#endif
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <logdepthbuf_fragment>
	float fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;
	#if DEPTH_PACKING == 3200
		gl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );
	#elif DEPTH_PACKING == 3201
		gl_FragColor = packDepthToRGBA( fragCoordZ );
	#elif DEPTH_PACKING == 3202
		gl_FragColor = vec4( packDepthToRGB( fragCoordZ ), 1.0 );
	#elif DEPTH_PACKING == 3203
		gl_FragColor = vec4( packDepthToRG( fragCoordZ ), 0.0, 1.0 );
	#endif
}`,VE=`#define DISTANCE
varying vec3 vWorldPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <skinbase_vertex>
	#include <morphinstance_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <clipping_planes_vertex>
	vWorldPosition = worldPosition.xyz;
}`,ME=`#define DISTANCE
uniform vec3 referencePosition;
uniform float nearDistance;
uniform float farDistance;
varying vec3 vWorldPosition;
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <clipping_planes_pars_fragment>
void main () {
	vec4 diffuseColor = vec4( 1.0 );
	#include <clipping_planes_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	float dist = length( vWorldPosition - referencePosition );
	dist = ( dist - nearDistance ) / ( farDistance - nearDistance );
	dist = saturate( dist );
	gl_FragColor = packDepthToRGBA( dist );
}`,HE=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
}`,XE=`uniform sampler2D tEquirect;
varying vec3 vWorldDirection;
#include <common>
void main() {
	vec3 direction = normalize( vWorldDirection );
	vec2 sampleUV = equirectUv( direction );
	gl_FragColor = texture2D( tEquirect, sampleUV );
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,NE=`uniform float scale;
attribute float lineDistance;
varying float vLineDistance;
#include <common>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	vLineDistance = scale * lineDistance;
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,YE=`uniform vec3 diffuse;
uniform float opacity;
uniform float dashSize;
uniform float totalSize;
varying float vLineDistance;
#include <common>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	if ( mod( vLineDistance, totalSize ) > dashSize ) {
		discard;
	}
	vec3 outgoingLight = vec3( 0.0 );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,KE=`#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinbase_vertex>
		#include <skinnormal_vertex>
		#include <defaultnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <fog_vertex>
}`,FE=`uniform vec3 diffuse;
uniform float opacity;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
		reflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity * RECIPROCAL_PI;
	#else
		reflectedLight.indirectDiffuse += vec3( 1.0 );
	#endif
	#include <aomap_fragment>
	reflectedLight.indirectDiffuse *= diffuseColor.rgb;
	vec3 outgoingLight = reflectedLight.indirectDiffuse;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,EE=`#define LAMBERT
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,TE=`#define LAMBERT
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_lambert_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_lambert_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,zE=`#define MATCAP
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <displacementmap_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
	vViewPosition = - mvPosition.xyz;
}`,LE=`#define MATCAP
uniform vec3 diffuse;
uniform float opacity;
uniform sampler2D matcap;
varying vec3 vViewPosition;
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	vec3 viewDir = normalize( vViewPosition );
	vec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );
	vec3 y = cross( viewDir, x );
	vec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;
	#ifdef USE_MATCAP
		vec4 matcapColor = texture2D( matcap, uv );
	#else
		vec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );
	#endif
	vec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,_E=`#define NORMAL
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	varying vec3 vViewPosition;
#endif
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphinstance_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	vViewPosition = - mvPosition.xyz;
#endif
}`,UE=`#define NORMAL
uniform float opacity;
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	varying vec3 vViewPosition;
#endif
#include <packing>
#include <uv_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( 0.0, 0.0, 0.0, opacity );
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	gl_FragColor = vec4( packNormalToRGB( normal ), diffuseColor.a );
	#ifdef OPAQUE
		gl_FragColor.a = 1.0;
	#endif
}`,DE=`#define PHONG
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphinstance_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,kE=`#define PHONG
uniform vec3 diffuse;
uniform vec3 emissive;
uniform vec3 specular;
uniform float shininess;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_phong_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_phong_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,OE=`#define STANDARD
varying vec3 vViewPosition;
#ifdef USE_TRANSMISSION
	varying vec3 vWorldPosition;
#endif
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
#ifdef USE_TRANSMISSION
	vWorldPosition = worldPosition.xyz;
#endif
}`,JE=`#define STANDARD
#ifdef PHYSICAL
	#define IOR
	#define USE_SPECULAR
#endif
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float roughness;
uniform float metalness;
uniform float opacity;
#ifdef IOR
	uniform float ior;
#endif
#ifdef USE_SPECULAR
	uniform float specularIntensity;
	uniform vec3 specularColor;
	#ifdef USE_SPECULAR_COLORMAP
		uniform sampler2D specularColorMap;
	#endif
	#ifdef USE_SPECULAR_INTENSITYMAP
		uniform sampler2D specularIntensityMap;
	#endif
#endif
#ifdef USE_CLEARCOAT
	uniform float clearcoat;
	uniform float clearcoatRoughness;
#endif
#ifdef USE_DISPERSION
	uniform float dispersion;
#endif
#ifdef USE_IRIDESCENCE
	uniform float iridescence;
	uniform float iridescenceIOR;
	uniform float iridescenceThicknessMinimum;
	uniform float iridescenceThicknessMaximum;
#endif
#ifdef USE_SHEEN
	uniform vec3 sheenColor;
	uniform float sheenRoughness;
	#ifdef USE_SHEEN_COLORMAP
		uniform sampler2D sheenColorMap;
	#endif
	#ifdef USE_SHEEN_ROUGHNESSMAP
		uniform sampler2D sheenRoughnessMap;
	#endif
#endif
#ifdef USE_ANISOTROPY
	uniform vec2 anisotropyVector;
	#ifdef USE_ANISOTROPYMAP
		uniform sampler2D anisotropyMap;
	#endif
#endif
varying vec3 vViewPosition;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <iridescence_fragment>
#include <cube_uv_reflection_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_physical_pars_fragment>
#include <fog_pars_fragment>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_physical_pars_fragment>
#include <transmission_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <clearcoat_pars_fragment>
#include <iridescence_pars_fragment>
#include <roughnessmap_pars_fragment>
#include <metalnessmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <roughnessmap_fragment>
	#include <metalnessmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <clearcoat_normal_fragment_begin>
	#include <clearcoat_normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_physical_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;
	vec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;
	#include <transmission_fragment>
	vec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;
	#ifdef USE_SHEEN
		float sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );
		outgoingLight = outgoingLight * sheenEnergyComp + sheenSpecularDirect + sheenSpecularIndirect;
	#endif
	#ifdef USE_CLEARCOAT
		float dotNVcc = saturate( dot( geometryClearcoatNormal, geometryViewDir ) );
		vec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );
		outgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + ( clearcoatSpecularDirect + clearcoatSpecularIndirect ) * material.clearcoat;
	#endif
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,PE=`#define TOON
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,QE=`#define TOON
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <gradientmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_toon_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_toon_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,jE=`uniform float size;
uniform float scale;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
#ifdef USE_POINTS_UV
	varying vec2 vUv;
	uniform mat3 uvTransform;
#endif
void main() {
	#ifdef USE_POINTS_UV
		vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	#endif
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	gl_PointSize = size;
	#ifdef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );
	#endif
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <fog_vertex>
}`,qE=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <color_pars_fragment>
#include <map_particle_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	#include <logdepthbuf_fragment>
	#include <map_particle_fragment>
	#include <color_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,$E=`#include <common>
#include <batching_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <shadowmap_pars_vertex>
void main() {
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphinstance_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,eT=`uniform vec3 color;
uniform float opacity;
#include <common>
#include <packing>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <logdepthbuf_pars_fragment>
#include <shadowmap_pars_fragment>
#include <shadowmask_pars_fragment>
void main() {
	#include <logdepthbuf_fragment>
	gl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
}`,tT=`uniform float rotation;
uniform vec2 center;
#include <common>
#include <uv_pars_vertex>
#include <fog_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	vec4 mvPosition = modelViewMatrix[ 3 ];
	vec2 scale = vec2( length( modelMatrix[ 0 ].xyz ), length( modelMatrix[ 1 ].xyz ) );
	#ifndef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) scale *= - mvPosition.z;
	#endif
	vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;
	vec2 rotatedPosition;
	rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
	rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;
	mvPosition.xy += rotatedPosition;
	gl_Position = projectionMatrix * mvPosition;
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,nT=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
}`,An={alphahash_fragment:vK,alphahash_pars_fragment:ZK,alphamap_fragment:SK,alphamap_pars_fragment:RK,alphatest_fragment:wK,alphatest_pars_fragment:xK,aomap_fragment:WK,aomap_pars_fragment:VK,batching_pars_vertex:MK,batching_vertex:HK,begin_vertex:XK,beginnormal_vertex:NK,bsdfs:YK,iridescence_fragment:KK,bumpmap_pars_fragment:FK,clipping_planes_fragment:EK,clipping_planes_pars_fragment:TK,clipping_planes_pars_vertex:zK,clipping_planes_vertex:LK,color_fragment:_K,color_pars_fragment:UK,color_pars_vertex:DK,color_vertex:kK,common:OK,cube_uv_reflection_fragment:JK,defaultnormal_vertex:PK,displacementmap_pars_vertex:QK,displacementmap_vertex:jK,emissivemap_fragment:qK,emissivemap_pars_fragment:$K,colorspace_fragment:eF,colorspace_pars_fragment:tF,envmap_fragment:nF,envmap_common_pars_fragment:iF,envmap_pars_fragment:aF,envmap_pars_vertex:sF,envmap_physical_pars_fragment:hF,envmap_vertex:oF,fog_vertex:lF,fog_pars_vertex:rF,fog_fragment:gF,fog_pars_fragment:cF,gradientmap_pars_fragment:uF,lightmap_pars_fragment:IF,lights_lambert_fragment:CF,lights_lambert_pars_fragment:dF,lights_pars_begin:AF,lights_toon_fragment:fF,lights_toon_pars_fragment:pF,lights_phong_fragment:mF,lights_phong_pars_fragment:bF,lights_physical_fragment:yF,lights_physical_pars_fragment:GF,lights_fragment_begin:BF,lights_fragment_maps:vF,lights_fragment_end:ZF,logdepthbuf_fragment:SF,logdepthbuf_pars_fragment:RF,logdepthbuf_pars_vertex:wF,logdepthbuf_vertex:xF,map_fragment:WF,map_pars_fragment:VF,map_particle_fragment:MF,map_particle_pars_fragment:HF,metalnessmap_fragment:XF,metalnessmap_pars_fragment:NF,morphinstance_vertex:YF,morphcolor_vertex:KF,morphnormal_vertex:FF,morphtarget_pars_vertex:EF,morphtarget_vertex:TF,normal_fragment_begin:zF,normal_fragment_maps:LF,normal_pars_fragment:_F,normal_pars_vertex:UF,normal_vertex:DF,normalmap_pars_fragment:kF,clearcoat_normal_fragment_begin:OF,clearcoat_normal_fragment_maps:JF,clearcoat_pars_fragment:PF,iridescence_pars_fragment:QF,opaque_fragment:jF,packing:qF,premultiplied_alpha_fragment:$F,project_vertex:eE,dithering_fragment:tE,dithering_pars_fragment:nE,roughnessmap_fragment:iE,roughnessmap_pars_fragment:aE,shadowmap_pars_fragment:sE,shadowmap_pars_vertex:oE,shadowmap_vertex:lE,shadowmask_pars_fragment:rE,skinbase_vertex:gE,skinning_pars_vertex:cE,skinning_vertex:uE,skinnormal_vertex:IE,specularmap_fragment:CE,specularmap_pars_fragment:dE,tonemapping_fragment:AE,tonemapping_pars_fragment:hE,transmission_fragment:fE,transmission_pars_fragment:pE,uv_pars_fragment:mE,uv_pars_vertex:bE,uv_vertex:yE,worldpos_vertex:GE,background_vert:BE,background_frag:vE,backgroundCube_vert:ZE,backgroundCube_frag:SE,cube_vert:RE,cube_frag:wE,depth_vert:xE,depth_frag:WE,distanceRGBA_vert:VE,distanceRGBA_frag:ME,equirect_vert:HE,equirect_frag:XE,linedashed_vert:NE,linedashed_frag:YE,meshbasic_vert:KE,meshbasic_frag:FE,meshlambert_vert:EE,meshlambert_frag:TE,meshmatcap_vert:zE,meshmatcap_frag:LE,meshnormal_vert:_E,meshnormal_frag:UE,meshphong_vert:DE,meshphong_frag:kE,meshphysical_vert:OE,meshphysical_frag:JE,meshtoon_vert:PE,meshtoon_frag:QE,points_vert:jE,points_frag:qE,shadow_vert:$E,shadow_frag:eT,sprite_vert:tT,sprite_frag:nT},Rt={common:{diffuse:{value:new Gt(16777215)},opacity:{value:1},map:{value:null},mapTransform:{value:new on},alphaMap:{value:null},alphaMapTransform:{value:new on},alphaTest:{value:0}},specularmap:{specularMap:{value:null},specularMapTransform:{value:new on}},envmap:{envMap:{value:null},envMapRotation:{value:new on},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1},aoMapTransform:{value:new on}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1},lightMapTransform:{value:new on}},bumpmap:{bumpMap:{value:null},bumpMapTransform:{value:new on},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalMapTransform:{value:new on},normalScale:{value:new at(1,1)}},displacementmap:{displacementMap:{value:null},displacementMapTransform:{value:new on},displacementScale:{value:1},displacementBias:{value:0}},emissivemap:{emissiveMap:{value:null},emissiveMapTransform:{value:new on}},metalnessmap:{metalnessMap:{value:null},metalnessMapTransform:{value:new on}},roughnessmap:{roughnessMap:{value:null},roughnessMapTransform:{value:new on}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new Gt(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotLightMap:{value:[]},spotShadowMap:{value:[]},spotLightMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new Gt(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaMapTransform:{value:new on},alphaTest:{value:0},uvTransform:{value:new on}},sprite:{diffuse:{value:new Gt(16777215)},opacity:{value:1},center:{value:new at(.5,.5)},rotation:{value:0},map:{value:null},mapTransform:{value:new on},alphaMap:{value:null},alphaMapTransform:{value:new on},alphaTest:{value:0}}},hr={basic:{uniforms:ks([Rt.common,Rt.specularmap,Rt.envmap,Rt.aomap,Rt.lightmap,Rt.fog]),vertexShader:An.meshbasic_vert,fragmentShader:An.meshbasic_frag},lambert:{uniforms:ks([Rt.common,Rt.specularmap,Rt.envmap,Rt.aomap,Rt.lightmap,Rt.emissivemap,Rt.bumpmap,Rt.normalmap,Rt.displacementmap,Rt.fog,Rt.lights,{emissive:{value:new Gt(0)}}]),vertexShader:An.meshlambert_vert,fragmentShader:An.meshlambert_frag},phong:{uniforms:ks([Rt.common,Rt.specularmap,Rt.envmap,Rt.aomap,Rt.lightmap,Rt.emissivemap,Rt.bumpmap,Rt.normalmap,Rt.displacementmap,Rt.fog,Rt.lights,{emissive:{value:new Gt(0)},specular:{value:new Gt(1118481)},shininess:{value:30}}]),vertexShader:An.meshphong_vert,fragmentShader:An.meshphong_frag},standard:{uniforms:ks([Rt.common,Rt.envmap,Rt.aomap,Rt.lightmap,Rt.emissivemap,Rt.bumpmap,Rt.normalmap,Rt.displacementmap,Rt.roughnessmap,Rt.metalnessmap,Rt.fog,Rt.lights,{emissive:{value:new Gt(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:An.meshphysical_vert,fragmentShader:An.meshphysical_frag},toon:{uniforms:ks([Rt.common,Rt.aomap,Rt.lightmap,Rt.emissivemap,Rt.bumpmap,Rt.normalmap,Rt.displacementmap,Rt.gradientmap,Rt.fog,Rt.lights,{emissive:{value:new Gt(0)}}]),vertexShader:An.meshtoon_vert,fragmentShader:An.meshtoon_frag},matcap:{uniforms:ks([Rt.common,Rt.bumpmap,Rt.normalmap,Rt.displacementmap,Rt.fog,{matcap:{value:null}}]),vertexShader:An.meshmatcap_vert,fragmentShader:An.meshmatcap_frag},points:{uniforms:ks([Rt.points,Rt.fog]),vertexShader:An.points_vert,fragmentShader:An.points_frag},dashed:{uniforms:ks([Rt.common,Rt.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:An.linedashed_vert,fragmentShader:An.linedashed_frag},depth:{uniforms:ks([Rt.common,Rt.displacementmap]),vertexShader:An.depth_vert,fragmentShader:An.depth_frag},normal:{uniforms:ks([Rt.common,Rt.bumpmap,Rt.normalmap,Rt.displacementmap,{opacity:{value:1}}]),vertexShader:An.meshnormal_vert,fragmentShader:An.meshnormal_frag},sprite:{uniforms:ks([Rt.sprite,Rt.fog]),vertexShader:An.sprite_vert,fragmentShader:An.sprite_frag},background:{uniforms:{uvTransform:{value:new on},t2D:{value:null},backgroundIntensity:{value:1}},vertexShader:An.background_vert,fragmentShader:An.background_frag},backgroundCube:{uniforms:{envMap:{value:null},flipEnvMap:{value:-1},backgroundBlurriness:{value:0},backgroundIntensity:{value:1},backgroundRotation:{value:new on}},vertexShader:An.backgroundCube_vert,fragmentShader:An.backgroundCube_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:An.cube_vert,fragmentShader:An.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:An.equirect_vert,fragmentShader:An.equirect_frag},distanceRGBA:{uniforms:ks([Rt.common,Rt.displacementmap,{referencePosition:{value:new ae},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:An.distanceRGBA_vert,fragmentShader:An.distanceRGBA_frag},shadow:{uniforms:ks([Rt.lights,Rt.fog,{color:{value:new Gt(0)},opacity:{value:1}}]),vertexShader:An.shadow_vert,fragmentShader:An.shadow_frag}};hr.physical={uniforms:ks([hr.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatMapTransform:{value:new on},clearcoatNormalMap:{value:null},clearcoatNormalMapTransform:{value:new on},clearcoatNormalScale:{value:new at(1,1)},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatRoughnessMapTransform:{value:new on},dispersion:{value:0},iridescence:{value:0},iridescenceMap:{value:null},iridescenceMapTransform:{value:new on},iridescenceIOR:{value:1.3},iridescenceThicknessMinimum:{value:100},iridescenceThicknessMaximum:{value:400},iridescenceThicknessMap:{value:null},iridescenceThicknessMapTransform:{value:new on},sheen:{value:0},sheenColor:{value:new Gt(0)},sheenColorMap:{value:null},sheenColorMapTransform:{value:new on},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},sheenRoughnessMapTransform:{value:new on},transmission:{value:0},transmissionMap:{value:null},transmissionMapTransform:{value:new on},transmissionSamplerSize:{value:new at},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},thicknessMapTransform:{value:new on},attenuationDistance:{value:0},attenuationColor:{value:new Gt(0)},specularColor:{value:new Gt(1,1,1)},specularColorMap:{value:null},specularColorMapTransform:{value:new on},specularIntensity:{value:1},specularIntensityMap:{value:null},specularIntensityMapTransform:{value:new on},anisotropyVector:{value:new at},anisotropyMap:{value:null},anisotropyMapTransform:{value:new on}}]),vertexShader:An.meshphysical_vert,fragmentShader:An.meshphysical_frag};const fb={r:0,b:0,g:0},MI=new to,iT=new Yt;function aT(a,e,t,n,i,s,o){const r=new Gt(0);let g=s===!0?0:1,u,C,h=null,f=0,p=null;function y(x){let w=x.isScene===!0?x.background:null;return w&&w.isTexture&&(w=(x.backgroundBlurriness>0?t:e).get(w)),w}function v(x){let w=!1;const M=y(x);M===null?B(r,g):M&&M.isColor&&(B(M,1),w=!0);const H=a.xr.getEnvironmentBlendMode();H==="additive"?n.buffers.color.setClear(0,0,0,1,o):H==="alpha-blend"&&n.buffers.color.setClear(0,0,0,0,o),(a.autoClear||w)&&(n.buffers.depth.setTest(!0),n.buffers.depth.setMask(!0),n.buffers.color.setMask(!0),a.clear(a.autoClearColor,a.autoClearDepth,a.autoClearStencil))}function G(x,w){const M=y(w);M&&(M.isCubeTexture||M.mapping===IA)?(C===void 0&&(C=new vi(new hC(1,1,1),new Zl({name:"BackgroundCubeMaterial",uniforms:sA(hr.backgroundCube.uniforms),vertexShader:hr.backgroundCube.vertexShader,fragmentShader:hr.backgroundCube.fragmentShader,side:eo,depthTest:!1,depthWrite:!1,fog:!1,allowOverride:!1})),C.geometry.deleteAttribute("normal"),C.geometry.deleteAttribute("uv"),C.onBeforeRender=function(H,N,F){this.matrixWorld.copyPosition(F.matrixWorld)},Object.defineProperty(C.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),i.update(C)),MI.copy(w.backgroundRotation),MI.x*=-1,MI.y*=-1,MI.z*=-1,M.isCubeTexture&&M.isRenderTargetTexture===!1&&(MI.y*=-1,MI.z*=-1),C.material.uniforms.envMap.value=M,C.material.uniforms.flipEnvMap.value=M.isCubeTexture&&M.isRenderTargetTexture===!1?-1:1,C.material.uniforms.backgroundBlurriness.value=w.backgroundBlurriness,C.material.uniforms.backgroundIntensity.value=w.backgroundIntensity,C.material.uniforms.backgroundRotation.value.setFromMatrix4(iT.makeRotationFromEuler(MI)),C.material.toneMapped=Mn.getTransfer(M.colorSpace)!==ei,(h!==M||f!==M.version||p!==a.toneMapping)&&(C.material.needsUpdate=!0,h=M,f=M.version,p=a.toneMapping),C.layers.enableAll(),x.unshift(C,C.geometry,C.material,0,0,null)):M&&M.isTexture&&(u===void 0&&(u=new vi(new bc(2,2),new Zl({name:"BackgroundMaterial",uniforms:sA(hr.background.uniforms),vertexShader:hr.background.vertexShader,fragmentShader:hr.background.fragmentShader,side:fg,depthTest:!1,depthWrite:!1,fog:!1,allowOverride:!1})),u.geometry.deleteAttribute("normal"),Object.defineProperty(u.material,"map",{get:function(){return this.uniforms.t2D.value}}),i.update(u)),u.material.uniforms.t2D.value=M,u.material.uniforms.backgroundIntensity.value=w.backgroundIntensity,u.material.toneMapped=Mn.getTransfer(M.colorSpace)!==ei,M.matrixAutoUpdate===!0&&M.updateMatrix(),u.material.uniforms.uvTransform.value.copy(M.matrix),(h!==M||f!==M.version||p!==a.toneMapping)&&(u.material.needsUpdate=!0,h=M,f=M.version,p=a.toneMapping),u.layers.enableAll(),x.unshift(u,u.geometry,u.material,0,0,null))}function B(x,w){x.getRGB(fb,HV(a)),n.buffers.color.setClear(fb.r,fb.g,fb.b,w,o)}function R(){C!==void 0&&(C.geometry.dispose(),C.material.dispose(),C=void 0),u!==void 0&&(u.geometry.dispose(),u.material.dispose(),u=void 0)}return{getClearColor:function(){return r},setClearColor:function(x,w=1){r.set(x),g=w,B(r,g)},getClearAlpha:function(){return g},setClearAlpha:function(x){g=x,B(r,g)},render:v,addToRenderList:G,dispose:R}}function sT(a,e){const t=a.getParameter(a.MAX_VERTEX_ATTRIBS),n={},i=f(null);let s=i,o=!1;function r(X,U,O,P,ie){let le=!1;const T=h(P,O,U);s!==T&&(s=T,u(s.object)),le=p(X,P,O,ie),le&&y(X,P,O,ie),ie!==null&&e.update(ie,a.ELEMENT_ARRAY_BUFFER),(le||o)&&(o=!1,w(X,U,O,P),ie!==null&&a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,e.get(ie).buffer))}function g(){return a.createVertexArray()}function u(X){return a.bindVertexArray(X)}function C(X){return a.deleteVertexArray(X)}function h(X,U,O){const P=O.wireframe===!0;let ie=n[X.id];ie===void 0&&(ie={},n[X.id]=ie);let le=ie[U.id];le===void 0&&(le={},ie[U.id]=le);let T=le[P];return T===void 0&&(T=f(g()),le[P]=T),T}function f(X){const U=[],O=[],P=[];for(let ie=0;ie<t;ie++)U[ie]=0,O[ie]=0,P[ie]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:U,enabledAttributes:O,attributeDivisors:P,object:X,attributes:{},index:null}}function p(X,U,O,P){const ie=s.attributes,le=U.attributes;let T=0;const J=O.getAttributes();for(const Q in J)if(J[Q].location>=0){const L=ie[Q];let D=le[Q];if(D===void 0&&(Q==="instanceMatrix"&&X.instanceMatrix&&(D=X.instanceMatrix),Q==="instanceColor"&&X.instanceColor&&(D=X.instanceColor)),L===void 0||L.attribute!==D||D&&L.data!==D.data)return!0;T++}return s.attributesNum!==T||s.index!==P}function y(X,U,O,P){const ie={},le=U.attributes;let T=0;const J=O.getAttributes();for(const Q in J)if(J[Q].location>=0){let L=le[Q];L===void 0&&(Q==="instanceMatrix"&&X.instanceMatrix&&(L=X.instanceMatrix),Q==="instanceColor"&&X.instanceColor&&(L=X.instanceColor));const D={};D.attribute=L,L&&L.data&&(D.data=L.data),ie[Q]=D,T++}s.attributes=ie,s.attributesNum=T,s.index=P}function v(){const X=s.newAttributes;for(let U=0,O=X.length;U<O;U++)X[U]=0}function G(X){B(X,0)}function B(X,U){const O=s.newAttributes,P=s.enabledAttributes,ie=s.attributeDivisors;O[X]=1,P[X]===0&&(a.enableVertexAttribArray(X),P[X]=1),ie[X]!==U&&(a.vertexAttribDivisor(X,U),ie[X]=U)}function R(){const X=s.newAttributes,U=s.enabledAttributes;for(let O=0,P=U.length;O<P;O++)U[O]!==X[O]&&(a.disableVertexAttribArray(O),U[O]=0)}function x(X,U,O,P,ie,le,T){T===!0?a.vertexAttribIPointer(X,U,O,ie,le):a.vertexAttribPointer(X,U,O,P,ie,le)}function w(X,U,O,P){v();const ie=P.attributes,le=O.getAttributes(),T=U.defaultAttributeValues;for(const J in le){const Q=le[J];if(Q.location>=0){let se=ie[J];if(se===void 0&&(J==="instanceMatrix"&&X.instanceMatrix&&(se=X.instanceMatrix),J==="instanceColor"&&X.instanceColor&&(se=X.instanceColor)),se!==void 0){const L=se.normalized,D=se.itemSize,ne=e.get(se);if(ne===void 0)continue;const oe=ne.buffer,j=ne.type,re=ne.bytesPerElement,pe=j===a.INT||j===a.UNSIGNED_INT||se.gpuType===ry;if(se.isInterleavedBufferAttribute){const me=se.data,be=me.stride,$e=se.offset;if(me.isInstancedInterleavedBuffer){for(let qe=0;qe<Q.locationSize;qe++)B(Q.location+qe,me.meshPerAttribute);X.isInstancedMesh!==!0&&P._maxInstanceCount===void 0&&(P._maxInstanceCount=me.meshPerAttribute*me.count)}else for(let qe=0;qe<Q.locationSize;qe++)G(Q.location+qe);a.bindBuffer(a.ARRAY_BUFFER,oe);for(let qe=0;qe<Q.locationSize;qe++)x(Q.location+qe,D/Q.locationSize,j,L,be*re,($e+D/Q.locationSize*qe)*re,pe)}else{if(se.isInstancedBufferAttribute){for(let me=0;me<Q.locationSize;me++)B(Q.location+me,se.meshPerAttribute);X.isInstancedMesh!==!0&&P._maxInstanceCount===void 0&&(P._maxInstanceCount=se.meshPerAttribute*se.count)}else for(let me=0;me<Q.locationSize;me++)G(Q.location+me);a.bindBuffer(a.ARRAY_BUFFER,oe);for(let me=0;me<Q.locationSize;me++)x(Q.location+me,D/Q.locationSize,j,L,D*re,D/Q.locationSize*me*re,pe)}}else if(T!==void 0){const L=T[J];if(L!==void 0)switch(L.length){case 2:a.vertexAttrib2fv(Q.location,L);break;case 3:a.vertexAttrib3fv(Q.location,L);break;case 4:a.vertexAttrib4fv(Q.location,L);break;default:a.vertexAttrib1fv(Q.location,L)}}}}R()}function M(){F();for(const X in n){const U=n[X];for(const O in U){const P=U[O];for(const ie in P)C(P[ie].object),delete P[ie];delete U[O]}delete n[X]}}function H(X){if(n[X.id]===void 0)return;const U=n[X.id];for(const O in U){const P=U[O];for(const ie in P)C(P[ie].object),delete P[ie];delete U[O]}delete n[X.id]}function N(X){for(const U in n){const O=n[U];if(O[X.id]===void 0)continue;const P=O[X.id];for(const ie in P)C(P[ie].object),delete P[ie];delete O[X.id]}}function F(){Y(),o=!0,s!==i&&(s=i,u(s.object))}function Y(){i.geometry=null,i.program=null,i.wireframe=!1}return{setup:r,reset:F,resetDefaultState:Y,dispose:M,releaseStatesOfGeometry:H,releaseStatesOfProgram:N,initAttributes:v,enableAttribute:G,disableUnusedAttributes:R}}function oT(a,e,t){let n;function i(u){n=u}function s(u,C){a.drawArrays(n,u,C),t.update(C,n,1)}function o(u,C,h){h!==0&&(a.drawArraysInstanced(n,u,C,h),t.update(C,n,h))}function r(u,C,h){if(h===0)return;e.get("WEBGL_multi_draw").multiDrawArraysWEBGL(n,u,0,C,0,h);let p=0;for(let y=0;y<h;y++)p+=C[y];t.update(p,n,1)}function g(u,C,h,f){if(h===0)return;const p=e.get("WEBGL_multi_draw");if(p===null)for(let y=0;y<u.length;y++)o(u[y],C[y],f[y]);else{p.multiDrawArraysInstancedWEBGL(n,u,0,C,0,f,0,h);let y=0;for(let v=0;v<h;v++)y+=C[v]*f[v];t.update(y,n,1)}}this.setMode=i,this.render=s,this.renderInstances=o,this.renderMultiDraw=r,this.renderMultiDrawInstances=g}function lT(a,e,t,n){let i;function s(){if(i!==void 0)return i;if(e.has("EXT_texture_filter_anisotropic")===!0){const N=e.get("EXT_texture_filter_anisotropic");i=a.getParameter(N.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else i=0;return i}function o(N){return!(N!==Gs&&n.convert(N)!==a.getParameter(a.IMPLEMENTATION_COLOR_READ_FORMAT))}function r(N){const F=N===dC&&(e.has("EXT_color_buffer_half_float")||e.has("EXT_color_buffer_float"));return!(N!==vl&&n.convert(N)!==a.getParameter(a.IMPLEMENTATION_COLOR_READ_TYPE)&&N!==qs&&!F)}function g(N){if(N==="highp"){if(a.getShaderPrecisionFormat(a.VERTEX_SHADER,a.HIGH_FLOAT).precision>0&&a.getShaderPrecisionFormat(a.FRAGMENT_SHADER,a.HIGH_FLOAT).precision>0)return"highp";N="mediump"}return N==="mediump"&&a.getShaderPrecisionFormat(a.VERTEX_SHADER,a.MEDIUM_FLOAT).precision>0&&a.getShaderPrecisionFormat(a.FRAGMENT_SHADER,a.MEDIUM_FLOAT).precision>0?"mediump":"lowp"}let u=t.precision!==void 0?t.precision:"highp";const C=g(u);C!==u&&(console.warn("THREE.WebGLRenderer:",u,"not supported, using",C,"instead."),u=C);const h=t.logarithmicDepthBuffer===!0,f=t.reverseDepthBuffer===!0&&e.has("EXT_clip_control"),p=a.getParameter(a.MAX_TEXTURE_IMAGE_UNITS),y=a.getParameter(a.MAX_VERTEX_TEXTURE_IMAGE_UNITS),v=a.getParameter(a.MAX_TEXTURE_SIZE),G=a.getParameter(a.MAX_CUBE_MAP_TEXTURE_SIZE),B=a.getParameter(a.MAX_VERTEX_ATTRIBS),R=a.getParameter(a.MAX_VERTEX_UNIFORM_VECTORS),x=a.getParameter(a.MAX_VARYING_VECTORS),w=a.getParameter(a.MAX_FRAGMENT_UNIFORM_VECTORS),M=y>0,H=a.getParameter(a.MAX_SAMPLES);return{isWebGL2:!0,getMaxAnisotropy:s,getMaxPrecision:g,textureFormatReadable:o,textureTypeReadable:r,precision:u,logarithmicDepthBuffer:h,reverseDepthBuffer:f,maxTextures:p,maxVertexTextures:y,maxTextureSize:v,maxCubemapSize:G,maxAttributes:B,maxVertexUniforms:R,maxVaryings:x,maxFragmentUniforms:w,vertexTextures:M,maxSamples:H}}function rT(a){const e=this;let t=null,n=0,i=!1,s=!1;const o=new nc,r=new on,g={value:null,needsUpdate:!1};this.uniform=g,this.numPlanes=0,this.numIntersection=0,this.init=function(h,f){const p=h.length!==0||f||n!==0||i;return i=f,n=h.length,p},this.beginShadows=function(){s=!0,C(null)},this.endShadows=function(){s=!1},this.setGlobalState=function(h,f){t=C(h,f,0)},this.setState=function(h,f,p){const y=h.clippingPlanes,v=h.clipIntersection,G=h.clipShadows,B=a.get(h);if(!i||y===null||y.length===0||s&&!G)s?C(null):u();else{const R=s?0:n,x=R*4;let w=B.clippingState||null;g.value=w,w=C(y,f,x,p);for(let M=0;M!==x;++M)w[M]=t[M];B.clippingState=w,this.numIntersection=v?this.numPlanes:0,this.numPlanes+=R}};function u(){g.value!==t&&(g.value=t,g.needsUpdate=n>0),e.numPlanes=n,e.numIntersection=0}function C(h,f,p,y){const v=h!==null?h.length:0;let G=null;if(v!==0){if(G=g.value,y!==!0||G===null){const B=p+v*4,R=f.matrixWorldInverse;r.getNormalMatrix(R),(G===null||G.length<B)&&(G=new Float32Array(B));for(let x=0,w=p;x!==v;++x,w+=4)o.copy(h[x]).applyMatrix4(R,r),o.normal.toArray(G,w),G[w+3]=o.constant}g.value=G,g.needsUpdate=!0}return e.numPlanes=v,e.numIntersection=0,G}}function gT(a){let e=new WeakMap;function t(o,r){return r===Sf?o.mapping=hc:r===Rf&&(o.mapping=Gu),o}function n(o){if(o&&o.isTexture){const r=o.mapping;if(r===Sf||r===Rf)if(e.has(o)){const g=e.get(o).texture;return t(g,o.mapping)}else{const g=o.image;if(g&&g.height>0){const u=new NV(g.height);return u.fromEquirectangularTexture(a,o),e.set(o,u),o.addEventListener("dispose",i),t(u.texture,o.mapping)}else return null}}return o}function i(o){const r=o.target;r.removeEventListener("dispose",i);const g=e.get(r);g!==void 0&&(e.delete(r),g.dispose())}function s(){e=new WeakMap}return{get:n,dispose:s}}const Ld=4,rw=[.125,.215,.35,.446,.526,.582],zI=20,SB=new pr,gw=new Gt;let RB=null,wB=0,xB=0,WB=!1;const EI=(1+Math.sqrt(5))/2,Hd=1/EI,cw=[new ae(-EI,Hd,0),new ae(EI,Hd,0),new ae(-Hd,0,EI),new ae(Hd,0,EI),new ae(0,EI,-Hd),new ae(0,EI,Hd),new ae(-1,1,-1),new ae(1,1,-1),new ae(-1,1,1),new ae(1,1,1)],cT=new ae;class Qv{constructor(e){this._renderer=e,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._lodPlanes=[],this._sizeLods=[],this._sigmas=[],this._blurMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._compileMaterial(this._blurMaterial)}fromScene(e,t=0,n=.1,i=100,s={}){const{size:o=256,position:r=cT}=s;RB=this._renderer.getRenderTarget(),wB=this._renderer.getActiveCubeFace(),xB=this._renderer.getActiveMipmapLevel(),WB=this._renderer.xr.enabled,this._renderer.xr.enabled=!1,this._setSize(o);const g=this._allocateTargets();return g.depthBuffer=!0,this._sceneToCubeUV(e,n,i,g,r),t>0&&this._blur(g,0,0,t),this._applyPMREM(g),this._cleanup(g),g}fromEquirectangular(e,t=null){return this._fromTexture(e,t)}fromCubemap(e,t=null){return this._fromTexture(e,t)}compileCubemapShader(){this._cubemapMaterial===null&&(this._cubemapMaterial=Cw(),this._compileMaterial(this._cubemapMaterial))}compileEquirectangularShader(){this._equirectMaterial===null&&(this._equirectMaterial=Iw(),this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),this._cubemapMaterial!==null&&this._cubemapMaterial.dispose(),this._equirectMaterial!==null&&this._equirectMaterial.dispose()}_setSize(e){this._lodMax=Math.floor(Math.log2(e)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){this._blurMaterial!==null&&this._blurMaterial.dispose(),this._pingPongRenderTarget!==null&&this._pingPongRenderTarget.dispose();for(let e=0;e<this._lodPlanes.length;e++)this._lodPlanes[e].dispose()}_cleanup(e){this._renderer.setRenderTarget(RB,wB,xB),this._renderer.xr.enabled=WB,e.scissorTest=!1,pb(e,0,0,e.width,e.height)}_fromTexture(e,t){e.mapping===hc||e.mapping===Gu?this._setSize(e.image.length===0?16:e.image[0].width||e.image[0].image.width):this._setSize(e.image.width/4),RB=this._renderer.getRenderTarget(),wB=this._renderer.getActiveCubeFace(),xB=this._renderer.getActiveMipmapLevel(),WB=this._renderer.xr.enabled,this._renderer.xr.enabled=!1;const n=t||this._allocateTargets();return this._textureToCubeUV(e,n),this._applyPMREM(n),this._cleanup(n),n}_allocateTargets(){const e=3*Math.max(this._cubeSize,112),t=4*this._cubeSize,n={magFilter:Bi,minFilter:Bi,generateMipmaps:!1,type:dC,format:Gs,colorSpace:vu,depthBuffer:!1},i=uw(e,t,n);if(this._pingPongRenderTarget===null||this._pingPongRenderTarget.width!==e||this._pingPongRenderTarget.height!==t){this._pingPongRenderTarget!==null&&this._dispose(),this._pingPongRenderTarget=uw(e,t,n);const{_lodMax:s}=this;({sizeLods:this._sizeLods,lodPlanes:this._lodPlanes,sigmas:this._sigmas}=uT(s)),this._blurMaterial=IT(s,e,t)}return i}_compileMaterial(e){const t=new vi(this._lodPlanes[0],e);this._renderer.compile(t,SB)}_sceneToCubeUV(e,t,n,i,s){const g=new Xi(90,1,t,n),u=[1,-1,1,1,1,1],C=[1,1,1,-1,-1,-1],h=this._renderer,f=h.autoClear,p=h.toneMapping;h.getClearColor(gw),h.toneMapping=Ag,h.autoClear=!1;const y=new wo({name:"PMREM.Background",side:eo,depthWrite:!1,depthTest:!1}),v=new vi(new hC,y);let G=!1;const B=e.background;B?B.isColor&&(y.color.copy(B),e.background=null,G=!0):(y.color.copy(gw),G=!0);for(let R=0;R<6;R++){const x=R%3;x===0?(g.up.set(0,u[R],0),g.position.set(s.x,s.y,s.z),g.lookAt(s.x+C[R],s.y,s.z)):x===1?(g.up.set(0,0,u[R]),g.position.set(s.x,s.y,s.z),g.lookAt(s.x,s.y+C[R],s.z)):(g.up.set(0,u[R],0),g.position.set(s.x,s.y,s.z),g.lookAt(s.x,s.y,s.z+C[R]));const w=this._cubeSize;pb(i,x*w,R>2?w:0,w,w),h.setRenderTarget(i),G&&h.render(v,g),h.render(e,g)}v.geometry.dispose(),v.material.dispose(),h.toneMapping=p,h.autoClear=f,e.background=B}_textureToCubeUV(e,t){const n=this._renderer,i=e.mapping===hc||e.mapping===Gu;i?(this._cubemapMaterial===null&&(this._cubemapMaterial=Cw()),this._cubemapMaterial.uniforms.flipEnvMap.value=e.isRenderTargetTexture===!1?-1:1):this._equirectMaterial===null&&(this._equirectMaterial=Iw());const s=i?this._cubemapMaterial:this._equirectMaterial,o=new vi(this._lodPlanes[0],s),r=s.uniforms;r.envMap.value=e;const g=this._cubeSize;pb(t,0,0,3*g,2*g),n.setRenderTarget(t),n.render(o,SB)}_applyPMREM(e){const t=this._renderer,n=t.autoClear;t.autoClear=!1;const i=this._lodPlanes.length;for(let s=1;s<i;s++){const o=Math.sqrt(this._sigmas[s]*this._sigmas[s]-this._sigmas[s-1]*this._sigmas[s-1]),r=cw[(i-s-1)%cw.length];this._blur(e,s-1,s,o,r)}t.autoClear=n}_blur(e,t,n,i,s){const o=this._pingPongRenderTarget;this._halfBlur(e,o,t,n,i,"latitudinal",s),this._halfBlur(o,e,n,n,i,"longitudinal",s)}_halfBlur(e,t,n,i,s,o,r){const g=this._renderer,u=this._blurMaterial;o!=="latitudinal"&&o!=="longitudinal"&&console.error("blur direction must be either latitudinal or longitudinal!");const C=3,h=new vi(this._lodPlanes[i],u),f=u.uniforms,p=this._sizeLods[n]-1,y=isFinite(s)?Math.PI/(2*p):2*Math.PI/(2*zI-1),v=s/y,G=isFinite(s)?1+Math.floor(C*v):zI;G>zI&&console.warn(`sigmaRadians, ${s}, is too large and will clip, as it requested ${G} samples when the maximum is set to ${zI}`);const B=[];let R=0;for(let N=0;N<zI;++N){const F=N/v,Y=Math.exp(-F*F/2);B.push(Y),N===0?R+=Y:N<G&&(R+=2*Y)}for(let N=0;N<B.length;N++)B[N]=B[N]/R;f.envMap.value=e.texture,f.samples.value=G,f.weights.value=B,f.latitudinal.value=o==="latitudinal",r&&(f.poleAxis.value=r);const{_lodMax:x}=this;f.dTheta.value=y,f.mipInt.value=x-n;const w=this._sizeLods[i],M=3*w*(i>x-Ld?i-x+Ld:0),H=4*(this._cubeSize-w);pb(t,M,H,3*w,2*w),g.setRenderTarget(t),g.render(h,SB)}}function uT(a){const e=[],t=[],n=[];let i=a;const s=a-Ld+1+rw.length;for(let o=0;o<s;o++){const r=Math.pow(2,i);t.push(r);let g=1/r;o>a-Ld?g=rw[o-a+Ld-1]:o===0&&(g=0),n.push(g);const u=1/(r-2),C=-u,h=1+u,f=[C,C,h,C,h,h,C,C,h,h,C,h],p=6,y=6,v=3,G=2,B=1,R=new Float32Array(v*y*p),x=new Float32Array(G*y*p),w=new Float32Array(B*y*p);for(let H=0;H<p;H++){const N=H%3*2/3-1,F=H>2?0:-1,Y=[N,F,0,N+2/3,F,0,N+2/3,F+1,0,N,F,0,N+2/3,F+1,0,N,F+1,0];R.set(Y,v*y*H),x.set(f,G*y*H);const X=[H,H,H,H,H,H];w.set(X,B*y*H)}const M=new rn;M.setAttribute("position",new En(R,v)),M.setAttribute("uv",new En(x,G)),M.setAttribute("faceIndex",new En(w,B)),e.push(M),i>Ld&&i--}return{lodPlanes:e,sizeLods:t,sigmas:n}}function uw(a,e,t){const n=new br(a,e,t);return n.texture.mapping=IA,n.texture.name="PMREM.cubeUv",n.scissorTest=!0,n}function pb(a,e,t,n,i){a.viewport.set(e,t,n,i),a.scissor.set(e,t,n,i)}function IT(a,e,t){const n=new Float32Array(zI),i=new ae(0,1,0);return new Zl({name:"SphericalGaussianBlur",defines:{n:zI,CUBEUV_TEXEL_WIDTH:1/e,CUBEUV_TEXEL_HEIGHT:1/t,CUBEUV_MAX_MIP:`${a}.0`},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:n},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:i}},vertexShader:RZ(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;
			uniform int samples;
			uniform float weights[ n ];
			uniform bool latitudinal;
			uniform float dTheta;
			uniform float mipInt;
			uniform vec3 poleAxis;

			#define ENVMAP_TYPE_CUBE_UV
			#include <cube_uv_reflection_fragment>

			vec3 getSample( float theta, vec3 axis ) {

				float cosTheta = cos( theta );
				// Rodrigues' axis-angle rotation
				vec3 sampleDirection = vOutputDirection * cosTheta
					+ cross( axis, vOutputDirection ) * sin( theta )
					+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );

				return bilinearCubeUV( envMap, sampleDirection, mipInt );

			}

			void main() {

				vec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );

				if ( all( equal( axis, vec3( 0.0 ) ) ) ) {

					axis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );

				}

				axis = normalize( axis );

				gl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );
				gl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );

				for ( int i = 1; i < n; i++ ) {

					if ( i >= samples ) {

						break;

					}

					float theta = dTheta * float( i );
					gl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );
					gl_FragColor.rgb += weights[ i ] * getSample( theta, axis );

				}

			}
		`,blending:cc,depthTest:!1,depthWrite:!1})}function Iw(){return new Zl({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null}},vertexShader:RZ(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;

			#include <common>

			void main() {

				vec3 outputDirection = normalize( vOutputDirection );
				vec2 uv = equirectUv( outputDirection );

				gl_FragColor = vec4( texture2D ( envMap, uv ).rgb, 1.0 );

			}
		`,blending:cc,depthTest:!1,depthWrite:!1})}function Cw(){return new Zl({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},flipEnvMap:{value:-1}},vertexShader:RZ(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			uniform float flipEnvMap;

			varying vec3 vOutputDirection;

			uniform samplerCube envMap;

			void main() {

				gl_FragColor = textureCube( envMap, vec3( flipEnvMap * vOutputDirection.x, vOutputDirection.yz ) );

			}
		`,blending:cc,depthTest:!1,depthWrite:!1})}function RZ(){return`

		precision mediump float;
		precision mediump int;

		attribute float faceIndex;

		varying vec3 vOutputDirection;

		// RH coordinate system; PMREM face-indexing convention
		vec3 getDirection( vec2 uv, float face ) {

			uv = 2.0 * uv - 1.0;

			vec3 direction = vec3( uv, 1.0 );

			if ( face == 0.0 ) {

				direction = direction.zyx; // ( 1, v, u ) pos x

			} else if ( face == 1.0 ) {

				direction = direction.xzy;
				direction.xz *= -1.0; // ( -u, 1, -v ) pos y

			} else if ( face == 2.0 ) {

				direction.x *= -1.0; // ( -u, v, 1 ) pos z

			} else if ( face == 3.0 ) {

				direction = direction.zyx;
				direction.xz *= -1.0; // ( -1, v, -u ) neg x

			} else if ( face == 4.0 ) {

				direction = direction.xzy;
				direction.xy *= -1.0; // ( -u, -1, v ) neg y

			} else if ( face == 5.0 ) {

				direction.z *= -1.0; // ( u, v, -1 ) neg z

			}

			return direction;

		}

		void main() {

			vOutputDirection = getDirection( uv, faceIndex );
			gl_Position = vec4( position, 1.0 );

		}
	`}function CT(a){let e=new WeakMap,t=null;function n(r){if(r&&r.isTexture){const g=r.mapping,u=g===Sf||g===Rf,C=g===hc||g===Gu;if(u||C){let h=e.get(r);const f=h!==void 0?h.texture.pmremVersion:0;if(r.isRenderTargetTexture&&r.pmremVersion!==f)return t===null&&(t=new Qv(a)),h=u?t.fromEquirectangular(r,h):t.fromCubemap(r,h),h.texture.pmremVersion=r.pmremVersion,e.set(r,h),h.texture;if(h!==void 0)return h.texture;{const p=r.image;return u&&p&&p.height>0||C&&p&&i(p)?(t===null&&(t=new Qv(a)),h=u?t.fromEquirectangular(r):t.fromCubemap(r),h.texture.pmremVersion=r.pmremVersion,e.set(r,h),r.addEventListener("dispose",s),h.texture):null}}}return r}function i(r){let g=0;const u=6;for(let C=0;C<u;C++)r[C]!==void 0&&g++;return g===u}function s(r){const g=r.target;g.removeEventListener("dispose",s);const u=e.get(g);u!==void 0&&(e.delete(g),u.dispose())}function o(){e=new WeakMap,t!==null&&(t.dispose(),t=null)}return{get:n,dispose:o}}function dT(a){const e={};function t(n){if(e[n]!==void 0)return e[n];let i;switch(n){case"WEBGL_depth_texture":i=a.getExtension("WEBGL_depth_texture")||a.getExtension("MOZ_WEBGL_depth_texture")||a.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":i=a.getExtension("EXT_texture_filter_anisotropic")||a.getExtension("MOZ_EXT_texture_filter_anisotropic")||a.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":i=a.getExtension("WEBGL_compressed_texture_s3tc")||a.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||a.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":i=a.getExtension("WEBGL_compressed_texture_pvrtc")||a.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:i=a.getExtension(n)}return e[n]=i,i}return{has:function(n){return t(n)!==null},init:function(){t("EXT_color_buffer_float"),t("WEBGL_clip_cull_distance"),t("OES_texture_float_linear"),t("EXT_color_buffer_half_float"),t("WEBGL_multisampled_render_to_texture"),t("WEBGL_render_shared_exponent")},get:function(n){const i=t(n);return i===null&&Dd("THREE.WebGLRenderer: "+n+" extension not supported."),i}}}function AT(a,e,t,n){const i={},s=new WeakMap;function o(h){const f=h.target;f.index!==null&&e.remove(f.index);for(const y in f.attributes)e.remove(f.attributes[y]);f.removeEventListener("dispose",o),delete i[f.id];const p=s.get(f);p&&(e.remove(p),s.delete(f)),n.releaseStatesOfGeometry(f),f.isInstancedBufferGeometry===!0&&delete f._maxInstanceCount,t.memory.geometries--}function r(h,f){return i[f.id]===!0||(f.addEventListener("dispose",o),i[f.id]=!0,t.memory.geometries++),f}function g(h){const f=h.attributes;for(const p in f)e.update(f[p],a.ARRAY_BUFFER)}function u(h){const f=[],p=h.index,y=h.attributes.position;let v=0;if(p!==null){const R=p.array;v=p.version;for(let x=0,w=R.length;x<w;x+=3){const M=R[x+0],H=R[x+1],N=R[x+2];f.push(M,H,H,N,N,M)}}else if(y!==void 0){const R=y.array;v=y.version;for(let x=0,w=R.length/3-1;x<w;x+=3){const M=x+0,H=x+1,N=x+2;f.push(M,H,H,N,N,M)}}else return;const G=new(xV(f)?tZ:eZ)(f,1);G.version=v;const B=s.get(h);B&&e.remove(B),s.set(h,G)}function C(h){const f=s.get(h);if(f){const p=h.index;p!==null&&f.version<p.version&&u(h)}else u(h);return s.get(h)}return{get:r,update:g,getWireframeAttribute:C}}function hT(a,e,t){let n;function i(f){n=f}let s,o;function r(f){s=f.type,o=f.bytesPerElement}function g(f,p){a.drawElements(n,p,s,f*o),t.update(p,n,1)}function u(f,p,y){y!==0&&(a.drawElementsInstanced(n,p,s,f*o,y),t.update(p,n,y))}function C(f,p,y){if(y===0)return;e.get("WEBGL_multi_draw").multiDrawElementsWEBGL(n,p,0,s,f,0,y);let G=0;for(let B=0;B<y;B++)G+=p[B];t.update(G,n,1)}function h(f,p,y,v){if(y===0)return;const G=e.get("WEBGL_multi_draw");if(G===null)for(let B=0;B<f.length;B++)u(f[B]/o,p[B],v[B]);else{G.multiDrawElementsInstancedWEBGL(n,p,0,s,f,0,v,0,y);let B=0;for(let R=0;R<y;R++)B+=p[R]*v[R];t.update(B,n,1)}}this.setMode=i,this.setIndex=r,this.render=g,this.renderInstances=u,this.renderMultiDraw=C,this.renderMultiDrawInstances=h}function fT(a){const e={geometries:0,textures:0},t={frame:0,calls:0,triangles:0,points:0,lines:0};function n(s,o,r){switch(t.calls++,o){case a.TRIANGLES:t.triangles+=r*(s/3);break;case a.LINES:t.lines+=r*(s/2);break;case a.LINE_STRIP:t.lines+=r*(s-1);break;case a.LINE_LOOP:t.lines+=r*s;break;case a.POINTS:t.points+=r*s;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",o);break}}function i(){t.calls=0,t.triangles=0,t.points=0,t.lines=0}return{memory:e,render:t,programs:null,autoReset:!0,reset:i,update:n}}function pT(a,e,t){const n=new WeakMap,i=new Hn;function s(o,r,g){const u=o.morphTargetInfluences,C=r.morphAttributes.position||r.morphAttributes.normal||r.morphAttributes.color,h=C!==void 0?C.length:0;let f=n.get(r);if(f===void 0||f.count!==h){let X=function(){F.dispose(),n.delete(r),r.removeEventListener("dispose",X)};var p=X;f!==void 0&&f.texture.dispose();const y=r.morphAttributes.position!==void 0,v=r.morphAttributes.normal!==void 0,G=r.morphAttributes.color!==void 0,B=r.morphAttributes.position||[],R=r.morphAttributes.normal||[],x=r.morphAttributes.color||[];let w=0;y===!0&&(w=1),v===!0&&(w=2),G===!0&&(w=3);let M=r.attributes.position.count*w,H=1;M>e.maxTextureSize&&(H=Math.ceil(M/e.maxTextureSize),M=e.maxTextureSize);const N=new Float32Array(M*H*4*h),F=new Ay(N,M,H,h);F.type=qs,F.needsUpdate=!0;const Y=w*4;for(let U=0;U<h;U++){const O=B[U],P=R[U],ie=x[U],le=M*H*4*U;for(let T=0;T<O.count;T++){const J=T*Y;y===!0&&(i.fromBufferAttribute(O,T),N[le+J+0]=i.x,N[le+J+1]=i.y,N[le+J+2]=i.z,N[le+J+3]=0),v===!0&&(i.fromBufferAttribute(P,T),N[le+J+4]=i.x,N[le+J+5]=i.y,N[le+J+6]=i.z,N[le+J+7]=0),G===!0&&(i.fromBufferAttribute(ie,T),N[le+J+8]=i.x,N[le+J+9]=i.y,N[le+J+10]=i.z,N[le+J+11]=ie.itemSize===4?i.w:1)}}f={count:h,texture:F,size:new at(M,H)},n.set(r,f),r.addEventListener("dispose",X)}if(o.isInstancedMesh===!0&&o.morphTexture!==null)g.getUniforms().setValue(a,"morphTexture",o.morphTexture,t);else{let y=0;for(let G=0;G<u.length;G++)y+=u[G];const v=r.morphTargetsRelative?1:1-y;g.getUniforms().setValue(a,"morphTargetBaseInfluence",v),g.getUniforms().setValue(a,"morphTargetInfluences",u)}g.getUniforms().setValue(a,"morphTargetsTexture",f.texture,t),g.getUniforms().setValue(a,"morphTargetsTextureSize",f.size)}return{update:s}}function mT(a,e,t,n){let i=new WeakMap;function s(g){const u=n.render.frame,C=g.geometry,h=e.get(g,C);if(i.get(h)!==u&&(e.update(h),i.set(h,u)),g.isInstancedMesh&&(g.hasEventListener("dispose",r)===!1&&g.addEventListener("dispose",r),i.get(g)!==u&&(t.update(g.instanceMatrix,a.ARRAY_BUFFER),g.instanceColor!==null&&t.update(g.instanceColor,a.ARRAY_BUFFER),i.set(g,u))),g.isSkinnedMesh){const f=g.skeleton;i.get(f)!==u&&(f.update(),i.set(f,u))}return h}function o(){i=new WeakMap}function r(g){const u=g.target;u.removeEventListener("dispose",r),t.remove(u.instanceMatrix),u.instanceColor!==null&&t.remove(u.instanceColor)}return{update:s,dispose:o}}const RM=new Zi,dw=new Zy(1,1),wM=new Ay,xM=new hy,WM=new Df,Aw=[],hw=[],fw=new Float32Array(16),pw=new Float32Array(9),mw=new Float32Array(4);function AA(a,e,t){const n=a[0];if(n<=0||n>0)return a;const i=e*t;let s=Aw[i];if(s===void 0&&(s=new Float32Array(i),Aw[i]=s),e!==0){n.toArray(s,0);for(let o=1,r=0;o!==e;++o)r+=t,a[o].toArray(s,r)}return s}function wa(a,e){if(a.length!==e.length)return!1;for(let t=0,n=a.length;t<n;t++)if(a[t]!==e[t])return!1;return!0}function xa(a,e){for(let t=0,n=e.length;t<n;t++)a[t]=e[t]}function _y(a,e){let t=hw[e];t===void 0&&(t=new Int32Array(e),hw[e]=t);for(let n=0;n!==e;++n)t[n]=a.allocateTextureUnit();return t}function bT(a,e){const t=this.cache;t[0]!==e&&(a.uniform1f(this.addr,e),t[0]=e)}function yT(a,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y)&&(a.uniform2f(this.addr,e.x,e.y),t[0]=e.x,t[1]=e.y);else{if(wa(t,e))return;a.uniform2fv(this.addr,e),xa(t,e)}}function GT(a,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z)&&(a.uniform3f(this.addr,e.x,e.y,e.z),t[0]=e.x,t[1]=e.y,t[2]=e.z);else if(e.r!==void 0)(t[0]!==e.r||t[1]!==e.g||t[2]!==e.b)&&(a.uniform3f(this.addr,e.r,e.g,e.b),t[0]=e.r,t[1]=e.g,t[2]=e.b);else{if(wa(t,e))return;a.uniform3fv(this.addr,e),xa(t,e)}}function BT(a,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z||t[3]!==e.w)&&(a.uniform4f(this.addr,e.x,e.y,e.z,e.w),t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.w);else{if(wa(t,e))return;a.uniform4fv(this.addr,e),xa(t,e)}}function vT(a,e){const t=this.cache,n=e.elements;if(n===void 0){if(wa(t,e))return;a.uniformMatrix2fv(this.addr,!1,e),xa(t,e)}else{if(wa(t,n))return;mw.set(n),a.uniformMatrix2fv(this.addr,!1,mw),xa(t,n)}}function ZT(a,e){const t=this.cache,n=e.elements;if(n===void 0){if(wa(t,e))return;a.uniformMatrix3fv(this.addr,!1,e),xa(t,e)}else{if(wa(t,n))return;pw.set(n),a.uniformMatrix3fv(this.addr,!1,pw),xa(t,n)}}function ST(a,e){const t=this.cache,n=e.elements;if(n===void 0){if(wa(t,e))return;a.uniformMatrix4fv(this.addr,!1,e),xa(t,e)}else{if(wa(t,n))return;fw.set(n),a.uniformMatrix4fv(this.addr,!1,fw),xa(t,n)}}function RT(a,e){const t=this.cache;t[0]!==e&&(a.uniform1i(this.addr,e),t[0]=e)}function wT(a,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y)&&(a.uniform2i(this.addr,e.x,e.y),t[0]=e.x,t[1]=e.y);else{if(wa(t,e))return;a.uniform2iv(this.addr,e),xa(t,e)}}function xT(a,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z)&&(a.uniform3i(this.addr,e.x,e.y,e.z),t[0]=e.x,t[1]=e.y,t[2]=e.z);else{if(wa(t,e))return;a.uniform3iv(this.addr,e),xa(t,e)}}function WT(a,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z||t[3]!==e.w)&&(a.uniform4i(this.addr,e.x,e.y,e.z,e.w),t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.w);else{if(wa(t,e))return;a.uniform4iv(this.addr,e),xa(t,e)}}function VT(a,e){const t=this.cache;t[0]!==e&&(a.uniform1ui(this.addr,e),t[0]=e)}function MT(a,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y)&&(a.uniform2ui(this.addr,e.x,e.y),t[0]=e.x,t[1]=e.y);else{if(wa(t,e))return;a.uniform2uiv(this.addr,e),xa(t,e)}}function HT(a,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z)&&(a.uniform3ui(this.addr,e.x,e.y,e.z),t[0]=e.x,t[1]=e.y,t[2]=e.z);else{if(wa(t,e))return;a.uniform3uiv(this.addr,e),xa(t,e)}}function XT(a,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z||t[3]!==e.w)&&(a.uniform4ui(this.addr,e.x,e.y,e.z,e.w),t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.w);else{if(wa(t,e))return;a.uniform4uiv(this.addr,e),xa(t,e)}}function NT(a,e,t){const n=this.cache,i=t.allocateTextureUnit();n[0]!==i&&(a.uniform1i(this.addr,i),n[0]=i);let s;this.type===a.SAMPLER_2D_SHADOW?(dw.compareFunction=j2,s=dw):s=RM,t.setTexture2D(e||s,i)}function YT(a,e,t){const n=this.cache,i=t.allocateTextureUnit();n[0]!==i&&(a.uniform1i(this.addr,i),n[0]=i),t.setTexture3D(e||xM,i)}function KT(a,e,t){const n=this.cache,i=t.allocateTextureUnit();n[0]!==i&&(a.uniform1i(this.addr,i),n[0]=i),t.setTextureCube(e||WM,i)}function FT(a,e,t){const n=this.cache,i=t.allocateTextureUnit();n[0]!==i&&(a.uniform1i(this.addr,i),n[0]=i),t.setTexture2DArray(e||wM,i)}function ET(a){switch(a){case 5126:return bT;case 35664:return yT;case 35665:return GT;case 35666:return BT;case 35674:return vT;case 35675:return ZT;case 35676:return ST;case 5124:case 35670:return RT;case 35667:case 35671:return wT;case 35668:case 35672:return xT;case 35669:case 35673:return WT;case 5125:return VT;case 36294:return MT;case 36295:return HT;case 36296:return XT;case 35678:case 36198:case 36298:case 36306:case 35682:return NT;case 35679:case 36299:case 36307:return YT;case 35680:case 36300:case 36308:case 36293:return KT;case 36289:case 36303:case 36311:case 36292:return FT}}function TT(a,e){a.uniform1fv(this.addr,e)}function zT(a,e){const t=AA(e,this.size,2);a.uniform2fv(this.addr,t)}function LT(a,e){const t=AA(e,this.size,3);a.uniform3fv(this.addr,t)}function _T(a,e){const t=AA(e,this.size,4);a.uniform4fv(this.addr,t)}function UT(a,e){const t=AA(e,this.size,4);a.uniformMatrix2fv(this.addr,!1,t)}function DT(a,e){const t=AA(e,this.size,9);a.uniformMatrix3fv(this.addr,!1,t)}function kT(a,e){const t=AA(e,this.size,16);a.uniformMatrix4fv(this.addr,!1,t)}function OT(a,e){a.uniform1iv(this.addr,e)}function JT(a,e){a.uniform2iv(this.addr,e)}function PT(a,e){a.uniform3iv(this.addr,e)}function QT(a,e){a.uniform4iv(this.addr,e)}function jT(a,e){a.uniform1uiv(this.addr,e)}function qT(a,e){a.uniform2uiv(this.addr,e)}function $T(a,e){a.uniform3uiv(this.addr,e)}function ez(a,e){a.uniform4uiv(this.addr,e)}function tz(a,e,t){const n=this.cache,i=e.length,s=_y(t,i);wa(n,s)||(a.uniform1iv(this.addr,s),xa(n,s));for(let o=0;o!==i;++o)t.setTexture2D(e[o]||RM,s[o])}function nz(a,e,t){const n=this.cache,i=e.length,s=_y(t,i);wa(n,s)||(a.uniform1iv(this.addr,s),xa(n,s));for(let o=0;o!==i;++o)t.setTexture3D(e[o]||xM,s[o])}function iz(a,e,t){const n=this.cache,i=e.length,s=_y(t,i);wa(n,s)||(a.uniform1iv(this.addr,s),xa(n,s));for(let o=0;o!==i;++o)t.setTextureCube(e[o]||WM,s[o])}function az(a,e,t){const n=this.cache,i=e.length,s=_y(t,i);wa(n,s)||(a.uniform1iv(this.addr,s),xa(n,s));for(let o=0;o!==i;++o)t.setTexture2DArray(e[o]||wM,s[o])}function sz(a){switch(a){case 5126:return TT;case 35664:return zT;case 35665:return LT;case 35666:return _T;case 35674:return UT;case 35675:return DT;case 35676:return kT;case 5124:case 35670:return OT;case 35667:case 35671:return JT;case 35668:case 35672:return PT;case 35669:case 35673:return QT;case 5125:return jT;case 36294:return qT;case 36295:return $T;case 36296:return ez;case 35678:case 36198:case 36298:case 36306:case 35682:return tz;case 35679:case 36299:case 36307:return nz;case 35680:case 36300:case 36308:case 36293:return iz;case 36289:case 36303:case 36311:case 36292:return az}}class oz{constructor(e,t,n){this.id=e,this.addr=n,this.cache=[],this.type=t.type,this.setValue=ET(t.type)}}class lz{constructor(e,t,n){this.id=e,this.addr=n,this.cache=[],this.type=t.type,this.size=t.size,this.setValue=sz(t.type)}}class rz{constructor(e){this.id=e,this.seq=[],this.map={}}setValue(e,t,n){const i=this.seq;for(let s=0,o=i.length;s!==o;++s){const r=i[s];r.setValue(e,t[r.id],n)}}}const VB=/(\w+)(\])?(\[|\.)?/g;function bw(a,e){a.seq.push(e),a.map[e.id]=e}function gz(a,e,t){const n=a.name,i=n.length;for(VB.lastIndex=0;;){const s=VB.exec(n),o=VB.lastIndex;let r=s[1];const g=s[2]==="]",u=s[3];if(g&&(r=r|0),u===void 0||u==="["&&o+2===i){bw(t,u===void 0?new oz(r,a,e):new lz(r,a,e));break}else{let h=t.map[r];h===void 0&&(h=new rz(r),bw(t,h)),t=h}}}class _b{constructor(e,t){this.seq=[],this.map={};const n=e.getProgramParameter(t,e.ACTIVE_UNIFORMS);for(let i=0;i<n;++i){const s=e.getActiveUniform(t,i),o=e.getUniformLocation(t,s.name);gz(s,o,this)}}setValue(e,t,n,i){const s=this.map[t];s!==void 0&&s.setValue(e,n,i)}setOptional(e,t,n){const i=t[n];i!==void 0&&this.setValue(e,n,i)}static upload(e,t,n,i){for(let s=0,o=t.length;s!==o;++s){const r=t[s],g=n[r.id];g.needsUpdate!==!1&&r.setValue(e,g.value,i)}}static seqWithValue(e,t){const n=[];for(let i=0,s=e.length;i!==s;++i){const o=e[i];o.id in t&&n.push(o)}return n}}function yw(a,e,t){const n=a.createShader(e);return a.shaderSource(n,t),a.compileShader(n),n}const cz=37297;let uz=0;function Iz(a,e){const t=a.split(`
`),n=[],i=Math.max(e-6,0),s=Math.min(e+6,t.length);for(let o=i;o<s;o++){const r=o+1;n.push(`${r===e?">":" "} ${r}: ${t[o]}`)}return n.join(`
`)}const Gw=new on;function Cz(a){Mn._getMatrix(Gw,Mn.workingColorSpace,a);const e=`mat3( ${Gw.elements.map(t=>t.toFixed(4))} )`;switch(Mn.getTransfer(a)){case xf:return[e,"LinearTransferOETF"];case ei:return[e,"sRGBTransferOETF"];default:return console.warn("THREE.WebGLProgram: Unsupported color space: ",a),[e,"LinearTransferOETF"]}}function Bw(a,e,t){const n=a.getShaderParameter(e,a.COMPILE_STATUS),i=a.getShaderInfoLog(e).trim();if(n&&i==="")return"";const s=/ERROR: 0:(\d+)/.exec(i);if(s){const o=parseInt(s[1]);return t.toUpperCase()+`

`+i+`

`+Iz(a.getShaderSource(e),o)}else return i}function dz(a,e){const t=Cz(e);return[`vec4 ${a}( vec4 value ) {`,`	return ${t[1]}( vec4( value.rgb * ${t[0]}, value.a ) );`,"}"].join(`
`)}function Az(a,e){let t;switch(e){case gV:t="Linear";break;case cV:t="Reinhard";break;case uV:t="Cineon";break;case T2:t="ACESFilmic";break;case CV:t="AgX";break;case dV:t="Neutral";break;case IV:t="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",e),t="Linear"}return"vec3 "+a+"( vec3 color ) { return "+t+"ToneMapping( color ); }"}const mb=new ae;function hz(){Mn.getLuminanceCoefficients(mb);const a=mb.x.toFixed(4),e=mb.y.toFixed(4),t=mb.z.toFixed(4);return["float luminance( const in vec3 rgb ) {",`	const vec3 weights = vec3( ${a}, ${e}, ${t} );`,"	return dot( weights, rgb );","}"].join(`
`)}function fz(a){return[a.extensionClipCullDistance?"#extension GL_ANGLE_clip_cull_distance : require":"",a.extensionMultiDraw?"#extension GL_ANGLE_multi_draw : require":""].filter(of).join(`
`)}function pz(a){const e=[];for(const t in a){const n=a[t];n!==!1&&e.push("#define "+t+" "+n)}return e.join(`
`)}function mz(a,e){const t={},n=a.getProgramParameter(e,a.ACTIVE_ATTRIBUTES);for(let i=0;i<n;i++){const s=a.getActiveAttrib(e,i),o=s.name;let r=1;s.type===a.FLOAT_MAT2&&(r=2),s.type===a.FLOAT_MAT3&&(r=3),s.type===a.FLOAT_MAT4&&(r=4),t[o]={type:s.type,location:a.getAttribLocation(e,o),locationSize:r}}return t}function of(a){return a!==""}function vw(a,e){const t=e.numSpotLightShadows+e.numSpotLightMaps-e.numSpotLightShadowsWithMaps;return a.replace(/NUM_DIR_LIGHTS/g,e.numDirLights).replace(/NUM_SPOT_LIGHTS/g,e.numSpotLights).replace(/NUM_SPOT_LIGHT_MAPS/g,e.numSpotLightMaps).replace(/NUM_SPOT_LIGHT_COORDS/g,t).replace(/NUM_RECT_AREA_LIGHTS/g,e.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,e.numPointLights).replace(/NUM_HEMI_LIGHTS/g,e.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,e.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS/g,e.numSpotLightShadowsWithMaps).replace(/NUM_SPOT_LIGHT_SHADOWS/g,e.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,e.numPointLightShadows)}function Zw(a,e){return a.replace(/NUM_CLIPPING_PLANES/g,e.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,e.numClippingPlanes-e.numClipIntersection)}const bz=/^[ \t]*#include +<([\w\d./]+)>/gm;function jv(a){return a.replace(bz,Gz)}const yz=new Map;function Gz(a,e){let t=An[e];if(t===void 0){const n=yz.get(e);if(n!==void 0)t=An[n],console.warn('THREE.WebGLRenderer: Shader chunk "%s" has been deprecated. Use "%s" instead.',e,n);else throw new Error("Can not resolve #include <"+e+">")}return jv(t)}const Bz=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function Sw(a){return a.replace(Bz,vz)}function vz(a,e,t,n){let i="";for(let s=parseInt(e);s<parseInt(t);s++)i+=n.replace(/\[\s*i\s*\]/g,"[ "+s+" ]").replace(/UNROLLED_LOOP_INDEX/g,s);return i}function Rw(a){let e=`precision ${a.precision} float;
	precision ${a.precision} int;
	precision ${a.precision} sampler2D;
	precision ${a.precision} samplerCube;
	precision ${a.precision} sampler3D;
	precision ${a.precision} sampler2DArray;
	precision ${a.precision} sampler2DShadow;
	precision ${a.precision} samplerCubeShadow;
	precision ${a.precision} sampler2DArrayShadow;
	precision ${a.precision} isampler2D;
	precision ${a.precision} isampler3D;
	precision ${a.precision} isamplerCube;
	precision ${a.precision} isampler2DArray;
	precision ${a.precision} usampler2D;
	precision ${a.precision} usampler3D;
	precision ${a.precision} usamplerCube;
	precision ${a.precision} usampler2DArray;
	`;return a.precision==="highp"?e+=`
#define HIGH_PRECISION`:a.precision==="mediump"?e+=`
#define MEDIUM_PRECISION`:a.precision==="lowp"&&(e+=`
#define LOW_PRECISION`),e}function Zz(a){let e="SHADOWMAP_TYPE_BASIC";return a.shadowMapType===sy?e="SHADOWMAP_TYPE_PCF":a.shadowMapType===cf?e="SHADOWMAP_TYPE_PCF_SOFT":a.shadowMapType===Ar&&(e="SHADOWMAP_TYPE_VSM"),e}function Sz(a){let e="ENVMAP_TYPE_CUBE";if(a.envMap)switch(a.envMapMode){case hc:case Gu:e="ENVMAP_TYPE_CUBE";break;case IA:e="ENVMAP_TYPE_CUBE_UV";break}return e}function Rz(a){let e="ENVMAP_MODE_REFLECTION";if(a.envMap)switch(a.envMapMode){case Gu:e="ENVMAP_MODE_REFRACTION";break}return e}function wz(a){let e="ENVMAP_BLENDING_NONE";if(a.envMap)switch(a.combine){case _f:e="ENVMAP_BLENDING_MULTIPLY";break;case lV:e="ENVMAP_BLENDING_MIX";break;case rV:e="ENVMAP_BLENDING_ADD";break}return e}function xz(a){const e=a.envMapCubeUVHeight;if(e===null)return null;const t=Math.log2(e)-2,n=1/e;return{texelWidth:1/(3*Math.max(Math.pow(2,t),7*16)),texelHeight:n,maxMip:t}}function Wz(a,e,t,n){const i=a.getContext(),s=t.defines;let o=t.vertexShader,r=t.fragmentShader;const g=Zz(t),u=Sz(t),C=Rz(t),h=wz(t),f=xz(t),p=fz(t),y=pz(s),v=i.createProgram();let G,B,R=t.glslVersion?"#version "+t.glslVersion+`
`:"";t.isRawShaderMaterial?(G=["#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,y].filter(of).join(`
`),G.length>0&&(G+=`
`),B=["#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,y].filter(of).join(`
`),B.length>0&&(B+=`
`)):(G=[Rw(t),"#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,y,t.extensionClipCullDistance?"#define USE_CLIP_DISTANCE":"",t.batching?"#define USE_BATCHING":"",t.batchingColor?"#define USE_BATCHING_COLOR":"",t.instancing?"#define USE_INSTANCING":"",t.instancingColor?"#define USE_INSTANCING_COLOR":"",t.instancingMorph?"#define USE_INSTANCING_MORPH":"",t.useFog&&t.fog?"#define USE_FOG":"",t.useFog&&t.fogExp2?"#define FOG_EXP2":"",t.map?"#define USE_MAP":"",t.envMap?"#define USE_ENVMAP":"",t.envMap?"#define "+C:"",t.lightMap?"#define USE_LIGHTMAP":"",t.aoMap?"#define USE_AOMAP":"",t.bumpMap?"#define USE_BUMPMAP":"",t.normalMap?"#define USE_NORMALMAP":"",t.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",t.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",t.displacementMap?"#define USE_DISPLACEMENTMAP":"",t.emissiveMap?"#define USE_EMISSIVEMAP":"",t.anisotropy?"#define USE_ANISOTROPY":"",t.anisotropyMap?"#define USE_ANISOTROPYMAP":"",t.clearcoatMap?"#define USE_CLEARCOATMAP":"",t.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",t.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",t.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",t.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",t.specularMap?"#define USE_SPECULARMAP":"",t.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",t.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",t.roughnessMap?"#define USE_ROUGHNESSMAP":"",t.metalnessMap?"#define USE_METALNESSMAP":"",t.alphaMap?"#define USE_ALPHAMAP":"",t.alphaHash?"#define USE_ALPHAHASH":"",t.transmission?"#define USE_TRANSMISSION":"",t.transmissionMap?"#define USE_TRANSMISSIONMAP":"",t.thicknessMap?"#define USE_THICKNESSMAP":"",t.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",t.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",t.mapUv?"#define MAP_UV "+t.mapUv:"",t.alphaMapUv?"#define ALPHAMAP_UV "+t.alphaMapUv:"",t.lightMapUv?"#define LIGHTMAP_UV "+t.lightMapUv:"",t.aoMapUv?"#define AOMAP_UV "+t.aoMapUv:"",t.emissiveMapUv?"#define EMISSIVEMAP_UV "+t.emissiveMapUv:"",t.bumpMapUv?"#define BUMPMAP_UV "+t.bumpMapUv:"",t.normalMapUv?"#define NORMALMAP_UV "+t.normalMapUv:"",t.displacementMapUv?"#define DISPLACEMENTMAP_UV "+t.displacementMapUv:"",t.metalnessMapUv?"#define METALNESSMAP_UV "+t.metalnessMapUv:"",t.roughnessMapUv?"#define ROUGHNESSMAP_UV "+t.roughnessMapUv:"",t.anisotropyMapUv?"#define ANISOTROPYMAP_UV "+t.anisotropyMapUv:"",t.clearcoatMapUv?"#define CLEARCOATMAP_UV "+t.clearcoatMapUv:"",t.clearcoatNormalMapUv?"#define CLEARCOAT_NORMALMAP_UV "+t.clearcoatNormalMapUv:"",t.clearcoatRoughnessMapUv?"#define CLEARCOAT_ROUGHNESSMAP_UV "+t.clearcoatRoughnessMapUv:"",t.iridescenceMapUv?"#define IRIDESCENCEMAP_UV "+t.iridescenceMapUv:"",t.iridescenceThicknessMapUv?"#define IRIDESCENCE_THICKNESSMAP_UV "+t.iridescenceThicknessMapUv:"",t.sheenColorMapUv?"#define SHEEN_COLORMAP_UV "+t.sheenColorMapUv:"",t.sheenRoughnessMapUv?"#define SHEEN_ROUGHNESSMAP_UV "+t.sheenRoughnessMapUv:"",t.specularMapUv?"#define SPECULARMAP_UV "+t.specularMapUv:"",t.specularColorMapUv?"#define SPECULAR_COLORMAP_UV "+t.specularColorMapUv:"",t.specularIntensityMapUv?"#define SPECULAR_INTENSITYMAP_UV "+t.specularIntensityMapUv:"",t.transmissionMapUv?"#define TRANSMISSIONMAP_UV "+t.transmissionMapUv:"",t.thicknessMapUv?"#define THICKNESSMAP_UV "+t.thicknessMapUv:"",t.vertexTangents&&t.flatShading===!1?"#define USE_TANGENT":"",t.vertexColors?"#define USE_COLOR":"",t.vertexAlphas?"#define USE_COLOR_ALPHA":"",t.vertexUv1s?"#define USE_UV1":"",t.vertexUv2s?"#define USE_UV2":"",t.vertexUv3s?"#define USE_UV3":"",t.pointsUvs?"#define USE_POINTS_UV":"",t.flatShading?"#define FLAT_SHADED":"",t.skinning?"#define USE_SKINNING":"",t.morphTargets?"#define USE_MORPHTARGETS":"",t.morphNormals&&t.flatShading===!1?"#define USE_MORPHNORMALS":"",t.morphColors?"#define USE_MORPHCOLORS":"",t.morphTargetsCount>0?"#define MORPHTARGETS_TEXTURE_STRIDE "+t.morphTextureStride:"",t.morphTargetsCount>0?"#define MORPHTARGETS_COUNT "+t.morphTargetsCount:"",t.doubleSided?"#define DOUBLE_SIDED":"",t.flipSided?"#define FLIP_SIDED":"",t.shadowMapEnabled?"#define USE_SHADOWMAP":"",t.shadowMapEnabled?"#define "+g:"",t.sizeAttenuation?"#define USE_SIZEATTENUATION":"",t.numLightProbes>0?"#define USE_LIGHT_PROBES":"",t.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",t.reverseDepthBuffer?"#define USE_REVERSEDEPTHBUF":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","	attribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","	attribute vec3 instanceColor;","#endif","#ifdef USE_INSTANCING_MORPH","	uniform sampler2D morphTexture;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_UV1","	attribute vec2 uv1;","#endif","#ifdef USE_UV2","	attribute vec2 uv2;","#endif","#ifdef USE_UV3","	attribute vec2 uv3;","#endif","#ifdef USE_TANGENT","	attribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","	attribute vec4 color;","#elif defined( USE_COLOR )","	attribute vec3 color;","#endif","#ifdef USE_SKINNING","	attribute vec4 skinIndex;","	attribute vec4 skinWeight;","#endif",`
`].filter(of).join(`
`),B=[Rw(t),"#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,y,t.useFog&&t.fog?"#define USE_FOG":"",t.useFog&&t.fogExp2?"#define FOG_EXP2":"",t.alphaToCoverage?"#define ALPHA_TO_COVERAGE":"",t.map?"#define USE_MAP":"",t.matcap?"#define USE_MATCAP":"",t.envMap?"#define USE_ENVMAP":"",t.envMap?"#define "+u:"",t.envMap?"#define "+C:"",t.envMap?"#define "+h:"",f?"#define CUBEUV_TEXEL_WIDTH "+f.texelWidth:"",f?"#define CUBEUV_TEXEL_HEIGHT "+f.texelHeight:"",f?"#define CUBEUV_MAX_MIP "+f.maxMip+".0":"",t.lightMap?"#define USE_LIGHTMAP":"",t.aoMap?"#define USE_AOMAP":"",t.bumpMap?"#define USE_BUMPMAP":"",t.normalMap?"#define USE_NORMALMAP":"",t.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",t.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",t.emissiveMap?"#define USE_EMISSIVEMAP":"",t.anisotropy?"#define USE_ANISOTROPY":"",t.anisotropyMap?"#define USE_ANISOTROPYMAP":"",t.clearcoat?"#define USE_CLEARCOAT":"",t.clearcoatMap?"#define USE_CLEARCOATMAP":"",t.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",t.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",t.dispersion?"#define USE_DISPERSION":"",t.iridescence?"#define USE_IRIDESCENCE":"",t.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",t.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",t.specularMap?"#define USE_SPECULARMAP":"",t.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",t.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",t.roughnessMap?"#define USE_ROUGHNESSMAP":"",t.metalnessMap?"#define USE_METALNESSMAP":"",t.alphaMap?"#define USE_ALPHAMAP":"",t.alphaTest?"#define USE_ALPHATEST":"",t.alphaHash?"#define USE_ALPHAHASH":"",t.sheen?"#define USE_SHEEN":"",t.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",t.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",t.transmission?"#define USE_TRANSMISSION":"",t.transmissionMap?"#define USE_TRANSMISSIONMAP":"",t.thicknessMap?"#define USE_THICKNESSMAP":"",t.vertexTangents&&t.flatShading===!1?"#define USE_TANGENT":"",t.vertexColors||t.instancingColor||t.batchingColor?"#define USE_COLOR":"",t.vertexAlphas?"#define USE_COLOR_ALPHA":"",t.vertexUv1s?"#define USE_UV1":"",t.vertexUv2s?"#define USE_UV2":"",t.vertexUv3s?"#define USE_UV3":"",t.pointsUvs?"#define USE_POINTS_UV":"",t.gradientMap?"#define USE_GRADIENTMAP":"",t.flatShading?"#define FLAT_SHADED":"",t.doubleSided?"#define DOUBLE_SIDED":"",t.flipSided?"#define FLIP_SIDED":"",t.shadowMapEnabled?"#define USE_SHADOWMAP":"",t.shadowMapEnabled?"#define "+g:"",t.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",t.numLightProbes>0?"#define USE_LIGHT_PROBES":"",t.decodeVideoTexture?"#define DECODE_VIDEO_TEXTURE":"",t.decodeVideoTextureEmissive?"#define DECODE_VIDEO_TEXTURE_EMISSIVE":"",t.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",t.reverseDepthBuffer?"#define USE_REVERSEDEPTHBUF":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",t.toneMapping!==Ag?"#define TONE_MAPPING":"",t.toneMapping!==Ag?An.tonemapping_pars_fragment:"",t.toneMapping!==Ag?Az("toneMapping",t.toneMapping):"",t.dithering?"#define DITHERING":"",t.opaque?"#define OPAQUE":"",An.colorspace_pars_fragment,dz("linearToOutputTexel",t.outputColorSpace),hz(),t.useDepthPacking?"#define DEPTH_PACKING "+t.depthPacking:"",`
`].filter(of).join(`
`)),o=jv(o),o=vw(o,t),o=Zw(o,t),r=jv(r),r=vw(r,t),r=Zw(r,t),o=Sw(o),r=Sw(r),t.isRawShaderMaterial!==!0&&(R=`#version 300 es
`,G=[p,"#define attribute in","#define varying out","#define texture2D texture"].join(`
`)+`
`+G,B=["#define varying in",t.glslVersion===Lv?"":"layout(location = 0) out highp vec4 pc_fragColor;",t.glslVersion===Lv?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join(`
`)+`
`+B);const x=R+G+o,w=R+B+r,M=yw(i,i.VERTEX_SHADER,x),H=yw(i,i.FRAGMENT_SHADER,w);i.attachShader(v,M),i.attachShader(v,H),t.index0AttributeName!==void 0?i.bindAttribLocation(v,0,t.index0AttributeName):t.morphTargets===!0&&i.bindAttribLocation(v,0,"position"),i.linkProgram(v);function N(U){if(a.debug.checkShaderErrors){const O=i.getProgramInfoLog(v).trim(),P=i.getShaderInfoLog(M).trim(),ie=i.getShaderInfoLog(H).trim();let le=!0,T=!0;if(i.getProgramParameter(v,i.LINK_STATUS)===!1)if(le=!1,typeof a.debug.onShaderError=="function")a.debug.onShaderError(i,v,M,H);else{const J=Bw(i,M,"vertex"),Q=Bw(i,H,"fragment");console.error("THREE.WebGLProgram: Shader Error "+i.getError()+" - VALIDATE_STATUS "+i.getProgramParameter(v,i.VALIDATE_STATUS)+`

Material Name: `+U.name+`
Material Type: `+U.type+`

Program Info Log: `+O+`
`+J+`
`+Q)}else O!==""?console.warn("THREE.WebGLProgram: Program Info Log:",O):(P===""||ie==="")&&(T=!1);T&&(U.diagnostics={runnable:le,programLog:O,vertexShader:{log:P,prefix:G},fragmentShader:{log:ie,prefix:B}})}i.deleteShader(M),i.deleteShader(H),F=new _b(i,v),Y=mz(i,v)}let F;this.getUniforms=function(){return F===void 0&&N(this),F};let Y;this.getAttributes=function(){return Y===void 0&&N(this),Y};let X=t.rendererExtensionParallelShaderCompile===!1;return this.isReady=function(){return X===!1&&(X=i.getProgramParameter(v,cz)),X},this.destroy=function(){n.releaseStatesOfProgram(this),i.deleteProgram(v),this.program=void 0},this.type=t.shaderType,this.name=t.shaderName,this.id=uz++,this.cacheKey=e,this.usedTimes=1,this.program=v,this.vertexShader=M,this.fragmentShader=H,this}let Vz=0;class Mz{constructor(){this.shaderCache=new Map,this.materialCache=new Map}update(e){const t=e.vertexShader,n=e.fragmentShader,i=this._getShaderStage(t),s=this._getShaderStage(n),o=this._getShaderCacheForMaterial(e);return o.has(i)===!1&&(o.add(i),i.usedTimes++),o.has(s)===!1&&(o.add(s),s.usedTimes++),this}remove(e){const t=this.materialCache.get(e);for(const n of t)n.usedTimes--,n.usedTimes===0&&this.shaderCache.delete(n.code);return this.materialCache.delete(e),this}getVertexShaderID(e){return this._getShaderStage(e.vertexShader).id}getFragmentShaderID(e){return this._getShaderStage(e.fragmentShader).id}dispose(){this.shaderCache.clear(),this.materialCache.clear()}_getShaderCacheForMaterial(e){const t=this.materialCache;let n=t.get(e);return n===void 0&&(n=new Set,t.set(e,n)),n}_getShaderStage(e){const t=this.shaderCache;let n=t.get(e);return n===void 0&&(n=new Hz(e),t.set(e,n)),n}}class Hz{constructor(e){this.id=Vz++,this.code=e,this.usedTimes=0}}function Xz(a,e,t,n,i,s,o){const r=new aA,g=new Mz,u=new Set,C=[],h=i.logarithmicDepthBuffer,f=i.vertexTextures;let p=i.precision;const y={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};function v(Y){return u.add(Y),Y===0?"uv":`uv${Y}`}function G(Y,X,U,O,P){const ie=O.fog,le=P.geometry,T=Y.isMeshStandardMaterial?O.environment:null,J=(Y.isMeshStandardMaterial?t:e).get(Y.envMap||T),Q=J&&J.mapping===IA?J.image.height:null,se=y[Y.type];Y.precision!==null&&(p=i.getMaxPrecision(Y.precision),p!==Y.precision&&console.warn("THREE.WebGLProgram.getParameters:",Y.precision,"not supported, using",p,"instead."));const L=le.morphAttributes.position||le.morphAttributes.normal||le.morphAttributes.color,D=L!==void 0?L.length:0;let ne=0;le.morphAttributes.position!==void 0&&(ne=1),le.morphAttributes.normal!==void 0&&(ne=2),le.morphAttributes.color!==void 0&&(ne=3);let oe,j,re,pe;if(se){const xt=hr[se];oe=xt.vertexShader,j=xt.fragmentShader}else oe=Y.vertexShader,j=Y.fragmentShader,g.update(Y),re=g.getVertexShaderID(Y),pe=g.getFragmentShaderID(Y);const me=a.getRenderTarget(),be=a.state.buffers.depth.getReversed(),$e=P.isInstancedMesh===!0,qe=P.isBatchedMesh===!0,ke=!!Y.map,Te=!!Y.matcap,ut=!!J,q=!!Y.aoMap,De=!!Y.lightMap,Ke=!!Y.bumpMap,Ee=!!Y.normalMap,ye=!!Y.displacementMap,Je=!!Y.emissiveMap,Me=!!Y.metalnessMap,Ze=!!Y.roughnessMap,gt=Y.anisotropy>0,k=Y.clearcoat>0,z=Y.dispersion>0,Ce=Y.iridescence>0,Ve=Y.sheen>0,Ge=Y.transmission>0,we=gt&&!!Y.anisotropyMap,et=k&&!!Y.clearcoatMap,lt=k&&!!Y.clearcoatNormalMap,Ct=k&&!!Y.clearcoatRoughnessMap,At=Ce&&!!Y.iridescenceMap,Ne=Ce&&!!Y.iridescenceThicknessMap,tt=Ve&&!!Y.sheenColorMap,nt=Ve&&!!Y.sheenRoughnessMap,ue=!!Y.specularMap,xe=!!Y.specularColorMap,ct=!!Y.specularIntensityMap,Ie=Ge&&!!Y.transmissionMap,Qe=Ge&&!!Y.thicknessMap,je=!!Y.gradientMap,mt=!!Y.alphaMap,it=Y.alphaTest>0,_e=!!Y.alphaHash,ht=!!Y.extensions;let yt=Ag;Y.toneMapped&&(me===null||me.isXRRenderTarget===!0)&&(yt=a.toneMapping);const Bt={shaderID:se,shaderType:Y.type,shaderName:Y.name,vertexShader:oe,fragmentShader:j,defines:Y.defines,customVertexShaderID:re,customFragmentShaderID:pe,isRawShaderMaterial:Y.isRawShaderMaterial===!0,glslVersion:Y.glslVersion,precision:p,batching:qe,batchingColor:qe&&P._colorsTexture!==null,instancing:$e,instancingColor:$e&&P.instanceColor!==null,instancingMorph:$e&&P.morphTexture!==null,supportsVertexTextures:f,outputColorSpace:me===null?a.outputColorSpace:me.isXRRenderTarget===!0?me.texture.colorSpace:vu,alphaToCoverage:!!Y.alphaToCoverage,map:ke,matcap:Te,envMap:ut,envMapMode:ut&&J.mapping,envMapCubeUVHeight:Q,aoMap:q,lightMap:De,bumpMap:Ke,normalMap:Ee,displacementMap:f&&ye,emissiveMap:Je,normalMapObjectSpace:Ee&&Y.normalMapType===yV,normalMapTangentSpace:Ee&&Y.normalMapType===xu,metalnessMap:Me,roughnessMap:Ze,anisotropy:gt,anisotropyMap:we,clearcoat:k,clearcoatMap:et,clearcoatNormalMap:lt,clearcoatRoughnessMap:Ct,dispersion:z,iridescence:Ce,iridescenceMap:At,iridescenceThicknessMap:Ne,sheen:Ve,sheenColorMap:tt,sheenRoughnessMap:nt,specularMap:ue,specularColorMap:xe,specularIntensityMap:ct,transmission:Ge,transmissionMap:Ie,thicknessMap:Qe,gradientMap:je,opaque:Y.transparent===!1&&Y.blending===qI&&Y.alphaToCoverage===!1,alphaMap:mt,alphaTest:it,alphaHash:_e,combine:Y.combine,mapUv:ke&&v(Y.map.channel),aoMapUv:q&&v(Y.aoMap.channel),lightMapUv:De&&v(Y.lightMap.channel),bumpMapUv:Ke&&v(Y.bumpMap.channel),normalMapUv:Ee&&v(Y.normalMap.channel),displacementMapUv:ye&&v(Y.displacementMap.channel),emissiveMapUv:Je&&v(Y.emissiveMap.channel),metalnessMapUv:Me&&v(Y.metalnessMap.channel),roughnessMapUv:Ze&&v(Y.roughnessMap.channel),anisotropyMapUv:we&&v(Y.anisotropyMap.channel),clearcoatMapUv:et&&v(Y.clearcoatMap.channel),clearcoatNormalMapUv:lt&&v(Y.clearcoatNormalMap.channel),clearcoatRoughnessMapUv:Ct&&v(Y.clearcoatRoughnessMap.channel),iridescenceMapUv:At&&v(Y.iridescenceMap.channel),iridescenceThicknessMapUv:Ne&&v(Y.iridescenceThicknessMap.channel),sheenColorMapUv:tt&&v(Y.sheenColorMap.channel),sheenRoughnessMapUv:nt&&v(Y.sheenRoughnessMap.channel),specularMapUv:ue&&v(Y.specularMap.channel),specularColorMapUv:xe&&v(Y.specularColorMap.channel),specularIntensityMapUv:ct&&v(Y.specularIntensityMap.channel),transmissionMapUv:Ie&&v(Y.transmissionMap.channel),thicknessMapUv:Qe&&v(Y.thicknessMap.channel),alphaMapUv:mt&&v(Y.alphaMap.channel),vertexTangents:!!le.attributes.tangent&&(Ee||gt),vertexColors:Y.vertexColors,vertexAlphas:Y.vertexColors===!0&&!!le.attributes.color&&le.attributes.color.itemSize===4,pointsUvs:P.isPoints===!0&&!!le.attributes.uv&&(ke||mt),fog:!!ie,useFog:Y.fog===!0,fogExp2:!!ie&&ie.isFogExp2,flatShading:Y.flatShading===!0,sizeAttenuation:Y.sizeAttenuation===!0,logarithmicDepthBuffer:h,reverseDepthBuffer:be,skinning:P.isSkinnedMesh===!0,morphTargets:le.morphAttributes.position!==void 0,morphNormals:le.morphAttributes.normal!==void 0,morphColors:le.morphAttributes.color!==void 0,morphTargetsCount:D,morphTextureStride:ne,numDirLights:X.directional.length,numPointLights:X.point.length,numSpotLights:X.spot.length,numSpotLightMaps:X.spotLightMap.length,numRectAreaLights:X.rectArea.length,numHemiLights:X.hemi.length,numDirLightShadows:X.directionalShadowMap.length,numPointLightShadows:X.pointShadowMap.length,numSpotLightShadows:X.spotShadowMap.length,numSpotLightShadowsWithMaps:X.numSpotLightShadowsWithMaps,numLightProbes:X.numLightProbes,numClippingPlanes:o.numPlanes,numClipIntersection:o.numIntersection,dithering:Y.dithering,shadowMapEnabled:a.shadowMap.enabled&&U.length>0,shadowMapType:a.shadowMap.type,toneMapping:yt,decodeVideoTexture:ke&&Y.map.isVideoTexture===!0&&Mn.getTransfer(Y.map.colorSpace)===ei,decodeVideoTextureEmissive:Je&&Y.emissiveMap.isVideoTexture===!0&&Mn.getTransfer(Y.emissiveMap.colorSpace)===ei,premultipliedAlpha:Y.premultipliedAlpha,doubleSided:Y.side===Oo,flipSided:Y.side===eo,useDepthPacking:Y.depthPacking>=0,depthPacking:Y.depthPacking||0,index0AttributeName:Y.index0AttributeName,extensionClipCullDistance:ht&&Y.extensions.clipCullDistance===!0&&n.has("WEBGL_clip_cull_distance"),extensionMultiDraw:(ht&&Y.extensions.multiDraw===!0||qe)&&n.has("WEBGL_multi_draw"),rendererExtensionParallelShaderCompile:n.has("KHR_parallel_shader_compile"),customProgramCacheKey:Y.customProgramCacheKey()};return Bt.vertexUv1s=u.has(1),Bt.vertexUv2s=u.has(2),Bt.vertexUv3s=u.has(3),u.clear(),Bt}function B(Y){const X=[];if(Y.shaderID?X.push(Y.shaderID):(X.push(Y.customVertexShaderID),X.push(Y.customFragmentShaderID)),Y.defines!==void 0)for(const U in Y.defines)X.push(U),X.push(Y.defines[U]);return Y.isRawShaderMaterial===!1&&(R(X,Y),x(X,Y),X.push(a.outputColorSpace)),X.push(Y.customProgramCacheKey),X.join()}function R(Y,X){Y.push(X.precision),Y.push(X.outputColorSpace),Y.push(X.envMapMode),Y.push(X.envMapCubeUVHeight),Y.push(X.mapUv),Y.push(X.alphaMapUv),Y.push(X.lightMapUv),Y.push(X.aoMapUv),Y.push(X.bumpMapUv),Y.push(X.normalMapUv),Y.push(X.displacementMapUv),Y.push(X.emissiveMapUv),Y.push(X.metalnessMapUv),Y.push(X.roughnessMapUv),Y.push(X.anisotropyMapUv),Y.push(X.clearcoatMapUv),Y.push(X.clearcoatNormalMapUv),Y.push(X.clearcoatRoughnessMapUv),Y.push(X.iridescenceMapUv),Y.push(X.iridescenceThicknessMapUv),Y.push(X.sheenColorMapUv),Y.push(X.sheenRoughnessMapUv),Y.push(X.specularMapUv),Y.push(X.specularColorMapUv),Y.push(X.specularIntensityMapUv),Y.push(X.transmissionMapUv),Y.push(X.thicknessMapUv),Y.push(X.combine),Y.push(X.fogExp2),Y.push(X.sizeAttenuation),Y.push(X.morphTargetsCount),Y.push(X.morphAttributeCount),Y.push(X.numDirLights),Y.push(X.numPointLights),Y.push(X.numSpotLights),Y.push(X.numSpotLightMaps),Y.push(X.numHemiLights),Y.push(X.numRectAreaLights),Y.push(X.numDirLightShadows),Y.push(X.numPointLightShadows),Y.push(X.numSpotLightShadows),Y.push(X.numSpotLightShadowsWithMaps),Y.push(X.numLightProbes),Y.push(X.shadowMapType),Y.push(X.toneMapping),Y.push(X.numClippingPlanes),Y.push(X.numClipIntersection),Y.push(X.depthPacking)}function x(Y,X){r.disableAll(),X.supportsVertexTextures&&r.enable(0),X.instancing&&r.enable(1),X.instancingColor&&r.enable(2),X.instancingMorph&&r.enable(3),X.matcap&&r.enable(4),X.envMap&&r.enable(5),X.normalMapObjectSpace&&r.enable(6),X.normalMapTangentSpace&&r.enable(7),X.clearcoat&&r.enable(8),X.iridescence&&r.enable(9),X.alphaTest&&r.enable(10),X.vertexColors&&r.enable(11),X.vertexAlphas&&r.enable(12),X.vertexUv1s&&r.enable(13),X.vertexUv2s&&r.enable(14),X.vertexUv3s&&r.enable(15),X.vertexTangents&&r.enable(16),X.anisotropy&&r.enable(17),X.alphaHash&&r.enable(18),X.batching&&r.enable(19),X.dispersion&&r.enable(20),X.batchingColor&&r.enable(21),Y.push(r.mask),r.disableAll(),X.fog&&r.enable(0),X.useFog&&r.enable(1),X.flatShading&&r.enable(2),X.logarithmicDepthBuffer&&r.enable(3),X.reverseDepthBuffer&&r.enable(4),X.skinning&&r.enable(5),X.morphTargets&&r.enable(6),X.morphNormals&&r.enable(7),X.morphColors&&r.enable(8),X.premultipliedAlpha&&r.enable(9),X.shadowMapEnabled&&r.enable(10),X.doubleSided&&r.enable(11),X.flipSided&&r.enable(12),X.useDepthPacking&&r.enable(13),X.dithering&&r.enable(14),X.transmission&&r.enable(15),X.sheen&&r.enable(16),X.opaque&&r.enable(17),X.pointsUvs&&r.enable(18),X.decodeVideoTexture&&r.enable(19),X.decodeVideoTextureEmissive&&r.enable(20),X.alphaToCoverage&&r.enable(21),Y.push(r.mask)}function w(Y){const X=y[Y.type];let U;if(X){const O=hr[X];U=fy.clone(O.uniforms)}else U=Y.uniforms;return U}function M(Y,X){let U;for(let O=0,P=C.length;O<P;O++){const ie=C[O];if(ie.cacheKey===X){U=ie,++U.usedTimes;break}}return U===void 0&&(U=new Wz(a,X,Y,s),C.push(U)),U}function H(Y){if(--Y.usedTimes===0){const X=C.indexOf(Y);C[X]=C[C.length-1],C.pop(),Y.destroy()}}function N(Y){g.remove(Y)}function F(){g.dispose()}return{getParameters:G,getProgramCacheKey:B,getUniforms:w,acquireProgram:M,releaseProgram:H,releaseShaderCache:N,programs:C,dispose:F}}function Nz(){let a=new WeakMap;function e(o){return a.has(o)}function t(o){let r=a.get(o);return r===void 0&&(r={},a.set(o,r)),r}function n(o){a.delete(o)}function i(o,r,g){a.get(o)[r]=g}function s(){a=new WeakMap}return{has:e,get:t,remove:n,update:i,dispose:s}}function Yz(a,e){return a.groupOrder!==e.groupOrder?a.groupOrder-e.groupOrder:a.renderOrder!==e.renderOrder?a.renderOrder-e.renderOrder:a.material.id!==e.material.id?a.material.id-e.material.id:a.z!==e.z?a.z-e.z:a.id-e.id}function ww(a,e){return a.groupOrder!==e.groupOrder?a.groupOrder-e.groupOrder:a.renderOrder!==e.renderOrder?a.renderOrder-e.renderOrder:a.z!==e.z?e.z-a.z:a.id-e.id}function xw(){const a=[];let e=0;const t=[],n=[],i=[];function s(){e=0,t.length=0,n.length=0,i.length=0}function o(h,f,p,y,v,G){let B=a[e];return B===void 0?(B={id:h.id,object:h,geometry:f,material:p,groupOrder:y,renderOrder:h.renderOrder,z:v,group:G},a[e]=B):(B.id=h.id,B.object=h,B.geometry=f,B.material=p,B.groupOrder=y,B.renderOrder=h.renderOrder,B.z=v,B.group=G),e++,B}function r(h,f,p,y,v,G){const B=o(h,f,p,y,v,G);p.transmission>0?n.push(B):p.transparent===!0?i.push(B):t.push(B)}function g(h,f,p,y,v,G){const B=o(h,f,p,y,v,G);p.transmission>0?n.unshift(B):p.transparent===!0?i.unshift(B):t.unshift(B)}function u(h,f){t.length>1&&t.sort(h||Yz),n.length>1&&n.sort(f||ww),i.length>1&&i.sort(f||ww)}function C(){for(let h=e,f=a.length;h<f;h++){const p=a[h];if(p.id===null)break;p.id=null,p.object=null,p.geometry=null,p.material=null,p.group=null}}return{opaque:t,transmissive:n,transparent:i,init:s,push:r,unshift:g,finish:C,sort:u}}function Kz(){let a=new WeakMap;function e(n,i){const s=a.get(n);let o;return s===void 0?(o=new xw,a.set(n,[o])):i>=s.length?(o=new xw,s.push(o)):o=s[i],o}function t(){a=new WeakMap}return{get:e,dispose:t}}function Fz(){const a={};return{get:function(e){if(a[e.id]!==void 0)return a[e.id];let t;switch(e.type){case"DirectionalLight":t={direction:new ae,color:new Gt};break;case"SpotLight":t={position:new ae,direction:new ae,color:new Gt,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":t={position:new ae,color:new Gt,distance:0,decay:0};break;case"HemisphereLight":t={direction:new ae,skyColor:new Gt,groundColor:new Gt};break;case"RectAreaLight":t={color:new Gt,position:new ae,halfWidth:new ae,halfHeight:new ae};break}return a[e.id]=t,t}}}function Ez(){const a={};return{get:function(e){if(a[e.id]!==void 0)return a[e.id];let t;switch(e.type){case"DirectionalLight":t={shadowIntensity:1,shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new at};break;case"SpotLight":t={shadowIntensity:1,shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new at};break;case"PointLight":t={shadowIntensity:1,shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new at,shadowCameraNear:1,shadowCameraFar:1e3};break}return a[e.id]=t,t}}}let Tz=0;function zz(a,e){return(e.castShadow?2:0)-(a.castShadow?2:0)+(e.map?1:0)-(a.map?1:0)}function Lz(a){const e=new Fz,t=Ez(),n={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1,numSpotMaps:-1,numLightProbes:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotLightMap:[],spotShadow:[],spotShadowMap:[],spotLightMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],numSpotLightShadowsWithMaps:0,numLightProbes:0};for(let u=0;u<9;u++)n.probe.push(new ae);const i=new ae,s=new Yt,o=new Yt;function r(u){let C=0,h=0,f=0;for(let Y=0;Y<9;Y++)n.probe[Y].set(0,0,0);let p=0,y=0,v=0,G=0,B=0,R=0,x=0,w=0,M=0,H=0,N=0;u.sort(zz);for(let Y=0,X=u.length;Y<X;Y++){const U=u[Y],O=U.color,P=U.intensity,ie=U.distance,le=U.shadow&&U.shadow.map?U.shadow.map.texture:null;if(U.isAmbientLight)C+=O.r*P,h+=O.g*P,f+=O.b*P;else if(U.isLightProbe){for(let T=0;T<9;T++)n.probe[T].addScaledVector(U.sh.coefficients[T],P);N++}else if(U.isDirectionalLight){const T=e.get(U);if(T.color.copy(U.color).multiplyScalar(U.intensity),U.castShadow){const J=U.shadow,Q=t.get(U);Q.shadowIntensity=J.intensity,Q.shadowBias=J.bias,Q.shadowNormalBias=J.normalBias,Q.shadowRadius=J.radius,Q.shadowMapSize=J.mapSize,n.directionalShadow[p]=Q,n.directionalShadowMap[p]=le,n.directionalShadowMatrix[p]=U.shadow.matrix,R++}n.directional[p]=T,p++}else if(U.isSpotLight){const T=e.get(U);T.position.setFromMatrixPosition(U.matrixWorld),T.color.copy(O).multiplyScalar(P),T.distance=ie,T.coneCos=Math.cos(U.angle),T.penumbraCos=Math.cos(U.angle*(1-U.penumbra)),T.decay=U.decay,n.spot[v]=T;const J=U.shadow;if(U.map&&(n.spotLightMap[M]=U.map,M++,J.updateMatrices(U),U.castShadow&&H++),n.spotLightMatrix[v]=J.matrix,U.castShadow){const Q=t.get(U);Q.shadowIntensity=J.intensity,Q.shadowBias=J.bias,Q.shadowNormalBias=J.normalBias,Q.shadowRadius=J.radius,Q.shadowMapSize=J.mapSize,n.spotShadow[v]=Q,n.spotShadowMap[v]=le,w++}v++}else if(U.isRectAreaLight){const T=e.get(U);T.color.copy(O).multiplyScalar(P),T.halfWidth.set(U.width*.5,0,0),T.halfHeight.set(0,U.height*.5,0),n.rectArea[G]=T,G++}else if(U.isPointLight){const T=e.get(U);if(T.color.copy(U.color).multiplyScalar(U.intensity),T.distance=U.distance,T.decay=U.decay,U.castShadow){const J=U.shadow,Q=t.get(U);Q.shadowIntensity=J.intensity,Q.shadowBias=J.bias,Q.shadowNormalBias=J.normalBias,Q.shadowRadius=J.radius,Q.shadowMapSize=J.mapSize,Q.shadowCameraNear=J.camera.near,Q.shadowCameraFar=J.camera.far,n.pointShadow[y]=Q,n.pointShadowMap[y]=le,n.pointShadowMatrix[y]=U.shadow.matrix,x++}n.point[y]=T,y++}else if(U.isHemisphereLight){const T=e.get(U);T.skyColor.copy(U.color).multiplyScalar(P),T.groundColor.copy(U.groundColor).multiplyScalar(P),n.hemi[B]=T,B++}}G>0&&(a.has("OES_texture_float_linear")===!0?(n.rectAreaLTC1=Rt.LTC_FLOAT_1,n.rectAreaLTC2=Rt.LTC_FLOAT_2):(n.rectAreaLTC1=Rt.LTC_HALF_1,n.rectAreaLTC2=Rt.LTC_HALF_2)),n.ambient[0]=C,n.ambient[1]=h,n.ambient[2]=f;const F=n.hash;(F.directionalLength!==p||F.pointLength!==y||F.spotLength!==v||F.rectAreaLength!==G||F.hemiLength!==B||F.numDirectionalShadows!==R||F.numPointShadows!==x||F.numSpotShadows!==w||F.numSpotMaps!==M||F.numLightProbes!==N)&&(n.directional.length=p,n.spot.length=v,n.rectArea.length=G,n.point.length=y,n.hemi.length=B,n.directionalShadow.length=R,n.directionalShadowMap.length=R,n.pointShadow.length=x,n.pointShadowMap.length=x,n.spotShadow.length=w,n.spotShadowMap.length=w,n.directionalShadowMatrix.length=R,n.pointShadowMatrix.length=x,n.spotLightMatrix.length=w+M-H,n.spotLightMap.length=M,n.numSpotLightShadowsWithMaps=H,n.numLightProbes=N,F.directionalLength=p,F.pointLength=y,F.spotLength=v,F.rectAreaLength=G,F.hemiLength=B,F.numDirectionalShadows=R,F.numPointShadows=x,F.numSpotShadows=w,F.numSpotMaps=M,F.numLightProbes=N,n.version=Tz++)}function g(u,C){let h=0,f=0,p=0,y=0,v=0;const G=C.matrixWorldInverse;for(let B=0,R=u.length;B<R;B++){const x=u[B];if(x.isDirectionalLight){const w=n.directional[h];w.direction.setFromMatrixPosition(x.matrixWorld),i.setFromMatrixPosition(x.target.matrixWorld),w.direction.sub(i),w.direction.transformDirection(G),h++}else if(x.isSpotLight){const w=n.spot[p];w.position.setFromMatrixPosition(x.matrixWorld),w.position.applyMatrix4(G),w.direction.setFromMatrixPosition(x.matrixWorld),i.setFromMatrixPosition(x.target.matrixWorld),w.direction.sub(i),w.direction.transformDirection(G),p++}else if(x.isRectAreaLight){const w=n.rectArea[y];w.position.setFromMatrixPosition(x.matrixWorld),w.position.applyMatrix4(G),o.identity(),s.copy(x.matrixWorld),s.premultiply(G),o.extractRotation(s),w.halfWidth.set(x.width*.5,0,0),w.halfHeight.set(0,x.height*.5,0),w.halfWidth.applyMatrix4(o),w.halfHeight.applyMatrix4(o),y++}else if(x.isPointLight){const w=n.point[f];w.position.setFromMatrixPosition(x.matrixWorld),w.position.applyMatrix4(G),f++}else if(x.isHemisphereLight){const w=n.hemi[v];w.direction.setFromMatrixPosition(x.matrixWorld),w.direction.transformDirection(G),v++}}}return{setup:r,setupView:g,state:n}}function Ww(a){const e=new Lz(a),t=[],n=[];function i(C){u.camera=C,t.length=0,n.length=0}function s(C){t.push(C)}function o(C){n.push(C)}function r(){e.setup(t)}function g(C){e.setupView(t,C)}const u={lightsArray:t,shadowsArray:n,camera:null,lights:e,transmissionRenderTarget:{}};return{init:i,state:u,setupLights:r,setupLightsView:g,pushLight:s,pushShadow:o}}function _z(a){let e=new WeakMap;function t(i,s=0){const o=e.get(i);let r;return o===void 0?(r=new Ww(a),e.set(i,[r])):s>=o.length?(r=new Ww(a),o.push(r)):r=o[s],r}function n(){e=new WeakMap}return{get:t,dispose:n}}const Uz=`void main() {
	gl_Position = vec4( position, 1.0 );
}`,Dz=`uniform sampler2D shadow_pass;
uniform vec2 resolution;
uniform float radius;
#include <packing>
void main() {
	const float samples = float( VSM_SAMPLES );
	float mean = 0.0;
	float squared_mean = 0.0;
	float uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );
	float uvStart = samples <= 1.0 ? 0.0 : - 1.0;
	for ( float i = 0.0; i < samples; i ++ ) {
		float uvOffset = uvStart + i * uvStride;
		#ifdef HORIZONTAL_PASS
			vec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );
			mean += distribution.x;
			squared_mean += distribution.y * distribution.y + distribution.x * distribution.x;
		#else
			float depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );
			mean += depth;
			squared_mean += depth * depth;
		#endif
	}
	mean = mean / samples;
	squared_mean = squared_mean / samples;
	float std_dev = sqrt( squared_mean - mean * mean );
	gl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );
}`;function kz(a,e,t){let n=new CA;const i=new at,s=new at,o=new Hn,r=new Ey({depthPacking:Q2}),g=new Ty,u={},C=t.maxTextureSize,h={[fg]:eo,[eo]:fg,[Oo]:Oo},f=new Zl({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new at},radius:{value:4}},vertexShader:Uz,fragmentShader:Dz}),p=f.clone();p.defines.HORIZONTAL_PASS=1;const y=new rn;y.setAttribute("position",new En(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const v=new vi(y,f),G=this;this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=sy;let B=this.type;this.render=function(H,N,F){if(G.enabled===!1||G.autoUpdate===!1&&G.needsUpdate===!1||H.length===0)return;const Y=a.getRenderTarget(),X=a.getActiveCubeFace(),U=a.getActiveMipmapLevel(),O=a.state;O.setBlending(cc),O.buffers.color.setClear(1,1,1,1),O.buffers.depth.setTest(!0),O.setScissorTest(!1);const P=B!==Ar&&this.type===Ar,ie=B===Ar&&this.type!==Ar;for(let le=0,T=H.length;le<T;le++){const J=H[le],Q=J.shadow;if(Q===void 0){console.warn("THREE.WebGLShadowMap:",J,"has no shadow.");continue}if(Q.autoUpdate===!1&&Q.needsUpdate===!1)continue;i.copy(Q.mapSize);const se=Q.getFrameExtents();if(i.multiply(se),s.copy(Q.mapSize),(i.x>C||i.y>C)&&(i.x>C&&(s.x=Math.floor(C/se.x),i.x=s.x*se.x,Q.mapSize.x=s.x),i.y>C&&(s.y=Math.floor(C/se.y),i.y=s.y*se.y,Q.mapSize.y=s.y)),Q.map===null||P===!0||ie===!0){const D=this.type!==Ar?{minFilter:Fa,magFilter:Fa}:{};Q.map!==null&&Q.map.dispose(),Q.map=new br(i.x,i.y,D),Q.map.texture.name=J.name+".shadowMap",Q.camera.updateProjectionMatrix()}a.setRenderTarget(Q.map),a.clear();const L=Q.getViewportCount();for(let D=0;D<L;D++){const ne=Q.getViewport(D);o.set(s.x*ne.x,s.y*ne.y,s.x*ne.z,s.y*ne.w),O.viewport(o),Q.updateMatrices(J,D),n=Q.getFrustum(),w(N,F,Q.camera,J,this.type)}Q.isPointLightShadow!==!0&&this.type===Ar&&R(Q,F),Q.needsUpdate=!1}B=this.type,G.needsUpdate=!1,a.setRenderTarget(Y,X,U)};function R(H,N){const F=e.update(v);f.defines.VSM_SAMPLES!==H.blurSamples&&(f.defines.VSM_SAMPLES=H.blurSamples,p.defines.VSM_SAMPLES=H.blurSamples,f.needsUpdate=!0,p.needsUpdate=!0),H.mapPass===null&&(H.mapPass=new br(i.x,i.y)),f.uniforms.shadow_pass.value=H.map.texture,f.uniforms.resolution.value=H.mapSize,f.uniforms.radius.value=H.radius,a.setRenderTarget(H.mapPass),a.clear(),a.renderBufferDirect(N,null,F,f,v,null),p.uniforms.shadow_pass.value=H.mapPass.texture,p.uniforms.resolution.value=H.mapSize,p.uniforms.radius.value=H.radius,a.setRenderTarget(H.map),a.clear(),a.renderBufferDirect(N,null,F,p,v,null)}function x(H,N,F,Y){let X=null;const U=F.isPointLight===!0?H.customDistanceMaterial:H.customDepthMaterial;if(U!==void 0)X=U;else if(X=F.isPointLight===!0?g:r,a.localClippingEnabled&&N.clipShadows===!0&&Array.isArray(N.clippingPlanes)&&N.clippingPlanes.length!==0||N.displacementMap&&N.displacementScale!==0||N.alphaMap&&N.alphaTest>0||N.map&&N.alphaTest>0||N.alphaToCoverage===!0){const O=X.uuid,P=N.uuid;let ie=u[O];ie===void 0&&(ie={},u[O]=ie);let le=ie[P];le===void 0&&(le=X.clone(),ie[P]=le,N.addEventListener("dispose",M)),X=le}if(X.visible=N.visible,X.wireframe=N.wireframe,Y===Ar?X.side=N.shadowSide!==null?N.shadowSide:N.side:X.side=N.shadowSide!==null?N.shadowSide:h[N.side],X.alphaMap=N.alphaMap,X.alphaTest=N.alphaToCoverage===!0?.5:N.alphaTest,X.map=N.map,X.clipShadows=N.clipShadows,X.clippingPlanes=N.clippingPlanes,X.clipIntersection=N.clipIntersection,X.displacementMap=N.displacementMap,X.displacementScale=N.displacementScale,X.displacementBias=N.displacementBias,X.wireframeLinewidth=N.wireframeLinewidth,X.linewidth=N.linewidth,F.isPointLight===!0&&X.isMeshDistanceMaterial===!0){const O=a.properties.get(X);O.light=F}return X}function w(H,N,F,Y,X){if(H.visible===!1)return;if(H.layers.test(N.layers)&&(H.isMesh||H.isLine||H.isPoints)&&(H.castShadow||H.receiveShadow&&X===Ar)&&(!H.frustumCulled||n.intersectsObject(H))){H.modelViewMatrix.multiplyMatrices(F.matrixWorldInverse,H.matrixWorld);const P=e.update(H),ie=H.material;if(Array.isArray(ie)){const le=P.groups;for(let T=0,J=le.length;T<J;T++){const Q=le[T],se=ie[Q.materialIndex];if(se&&se.visible){const L=x(H,se,Y,X);H.onBeforeShadow(a,H,N,F,P,L,Q),a.renderBufferDirect(F,null,P,L,H,Q),H.onAfterShadow(a,H,N,F,P,L,Q)}}}else if(ie.visible){const le=x(H,ie,Y,X);H.onBeforeShadow(a,H,N,F,P,le,null),a.renderBufferDirect(F,null,P,le,H,null),H.onAfterShadow(a,H,N,F,P,le,null)}}const O=H.children;for(let P=0,ie=O.length;P<ie;P++)w(O[P],N,F,Y,X)}function M(H){H.target.removeEventListener("dispose",M);for(const F in u){const Y=u[F],X=H.target.uuid;X in Y&&(Y[X].dispose(),delete Y[X])}}}const Oz={[$b]:e0,[t0]:a0,[n0]:s0,[sC]:i0,[e0]:$b,[a0]:t0,[s0]:n0,[i0]:sC};function Jz(a,e){function t(){let Ie=!1;const Qe=new Hn;let je=null;const mt=new Hn(0,0,0,0);return{setMask:function(it){je!==it&&!Ie&&(a.colorMask(it,it,it,it),je=it)},setLocked:function(it){Ie=it},setClear:function(it,_e,ht,yt,Bt){Bt===!0&&(it*=yt,_e*=yt,ht*=yt),Qe.set(it,_e,ht,yt),mt.equals(Qe)===!1&&(a.clearColor(it,_e,ht,yt),mt.copy(Qe))},reset:function(){Ie=!1,je=null,mt.set(-1,0,0,0)}}}function n(){let Ie=!1,Qe=!1,je=null,mt=null,it=null;return{setReversed:function(_e){if(Qe!==_e){const ht=e.get("EXT_clip_control");_e?ht.clipControlEXT(ht.LOWER_LEFT_EXT,ht.ZERO_TO_ONE_EXT):ht.clipControlEXT(ht.LOWER_LEFT_EXT,ht.NEGATIVE_ONE_TO_ONE_EXT),Qe=_e;const yt=it;it=null,this.setClear(yt)}},getReversed:function(){return Qe},setTest:function(_e){_e?me(a.DEPTH_TEST):be(a.DEPTH_TEST)},setMask:function(_e){je!==_e&&!Ie&&(a.depthMask(_e),je=_e)},setFunc:function(_e){if(Qe&&(_e=Oz[_e]),mt!==_e){switch(_e){case $b:a.depthFunc(a.NEVER);break;case e0:a.depthFunc(a.ALWAYS);break;case t0:a.depthFunc(a.LESS);break;case sC:a.depthFunc(a.LEQUAL);break;case n0:a.depthFunc(a.EQUAL);break;case i0:a.depthFunc(a.GEQUAL);break;case a0:a.depthFunc(a.GREATER);break;case s0:a.depthFunc(a.NOTEQUAL);break;default:a.depthFunc(a.LEQUAL)}mt=_e}},setLocked:function(_e){Ie=_e},setClear:function(_e){it!==_e&&(Qe&&(_e=1-_e),a.clearDepth(_e),it=_e)},reset:function(){Ie=!1,je=null,mt=null,it=null,Qe=!1}}}function i(){let Ie=!1,Qe=null,je=null,mt=null,it=null,_e=null,ht=null,yt=null,Bt=null;return{setTest:function(xt){Ie||(xt?me(a.STENCIL_TEST):be(a.STENCIL_TEST))},setMask:function(xt){Qe!==xt&&!Ie&&(a.stencilMask(xt),Qe=xt)},setFunc:function(xt,Gn,gn){(je!==xt||mt!==Gn||it!==gn)&&(a.stencilFunc(xt,Gn,gn),je=xt,mt=Gn,it=gn)},setOp:function(xt,Gn,gn){(_e!==xt||ht!==Gn||yt!==gn)&&(a.stencilOp(xt,Gn,gn),_e=xt,ht=Gn,yt=gn)},setLocked:function(xt){Ie=xt},setClear:function(xt){Bt!==xt&&(a.clearStencil(xt),Bt=xt)},reset:function(){Ie=!1,Qe=null,je=null,mt=null,it=null,_e=null,ht=null,yt=null,Bt=null}}}const s=new t,o=new n,r=new i,g=new WeakMap,u=new WeakMap;let C={},h={},f=new WeakMap,p=[],y=null,v=!1,G=null,B=null,R=null,x=null,w=null,M=null,H=null,N=new Gt(0,0,0),F=0,Y=!1,X=null,U=null,O=null,P=null,ie=null;const le=a.getParameter(a.MAX_COMBINED_TEXTURE_IMAGE_UNITS);let T=!1,J=0;const Q=a.getParameter(a.VERSION);Q.indexOf("WebGL")!==-1?(J=parseFloat(/^WebGL (\d)/.exec(Q)[1]),T=J>=1):Q.indexOf("OpenGL ES")!==-1&&(J=parseFloat(/^OpenGL ES (\d)/.exec(Q)[1]),T=J>=2);let se=null,L={};const D=a.getParameter(a.SCISSOR_BOX),ne=a.getParameter(a.VIEWPORT),oe=new Hn().fromArray(D),j=new Hn().fromArray(ne);function re(Ie,Qe,je,mt){const it=new Uint8Array(4),_e=a.createTexture();a.bindTexture(Ie,_e),a.texParameteri(Ie,a.TEXTURE_MIN_FILTER,a.NEAREST),a.texParameteri(Ie,a.TEXTURE_MAG_FILTER,a.NEAREST);for(let ht=0;ht<je;ht++)Ie===a.TEXTURE_3D||Ie===a.TEXTURE_2D_ARRAY?a.texImage3D(Qe,0,a.RGBA,1,1,mt,0,a.RGBA,a.UNSIGNED_BYTE,it):a.texImage2D(Qe+ht,0,a.RGBA,1,1,0,a.RGBA,a.UNSIGNED_BYTE,it);return _e}const pe={};pe[a.TEXTURE_2D]=re(a.TEXTURE_2D,a.TEXTURE_2D,1),pe[a.TEXTURE_CUBE_MAP]=re(a.TEXTURE_CUBE_MAP,a.TEXTURE_CUBE_MAP_POSITIVE_X,6),pe[a.TEXTURE_2D_ARRAY]=re(a.TEXTURE_2D_ARRAY,a.TEXTURE_2D_ARRAY,1,1),pe[a.TEXTURE_3D]=re(a.TEXTURE_3D,a.TEXTURE_3D,1,1),s.setClear(0,0,0,1),o.setClear(1),r.setClear(0),me(a.DEPTH_TEST),o.setFunc(sC),Ke(!1),Ee(Yv),me(a.CULL_FACE),q(cc);function me(Ie){C[Ie]!==!0&&(a.enable(Ie),C[Ie]=!0)}function be(Ie){C[Ie]!==!1&&(a.disable(Ie),C[Ie]=!1)}function $e(Ie,Qe){return h[Ie]!==Qe?(a.bindFramebuffer(Ie,Qe),h[Ie]=Qe,Ie===a.DRAW_FRAMEBUFFER&&(h[a.FRAMEBUFFER]=Qe),Ie===a.FRAMEBUFFER&&(h[a.DRAW_FRAMEBUFFER]=Qe),!0):!1}function qe(Ie,Qe){let je=p,mt=!1;if(Ie){je=f.get(Qe),je===void 0&&(je=[],f.set(Qe,je));const it=Ie.textures;if(je.length!==it.length||je[0]!==a.COLOR_ATTACHMENT0){for(let _e=0,ht=it.length;_e<ht;_e++)je[_e]=a.COLOR_ATTACHMENT0+_e;je.length=it.length,mt=!0}}else je[0]!==a.BACK&&(je[0]=a.BACK,mt=!0);mt&&a.drawBuffers(je)}function ke(Ie){return y!==Ie?(a.useProgram(Ie),y=Ie,!0):!1}const Te={[fu]:a.FUNC_ADD,[UW]:a.FUNC_SUBTRACT,[DW]:a.FUNC_REVERSE_SUBTRACT};Te[kW]=a.MIN,Te[OW]=a.MAX;const ut={[JW]:a.ZERO,[PW]:a.ONE,[QW]:a.SRC_COLOR,[jb]:a.SRC_ALPHA,[nV]:a.SRC_ALPHA_SATURATE,[eV]:a.DST_COLOR,[qW]:a.DST_ALPHA,[jW]:a.ONE_MINUS_SRC_COLOR,[qb]:a.ONE_MINUS_SRC_ALPHA,[tV]:a.ONE_MINUS_DST_COLOR,[$W]:a.ONE_MINUS_DST_ALPHA,[iV]:a.CONSTANT_COLOR,[aV]:a.ONE_MINUS_CONSTANT_COLOR,[sV]:a.CONSTANT_ALPHA,[oV]:a.ONE_MINUS_CONSTANT_ALPHA};function q(Ie,Qe,je,mt,it,_e,ht,yt,Bt,xt){if(Ie===cc){v===!0&&(be(a.BLEND),v=!1);return}if(v===!1&&(me(a.BLEND),v=!0),Ie!==_W){if(Ie!==G||xt!==Y){if((B!==fu||w!==fu)&&(a.blendEquation(a.FUNC_ADD),B=fu,w=fu),xt)switch(Ie){case qI:a.blendFuncSeparate(a.ONE,a.ONE_MINUS_SRC_ALPHA,a.ONE,a.ONE_MINUS_SRC_ALPHA);break;case Kv:a.blendFunc(a.ONE,a.ONE);break;case Fv:a.blendFuncSeparate(a.ZERO,a.ONE_MINUS_SRC_COLOR,a.ZERO,a.ONE);break;case Ev:a.blendFuncSeparate(a.ZERO,a.SRC_COLOR,a.ZERO,a.SRC_ALPHA);break;default:console.error("THREE.WebGLState: Invalid blending: ",Ie);break}else switch(Ie){case qI:a.blendFuncSeparate(a.SRC_ALPHA,a.ONE_MINUS_SRC_ALPHA,a.ONE,a.ONE_MINUS_SRC_ALPHA);break;case Kv:a.blendFunc(a.SRC_ALPHA,a.ONE);break;case Fv:a.blendFuncSeparate(a.ZERO,a.ONE_MINUS_SRC_COLOR,a.ZERO,a.ONE);break;case Ev:a.blendFunc(a.ZERO,a.SRC_COLOR);break;default:console.error("THREE.WebGLState: Invalid blending: ",Ie);break}R=null,x=null,M=null,H=null,N.set(0,0,0),F=0,G=Ie,Y=xt}return}it=it||Qe,_e=_e||je,ht=ht||mt,(Qe!==B||it!==w)&&(a.blendEquationSeparate(Te[Qe],Te[it]),B=Qe,w=it),(je!==R||mt!==x||_e!==M||ht!==H)&&(a.blendFuncSeparate(ut[je],ut[mt],ut[_e],ut[ht]),R=je,x=mt,M=_e,H=ht),(yt.equals(N)===!1||Bt!==F)&&(a.blendColor(yt.r,yt.g,yt.b,Bt),N.copy(yt),F=Bt),G=Ie,Y=!1}function De(Ie,Qe){Ie.side===Oo?be(a.CULL_FACE):me(a.CULL_FACE);let je=Ie.side===eo;Qe&&(je=!je),Ke(je),Ie.blending===qI&&Ie.transparent===!1?q(cc):q(Ie.blending,Ie.blendEquation,Ie.blendSrc,Ie.blendDst,Ie.blendEquationAlpha,Ie.blendSrcAlpha,Ie.blendDstAlpha,Ie.blendColor,Ie.blendAlpha,Ie.premultipliedAlpha),o.setFunc(Ie.depthFunc),o.setTest(Ie.depthTest),o.setMask(Ie.depthWrite),s.setMask(Ie.colorWrite);const mt=Ie.stencilWrite;r.setTest(mt),mt&&(r.setMask(Ie.stencilWriteMask),r.setFunc(Ie.stencilFunc,Ie.stencilRef,Ie.stencilFuncMask),r.setOp(Ie.stencilFail,Ie.stencilZFail,Ie.stencilZPass)),Je(Ie.polygonOffset,Ie.polygonOffsetFactor,Ie.polygonOffsetUnits),Ie.alphaToCoverage===!0?me(a.SAMPLE_ALPHA_TO_COVERAGE):be(a.SAMPLE_ALPHA_TO_COVERAGE)}function Ke(Ie){X!==Ie&&(Ie?a.frontFace(a.CW):a.frontFace(a.CCW),X=Ie)}function Ee(Ie){Ie!==TW?(me(a.CULL_FACE),Ie!==U&&(Ie===Yv?a.cullFace(a.BACK):Ie===zW?a.cullFace(a.FRONT):a.cullFace(a.FRONT_AND_BACK))):be(a.CULL_FACE),U=Ie}function ye(Ie){Ie!==O&&(T&&a.lineWidth(Ie),O=Ie)}function Je(Ie,Qe,je){Ie?(me(a.POLYGON_OFFSET_FILL),(P!==Qe||ie!==je)&&(a.polygonOffset(Qe,je),P=Qe,ie=je)):be(a.POLYGON_OFFSET_FILL)}function Me(Ie){Ie?me(a.SCISSOR_TEST):be(a.SCISSOR_TEST)}function Ze(Ie){Ie===void 0&&(Ie=a.TEXTURE0+le-1),se!==Ie&&(a.activeTexture(Ie),se=Ie)}function gt(Ie,Qe,je){je===void 0&&(se===null?je=a.TEXTURE0+le-1:je=se);let mt=L[je];mt===void 0&&(mt={type:void 0,texture:void 0},L[je]=mt),(mt.type!==Ie||mt.texture!==Qe)&&(se!==je&&(a.activeTexture(je),se=je),a.bindTexture(Ie,Qe||pe[Ie]),mt.type=Ie,mt.texture=Qe)}function k(){const Ie=L[se];Ie!==void 0&&Ie.type!==void 0&&(a.bindTexture(Ie.type,null),Ie.type=void 0,Ie.texture=void 0)}function z(){try{a.compressedTexImage2D(...arguments)}catch(Ie){console.error("THREE.WebGLState:",Ie)}}function Ce(){try{a.compressedTexImage3D(...arguments)}catch(Ie){console.error("THREE.WebGLState:",Ie)}}function Ve(){try{a.texSubImage2D(...arguments)}catch(Ie){console.error("THREE.WebGLState:",Ie)}}function Ge(){try{a.texSubImage3D(...arguments)}catch(Ie){console.error("THREE.WebGLState:",Ie)}}function we(){try{a.compressedTexSubImage2D(...arguments)}catch(Ie){console.error("THREE.WebGLState:",Ie)}}function et(){try{a.compressedTexSubImage3D(...arguments)}catch(Ie){console.error("THREE.WebGLState:",Ie)}}function lt(){try{a.texStorage2D(...arguments)}catch(Ie){console.error("THREE.WebGLState:",Ie)}}function Ct(){try{a.texStorage3D(...arguments)}catch(Ie){console.error("THREE.WebGLState:",Ie)}}function At(){try{a.texImage2D(...arguments)}catch(Ie){console.error("THREE.WebGLState:",Ie)}}function Ne(){try{a.texImage3D(...arguments)}catch(Ie){console.error("THREE.WebGLState:",Ie)}}function tt(Ie){oe.equals(Ie)===!1&&(a.scissor(Ie.x,Ie.y,Ie.z,Ie.w),oe.copy(Ie))}function nt(Ie){j.equals(Ie)===!1&&(a.viewport(Ie.x,Ie.y,Ie.z,Ie.w),j.copy(Ie))}function ue(Ie,Qe){let je=u.get(Qe);je===void 0&&(je=new WeakMap,u.set(Qe,je));let mt=je.get(Ie);mt===void 0&&(mt=a.getUniformBlockIndex(Qe,Ie.name),je.set(Ie,mt))}function xe(Ie,Qe){const mt=u.get(Qe).get(Ie);g.get(Qe)!==mt&&(a.uniformBlockBinding(Qe,mt,Ie.__bindingPointIndex),g.set(Qe,mt))}function ct(){a.disable(a.BLEND),a.disable(a.CULL_FACE),a.disable(a.DEPTH_TEST),a.disable(a.POLYGON_OFFSET_FILL),a.disable(a.SCISSOR_TEST),a.disable(a.STENCIL_TEST),a.disable(a.SAMPLE_ALPHA_TO_COVERAGE),a.blendEquation(a.FUNC_ADD),a.blendFunc(a.ONE,a.ZERO),a.blendFuncSeparate(a.ONE,a.ZERO,a.ONE,a.ZERO),a.blendColor(0,0,0,0),a.colorMask(!0,!0,!0,!0),a.clearColor(0,0,0,0),a.depthMask(!0),a.depthFunc(a.LESS),o.setReversed(!1),a.clearDepth(1),a.stencilMask(4294967295),a.stencilFunc(a.ALWAYS,0,4294967295),a.stencilOp(a.KEEP,a.KEEP,a.KEEP),a.clearStencil(0),a.cullFace(a.BACK),a.frontFace(a.CCW),a.polygonOffset(0,0),a.activeTexture(a.TEXTURE0),a.bindFramebuffer(a.FRAMEBUFFER,null),a.bindFramebuffer(a.DRAW_FRAMEBUFFER,null),a.bindFramebuffer(a.READ_FRAMEBUFFER,null),a.useProgram(null),a.lineWidth(1),a.scissor(0,0,a.canvas.width,a.canvas.height),a.viewport(0,0,a.canvas.width,a.canvas.height),C={},se=null,L={},h={},f=new WeakMap,p=[],y=null,v=!1,G=null,B=null,R=null,x=null,w=null,M=null,H=null,N=new Gt(0,0,0),F=0,Y=!1,X=null,U=null,O=null,P=null,ie=null,oe.set(0,0,a.canvas.width,a.canvas.height),j.set(0,0,a.canvas.width,a.canvas.height),s.reset(),o.reset(),r.reset()}return{buffers:{color:s,depth:o,stencil:r},enable:me,disable:be,bindFramebuffer:$e,drawBuffers:qe,useProgram:ke,setBlending:q,setMaterial:De,setFlipSided:Ke,setCullFace:Ee,setLineWidth:ye,setPolygonOffset:Je,setScissorTest:Me,activeTexture:Ze,bindTexture:gt,unbindTexture:k,compressedTexImage2D:z,compressedTexImage3D:Ce,texImage2D:At,texImage3D:Ne,updateUBOMapping:ue,uniformBlockBinding:xe,texStorage2D:lt,texStorage3D:Ct,texSubImage2D:Ve,texSubImage3D:Ge,compressedTexSubImage2D:we,compressedTexSubImage3D:et,scissor:tt,viewport:nt,reset:ct}}function Pz(a,e,t,n,i,s,o){const r=e.has("WEBGL_multisampled_render_to_texture")?e.get("WEBGL_multisampled_render_to_texture"):null,g=typeof navigator>"u"?!1:/OculusBrowser/g.test(navigator.userAgent),u=new at,C=new WeakMap;let h;const f=new WeakMap;let p=!1;try{p=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")!==null}catch{}function y(k,z){return p?new OffscreenCanvas(k,z):Mf("canvas")}function v(k,z,Ce){let Ve=1;const Ge=gt(k);if((Ge.width>Ce||Ge.height>Ce)&&(Ve=Ce/Math.max(Ge.width,Ge.height)),Ve<1)if(typeof HTMLImageElement<"u"&&k instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&k instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&k instanceof ImageBitmap||typeof VideoFrame<"u"&&k instanceof VideoFrame){const we=Math.floor(Ve*Ge.width),et=Math.floor(Ve*Ge.height);h===void 0&&(h=y(we,et));const lt=z?y(we,et):h;return lt.width=we,lt.height=et,lt.getContext("2d").drawImage(k,0,0,we,et),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+Ge.width+"x"+Ge.height+") to ("+we+"x"+et+")."),lt}else return"data"in k&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+Ge.width+"x"+Ge.height+")."),k;return k}function G(k){return k.generateMipmaps}function B(k){a.generateMipmap(k)}function R(k){return k.isWebGLCubeRenderTarget?a.TEXTURE_CUBE_MAP:k.isWebGL3DRenderTarget?a.TEXTURE_3D:k.isWebGLArrayRenderTarget||k.isCompressedArrayTexture?a.TEXTURE_2D_ARRAY:a.TEXTURE_2D}function x(k,z,Ce,Ve,Ge=!1){if(k!==null){if(a[k]!==void 0)return a[k];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+k+"'")}let we=z;if(z===a.RED&&(Ce===a.FLOAT&&(we=a.R32F),Ce===a.HALF_FLOAT&&(we=a.R16F),Ce===a.UNSIGNED_BYTE&&(we=a.R8)),z===a.RED_INTEGER&&(Ce===a.UNSIGNED_BYTE&&(we=a.R8UI),Ce===a.UNSIGNED_SHORT&&(we=a.R16UI),Ce===a.UNSIGNED_INT&&(we=a.R32UI),Ce===a.BYTE&&(we=a.R8I),Ce===a.SHORT&&(we=a.R16I),Ce===a.INT&&(we=a.R32I)),z===a.RG&&(Ce===a.FLOAT&&(we=a.RG32F),Ce===a.HALF_FLOAT&&(we=a.RG16F),Ce===a.UNSIGNED_BYTE&&(we=a.RG8)),z===a.RG_INTEGER&&(Ce===a.UNSIGNED_BYTE&&(we=a.RG8UI),Ce===a.UNSIGNED_SHORT&&(we=a.RG16UI),Ce===a.UNSIGNED_INT&&(we=a.RG32UI),Ce===a.BYTE&&(we=a.RG8I),Ce===a.SHORT&&(we=a.RG16I),Ce===a.INT&&(we=a.RG32I)),z===a.RGB_INTEGER&&(Ce===a.UNSIGNED_BYTE&&(we=a.RGB8UI),Ce===a.UNSIGNED_SHORT&&(we=a.RGB16UI),Ce===a.UNSIGNED_INT&&(we=a.RGB32UI),Ce===a.BYTE&&(we=a.RGB8I),Ce===a.SHORT&&(we=a.RGB16I),Ce===a.INT&&(we=a.RGB32I)),z===a.RGBA_INTEGER&&(Ce===a.UNSIGNED_BYTE&&(we=a.RGBA8UI),Ce===a.UNSIGNED_SHORT&&(we=a.RGBA16UI),Ce===a.UNSIGNED_INT&&(we=a.RGBA32UI),Ce===a.BYTE&&(we=a.RGBA8I),Ce===a.SHORT&&(we=a.RGBA16I),Ce===a.INT&&(we=a.RGBA32I)),z===a.RGB&&Ce===a.UNSIGNED_INT_5_9_9_9_REV&&(we=a.RGB9_E5),z===a.RGBA){const et=Ge?xf:Mn.getTransfer(Ve);Ce===a.FLOAT&&(we=a.RGBA32F),Ce===a.HALF_FLOAT&&(we=a.RGBA16F),Ce===a.UNSIGNED_BYTE&&(we=et===ei?a.SRGB8_ALPHA8:a.RGBA8),Ce===a.UNSIGNED_SHORT_4_4_4_4&&(we=a.RGBA4),Ce===a.UNSIGNED_SHORT_5_5_5_1&&(we=a.RGB5_A1)}return(we===a.R16F||we===a.R32F||we===a.RG16F||we===a.RG32F||we===a.RGBA16F||we===a.RGBA32F)&&e.get("EXT_color_buffer_float"),we}function w(k,z){let Ce;return k?z===null||z===fc||z===qd?Ce=a.DEPTH24_STENCIL8:z===qs?Ce=a.DEPTH32F_STENCIL8:z===jd&&(Ce=a.DEPTH24_STENCIL8,console.warn("DepthTexture: 16 bit depth attachment is not supported with stencil. Using 24-bit attachment.")):z===null||z===fc||z===qd?Ce=a.DEPTH_COMPONENT24:z===qs?Ce=a.DEPTH_COMPONENT32F:z===jd&&(Ce=a.DEPTH_COMPONENT16),Ce}function M(k,z){return G(k)===!0||k.isFramebufferTexture&&k.minFilter!==Fa&&k.minFilter!==Bi?Math.log2(Math.max(z.width,z.height))+1:k.mipmaps!==void 0&&k.mipmaps.length>0?k.mipmaps.length:k.isCompressedTexture&&Array.isArray(k.image)?z.mipmaps.length:1}function H(k){const z=k.target;z.removeEventListener("dispose",H),F(z),z.isVideoTexture&&C.delete(z)}function N(k){const z=k.target;z.removeEventListener("dispose",N),X(z)}function F(k){const z=n.get(k);if(z.__webglInit===void 0)return;const Ce=k.source,Ve=f.get(Ce);if(Ve){const Ge=Ve[z.__cacheKey];Ge.usedTimes--,Ge.usedTimes===0&&Y(k),Object.keys(Ve).length===0&&f.delete(Ce)}n.remove(k)}function Y(k){const z=n.get(k);a.deleteTexture(z.__webglTexture);const Ce=k.source,Ve=f.get(Ce);delete Ve[z.__cacheKey],o.memory.textures--}function X(k){const z=n.get(k);if(k.depthTexture&&(k.depthTexture.dispose(),n.remove(k.depthTexture)),k.isWebGLCubeRenderTarget)for(let Ve=0;Ve<6;Ve++){if(Array.isArray(z.__webglFramebuffer[Ve]))for(let Ge=0;Ge<z.__webglFramebuffer[Ve].length;Ge++)a.deleteFramebuffer(z.__webglFramebuffer[Ve][Ge]);else a.deleteFramebuffer(z.__webglFramebuffer[Ve]);z.__webglDepthbuffer&&a.deleteRenderbuffer(z.__webglDepthbuffer[Ve])}else{if(Array.isArray(z.__webglFramebuffer))for(let Ve=0;Ve<z.__webglFramebuffer.length;Ve++)a.deleteFramebuffer(z.__webglFramebuffer[Ve]);else a.deleteFramebuffer(z.__webglFramebuffer);if(z.__webglDepthbuffer&&a.deleteRenderbuffer(z.__webglDepthbuffer),z.__webglMultisampledFramebuffer&&a.deleteFramebuffer(z.__webglMultisampledFramebuffer),z.__webglColorRenderbuffer)for(let Ve=0;Ve<z.__webglColorRenderbuffer.length;Ve++)z.__webglColorRenderbuffer[Ve]&&a.deleteRenderbuffer(z.__webglColorRenderbuffer[Ve]);z.__webglDepthRenderbuffer&&a.deleteRenderbuffer(z.__webglDepthRenderbuffer)}const Ce=k.textures;for(let Ve=0,Ge=Ce.length;Ve<Ge;Ve++){const we=n.get(Ce[Ve]);we.__webglTexture&&(a.deleteTexture(we.__webglTexture),o.memory.textures--),n.remove(Ce[Ve])}n.remove(k)}let U=0;function O(){U=0}function P(){const k=U;return k>=i.maxTextures&&console.warn("THREE.WebGLTextures: Trying to use "+k+" texture units while this GPU supports only "+i.maxTextures),U+=1,k}function ie(k){const z=[];return z.push(k.wrapS),z.push(k.wrapT),z.push(k.wrapR||0),z.push(k.magFilter),z.push(k.minFilter),z.push(k.anisotropy),z.push(k.internalFormat),z.push(k.format),z.push(k.type),z.push(k.generateMipmaps),z.push(k.premultiplyAlpha),z.push(k.flipY),z.push(k.unpackAlignment),z.push(k.colorSpace),z.join()}function le(k,z){const Ce=n.get(k);if(k.isVideoTexture&&Me(k),k.isRenderTargetTexture===!1&&k.version>0&&Ce.__version!==k.version){const Ve=k.image;if(Ve===null)console.warn("THREE.WebGLRenderer: Texture marked for update but no image data found.");else if(Ve.complete===!1)console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete");else{pe(Ce,k,z);return}}t.bindTexture(a.TEXTURE_2D,Ce.__webglTexture,a.TEXTURE0+z)}function T(k,z){const Ce=n.get(k);if(k.version>0&&Ce.__version!==k.version){pe(Ce,k,z);return}t.bindTexture(a.TEXTURE_2D_ARRAY,Ce.__webglTexture,a.TEXTURE0+z)}function J(k,z){const Ce=n.get(k);if(k.version>0&&Ce.__version!==k.version){pe(Ce,k,z);return}t.bindTexture(a.TEXTURE_3D,Ce.__webglTexture,a.TEXTURE0+z)}function Q(k,z){const Ce=n.get(k);if(k.version>0&&Ce.__version!==k.version){me(Ce,k,z);return}t.bindTexture(a.TEXTURE_CUBE_MAP,Ce.__webglTexture,a.TEXTURE0+z)}const se={[Bu]:a.REPEAT,[Jo]:a.CLAMP_TO_EDGE,[Qd]:a.MIRRORED_REPEAT},L={[Fa]:a.NEAREST,[ly]:a.NEAREST_MIPMAP_NEAREST,[UI]:a.NEAREST_MIPMAP_LINEAR,[Bi]:a.LINEAR,[Ud]:a.LINEAR_MIPMAP_NEAREST,[yl]:a.LINEAR_MIPMAP_LINEAR},D={[GV]:a.NEVER,[wV]:a.ALWAYS,[BV]:a.LESS,[j2]:a.LEQUAL,[vV]:a.EQUAL,[RV]:a.GEQUAL,[ZV]:a.GREATER,[SV]:a.NOTEQUAL};function ne(k,z){if(z.type===qs&&e.has("OES_texture_float_linear")===!1&&(z.magFilter===Bi||z.magFilter===Ud||z.magFilter===UI||z.magFilter===yl||z.minFilter===Bi||z.minFilter===Ud||z.minFilter===UI||z.minFilter===yl)&&console.warn("THREE.WebGLRenderer: Unable to use linear filtering with floating point textures. OES_texture_float_linear not supported on this device."),a.texParameteri(k,a.TEXTURE_WRAP_S,se[z.wrapS]),a.texParameteri(k,a.TEXTURE_WRAP_T,se[z.wrapT]),(k===a.TEXTURE_3D||k===a.TEXTURE_2D_ARRAY)&&a.texParameteri(k,a.TEXTURE_WRAP_R,se[z.wrapR]),a.texParameteri(k,a.TEXTURE_MAG_FILTER,L[z.magFilter]),a.texParameteri(k,a.TEXTURE_MIN_FILTER,L[z.minFilter]),z.compareFunction&&(a.texParameteri(k,a.TEXTURE_COMPARE_MODE,a.COMPARE_REF_TO_TEXTURE),a.texParameteri(k,a.TEXTURE_COMPARE_FUNC,D[z.compareFunction])),e.has("EXT_texture_filter_anisotropic")===!0){if(z.magFilter===Fa||z.minFilter!==UI&&z.minFilter!==yl||z.type===qs&&e.has("OES_texture_float_linear")===!1)return;if(z.anisotropy>1||n.get(z).__currentAnisotropy){const Ce=e.get("EXT_texture_filter_anisotropic");a.texParameterf(k,Ce.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(z.anisotropy,i.getMaxAnisotropy())),n.get(z).__currentAnisotropy=z.anisotropy}}}function oe(k,z){let Ce=!1;k.__webglInit===void 0&&(k.__webglInit=!0,z.addEventListener("dispose",H));const Ve=z.source;let Ge=f.get(Ve);Ge===void 0&&(Ge={},f.set(Ve,Ge));const we=ie(z);if(we!==k.__cacheKey){Ge[we]===void 0&&(Ge[we]={texture:a.createTexture(),usedTimes:0},o.memory.textures++,Ce=!0),Ge[we].usedTimes++;const et=Ge[k.__cacheKey];et!==void 0&&(Ge[k.__cacheKey].usedTimes--,et.usedTimes===0&&Y(z)),k.__cacheKey=we,k.__webglTexture=Ge[we].texture}return Ce}function j(k,z,Ce){return Math.floor(Math.floor(k/Ce)/z)}function re(k,z,Ce,Ve){const we=k.updateRanges;if(we.length===0)t.texSubImage2D(a.TEXTURE_2D,0,0,0,z.width,z.height,Ce,Ve,z.data);else{we.sort((Ne,tt)=>Ne.start-tt.start);let et=0;for(let Ne=1;Ne<we.length;Ne++){const tt=we[et],nt=we[Ne],ue=tt.start+tt.count,xe=j(nt.start,z.width,4),ct=j(tt.start,z.width,4);nt.start<=ue+1&&xe===ct&&j(nt.start+nt.count-1,z.width,4)===xe?tt.count=Math.max(tt.count,nt.start+nt.count-tt.start):(++et,we[et]=nt)}we.length=et+1;const lt=a.getParameter(a.UNPACK_ROW_LENGTH),Ct=a.getParameter(a.UNPACK_SKIP_PIXELS),At=a.getParameter(a.UNPACK_SKIP_ROWS);a.pixelStorei(a.UNPACK_ROW_LENGTH,z.width);for(let Ne=0,tt=we.length;Ne<tt;Ne++){const nt=we[Ne],ue=Math.floor(nt.start/4),xe=Math.ceil(nt.count/4),ct=ue%z.width,Ie=Math.floor(ue/z.width),Qe=xe,je=1;a.pixelStorei(a.UNPACK_SKIP_PIXELS,ct),a.pixelStorei(a.UNPACK_SKIP_ROWS,Ie),t.texSubImage2D(a.TEXTURE_2D,0,ct,Ie,Qe,je,Ce,Ve,z.data)}k.clearUpdateRanges(),a.pixelStorei(a.UNPACK_ROW_LENGTH,lt),a.pixelStorei(a.UNPACK_SKIP_PIXELS,Ct),a.pixelStorei(a.UNPACK_SKIP_ROWS,At)}}function pe(k,z,Ce){let Ve=a.TEXTURE_2D;(z.isDataArrayTexture||z.isCompressedArrayTexture)&&(Ve=a.TEXTURE_2D_ARRAY),z.isData3DTexture&&(Ve=a.TEXTURE_3D);const Ge=oe(k,z),we=z.source;t.bindTexture(Ve,k.__webglTexture,a.TEXTURE0+Ce);const et=n.get(we);if(we.version!==et.__version||Ge===!0){t.activeTexture(a.TEXTURE0+Ce);const lt=Mn.getPrimaries(Mn.workingColorSpace),Ct=z.colorSpace===ac?null:Mn.getPrimaries(z.colorSpace),At=z.colorSpace===ac||lt===Ct?a.NONE:a.BROWSER_DEFAULT_WEBGL;a.pixelStorei(a.UNPACK_FLIP_Y_WEBGL,z.flipY),a.pixelStorei(a.UNPACK_PREMULTIPLY_ALPHA_WEBGL,z.premultiplyAlpha),a.pixelStorei(a.UNPACK_ALIGNMENT,z.unpackAlignment),a.pixelStorei(a.UNPACK_COLORSPACE_CONVERSION_WEBGL,At);let Ne=v(z.image,!1,i.maxTextureSize);Ne=Ze(z,Ne);const tt=s.convert(z.format,z.colorSpace),nt=s.convert(z.type);let ue=x(z.internalFormat,tt,nt,z.colorSpace,z.isVideoTexture);ne(Ve,z);let xe;const ct=z.mipmaps,Ie=z.isVideoTexture!==!0,Qe=et.__version===void 0||Ge===!0,je=we.dataReady,mt=M(z,Ne);if(z.isDepthTexture)ue=w(z.format===eA,z.type),Qe&&(Ie?t.texStorage2D(a.TEXTURE_2D,1,ue,Ne.width,Ne.height):t.texImage2D(a.TEXTURE_2D,0,ue,Ne.width,Ne.height,0,tt,nt,null));else if(z.isDataTexture)if(ct.length>0){Ie&&Qe&&t.texStorage2D(a.TEXTURE_2D,mt,ue,ct[0].width,ct[0].height);for(let it=0,_e=ct.length;it<_e;it++)xe=ct[it],Ie?je&&t.texSubImage2D(a.TEXTURE_2D,it,0,0,xe.width,xe.height,tt,nt,xe.data):t.texImage2D(a.TEXTURE_2D,it,ue,xe.width,xe.height,0,tt,nt,xe.data);z.generateMipmaps=!1}else Ie?(Qe&&t.texStorage2D(a.TEXTURE_2D,mt,ue,Ne.width,Ne.height),je&&re(z,Ne,tt,nt)):t.texImage2D(a.TEXTURE_2D,0,ue,Ne.width,Ne.height,0,tt,nt,Ne.data);else if(z.isCompressedTexture)if(z.isCompressedArrayTexture){Ie&&Qe&&t.texStorage3D(a.TEXTURE_2D_ARRAY,mt,ue,ct[0].width,ct[0].height,Ne.depth);for(let it=0,_e=ct.length;it<_e;it++)if(xe=ct[it],z.format!==Gs)if(tt!==null)if(Ie){if(je)if(z.layerUpdates.size>0){const ht=Pv(xe.width,xe.height,z.format,z.type);for(const yt of z.layerUpdates){const Bt=xe.data.subarray(yt*ht/xe.data.BYTES_PER_ELEMENT,(yt+1)*ht/xe.data.BYTES_PER_ELEMENT);t.compressedTexSubImage3D(a.TEXTURE_2D_ARRAY,it,0,0,yt,xe.width,xe.height,1,tt,Bt)}z.clearLayerUpdates()}else t.compressedTexSubImage3D(a.TEXTURE_2D_ARRAY,it,0,0,0,xe.width,xe.height,Ne.depth,tt,xe.data)}else t.compressedTexImage3D(a.TEXTURE_2D_ARRAY,it,ue,xe.width,xe.height,Ne.depth,0,xe.data,0,0);else console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()");else Ie?je&&t.texSubImage3D(a.TEXTURE_2D_ARRAY,it,0,0,0,xe.width,xe.height,Ne.depth,tt,nt,xe.data):t.texImage3D(a.TEXTURE_2D_ARRAY,it,ue,xe.width,xe.height,Ne.depth,0,tt,nt,xe.data)}else{Ie&&Qe&&t.texStorage2D(a.TEXTURE_2D,mt,ue,ct[0].width,ct[0].height);for(let it=0,_e=ct.length;it<_e;it++)xe=ct[it],z.format!==Gs?tt!==null?Ie?je&&t.compressedTexSubImage2D(a.TEXTURE_2D,it,0,0,xe.width,xe.height,tt,xe.data):t.compressedTexImage2D(a.TEXTURE_2D,it,ue,xe.width,xe.height,0,xe.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):Ie?je&&t.texSubImage2D(a.TEXTURE_2D,it,0,0,xe.width,xe.height,tt,nt,xe.data):t.texImage2D(a.TEXTURE_2D,it,ue,xe.width,xe.height,0,tt,nt,xe.data)}else if(z.isDataArrayTexture)if(Ie){if(Qe&&t.texStorage3D(a.TEXTURE_2D_ARRAY,mt,ue,Ne.width,Ne.height,Ne.depth),je)if(z.layerUpdates.size>0){const it=Pv(Ne.width,Ne.height,z.format,z.type);for(const _e of z.layerUpdates){const ht=Ne.data.subarray(_e*it/Ne.data.BYTES_PER_ELEMENT,(_e+1)*it/Ne.data.BYTES_PER_ELEMENT);t.texSubImage3D(a.TEXTURE_2D_ARRAY,0,0,0,_e,Ne.width,Ne.height,1,tt,nt,ht)}z.clearLayerUpdates()}else t.texSubImage3D(a.TEXTURE_2D_ARRAY,0,0,0,0,Ne.width,Ne.height,Ne.depth,tt,nt,Ne.data)}else t.texImage3D(a.TEXTURE_2D_ARRAY,0,ue,Ne.width,Ne.height,Ne.depth,0,tt,nt,Ne.data);else if(z.isData3DTexture)Ie?(Qe&&t.texStorage3D(a.TEXTURE_3D,mt,ue,Ne.width,Ne.height,Ne.depth),je&&t.texSubImage3D(a.TEXTURE_3D,0,0,0,0,Ne.width,Ne.height,Ne.depth,tt,nt,Ne.data)):t.texImage3D(a.TEXTURE_3D,0,ue,Ne.width,Ne.height,Ne.depth,0,tt,nt,Ne.data);else if(z.isFramebufferTexture){if(Qe)if(Ie)t.texStorage2D(a.TEXTURE_2D,mt,ue,Ne.width,Ne.height);else{let it=Ne.width,_e=Ne.height;for(let ht=0;ht<mt;ht++)t.texImage2D(a.TEXTURE_2D,ht,ue,it,_e,0,tt,nt,null),it>>=1,_e>>=1}}else if(ct.length>0){if(Ie&&Qe){const it=gt(ct[0]);t.texStorage2D(a.TEXTURE_2D,mt,ue,it.width,it.height)}for(let it=0,_e=ct.length;it<_e;it++)xe=ct[it],Ie?je&&t.texSubImage2D(a.TEXTURE_2D,it,0,0,tt,nt,xe):t.texImage2D(a.TEXTURE_2D,it,ue,tt,nt,xe);z.generateMipmaps=!1}else if(Ie){if(Qe){const it=gt(Ne);t.texStorage2D(a.TEXTURE_2D,mt,ue,it.width,it.height)}je&&t.texSubImage2D(a.TEXTURE_2D,0,0,0,tt,nt,Ne)}else t.texImage2D(a.TEXTURE_2D,0,ue,tt,nt,Ne);G(z)&&B(Ve),et.__version=we.version,z.onUpdate&&z.onUpdate(z)}k.__version=z.version}function me(k,z,Ce){if(z.image.length!==6)return;const Ve=oe(k,z),Ge=z.source;t.bindTexture(a.TEXTURE_CUBE_MAP,k.__webglTexture,a.TEXTURE0+Ce);const we=n.get(Ge);if(Ge.version!==we.__version||Ve===!0){t.activeTexture(a.TEXTURE0+Ce);const et=Mn.getPrimaries(Mn.workingColorSpace),lt=z.colorSpace===ac?null:Mn.getPrimaries(z.colorSpace),Ct=z.colorSpace===ac||et===lt?a.NONE:a.BROWSER_DEFAULT_WEBGL;a.pixelStorei(a.UNPACK_FLIP_Y_WEBGL,z.flipY),a.pixelStorei(a.UNPACK_PREMULTIPLY_ALPHA_WEBGL,z.premultiplyAlpha),a.pixelStorei(a.UNPACK_ALIGNMENT,z.unpackAlignment),a.pixelStorei(a.UNPACK_COLORSPACE_CONVERSION_WEBGL,Ct);const At=z.isCompressedTexture||z.image[0].isCompressedTexture,Ne=z.image[0]&&z.image[0].isDataTexture,tt=[];for(let _e=0;_e<6;_e++)!At&&!Ne?tt[_e]=v(z.image[_e],!0,i.maxCubemapSize):tt[_e]=Ne?z.image[_e].image:z.image[_e],tt[_e]=Ze(z,tt[_e]);const nt=tt[0],ue=s.convert(z.format,z.colorSpace),xe=s.convert(z.type),ct=x(z.internalFormat,ue,xe,z.colorSpace),Ie=z.isVideoTexture!==!0,Qe=we.__version===void 0||Ve===!0,je=Ge.dataReady;let mt=M(z,nt);ne(a.TEXTURE_CUBE_MAP,z);let it;if(At){Ie&&Qe&&t.texStorage2D(a.TEXTURE_CUBE_MAP,mt,ct,nt.width,nt.height);for(let _e=0;_e<6;_e++){it=tt[_e].mipmaps;for(let ht=0;ht<it.length;ht++){const yt=it[ht];z.format!==Gs?ue!==null?Ie?je&&t.compressedTexSubImage2D(a.TEXTURE_CUBE_MAP_POSITIVE_X+_e,ht,0,0,yt.width,yt.height,ue,yt.data):t.compressedTexImage2D(a.TEXTURE_CUBE_MAP_POSITIVE_X+_e,ht,ct,yt.width,yt.height,0,yt.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):Ie?je&&t.texSubImage2D(a.TEXTURE_CUBE_MAP_POSITIVE_X+_e,ht,0,0,yt.width,yt.height,ue,xe,yt.data):t.texImage2D(a.TEXTURE_CUBE_MAP_POSITIVE_X+_e,ht,ct,yt.width,yt.height,0,ue,xe,yt.data)}}}else{if(it=z.mipmaps,Ie&&Qe){it.length>0&&mt++;const _e=gt(tt[0]);t.texStorage2D(a.TEXTURE_CUBE_MAP,mt,ct,_e.width,_e.height)}for(let _e=0;_e<6;_e++)if(Ne){Ie?je&&t.texSubImage2D(a.TEXTURE_CUBE_MAP_POSITIVE_X+_e,0,0,0,tt[_e].width,tt[_e].height,ue,xe,tt[_e].data):t.texImage2D(a.TEXTURE_CUBE_MAP_POSITIVE_X+_e,0,ct,tt[_e].width,tt[_e].height,0,ue,xe,tt[_e].data);for(let ht=0;ht<it.length;ht++){const Bt=it[ht].image[_e].image;Ie?je&&t.texSubImage2D(a.TEXTURE_CUBE_MAP_POSITIVE_X+_e,ht+1,0,0,Bt.width,Bt.height,ue,xe,Bt.data):t.texImage2D(a.TEXTURE_CUBE_MAP_POSITIVE_X+_e,ht+1,ct,Bt.width,Bt.height,0,ue,xe,Bt.data)}}else{Ie?je&&t.texSubImage2D(a.TEXTURE_CUBE_MAP_POSITIVE_X+_e,0,0,0,ue,xe,tt[_e]):t.texImage2D(a.TEXTURE_CUBE_MAP_POSITIVE_X+_e,0,ct,ue,xe,tt[_e]);for(let ht=0;ht<it.length;ht++){const yt=it[ht];Ie?je&&t.texSubImage2D(a.TEXTURE_CUBE_MAP_POSITIVE_X+_e,ht+1,0,0,ue,xe,yt.image[_e]):t.texImage2D(a.TEXTURE_CUBE_MAP_POSITIVE_X+_e,ht+1,ct,ue,xe,yt.image[_e])}}}G(z)&&B(a.TEXTURE_CUBE_MAP),we.__version=Ge.version,z.onUpdate&&z.onUpdate(z)}k.__version=z.version}function be(k,z,Ce,Ve,Ge,we){const et=s.convert(Ce.format,Ce.colorSpace),lt=s.convert(Ce.type),Ct=x(Ce.internalFormat,et,lt,Ce.colorSpace),At=n.get(z),Ne=n.get(Ce);if(Ne.__renderTarget=z,!At.__hasExternalTextures){const tt=Math.max(1,z.width>>we),nt=Math.max(1,z.height>>we);Ge===a.TEXTURE_3D||Ge===a.TEXTURE_2D_ARRAY?t.texImage3D(Ge,we,Ct,tt,nt,z.depth,0,et,lt,null):t.texImage2D(Ge,we,Ct,tt,nt,0,et,lt,null)}t.bindFramebuffer(a.FRAMEBUFFER,k),Je(z)?r.framebufferTexture2DMultisampleEXT(a.FRAMEBUFFER,Ve,Ge,Ne.__webglTexture,0,ye(z)):(Ge===a.TEXTURE_2D||Ge>=a.TEXTURE_CUBE_MAP_POSITIVE_X&&Ge<=a.TEXTURE_CUBE_MAP_NEGATIVE_Z)&&a.framebufferTexture2D(a.FRAMEBUFFER,Ve,Ge,Ne.__webglTexture,we),t.bindFramebuffer(a.FRAMEBUFFER,null)}function $e(k,z,Ce){if(a.bindRenderbuffer(a.RENDERBUFFER,k),z.depthBuffer){const Ve=z.depthTexture,Ge=Ve&&Ve.isDepthTexture?Ve.type:null,we=w(z.stencilBuffer,Ge),et=z.stencilBuffer?a.DEPTH_STENCIL_ATTACHMENT:a.DEPTH_ATTACHMENT,lt=ye(z);Je(z)?r.renderbufferStorageMultisampleEXT(a.RENDERBUFFER,lt,we,z.width,z.height):Ce?a.renderbufferStorageMultisample(a.RENDERBUFFER,lt,we,z.width,z.height):a.renderbufferStorage(a.RENDERBUFFER,we,z.width,z.height),a.framebufferRenderbuffer(a.FRAMEBUFFER,et,a.RENDERBUFFER,k)}else{const Ve=z.textures;for(let Ge=0;Ge<Ve.length;Ge++){const we=Ve[Ge],et=s.convert(we.format,we.colorSpace),lt=s.convert(we.type),Ct=x(we.internalFormat,et,lt,we.colorSpace),At=ye(z);Ce&&Je(z)===!1?a.renderbufferStorageMultisample(a.RENDERBUFFER,At,Ct,z.width,z.height):Je(z)?r.renderbufferStorageMultisampleEXT(a.RENDERBUFFER,At,Ct,z.width,z.height):a.renderbufferStorage(a.RENDERBUFFER,Ct,z.width,z.height)}}a.bindRenderbuffer(a.RENDERBUFFER,null)}function qe(k,z){if(z&&z.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(t.bindFramebuffer(a.FRAMEBUFFER,k),!(z.depthTexture&&z.depthTexture.isDepthTexture))throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");const Ve=n.get(z.depthTexture);Ve.__renderTarget=z,(!Ve.__webglTexture||z.depthTexture.image.width!==z.width||z.depthTexture.image.height!==z.height)&&(z.depthTexture.image.width=z.width,z.depthTexture.image.height=z.height,z.depthTexture.needsUpdate=!0),le(z.depthTexture,0);const Ge=Ve.__webglTexture,we=ye(z);if(z.depthTexture.format===$d)Je(z)?r.framebufferTexture2DMultisampleEXT(a.FRAMEBUFFER,a.DEPTH_ATTACHMENT,a.TEXTURE_2D,Ge,0,we):a.framebufferTexture2D(a.FRAMEBUFFER,a.DEPTH_ATTACHMENT,a.TEXTURE_2D,Ge,0);else if(z.depthTexture.format===eA)Je(z)?r.framebufferTexture2DMultisampleEXT(a.FRAMEBUFFER,a.DEPTH_STENCIL_ATTACHMENT,a.TEXTURE_2D,Ge,0,we):a.framebufferTexture2D(a.FRAMEBUFFER,a.DEPTH_STENCIL_ATTACHMENT,a.TEXTURE_2D,Ge,0);else throw new Error("Unknown depthTexture format")}function ke(k){const z=n.get(k),Ce=k.isWebGLCubeRenderTarget===!0;if(z.__boundDepthTexture!==k.depthTexture){const Ve=k.depthTexture;if(z.__depthDisposeCallback&&z.__depthDisposeCallback(),Ve){const Ge=()=>{delete z.__boundDepthTexture,delete z.__depthDisposeCallback,Ve.removeEventListener("dispose",Ge)};Ve.addEventListener("dispose",Ge),z.__depthDisposeCallback=Ge}z.__boundDepthTexture=Ve}if(k.depthTexture&&!z.__autoAllocateDepthBuffer){if(Ce)throw new Error("target.depthTexture not supported in Cube render targets");const Ve=k.texture.mipmaps;Ve&&Ve.length>0?qe(z.__webglFramebuffer[0],k):qe(z.__webglFramebuffer,k)}else if(Ce){z.__webglDepthbuffer=[];for(let Ve=0;Ve<6;Ve++)if(t.bindFramebuffer(a.FRAMEBUFFER,z.__webglFramebuffer[Ve]),z.__webglDepthbuffer[Ve]===void 0)z.__webglDepthbuffer[Ve]=a.createRenderbuffer(),$e(z.__webglDepthbuffer[Ve],k,!1);else{const Ge=k.stencilBuffer?a.DEPTH_STENCIL_ATTACHMENT:a.DEPTH_ATTACHMENT,we=z.__webglDepthbuffer[Ve];a.bindRenderbuffer(a.RENDERBUFFER,we),a.framebufferRenderbuffer(a.FRAMEBUFFER,Ge,a.RENDERBUFFER,we)}}else{const Ve=k.texture.mipmaps;if(Ve&&Ve.length>0?t.bindFramebuffer(a.FRAMEBUFFER,z.__webglFramebuffer[0]):t.bindFramebuffer(a.FRAMEBUFFER,z.__webglFramebuffer),z.__webglDepthbuffer===void 0)z.__webglDepthbuffer=a.createRenderbuffer(),$e(z.__webglDepthbuffer,k,!1);else{const Ge=k.stencilBuffer?a.DEPTH_STENCIL_ATTACHMENT:a.DEPTH_ATTACHMENT,we=z.__webglDepthbuffer;a.bindRenderbuffer(a.RENDERBUFFER,we),a.framebufferRenderbuffer(a.FRAMEBUFFER,Ge,a.RENDERBUFFER,we)}}t.bindFramebuffer(a.FRAMEBUFFER,null)}function Te(k,z,Ce){const Ve=n.get(k);z!==void 0&&be(Ve.__webglFramebuffer,k,k.texture,a.COLOR_ATTACHMENT0,a.TEXTURE_2D,0),Ce!==void 0&&ke(k)}function ut(k){const z=k.texture,Ce=n.get(k),Ve=n.get(z);k.addEventListener("dispose",N);const Ge=k.textures,we=k.isWebGLCubeRenderTarget===!0,et=Ge.length>1;if(et||(Ve.__webglTexture===void 0&&(Ve.__webglTexture=a.createTexture()),Ve.__version=z.version,o.memory.textures++),we){Ce.__webglFramebuffer=[];for(let lt=0;lt<6;lt++)if(z.mipmaps&&z.mipmaps.length>0){Ce.__webglFramebuffer[lt]=[];for(let Ct=0;Ct<z.mipmaps.length;Ct++)Ce.__webglFramebuffer[lt][Ct]=a.createFramebuffer()}else Ce.__webglFramebuffer[lt]=a.createFramebuffer()}else{if(z.mipmaps&&z.mipmaps.length>0){Ce.__webglFramebuffer=[];for(let lt=0;lt<z.mipmaps.length;lt++)Ce.__webglFramebuffer[lt]=a.createFramebuffer()}else Ce.__webglFramebuffer=a.createFramebuffer();if(et)for(let lt=0,Ct=Ge.length;lt<Ct;lt++){const At=n.get(Ge[lt]);At.__webglTexture===void 0&&(At.__webglTexture=a.createTexture(),o.memory.textures++)}if(k.samples>0&&Je(k)===!1){Ce.__webglMultisampledFramebuffer=a.createFramebuffer(),Ce.__webglColorRenderbuffer=[],t.bindFramebuffer(a.FRAMEBUFFER,Ce.__webglMultisampledFramebuffer);for(let lt=0;lt<Ge.length;lt++){const Ct=Ge[lt];Ce.__webglColorRenderbuffer[lt]=a.createRenderbuffer(),a.bindRenderbuffer(a.RENDERBUFFER,Ce.__webglColorRenderbuffer[lt]);const At=s.convert(Ct.format,Ct.colorSpace),Ne=s.convert(Ct.type),tt=x(Ct.internalFormat,At,Ne,Ct.colorSpace,k.isXRRenderTarget===!0),nt=ye(k);a.renderbufferStorageMultisample(a.RENDERBUFFER,nt,tt,k.width,k.height),a.framebufferRenderbuffer(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0+lt,a.RENDERBUFFER,Ce.__webglColorRenderbuffer[lt])}a.bindRenderbuffer(a.RENDERBUFFER,null),k.depthBuffer&&(Ce.__webglDepthRenderbuffer=a.createRenderbuffer(),$e(Ce.__webglDepthRenderbuffer,k,!0)),t.bindFramebuffer(a.FRAMEBUFFER,null)}}if(we){t.bindTexture(a.TEXTURE_CUBE_MAP,Ve.__webglTexture),ne(a.TEXTURE_CUBE_MAP,z);for(let lt=0;lt<6;lt++)if(z.mipmaps&&z.mipmaps.length>0)for(let Ct=0;Ct<z.mipmaps.length;Ct++)be(Ce.__webglFramebuffer[lt][Ct],k,z,a.COLOR_ATTACHMENT0,a.TEXTURE_CUBE_MAP_POSITIVE_X+lt,Ct);else be(Ce.__webglFramebuffer[lt],k,z,a.COLOR_ATTACHMENT0,a.TEXTURE_CUBE_MAP_POSITIVE_X+lt,0);G(z)&&B(a.TEXTURE_CUBE_MAP),t.unbindTexture()}else if(et){for(let lt=0,Ct=Ge.length;lt<Ct;lt++){const At=Ge[lt],Ne=n.get(At);t.bindTexture(a.TEXTURE_2D,Ne.__webglTexture),ne(a.TEXTURE_2D,At),be(Ce.__webglFramebuffer,k,At,a.COLOR_ATTACHMENT0+lt,a.TEXTURE_2D,0),G(At)&&B(a.TEXTURE_2D)}t.unbindTexture()}else{let lt=a.TEXTURE_2D;if((k.isWebGL3DRenderTarget||k.isWebGLArrayRenderTarget)&&(lt=k.isWebGL3DRenderTarget?a.TEXTURE_3D:a.TEXTURE_2D_ARRAY),t.bindTexture(lt,Ve.__webglTexture),ne(lt,z),z.mipmaps&&z.mipmaps.length>0)for(let Ct=0;Ct<z.mipmaps.length;Ct++)be(Ce.__webglFramebuffer[Ct],k,z,a.COLOR_ATTACHMENT0,lt,Ct);else be(Ce.__webglFramebuffer,k,z,a.COLOR_ATTACHMENT0,lt,0);G(z)&&B(lt),t.unbindTexture()}k.depthBuffer&&ke(k)}function q(k){const z=k.textures;for(let Ce=0,Ve=z.length;Ce<Ve;Ce++){const Ge=z[Ce];if(G(Ge)){const we=R(k),et=n.get(Ge).__webglTexture;t.bindTexture(we,et),B(we),t.unbindTexture()}}}const De=[],Ke=[];function Ee(k){if(k.samples>0){if(Je(k)===!1){const z=k.textures,Ce=k.width,Ve=k.height;let Ge=a.COLOR_BUFFER_BIT;const we=k.stencilBuffer?a.DEPTH_STENCIL_ATTACHMENT:a.DEPTH_ATTACHMENT,et=n.get(k),lt=z.length>1;if(lt)for(let At=0;At<z.length;At++)t.bindFramebuffer(a.FRAMEBUFFER,et.__webglMultisampledFramebuffer),a.framebufferRenderbuffer(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0+At,a.RENDERBUFFER,null),t.bindFramebuffer(a.FRAMEBUFFER,et.__webglFramebuffer),a.framebufferTexture2D(a.DRAW_FRAMEBUFFER,a.COLOR_ATTACHMENT0+At,a.TEXTURE_2D,null,0);t.bindFramebuffer(a.READ_FRAMEBUFFER,et.__webglMultisampledFramebuffer);const Ct=k.texture.mipmaps;Ct&&Ct.length>0?t.bindFramebuffer(a.DRAW_FRAMEBUFFER,et.__webglFramebuffer[0]):t.bindFramebuffer(a.DRAW_FRAMEBUFFER,et.__webglFramebuffer);for(let At=0;At<z.length;At++){if(k.resolveDepthBuffer&&(k.depthBuffer&&(Ge|=a.DEPTH_BUFFER_BIT),k.stencilBuffer&&k.resolveStencilBuffer&&(Ge|=a.STENCIL_BUFFER_BIT)),lt){a.framebufferRenderbuffer(a.READ_FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.RENDERBUFFER,et.__webglColorRenderbuffer[At]);const Ne=n.get(z[At]).__webglTexture;a.framebufferTexture2D(a.DRAW_FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.TEXTURE_2D,Ne,0)}a.blitFramebuffer(0,0,Ce,Ve,0,0,Ce,Ve,Ge,a.NEAREST),g===!0&&(De.length=0,Ke.length=0,De.push(a.COLOR_ATTACHMENT0+At),k.depthBuffer&&k.resolveDepthBuffer===!1&&(De.push(we),Ke.push(we),a.invalidateFramebuffer(a.DRAW_FRAMEBUFFER,Ke)),a.invalidateFramebuffer(a.READ_FRAMEBUFFER,De))}if(t.bindFramebuffer(a.READ_FRAMEBUFFER,null),t.bindFramebuffer(a.DRAW_FRAMEBUFFER,null),lt)for(let At=0;At<z.length;At++){t.bindFramebuffer(a.FRAMEBUFFER,et.__webglMultisampledFramebuffer),a.framebufferRenderbuffer(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0+At,a.RENDERBUFFER,et.__webglColorRenderbuffer[At]);const Ne=n.get(z[At]).__webglTexture;t.bindFramebuffer(a.FRAMEBUFFER,et.__webglFramebuffer),a.framebufferTexture2D(a.DRAW_FRAMEBUFFER,a.COLOR_ATTACHMENT0+At,a.TEXTURE_2D,Ne,0)}t.bindFramebuffer(a.DRAW_FRAMEBUFFER,et.__webglMultisampledFramebuffer)}else if(k.depthBuffer&&k.resolveDepthBuffer===!1&&g){const z=k.stencilBuffer?a.DEPTH_STENCIL_ATTACHMENT:a.DEPTH_ATTACHMENT;a.invalidateFramebuffer(a.DRAW_FRAMEBUFFER,[z])}}}function ye(k){return Math.min(i.maxSamples,k.samples)}function Je(k){const z=n.get(k);return k.samples>0&&e.has("WEBGL_multisampled_render_to_texture")===!0&&z.__useRenderToTexture!==!1}function Me(k){const z=o.render.frame;C.get(k)!==z&&(C.set(k,z),k.update())}function Ze(k,z){const Ce=k.colorSpace,Ve=k.format,Ge=k.type;return k.isCompressedTexture===!0||k.isVideoTexture===!0||Ce!==vu&&Ce!==ac&&(Mn.getTransfer(Ce)===ei?(Ve!==Gs||Ge!==vl)&&console.warn("THREE.WebGLTextures: sRGB encoded textures have to use RGBAFormat and UnsignedByteType."):console.error("THREE.WebGLTextures: Unsupported texture color space:",Ce)),z}function gt(k){return typeof HTMLImageElement<"u"&&k instanceof HTMLImageElement?(u.width=k.naturalWidth||k.width,u.height=k.naturalHeight||k.height):typeof VideoFrame<"u"&&k instanceof VideoFrame?(u.width=k.displayWidth,u.height=k.displayHeight):(u.width=k.width,u.height=k.height),u}this.allocateTextureUnit=P,this.resetTextureUnits=O,this.setTexture2D=le,this.setTexture2DArray=T,this.setTexture3D=J,this.setTextureCube=Q,this.rebindTextures=Te,this.setupRenderTarget=ut,this.updateRenderTargetMipmap=q,this.updateMultisampleRenderTarget=Ee,this.setupDepthRenderbuffer=ke,this.setupFrameBufferTexture=be,this.useMultisampledRTT=Je}function VM(a,e){function t(n,i=ac){let s;const o=Mn.getTransfer(i);if(n===vl)return a.UNSIGNED_BYTE;if(n===gy)return a.UNSIGNED_SHORT_4_4_4_4;if(n===cy)return a.UNSIGNED_SHORT_5_5_5_1;if(n===_2)return a.UNSIGNED_INT_5_9_9_9_REV;if(n===z2)return a.BYTE;if(n===L2)return a.SHORT;if(n===jd)return a.UNSIGNED_SHORT;if(n===ry)return a.INT;if(n===fc)return a.UNSIGNED_INT;if(n===qs)return a.FLOAT;if(n===dC)return a.HALF_FLOAT;if(n===U2)return a.ALPHA;if(n===D2)return a.RGB;if(n===Gs)return a.RGBA;if(n===$d)return a.DEPTH_COMPONENT;if(n===eA)return a.DEPTH_STENCIL;if(n===uy)return a.RED;if(n===Uf)return a.RED_INTEGER;if(n===k2)return a.RG;if(n===Iy)return a.RG_INTEGER;if(n===Cy)return a.RGBA_INTEGER;if(n===uf||n===If||n===Cf||n===df)if(o===ei)if(s=e.get("WEBGL_compressed_texture_s3tc_srgb"),s!==null){if(n===uf)return s.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(n===If)return s.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(n===Cf)return s.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(n===df)return s.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else return null;else if(s=e.get("WEBGL_compressed_texture_s3tc"),s!==null){if(n===uf)return s.COMPRESSED_RGB_S3TC_DXT1_EXT;if(n===If)return s.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(n===Cf)return s.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(n===df)return s.COMPRESSED_RGBA_S3TC_DXT5_EXT}else return null;if(n===o0||n===l0||n===r0||n===g0)if(s=e.get("WEBGL_compressed_texture_pvrtc"),s!==null){if(n===o0)return s.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(n===l0)return s.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(n===r0)return s.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(n===g0)return s.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}else return null;if(n===c0||n===u0||n===I0)if(s=e.get("WEBGL_compressed_texture_etc"),s!==null){if(n===c0||n===u0)return o===ei?s.COMPRESSED_SRGB8_ETC2:s.COMPRESSED_RGB8_ETC2;if(n===I0)return o===ei?s.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:s.COMPRESSED_RGBA8_ETC2_EAC}else return null;if(n===C0||n===d0||n===A0||n===h0||n===f0||n===p0||n===m0||n===b0||n===y0||n===G0||n===B0||n===v0||n===Z0||n===S0)if(s=e.get("WEBGL_compressed_texture_astc"),s!==null){if(n===C0)return o===ei?s.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:s.COMPRESSED_RGBA_ASTC_4x4_KHR;if(n===d0)return o===ei?s.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:s.COMPRESSED_RGBA_ASTC_5x4_KHR;if(n===A0)return o===ei?s.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:s.COMPRESSED_RGBA_ASTC_5x5_KHR;if(n===h0)return o===ei?s.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:s.COMPRESSED_RGBA_ASTC_6x5_KHR;if(n===f0)return o===ei?s.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:s.COMPRESSED_RGBA_ASTC_6x6_KHR;if(n===p0)return o===ei?s.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:s.COMPRESSED_RGBA_ASTC_8x5_KHR;if(n===m0)return o===ei?s.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:s.COMPRESSED_RGBA_ASTC_8x6_KHR;if(n===b0)return o===ei?s.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:s.COMPRESSED_RGBA_ASTC_8x8_KHR;if(n===y0)return o===ei?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:s.COMPRESSED_RGBA_ASTC_10x5_KHR;if(n===G0)return o===ei?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:s.COMPRESSED_RGBA_ASTC_10x6_KHR;if(n===B0)return o===ei?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:s.COMPRESSED_RGBA_ASTC_10x8_KHR;if(n===v0)return o===ei?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:s.COMPRESSED_RGBA_ASTC_10x10_KHR;if(n===Z0)return o===ei?s.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:s.COMPRESSED_RGBA_ASTC_12x10_KHR;if(n===S0)return o===ei?s.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:s.COMPRESSED_RGBA_ASTC_12x12_KHR}else return null;if(n===Af||n===R0||n===w0)if(s=e.get("EXT_texture_compression_bptc"),s!==null){if(n===Af)return o===ei?s.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:s.COMPRESSED_RGBA_BPTC_UNORM_EXT;if(n===R0)return s.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT;if(n===w0)return s.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT}else return null;if(n===O2||n===x0||n===W0||n===V0)if(s=e.get("EXT_texture_compression_rgtc"),s!==null){if(n===Af)return s.COMPRESSED_RED_RGTC1_EXT;if(n===x0)return s.COMPRESSED_SIGNED_RED_RGTC1_EXT;if(n===W0)return s.COMPRESSED_RED_GREEN_RGTC2_EXT;if(n===V0)return s.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT}else return null;return n===qd?a.UNSIGNED_INT_24_8:a[n]!==void 0?a[n]:null}return{convert:t}}const Qz=`
void main() {

	gl_Position = vec4( position, 1.0 );

}`,jz=`
uniform sampler2DArray depthColor;
uniform float depthWidth;
uniform float depthHeight;

void main() {

	vec2 coord = vec2( gl_FragCoord.x / depthWidth, gl_FragCoord.y / depthHeight );

	if ( coord.x >= 1.0 ) {

		gl_FragDepth = texture( depthColor, vec3( coord.x - 1.0, coord.y, 1 ) ).r;

	} else {

		gl_FragDepth = texture( depthColor, vec3( coord.x, coord.y, 0 ) ).r;

	}

}`;class qz{constructor(){this.texture=null,this.mesh=null,this.depthNear=0,this.depthFar=0}init(e,t,n){if(this.texture===null){const i=new Zi,s=e.properties.get(i);s.__webglTexture=t.texture,(t.depthNear!==n.depthNear||t.depthFar!==n.depthFar)&&(this.depthNear=t.depthNear,this.depthFar=t.depthFar),this.texture=i}}getMesh(e){if(this.texture!==null&&this.mesh===null){const t=e.cameras[0].viewport,n=new Zl({vertexShader:Qz,fragmentShader:jz,uniforms:{depthColor:{value:this.texture},depthWidth:{value:t.z},depthHeight:{value:t.w}}});this.mesh=new vi(new bc(20,20),n)}return this.mesh}reset(){this.texture=null,this.mesh=null}getDepthTexture(){return this.texture}}class $z extends bg{constructor(e,t){super();const n=this;let i=null,s=1,o=null,r="local-floor",g=1,u=null,C=null,h=null,f=null,p=null,y=null;const v=new qz,G=t.getContextAttributes();let B=null,R=null;const x=[],w=[],M=new at;let H=null;const N=new Xi;N.viewport=new Hn;const F=new Xi;F.viewport=new Hn;const Y=[N,F],X=new bM;let U=null,O=null;this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function(j){let re=x[j];return re===void 0&&(re=new Lb,x[j]=re),re.getTargetRaySpace()},this.getControllerGrip=function(j){let re=x[j];return re===void 0&&(re=new Lb,x[j]=re),re.getGripSpace()},this.getHand=function(j){let re=x[j];return re===void 0&&(re=new Lb,x[j]=re),re.getHandSpace()};function P(j){const re=w.indexOf(j.inputSource);if(re===-1)return;const pe=x[re];pe!==void 0&&(pe.update(j.inputSource,j.frame,u||o),pe.dispatchEvent({type:j.type,data:j.inputSource}))}function ie(){i.removeEventListener("select",P),i.removeEventListener("selectstart",P),i.removeEventListener("selectend",P),i.removeEventListener("squeeze",P),i.removeEventListener("squeezestart",P),i.removeEventListener("squeezeend",P),i.removeEventListener("end",ie),i.removeEventListener("inputsourceschange",le);for(let j=0;j<x.length;j++){const re=w[j];re!==null&&(w[j]=null,x[j].disconnect(re))}U=null,O=null,v.reset(),e.setRenderTarget(B),p=null,f=null,h=null,i=null,R=null,oe.stop(),n.isPresenting=!1,e.setPixelRatio(H),e.setSize(M.width,M.height,!1),n.dispatchEvent({type:"sessionend"})}this.setFramebufferScaleFactor=function(j){s=j,n.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(j){r=j,n.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return u||o},this.setReferenceSpace=function(j){u=j},this.getBaseLayer=function(){return f!==null?f:p},this.getBinding=function(){return h},this.getFrame=function(){return y},this.getSession=function(){return i},this.setSession=async function(j){if(i=j,i!==null){if(B=e.getRenderTarget(),i.addEventListener("select",P),i.addEventListener("selectstart",P),i.addEventListener("selectend",P),i.addEventListener("squeeze",P),i.addEventListener("squeezestart",P),i.addEventListener("squeezeend",P),i.addEventListener("end",ie),i.addEventListener("inputsourceschange",le),G.xrCompatible!==!0&&await t.makeXRCompatible(),H=e.getPixelRatio(),e.getSize(M),typeof XRWebGLBinding<"u"&&"createProjectionLayer"in XRWebGLBinding.prototype){let pe=null,me=null,be=null;G.depth&&(be=G.stencil?t.DEPTH24_STENCIL8:t.DEPTH_COMPONENT24,pe=G.stencil?eA:$d,me=G.stencil?qd:fc);const $e={colorFormat:t.RGBA8,depthFormat:be,scaleFactor:s};h=new XRWebGLBinding(i,t),f=h.createProjectionLayer($e),i.updateRenderState({layers:[f]}),e.setPixelRatio(1),e.setSize(f.textureWidth,f.textureHeight,!1),R=new br(f.textureWidth,f.textureHeight,{format:Gs,type:vl,depthTexture:new Zy(f.textureWidth,f.textureHeight,me,void 0,void 0,void 0,void 0,void 0,void 0,pe),stencilBuffer:G.stencil,colorSpace:e.outputColorSpace,samples:G.antialias?4:0,resolveDepthBuffer:f.ignoreDepthValues===!1,resolveStencilBuffer:f.ignoreDepthValues===!1})}else{const pe={antialias:G.antialias,alpha:!0,depth:G.depth,stencil:G.stencil,framebufferScaleFactor:s};p=new XRWebGLLayer(i,t,pe),i.updateRenderState({baseLayer:p}),e.setPixelRatio(1),e.setSize(p.framebufferWidth,p.framebufferHeight,!1),R=new br(p.framebufferWidth,p.framebufferHeight,{format:Gs,type:vl,colorSpace:e.outputColorSpace,stencilBuffer:G.stencil,resolveDepthBuffer:p.ignoreDepthValues===!1,resolveStencilBuffer:p.ignoreDepthValues===!1})}R.isXRRenderTarget=!0,this.setFoveation(g),u=null,o=await i.requestReferenceSpace(r),oe.setContext(i),oe.start(),n.isPresenting=!0,n.dispatchEvent({type:"sessionstart"})}},this.getEnvironmentBlendMode=function(){if(i!==null)return i.environmentBlendMode},this.getDepthTexture=function(){return v.getDepthTexture()};function le(j){for(let re=0;re<j.removed.length;re++){const pe=j.removed[re],me=w.indexOf(pe);me>=0&&(w[me]=null,x[me].disconnect(pe))}for(let re=0;re<j.added.length;re++){const pe=j.added[re];let me=w.indexOf(pe);if(me===-1){for(let $e=0;$e<x.length;$e++)if($e>=w.length){w.push(pe),me=$e;break}else if(w[$e]===null){w[$e]=pe,me=$e;break}if(me===-1)break}const be=x[me];be&&be.connect(pe)}}const T=new ae,J=new ae;function Q(j,re,pe){T.setFromMatrixPosition(re.matrixWorld),J.setFromMatrixPosition(pe.matrixWorld);const me=T.distanceTo(J),be=re.projectionMatrix.elements,$e=pe.projectionMatrix.elements,qe=be[14]/(be[10]-1),ke=be[14]/(be[10]+1),Te=(be[9]+1)/be[5],ut=(be[9]-1)/be[5],q=(be[8]-1)/be[0],De=($e[8]+1)/$e[0],Ke=qe*q,Ee=qe*De,ye=me/(-q+De),Je=ye*-q;if(re.matrixWorld.decompose(j.position,j.quaternion,j.scale),j.translateX(Je),j.translateZ(ye),j.matrixWorld.compose(j.position,j.quaternion,j.scale),j.matrixWorldInverse.copy(j.matrixWorld).invert(),be[10]===-1)j.projectionMatrix.copy(re.projectionMatrix),j.projectionMatrixInverse.copy(re.projectionMatrixInverse);else{const Me=qe+ye,Ze=ke+ye,gt=Ke-Je,k=Ee+(me-Je),z=Te*ke/Ze*Me,Ce=ut*ke/Ze*Me;j.projectionMatrix.makePerspective(gt,k,z,Ce,Me,Ze),j.projectionMatrixInverse.copy(j.projectionMatrix).invert()}}function se(j,re){re===null?j.matrixWorld.copy(j.matrix):j.matrixWorld.multiplyMatrices(re.matrixWorld,j.matrix),j.matrixWorldInverse.copy(j.matrixWorld).invert()}this.updateCamera=function(j){if(i===null)return;let re=j.near,pe=j.far;v.texture!==null&&(v.depthNear>0&&(re=v.depthNear),v.depthFar>0&&(pe=v.depthFar)),X.near=F.near=N.near=re,X.far=F.far=N.far=pe,(U!==X.near||O!==X.far)&&(i.updateRenderState({depthNear:X.near,depthFar:X.far}),U=X.near,O=X.far),N.layers.mask=j.layers.mask|2,F.layers.mask=j.layers.mask|4,X.layers.mask=N.layers.mask|F.layers.mask;const me=j.parent,be=X.cameras;se(X,me);for(let $e=0;$e<be.length;$e++)se(be[$e],me);be.length===2?Q(X,N,F):X.projectionMatrix.copy(N.projectionMatrix),L(j,X,me)};function L(j,re,pe){pe===null?j.matrix.copy(re.matrixWorld):(j.matrix.copy(pe.matrixWorld),j.matrix.invert(),j.matrix.multiply(re.matrixWorld)),j.matrix.decompose(j.position,j.quaternion,j.scale),j.updateMatrixWorld(!0),j.projectionMatrix.copy(re.projectionMatrix),j.projectionMatrixInverse.copy(re.projectionMatrixInverse),j.isPerspectiveCamera&&(j.fov=iA*2*Math.atan(1/j.projectionMatrix.elements[5]),j.zoom=1)}this.getCamera=function(){return X},this.getFoveation=function(){if(!(f===null&&p===null))return g},this.setFoveation=function(j){g=j,f!==null&&(f.fixedFoveation=j),p!==null&&p.fixedFoveation!==void 0&&(p.fixedFoveation=j)},this.hasDepthSensing=function(){return v.texture!==null},this.getDepthSensingMesh=function(){return v.getMesh(X)};let D=null;function ne(j,re){if(C=re.getViewerPose(u||o),y=re,C!==null){const pe=C.views;p!==null&&(e.setRenderTargetFramebuffer(R,p.framebuffer),e.setRenderTarget(R));let me=!1;pe.length!==X.cameras.length&&(X.cameras.length=0,me=!0);for(let qe=0;qe<pe.length;qe++){const ke=pe[qe];let Te=null;if(p!==null)Te=p.getViewport(ke);else{const q=h.getViewSubImage(f,ke);Te=q.viewport,qe===0&&(e.setRenderTargetTextures(R,q.colorTexture,q.depthStencilTexture),e.setRenderTarget(R))}let ut=Y[qe];ut===void 0&&(ut=new Xi,ut.layers.enable(qe),ut.viewport=new Hn,Y[qe]=ut),ut.matrix.fromArray(ke.transform.matrix),ut.matrix.decompose(ut.position,ut.quaternion,ut.scale),ut.projectionMatrix.fromArray(ke.projectionMatrix),ut.projectionMatrixInverse.copy(ut.projectionMatrix).invert(),ut.viewport.set(Te.x,Te.y,Te.width,Te.height),qe===0&&(X.matrix.copy(ut.matrix),X.matrix.decompose(X.position,X.quaternion,X.scale)),me===!0&&X.cameras.push(ut)}const be=i.enabledFeatures;if(be&&be.includes("depth-sensing")&&i.depthUsage=="gpu-optimized"&&h){const qe=h.getDepthInformation(pe[0]);qe&&qe.isValid&&qe.texture&&v.init(e,qe,i.renderState)}}for(let pe=0;pe<x.length;pe++){const me=w[pe],be=x[pe];me!==null&&be!==void 0&&be.update(me,re,u||o)}D&&D(j,re),re.detectedPlanes&&n.dispatchEvent({type:"planesdetected",data:re}),y=null}const oe=new SM;oe.setAnimationLoop(ne),this.setAnimationLoop=function(j){D=j},this.dispose=function(){}}}const HI=new to,eL=new Yt;function tL(a,e){function t(G,B){G.matrixAutoUpdate===!0&&G.updateMatrix(),B.value.copy(G.matrix)}function n(G,B){B.color.getRGB(G.fogColor.value,HV(a)),B.isFog?(G.fogNear.value=B.near,G.fogFar.value=B.far):B.isFogExp2&&(G.fogDensity.value=B.density)}function i(G,B,R,x,w){B.isMeshBasicMaterial||B.isMeshLambertMaterial?s(G,B):B.isMeshToonMaterial?(s(G,B),h(G,B)):B.isMeshPhongMaterial?(s(G,B),C(G,B)):B.isMeshStandardMaterial?(s(G,B),f(G,B),B.isMeshPhysicalMaterial&&p(G,B,w)):B.isMeshMatcapMaterial?(s(G,B),y(G,B)):B.isMeshDepthMaterial?s(G,B):B.isMeshDistanceMaterial?(s(G,B),v(G,B)):B.isMeshNormalMaterial?s(G,B):B.isLineBasicMaterial?(o(G,B),B.isLineDashedMaterial&&r(G,B)):B.isPointsMaterial?g(G,B,R,x):B.isSpriteMaterial?u(G,B):B.isShadowMaterial?(G.color.value.copy(B.color),G.opacity.value=B.opacity):B.isShaderMaterial&&(B.uniformsNeedUpdate=!1)}function s(G,B){G.opacity.value=B.opacity,B.color&&G.diffuse.value.copy(B.color),B.emissive&&G.emissive.value.copy(B.emissive).multiplyScalar(B.emissiveIntensity),B.map&&(G.map.value=B.map,t(B.map,G.mapTransform)),B.alphaMap&&(G.alphaMap.value=B.alphaMap,t(B.alphaMap,G.alphaMapTransform)),B.bumpMap&&(G.bumpMap.value=B.bumpMap,t(B.bumpMap,G.bumpMapTransform),G.bumpScale.value=B.bumpScale,B.side===eo&&(G.bumpScale.value*=-1)),B.normalMap&&(G.normalMap.value=B.normalMap,t(B.normalMap,G.normalMapTransform),G.normalScale.value.copy(B.normalScale),B.side===eo&&G.normalScale.value.negate()),B.displacementMap&&(G.displacementMap.value=B.displacementMap,t(B.displacementMap,G.displacementMapTransform),G.displacementScale.value=B.displacementScale,G.displacementBias.value=B.displacementBias),B.emissiveMap&&(G.emissiveMap.value=B.emissiveMap,t(B.emissiveMap,G.emissiveMapTransform)),B.specularMap&&(G.specularMap.value=B.specularMap,t(B.specularMap,G.specularMapTransform)),B.alphaTest>0&&(G.alphaTest.value=B.alphaTest);const R=e.get(B),x=R.envMap,w=R.envMapRotation;x&&(G.envMap.value=x,HI.copy(w),HI.x*=-1,HI.y*=-1,HI.z*=-1,x.isCubeTexture&&x.isRenderTargetTexture===!1&&(HI.y*=-1,HI.z*=-1),G.envMapRotation.value.setFromMatrix4(eL.makeRotationFromEuler(HI)),G.flipEnvMap.value=x.isCubeTexture&&x.isRenderTargetTexture===!1?-1:1,G.reflectivity.value=B.reflectivity,G.ior.value=B.ior,G.refractionRatio.value=B.refractionRatio),B.lightMap&&(G.lightMap.value=B.lightMap,G.lightMapIntensity.value=B.lightMapIntensity,t(B.lightMap,G.lightMapTransform)),B.aoMap&&(G.aoMap.value=B.aoMap,G.aoMapIntensity.value=B.aoMapIntensity,t(B.aoMap,G.aoMapTransform))}function o(G,B){G.diffuse.value.copy(B.color),G.opacity.value=B.opacity,B.map&&(G.map.value=B.map,t(B.map,G.mapTransform))}function r(G,B){G.dashSize.value=B.dashSize,G.totalSize.value=B.dashSize+B.gapSize,G.scale.value=B.scale}function g(G,B,R,x){G.diffuse.value.copy(B.color),G.opacity.value=B.opacity,G.size.value=B.size*R,G.scale.value=x*.5,B.map&&(G.map.value=B.map,t(B.map,G.uvTransform)),B.alphaMap&&(G.alphaMap.value=B.alphaMap,t(B.alphaMap,G.alphaMapTransform)),B.alphaTest>0&&(G.alphaTest.value=B.alphaTest)}function u(G,B){G.diffuse.value.copy(B.color),G.opacity.value=B.opacity,G.rotation.value=B.rotation,B.map&&(G.map.value=B.map,t(B.map,G.mapTransform)),B.alphaMap&&(G.alphaMap.value=B.alphaMap,t(B.alphaMap,G.alphaMapTransform)),B.alphaTest>0&&(G.alphaTest.value=B.alphaTest)}function C(G,B){G.specular.value.copy(B.specular),G.shininess.value=Math.max(B.shininess,1e-4)}function h(G,B){B.gradientMap&&(G.gradientMap.value=B.gradientMap)}function f(G,B){G.metalness.value=B.metalness,B.metalnessMap&&(G.metalnessMap.value=B.metalnessMap,t(B.metalnessMap,G.metalnessMapTransform)),G.roughness.value=B.roughness,B.roughnessMap&&(G.roughnessMap.value=B.roughnessMap,t(B.roughnessMap,G.roughnessMapTransform)),B.envMap&&(G.envMapIntensity.value=B.envMapIntensity)}function p(G,B,R){G.ior.value=B.ior,B.sheen>0&&(G.sheenColor.value.copy(B.sheenColor).multiplyScalar(B.sheen),G.sheenRoughness.value=B.sheenRoughness,B.sheenColorMap&&(G.sheenColorMap.value=B.sheenColorMap,t(B.sheenColorMap,G.sheenColorMapTransform)),B.sheenRoughnessMap&&(G.sheenRoughnessMap.value=B.sheenRoughnessMap,t(B.sheenRoughnessMap,G.sheenRoughnessMapTransform))),B.clearcoat>0&&(G.clearcoat.value=B.clearcoat,G.clearcoatRoughness.value=B.clearcoatRoughness,B.clearcoatMap&&(G.clearcoatMap.value=B.clearcoatMap,t(B.clearcoatMap,G.clearcoatMapTransform)),B.clearcoatRoughnessMap&&(G.clearcoatRoughnessMap.value=B.clearcoatRoughnessMap,t(B.clearcoatRoughnessMap,G.clearcoatRoughnessMapTransform)),B.clearcoatNormalMap&&(G.clearcoatNormalMap.value=B.clearcoatNormalMap,t(B.clearcoatNormalMap,G.clearcoatNormalMapTransform),G.clearcoatNormalScale.value.copy(B.clearcoatNormalScale),B.side===eo&&G.clearcoatNormalScale.value.negate())),B.dispersion>0&&(G.dispersion.value=B.dispersion),B.iridescence>0&&(G.iridescence.value=B.iridescence,G.iridescenceIOR.value=B.iridescenceIOR,G.iridescenceThicknessMinimum.value=B.iridescenceThicknessRange[0],G.iridescenceThicknessMaximum.value=B.iridescenceThicknessRange[1],B.iridescenceMap&&(G.iridescenceMap.value=B.iridescenceMap,t(B.iridescenceMap,G.iridescenceMapTransform)),B.iridescenceThicknessMap&&(G.iridescenceThicknessMap.value=B.iridescenceThicknessMap,t(B.iridescenceThicknessMap,G.iridescenceThicknessMapTransform))),B.transmission>0&&(G.transmission.value=B.transmission,G.transmissionSamplerMap.value=R.texture,G.transmissionSamplerSize.value.set(R.width,R.height),B.transmissionMap&&(G.transmissionMap.value=B.transmissionMap,t(B.transmissionMap,G.transmissionMapTransform)),G.thickness.value=B.thickness,B.thicknessMap&&(G.thicknessMap.value=B.thicknessMap,t(B.thicknessMap,G.thicknessMapTransform)),G.attenuationDistance.value=B.attenuationDistance,G.attenuationColor.value.copy(B.attenuationColor)),B.anisotropy>0&&(G.anisotropyVector.value.set(B.anisotropy*Math.cos(B.anisotropyRotation),B.anisotropy*Math.sin(B.anisotropyRotation)),B.anisotropyMap&&(G.anisotropyMap.value=B.anisotropyMap,t(B.anisotropyMap,G.anisotropyMapTransform))),G.specularIntensity.value=B.specularIntensity,G.specularColor.value.copy(B.specularColor),B.specularColorMap&&(G.specularColorMap.value=B.specularColorMap,t(B.specularColorMap,G.specularColorMapTransform)),B.specularIntensityMap&&(G.specularIntensityMap.value=B.specularIntensityMap,t(B.specularIntensityMap,G.specularIntensityMapTransform))}function y(G,B){B.matcap&&(G.matcap.value=B.matcap)}function v(G,B){const R=e.get(B).light;G.referencePosition.value.setFromMatrixPosition(R.matrixWorld),G.nearDistance.value=R.shadow.camera.near,G.farDistance.value=R.shadow.camera.far}return{refreshFogUniforms:n,refreshMaterialUniforms:i}}function nL(a,e,t,n){let i={},s={},o=[];const r=a.getParameter(a.MAX_UNIFORM_BUFFER_BINDINGS);function g(R,x){const w=x.program;n.uniformBlockBinding(R,w)}function u(R,x){let w=i[R.id];w===void 0&&(y(R),w=C(R),i[R.id]=w,R.addEventListener("dispose",G));const M=x.program;n.updateUBOMapping(R,M);const H=e.render.frame;s[R.id]!==H&&(f(R),s[R.id]=H)}function C(R){const x=h();R.__bindingPointIndex=x;const w=a.createBuffer(),M=R.__size,H=R.usage;return a.bindBuffer(a.UNIFORM_BUFFER,w),a.bufferData(a.UNIFORM_BUFFER,M,H),a.bindBuffer(a.UNIFORM_BUFFER,null),a.bindBufferBase(a.UNIFORM_BUFFER,x,w),w}function h(){for(let R=0;R<r;R++)if(o.indexOf(R)===-1)return o.push(R),R;return console.error("THREE.WebGLRenderer: Maximum number of simultaneously usable uniforms groups reached."),0}function f(R){const x=i[R.id],w=R.uniforms,M=R.__cache;a.bindBuffer(a.UNIFORM_BUFFER,x);for(let H=0,N=w.length;H<N;H++){const F=Array.isArray(w[H])?w[H]:[w[H]];for(let Y=0,X=F.length;Y<X;Y++){const U=F[Y];if(p(U,H,Y,M)===!0){const O=U.__offset,P=Array.isArray(U.value)?U.value:[U.value];let ie=0;for(let le=0;le<P.length;le++){const T=P[le],J=v(T);typeof T=="number"||typeof T=="boolean"?(U.__data[0]=T,a.bufferSubData(a.UNIFORM_BUFFER,O+ie,U.__data)):T.isMatrix3?(U.__data[0]=T.elements[0],U.__data[1]=T.elements[1],U.__data[2]=T.elements[2],U.__data[3]=0,U.__data[4]=T.elements[3],U.__data[5]=T.elements[4],U.__data[6]=T.elements[5],U.__data[7]=0,U.__data[8]=T.elements[6],U.__data[9]=T.elements[7],U.__data[10]=T.elements[8],U.__data[11]=0):(T.toArray(U.__data,ie),ie+=J.storage/Float32Array.BYTES_PER_ELEMENT)}a.bufferSubData(a.UNIFORM_BUFFER,O,U.__data)}}}a.bindBuffer(a.UNIFORM_BUFFER,null)}function p(R,x,w,M){const H=R.value,N=x+"_"+w;if(M[N]===void 0)return typeof H=="number"||typeof H=="boolean"?M[N]=H:M[N]=H.clone(),!0;{const F=M[N];if(typeof H=="number"||typeof H=="boolean"){if(F!==H)return M[N]=H,!0}else if(F.equals(H)===!1)return F.copy(H),!0}return!1}function y(R){const x=R.uniforms;let w=0;const M=16;for(let N=0,F=x.length;N<F;N++){const Y=Array.isArray(x[N])?x[N]:[x[N]];for(let X=0,U=Y.length;X<U;X++){const O=Y[X],P=Array.isArray(O.value)?O.value:[O.value];for(let ie=0,le=P.length;ie<le;ie++){const T=P[ie],J=v(T),Q=w%M,se=Q%J.boundary,L=Q+se;w+=se,L!==0&&M-L<J.storage&&(w+=M-L),O.__data=new Float32Array(J.storage/Float32Array.BYTES_PER_ELEMENT),O.__offset=w,w+=J.storage}}}const H=w%M;return H>0&&(w+=M-H),R.__size=w,R.__cache={},this}function v(R){const x={boundary:0,storage:0};return typeof R=="number"||typeof R=="boolean"?(x.boundary=4,x.storage=4):R.isVector2?(x.boundary=8,x.storage=8):R.isVector3||R.isColor?(x.boundary=16,x.storage=12):R.isVector4?(x.boundary=16,x.storage=16):R.isMatrix3?(x.boundary=48,x.storage=48):R.isMatrix4?(x.boundary=64,x.storage=64):R.isTexture?console.warn("THREE.WebGLRenderer: Texture samplers can not be part of an uniforms group."):console.warn("THREE.WebGLRenderer: Unsupported uniform value type.",R),x}function G(R){const x=R.target;x.removeEventListener("dispose",G);const w=o.indexOf(x.__bindingPointIndex);o.splice(w,1),a.deleteBuffer(i[x.id]),delete i[x.id],delete s[x.id]}function B(){for(const R in i)a.deleteBuffer(i[R]);o=[],i={},s={}}return{bind:g,update:u,dispose:B}}class MM{constructor(e={}){const{canvas:t=WV(),context:n=null,depth:i=!0,stencil:s=!1,alpha:o=!1,antialias:r=!1,premultipliedAlpha:g=!0,preserveDrawingBuffer:u=!1,powerPreference:C="default",failIfMajorPerformanceCaveat:h=!1,reverseDepthBuffer:f=!1}=e;this.isWebGLRenderer=!0;let p;if(n!==null){if(typeof WebGLRenderingContext<"u"&&n instanceof WebGLRenderingContext)throw new Error("THREE.WebGLRenderer: WebGL 1 is not supported since r163.");p=n.getContextAttributes().alpha}else p=o;const y=new Uint32Array(4),v=new Int32Array(4);let G=null,B=null;const R=[],x=[];this.domElement=t,this.debug={checkShaderErrors:!0,onShaderError:null},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.toneMapping=Ag,this.toneMappingExposure=1,this.transmissionResolutionScale=1;const w=this;let M=!1;this._outputColorSpace=ys;let H=0,N=0,F=null,Y=-1,X=null;const U=new Hn,O=new Hn;let P=null;const ie=new Gt(0);let le=0,T=t.width,J=t.height,Q=1,se=null,L=null;const D=new Hn(0,0,T,J),ne=new Hn(0,0,T,J);let oe=!1;const j=new CA;let re=!1,pe=!1;const me=new Yt,be=new Yt,$e=new ae,qe=new Hn,ke={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};let Te=!1;function ut(){return F===null?Q:1}let q=n;function De($,Se){return t.getContext($,Se)}try{const $={alpha:!0,depth:i,stencil:s,antialias:r,premultipliedAlpha:g,preserveDrawingBuffer:u,powerPreference:C,failIfMajorPerformanceCaveat:h};if("setAttribute"in t&&t.setAttribute("data-engine",`three.js r${Lf}`),t.addEventListener("webglcontextlost",mt,!1),t.addEventListener("webglcontextrestored",it,!1),t.addEventListener("webglcontextcreationerror",_e,!1),q===null){const Se="webgl2";if(q=De(Se,$),q===null)throw De(Se)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}}catch($){throw console.error("THREE.WebGLRenderer: "+$.message),$}let Ke,Ee,ye,Je,Me,Ze,gt,k,z,Ce,Ve,Ge,we,et,lt,Ct,At,Ne,tt,nt,ue,xe,ct,Ie;function Qe(){Ke=new dT(q),Ke.init(),xe=new VM(q,Ke),Ee=new lT(q,Ke,e,xe),ye=new Jz(q,Ke),Ee.reverseDepthBuffer&&f&&ye.buffers.depth.setReversed(!0),Je=new fT(q),Me=new Nz,Ze=new Pz(q,Ke,ye,Me,Ee,xe,Je),gt=new gT(w),k=new CT(w),z=new BK(q),ct=new sT(q,z),Ce=new AT(q,z,Je,ct),Ve=new mT(q,Ce,z,Je),tt=new pT(q,Ee,Ze),Ct=new rT(Me),Ge=new Xz(w,gt,k,Ke,Ee,ct,Ct),we=new tL(w,Me),et=new Kz,lt=new _z(Ke),Ne=new aT(w,gt,k,ye,Ve,p,g),At=new kz(w,Ve,Ee),Ie=new nL(q,Je,Ee,ye),nt=new oT(q,Ke,Je),ue=new hT(q,Ke,Je),Je.programs=Ge.programs,w.capabilities=Ee,w.extensions=Ke,w.properties=Me,w.renderLists=et,w.shadowMap=At,w.state=ye,w.info=Je}Qe();const je=new $z(w,q);this.xr=je,this.getContext=function(){return q},this.getContextAttributes=function(){return q.getContextAttributes()},this.forceContextLoss=function(){const $=Ke.get("WEBGL_lose_context");$&&$.loseContext()},this.forceContextRestore=function(){const $=Ke.get("WEBGL_lose_context");$&&$.restoreContext()},this.getPixelRatio=function(){return Q},this.setPixelRatio=function($){$!==void 0&&(Q=$,this.setSize(T,J,!1))},this.getSize=function($){return $.set(T,J)},this.setSize=function($,Se,ze=!0){if(je.isPresenting){console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting.");return}T=$,J=Se,t.width=Math.floor($*Q),t.height=Math.floor(Se*Q),ze===!0&&(t.style.width=$+"px",t.style.height=Se+"px"),this.setViewport(0,0,$,Se)},this.getDrawingBufferSize=function($){return $.set(T*Q,J*Q).floor()},this.setDrawingBufferSize=function($,Se,ze){T=$,J=Se,Q=ze,t.width=Math.floor($*ze),t.height=Math.floor(Se*ze),this.setViewport(0,0,$,Se)},this.getCurrentViewport=function($){return $.copy(U)},this.getViewport=function($){return $.copy(D)},this.setViewport=function($,Se,ze,Be){$.isVector4?D.set($.x,$.y,$.z,$.w):D.set($,Se,ze,Be),ye.viewport(U.copy(D).multiplyScalar(Q).round())},this.getScissor=function($){return $.copy(ne)},this.setScissor=function($,Se,ze,Be){$.isVector4?ne.set($.x,$.y,$.z,$.w):ne.set($,Se,ze,Be),ye.scissor(O.copy(ne).multiplyScalar(Q).round())},this.getScissorTest=function(){return oe},this.setScissorTest=function($){ye.setScissorTest(oe=$)},this.setOpaqueSort=function($){se=$},this.setTransparentSort=function($){L=$},this.getClearColor=function($){return $.copy(Ne.getClearColor())},this.setClearColor=function(){Ne.setClearColor(...arguments)},this.getClearAlpha=function(){return Ne.getClearAlpha()},this.setClearAlpha=function(){Ne.setClearAlpha(...arguments)},this.clear=function($=!0,Se=!0,ze=!0){let Be=0;if($){let We=!1;if(F!==null){const dt=F.texture.format;We=dt===Cy||dt===Iy||dt===Uf}if(We){const dt=F.texture.type,bt=dt===vl||dt===fc||dt===jd||dt===qd||dt===gy||dt===cy,vt=Ne.getClearColor(),Zt=Ne.getClearAlpha(),Tt=vt.r,Xt=vt.g,Wt=vt.b;bt?(y[0]=Tt,y[1]=Xt,y[2]=Wt,y[3]=Zt,q.clearBufferuiv(q.COLOR,0,y)):(v[0]=Tt,v[1]=Xt,v[2]=Wt,v[3]=Zt,q.clearBufferiv(q.COLOR,0,v))}else Be|=q.COLOR_BUFFER_BIT}Se&&(Be|=q.DEPTH_BUFFER_BIT),ze&&(Be|=q.STENCIL_BUFFER_BIT,this.state.buffers.stencil.setMask(4294967295)),q.clear(Be)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){t.removeEventListener("webglcontextlost",mt,!1),t.removeEventListener("webglcontextrestored",it,!1),t.removeEventListener("webglcontextcreationerror",_e,!1),Ne.dispose(),et.dispose(),lt.dispose(),Me.dispose(),gt.dispose(),k.dispose(),Ve.dispose(),ct.dispose(),Ie.dispose(),Ge.dispose(),je.dispose(),je.removeEventListener("sessionstart",Cn),je.removeEventListener("sessionend",Kn),ui.stop()};function mt($){$.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),M=!0}function it(){console.log("THREE.WebGLRenderer: Context Restored."),M=!1;const $=Je.autoReset,Se=At.enabled,ze=At.autoUpdate,Be=At.needsUpdate,We=At.type;Qe(),Je.autoReset=$,At.enabled=Se,At.autoUpdate=ze,At.needsUpdate=Be,At.type=We}function _e($){console.error("THREE.WebGLRenderer: A WebGL context could not be created. Reason: ",$.statusMessage)}function ht($){const Se=$.target;Se.removeEventListener("dispose",ht),yt(Se)}function yt($){Bt($),Me.remove($)}function Bt($){const Se=Me.get($).programs;Se!==void 0&&(Se.forEach(function(ze){Ge.releaseProgram(ze)}),$.isShaderMaterial&&Ge.releaseShaderCache($))}this.renderBufferDirect=function($,Se,ze,Be,We,dt){Se===null&&(Se=ke);const bt=We.isMesh&&We.matrixWorld.determinant()<0,vt=jo($,Se,ze,Be,We);ye.setMaterial(Be,bt);let Zt=ze.index,Tt=1;if(Be.wireframe===!0){if(Zt=Ce.getWireframeAttribute(ze),Zt===void 0)return;Tt=2}const Xt=ze.drawRange,Wt=ze.attributes.position;let en=Xt.start*Tt,bn=(Xt.start+Xt.count)*Tt;dt!==null&&(en=Math.max(en,dt.start*Tt),bn=Math.min(bn,(dt.start+dt.count)*Tt)),Zt!==null?(en=Math.max(en,0),bn=Math.min(bn,Zt.count)):Wt!=null&&(en=Math.max(en,0),bn=Math.min(bn,Wt.count));const Tn=bn-en;if(Tn<0||Tn===1/0)return;ct.setup(We,Be,vt,ze,Zt);let cn,fn=nt;if(Zt!==null&&(cn=z.get(Zt),fn=ue,fn.setIndex(cn)),We.isMesh)Be.wireframe===!0?(ye.setLineWidth(Be.wireframeLinewidth*ut()),fn.setMode(q.LINES)):fn.setMode(q.TRIANGLES);else if(We.isLine){let Nt=Be.linewidth;Nt===void 0&&(Nt=1),ye.setLineWidth(Nt*ut()),We.isLineSegments?fn.setMode(q.LINES):We.isLineLoop?fn.setMode(q.LINE_LOOP):fn.setMode(q.LINE_STRIP)}else We.isPoints?fn.setMode(q.POINTS):We.isSprite&&fn.setMode(q.TRIANGLES);if(We.isBatchedMesh)if(We._multiDrawInstances!==null)Dd("THREE.WebGLRenderer: renderMultiDrawInstances has been deprecated and will be removed in r184. Append to renderMultiDraw arguments and use indirection."),fn.renderMultiDrawInstances(We._multiDrawStarts,We._multiDrawCounts,We._multiDrawCount,We._multiDrawInstances);else if(Ke.get("WEBGL_multi_draw"))fn.renderMultiDraw(We._multiDrawStarts,We._multiDrawCounts,We._multiDrawCount);else{const Nt=We._multiDrawStarts,Pn=We._multiDrawCounts,un=We._multiDrawCount,Ni=Zt?z.get(Zt).bytesPerElement:1,ns=Me.get(Be).currentProgram.getUniforms();for(let Fn=0;Fn<un;Fn++)ns.setValue(q,"_gl_DrawID",Fn),fn.render(Nt[Fn]/Ni,Pn[Fn])}else if(We.isInstancedMesh)fn.renderInstances(en,Tn,We.count);else if(ze.isInstancedBufferGeometry){const Nt=ze._maxInstanceCount!==void 0?ze._maxInstanceCount:1/0,Pn=Math.min(ze.instanceCount,Nt);fn.renderInstances(en,Tn,Pn)}else fn.render(en,Tn)};function xt($,Se,ze){$.transparent===!0&&$.side===Oo&&$.forceSinglePass===!1?($.side=eo,$.needsUpdate=!0,Bn($,Se,ze),$.side=fg,$.needsUpdate=!0,Bn($,Se,ze),$.side=Oo):Bn($,Se,ze)}this.compile=function($,Se,ze=null){ze===null&&(ze=$),B=lt.get(ze),B.init(Se),x.push(B),ze.traverseVisible(function(We){We.isLight&&We.layers.test(Se.layers)&&(B.pushLight(We),We.castShadow&&B.pushShadow(We))}),$!==ze&&$.traverseVisible(function(We){We.isLight&&We.layers.test(Se.layers)&&(B.pushLight(We),We.castShadow&&B.pushShadow(We))}),B.setupLights();const Be=new Set;return $.traverse(function(We){if(!(We.isMesh||We.isPoints||We.isLine||We.isSprite))return;const dt=We.material;if(dt)if(Array.isArray(dt))for(let bt=0;bt<dt.length;bt++){const vt=dt[bt];xt(vt,ze,We),Be.add(vt)}else xt(dt,ze,We),Be.add(dt)}),B=x.pop(),Be},this.compileAsync=function($,Se,ze=null){const Be=this.compile($,Se,ze);return new Promise(We=>{function dt(){if(Be.forEach(function(bt){Me.get(bt).currentProgram.isReady()&&Be.delete(bt)}),Be.size===0){We($);return}setTimeout(dt,10)}Ke.get("KHR_parallel_shader_compile")!==null?dt():setTimeout(dt,10)})};let Gn=null;function gn($){Gn&&Gn($)}function Cn(){ui.stop()}function Kn(){ui.start()}const ui=new SM;ui.setAnimationLoop(gn),typeof self<"u"&&ui.setContext(self),this.setAnimationLoop=function($){Gn=$,je.setAnimationLoop($),$===null?ui.stop():ui.start()},je.addEventListener("sessionstart",Cn),je.addEventListener("sessionend",Kn),this.render=function($,Se){if(Se!==void 0&&Se.isCamera!==!0){console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");return}if(M===!0)return;if($.matrixWorldAutoUpdate===!0&&$.updateMatrixWorld(),Se.parent===null&&Se.matrixWorldAutoUpdate===!0&&Se.updateMatrixWorld(),je.enabled===!0&&je.isPresenting===!0&&(je.cameraAutoUpdate===!0&&je.updateCamera(Se),Se=je.getCamera()),$.isScene===!0&&$.onBeforeRender(w,$,Se,F),B=lt.get($,x.length),B.init(Se),x.push(B),be.multiplyMatrices(Se.projectionMatrix,Se.matrixWorldInverse),j.setFromProjectionMatrix(be),pe=this.localClippingEnabled,re=Ct.init(this.clippingPlanes,pe),G=et.get($,R.length),G.init(),R.push(G),je.enabled===!0&&je.isPresenting===!0){const dt=w.xr.getDepthSensingMesh();dt!==null&&hi(dt,Se,-1/0,w.sortObjects)}hi($,Se,0,w.sortObjects),G.finish(),w.sortObjects===!0&&G.sort(se,L),Te=je.enabled===!1||je.isPresenting===!1||je.hasDepthSensing()===!1,Te&&Ne.addToRenderList(G,$),this.info.render.frame++,re===!0&&Ct.beginShadows();const ze=B.state.shadowsArray;At.render(ze,$,Se),re===!0&&Ct.endShadows(),this.info.autoReset===!0&&this.info.reset();const Be=G.opaque,We=G.transmissive;if(B.setupLights(),Se.isArrayCamera){const dt=Se.cameras;if(We.length>0)for(let bt=0,vt=dt.length;bt<vt;bt++){const Zt=dt[bt];aa(Be,We,$,Zt)}Te&&Ne.render($);for(let bt=0,vt=dt.length;bt<vt;bt++){const Zt=dt[bt];$a(G,$,Zt,Zt.viewport)}}else We.length>0&&aa(Be,We,$,Se),Te&&Ne.render($),$a(G,$,Se);F!==null&&N===0&&(Ze.updateMultisampleRenderTarget(F),Ze.updateRenderTargetMipmap(F)),$.isScene===!0&&$.onAfterRender(w,$,Se),ct.resetDefaultState(),Y=-1,X=null,x.pop(),x.length>0?(B=x[x.length-1],re===!0&&Ct.setGlobalState(w.clippingPlanes,B.state.camera)):B=null,R.pop(),R.length>0?G=R[R.length-1]:G=null};function hi($,Se,ze,Be){if($.visible===!1)return;if($.layers.test(Se.layers)){if($.isGroup)ze=$.renderOrder;else if($.isLOD)$.autoUpdate===!0&&$.update(Se);else if($.isLight)B.pushLight($),$.castShadow&&B.pushShadow($);else if($.isSprite){if(!$.frustumCulled||j.intersectsSprite($)){Be&&qe.setFromMatrixPosition($.matrixWorld).applyMatrix4(be);const bt=Ve.update($),vt=$.material;vt.visible&&G.push($,bt,vt,ze,qe.z,null)}}else if(($.isMesh||$.isLine||$.isPoints)&&(!$.frustumCulled||j.intersectsObject($))){const bt=Ve.update($),vt=$.material;if(Be&&($.boundingSphere!==void 0?($.boundingSphere===null&&$.computeBoundingSphere(),qe.copy($.boundingSphere.center)):(bt.boundingSphere===null&&bt.computeBoundingSphere(),qe.copy(bt.boundingSphere.center)),qe.applyMatrix4($.matrixWorld).applyMatrix4(be)),Array.isArray(vt)){const Zt=bt.groups;for(let Tt=0,Xt=Zt.length;Tt<Xt;Tt++){const Wt=Zt[Tt],en=vt[Wt.materialIndex];en&&en.visible&&G.push($,bt,en,ze,qe.z,Wt)}}else vt.visible&&G.push($,bt,vt,ze,qe.z,null)}}const dt=$.children;for(let bt=0,vt=dt.length;bt<vt;bt++)hi(dt[bt],Se,ze,Be)}function $a($,Se,ze,Be){const We=$.opaque,dt=$.transmissive,bt=$.transparent;B.setupLightsView(ze),re===!0&&Ct.setGlobalState(w.clippingPlanes,ze),Be&&ye.viewport(U.copy(Be)),We.length>0&&Ii(We,Se,ze),dt.length>0&&Ii(dt,Se,ze),bt.length>0&&Ii(bt,Se,ze),ye.buffers.depth.setTest(!0),ye.buffers.depth.setMask(!0),ye.buffers.color.setMask(!0),ye.setPolygonOffset(!1)}function aa($,Se,ze,Be){if((ze.isScene===!0?ze.overrideMaterial:null)!==null)return;B.state.transmissionRenderTarget[Be.id]===void 0&&(B.state.transmissionRenderTarget[Be.id]=new br(1,1,{generateMipmaps:!0,type:Ke.has("EXT_color_buffer_half_float")||Ke.has("EXT_color_buffer_float")?dC:vl,minFilter:yl,samples:4,stencilBuffer:s,resolveDepthBuffer:!1,resolveStencilBuffer:!1,colorSpace:Mn.workingColorSpace}));const dt=B.state.transmissionRenderTarget[Be.id],bt=Be.viewport||U;dt.setSize(bt.z*w.transmissionResolutionScale,bt.w*w.transmissionResolutionScale);const vt=w.getRenderTarget();w.setRenderTarget(dt),w.getClearColor(ie),le=w.getClearAlpha(),le<1&&w.setClearColor(16777215,.5),w.clear(),Te&&Ne.render(ze);const Zt=w.toneMapping;w.toneMapping=Ag;const Tt=Be.viewport;if(Be.viewport!==void 0&&(Be.viewport=void 0),B.setupLightsView(Be),re===!0&&Ct.setGlobalState(w.clippingPlanes,Be),Ii($,ze,Be),Ze.updateMultisampleRenderTarget(dt),Ze.updateRenderTargetMipmap(dt),Ke.has("WEBGL_multisampled_render_to_texture")===!1){let Xt=!1;for(let Wt=0,en=Se.length;Wt<en;Wt++){const bn=Se[Wt],Tn=bn.object,cn=bn.geometry,fn=bn.material,Nt=bn.group;if(fn.side===Oo&&Tn.layers.test(Be.layers)){const Pn=fn.side;fn.side=eo,fn.needsUpdate=!0,Jn(Tn,ze,Be,cn,fn,Nt),fn.side=Pn,fn.needsUpdate=!0,Xt=!0}}Xt===!0&&(Ze.updateMultisampleRenderTarget(dt),Ze.updateRenderTargetMipmap(dt))}w.setRenderTarget(vt),w.setClearColor(ie,le),Tt!==void 0&&(Be.viewport=Tt),w.toneMapping=Zt}function Ii($,Se,ze){const Be=Se.isScene===!0?Se.overrideMaterial:null;for(let We=0,dt=$.length;We<dt;We++){const bt=$[We],vt=bt.object,Zt=bt.geometry,Tt=bt.group;let Xt=bt.material;Xt.allowOverride===!0&&Be!==null&&(Xt=Be),vt.layers.test(ze.layers)&&Jn(vt,Se,ze,Zt,Xt,Tt)}}function Jn($,Se,ze,Be,We,dt){$.onBeforeRender(w,Se,ze,Be,We,dt),$.modelViewMatrix.multiplyMatrices(ze.matrixWorldInverse,$.matrixWorld),$.normalMatrix.getNormalMatrix($.modelViewMatrix),We.onBeforeRender(w,Se,ze,Be,$,dt),We.transparent===!0&&We.side===Oo&&We.forceSinglePass===!1?(We.side=eo,We.needsUpdate=!0,w.renderBufferDirect(ze,Se,Be,We,$,dt),We.side=fg,We.needsUpdate=!0,w.renderBufferDirect(ze,Se,Be,We,$,dt),We.side=Oo):w.renderBufferDirect(ze,Se,Be,We,$,dt),$.onAfterRender(w,Se,ze,Be,We,dt)}function Bn($,Se,ze){Se.isScene!==!0&&(Se=ke);const Be=Me.get($),We=B.state.lights,dt=B.state.shadowsArray,bt=We.state.version,vt=Ge.getParameters($,We.state,dt,Se,ze),Zt=Ge.getProgramCacheKey(vt);let Tt=Be.programs;Be.environment=$.isMeshStandardMaterial?Se.environment:null,Be.fog=Se.fog,Be.envMap=($.isMeshStandardMaterial?k:gt).get($.envMap||Be.environment),Be.envMapRotation=Be.environment!==null&&$.envMap===null?Se.environmentRotation:$.envMapRotation,Tt===void 0&&($.addEventListener("dispose",ht),Tt=new Map,Be.programs=Tt);let Xt=Tt.get(Zt);if(Xt!==void 0){if(Be.currentProgram===Xt&&Be.lightsStateVersion===bt)return Ea($,vt),Xt}else vt.uniforms=Ge.getUniforms($),$.onBeforeCompile(vt,w),Xt=Ge.acquireProgram(vt,Zt),Tt.set(Zt,Xt),Be.uniforms=vt.uniforms;const Wt=Be.uniforms;return(!$.isShaderMaterial&&!$.isRawShaderMaterial||$.clipping===!0)&&(Wt.clippingPlanes=Ct.uniform),Ea($,vt),Be.needsLights=Ci($),Be.lightsStateVersion=bt,Be.needsLights&&(Wt.ambientLightColor.value=We.state.ambient,Wt.lightProbe.value=We.state.probe,Wt.directionalLights.value=We.state.directional,Wt.directionalLightShadows.value=We.state.directionalShadow,Wt.spotLights.value=We.state.spot,Wt.spotLightShadows.value=We.state.spotShadow,Wt.rectAreaLights.value=We.state.rectArea,Wt.ltc_1.value=We.state.rectAreaLTC1,Wt.ltc_2.value=We.state.rectAreaLTC2,Wt.pointLights.value=We.state.point,Wt.pointLightShadows.value=We.state.pointShadow,Wt.hemisphereLights.value=We.state.hemi,Wt.directionalShadowMap.value=We.state.directionalShadowMap,Wt.directionalShadowMatrix.value=We.state.directionalShadowMatrix,Wt.spotShadowMap.value=We.state.spotShadowMap,Wt.spotLightMatrix.value=We.state.spotLightMatrix,Wt.spotLightMap.value=We.state.spotLightMap,Wt.pointShadowMap.value=We.state.pointShadowMap,Wt.pointShadowMatrix.value=We.state.pointShadowMatrix),Be.currentProgram=Xt,Be.uniformsList=null,Xt}function es($){if($.uniformsList===null){const Se=$.currentProgram.getUniforms();$.uniformsList=_b.seqWithValue(Se.seq,$.uniforms)}return $.uniformsList}function Ea($,Se){const ze=Me.get($);ze.outputColorSpace=Se.outputColorSpace,ze.batching=Se.batching,ze.batchingColor=Se.batchingColor,ze.instancing=Se.instancing,ze.instancingColor=Se.instancingColor,ze.instancingMorph=Se.instancingMorph,ze.skinning=Se.skinning,ze.morphTargets=Se.morphTargets,ze.morphNormals=Se.morphNormals,ze.morphColors=Se.morphColors,ze.morphTargetsCount=Se.morphTargetsCount,ze.numClippingPlanes=Se.numClippingPlanes,ze.numIntersection=Se.numClipIntersection,ze.vertexAlphas=Se.vertexAlphas,ze.vertexTangents=Se.vertexTangents,ze.toneMapping=Se.toneMapping}function jo($,Se,ze,Be,We){Se.isScene!==!0&&(Se=ke),Ze.resetTextureUnits();const dt=Se.fog,bt=Be.isMeshStandardMaterial?Se.environment:null,vt=F===null?w.outputColorSpace:F.isXRRenderTarget===!0?F.texture.colorSpace:vu,Zt=(Be.isMeshStandardMaterial?k:gt).get(Be.envMap||bt),Tt=Be.vertexColors===!0&&!!ze.attributes.color&&ze.attributes.color.itemSize===4,Xt=!!ze.attributes.tangent&&(!!Be.normalMap||Be.anisotropy>0),Wt=!!ze.morphAttributes.position,en=!!ze.morphAttributes.normal,bn=!!ze.morphAttributes.color;let Tn=Ag;Be.toneMapped&&(F===null||F.isXRRenderTarget===!0)&&(Tn=w.toneMapping);const cn=ze.morphAttributes.position||ze.morphAttributes.normal||ze.morphAttributes.color,fn=cn!==void 0?cn.length:0,Nt=Me.get(Be),Pn=B.state.lights;if(re===!0&&(pe===!0||$!==X)){const Ki=$===X&&Be.id===Y;Ct.setState(Be,$,Ki)}let un=!1;Be.version===Nt.__version?(Nt.needsLights&&Nt.lightsStateVersion!==Pn.state.version||Nt.outputColorSpace!==vt||We.isBatchedMesh&&Nt.batching===!1||!We.isBatchedMesh&&Nt.batching===!0||We.isBatchedMesh&&Nt.batchingColor===!0&&We.colorTexture===null||We.isBatchedMesh&&Nt.batchingColor===!1&&We.colorTexture!==null||We.isInstancedMesh&&Nt.instancing===!1||!We.isInstancedMesh&&Nt.instancing===!0||We.isSkinnedMesh&&Nt.skinning===!1||!We.isSkinnedMesh&&Nt.skinning===!0||We.isInstancedMesh&&Nt.instancingColor===!0&&We.instanceColor===null||We.isInstancedMesh&&Nt.instancingColor===!1&&We.instanceColor!==null||We.isInstancedMesh&&Nt.instancingMorph===!0&&We.morphTexture===null||We.isInstancedMesh&&Nt.instancingMorph===!1&&We.morphTexture!==null||Nt.envMap!==Zt||Be.fog===!0&&Nt.fog!==dt||Nt.numClippingPlanes!==void 0&&(Nt.numClippingPlanes!==Ct.numPlanes||Nt.numIntersection!==Ct.numIntersection)||Nt.vertexAlphas!==Tt||Nt.vertexTangents!==Xt||Nt.morphTargets!==Wt||Nt.morphNormals!==en||Nt.morphColors!==bn||Nt.toneMapping!==Tn||Nt.morphTargetsCount!==fn)&&(un=!0):(un=!0,Nt.__version=Be.version);let Ni=Nt.currentProgram;un===!0&&(Ni=Bn(Be,Se,We));let ns=!1,Fn=!1,Yi=!1;const zn=Ni.getUniforms(),Si=Nt.uniforms;if(ye.useProgram(Ni.program)&&(ns=!0,Fn=!0,Yi=!0),Be.id!==Y&&(Y=Be.id,Fn=!0),ns||X!==$){ye.buffers.depth.getReversed()?(me.copy($.projectionMatrix),O3(me),J3(me),zn.setValue(q,"projectionMatrix",me)):zn.setValue(q,"projectionMatrix",$.projectionMatrix),zn.setValue(q,"viewMatrix",$.matrixWorldInverse);const bi=zn.map.cameraPosition;bi!==void 0&&bi.setValue(q,$e.setFromMatrixPosition($.matrixWorld)),Ee.logarithmicDepthBuffer&&zn.setValue(q,"logDepthBufFC",2/(Math.log($.far+1)/Math.LN2)),(Be.isMeshPhongMaterial||Be.isMeshToonMaterial||Be.isMeshLambertMaterial||Be.isMeshBasicMaterial||Be.isMeshStandardMaterial||Be.isShaderMaterial)&&zn.setValue(q,"isOrthographic",$.isOrthographicCamera===!0),X!==$&&(X=$,Fn=!0,Yi=!0)}if(We.isSkinnedMesh){zn.setOptional(q,We,"bindMatrix"),zn.setOptional(q,We,"bindMatrixInverse");const Ki=We.skeleton;Ki&&(Ki.boneTexture===null&&Ki.computeBoneTexture(),zn.setValue(q,"boneTexture",Ki.boneTexture,Ze))}We.isBatchedMesh&&(zn.setOptional(q,We,"batchingTexture"),zn.setValue(q,"batchingTexture",We._matricesTexture,Ze),zn.setOptional(q,We,"batchingIdTexture"),zn.setValue(q,"batchingIdTexture",We._indirectTexture,Ze),zn.setOptional(q,We,"batchingColorTexture"),We._colorsTexture!==null&&zn.setValue(q,"batchingColorTexture",We._colorsTexture,Ze));const ti=ze.morphAttributes;if((ti.position!==void 0||ti.normal!==void 0||ti.color!==void 0)&&tt.update(We,ze,Ni),(Fn||Nt.receiveShadow!==We.receiveShadow)&&(Nt.receiveShadow=We.receiveShadow,zn.setValue(q,"receiveShadow",We.receiveShadow)),Be.isMeshGouraudMaterial&&Be.envMap!==null&&(Si.envMap.value=Zt,Si.flipEnvMap.value=Zt.isCubeTexture&&Zt.isRenderTargetTexture===!1?-1:1),Be.isMeshStandardMaterial&&Be.envMap===null&&Se.environment!==null&&(Si.envMapIntensity.value=Se.environmentIntensity),Fn&&(zn.setValue(q,"toneMappingExposure",w.toneMappingExposure),Nt.needsLights&&no(Si,Yi),dt&&Be.fog===!0&&we.refreshFogUniforms(Si,dt),we.refreshMaterialUniforms(Si,Be,Q,J,B.state.transmissionRenderTarget[$.id]),_b.upload(q,es(Nt),Si,Ze)),Be.isShaderMaterial&&Be.uniformsNeedUpdate===!0&&(_b.upload(q,es(Nt),Si,Ze),Be.uniformsNeedUpdate=!1),Be.isSpriteMaterial&&zn.setValue(q,"center",We.center),zn.setValue(q,"modelViewMatrix",We.modelViewMatrix),zn.setValue(q,"normalMatrix",We.normalMatrix),zn.setValue(q,"modelMatrix",We.matrixWorld),Be.isShaderMaterial||Be.isRawShaderMaterial){const Ki=Be.uniformsGroups;for(let bi=0,Pi=Ki.length;bi<Pi;bi++){const is=Ki[bi];Ie.update(is,Ni),Ie.bind(is,Ni)}}return Ni}function no($,Se){$.ambientLightColor.needsUpdate=Se,$.lightProbe.needsUpdate=Se,$.directionalLights.needsUpdate=Se,$.directionalLightShadows.needsUpdate=Se,$.pointLights.needsUpdate=Se,$.pointLightShadows.needsUpdate=Se,$.spotLights.needsUpdate=Se,$.spotLightShadows.needsUpdate=Se,$.rectAreaLights.needsUpdate=Se,$.hemisphereLights.needsUpdate=Se}function Ci($){return $.isMeshLambertMaterial||$.isMeshToonMaterial||$.isMeshPhongMaterial||$.isMeshStandardMaterial||$.isShadowMaterial||$.isShaderMaterial&&$.lights===!0}this.getActiveCubeFace=function(){return H},this.getActiveMipmapLevel=function(){return N},this.getRenderTarget=function(){return F},this.setRenderTargetTextures=function($,Se,ze){const Be=Me.get($);Be.__autoAllocateDepthBuffer=$.resolveDepthBuffer===!1,Be.__autoAllocateDepthBuffer===!1&&(Be.__useRenderToTexture=!1),Me.get($.texture).__webglTexture=Se,Me.get($.depthTexture).__webglTexture=Be.__autoAllocateDepthBuffer?void 0:ze,Be.__hasExternalTextures=!0},this.setRenderTargetFramebuffer=function($,Se){const ze=Me.get($);ze.__webglFramebuffer=Se,ze.__useDefaultFramebuffer=Se===void 0};const qo=q.createFramebuffer();this.setRenderTarget=function($,Se=0,ze=0){F=$,H=Se,N=ze;let Be=!0,We=null,dt=!1,bt=!1;if($){const Zt=Me.get($);if(Zt.__useDefaultFramebuffer!==void 0)ye.bindFramebuffer(q.FRAMEBUFFER,null),Be=!1;else if(Zt.__webglFramebuffer===void 0)Ze.setupRenderTarget($);else if(Zt.__hasExternalTextures)Ze.rebindTextures($,Me.get($.texture).__webglTexture,Me.get($.depthTexture).__webglTexture);else if($.depthBuffer){const Wt=$.depthTexture;if(Zt.__boundDepthTexture!==Wt){if(Wt!==null&&Me.has(Wt)&&($.width!==Wt.image.width||$.height!==Wt.image.height))throw new Error("WebGLRenderTarget: Attached DepthTexture is initialized to the incorrect size.");Ze.setupDepthRenderbuffer($)}}const Tt=$.texture;(Tt.isData3DTexture||Tt.isDataArrayTexture||Tt.isCompressedArrayTexture)&&(bt=!0);const Xt=Me.get($).__webglFramebuffer;$.isWebGLCubeRenderTarget?(Array.isArray(Xt[Se])?We=Xt[Se][ze]:We=Xt[Se],dt=!0):$.samples>0&&Ze.useMultisampledRTT($)===!1?We=Me.get($).__webglMultisampledFramebuffer:Array.isArray(Xt)?We=Xt[ze]:We=Xt,U.copy($.viewport),O.copy($.scissor),P=$.scissorTest}else U.copy(D).multiplyScalar(Q).floor(),O.copy(ne).multiplyScalar(Q).floor(),P=oe;if(ze!==0&&(We=qo),ye.bindFramebuffer(q.FRAMEBUFFER,We)&&Be&&ye.drawBuffers($,We),ye.viewport(U),ye.scissor(O),ye.setScissorTest(P),dt){const Zt=Me.get($.texture);q.framebufferTexture2D(q.FRAMEBUFFER,q.COLOR_ATTACHMENT0,q.TEXTURE_CUBE_MAP_POSITIVE_X+Se,Zt.__webglTexture,ze)}else if(bt){const Zt=Me.get($.texture),Tt=Se;q.framebufferTextureLayer(q.FRAMEBUFFER,q.COLOR_ATTACHMENT0,Zt.__webglTexture,ze,Tt)}else if($!==null&&ze!==0){const Zt=Me.get($.texture);q.framebufferTexture2D(q.FRAMEBUFFER,q.COLOR_ATTACHMENT0,q.TEXTURE_2D,Zt.__webglTexture,ze)}Y=-1},this.readRenderTargetPixels=function($,Se,ze,Be,We,dt,bt,vt=0){if(!($&&$.isWebGLRenderTarget)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");return}let Zt=Me.get($).__webglFramebuffer;if($.isWebGLCubeRenderTarget&&bt!==void 0&&(Zt=Zt[bt]),Zt){ye.bindFramebuffer(q.FRAMEBUFFER,Zt);try{const Tt=$.textures[vt],Xt=Tt.format,Wt=Tt.type;if(!Ee.textureFormatReadable(Xt)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");return}if(!Ee.textureTypeReadable(Wt)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");return}Se>=0&&Se<=$.width-Be&&ze>=0&&ze<=$.height-We&&($.textures.length>1&&q.readBuffer(q.COLOR_ATTACHMENT0+vt),q.readPixels(Se,ze,Be,We,xe.convert(Xt),xe.convert(Wt),dt))}finally{const Tt=F!==null?Me.get(F).__webglFramebuffer:null;ye.bindFramebuffer(q.FRAMEBUFFER,Tt)}}},this.readRenderTargetPixelsAsync=async function($,Se,ze,Be,We,dt,bt,vt=0){if(!($&&$.isWebGLRenderTarget))throw new Error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");let Zt=Me.get($).__webglFramebuffer;if($.isWebGLCubeRenderTarget&&bt!==void 0&&(Zt=Zt[bt]),Zt)if(Se>=0&&Se<=$.width-Be&&ze>=0&&ze<=$.height-We){ye.bindFramebuffer(q.FRAMEBUFFER,Zt);const Tt=$.textures[vt],Xt=Tt.format,Wt=Tt.type;if(!Ee.textureFormatReadable(Xt))throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: renderTarget is not in RGBA or implementation defined format.");if(!Ee.textureTypeReadable(Wt))throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: renderTarget is not in UnsignedByteType or implementation defined type.");const en=q.createBuffer();q.bindBuffer(q.PIXEL_PACK_BUFFER,en),q.bufferData(q.PIXEL_PACK_BUFFER,dt.byteLength,q.STREAM_READ),$.textures.length>1&&q.readBuffer(q.COLOR_ATTACHMENT0+vt),q.readPixels(Se,ze,Be,We,xe.convert(Xt),xe.convert(Wt),0);const bn=F!==null?Me.get(F).__webglFramebuffer:null;ye.bindFramebuffer(q.FRAMEBUFFER,bn);const Tn=q.fenceSync(q.SYNC_GPU_COMMANDS_COMPLETE,0);return q.flush(),await k3(q,Tn,4),q.bindBuffer(q.PIXEL_PACK_BUFFER,en),q.getBufferSubData(q.PIXEL_PACK_BUFFER,0,dt),q.deleteBuffer(en),q.deleteSync(Tn),dt}else throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: requested read bounds are out of range.")},this.copyFramebufferToTexture=function($,Se=null,ze=0){const Be=Math.pow(2,-ze),We=Math.floor($.image.width*Be),dt=Math.floor($.image.height*Be),bt=Se!==null?Se.x:0,vt=Se!==null?Se.y:0;Ze.setTexture2D($,0),q.copyTexSubImage2D(q.TEXTURE_2D,ze,0,0,bt,vt,We,dt),ye.unbindTexture()};const Zr=q.createFramebuffer(),ts=q.createFramebuffer();this.copyTextureToTexture=function($,Se,ze=null,Be=null,We=0,dt=null){dt===null&&(We!==0?(Dd("WebGLRenderer: copyTextureToTexture function signature has changed to support src and dst mipmap levels."),dt=We,We=0):dt=0);let bt,vt,Zt,Tt,Xt,Wt,en,bn,Tn;const cn=$.isCompressedTexture?$.mipmaps[dt]:$.image;if(ze!==null)bt=ze.max.x-ze.min.x,vt=ze.max.y-ze.min.y,Zt=ze.isBox3?ze.max.z-ze.min.z:1,Tt=ze.min.x,Xt=ze.min.y,Wt=ze.isBox3?ze.min.z:0;else{const ti=Math.pow(2,-We);bt=Math.floor(cn.width*ti),vt=Math.floor(cn.height*ti),$.isDataArrayTexture?Zt=cn.depth:$.isData3DTexture?Zt=Math.floor(cn.depth*ti):Zt=1,Tt=0,Xt=0,Wt=0}Be!==null?(en=Be.x,bn=Be.y,Tn=Be.z):(en=0,bn=0,Tn=0);const fn=xe.convert(Se.format),Nt=xe.convert(Se.type);let Pn;Se.isData3DTexture?(Ze.setTexture3D(Se,0),Pn=q.TEXTURE_3D):Se.isDataArrayTexture||Se.isCompressedArrayTexture?(Ze.setTexture2DArray(Se,0),Pn=q.TEXTURE_2D_ARRAY):(Ze.setTexture2D(Se,0),Pn=q.TEXTURE_2D),q.pixelStorei(q.UNPACK_FLIP_Y_WEBGL,Se.flipY),q.pixelStorei(q.UNPACK_PREMULTIPLY_ALPHA_WEBGL,Se.premultiplyAlpha),q.pixelStorei(q.UNPACK_ALIGNMENT,Se.unpackAlignment);const un=q.getParameter(q.UNPACK_ROW_LENGTH),Ni=q.getParameter(q.UNPACK_IMAGE_HEIGHT),ns=q.getParameter(q.UNPACK_SKIP_PIXELS),Fn=q.getParameter(q.UNPACK_SKIP_ROWS),Yi=q.getParameter(q.UNPACK_SKIP_IMAGES);q.pixelStorei(q.UNPACK_ROW_LENGTH,cn.width),q.pixelStorei(q.UNPACK_IMAGE_HEIGHT,cn.height),q.pixelStorei(q.UNPACK_SKIP_PIXELS,Tt),q.pixelStorei(q.UNPACK_SKIP_ROWS,Xt),q.pixelStorei(q.UNPACK_SKIP_IMAGES,Wt);const zn=$.isDataArrayTexture||$.isData3DTexture,Si=Se.isDataArrayTexture||Se.isData3DTexture;if($.isDepthTexture){const ti=Me.get($),Ki=Me.get(Se),bi=Me.get(ti.__renderTarget),Pi=Me.get(Ki.__renderTarget);ye.bindFramebuffer(q.READ_FRAMEBUFFER,bi.__webglFramebuffer),ye.bindFramebuffer(q.DRAW_FRAMEBUFFER,Pi.__webglFramebuffer);for(let is=0;is<Zt;is++)zn&&(q.framebufferTextureLayer(q.READ_FRAMEBUFFER,q.COLOR_ATTACHMENT0,Me.get($).__webglTexture,We,Wt+is),q.framebufferTextureLayer(q.DRAW_FRAMEBUFFER,q.COLOR_ATTACHMENT0,Me.get(Se).__webglTexture,dt,Tn+is)),q.blitFramebuffer(Tt,Xt,bt,vt,en,bn,bt,vt,q.DEPTH_BUFFER_BIT,q.NEAREST);ye.bindFramebuffer(q.READ_FRAMEBUFFER,null),ye.bindFramebuffer(q.DRAW_FRAMEBUFFER,null)}else if(We!==0||$.isRenderTargetTexture||Me.has($)){const ti=Me.get($),Ki=Me.get(Se);ye.bindFramebuffer(q.READ_FRAMEBUFFER,Zr),ye.bindFramebuffer(q.DRAW_FRAMEBUFFER,ts);for(let bi=0;bi<Zt;bi++)zn?q.framebufferTextureLayer(q.READ_FRAMEBUFFER,q.COLOR_ATTACHMENT0,ti.__webglTexture,We,Wt+bi):q.framebufferTexture2D(q.READ_FRAMEBUFFER,q.COLOR_ATTACHMENT0,q.TEXTURE_2D,ti.__webglTexture,We),Si?q.framebufferTextureLayer(q.DRAW_FRAMEBUFFER,q.COLOR_ATTACHMENT0,Ki.__webglTexture,dt,Tn+bi):q.framebufferTexture2D(q.DRAW_FRAMEBUFFER,q.COLOR_ATTACHMENT0,q.TEXTURE_2D,Ki.__webglTexture,dt),We!==0?q.blitFramebuffer(Tt,Xt,bt,vt,en,bn,bt,vt,q.COLOR_BUFFER_BIT,q.NEAREST):Si?q.copyTexSubImage3D(Pn,dt,en,bn,Tn+bi,Tt,Xt,bt,vt):q.copyTexSubImage2D(Pn,dt,en,bn,Tt,Xt,bt,vt);ye.bindFramebuffer(q.READ_FRAMEBUFFER,null),ye.bindFramebuffer(q.DRAW_FRAMEBUFFER,null)}else Si?$.isDataTexture||$.isData3DTexture?q.texSubImage3D(Pn,dt,en,bn,Tn,bt,vt,Zt,fn,Nt,cn.data):Se.isCompressedArrayTexture?q.compressedTexSubImage3D(Pn,dt,en,bn,Tn,bt,vt,Zt,fn,cn.data):q.texSubImage3D(Pn,dt,en,bn,Tn,bt,vt,Zt,fn,Nt,cn):$.isDataTexture?q.texSubImage2D(q.TEXTURE_2D,dt,en,bn,bt,vt,fn,Nt,cn.data):$.isCompressedTexture?q.compressedTexSubImage2D(q.TEXTURE_2D,dt,en,bn,cn.width,cn.height,fn,cn.data):q.texSubImage2D(q.TEXTURE_2D,dt,en,bn,bt,vt,fn,Nt,cn);q.pixelStorei(q.UNPACK_ROW_LENGTH,un),q.pixelStorei(q.UNPACK_IMAGE_HEIGHT,Ni),q.pixelStorei(q.UNPACK_SKIP_PIXELS,ns),q.pixelStorei(q.UNPACK_SKIP_ROWS,Fn),q.pixelStorei(q.UNPACK_SKIP_IMAGES,Yi),dt===0&&Se.generateMipmaps&&q.generateMipmap(Pn),ye.unbindTexture()},this.copyTextureToTexture3D=function($,Se,ze=null,Be=null,We=0){return Dd('WebGLRenderer: copyTextureToTexture3D function has been deprecated. Use "copyTextureToTexture" instead.'),this.copyTextureToTexture($,Se,ze,Be,We)},this.initRenderTarget=function($){Me.get($).__webglFramebuffer===void 0&&Ze.setupRenderTarget($)},this.initTexture=function($){$.isCubeTexture?Ze.setTextureCube($,0):$.isData3DTexture?Ze.setTexture3D($,0):$.isDataArrayTexture||$.isCompressedArrayTexture?Ze.setTexture2DArray($,0):Ze.setTexture2D($,0),ye.unbindTexture()},this.resetState=function(){H=0,N=0,F=null,ye.reset(),ct.reset()},typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}get coordinateSystem(){return Gl}get outputColorSpace(){return this._outputColorSpace}set outputColorSpace(e){this._outputColorSpace=e;const t=this.getContext();t.drawingBufferColorSpace=Mn._getDrawingBufferColorSpace(e),t.unpackColorSpace=Mn._getUnpackColorSpace()}}const iL=Object.freeze(Object.defineProperty({__proto__:null,ACESFilmicToneMapping:T2,AddEquation:fu,AddOperation:rV,AdditiveAnimationBlendMode:J2,AdditiveBlending:Kv,AgXToneMapping:CV,AlphaFormat:U2,AlwaysCompare:wV,AlwaysDepth:e0,AlwaysStencilFunc:zv,AmbientLight:dM,AnimationAction:BM,AnimationClip:lA,AnimationLoader:b5,AnimationMixer:O5,AnimationObjectGroup:D5,AnimationUtils:h5,ArcCurve:LV,ArrayCamera:bM,ArrowHelper:dK,AttachedBindMode:Tv,Audio:yM,AudioAnalyser:N5,AudioContext:GZ,AudioListener:M5,AudioLoader:x5,AxesHelper:AK,BackSide:eo,BasicDepthPacking:bV,BasicShadowMap:LW,BatchedMesh:EV,Bone:yy,BooleanKeyframeTrack:fC,Box2:eK,Box3:Sa,Box3Helper:IK,BoxGeometry:hC,BoxHelper:uK,BufferAttribute:En,BufferGeometry:rn,BufferGeometryLoader:pM,ByteType:z2,Cache:lc,Camera:py,CameraHelper:cK,CanvasTexture:EY,CapsuleGeometry:Sy,CatmullRomCurve3:_V,CineonToneMapping:uV,CircleGeometry:Ry,ClampToEdgeWrapping:Jo,Clock:BZ,Color:Gt,ColorKeyframeTrack:AZ,ColorManagement:Mn,CompressedArrayTexture:KY,CompressedCubeTexture:FY,CompressedTexture:vy,CompressedTextureLoader:y5,ConeGeometry:Pf,ConstantAlphaFactor:sV,ConstantColorFactor:iV,Controls:fK,CubeCamera:XV,CubeReflectionMapping:hc,CubeRefractionMapping:Gu,CubeTexture:Df,CubeTextureLoader:G5,CubeUVReflectionMapping:IA,CubicBezierCurve:rZ,CubicBezierCurve3:UV,CubicInterpolant:rM,CullFaceBack:Yv,CullFaceFront:zW,CullFaceFrontBack:Q9,CullFaceNone:TW,Curve:Br,CurvePath:kV,CustomBlending:_W,CustomToneMapping:IV,CylinderGeometry:Jf,Cylindrical:$5,Data3DTexture:hy,DataArrayTexture:Ay,DataTexture:hg,DataTextureLoader:B5,DataUtils:gY,DecrementStencilOp:l3,DecrementWrapStencilOp:g3,DefaultLoadingManager:uM,DepthFormat:$d,DepthStencilFormat:eA,DepthTexture:Zy,DetachedBindMode:AV,DirectionalLight:bZ,DirectionalLightHelper:gK,DiscreteInterpolant:gM,DodecahedronGeometry:wy,DoubleSide:Oo,DstAlphaFactor:qW,DstColorFactor:eV,DynamicCopyUsage:B3,DynamicDrawUsage:H0,DynamicReadUsage:b3,EdgesGeometry:zV,EllipseCurve:xy,EqualCompare:vV,EqualDepth:n0,EqualStencilFunc:C3,EquirectangularReflectionMapping:Sf,EquirectangularRefractionMapping:Rf,Euler:to,EventDispatcher:bg,ExtrudeGeometry:Wy,FileLoader:Qo,Float16BufferAttribute:hY,Float32BufferAttribute:Ht,FloatType:qs,Fog:by,FogExp2:my,FramebufferTexture:YY,FrontSide:fg,Frustum:CA,FrustumArray:Gy,GLBufferAttribute:q5,GLSL1:Z3,GLSL3:Lv,GreaterCompare:ZV,GreaterDepth:a0,GreaterEqualCompare:RV,GreaterEqualDepth:i0,GreaterEqualStencilFunc:f3,GreaterStencilFunc:A3,GridHelper:lK,Group:dg,HalfFloatType:dC,HemisphereLight:CM,HemisphereLightHelper:oK,IcosahedronGeometry:Vy,ImageBitmapLoader:mM,ImageLoader:Yf,ImageUtils:VV,IncrementStencilOp:o3,IncrementWrapStencilOp:r3,InstancedBufferAttribute:Su,InstancedBufferGeometry:yZ,InstancedInterleavedBuffer:j5,InstancedMesh:eC,Int16BufferAttribute:dY,Int32BufferAttribute:AY,Int8BufferAttribute:uY,IntType:ry,InterleavedBuffer:kf,InterleavedBufferAttribute:Zu,Interpolant:dA,InterpolateDiscrete:tA,InterpolateLinear:nA,InterpolateSmooth:zb,InterpolationSamplingMode:w3,InterpolationSamplingType:R3,InvertStencilOp:c3,KeepStencilOp:FI,KeyframeTrack:Rl,LOD:FV,LatheGeometry:My,Layers:aA,LessCompare:BV,LessDepth:t0,LessEqualCompare:j2,LessEqualDepth:sC,LessEqualStencilFunc:d3,LessStencilFunc:I3,Light:Vu,LightProbe:fM,Line:pc,Line3:tK,LineBasicMaterial:vs,LineCurve:gZ,LineCurve3:DV,LineDashedMaterial:sM,LineLoop:sZ,LineSegments:Gr,LinearFilter:Bi,LinearInterpolant:dZ,LinearMipMapLinearFilter:e3,LinearMipMapNearestFilter:$9,LinearMipmapLinearFilter:yl,LinearMipmapNearestFilter:Ud,LinearSRGBColorSpace:vu,LinearToneMapping:gV,LinearTransfer:xf,Loader:Zs,LoaderUtils:bu,LoadingManager:hZ,LoopOnce:hV,LoopPingPong:pV,LoopRepeat:fV,MOUSE:YI,Material:fa,MaterialLoader:zy,MathUtils:OI,Matrix2:SZ,Matrix3:on,Matrix4:Yt,MaxEquation:OW,Mesh:vi,MeshBasicMaterial:wo,MeshDepthMaterial:Ey,MeshDistanceMaterial:Ty,MeshLambertMaterial:iM,MeshMatcapMaterial:aM,MeshNormalMaterial:nM,MeshPhongMaterial:eM,MeshPhysicalMaterial:Sl,MeshStandardMaterial:qf,MeshToonMaterial:tM,MinEquation:kW,MirroredRepeatWrapping:Qd,MixOperation:lV,MultiplyBlending:Ev,MultiplyOperation:_f,NearestFilter:Fa,NearestMipMapLinearFilter:q9,NearestMipMapNearestFilter:j9,NearestMipmapLinearFilter:UI,NearestMipmapNearestFilter:ly,NeutralToneMapping:dV,NeverCompare:GV,NeverDepth:$b,NeverStencilFunc:u3,NoBlending:cc,NoColorSpace:ac,NoToneMapping:Ag,NormalAnimationBlendMode:dy,NormalBlending:qI,NotEqualCompare:SV,NotEqualDepth:s0,NotEqualStencilFunc:h3,NumberKeyframeTrack:lC,Object3D:wn,ObjectLoader:R5,ObjectSpaceNormalMap:yV,OctahedronGeometry:Qf,OneFactor:PW,OneMinusConstantAlphaFactor:oV,OneMinusConstantColorFactor:aV,OneMinusDstAlphaFactor:$W,OneMinusDstColorFactor:tV,OneMinusSrcAlphaFactor:qb,OneMinusSrcColorFactor:jW,OrthographicCamera:pr,PCFShadowMap:sy,PCFSoftShadowMap:cf,PMREMGenerator:Qv,Path:K0,PerspectiveCamera:Xi,Plane:nc,PlaneGeometry:bc,PlaneHelper:CK,PointLight:mZ,PointLightHelper:aK,Points:oZ,PointsMaterial:By,PolarGridHelper:rK,PolyhedronGeometry:Wu,PositionalAudio:X5,PropertyBinding:Yn,PropertyMixer:GM,QuadraticBezierCurve:cZ,QuadraticBezierCurve3:uZ,Quaternion:ca,QuaternionKeyframeTrack:rC,QuaternionLinearInterpolant:cM,RED_GREEN_RGTC2_Format:W0,RED_RGTC1_Format:O2,REVISION:Lf,RGBADepthPacking:Q2,RGBAFormat:Gs,RGBAIntegerFormat:Cy,RGBA_ASTC_10x10_Format:v0,RGBA_ASTC_10x5_Format:y0,RGBA_ASTC_10x6_Format:G0,RGBA_ASTC_10x8_Format:B0,RGBA_ASTC_12x10_Format:Z0,RGBA_ASTC_12x12_Format:S0,RGBA_ASTC_4x4_Format:C0,RGBA_ASTC_5x4_Format:d0,RGBA_ASTC_5x5_Format:A0,RGBA_ASTC_6x5_Format:h0,RGBA_ASTC_6x6_Format:f0,RGBA_ASTC_8x5_Format:p0,RGBA_ASTC_8x6_Format:m0,RGBA_ASTC_8x8_Format:b0,RGBA_BPTC_Format:Af,RGBA_ETC2_EAC_Format:I0,RGBA_PVRTC_2BPPV1_Format:g0,RGBA_PVRTC_4BPPV1_Format:r0,RGBA_S3TC_DXT1_Format:If,RGBA_S3TC_DXT3_Format:Cf,RGBA_S3TC_DXT5_Format:df,RGBDepthPacking:n3,RGBFormat:D2,RGBIntegerFormat:t3,RGB_BPTC_SIGNED_Format:R0,RGB_BPTC_UNSIGNED_Format:w0,RGB_ETC1_Format:c0,RGB_ETC2_Format:u0,RGB_PVRTC_2BPPV1_Format:l0,RGB_PVRTC_4BPPV1_Format:o0,RGB_S3TC_DXT1_Format:uf,RGDepthPacking:i3,RGFormat:k2,RGIntegerFormat:Iy,RawShaderMaterial:$V,Ray:AC,Raycaster:vM,RectAreaLight:AM,RedFormat:uy,RedIntegerFormat:Uf,ReinhardToneMapping:cV,RenderTarget:$2,RenderTarget3D:J5,RepeatWrapping:Bu,ReplaceStencilOp:s3,ReverseSubtractEquation:DW,RingGeometry:Hy,SIGNED_RED_GREEN_RGTC2_Format:V0,SIGNED_RED_RGTC1_Format:x0,SRGBColorSpace:ys,SRGBTransfer:ei,Scene:nZ,ShaderChunk:An,ShaderLib:hr,ShaderMaterial:Zl,ShadowMaterial:qV,Shape:tC,ShapeGeometry:Xy,ShapePath:hK,ShapeUtils:fr,ShortType:L2,Skeleton:Of,SkeletonHelper:iK,SkinnedMesh:aZ,Source:mu,Sphere:Ra,SphereGeometry:jf,Spherical:Jv,SphericalHarmonics3:hM,SplineCurve:IZ,SpotLight:pZ,SpotLightHelper:nK,Sprite:KV,SpriteMaterial:iZ,SrcAlphaFactor:jb,SrcAlphaSaturateFactor:nV,SrcColorFactor:QW,StaticCopyUsage:G3,StaticDrawUsage:Wf,StaticReadUsage:m3,StereoCamera:W5,StreamCopyUsage:v3,StreamDrawUsage:p3,StreamReadUsage:y3,StringKeyframeTrack:pC,SubtractEquation:UW,SubtractiveBlending:Fv,TOUCH:KI,TangentSpaceNormalMap:xu,TetrahedronGeometry:Ny,Texture:Zi,TextureLoader:IM,TextureUtils:GK,TimestampQuery:S3,TorusGeometry:Yy,TorusKnotGeometry:Ky,Triangle:Ro,TriangleFanDrawMode:M0,TriangleStripDrawMode:P2,TrianglesDrawMode:mV,TubeGeometry:Fy,UVMapping:oy,Uint16BufferAttribute:eZ,Uint32BufferAttribute:tZ,Uint8BufferAttribute:IY,Uint8ClampedBufferAttribute:CY,Uniform:Ly,UniformsGroup:Q5,UniformsLib:Rt,UniformsUtils:fy,UnsignedByteType:vl,UnsignedInt248Type:qd,UnsignedInt5999Type:_2,UnsignedIntType:fc,UnsignedShort4444Type:gy,UnsignedShort5551Type:cy,UnsignedShortType:jd,VSMShadowMap:Ar,Vector2:at,Vector3:ae,Vector4:Hn,VectorKeyframeTrack:gC,VideoFrameTexture:NY,VideoTexture:TV,WebGL3DRenderTarget:$3,WebGLArrayRenderTarget:q3,WebGLCoordinateSystem:Gl,WebGLCubeRenderTarget:NV,WebGLRenderTarget:br,WebGLRenderer:MM,WebGLUtils:VM,WebGPUCoordinateSystem:Vf,WebXRController:Lb,WireframeGeometry:jV,WrapAroundEnding:wf,ZeroCurvatureEnding:DI,ZeroFactor:JW,ZeroSlopeEnding:kI,ZeroStencilOp:a3,createCanvasElement:WV},Symbol.toStringTag,{value:"Module"}));var MB={exports:{}},$g={};/**
 * @license React
 * react-reconciler-constants.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Vw;function aL(){return Vw||(Vw=1,$g.ConcurrentRoot=1,$g.ContinuousEventPriority=8,$g.DefaultEventPriority=32,$g.DiscreteEventPriority=2,$g.IdleEventPriority=268435456,$g.LegacyRoot=0,$g.NoEventPriority=0),$g}var Mw;function sL(){return Mw||(Mw=1,MB.exports=aL()),MB.exports}var Ub=sL(),HB={exports:{}},XB={},NB={exports:{}},YB={};/**
 * @license React
 * use-sync-external-store-shim.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Hw;function oL(){if(Hw)return YB;Hw=1;var a=uA();function e(h,f){return h===f&&(h!==0||1/h===1/f)||h!==h&&f!==f}var t=typeof Object.is=="function"?Object.is:e,n=a.useState,i=a.useEffect,s=a.useLayoutEffect,o=a.useDebugValue;function r(h,f){var p=f(),y=n({inst:{value:p,getSnapshot:f}}),v=y[0].inst,G=y[1];return s(function(){v.value=p,v.getSnapshot=f,g(v)&&G({inst:v})},[h,p,f]),i(function(){return g(v)&&G({inst:v}),h(function(){g(v)&&G({inst:v})})},[h]),o(p),p}function g(h){var f=h.getSnapshot;h=h.value;try{var p=f();return!t(h,p)}catch{return!0}}function u(h,f){return f()}var C=typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"?u:r;return YB.useSyncExternalStore=a.useSyncExternalStore!==void 0?a.useSyncExternalStore:C,YB}var Xw;function lL(){return Xw||(Xw=1,NB.exports=oL()),NB.exports}/**
 * @license React
 * use-sync-external-store-shim/with-selector.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Nw;function rL(){if(Nw)return XB;Nw=1;var a=uA(),e=lL();function t(u,C){return u===C&&(u!==0||1/u===1/C)||u!==u&&C!==C}var n=typeof Object.is=="function"?Object.is:t,i=e.useSyncExternalStore,s=a.useRef,o=a.useEffect,r=a.useMemo,g=a.useDebugValue;return XB.useSyncExternalStoreWithSelector=function(u,C,h,f,p){var y=s(null);if(y.current===null){var v={hasValue:!1,value:null};y.current=v}else v=y.current;y=r(function(){function B(H){if(!R){if(R=!0,x=H,H=f(H),p!==void 0&&v.hasValue){var N=v.value;if(p(N,H))return w=N}return w=H}if(N=w,n(x,H))return N;var F=f(H);return p!==void 0&&p(N,F)?(x=H,N):(x=H,w=F)}var R=!1,x,w,M=h===void 0?null:h;return[function(){return B(C())},M===null?void 0:function(){return B(M())}]},[C,h,f,p]);var G=i(u,y[0],y[1]);return o(function(){v.hasValue=!0,v.value=G},[G]),g(G),G},XB}var Yw;function gL(){return Yw||(Yw=1,HB.exports=rL()),HB.exports}var cL=gL();const uL=CC(cL),Kw=a=>{let e;const t=new Set,n=(u,C)=>{const h=typeof u=="function"?u(e):u;if(!Object.is(h,e)){const f=e;e=C??(typeof h!="object"||h===null)?h:Object.assign({},e,h),t.forEach(p=>p(e,f))}},i=()=>e,r={setState:n,getState:i,getInitialState:()=>g,subscribe:u=>(t.add(u),()=>t.delete(u))},g=e=a(n,i,r);return r},IL=a=>a?Kw(a):Kw,{useSyncExternalStoreWithSelector:CL}=uL,dL=a=>a;function AL(a,e=dL,t){const n=CL(a.subscribe,a.getState,a.getInitialState,e,t);return fe.useDebugValue(n),n}const Fw=(a,e)=>{const t=IL(a),n=(i,s=e)=>AL(t,i,s);return Object.assign(n,t),n},hL=(a,e)=>a?Fw(a,e):Fw;var KB={exports:{}},FB={exports:{}},EB={exports:{}},TB={};/**
 * @license React
 * scheduler.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Ew;function fL(){return Ew||(Ew=1,function(a){function e(T,J){var Q=T.length;T.push(J);e:for(;0<Q;){var se=Q-1>>>1,L=T[se];if(0<i(L,J))T[se]=J,T[Q]=L,Q=se;else break e}}function t(T){return T.length===0?null:T[0]}function n(T){if(T.length===0)return null;var J=T[0],Q=T.pop();if(Q!==J){T[0]=Q;e:for(var se=0,L=T.length,D=L>>>1;se<D;){var ne=2*(se+1)-1,oe=T[ne],j=ne+1,re=T[j];if(0>i(oe,Q))j<L&&0>i(re,oe)?(T[se]=re,T[j]=Q,se=j):(T[se]=oe,T[ne]=Q,se=ne);else if(j<L&&0>i(re,Q))T[se]=re,T[j]=Q,se=j;else break e}}return J}function i(T,J){var Q=T.sortIndex-J.sortIndex;return Q!==0?Q:T.id-J.id}if(a.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var s=performance;a.unstable_now=function(){return s.now()}}else{var o=Date,r=o.now();a.unstable_now=function(){return o.now()-r}}var g=[],u=[],C=1,h=null,f=3,p=!1,y=!1,v=!1,G=typeof setTimeout=="function"?setTimeout:null,B=typeof clearTimeout=="function"?clearTimeout:null,R=typeof setImmediate<"u"?setImmediate:null;function x(T){for(var J=t(u);J!==null;){if(J.callback===null)n(u);else if(J.startTime<=T)n(u),J.sortIndex=J.expirationTime,e(g,J);else break;J=t(u)}}function w(T){if(v=!1,x(T),!y)if(t(g)!==null)y=!0,ie();else{var J=t(u);J!==null&&le(w,J.startTime-T)}}var M=!1,H=-1,N=5,F=-1;function Y(){return!(a.unstable_now()-F<N)}function X(){if(M){var T=a.unstable_now();F=T;var J=!0;try{e:{y=!1,v&&(v=!1,B(H),H=-1),p=!0;var Q=f;try{t:{for(x(T),h=t(g);h!==null&&!(h.expirationTime>T&&Y());){var se=h.callback;if(typeof se=="function"){h.callback=null,f=h.priorityLevel;var L=se(h.expirationTime<=T);if(T=a.unstable_now(),typeof L=="function"){h.callback=L,x(T),J=!0;break t}h===t(g)&&n(g),x(T)}else n(g);h=t(g)}if(h!==null)J=!0;else{var D=t(u);D!==null&&le(w,D.startTime-T),J=!1}}break e}finally{h=null,f=Q,p=!1}J=void 0}}finally{J?U():M=!1}}}var U;if(typeof R=="function")U=function(){R(X)};else if(typeof MessageChannel<"u"){var O=new MessageChannel,P=O.port2;O.port1.onmessage=X,U=function(){P.postMessage(null)}}else U=function(){G(X,0)};function ie(){M||(M=!0,U())}function le(T,J){H=G(function(){T(a.unstable_now())},J)}a.unstable_IdlePriority=5,a.unstable_ImmediatePriority=1,a.unstable_LowPriority=4,a.unstable_NormalPriority=3,a.unstable_Profiling=null,a.unstable_UserBlockingPriority=2,a.unstable_cancelCallback=function(T){T.callback=null},a.unstable_continueExecution=function(){y||p||(y=!0,ie())},a.unstable_forceFrameRate=function(T){0>T||125<T?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):N=0<T?Math.floor(1e3/T):5},a.unstable_getCurrentPriorityLevel=function(){return f},a.unstable_getFirstCallbackNode=function(){return t(g)},a.unstable_next=function(T){switch(f){case 1:case 2:case 3:var J=3;break;default:J=f}var Q=f;f=J;try{return T()}finally{f=Q}},a.unstable_pauseExecution=function(){},a.unstable_requestPaint=function(){},a.unstable_runWithPriority=function(T,J){switch(T){case 1:case 2:case 3:case 4:case 5:break;default:T=3}var Q=f;f=T;try{return J()}finally{f=Q}},a.unstable_scheduleCallback=function(T,J,Q){var se=a.unstable_now();switch(typeof Q=="object"&&Q!==null?(Q=Q.delay,Q=typeof Q=="number"&&0<Q?se+Q:se):Q=se,T){case 1:var L=-1;break;case 2:L=250;break;case 5:L=1073741823;break;case 4:L=1e4;break;default:L=5e3}return L=Q+L,T={id:C++,callback:J,priorityLevel:T,startTime:Q,expirationTime:L,sortIndex:-1},Q>se?(T.sortIndex=Q,e(u,T),t(g)===null&&T===t(u)&&(v?(B(H),H=-1):v=!0,le(w,Q-se))):(T.sortIndex=L,e(g,T),y||p||(y=!0,ie())),T},a.unstable_shouldYield=Y,a.unstable_wrapCallback=function(T){var J=f;return function(){var Q=f;f=J;try{return T.apply(this,arguments)}finally{f=Q}}}}(TB)),TB}var Tw;function pL(){return Tw||(Tw=1,EB.exports=fL()),EB.exports}/**
 * @license React
 * react-reconciler.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var zw;function mL(){return zw||(zw=1,function(a){a.exports=function(e){function t(I,d,b,S){return new OA(I,d,b,S)}function n(){}function i(I){var d="https://react.dev/errors/"+I;if(1<arguments.length){d+="?args[]="+encodeURIComponent(arguments[1]);for(var b=2;b<arguments.length;b++)d+="&args[]="+encodeURIComponent(arguments[b])}return"Minified React error #"+I+"; visit "+d+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function s(I){return I===null||typeof I!="object"?null:(I=jl&&I[jl]||I["@@iterator"],typeof I=="function"?I:null)}function o(I){if(I==null)return null;if(typeof I=="function")return I.$$typeof===jA?null:I.displayName||I.name||null;if(typeof I=="string")return I;switch(I){case Lr:return"Fragment";case go:return"Portal";case FC:return"Profiler";case nI:return"StrictMode";case EC:return"Suspense";case Yc:return"SuspenseList"}if(typeof I=="object")switch(I.$$typeof){case No:return(I.displayName||"Context")+".Provider";case PA:return(I._context.displayName||"Context")+".Consumer";case aI:var d=I.render;return I=I.displayName,I||(I=d.displayName||d.name||"",I=I!==""?"ForwardRef("+I+")":"ForwardRef"),I;case TC:return d=I.displayName||null,d!==null?d:o(I.type)||"Memo";case co:d=I._payload,I=I._init;try{return o(I(d))}catch{}}return null}function r(I){if(al===void 0)try{throw Error()}catch(b){var d=b.stack.trim().match(/\n( *(at )?)/);al=d&&d[1]||"",ql=-1<b.stack.indexOf(`
    at`)?" (<anonymous>)":-1<b.stack.indexOf("@")?"@unknown:0:0":""}return`
`+al+I+ql}function g(I,d){if(!I||wg)return"";wg=!0;var b=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var S={DetermineComponentFrameRoot:function(){try{if(d){var St=function(){throw Error()};if(Object.defineProperty(St.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(St,[])}catch(nn){var wt=nn}Reflect.construct(I,[],St)}else{try{St.call()}catch(nn){wt=nn}I.call(St.prototype)}}else{try{throw Error()}catch(nn){wt=nn}(St=I())&&typeof St.catch=="function"&&St.catch(function(){})}}catch(nn){if(nn&&wt&&typeof nn.stack=="string")return[nn.stack,wt.stack]}return[null,null]}};S.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var V=Object.getOwnPropertyDescriptor(S.DetermineComponentFrameRoot,"name");V&&V.configurable&&Object.defineProperty(S.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var K=S.DetermineComponentFrameRoot(),te=K[0],he=K[1];if(te&&he){var Xe=te.split(`
`),st=he.split(`
`);for(V=S=0;S<Xe.length&&!Xe[S].includes("DetermineComponentFrameRoot");)S++;for(;V<st.length&&!st[V].includes("DetermineComponentFrameRoot");)V++;if(S===Xe.length||V===st.length)for(S=Xe.length-1,V=st.length-1;1<=S&&0<=V&&Xe[S]!==st[V];)V--;for(;1<=S&&0<=V;S--,V--)if(Xe[S]!==st[V]){if(S!==1||V!==1)do if(S--,V--,0>V||Xe[S]!==st[V]){var pt=`
`+Xe[S].replace(" at new "," at ");return I.displayName&&pt.includes("<anonymous>")&&(pt=pt.replace("<anonymous>",I.displayName)),pt}while(1<=S&&0<=V);break}}}finally{wg=!1,Error.prepareStackTrace=b}return(b=I?I.displayName||I.name:"")?r(b):""}function u(I){switch(I.tag){case 26:case 27:case 5:return r(I.type);case 16:return r("Lazy");case 13:return r("Suspense");case 19:return r("SuspenseList");case 0:case 15:return I=g(I.type,!1),I;case 11:return I=g(I.type.render,!1),I;case 1:return I=g(I.type,!0),I;default:return""}}function C(I){try{var d="";do d+=u(I),I=I.return;while(I);return d}catch(b){return`
Error generating stack: `+b.message+`
`+b.stack}}function h(I){var d=I,b=I;if(I.alternate)for(;d.return;)d=d.return;else{I=d;do d=I,(d.flags&4098)!==0&&(b=d.return),I=d.return;while(I)}return d.tag===3?b:null}function f(I){if(h(I)!==I)throw Error(i(188))}function p(I){var d=I.alternate;if(!d){if(d=h(I),d===null)throw Error(i(188));return d!==I?null:I}for(var b=I,S=d;;){var V=b.return;if(V===null)break;var K=V.alternate;if(K===null){if(S=V.return,S!==null){b=S;continue}break}if(V.child===K.child){for(K=V.child;K;){if(K===b)return f(V),I;if(K===S)return f(V),d;K=K.sibling}throw Error(i(188))}if(b.return!==S.return)b=V,S=K;else{for(var te=!1,he=V.child;he;){if(he===b){te=!0,b=V,S=K;break}if(he===S){te=!0,S=V,b=K;break}he=he.sibling}if(!te){for(he=K.child;he;){if(he===b){te=!0,b=K,S=V;break}if(he===S){te=!0,S=K,b=V;break}he=he.sibling}if(!te)throw Error(i(189))}}if(b.alternate!==S)throw Error(i(190))}if(b.tag!==3)throw Error(i(188));return b.stateNode.current===b?I:d}function y(I){var d=I.tag;if(d===5||d===26||d===27||d===6)return I;for(I=I.child;I!==null;){if(d=y(I),d!==null)return d;I=I.sibling}return null}function v(I){var d=I.tag;if(d===5||d===26||d===27||d===6)return I;for(I=I.child;I!==null;){if(I.tag!==4&&(d=v(I),d!==null))return d;I=I.sibling}return null}function G(I){return{current:I}}function B(I){0>nr||(I.current=Li[nr],Li[nr]=null,nr--)}function R(I,d){nr++,Li[nr]=I.current,I.current=d}function x(I){return I>>>=0,I===0?32:31-(om(I)/lm|0)|0}function w(I){var d=I&42;if(d!==0)return d;switch(I&-I){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return I&4194176;case 4194304:case 8388608:case 16777216:case 33554432:return I&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return I}}function M(I,d){var b=I.pendingLanes;if(b===0)return 0;var S=0,V=I.suspendedLanes,K=I.pingedLanes,te=I.warmLanes;I=I.finishedLanes!==0;var he=b&134217727;return he!==0?(b=he&~V,b!==0?S=w(b):(K&=he,K!==0?S=w(K):I||(te=he&~te,te!==0&&(S=w(te))))):(he=b&~V,he!==0?S=w(he):K!==0?S=w(K):I||(te=b&~te,te!==0&&(S=w(te)))),S===0?0:d!==0&&d!==S&&(d&V)===0&&(V=S&-S,te=d&-d,V>=te||V===32&&(te&4194176)!==0)?d:S}function H(I,d){return(I.pendingLanes&~(I.suspendedLanes&~I.pingedLanes)&d)===0}function N(I,d){switch(I){case 1:case 2:case 4:case 8:return d+250;case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return d+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function F(){var I=ol;return ol<<=1,(ol&4194176)===0&&(ol=128),I}function Y(){var I=Vg;return Vg<<=1,(Vg&62914560)===0&&(Vg=4194304),I}function X(I){for(var d=[],b=0;31>b;b++)d.push(I);return d}function U(I,d){I.pendingLanes|=d,d!==268435456&&(I.suspendedLanes=0,I.pingedLanes=0,I.warmLanes=0)}function O(I,d,b,S,V,K){var te=I.pendingLanes;I.pendingLanes=b,I.suspendedLanes=0,I.pingedLanes=0,I.warmLanes=0,I.expiredLanes&=b,I.entangledLanes&=b,I.errorRecoveryDisabledLanes&=b,I.shellSuspendCounter=0;var he=I.entanglements,Xe=I.expirationTimes,st=I.hiddenUpdates;for(b=te&~b;0<b;){var pt=31-ka(b),St=1<<pt;he[pt]=0,Xe[pt]=-1;var wt=st[pt];if(wt!==null)for(st[pt]=null,pt=0;pt<wt.length;pt++){var nn=wt[pt];nn!==null&&(nn.lane&=-536870913)}b&=~St}S!==0&&P(I,S,0),K!==0&&V===0&&I.tag!==0&&(I.suspendedLanes|=K&~(te&~d))}function P(I,d,b){I.pendingLanes|=d,I.suspendedLanes&=~d;var S=31-ka(d);I.entangledLanes|=d,I.entanglements[S]=I.entanglements[S]|1073741824|b&4194218}function ie(I,d){var b=I.entangledLanes|=d;for(I=I.entanglements;b;){var S=31-ka(b),V=1<<S;V&d|I[S]&d&&(I[S]|=d),b&=~V}}function le(I){return I&=-I,2<I?8<I?(I&134217727)!==0?32:268435456:8:2}function T(I){if(Cs&&typeof Cs.onCommitFiberRoot=="function")try{Cs.onCommitFiberRoot(_i,I,void 0,(I.current.flags&128)===128)}catch{}}function J(I){if(typeof cm=="function"&&Ca(I),Cs&&typeof Cs.setStrictMode=="function")try{Cs.setStrictMode(_i,I)}catch{}}function Q(I,d){return I===d&&(I!==0||1/I===1/d)||I!==I&&d!==d}function se(I,d){if(typeof I=="object"&&I!==null){var b=hh.get(I);return b!==void 0?b:(d={value:I,source:d,stack:C(d)},hh.set(I,d),d)}return{value:I,source:d,stack:C(d)}}function L(I,d){Mg[Hg++]=Dc,Mg[Hg++]=Xg,Xg=I,Dc=d}function D(I,d,b){Hs[Xs++]=Fo,Hs[Xs++]=Eo,Hs[Xs++]=Pr,Pr=I;var S=Fo;I=Eo;var V=32-ka(S)-1;S&=~(1<<V),b+=1;var K=32-ka(d)+V;if(30<K){var te=V-V%5;K=(S&(1<<te)-1).toString(32),S>>=te,V-=te,Fo=1<<32-ka(d)+V|b<<V|S,Eo=K+I}else Fo=1<<K|b<<V|S,Eo=I}function ne(I){I.return!==null&&(L(I,1),D(I,1,0))}function oe(I){for(;I===Xg;)Xg=Mg[--Hg],Mg[Hg]=null,Dc=Mg[--Hg],Mg[Hg]=null;for(;I===Pr;)Pr=Hs[--Xs],Hs[Xs]=null,Eo=Hs[--Xs],Hs[Xs]=null,Fo=Hs[--Xs],Hs[Xs]=null}function j(I,d){R(ll,d),R(kc,I),R(oa,null),I=Zp(d),B(oa),R(oa,I)}function re(){B(oa),B(kc),B(ll)}function pe(I){I.memoizedState!==null&&R(Ng,I);var d=oa.current,b=Tc(d,I.type);d!==b&&(R(kc,I),R(oa,b))}function me(I){kc.current===I&&(B(oa),B(kc)),Ng.current===I&&(B(Ng),Ua?Yo._currentValue=Ur:Yo._currentValue2=Ur)}function be(I){var d=Error(i(418,""));throw ut(se(d,I)),CI}function $e(I,d){if(!Ba)throw Error(i(175));Qp(I.stateNode,I.type,I.memoizedProps,d,I)||be(I)}function qe(I){for(va=I.return;va;)switch(va.tag){case 3:case 27:da=!0;return;case 5:case 13:da=!1;return;default:va=va.return}}function ke(I){if(!Ba||I!==va)return!1;if(!xn)return qe(I),xn=!0,!1;var d=!1;if(Qn?I.tag!==3&&I.tag!==27&&(I.tag!==5||PC(I.type)&&!sn(I.type,I.memoizedProps))&&(d=!0):I.tag!==3&&(I.tag!==5||PC(I.type)&&!sn(I.type,I.memoizedProps))&&(d=!0),d&&Za&&be(I),qe(I),I.tag===13){if(!Ba)throw Error(i(316));if(I=I.memoizedState,I=I!==null?I.dehydrated:null,!I)throw Error(i(317));Za=qp(I)}else Za=va?Ih(I.stateNode):null;return!0}function Te(){Ba&&(Za=va=null,xn=!1)}function ut(I){Co===null?Co=[I]:Co.push(I)}function q(){for(var I=Yg,d=To=Yg=0;d<I;){var b=Ao[d];Ao[d++]=null;var S=Ao[d];Ao[d++]=null;var V=Ao[d];Ao[d++]=null;var K=Ao[d];if(Ao[d++]=null,S!==null&&V!==null){var te=S.pending;te===null?V.next=V:(V.next=te.next,te.next=V),S.pending=V}K!==0&&ye(b,V,K)}}function De(I,d,b,S){Ao[Yg++]=I,Ao[Yg++]=d,Ao[Yg++]=b,Ao[Yg++]=S,To|=S,I.lanes|=S,I=I.alternate,I!==null&&(I.lanes|=S)}function Ke(I,d,b,S){return De(I,d,b,S),Je(I)}function Ee(I,d){return De(I,null,null,d),Je(I)}function ye(I,d,b){I.lanes|=b;var S=I.alternate;S!==null&&(S.lanes|=b);for(var V=!1,K=I.return;K!==null;)K.childLanes|=b,S=K.alternate,S!==null&&(S.childLanes|=b),K.tag===22&&(I=K.stateNode,I===null||I._visibility&1||(V=!0)),I=K,K=K.return;V&&d!==null&&I.tag===3&&(K=I.stateNode,V=31-ka(b),K=K.hiddenUpdates,I=K[V],I===null?K[V]=[d]:I.push(d),d.lane=b|536870912)}function Je(I){if(50<tu)throw tu=0,cd=null,Error(i(185));for(var d=I.return;d!==null;)I=d,d=I.return;return I.tag===3?I.stateNode:null}function Me(I){I!==ir&&I.next===null&&(ir===null?dI=ir=I:ir=ir.next=I),ni=!0,Kg||(Kg=!0,Ve(gt))}function Ze(I,d){if(!fh&&ni){fh=!0;do for(var b=!1,S=dI;S!==null;){if(I!==0){var V=S.pendingLanes;if(V===0)var K=0;else{var te=S.suspendedLanes,he=S.pingedLanes;K=(1<<31-ka(42|I)+1)-1,K&=V&~(te&~he),K=K&201326677?K&201326677|1:K?K|2:0}K!==0&&(b=!0,Ce(S,K))}else K=vn,K=M(S,S===Un?K:0),(K&3)===0||H(S,K)||(b=!0,Ce(S,K));S=S.next}while(b);fh=!1}}function gt(){ni=Kg=!1;var I=0;Oc!==0&&(xp()&&(I=Oc),Oc=0);for(var d=Io(),b=null,S=dI;S!==null;){var V=S.next,K=k(S,d);K===0?(S.next=null,b===null?dI=V:b.next=V,V===null&&(ir=b)):(b=S,(I!==0||(K&3)!==0)&&(ni=!0)),S=V}Ze(I)}function k(I,d){for(var b=I.suspendedLanes,S=I.pingedLanes,V=I.expirationTimes,K=I.pendingLanes&-62914561;0<K;){var te=31-ka(K),he=1<<te,Xe=V[te];Xe===-1?((he&b)===0||(he&S)!==0)&&(V[te]=N(he,d)):Xe<=d&&(I.expiredLanes|=he),K&=~he}if(d=Un,b=vn,b=M(I,I===d?b:0),S=I.callbackNode,b===0||I===d&&On===2||I.cancelPendingCommit!==null)return S!==null&&S!==null&&$C(S),I.callbackNode=null,I.callbackPriority=0;if((b&3)===0||H(I,b)){if(d=b&-b,d===I.callbackPriority)return d;switch(S!==null&&$C(S),le(b)){case 2:case 8:b=gm;break;case 32:b=nd;break;case 268435456:b=IG;break;default:b=nd}return S=z.bind(null,I),b=II(b,S),I.callbackPriority=d,I.callbackNode=b,d}return S!==null&&S!==null&&$C(S),I.callbackPriority=2,I.callbackNode=null,2}function z(I,d){var b=I.callbackNode;if(Xo()&&I.callbackNode!==b)return null;var S=vn;return S=M(I,I===Un?S:0),S===0?null:(Kr(I,S,d),k(I,Io()),I.callbackNode!=null&&I.callbackNode===b?z.bind(null,I):null)}function Ce(I,d){if(Xo())return null;Kr(I,d,!0)}function Ve(I){nh?tr(function(){(Vn&6)!==0?II(td,I):I()}):II(td,I)}function Ge(){return Oc===0&&(Oc=F()),Oc}function we(I,d){if(Jc===null){var b=Jc=[];Fg=0,Ns=Ge(),Eg={status:"pending",value:void 0,then:function(S){b.push(S)}}}return Fg++,d.then(et,et),d}function et(){if(--Fg===0&&Jc!==null){Eg!==null&&(Eg.status="fulfilled");var I=Jc;Jc=null,Ns=0,Eg=null;for(var d=0;d<I.length;d++)(0,I[d])()}}function lt(I,d){var b=[],S={status:"pending",value:null,reason:null,then:function(V){b.push(V)}};return I.then(function(){S.status="fulfilled",S.value=d;for(var V=0;V<b.length;V++)(0,b[V])(d)},function(V){for(S.status="rejected",S.reason=V,V=0;V<b.length;V++)(0,b[V])(void 0)}),S}function Ct(I){I.updateQueue={baseState:I.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function At(I,d){I=I.updateQueue,d.updateQueue===I&&(d.updateQueue={baseState:I.baseState,firstBaseUpdate:I.firstBaseUpdate,lastBaseUpdate:I.lastBaseUpdate,shared:I.shared,callbacks:null})}function Ne(I){return{lane:I,tag:0,payload:null,callback:null,next:null}}function tt(I,d,b){var S=I.updateQueue;if(S===null)return null;if(S=S.shared,(Vn&2)!==0){var V=S.pending;return V===null?d.next=d:(d.next=V.next,V.next=d),S.pending=d,d=Je(I),ye(I,null,b),d}return De(I,S,d,b),Je(I)}function nt(I,d,b){if(d=d.updateQueue,d!==null&&(d=d.shared,(b&4194176)!==0)){var S=d.lanes;S&=I.pendingLanes,b|=S,d.lanes=b,ie(I,b)}}function ue(I,d){var b=I.updateQueue,S=I.alternate;if(S!==null&&(S=S.updateQueue,b===S)){var V=null,K=null;if(b=b.firstBaseUpdate,b!==null){do{var te={lane:b.lane,tag:b.tag,payload:b.payload,callback:null,next:null};K===null?V=K=te:K=K.next=te,b=b.next}while(b!==null);K===null?V=K=d:K=K.next=d}else V=K=d;b={baseState:S.baseState,firstBaseUpdate:V,lastBaseUpdate:K,shared:S.shared,callbacks:S.callbacks},I.updateQueue=b;return}I=b.lastBaseUpdate,I===null?b.firstBaseUpdate=d:I.next=d,b.lastBaseUpdate=d}function xe(){if(Tg){var I=Eg;if(I!==null)throw I}}function ct(I,d,b,S){Tg=!1;var V=I.updateQueue;ar=!1;var K=V.firstBaseUpdate,te=V.lastBaseUpdate,he=V.shared.pending;if(he!==null){V.shared.pending=null;var Xe=he,st=Xe.next;Xe.next=null,te===null?K=st:te.next=st,te=Xe;var pt=I.alternate;pt!==null&&(pt=pt.updateQueue,he=pt.lastBaseUpdate,he!==te&&(he===null?pt.firstBaseUpdate=st:he.next=st,pt.lastBaseUpdate=Xe))}if(K!==null){var St=V.baseState;te=0,pt=st=Xe=null,he=K;do{var wt=he.lane&-536870913,nn=wt!==he.lane;if(nn?(vn&wt)===wt:(S&wt)===wt){wt!==0&&wt===Ns&&(Tg=!0),pt!==null&&(pt=pt.next={lane:0,tag:he.tag,payload:he.payload,callback:null,next:null});e:{var _s=I,ag=he;wt=d;var sg=b;switch(ag.tag){case 1:if(_s=ag.payload,typeof _s=="function"){St=_s.call(sg,St,wt);break e}St=_s;break e;case 3:_s.flags=_s.flags&-65537|128;case 0:if(_s=ag.payload,wt=typeof _s=="function"?_s.call(sg,St,wt):_s,wt==null)break e;St=KC({},St,wt);break e;case 2:ar=!0}}wt=he.callback,wt!==null&&(I.flags|=64,nn&&(I.flags|=8192),nn=V.callbacks,nn===null?V.callbacks=[wt]:nn.push(wt))}else nn={lane:wt,tag:he.tag,payload:he.payload,callback:he.callback,next:null},pt===null?(st=pt=nn,Xe=St):pt=pt.next=nn,te|=wt;if(he=he.next,he===null){if(he=V.shared.pending,he===null)break;nn=he,he=nn.next,nn.next=null,V.lastBaseUpdate=nn,V.shared.pending=null}}while(!0);pt===null&&(Xe=St),V.baseState=Xe,V.firstBaseUpdate=st,V.lastBaseUpdate=pt,K===null&&(V.shared.lanes=0),zs|=te,I.lanes=te,I.memoizedState=St}}function Ie(I,d){if(typeof I!="function")throw Error(i(191,I));I.call(d)}function Qe(I,d){var b=I.callbacks;if(b!==null)for(I.callbacks=null,I=0;I<b.length;I++)Ie(b[I],d)}function je(I,d){if(ds(I,d))return!0;if(typeof I!="object"||I===null||typeof d!="object"||d===null)return!1;var b=Object.keys(I),S=Object.keys(d);if(b.length!==S.length)return!1;for(S=0;S<b.length;S++){var V=b[S];if(!rl.call(d,V)||!ds(I[V],d[V]))return!1}return!0}function mt(I){return I=I.status,I==="fulfilled"||I==="rejected"}function it(){}function _e(I,d,b){switch(b=I[b],b===void 0?I.push(d):b!==d&&(d.then(it,it),d=b),d.status){case"fulfilled":return d.value;case"rejected":throw I=d.reason,I===Pc?Error(i(483)):I;default:if(typeof d.status=="string")d.then(it,it);else{if(I=Un,I!==null&&100<I.shellSuspendCounter)throw Error(i(482));I=d,I.status="pending",I.then(function(S){if(d.status==="pending"){var V=d;V.status="fulfilled",V.value=S}},function(S){if(d.status==="pending"){var V=d;V.status="rejected",V.reason=S}})}switch(d.status){case"fulfilled":return d.value;case"rejected":throw I=d.reason,I===Pc?Error(i(483)):I}throw Qr=d,Pc}}function ht(){if(Qr===null)throw Error(i(459));var I=Qr;return Qr=null,I}function yt(I){var d=qr;return qr+=1,jr===null&&(jr=[]),_e(jr,I,d)}function Bt(I,d){d=d.props.ref,I.ref=d!==void 0?d:null}function xt(I,d){throw d.$$typeof===sG?Error(i(525)):(I=Object.prototype.toString.call(d),Error(i(31,I==="[object Object]"?"object with keys {"+Object.keys(d).join(", ")+"}":I)))}function Gn(I){var d=I._init;return d(I._payload)}function gn(I){function d(Le,ve){if(I){var Pe=Le.deletions;Pe===null?(Le.deletions=[ve],Le.flags|=16):Pe.push(ve)}}function b(Le,ve){if(!I)return null;for(;ve!==null;)d(Le,ve),ve=ve.sibling;return null}function S(Le){for(var ve=new Map;Le!==null;)Le.key!==null?ve.set(Le.key,Le):ve.set(Le.index,Le),Le=Le.sibling;return ve}function V(Le,ve){return Le=ro(Le,ve),Le.index=0,Le.sibling=null,Le}function K(Le,ve,Pe){return Le.index=Pe,I?(Pe=Le.alternate,Pe!==null?(Pe=Pe.index,Pe<ve?(Le.flags|=33554434,ve):Pe):(Le.flags|=33554434,ve)):(Le.flags|=1048576,ve)}function te(Le){return I&&Le.alternate===null&&(Le.flags|=33554434),Le}function he(Le,ve,Pe,ft){return ve===null||ve.tag!==6?(ve=NC(Pe,Le.mode,ft),ve.return=Le,ve):(ve=V(ve,Pe),ve.return=Le,ve)}function Xe(Le,ve,Pe,ft){var Kt=Pe.type;return Kt===Lr?pt(Le,ve,Pe.props.children,ft,Pe.key):ve!==null&&(ve.elementType===Kt||typeof Kt=="object"&&Kt!==null&&Kt.$$typeof===co&&Gn(Kt)===ve.type)?(ve=V(ve,Pe.props),Bt(ve,Pe),ve.return=Le,ve):(ve=il(Pe.type,Pe.key,Pe.props,null,Le.mode,ft),Bt(ve,Pe),ve.return=Le,ve)}function st(Le,ve,Pe,ft){return ve===null||ve.tag!==4||ve.stateNode.containerInfo!==Pe.containerInfo||ve.stateNode.implementation!==Pe.implementation?(ve=JA(Pe,Le.mode,ft),ve.return=Le,ve):(ve=V(ve,Pe.children||[]),ve.return=Le,ve)}function pt(Le,ve,Pe,ft,Kt){return ve===null||ve.tag!==7?(ve=wi(Pe,Le.mode,ft,Kt),ve.return=Le,ve):(ve=V(ve,Pe),ve.return=Le,ve)}function St(Le,ve,Pe){if(typeof ve=="string"&&ve!==""||typeof ve=="number"||typeof ve=="bigint")return ve=NC(""+ve,Le.mode,Pe),ve.return=Le,ve;if(typeof ve=="object"&&ve!==null){switch(ve.$$typeof){case tI:return Pe=il(ve.type,ve.key,ve.props,null,Le.mode,Pe),Bt(Pe,ve),Pe.return=Le,Pe;case go:return ve=JA(ve,Le.mode,Pe),ve.return=Le,ve;case co:var ft=ve._init;return ve=ft(ve._payload),St(Le,ve,Pe)}if(Kc(ve)||s(ve))return ve=wi(ve,Le.mode,Pe,null),ve.return=Le,ve;if(typeof ve.then=="function")return St(Le,yt(ve),Pe);if(ve.$$typeof===No)return St(Le,Tu(Le,ve),Pe);xt(Le,ve)}return null}function wt(Le,ve,Pe,ft){var Kt=ve!==null?ve.key:null;if(typeof Pe=="string"&&Pe!==""||typeof Pe=="number"||typeof Pe=="bigint")return Kt!==null?null:he(Le,ve,""+Pe,ft);if(typeof Pe=="object"&&Pe!==null){switch(Pe.$$typeof){case tI:return Pe.key===Kt?Xe(Le,ve,Pe,ft):null;case go:return Pe.key===Kt?st(Le,ve,Pe,ft):null;case co:return Kt=Pe._init,Pe=Kt(Pe._payload),wt(Le,ve,Pe,ft)}if(Kc(Pe)||s(Pe))return Kt!==null?null:pt(Le,ve,Pe,ft,null);if(typeof Pe.then=="function")return wt(Le,ve,yt(Pe),ft);if(Pe.$$typeof===No)return wt(Le,ve,Tu(Le,Pe),ft);xt(Le,Pe)}return null}function nn(Le,ve,Pe,ft,Kt){if(typeof ft=="string"&&ft!==""||typeof ft=="number"||typeof ft=="bigint")return Le=Le.get(Pe)||null,he(ve,Le,""+ft,Kt);if(typeof ft=="object"&&ft!==null){switch(ft.$$typeof){case tI:return Le=Le.get(ft.key===null?Pe:ft.key)||null,Xe(ve,Le,ft,Kt);case go:return Le=Le.get(ft.key===null?Pe:ft.key)||null,st(ve,Le,ft,Kt);case co:var Ai=ft._init;return ft=Ai(ft._payload),nn(Le,ve,Pe,ft,Kt)}if(Kc(ft)||s(ft))return Le=Le.get(Pe)||null,pt(ve,Le,ft,Kt,null);if(typeof ft.then=="function")return nn(Le,ve,Pe,yt(ft),Kt);if(ft.$$typeof===No)return nn(Le,ve,Pe,Tu(ve,ft),Kt);xt(ve,ft)}return null}function _s(Le,ve,Pe,ft){for(var Kt=null,Ai=null,Qt=ve,Nn=ve=0,Ui=null;Qt!==null&&Nn<Pe.length;Nn++){Qt.index>Nn?(Ui=Qt,Qt=null):Ui=Qt.sibling;var yn=wt(Le,Qt,Pe[Nn],ft);if(yn===null){Qt===null&&(Qt=Ui);break}I&&Qt&&yn.alternate===null&&d(Le,Qt),ve=K(yn,ve,Nn),Ai===null?Kt=yn:Ai.sibling=yn,Ai=yn,Qt=Ui}if(Nn===Pe.length)return b(Le,Qt),xn&&L(Le,Nn),Kt;if(Qt===null){for(;Nn<Pe.length;Nn++)Qt=St(Le,Pe[Nn],ft),Qt!==null&&(ve=K(Qt,ve,Nn),Ai===null?Kt=Qt:Ai.sibling=Qt,Ai=Qt);return xn&&L(Le,Nn),Kt}for(Qt=S(Qt);Nn<Pe.length;Nn++)Ui=nn(Qt,Le,Nn,Pe[Nn],ft),Ui!==null&&(I&&Ui.alternate!==null&&Qt.delete(Ui.key===null?Nn:Ui.key),ve=K(Ui,ve,Nn),Ai===null?Kt=Ui:Ai.sibling=Ui,Ai=Ui);return I&&Qt.forEach(function(hl){return d(Le,hl)}),xn&&L(Le,Nn),Kt}function ag(Le,ve,Pe,ft){if(Pe==null)throw Error(i(151));for(var Kt=null,Ai=null,Qt=ve,Nn=ve=0,Ui=null,yn=Pe.next();Qt!==null&&!yn.done;Nn++,yn=Pe.next()){Qt.index>Nn?(Ui=Qt,Qt=null):Ui=Qt.sibling;var hl=wt(Le,Qt,yn.value,ft);if(hl===null){Qt===null&&(Qt=Ui);break}I&&Qt&&hl.alternate===null&&d(Le,Qt),ve=K(hl,ve,Nn),Ai===null?Kt=hl:Ai.sibling=hl,Ai=hl,Qt=Ui}if(yn.done)return b(Le,Qt),xn&&L(Le,Nn),Kt;if(Qt===null){for(;!yn.done;Nn++,yn=Pe.next())yn=St(Le,yn.value,ft),yn!==null&&(ve=K(yn,ve,Nn),Ai===null?Kt=yn:Ai.sibling=yn,Ai=yn);return xn&&L(Le,Nn),Kt}for(Qt=S(Qt);!yn.done;Nn++,yn=Pe.next())yn=nn(Qt,Le,Nn,yn.value,ft),yn!==null&&(I&&yn.alternate!==null&&Qt.delete(yn.key===null?Nn:yn.key),ve=K(yn,ve,Nn),Ai===null?Kt=yn:Ai.sibling=yn,Ai=yn);return I&&Qt.forEach(function(ud){return d(Le,ud)}),xn&&L(Le,Nn),Kt}function sg(Le,ve,Pe,ft){if(typeof Pe=="object"&&Pe!==null&&Pe.type===Lr&&Pe.key===null&&(Pe=Pe.props.children),typeof Pe=="object"&&Pe!==null){switch(Pe.$$typeof){case tI:e:{for(var Kt=Pe.key;ve!==null;){if(ve.key===Kt){if(Kt=Pe.type,Kt===Lr){if(ve.tag===7){b(Le,ve.sibling),ft=V(ve,Pe.props.children),ft.return=Le,Le=ft;break e}}else if(ve.elementType===Kt||typeof Kt=="object"&&Kt!==null&&Kt.$$typeof===co&&Gn(Kt)===ve.type){b(Le,ve.sibling),ft=V(ve,Pe.props),Bt(ft,Pe),ft.return=Le,Le=ft;break e}b(Le,ve);break}else d(Le,ve);ve=ve.sibling}Pe.type===Lr?(ft=wi(Pe.props.children,Le.mode,ft,Pe.key),ft.return=Le,Le=ft):(ft=il(Pe.type,Pe.key,Pe.props,null,Le.mode,ft),Bt(ft,Pe),ft.return=Le,Le=ft)}return te(Le);case go:e:{for(Kt=Pe.key;ve!==null;){if(ve.key===Kt)if(ve.tag===4&&ve.stateNode.containerInfo===Pe.containerInfo&&ve.stateNode.implementation===Pe.implementation){b(Le,ve.sibling),ft=V(ve,Pe.children||[]),ft.return=Le,Le=ft;break e}else{b(Le,ve);break}else d(Le,ve);ve=ve.sibling}ft=JA(Pe,Le.mode,ft),ft.return=Le,Le=ft}return te(Le);case co:return Kt=Pe._init,Pe=Kt(Pe._payload),sg(Le,ve,Pe,ft)}if(Kc(Pe))return _s(Le,ve,Pe,ft);if(s(Pe)){if(Kt=s(Pe),typeof Kt!="function")throw Error(i(150));return Pe=Kt.call(Pe),ag(Le,ve,Pe,ft)}if(typeof Pe.then=="function")return sg(Le,ve,yt(Pe),ft);if(Pe.$$typeof===No)return sg(Le,ve,Tu(Le,Pe),ft);xt(Le,Pe)}return typeof Pe=="string"&&Pe!==""||typeof Pe=="number"||typeof Pe=="bigint"?(Pe=""+Pe,ve!==null&&ve.tag===6?(b(Le,ve.sibling),ft=V(ve,Pe),ft.return=Le,Le=ft):(b(Le,ve),ft=NC(Pe,Le.mode,ft),ft.return=Le,Le=ft),te(Le)):b(Le,ve)}return function(Le,ve,Pe,ft){try{qr=0;var Kt=sg(Le,ve,Pe,ft);return jr=null,Kt}catch(Qt){if(Qt===Pc)throw Qt;var Ai=t(29,Qt,null,Le.mode);return Ai.lanes=ft,Ai.return=Le,Ai}finally{}}}function Cn(I,d){I=Xa,R(Qc,I),R(ii,d),Xa=I|d.baseLanes}function Kn(){R(Qc,Xa),R(ii,ii.current)}function ui(){Xa=Qc.current,B(ii),B(Qc)}function hi(I){var d=I.alternate;R(la,la.current&1),R(Ys,I),jn===null&&(d===null||ii.current!==null||d.memoizedState!==null)&&(jn=I)}function $a(I){if(I.tag===22){if(R(la,la.current),R(Ys,I),jn===null){var d=I.alternate;d!==null&&d.memoizedState!==null&&(jn=I)}}else aa()}function aa(){R(la,la.current),R(Ys,Ys.current)}function Ii(I){B(Ys),jn===I&&(jn=null),B(la)}function Jn(I){for(var d=I;d!==null;){if(d.tag===13){var b=d.memoizedState;if(b!==null&&(b=b.dehydrated,b===null||kC(b)||OC(b)))return d}else if(d.tag===19&&d.memoizedProps.revealOrder!==void 0){if((d.flags&128)!==0)return d}else if(d.child!==null){d.child.return=d,d=d.child;continue}if(d===I)break;for(;d.sibling===null;){if(d.return===null||d.return===I)return null;d=d.return}d.sibling.return=d.return,d=d.sibling}return null}function Bn(){throw Error(i(321))}function es(I,d){if(d===null)return!1;for(var b=0;b<d.length&&b<I.length;b++)if(!ds(I[b],d[b]))return!1;return!0}function Ea(I,d,b,S,V,K){return sr=K,dn=d,d.memoizedState=null,d.updateQueue=null,d.lanes=0,Pt.H=I===null||I.memoizedState===null?tg:Oa,eg=!1,K=b(S,V),eg=!1,zg&&(K=no(d,b,S,V)),jo(I),K}function jo(I){Pt.H=xi;var d=_t!==null&&_t.next!==null;if(sr=0,Wn=_t=dn=null,ho=!1,Lg=0,Aa=null,d)throw Error(i(300));I===null||qn||(I=I.dependencies,I!==null&&Eu(I)&&(qn=!0))}function no(I,d,b,S){dn=I;var V=0;do{if(zg&&(Aa=null),Lg=0,zg=!1,25<=V)throw Error(i(301));if(V+=1,Wn=_t=null,I.updateQueue!=null){var K=I.updateQueue;K.lastEffect=null,K.events=null,K.stores=null,K.memoCache!=null&&(K.memoCache.index=0)}Pt.H=Ks,K=d(b,S)}while(zg);return K}function Ci(){var I=Pt.H,d=I.useState()[0];return d=typeof d.then=="function"?ze(d):d,I=I.useState()[0],(_t!==null?_t.memoizedState:null)!==I&&(dn.flags|=1024),d}function qo(){var I=id!==0;return id=0,I}function Zr(I,d,b){d.updateQueue=I.updateQueue,d.flags&=-2053,I.lanes&=~b}function ts(I){if(ho){for(I=I.memoizedState;I!==null;){var d=I.queue;d!==null&&(d.pending=null),I=I.next}ho=!1}sr=0,Wn=_t=dn=null,zg=!1,Lg=id=0,Aa=null}function $(){var I={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Wn===null?dn.memoizedState=Wn=I:Wn=Wn.next=I,Wn}function Se(){if(_t===null){var I=dn.alternate;I=I!==null?I.memoizedState:null}else I=_t.next;var d=Wn===null?dn.memoizedState:Wn.next;if(d!==null)Wn=d,_t=I;else{if(I===null)throw dn.alternate===null?Error(i(467)):Error(i(310));_t=I,I={memoizedState:_t.memoizedState,baseState:_t.baseState,baseQueue:_t.baseQueue,queue:_t.queue,next:null},Wn===null?dn.memoizedState=Wn=I:Wn=Wn.next=I}return Wn}function ze(I){var d=Lg;return Lg+=1,Aa===null&&(Aa=[]),I=_e(Aa,I,d),d=dn,(Wn===null?d.memoizedState:Wn.next)===null&&(d=d.alternate,Pt.H=d===null||d.memoizedState===null?tg:Oa),I}function Be(I){if(I!==null&&typeof I=="object"){if(typeof I.then=="function")return ze(I);if(I.$$typeof===No)return ma(I)}throw Error(i(438,String(I)))}function We(I){var d=null,b=dn.updateQueue;if(b!==null&&(d=b.memoCache),d==null){var S=dn.alternate;S!==null&&(S=S.updateQueue,S!==null&&(S=S.memoCache,S!=null&&(d={data:S.data.map(function(V){return V.slice()}),index:0})))}if(d==null&&(d={data:[],index:0}),b===null&&(b=ad(),dn.updateQueue=b),b.memoCache=d,b=d.data[d.index],b===void 0)for(b=d.data[d.index]=Array(I),S=0;S<I;S++)b[S]=vp;return d.index++,b}function dt(I,d){return typeof d=="function"?d(I):d}function bt(I){var d=Se();return vt(d,_t,I)}function vt(I,d,b){var S=I.queue;if(S===null)throw Error(i(311));S.lastRenderedReducer=b;var V=I.baseQueue,K=S.pending;if(K!==null){if(V!==null){var te=V.next;V.next=K.next,K.next=te}d.baseQueue=V=K,S.pending=null}if(K=I.baseState,V===null)I.memoizedState=K;else{d=V.next;var he=te=null,Xe=null,st=d,pt=!1;do{var St=st.lane&-536870913;if(St!==st.lane?(vn&St)===St:(sr&St)===St){var wt=st.revertLane;if(wt===0)Xe!==null&&(Xe=Xe.next={lane:0,revertLane:0,action:st.action,hasEagerState:st.hasEagerState,eagerState:st.eagerState,next:null}),St===Ns&&(pt=!0);else if((sr&wt)===wt){st=st.next,wt===Ns&&(pt=!0);continue}else St={lane:0,revertLane:st.revertLane,action:st.action,hasEagerState:st.hasEagerState,eagerState:st.eagerState,next:null},Xe===null?(he=Xe=St,te=K):Xe=Xe.next=St,dn.lanes|=wt,zs|=wt;St=st.action,eg&&b(K,St),K=st.hasEagerState?st.eagerState:b(K,St)}else wt={lane:St,revertLane:st.revertLane,action:st.action,hasEagerState:st.hasEagerState,eagerState:st.eagerState,next:null},Xe===null?(he=Xe=wt,te=K):Xe=Xe.next=wt,dn.lanes|=St,zs|=St;st=st.next}while(st!==null&&st!==d);if(Xe===null?te=K:Xe.next=he,!ds(K,I.memoizedState)&&(qn=!0,pt&&(b=Eg,b!==null)))throw b;I.memoizedState=K,I.baseState=te,I.baseQueue=Xe,S.lastRenderedState=K}return V===null&&(S.lanes=0),[I.memoizedState,S.dispatch]}function Zt(I){var d=Se(),b=d.queue;if(b===null)throw Error(i(311));b.lastRenderedReducer=I;var S=b.dispatch,V=b.pending,K=d.memoizedState;if(V!==null){b.pending=null;var te=V=V.next;do K=I(K,te.action),te=te.next;while(te!==V);ds(K,d.memoizedState)||(qn=!0),d.memoizedState=K,d.baseQueue===null&&(d.baseState=K),b.lastRenderedState=K}return[K,S]}function Tt(I,d,b){var S=dn,V=Se(),K=xn;if(K){if(b===void 0)throw Error(i(407));b=b()}else b=d();var te=!ds((_t||V).memoizedState,b);if(te&&(V.memoizedState=b,qn=!0),V=V.queue,Vl(en.bind(null,S,V,I),[I]),V.getSnapshot!==d||te||Wn!==null&&Wn.memoizedState.tag&1){if(S.flags|=2048,Pi(9,Wt.bind(null,S,V,b,d),{destroy:void 0},null),Un===null)throw Error(i(349));K||(sr&60)!==0||Xt(S,d,b)}return b}function Xt(I,d,b){I.flags|=16384,I={getSnapshot:d,value:b},d=dn.updateQueue,d===null?(d=ad(),dn.updateQueue=d,d.stores=[I]):(b=d.stores,b===null?d.stores=[I]:b.push(I))}function Wt(I,d,b,S){d.value=b,d.getSnapshot=S,bn(d)&&Tn(I)}function en(I,d,b){return b(function(){bn(d)&&Tn(I)})}function bn(I){var d=I.getSnapshot;I=I.value;try{var b=d();return!ds(I,b)}catch{return!0}}function Tn(I){var d=Ee(I,2);d!==null&&Ia(d,I,2)}function cn(I){var d=$();if(typeof I=="function"){var b=I;if(I=b(),eg){J(!0);try{b()}finally{J(!1)}}}return d.memoizedState=d.baseState=I,d.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:dt,lastRenderedState:I},d}function fn(I,d,b,S){return I.baseState=b,vt(I,_t,typeof S=="function"?S:dt)}function Nt(I,d,b,S,V){if(xr(I))throw Error(i(485));if(I=d.action,I!==null){var K={payload:V,action:I,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(te){K.listeners.push(te)}};Pt.T!==null?b(!0):K.isTransition=!1,S(K),b=d.pending,b===null?(K.next=d.pending=K,Pn(d,K)):(K.next=b.next,d.pending=b.next=K)}}function Pn(I,d){var b=d.action,S=d.payload,V=I.state;if(d.isTransition){var K=Pt.T,te={};Pt.T=te;try{var he=b(V,S),Xe=Pt.S;Xe!==null&&Xe(te,he),un(I,d,he)}catch(st){ns(I,d,st)}finally{Pt.T=K}}else try{K=b(V,S),un(I,d,K)}catch(st){ns(I,d,st)}}function un(I,d,b){b!==null&&typeof b=="object"&&typeof b.then=="function"?b.then(function(S){Ni(I,d,S)},function(S){return ns(I,d,S)}):Ni(I,d,b)}function Ni(I,d,b){d.status="fulfilled",d.value=b,Fn(d),I.state=b,d=I.pending,d!==null&&(b=d.next,b===d?I.pending=null:(b=b.next,d.next=b,Pn(I,b)))}function ns(I,d,b){var S=I.pending;if(I.pending=null,S!==null){S=S.next;do d.status="rejected",d.reason=b,Fn(d),d=d.next;while(d!==S)}I.action=null}function Fn(I){I=I.listeners;for(var d=0;d<I.length;d++)(0,I[d])()}function Yi(I,d){return d}function zn(I,d){if(xn){var b=Un.formState;if(b!==null){e:{var S=dn;if(xn){if(Za){var V=uh(Za,da);if(V){Za=Ih(V),S=kp(V);break e}}be(S)}S=!1}S&&(d=b[0])}}b=$(),b.memoizedState=b.baseState=d,S={pending:null,lanes:0,dispatch:null,lastRenderedReducer:Yi,lastRenderedState:d},b.queue=S,b=Bc.bind(null,dn,S),S.dispatch=b,S=cn(!1);var K=Kl.bind(null,dn,!1,S.queue);return S=$(),V={state:d,dispatch:null,action:I,pending:null},S.queue=V,b=Nt.bind(null,dn,V,K,b),V.dispatch=b,S.memoizedState=I,[d,b,!1]}function Si(I){var d=Se();return ti(d,_t,I)}function ti(I,d,b){d=vt(I,d,Yi)[0],I=bt(dt)[0],d=typeof d=="object"&&d!==null&&typeof d.then=="function"?ze(d):d;var S=Se(),V=S.queue,K=V.dispatch;return b!==S.memoizedState&&(dn.flags|=2048,Pi(9,Ki.bind(null,V,b),{destroy:void 0},null)),[d,K,I]}function Ki(I,d){I.action=d}function bi(I){var d=Se(),b=_t;if(b!==null)return ti(d,b,I);Se(),d=d.memoizedState,b=Se();var S=b.queue.dispatch;return b.memoizedState=I,[d,S,!1]}function Pi(I,d,b,S){return I={tag:I,create:d,inst:b,deps:S,next:null},d=dn.updateQueue,d===null&&(d=ad(),dn.updateQueue=d),b=d.lastEffect,b===null?d.lastEffect=I.next=I:(S=b.next,b.next=I,I.next=S,d.lastEffect=I),I}function is(){return Se().memoizedState}function Sr(I,d,b,S){var V=$();dn.flags|=I,V.memoizedState=Pi(1|d,b,{destroy:void 0},S===void 0?null:S)}function Rr(I,d,b,S){var V=Se();S=S===void 0?null:S;var K=V.memoizedState.inst;_t!==null&&S!==null&&es(S,_t.memoizedState.deps)?V.memoizedState=Pi(d,b,K,S):(dn.flags|=I,V.memoizedState=Pi(1|d,b,K,S))}function wr(I,d){Sr(8390656,8,I,d)}function Vl(I,d){Rr(2048,8,I,d)}function Hu(I,d){return Rr(4,2,I,d)}function $o(I,d){return Rr(4,4,I,d)}function Vo(I,d){if(typeof d=="function"){I=I();var b=d(I);return function(){typeof b=="function"?b():d(null)}}if(d!=null)return I=I(),d.current=I,function(){d.current=null}}function Mo(I,d,b){b=b!=null?b.concat([I]):null,Rr(4,4,Vo.bind(null,d,I),b)}function as(){}function el(I,d){var b=Se();d=d===void 0?null:d;var S=b.memoizedState;return d!==null&&es(d,S[1])?S[0]:(b.memoizedState=[I,d],I)}function Ml(I,d){var b=Se();d=d===void 0?null:d;var S=b.memoizedState;if(d!==null&&es(d,S[1]))return S[0];if(S=I(),eg){J(!0);try{I()}finally{J(!1)}}return b.memoizedState=[S,d],S}function Hl(I,d,b){return b===void 0||(sr&1073741824)!==0?I.memoizedState=d:(I.memoizedState=b,I=LA(),dn.lanes|=I,zs|=I,b)}function yg(I,d,b,S){return ds(b,d)?b:ii.current!==null?(I=Hl(I,b,S),ds(I,d)||(qn=!0),I):(sr&42)===0?(qn=!0,I.memoizedState=b):(I=LA(),dn.lanes|=I,zs|=I,d)}function Xl(I,d,b,S,V){var K=er();Ma(K!==0&&8>K?K:8);var te=Pt.T,he={};Pt.T=he,Kl(I,!1,d,b);try{var Xe=V(),st=Pt.S;if(st!==null&&st(he,Xe),Xe!==null&&typeof Xe=="object"&&typeof Xe.then=="function"){var pt=lt(Xe,S);io(I,d,pt,Ti(I))}else io(I,d,S,Ti(I))}catch(St){io(I,d,{then:function(){},status:"rejected",reason:St},Ti())}finally{Ma(K),Pt.T=te}}function Ta(I){var d=I.memoizedState;if(d!==null)return d;d={memoizedState:Ur,baseState:Ur,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:dt,lastRenderedState:Ur},next:null};var b={};return d.next={memoizedState:b,baseState:b,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:dt,lastRenderedState:b},next:null},I.memoizedState=d,I=I.alternate,I!==null&&(I.memoizedState=d),d}function Nl(){return ma(Yo)}function Yl(){return Se().memoizedState}function Fi(){return Se().memoizedState}function Gg(I){for(var d=I.return;d!==null;){switch(d.tag){case 24:case 3:var b=Ti();I=Ne(b);var S=tt(d,I,b);S!==null&&(Ia(S,d,b),nt(S,d,b)),d={cache:Mr()},I.payload=d;return}d=d.return}}function Bg(I,d,b){var S=Ti();b={lane:S,revertLane:0,action:b,hasEagerState:!1,eagerState:null,next:null},xr(I)?Ei(d,b):(b=Ke(I,d,b,S),b!==null&&(Ia(b,I,S),ss(b,d,S)))}function Bc(I,d,b){var S=Ti();io(I,d,b,S)}function io(I,d,b,S){var V={lane:S,revertLane:0,action:b,hasEagerState:!1,eagerState:null,next:null};if(xr(I))Ei(d,V);else{var K=I.alternate;if(I.lanes===0&&(K===null||K.lanes===0)&&(K=d.lastRenderedReducer,K!==null))try{var te=d.lastRenderedState,he=K(te,b);if(V.hasEagerState=!0,V.eagerState=he,ds(he,te))return De(I,d,V,0),Un===null&&q(),!1}catch{}finally{}if(b=Ke(I,d,V,S),b!==null)return Ia(b,I,S),ss(b,d,S),!0}return!1}function Kl(I,d,b,S){if(S={lane:2,revertLane:Ge(),action:S,hasEagerState:!1,eagerState:null,next:null},xr(I)){if(d)throw Error(i(479))}else d=Ke(I,b,S,2),d!==null&&Ia(d,I,2)}function xr(I){var d=I.alternate;return I===dn||d!==null&&d===dn}function Ei(I,d){zg=ho=!0;var b=I.pending;b===null?d.next=d:(d.next=b.next,b.next=d),I.pending=d}function ss(I,d,b){if((b&4194176)!==0){var S=d.lanes;S&=I.pendingLanes,b|=S,d.lanes=b,ie(I,b)}}function za(I,d,b,S){d=I.memoizedState,b=b(S,d),b=b==null?d:KC({},d,b),I.memoizedState=b,I.lanes===0&&(I.updateQueue.baseState=b)}function Fl(I,d,b,S,V,K,te){return I=I.stateNode,typeof I.shouldComponentUpdate=="function"?I.shouldComponentUpdate(S,K,te):d.prototype&&d.prototype.isPureReactComponent?!je(b,S)||!je(V,K):!0}function vc(I,d,b,S){I=d.state,typeof d.componentWillReceiveProps=="function"&&d.componentWillReceiveProps(b,S),typeof d.UNSAFE_componentWillReceiveProps=="function"&&d.UNSAFE_componentWillReceiveProps(b,S),d.state!==I&&cl.enqueueReplaceState(d,d.state,null)}function Rs(I,d){var b=d;if("ref"in d){b={};for(var S in d)S!=="ref"&&(b[S]=d[S])}if(I=I.defaultProps){b===d&&(b=KC({},b));for(var V in I)b[V]===void 0&&(b[V]=I[V])}return b}function ao(I,d){try{var b=I.onUncaughtError;b(d.value,{componentStack:d.stack})}catch(S){setTimeout(function(){throw S})}}function El(I,d,b){try{var S=I.onCaughtError;S(b.value,{componentStack:b.stack,errorBoundary:d.tag===1?d.stateNode:null})}catch(V){setTimeout(function(){throw V})}}function so(I,d,b){return b=Ne(b),b.tag=3,b.payload={element:null},b.callback=function(){ao(I,d)},b}function vg(I){return I=Ne(I),I.tag=3,I}function Wa(I,d,b,S){var V=b.type.getDerivedStateFromError;if(typeof V=="function"){var K=S.value;I.payload=function(){return V(K)},I.callback=function(){El(d,b,S)}}var te=b.stateNode;te!==null&&typeof te.componentDidCatch=="function"&&(I.callback=function(){El(d,b,S),typeof V!="function"&&(ng===null?ng=new Set([this]):ng.add(this));var he=S.stack;this.componentDidCatch(S.value,{componentStack:he!==null?he:""})})}function vA(I,d,b,S,V){if(b.flags|=32768,S!==null&&typeof S=="object"&&typeof S.then=="function"){if(d=b.alternate,d!==null&&Fu(d,b,V,!0),b=Ys.current,b!==null){switch(b.tag){case 13:return jn===null?Jl():b.alternate===null&&$n===0&&($n=3),b.flags&=-257,b.flags|=65536,b.lanes=V,S===hI?b.flags|=16384:(d=b.updateQueue,d===null?b.updateQueue=new Set([S]):d.add(S),Rg(I,S,V)),!1;case 22:return b.flags|=65536,S===hI?b.flags|=16384:(d=b.updateQueue,d===null?(d={transitions:null,markerInstances:null,retryQueue:new Set([S])},b.updateQueue=d):(b=d.retryQueue,b===null?d.retryQueue=new Set([S]):b.add(S)),Rg(I,S,V)),!1}throw Error(i(435,b.tag))}return Rg(I,S,V),Jl(),!1}if(xn)return d=Ys.current,d!==null?((d.flags&65536)===0&&(d.flags|=256),d.flags|=65536,d.lanes=V,S!==CI&&(I=Error(i(422),{cause:S}),ut(se(I,b)))):(S!==CI&&(d=Error(i(423),{cause:S}),ut(se(d,b))),I=I.current.alternate,I.flags|=65536,V&=-V,I.lanes|=V,S=se(S,b),V=so(I.stateNode,S,V),ue(I,V),$n!==4&&($n=2)),!1;var K=Error(i(520),{cause:S});if(K=se(K,b),Ug===null?Ug=[K]:Ug.push(K),$n!==4&&($n=2),d===null)return!0;S=se(S,b),b=d;do{switch(b.tag){case 3:return b.flags|=65536,I=V&-V,b.lanes|=I,I=so(b.stateNode,S,I),ue(b,I),!1;case 1:if(d=b.type,K=b.stateNode,(b.flags&128)===0&&(typeof d.getDerivedStateFromError=="function"||K!==null&&typeof K.componentDidCatch=="function"&&(ng===null||!ng.has(K))))return b.flags|=65536,V&=-V,b.lanes|=V,V=vg(V),Wa(V,I,b,S),ue(b,V),!1}b=b.return}while(b!==null);return!1}function Ri(I,d,b,S){d.child=I===null?gl(d,null,b,S):$r(d,I.child,b,S)}function Tl(I,d,b,S,V){b=b.render;var K=d.ref;if("ref"in S){var te={};for(var he in S)he!=="ref"&&(te[he]=S[he])}else te=S;return Vr(d),S=Ea(I,d,b,te,K,V),he=qo(),I!==null&&!qn?(Zr(I,d,V),zl(I,d,V)):(xn&&he&&ne(d),d.flags|=1,Ri(I,d,S,V),d.child)}function Xu(I,d,b,S,V){if(I===null){var K=b.type;return typeof K=="function"&&!ju(K)&&K.defaultProps===void 0&&b.compare===null?(d.tag=15,d.type=K,bC(I,d,K,S,V)):(I=il(b.type,null,S,d,d.mode,V),I.ref=d.ref,I.return=d,d.child=I)}if(K=I.child,!xA(I,V)){var te=K.memoizedProps;if(b=b.compare,b=b!==null?b:je,b(te,S)&&I.ref===d.ref)return zl(I,d,V)}return d.flags|=1,I=ro(K,S),I.ref=d.ref,I.return=d,d.child=I}function bC(I,d,b,S,V){if(I!==null){var K=I.memoizedProps;if(je(K,S)&&I.ref===d.ref)if(qn=!1,d.pendingProps=S=K,xA(I,V))(I.flags&131072)!==0&&(qn=!0);else return d.lanes=I.lanes,zl(I,d,V)}return ws(I,d,b,S,V)}function pa(I,d,b){var S=d.pendingProps,V=S.children,K=(d.stateNode._pendingVisibility&2)!==0,te=I!==null?I.memoizedState:null;if(Qi(I,d),S.mode==="hidden"||K){if((d.flags&128)!==0){if(S=te!==null?te.baseLanes|b:b,I!==null){for(V=d.child=I.child,K=0;V!==null;)K=K|V.lanes|V.childLanes,V=V.sibling;d.childLanes=K&~S}else d.childLanes=0,d.child=null;return os(I,d,S,b)}if((b&536870912)!==0)d.memoizedState={baseLanes:0,cachePool:null},I!==null&&GC(d,te!==null?te.cachePool:null),te!==null?Cn(d,te):Kn(),$a(d);else return d.lanes=d.childLanes=536870912,os(I,d,te!==null?te.baseLanes|b:b,b)}else te!==null?(GC(d,te.cachePool),Cn(d,te),aa(),d.memoizedState=null):(I!==null&&GC(d,null),Kn(),aa());return Ri(I,d,V,b),d.child}function os(I,d,b,S){var V=VA();return V=V===null?null:{parent:Ua?ai._currentValue:ai._currentValue2,pool:V},d.memoizedState={baseLanes:b,cachePool:V},I!==null&&GC(d,null),Kn(),$a(d),I!==null&&Fu(I,d,S,!0),null}function Qi(I,d){var b=d.ref;if(b===null)I!==null&&I.ref!==null&&(d.flags|=2097664);else{if(typeof b!="function"&&typeof b!="object")throw Error(i(284));(I===null||I.ref!==b)&&(d.flags|=2097664)}}function ws(I,d,b,S,V){return Vr(d),b=Ea(I,d,b,S,void 0,V),S=qo(),I!==null&&!qn?(Zr(I,d,V),zl(I,d,V)):(xn&&S&&ne(d),d.flags|=1,Ri(I,d,b,V),d.child)}function Nu(I,d,b,S,V,K){return Vr(d),d.updateQueue=null,b=no(d,S,b,V),jo(I),S=qo(),I!==null&&!qn?(Zr(I,d,K),zl(I,d,K)):(xn&&S&&ne(d),d.flags|=1,Ri(I,d,b,K),d.child)}function cp(I,d,b,S,V){if(Vr(d),d.stateNode===null){var K=Jr,te=b.contextType;typeof te=="object"&&te!==null&&(K=ma(te)),K=new b(S,K),d.memoizedState=K.state!==null&&K.state!==void 0?K.state:null,K.updater=cl,d.stateNode=K,K._reactInternals=d,K=d.stateNode,K.props=S,K.state=d.memoizedState,K.refs={},Ct(d),te=b.contextType,K.context=typeof te=="object"&&te!==null?ma(te):Jr,K.state=d.memoizedState,te=b.getDerivedStateFromProps,typeof te=="function"&&(za(d,b,te,S),K.state=d.memoizedState),typeof b.getDerivedStateFromProps=="function"||typeof K.getSnapshotBeforeUpdate=="function"||typeof K.UNSAFE_componentWillMount!="function"&&typeof K.componentWillMount!="function"||(te=K.state,typeof K.componentWillMount=="function"&&K.componentWillMount(),typeof K.UNSAFE_componentWillMount=="function"&&K.UNSAFE_componentWillMount(),te!==K.state&&cl.enqueueReplaceState(K,K.state,null),ct(d,S,K,V),xe(),K.state=d.memoizedState),typeof K.componentDidMount=="function"&&(d.flags|=4194308),S=!0}else if(I===null){K=d.stateNode;var he=d.memoizedProps,Xe=Rs(b,he);K.props=Xe;var st=K.context,pt=b.contextType;te=Jr,typeof pt=="object"&&pt!==null&&(te=ma(pt));var St=b.getDerivedStateFromProps;pt=typeof St=="function"||typeof K.getSnapshotBeforeUpdate=="function",he=d.pendingProps!==he,pt||typeof K.UNSAFE_componentWillReceiveProps!="function"&&typeof K.componentWillReceiveProps!="function"||(he||st!==te)&&vc(d,K,S,te),ar=!1;var wt=d.memoizedState;K.state=wt,ct(d,S,K,V),xe(),st=d.memoizedState,he||wt!==st||ar?(typeof St=="function"&&(za(d,b,St,S),st=d.memoizedState),(Xe=ar||Fl(d,b,Xe,S,wt,st,te))?(pt||typeof K.UNSAFE_componentWillMount!="function"&&typeof K.componentWillMount!="function"||(typeof K.componentWillMount=="function"&&K.componentWillMount(),typeof K.UNSAFE_componentWillMount=="function"&&K.UNSAFE_componentWillMount()),typeof K.componentDidMount=="function"&&(d.flags|=4194308)):(typeof K.componentDidMount=="function"&&(d.flags|=4194308),d.memoizedProps=S,d.memoizedState=st),K.props=S,K.state=st,K.context=te,S=Xe):(typeof K.componentDidMount=="function"&&(d.flags|=4194308),S=!1)}else{K=d.stateNode,At(I,d),te=d.memoizedProps,pt=Rs(b,te),K.props=pt,St=d.pendingProps,wt=K.context,st=b.contextType,Xe=Jr,typeof st=="object"&&st!==null&&(Xe=ma(st)),he=b.getDerivedStateFromProps,(st=typeof he=="function"||typeof K.getSnapshotBeforeUpdate=="function")||typeof K.UNSAFE_componentWillReceiveProps!="function"&&typeof K.componentWillReceiveProps!="function"||(te!==St||wt!==Xe)&&vc(d,K,S,Xe),ar=!1,wt=d.memoizedState,K.state=wt,ct(d,S,K,V),xe();var nn=d.memoizedState;te!==St||wt!==nn||ar||I!==null&&I.dependencies!==null&&Eu(I.dependencies)?(typeof he=="function"&&(za(d,b,he,S),nn=d.memoizedState),(pt=ar||Fl(d,b,pt,S,wt,nn,Xe)||I!==null&&I.dependencies!==null&&Eu(I.dependencies))?(st||typeof K.UNSAFE_componentWillUpdate!="function"&&typeof K.componentWillUpdate!="function"||(typeof K.componentWillUpdate=="function"&&K.componentWillUpdate(S,nn,Xe),typeof K.UNSAFE_componentWillUpdate=="function"&&K.UNSAFE_componentWillUpdate(S,nn,Xe)),typeof K.componentDidUpdate=="function"&&(d.flags|=4),typeof K.getSnapshotBeforeUpdate=="function"&&(d.flags|=1024)):(typeof K.componentDidUpdate!="function"||te===I.memoizedProps&&wt===I.memoizedState||(d.flags|=4),typeof K.getSnapshotBeforeUpdate!="function"||te===I.memoizedProps&&wt===I.memoizedState||(d.flags|=1024),d.memoizedProps=S,d.memoizedState=nn),K.props=S,K.state=nn,K.context=Xe,S=pt):(typeof K.componentDidUpdate!="function"||te===I.memoizedProps&&wt===I.memoizedState||(d.flags|=4),typeof K.getSnapshotBeforeUpdate!="function"||te===I.memoizedProps&&wt===I.memoizedState||(d.flags|=1024),S=!1)}return K=S,Qi(I,d),S=(d.flags&128)!==0,K||S?(K=d.stateNode,b=S&&typeof b.getDerivedStateFromError!="function"?null:K.render(),d.flags|=1,I!==null&&S?(d.child=$r(d,I.child,null,V),d.child=$r(d,null,b,V)):Ri(I,d,b,V),d.memoizedState=K.state,I=d.child):I=zl(I,d,V),I}function up(I,d,b,S){return Te(),d.flags|=256,Ri(I,d,b,S),d.child}function ZA(I){return{baseLanes:I,cachePool:MA()}}function Yu(I,d,b){return I=I!==null?I.childLanes&~b:0,d&&(I|=Ls),I}function Ip(I,d,b){var S=d.pendingProps,V=!1,K=(d.flags&128)!==0,te;if((te=K)||(te=I!==null&&I.memoizedState===null?!1:(la.current&2)!==0),te&&(V=!0,d.flags&=-129),te=(d.flags&32)!==0,d.flags&=-33,I===null){if(xn){if(V?hi(d):aa(),xn){var he=Za,Xe;(Xe=he)&&(he=Pp(he,da),he!==null?(d.memoizedState={dehydrated:he,treeContext:Pr!==null?{id:Fo,overflow:Eo}:null,retryLane:536870912},Xe=t(18,null,null,0),Xe.stateNode=he,Xe.return=d,d.child=Xe,va=d,Za=null,Xe=!0):Xe=!1),Xe||be(d)}if(he=d.memoizedState,he!==null&&(he=he.dehydrated,he!==null))return OC(he)?d.lanes=16:d.lanes=536870912,null;Ii(d)}return he=S.children,S=S.fallback,V?(aa(),V=d.mode,he=RA({mode:"hidden",children:he},V),S=wi(S,V,b,null),he.return=d,S.return=d,he.sibling=S,d.child=he,V=d.child,V.memoizedState=ZA(b),V.childLanes=Yu(I,te,b),d.memoizedState=ld,S):(hi(d),SA(d,he))}if(Xe=I.memoizedState,Xe!==null&&(he=Xe.dehydrated,he!==null)){if(K)d.flags&256?(hi(d),d.flags&=-257,d=yC(I,d,b)):d.memoizedState!==null?(aa(),d.child=I.child,d.flags|=128,d=null):(aa(),V=S.fallback,he=d.mode,S=RA({mode:"visible",children:S.children},he),V=wi(V,he,b,null),V.flags|=2,S.return=d,V.return=d,S.sibling=V,d.child=S,$r(d,I.child,null,b),S=d.child,S.memoizedState=ZA(b),S.childLanes=Yu(I,te,b),d.memoizedState=ld,d=V);else if(hi(d),OC(he))te=Up(he).digest,S=Error(i(419)),S.stack="",S.digest=te,ut({value:S,source:null,stack:null}),d=yC(I,d,b);else if(qn||Fu(I,d,b,!1),te=(b&I.childLanes)!==0,qn||te){if(te=Un,te!==null){if(S=b&-b,(S&42)!==0)S=1;else switch(S){case 2:S=1;break;case 8:S=4;break;case 32:S=16;break;case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:S=64;break;case 268435456:S=134217728;break;default:S=0}if(S=(S&(te.suspendedLanes|b))!==0?0:S,S!==0&&S!==Xe.retryLane)throw Xe.retryLane=S,Ee(I,S),Ia(te,I,S),od}kC(he)||Jl(),d=yC(I,d,b)}else kC(he)?(d.flags|=128,d.child=I.child,d=Pl.bind(null,I),Dp(he,d),d=null):(I=Xe.treeContext,Ba&&(Za=Jp(he),va=d,xn=!0,Co=null,da=!1,I!==null&&(Hs[Xs++]=Fo,Hs[Xs++]=Eo,Hs[Xs++]=Pr,Fo=I.id,Eo=I.overflow,Pr=d)),d=SA(d,S.children),d.flags|=4096);return d}return V?(aa(),V=S.fallback,he=d.mode,Xe=I.child,K=Xe.sibling,S=ro(Xe,{mode:"hidden",children:S.children}),S.subtreeFlags=Xe.subtreeFlags&31457280,K!==null?V=ro(K,V):(V=wi(V,he,b,null),V.flags|=2),V.return=d,S.return=d,S.sibling=V,d.child=S,S=V,V=d.child,he=I.child.memoizedState,he===null?he=ZA(b):(Xe=he.cachePool,Xe!==null?(K=Ua?ai._currentValue:ai._currentValue2,Xe=Xe.parent!==K?{parent:K,pool:K}:Xe):Xe=MA(),he={baseLanes:he.baseLanes|b,cachePool:Xe}),V.memoizedState=he,V.childLanes=Yu(I,te,b),d.memoizedState=ld,S):(hi(d),b=I.child,I=b.sibling,b=ro(b,{mode:"visible",children:S.children}),b.return=d,b.sibling=null,I!==null&&(te=d.deletions,te===null?(d.deletions=[I],d.flags|=16):te.push(I)),d.child=b,d.memoizedState=null,b)}function SA(I,d){return d=RA({mode:"visible",children:d},I.mode),d.return=I,I.child=d}function RA(I,d){return $u(I,d,0,null)}function yC(I,d,b){return $r(d,I.child,null,b),I=SA(d,d.pendingProps.children),I.flags|=2,d.memoizedState=null,I}function Cp(I,d,b){I.lanes|=d;var S=I.alternate;S!==null&&(S.lanes|=d),Ku(I.return,d,b)}function wA(I,d,b,S,V){var K=I.memoizedState;K===null?I.memoizedState={isBackwards:d,rendering:null,renderingStartTime:0,last:S,tail:b,tailMode:V}:(K.isBackwards=d,K.rendering=null,K.renderingStartTime=0,K.last=S,K.tail=b,K.tailMode=V)}function dp(I,d,b){var S=d.pendingProps,V=S.revealOrder,K=S.tail;if(Ri(I,d,S.children,b),S=la.current,(S&2)!==0)S=S&1|2,d.flags|=128;else{if(I!==null&&(I.flags&128)!==0)e:for(I=d.child;I!==null;){if(I.tag===13)I.memoizedState!==null&&Cp(I,b,d);else if(I.tag===19)Cp(I,b,d);else if(I.child!==null){I.child.return=I,I=I.child;continue}if(I===d)break e;for(;I.sibling===null;){if(I.return===null||I.return===d)break e;I=I.return}I.sibling.return=I.return,I=I.sibling}S&=1}switch(R(la,S),V){case"forwards":for(b=d.child,V=null;b!==null;)I=b.alternate,I!==null&&Jn(I)===null&&(V=b),b=b.sibling;b=V,b===null?(V=d.child,d.child=null):(V=b.sibling,b.sibling=null),wA(d,!1,V,b,K);break;case"backwards":for(b=null,V=d.child,d.child=null;V!==null;){if(I=V.alternate,I!==null&&Jn(I)===null){d.child=V;break}I=V.sibling,V.sibling=b,b=V,V=I}wA(d,!0,b,null,K);break;case"together":wA(d,!1,null,null,void 0);break;default:d.memoizedState=null}return d.child}function zl(I,d,b){if(I!==null&&(d.dependencies=I.dependencies),zs|=d.lanes,(b&d.childLanes)===0)if(I!==null){if(Fu(I,d,b,!1),(b&d.childLanes)===0)return null}else return null;if(I!==null&&d.child!==I.child)throw Error(i(153));if(d.child!==null){for(I=d.child,b=ro(I,I.pendingProps),d.child=b,b.return=d;I.sibling!==null;)I=I.sibling,b=b.sibling=ro(I,I.pendingProps),b.return=d;b.sibling=null}return d.child}function xA(I,d){return(I.lanes&d)!==0?!0:(I=I.dependencies,!!(I!==null&&Eu(I)))}function nG(I,d,b){switch(d.tag){case 3:j(d,d.stateNode.containerInfo),Wr(d,ai,I.memoizedState.cache),Te();break;case 27:case 5:pe(d);break;case 4:j(d,d.stateNode.containerInfo);break;case 10:Wr(d,d.type,d.memoizedProps.value);break;case 13:var S=d.memoizedState;if(S!==null)return S.dehydrated!==null?(hi(d),d.flags|=128,null):(b&d.child.childLanes)!==0?Ip(I,d,b):(hi(d),I=zl(I,d,b),I!==null?I.sibling:null);hi(d);break;case 19:var V=(I.flags&128)!==0;if(S=(b&d.childLanes)!==0,S||(Fu(I,d,b,!1),S=(b&d.childLanes)!==0),V){if(S)return dp(I,d,b);d.flags|=128}if(V=d.memoizedState,V!==null&&(V.rendering=null,V.tail=null,V.lastEffect=null),R(la,la.current),S)break;return null;case 22:case 23:return d.lanes=0,pa(I,d,b);case 24:Wr(d,ai,I.memoizedState.cache)}return zl(I,d,b)}function Ap(I,d,b){if(I!==null)if(I.memoizedProps!==d.pendingProps)qn=!0;else{if(!xA(I,b)&&(d.flags&128)===0)return qn=!1,nG(I,d,b);qn=(I.flags&131072)!==0}else qn=!1,xn&&(d.flags&1048576)!==0&&D(d,Dc,d.index);switch(d.lanes=0,d.tag){case 16:e:{I=d.pendingProps;var S=d.elementType,V=S._init;if(S=V(S._payload),d.type=S,typeof S=="function")ju(S)?(I=Rs(S,I),d.tag=1,d=cp(null,d,S,I,b)):(d.tag=0,d=ws(null,d,S,I,b));else{if(S!=null){if(V=S.$$typeof,V===aI){d.tag=11,d=Tl(null,d,S,I,b);break e}else if(V===TC){d.tag=14,d=Xu(null,d,S,I,b);break e}}throw d=o(S)||S,Error(i(306,d,""))}}return d;case 0:return ws(I,d,d.type,d.pendingProps,b);case 1:return S=d.type,V=Rs(S,d.pendingProps),cp(I,d,S,V,b);case 3:e:{if(j(d,d.stateNode.containerInfo),I===null)throw Error(i(387));var K=d.pendingProps;V=d.memoizedState,S=V.element,At(I,d),ct(d,K,null,b);var te=d.memoizedState;if(K=te.cache,Wr(d,ai,K),K!==V.cache&&Zg(d,[ai],b,!0),xe(),K=te.element,Ba&&V.isDehydrated)if(V={element:K,isDehydrated:!1,cache:te.cache},d.updateQueue.baseState=V,d.memoizedState=V,d.flags&256){d=up(I,d,K,b);break e}else if(K!==S){S=se(Error(i(424)),d),ut(S),d=up(I,d,K,b);break e}else for(Ba&&(Za=Op(d.stateNode.containerInfo),va=d,xn=!0,Co=null,da=!0),b=gl(d,null,K,b),d.child=b;b;)b.flags=b.flags&-3|4096,b=b.sibling;else{if(Te(),K===S){d=zl(I,d,b);break e}Ri(I,d,K,b)}d=d.child}return d;case 26:if(Ms)return Qi(I,d),I===null?(b=Ah(d.type,null,d.pendingProps,null))?d.memoizedState=b:xn||(d.stateNode=qC(d.type,d.pendingProps,ll.current,d)):d.memoizedState=Ah(d.type,I.memoizedProps,d.pendingProps,I.memoizedState),null;case 27:if(Qn)return pe(d),I===null&&Qn&&xn&&(S=d.stateNode=Ko(d.type,d.pendingProps,ll.current,oa.current,!1),va=d,da=!0,Za=JC(S)),S=d.pendingProps.children,I!==null||xn?Ri(I,d,S,b):d.child=$r(d,null,S,b),Qi(I,d),d.child;case 5:return I===null&&xn&&(QC(d.type,d.pendingProps,oa.current),(V=S=Za)&&(S=gG(S,d.type,d.pendingProps,da),S!==null?(d.stateNode=S,va=d,Za=JC(S),da=!1,V=!0):V=!1),V||be(d)),pe(d),V=d.type,K=d.pendingProps,te=I!==null?I.memoizedProps:null,S=K.children,sn(V,K)?S=null:te!==null&&sn(V,te)&&(d.flags|=32),d.memoizedState!==null&&(V=Ea(I,d,Ci,null,null,b),Ua?Yo._currentValue=V:Yo._currentValue2=V),Qi(I,d),Ri(I,d,S,b),d.child;case 6:return I===null&&xn&&(em(d.pendingProps,oa.current),(I=b=Za)&&(b=Ch(b,d.pendingProps,da),b!==null?(d.stateNode=b,va=d,Za=null,I=!0):I=!1),I||be(d)),null;case 13:return Ip(I,d,b);case 4:return j(d,d.stateNode.containerInfo),S=d.pendingProps,I===null?d.child=$r(d,null,S,b):Ri(I,d,S,b),d.child;case 11:return Tl(I,d,d.type,d.pendingProps,b);case 7:return Ri(I,d,d.pendingProps,b),d.child;case 8:return Ri(I,d,d.pendingProps.children,b),d.child;case 12:return Ri(I,d,d.pendingProps.children,b),d.child;case 10:return S=d.pendingProps,Wr(d,d.type,S.value),Ri(I,d,S.children,b),d.child;case 9:return V=d.type._context,S=d.pendingProps.children,Vr(d),V=ma(V),S=S(V),d.flags|=1,Ri(I,d,S,b),d.child;case 14:return Xu(I,d,d.type,d.pendingProps,b);case 15:return bC(I,d,d.type,d.pendingProps,b);case 19:return dp(I,d,b);case 22:return pa(I,d,b);case 24:return Vr(d),S=ma(ai),I===null?(V=VA(),V===null&&(V=Un,K=Mr(),V.pooledCache=K,K.refCount++,K!==null&&(V.pooledCacheLanes|=b),V=K),d.memoizedState={parent:S,cache:V},Ct(d),Wr(d,ai,V)):((I.lanes&b)!==0&&(At(I,d),ct(d,null,null,b),xe()),V=I.memoizedState,K=d.memoizedState,V.parent!==S?(V={parent:S,cache:S},d.memoizedState=V,d.lanes===0&&(d.memoizedState=d.updateQueue.baseState=V),Wr(d,ai,S)):(S=K.cache,Wr(d,ai,S),S!==V.cache&&Zg(d,[ai],b,!0))),Ri(I,d,d.pendingProps.children,b),d.child;case 29:throw d.pendingProps}throw Error(i(156,d.tag))}function Wr(I,d,b){Ua?(R(or,d._currentValue),d._currentValue=b):(R(or,d._currentValue2),d._currentValue2=b)}function Ll(I){var d=or.current;Ua?I._currentValue=d:I._currentValue2=d,B(or)}function Ku(I,d,b){for(;I!==null;){var S=I.alternate;if((I.childLanes&d)!==d?(I.childLanes|=d,S!==null&&(S.childLanes|=d)):S!==null&&(S.childLanes&d)!==d&&(S.childLanes|=d),I===b)break;I=I.return}}function Zg(I,d,b,S){var V=I.child;for(V!==null&&(V.return=I);V!==null;){var K=V.dependencies;if(K!==null){var te=V.child;K=K.firstContext;e:for(;K!==null;){var he=K;K=V;for(var Xe=0;Xe<d.length;Xe++)if(he.context===d[Xe]){K.lanes|=b,he=K.alternate,he!==null&&(he.lanes|=b),Ku(K.return,b,I),S||(te=null);break e}K=he.next}}else if(V.tag===18){if(te=V.return,te===null)throw Error(i(341));te.lanes|=b,K=te.alternate,K!==null&&(K.lanes|=b),Ku(te,b,I),te=null}else te=V.child;if(te!==null)te.return=V;else for(te=V;te!==null;){if(te===I){te=null;break}if(V=te.sibling,V!==null){V.return=te.return,te=V;break}te=te.return}V=te}}function Fu(I,d,b,S){I=null;for(var V=d,K=!1;V!==null;){if(!K){if((V.flags&524288)!==0)K=!0;else if((V.flags&262144)!==0)break}if(V.tag===10){var te=V.alternate;if(te===null)throw Error(i(387));if(te=te.memoizedProps,te!==null){var he=V.type;ds(V.pendingProps.value,te.value)||(I!==null?I.push(he):I=[he])}}else if(V===Ng.current){if(te=V.alternate,te===null)throw Error(i(387));te.memoizedState.memoizedState!==V.memoizedState.memoizedState&&(I!==null?I.push(Yo):I=[Yo])}V=V.return}I!==null&&Zg(d,I,b,S),d.flags|=262144}function Eu(I){for(I=I.firstContext;I!==null;){var d=I.context;if(!ds(Ua?d._currentValue:d._currentValue2,I.memoizedValue))return!0;I=I.next}return!1}function Vr(I){Lo=I,Fs=null,I=I.dependencies,I!==null&&(I.firstContext=null)}function ma(I){return WA(Lo,I)}function Tu(I,d){return Lo===null&&Vr(I),WA(I,d)}function WA(I,d){var b=Ua?d._currentValue:d._currentValue2;if(d={context:d,memoizedValue:b,next:null},Fs===null){if(I===null)throw Error(i(308));Fs=d,I.dependencies={lanes:0,firstContext:d},I.flags|=524288}else Fs=Fs.next=d;return b}function Mr(){return{controller:new jc,data:new Map,refCount:0}}function zu(I){I.refCount--,I.refCount===0&&um(Im,function(){I.controller.abort()})}function VA(){var I=ul.current;return I!==null?I:Un.pooledCache}function GC(I,d){d===null?R(ul,ul.current):R(ul,d.pool)}function MA(){var I=VA();return I===null?null:{parent:Ua?ai._currentValue:ai._currentValue2,pool:I}}function ls(I){I.flags|=4}function Zc(I,d){if(I!==null&&I.child===d.child)return!1;if((d.flags&16)!==0)return!0;for(I=d.child;I!==null;){if((I.flags&13878)!==0||(I.subtreeFlags&13878)!==0)return!0;I=I.sibling}return!1}function Sg(I,d,b,S){if(sa)for(b=d.child;b!==null;){if(b.tag===5||b.tag===6)oI(I,b.stateNode);else if(!(b.tag===4||Qn&&b.tag===27)&&b.child!==null){b.child.return=b,b=b.child;continue}if(b===d)break;for(;b.sibling===null;){if(b.return===null||b.return===d)return;b=b.return}b.sibling.return=b.return,b=b.sibling}else if(uo)for(var V=d.child;V!==null;){if(V.tag===5){var K=V.stateNode;b&&S&&(K=gh(K,V.type,V.memoizedProps)),oI(I,K)}else if(V.tag===6)K=V.stateNode,b&&S&&(K=ch(K,V.memoizedProps)),oI(I,K);else if(V.tag!==4){if(V.tag===22&&V.memoizedState!==null)K=V.child,K!==null&&(K.return=V),Sg(I,V,!0,!0);else if(V.child!==null){V.child.return=V,V=V.child;continue}}if(V===d)break;for(;V.sibling===null;){if(V.return===null||V.return===d)return;V=V.return}V.sibling.return=V.return,V=V.sibling}}function hp(I,d,b,S){if(uo)for(var V=d.child;V!==null;){if(V.tag===5){var K=V.stateNode;b&&S&&(K=gh(K,V.type,V.memoizedProps)),rh(I,K)}else if(V.tag===6)K=V.stateNode,b&&S&&(K=ch(K,V.memoizedProps)),rh(I,K);else if(V.tag!==4){if(V.tag===22&&V.memoizedState!==null)K=V.child,K!==null&&(K.return=V),hp(I,V,!(V.memoizedProps!==null&&V.memoizedProps.mode==="manual"),!0);else if(V.child!==null){V.child.return=V,V=V.child;continue}}if(V===d)break;for(;V.sibling===null;){if(V.return===null||V.return===d)return;V=V.return}V.sibling.return=V.return,V=V.sibling}}function Lu(I,d){if(uo&&Zc(I,d)){I=d.stateNode;var b=I.containerInfo,S=lI();hp(S,d,!1,!1),I.pendingChildren=S,ls(d),DC(b,S)}}function BC(I,d,b,S){if(sa)I.memoizedProps!==S&&ls(d);else if(uo){var V=I.stateNode,K=I.memoizedProps;if((I=Zc(I,d))||K!==S){var te=oa.current;K=Lc(V,b,K,S,!I,null),K===V?d.stateNode=V:($l(K,b,S,te)&&ls(d),d.stateNode=K,I?Sg(K,d,!1,!1):ls(d))}else d.stateNode=V}}function vC(I,d,b){if(eh(d,b)){if(I.flags|=16777216,!_C(d,b))if(Fr())I.flags|=8192;else throw Qr=hI,AI}else I.flags&=-16777217}function ZC(I,d){if(im(d)){if(I.flags|=16777216,!Wg(d))if(Fr())I.flags|=8192;else throw Qr=hI,AI}else I.flags&=-16777217}function Sc(I,d){d!==null&&(I.flags|=4),I.flags&16384&&(d=I.tag!==22?Y():536870912,I.lanes|=d,dl|=d)}function Rc(I,d){if(!xn)switch(I.tailMode){case"hidden":d=I.tail;for(var b=null;d!==null;)d.alternate!==null&&(b=d),d=d.sibling;b===null?I.tail=null:b.sibling=null;break;case"collapsed":b=I.tail;for(var S=null;b!==null;)b.alternate!==null&&(S=b),b=b.sibling;S===null?d||I.tail===null?I.tail=null:I.tail.sibling=null:S.sibling=null}}function fi(I){var d=I.alternate!==null&&I.alternate.child===I.child,b=0,S=0;if(d)for(var V=I.child;V!==null;)b|=V.lanes|V.childLanes,S|=V.subtreeFlags&31457280,S|=V.flags&31457280,V.return=I,V=V.sibling;else for(V=I.child;V!==null;)b|=V.lanes|V.childLanes,S|=V.subtreeFlags,S|=V.flags,V.return=I,V=V.sibling;return I.subtreeFlags|=S,I.childLanes=b,d}function fp(I,d,b){var S=d.pendingProps;switch(oe(d),d.tag){case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return fi(d),null;case 1:return fi(d),null;case 3:return b=d.stateNode,S=null,I!==null&&(S=I.memoizedState.cache),d.memoizedState.cache!==S&&(d.flags|=2048),Ll(ai),re(),b.pendingContext&&(b.context=b.pendingContext,b.pendingContext=null),(I===null||I.child===null)&&(ke(d)?ls(d):I===null||I.memoizedState.isDehydrated&&(d.flags&256)===0||(d.flags|=1024,Co!==null&&(Pu(Co),Co=null))),Lu(I,d),fi(d),null;case 26:if(Ms){b=d.type;var V=d.memoizedState;return I===null?(ls(d),V!==null?(fi(d),ZC(d,V)):(fi(d),vC(d,b,S))):V?V!==I.memoizedState?(ls(d),fi(d),ZC(d,V)):(fi(d),d.flags&=-16777217):(sa?I.memoizedProps!==S&&ls(d):BC(I,d,b,S),fi(d),vC(d,b,S)),null}case 27:if(Qn){if(me(d),b=ll.current,V=d.type,I!==null&&d.stateNode!=null)sa?I.memoizedProps!==S&&ls(d):BC(I,d,V,S);else{if(!S){if(d.stateNode===null)throw Error(i(166));return fi(d),null}I=oa.current,ke(d)?$e(d,I):(I=Ko(V,S,b,I,!0),d.stateNode=I,ls(d))}return fi(d),null}case 5:if(me(d),b=d.type,I!==null&&d.stateNode!=null)BC(I,d,b,S);else{if(!S){if(d.stateNode===null)throw Error(i(166));return fi(d),null}I=oa.current,ke(d)?$e(d,I):(V=$A(b,S,ll.current,I,d),Sg(V,d,!1,!1),d.stateNode=V,$l(V,b,S,I)&&ls(d))}return fi(d),vC(d,d.type,d.pendingProps),null;case 6:if(I&&d.stateNode!=null)b=I.memoizedProps,sa?b!==S&&ls(d):uo&&(b!==S?(d.stateNode=kn(S,ll.current,oa.current,d),ls(d)):d.stateNode=I.stateNode);else{if(typeof S!="string"&&d.stateNode===null)throw Error(i(166));if(I=ll.current,b=oa.current,ke(d)){if(!Ba)throw Error(i(176));if(I=d.stateNode,b=d.memoizedProps,S=null,V=va,V!==null)switch(V.tag){case 27:case 5:S=V.memoizedProps}dh(I,b,d,S)||be(d)}else d.stateNode=kn(S,I,b,d)}return fi(d),null;case 13:if(S=d.memoizedState,I===null||I.memoizedState!==null&&I.memoizedState.dehydrated!==null){if(V=ke(d),S!==null&&S.dehydrated!==null){if(I===null){if(!V)throw Error(i(318));if(!Ba)throw Error(i(344));if(V=d.memoizedState,V=V!==null?V.dehydrated:null,!V)throw Error(i(317));jp(V,d)}else Te(),(d.flags&128)===0&&(d.memoizedState=null),d.flags|=4;fi(d),V=!1}else Co!==null&&(Pu(Co),Co=null),V=!0;if(!V)return d.flags&256?(Ii(d),d):(Ii(d),null)}if(Ii(d),(d.flags&128)!==0)return d.lanes=b,d;if(b=S!==null,I=I!==null&&I.memoizedState!==null,b){S=d.child,V=null,S.alternate!==null&&S.alternate.memoizedState!==null&&S.alternate.memoizedState.cachePool!==null&&(V=S.alternate.memoizedState.cachePool.pool);var K=null;S.memoizedState!==null&&S.memoizedState.cachePool!==null&&(K=S.memoizedState.cachePool.pool),K!==V&&(S.flags|=2048)}return b!==I&&b&&(d.child.flags|=8192),Sc(d,d.updateQueue),fi(d),null;case 4:return re(),Lu(I,d),I===null&&zi(d.stateNode.containerInfo),fi(d),null;case 10:return Ll(d.type),fi(d),null;case 19:if(B(la),V=d.memoizedState,V===null)return fi(d),null;if(S=(d.flags&128)!==0,K=V.rendering,K===null)if(S)Rc(V,!1);else{if($n!==0||I!==null&&(I.flags&128)!==0)for(I=d.child;I!==null;){if(K=Jn(I),K!==null){for(d.flags|=128,Rc(V,!1),I=K.updateQueue,d.updateQueue=I,Sc(d,I),d.subtreeFlags=0,I=b,b=d.child;b!==null;)qu(b,I),b=b.sibling;return R(la,la.current&1|2),d.child}I=I.sibling}V.tail!==null&&Io()>eu&&(d.flags|=128,S=!0,Rc(V,!1),d.lanes=4194304)}else{if(!S)if(I=Jn(K),I!==null){if(d.flags|=128,S=!0,I=I.updateQueue,d.updateQueue=I,Sc(d,I),Rc(V,!0),V.tail===null&&V.tailMode==="hidden"&&!K.alternate&&!xn)return fi(d),null}else 2*Io()-V.renderingStartTime>eu&&b!==536870912&&(d.flags|=128,S=!0,Rc(V,!1),d.lanes=4194304);V.isBackwards?(K.sibling=d.child,d.child=K):(I=V.last,I!==null?I.sibling=K:d.child=K,V.last=K)}return V.tail!==null?(d=V.tail,V.rendering=d,V.tail=d.sibling,V.renderingStartTime=Io(),d.sibling=null,I=la.current,R(la,S?I&1|2:I&1),d):(fi(d),null);case 22:case 23:return Ii(d),ui(),S=d.memoizedState!==null,I!==null?I.memoizedState!==null!==S&&(d.flags|=8192):S&&(d.flags|=8192),S?(b&536870912)!==0&&(d.flags&128)===0&&(fi(d),d.subtreeFlags&6&&(d.flags|=8192)):fi(d),b=d.updateQueue,b!==null&&Sc(d,b.retryQueue),b=null,I!==null&&I.memoizedState!==null&&I.memoizedState.cachePool!==null&&(b=I.memoizedState.cachePool.pool),S=null,d.memoizedState!==null&&d.memoizedState.cachePool!==null&&(S=d.memoizedState.cachePool.pool),S!==b&&(d.flags|=2048),I!==null&&B(ul),null;case 24:return b=null,I!==null&&(b=I.memoizedState.cache),d.memoizedState.cache!==b&&(d.flags|=2048),Ll(ai),fi(d),null;case 25:return null}throw Error(i(156,d.tag))}function iG(I,d){switch(oe(d),d.tag){case 1:return I=d.flags,I&65536?(d.flags=I&-65537|128,d):null;case 3:return Ll(ai),re(),I=d.flags,(I&65536)!==0&&(I&128)===0?(d.flags=I&-65537|128,d):null;case 26:case 27:case 5:return me(d),null;case 13:if(Ii(d),I=d.memoizedState,I!==null&&I.dehydrated!==null){if(d.alternate===null)throw Error(i(340));Te()}return I=d.flags,I&65536?(d.flags=I&-65537|128,d):null;case 19:return B(la),null;case 4:return re(),null;case 10:return Ll(d.type),null;case 22:case 23:return Ii(d),ui(),I!==null&&B(ul),I=d.flags,I&65536?(d.flags=I&-65537|128,d):null;case 24:return Ll(ai),null;case 25:return null;default:return null}}function pp(I,d){switch(oe(d),d.tag){case 3:Ll(ai),re();break;case 26:case 27:case 5:me(d);break;case 4:re();break;case 13:Ii(d);break;case 19:B(la);break;case 10:Ll(d.type);break;case 22:case 23:Ii(d),ui(),I!==null&&B(ul);break;case 24:Ll(ai)}}function _u(I,d){try{var b=d.updateQueue,S=b!==null?b.lastEffect:null;if(S!==null){var V=S.next;b=V;do{if((b.tag&I)===I){S=void 0;var K=b.create,te=b.inst;S=K(),te.destroy=S}b=b.next}while(b!==V)}}catch(he){Ln(d,d.return,he)}}function Hr(I,d,b){try{var S=d.updateQueue,V=S!==null?S.lastEffect:null;if(V!==null){var K=V.next;S=K;do{if((S.tag&I)===I){var te=S.inst,he=te.destroy;if(he!==void 0){te.destroy=void 0,V=d;var Xe=b;try{he()}catch(st){Ln(V,Xe,st)}}}S=S.next}while(S!==K)}}catch(st){Ln(d,d.return,st)}}function mp(I){var d=I.updateQueue;if(d!==null){var b=I.stateNode;try{Qe(d,b)}catch(S){Ln(I,I.return,S)}}}function rs(I,d,b){b.props=Rs(I.type,I.memoizedProps),b.state=I.memoizedState;try{b.componentWillUnmount()}catch(S){Ln(I,d,S)}}function Ho(I,d){try{var b=I.ref;if(b!==null){var S=I.stateNode;switch(I.tag){case 26:case 27:case 5:var V=Ec(S);break;default:V=S}typeof b=="function"?I.refCleanup=b(V):b.current=V}}catch(K){Ln(I,d,K)}}function gs(I,d){var b=I.ref,S=I.refCleanup;if(b!==null)if(typeof S=="function")try{S()}catch(V){Ln(I,d,V)}finally{I.refCleanup=null,I=I.alternate,I!=null&&(I.refCleanup=null)}else if(typeof b=="function")try{b(null)}catch(V){Ln(I,d,V)}else b.current=null}function HA(I){var d=I.type,b=I.memoizedProps,S=I.stateNode;try{lG(S,d,b,I)}catch(V){Ln(I,I.return,V)}}function XA(I,d,b){try{Yp(I.stateNode,I.type,b,d,I)}catch(S){Ln(I,I.return,S)}}function NA(I){return I.tag===5||I.tag===3||(Ms?I.tag===26:!1)||(Qn?I.tag===27:!1)||I.tag===4}function Uu(I){e:for(;;){for(;I.sibling===null;){if(I.return===null||NA(I.return))return null;I=I.return}for(I.sibling.return=I.return,I=I.sibling;I.tag!==5&&I.tag!==6&&(!Qn||I.tag!==27)&&I.tag!==18;){if(I.flags&2||I.child===null||I.tag===4)continue e;I.child.return=I,I=I.child}if(!(I.flags&2))return I.stateNode}}function YA(I,d,b){var S=I.tag;if(S===5||S===6)I=I.stateNode,d?Fp(b,I,d):sh(b,I);else if(!(S===4||Qn&&S===27)&&(I=I.child,I!==null))for(YA(I,d,b),I=I.sibling;I!==null;)YA(I,d,b),I=I.sibling}function _l(I,d,b){var S=I.tag;if(S===5||S===6)I=I.stateNode,d?Kp(b,I,d):Xp(b,I);else if(!(S===4||Qn&&S===27)&&(I=I.child,I!==null))for(_l(I,d,b),I=I.sibling;I!==null;)_l(I,d,b),I=I.sibling}function SC(I,d,b){I=I.containerInfo;try{_c(I,b)}catch(S){Ln(d,d.return,S)}}function Du(I,d){for(zC(I.containerInfo),tn=d;tn!==null;)if(I=tn,d=I.child,(I.subtreeFlags&1028)!==0&&d!==null)d.return=I,tn=d;else for(;tn!==null;){I=tn;var b=I.alternate;switch(d=I.flags,I.tag){case 0:break;case 11:case 15:break;case 1:if((d&1024)!==0&&b!==null){d=void 0;var S=I,V=b.memoizedProps;b=b.memoizedState;var K=S.stateNode;try{var te=Rs(S.type,V,S.elementType===S.type);d=K.getSnapshotBeforeUpdate(te,b),K.__reactInternalSnapshotBeforeUpdate=d}catch(he){Ln(S,S.return,he)}}break;case 3:(d&1024)!==0&&sa&&_p(I.stateNode.containerInfo);break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((d&1024)!==0)throw Error(i(163))}if(d=I.sibling,d!==null){d.return=I.return,tn=d;break}tn=I.return}return te=mn,mn=!1,te}function RC(I,d,b){var S=b.flags;switch(b.tag){case 0:case 11:case 15:Dl(I,b),S&4&&_u(5,b);break;case 1:if(Dl(I,b),S&4)if(I=b.stateNode,d===null)try{I.componentDidMount()}catch(he){Ln(b,b.return,he)}else{var V=Rs(b.type,d.memoizedProps);d=d.memoizedState;try{I.componentDidUpdate(V,d,I.__reactInternalSnapshotBeforeUpdate)}catch(he){Ln(b,b.return,he)}}S&64&&mp(b),S&512&&Ho(b,b.return);break;case 3:if(Dl(I,b),S&64&&(S=b.updateQueue,S!==null)){if(I=null,b.child!==null)switch(b.child.tag){case 27:case 5:I=Ec(b.child.stateNode);break;case 1:I=b.child.stateNode}try{Qe(S,I)}catch(he){Ln(b,b.return,he)}}break;case 26:if(Ms){Dl(I,b),S&512&&Ho(b,b.return);break}case 27:case 5:Dl(I,b),d===null&&S&4&&HA(b),S&512&&Ho(b,b.return);break;case 12:Dl(I,b);break;case 13:Dl(I,b),S&4&&wC(I,b);break;case 22:if(V=b.memoizedState!==null||Il,!V){d=d!==null&&d.memoizedState!==null||Wi;var K=Il,te=Wi;Il=V,(Wi=d)&&!te?kl(I,b,(b.subtreeFlags&8772)!==0):Dl(I,b),Il=K,Wi=te}S&512&&(b.memoizedProps.mode==="manual"?Ho(b,b.return):gs(b,b.return));break;default:Dl(I,b)}}function KA(I){var d=I.alternate;d!==null&&(I.alternate=null,KA(d)),I.child=null,I.deletions=null,I.sibling=null,I.tag===5&&(d=I.stateNode,d!==null&&oG(d)),I.stateNode=null,I.return=null,I.dependencies=null,I.memoizedProps=null,I.memoizedState=null,I.pendingProps=null,I.stateNode=null,I.updateQueue=null}function ba(I,d,b){for(b=b.child;b!==null;)Xr(I,d,b),b=b.sibling}function Xr(I,d,b){if(Cs&&typeof Cs.onCommitFiberUnmount=="function")try{Cs.onCommitFiberUnmount(_i,b)}catch{}switch(b.tag){case 26:if(Ms){Wi||gs(b,d),ba(I,d,b),b.memoizedState?xg(b.memoizedState):b.stateNode&&Uc(b.stateNode);break}case 27:if(Qn){Wi||gs(b,d);var S=Lt,V=In;Lt=b.stateNode,ba(I,d,b),Or(b.stateNode),Lt=S,In=V;break}case 5:Wi||gs(b,d);case 6:if(sa){if(S=Lt,V=In,Lt=null,ba(I,d,b),Lt=S,In=V,Lt!==null)if(In)try{Ep(Lt,b.stateNode)}catch(K){Ln(b,d,K)}else try{oh(Lt,b.stateNode)}catch(K){Ln(b,d,K)}}else ba(I,d,b);break;case 18:sa&&Lt!==null&&(In?rI(Lt,b.stateNode):$p(Lt,b.stateNode));break;case 4:sa?(S=Lt,V=In,Lt=b.stateNode.containerInfo,In=!0,ba(I,d,b),Lt=S,In=V):(uo&&SC(b.stateNode,b,lI()),ba(I,d,b));break;case 0:case 11:case 14:case 15:Wi||Hr(2,b,d),Wi||Hr(4,b,d),ba(I,d,b);break;case 1:Wi||(gs(b,d),S=b.stateNode,typeof S.componentWillUnmount=="function"&&rs(b,d,S)),ba(I,d,b);break;case 21:ba(I,d,b);break;case 22:Wi||gs(b,d),Wi=(S=Wi)||b.memoizedState!==null,ba(I,d,b),Wi=S;break;default:ba(I,d,b)}}function wC(I,d){if(Ba&&d.memoizedState===null&&(I=d.alternate,I!==null&&(I=I.memoizedState,I!==null&&(I=I.dehydrated,I!==null))))try{uG(I)}catch(b){Ln(d,d.return,b)}}function bp(I){switch(I.tag){case 13:case 19:var d=I.stateNode;return d===null&&(d=I.stateNode=new _n),d;case 22:return I=I.stateNode,d=I._retryCache,d===null&&(d=I._retryCache=new _n),d;default:throw Error(i(435,I.tag))}}function Ul(I,d){var b=bp(I);d.forEach(function(S){var V=zr.bind(null,I,S);b.has(S)||(b.add(S),S.then(V,V))})}function La(I,d){var b=d.deletions;if(b!==null)for(var S=0;S<b.length;S++){var V=b[S],K=I,te=d;if(sa){var he=te;e:for(;he!==null;){switch(he.tag){case 27:case 5:Lt=he.stateNode,In=!1;break e;case 3:Lt=he.stateNode.containerInfo,In=!0;break e;case 4:Lt=he.stateNode.containerInfo,In=!0;break e}he=he.return}if(Lt===null)throw Error(i(160));Xr(K,te,V),Lt=null,In=!1}else Xr(K,te,V);K=V.alternate,K!==null&&(K.return=null),V.return=null}if(d.subtreeFlags&13878)for(d=d.child;d!==null;)FA(d,I),d=d.sibling}function FA(I,d){var b=I.alternate,S=I.flags;switch(I.tag){case 0:case 11:case 14:case 15:La(d,I),cs(I),S&4&&(Hr(3,I,I.return),_u(3,I),Hr(5,I,I.return));break;case 1:La(d,I),cs(I),S&512&&(Wi||b===null||gs(b,b.return)),S&64&&Il&&(I=I.updateQueue,I!==null&&(S=I.callbacks,S!==null&&(b=I.shared.hiddenCallbacks,I.shared.hiddenCallbacks=b===null?S:b.concat(S))));break;case 26:if(Ms){var V=Gi;La(d,I),cs(I),S&512&&(Wi||b===null||gs(b,b.return)),S&4&&(S=b!==null?b.memoizedState:null,d=I.memoizedState,b===null?d===null?I.stateNode===null?I.stateNode=cI(V,I.type,I.memoizedProps,I):uI(V,I.type,I.stateNode):I.stateNode=tm(V,d,I.memoizedProps):S!==d?(S===null?b.stateNode!==null&&Uc(b.stateNode):xg(S),d===null?uI(V,I.type,I.stateNode):tm(V,d,I.memoizedProps)):d===null&&I.stateNode!==null&&XA(I,I.memoizedProps,b.memoizedProps));break}case 27:if(Qn&&S&4&&I.alternate===null){V=I.stateNode;var K=I.memoizedProps;try{kr(V),sm(I.type,K,V,I)}catch(pt){Ln(I,I.return,pt)}}case 5:if(La(d,I),cs(I),S&512&&(Wi||b===null||gs(b,b.return)),sa){if(I.flags&32){d=I.stateNode;try{lh(d)}catch(pt){Ln(I,I.return,pt)}}S&4&&I.stateNode!=null&&(d=I.memoizedProps,XA(I,d,b!==null?b.memoizedProps:d)),S&1024&&(mh=!0)}break;case 6:if(La(d,I),cs(I),S&4&&sa){if(I.stateNode===null)throw Error(i(162));S=I.memoizedProps,b=b!==null?b.memoizedProps:S,d=I.stateNode;try{Np(d,b,S)}catch(pt){Ln(I,I.return,pt)}}break;case 3:if(Ms?(nm(),V=Gi,Gi=jC(d.containerInfo),La(d,I),Gi=V):La(d,I),cs(I),S&4){if(sa&&Ba&&b!==null&&b.memoizedState.isDehydrated)try{cG(d.containerInfo)}catch(pt){Ln(I,I.return,pt)}if(uo){S=d.containerInfo,b=d.pendingChildren;try{_c(S,b)}catch(pt){Ln(I,I.return,pt)}}}mh&&(mh=!1,yp(I));break;case 4:Ms?(b=Gi,Gi=jC(I.stateNode.containerInfo),La(d,I),cs(I),Gi=b):(La(d,I),cs(I)),S&4&&uo&&SC(I.stateNode,I,I.stateNode.pendingChildren);break;case 12:La(d,I),cs(I);break;case 13:La(d,I),cs(I),I.child.flags&8192&&I.memoizedState!==null!=(b!==null&&b.memoizedState!==null)&&(Ja=Io()),S&4&&(S=I.updateQueue,S!==null&&(I.updateQueue=null,Ul(I,S)));break;case 22:S&512&&(Wi||b===null||gs(b,b.return)),V=I.memoizedState!==null;var te=b!==null&&b.memoizedState!==null,he=Il,Xe=Wi;if(Il=he||V,Wi=Xe||te,La(d,I),Wi=Xe,Il=he,cs(I),d=I.stateNode,d._current=I,d._visibility&=-3,d._visibility|=d._pendingVisibility&2,S&8192&&(d._visibility=V?d._visibility&-2:d._visibility|1,V&&(d=Il||Wi,b===null||te||d||wc(I)),sa&&(I.memoizedProps===null||I.memoizedProps.mode!=="manual"))){e:if(b=null,sa)for(d=I;;){if(d.tag===5||Ms&&d.tag===26||Qn&&d.tag===27){if(b===null){te=b=d;try{K=te.stateNode,V?Tp(K):Lp(te.stateNode,te.memoizedProps)}catch(pt){Ln(te,te.return,pt)}}}else if(d.tag===6){if(b===null){te=d;try{var st=te.stateNode;V?zp(st):rG(st,te.memoizedProps)}catch(pt){Ln(te,te.return,pt)}}}else if((d.tag!==22&&d.tag!==23||d.memoizedState===null||d===I)&&d.child!==null){d.child.return=d,d=d.child;continue}if(d===I)break e;for(;d.sibling===null;){if(d.return===null||d.return===I)break e;b===d&&(b=null),d=d.return}b===d&&(b=null),d.sibling.return=d.return,d=d.sibling}}S&4&&(S=I.updateQueue,S!==null&&(b=S.retryQueue,b!==null&&(S.retryQueue=null,Ul(I,b))));break;case 19:La(d,I),cs(I),S&4&&(S=I.updateQueue,S!==null&&(I.updateQueue=null,Ul(I,S)));break;case 21:break;default:La(d,I),cs(I)}}function cs(I){var d=I.flags;if(d&2){try{if(sa&&(!Qn||I.tag!==27)){e:{for(var b=I.return;b!==null;){if(NA(b)){var S=b;break e}b=b.return}throw Error(i(160))}switch(S.tag){case 27:if(Qn){var V=S.stateNode,K=Uu(I);_l(I,K,V);break}case 5:var te=S.stateNode;S.flags&32&&(lh(te),S.flags&=-33);var he=Uu(I);_l(I,he,te);break;case 3:case 4:var Xe=S.stateNode.containerInfo,st=Uu(I);YA(I,st,Xe);break;default:throw Error(i(161))}}}catch(pt){Ln(I,I.return,pt)}I.flags&=-3}d&4096&&(I.flags&=-4097)}function yp(I){if(I.subtreeFlags&1024)for(I=I.child;I!==null;){var d=I;yp(d),d.tag===5&&d.flags&1024&&UC(d.stateNode),I=I.sibling}}function Dl(I,d){if(d.subtreeFlags&8772)for(d=d.child;d!==null;)RC(I,d.alternate,d),d=d.sibling}function wc(I){for(I=I.child;I!==null;){var d=I;switch(d.tag){case 0:case 11:case 14:case 15:Hr(4,d,d.return),wc(d);break;case 1:gs(d,d.return);var b=d.stateNode;typeof b.componentWillUnmount=="function"&&rs(d,d.return,b),wc(d);break;case 26:case 27:case 5:gs(d,d.return),wc(d);break;case 22:gs(d,d.return),d.memoizedState===null&&wc(d);break;default:wc(d)}I=I.sibling}}function kl(I,d,b){for(b=b&&(d.subtreeFlags&8772)!==0,d=d.child;d!==null;){var S=d.alternate,V=I,K=d,te=K.flags;switch(K.tag){case 0:case 11:case 15:kl(V,K,b),_u(4,K);break;case 1:if(kl(V,K,b),S=K,V=S.stateNode,typeof V.componentDidMount=="function")try{V.componentDidMount()}catch(st){Ln(S,S.return,st)}if(S=K,V=S.updateQueue,V!==null){var he=S.stateNode;try{var Xe=V.shared.hiddenCallbacks;if(Xe!==null)for(V.shared.hiddenCallbacks=null,V=0;V<Xe.length;V++)Ie(Xe[V],he)}catch(st){Ln(S,S.return,st)}}b&&te&64&&mp(K),Ho(K,K.return);break;case 26:case 27:case 5:kl(V,K,b),b&&S===null&&te&4&&HA(K),Ho(K,K.return);break;case 12:kl(V,K,b);break;case 13:kl(V,K,b),b&&te&4&&wC(V,K);break;case 22:K.memoizedState===null&&kl(V,K,b),Ho(K,K.return);break;default:kl(V,K,b)}d=d.sibling}}function xC(I,d){var b=null;I!==null&&I.memoizedState!==null&&I.memoizedState.cachePool!==null&&(b=I.memoizedState.cachePool.pool),I=null,d.memoizedState!==null&&d.memoizedState.cachePool!==null&&(I=d.memoizedState.cachePool.pool),I!==b&&(I!=null&&I.refCount++,b!=null&&zu(b))}function ku(I,d){I=null,d.alternate!==null&&(I=d.alternate.memoizedState.cache),d=d.memoizedState.cache,d!==I&&(d.refCount++,I!=null&&zu(I))}function ua(I,d,b,S){if(d.subtreeFlags&10256)for(d=d.child;d!==null;)EA(I,d,b,S),d=d.sibling}function EA(I,d,b,S){var V=d.flags;switch(d.tag){case 0:case 11:case 15:ua(I,d,b,S),V&2048&&_u(9,d);break;case 3:ua(I,d,b,S),V&2048&&(I=null,d.alternate!==null&&(I=d.alternate.memoizedState.cache),d=d.memoizedState.cache,d!==I&&(d.refCount++,I!=null&&zu(I)));break;case 12:if(V&2048){ua(I,d,b,S),I=d.stateNode;try{var K=d.memoizedProps,te=K.id,he=K.onPostCommit;typeof he=="function"&&he(te,d.alternate===null?"mount":"update",I.passiveEffectDuration,-0)}catch(Xe){Ln(d,d.return,Xe)}}else ua(I,d,b,S);break;case 23:break;case 22:K=d.stateNode,d.memoizedState!==null?K._visibility&4?ua(I,d,b,S):Va(I,d):K._visibility&4?ua(I,d,b,S):(K._visibility|=4,ya(I,d,b,S,(d.subtreeFlags&10256)!==0)),V&2048&&xC(d.alternate,d);break;case 24:ua(I,d,b,S),V&2048&&ku(d.alternate,d);break;default:ua(I,d,b,S)}}function ya(I,d,b,S,V){for(V=V&&(d.subtreeFlags&10256)!==0,d=d.child;d!==null;){var K=I,te=d,he=b,Xe=S,st=te.flags;switch(te.tag){case 0:case 11:case 15:ya(K,te,he,Xe,V),_u(8,te);break;case 23:break;case 22:var pt=te.stateNode;te.memoizedState!==null?pt._visibility&4?ya(K,te,he,Xe,V):Va(K,te):(pt._visibility|=4,ya(K,te,he,Xe,V)),V&&st&2048&&xC(te.alternate,te);break;case 24:ya(K,te,he,Xe,V),V&&st&2048&&ku(te.alternate,te);break;default:ya(K,te,he,Xe,V)}d=d.sibling}}function Va(I,d){if(d.subtreeFlags&10256)for(d=d.child;d!==null;){var b=I,S=d,V=S.flags;switch(S.tag){case 22:Va(b,S),V&2048&&xC(S.alternate,S);break;case 24:Va(b,S),V&2048&&ku(S.alternate,S);break;default:Va(b,S)}d=d.sibling}}function oo(I){if(I.subtreeFlags&Es)for(I=I.child;I!==null;)WC(I),I=I.sibling}function WC(I){switch(I.tag){case 26:oo(I),I.flags&Es&&(I.memoizedState!==null?am(Gi,I.memoizedState,I.memoizedProps):Da(I.type,I.memoizedProps));break;case 5:oo(I),I.flags&Es&&Da(I.type,I.memoizedProps);break;case 3:case 4:if(Ms){var d=Gi;Gi=jC(I.stateNode.containerInfo),oo(I),Gi=d}else oo(I);break;case 22:I.memoizedState===null&&(d=I.alternate,d!==null&&d.memoizedState!==null?(d=Es,Es=16777216,oo(I),Es=d):oo(I));break;default:oo(I)}}function Ou(I){var d=I.alternate;if(d!==null&&(I=d.child,I!==null)){d.child=null;do d=I.sibling,I.sibling=null,I=d;while(I!==null)}}function Nr(I){var d=I.deletions;if((I.flags&16)!==0){if(d!==null)for(var b=0;b<d.length;b++){var S=d[b];tn=S,TA(S,I)}Ou(I)}if(I.subtreeFlags&10256)for(I=I.child;I!==null;)VC(I),I=I.sibling}function VC(I){switch(I.tag){case 0:case 11:case 15:Nr(I),I.flags&2048&&Hr(9,I,I.return);break;case 3:Nr(I);break;case 12:Nr(I);break;case 22:var d=I.stateNode;I.memoizedState!==null&&d._visibility&4&&(I.return===null||I.return.tag!==13)?(d._visibility&=-5,Ol(I)):Nr(I);break;default:Nr(I)}}function Ol(I){var d=I.deletions;if((I.flags&16)!==0){if(d!==null)for(var b=0;b<d.length;b++){var S=d[b];tn=S,TA(S,I)}Ou(I)}for(I=I.child;I!==null;){switch(d=I,d.tag){case 0:case 11:case 15:Hr(8,d,d.return),Ol(d);break;case 22:b=d.stateNode,b._visibility&4&&(b._visibility&=-5,Ol(d));break;default:Ol(d)}I=I.sibling}}function TA(I,d){for(;tn!==null;){var b=tn;switch(b.tag){case 0:case 11:case 15:Hr(8,b,d);break;case 23:case 22:if(b.memoizedState!==null&&b.memoizedState.cachePool!==null){var S=b.memoizedState.cachePool.pool;S!=null&&S.refCount++}break;case 24:zu(b.memoizedState.cache)}if(S=b.child,S!==null)S.return=b,tn=S;else e:for(b=I;tn!==null;){S=tn;var V=S.sibling,K=S.return;if(KA(S),S===b){tn=null;break e}if(V!==null){V.return=K,tn=V;break e}tn=K}}}function xc(I){var d=Rp(I);if(d!=null){if(typeof d.memoizedProps["data-testname"]!="string")throw Error(i(364));return d}if(I=ih(I),I===null)throw Error(i(362));return I.stateNode.current}function Yr(I,d){var b=I.tag;switch(d.$$typeof){case $c:if(I.type===d.value)return!0;break;case fo:e:{for(d=d.value,I=[I,0],b=0;b<I.length;){var S=I[b++],V=S.tag,K=I[b++],te=d[K];if(V!==5&&V!==26&&V!==27||!zc(S)){for(;te!=null&&Yr(S,te);)K++,te=d[K];if(K===d.length){d=!0;break e}else for(S=S.child;S!==null;)I.push(S,K),S=S.sibling}}d=!1}return d;case di:if((b===5||b===26||b===27)&&Vp(I.stateNode,d.value))return!0;break;case Cl:if((b===5||b===6||b===26||b===27)&&(I=Wp(I),I!==null&&0<=I.indexOf(d.value)))return!0;break;case _o:if((b===5||b===26||b===27)&&(I=I.memoizedProps["data-testname"],typeof I=="string"&&I.toLowerCase()===d.value.toLowerCase()))return!0;break;default:throw Error(i(365))}return!1}function zA(I){switch(I.$$typeof){case $c:return"<"+(o(I.value)||"Unknown")+">";case fo:return":has("+(zA(I)||"")+")";case di:return'[role="'+I.value+'"]';case Cl:return'"'+I.value+'"';case _o:return'[data-testname="'+I.value+'"]';default:throw Error(i(365))}}function us(I,d){var b=[];I=[I,0];for(var S=0;S<I.length;){var V=I[S++],K=V.tag,te=I[S++],he=d[te];if(K!==5&&K!==26&&K!==27||!zc(V)){for(;he!=null&&Yr(V,he);)te++,he=d[te];if(te===d.length)b.push(V);else for(V=V.child;V!==null;)I.push(V,te),V=V.sibling}}return b}function Ju(I,d){if(!Dr)throw Error(i(363));I=xc(I),I=us(I,d),d=[],I=Array.from(I);for(var b=0;b<I.length;){var S=I[b++],V=S.tag;if(V===5||V===26||V===27)zc(S)||d.push(S.stateNode);else for(S=S.child;S!==null;)I.push(S),S=S.sibling}return d}function Ti(){if((Vn&2)!==0&&vn!==0)return vn&-vn;if(Pt.T!==null){var I=Ns;return I!==0?I:Ge()}return wp()}function LA(){Ls===0&&(Ls=(vn&536870912)===0||xn?F():536870912);var I=Ys.current;return I!==null&&(I.flags|=32),Ls}function Ia(I,d,b){(I===Un&&On===2||I.cancelPendingCommit!==null)&&(Ga(I,0),Is(I,vn,Ls,!1)),U(I,b),((Vn&2)===0||I!==Un)&&(I===Un&&((Vn&2)===0&&(lr|=b),$n===4&&Is(I,vn,Ls,!1)),Me(I))}function Kr(I,d,b){if((Vn&6)!==0)throw Error(i(327));var S=!b&&(d&60)===0&&(d&I.expiredLanes)===0||H(I,d),V=S?UA(I,d):HC(I,d,!0),K=S;do{if(V===0){Ts&&!S&&Is(I,d,0,!1);break}else if(V===6)Is(I,d,0,!mo);else{if(b=I.current.alternate,K&&!Wc(b)){V=HC(I,d,!1),K=!1;continue}if(V===2){if(K=d,I.errorRecoveryDisabledLanes&K)var te=0;else te=I.pendingLanes&-536870913,te=te!==0?te:te&536870912?536870912:0;if(te!==0){d=te;e:{var he=I;V=Ug;var Xe=Ba&&he.current.memoizedState.isDehydrated;if(Xe&&(Ga(he,te).flags|=256),te=HC(he,te,!1),te!==2){if(ra&&!Xe){he.errorRecoveryDisabledLanes|=K,lr|=K,V=4;break e}K=Vi,Vi=V,K!==null&&Pu(K)}V=te}if(K=!1,V!==2)continue}}if(V===1){Ga(I,0),Is(I,d,0,!0);break}e:{switch(S=I,V){case 0:case 1:throw Error(i(345));case 4:if((d&4194176)===d){Is(S,d,Ls,!mo);break e}break;case 2:Vi=null;break;case 3:case 5:break;default:throw Error(i(329))}if(S.finishedWork=b,S.finishedLanes=d,(d&62914560)===d&&(K=Ja+300-Io(),10<K)){if(Is(S,d,Ls,!mo),M(S,0)!==0)break e;S.timeoutHandle=qi(MC.bind(null,S,b,Vi,pI,rd,d,Ls,lr,dl,mo,2,-0,0),K);break e}MC(S,b,Vi,pI,rd,d,Ls,lr,dl,mo,0,-0,0)}}break}while(!0);Me(I)}function Pu(I){Vi===null?Vi=I:Vi.push.apply(Vi,I)}function MC(I,d,b,S,V,K,te,he,Xe,st,pt,St,wt){var nn=d.subtreeFlags;if((nn&8192||(nn&16785408)===16785408)&&(th(),WC(d),d=$i(),d!==null)){I.cancelPendingCommit=d(Er.bind(null,I,b,S,V,te,he,Xe,1,St,wt)),Is(I,K,te,!st);return}Er(I,b,S,V,te,he,Xe,pt,St,wt)}function Wc(I){for(var d=I;;){var b=d.tag;if((b===0||b===11||b===15)&&d.flags&16384&&(b=d.updateQueue,b!==null&&(b=b.stores,b!==null)))for(var S=0;S<b.length;S++){var V=b[S],K=V.getSnapshot;V=V.value;try{if(!ds(K(),V))return!1}catch{return!1}}if(b=d.child,d.subtreeFlags&16384&&b!==null)b.return=d,d=b;else{if(d===I)break;for(;d.sibling===null;){if(d.return===null||d.return===I)return!0;d=d.return}d.sibling.return=d.return,d=d.sibling}}return!0}function Is(I,d,b,S){d&=~fI,d&=~lr,I.suspendedLanes|=d,I.pingedLanes&=~d,S&&(I.warmLanes|=d),S=I.expirationTimes;for(var V=d;0<V;){var K=31-ka(V),te=1<<K;S[K]=-1,V&=~te}b!==0&&P(I,b,d)}function Qu(){return(Vn&6)===0?(Ze(0),!1):!0}function Vc(){if(Ut!==null){if(On===0)var I=Ut.return;else I=Ut,Fs=Lo=null,ts(I),jr=null,qr=0,I=Ut;for(;I!==null;)pp(I.alternate,I),I=I.return;Ut=null}}function Ga(I,d){I.finishedWork=null,I.finishedLanes=0;var b=I.timeoutHandle;b!==_r&&(I.timeoutHandle=_r,LC(b)),b=I.cancelPendingCommit,b!==null&&(I.cancelPendingCommit=null,b()),Vc(),Un=I,Ut=b=ro(I.current,null),vn=d,On=0,Ha=null,mo=!1,Ts=H(I,d),ra=!1,dl=Ls=fI=lr=zs=$n=0,Vi=Ug=null,rd=!1,(d&8)!==0&&(d|=d&32);var S=I.entangledLanes;if(S!==0)for(I=I.entanglements,S&=d;0<S;){var V=31-ka(S),K=1<<V;d|=I[V],S&=~K}return Xa=d,q(),b}function xs(I,d){dn=null,Pt.H=xi,d===Pc?(d=ht(),On=3):d===AI?(d=ht(),On=4):On=d===od?8:d!==null&&typeof d=="object"&&typeof d.then=="function"?6:1,Ha=d,Ut===null&&($n=1,ao(I,se(d,I.current)))}function Fr(){var I=Ys.current;return I===null?!0:(vn&4194176)===vn?jn===null:(vn&62914560)===vn||(vn&536870912)!==0?I===jn:!1}function tl(){var I=Pt.H;return Pt.H=xi,I===null?xi:I}function nl(){var I=Pt.A;return Pt.A=qc,I}function Jl(){$n=4,mo||(vn&4194176)!==vn&&Ys.current!==null||(Ts=!0),(zs&134217727)===0&&(lr&134217727)===0||Un===null||Is(Un,vn,Ls,!1)}function HC(I,d,b){var S=Vn;Vn|=2;var V=tl(),K=nl();(Un!==I||vn!==d)&&(pI=null,Ga(I,d)),d=!1;var te=$n;e:do try{if(On!==0&&Ut!==null){var he=Ut,Xe=Ha;switch(On){case 8:Vc(),te=6;break e;case 3:case 2:case 6:Ys.current===null&&(d=!0);var st=On;if(On=0,Ha=null,lo(I,he,Xe,st),b&&Ts){te=0;break e}break;default:st=On,On=0,Ha=null,lo(I,he,Xe,st)}}_A(),te=$n;break}catch(pt){xs(I,pt)}while(!0);return d&&I.shellSuspendCounter++,Fs=Lo=null,Vn=S,Pt.H=V,Pt.A=K,Ut===null&&(Un=null,vn=0,q()),te}function _A(){for(;Ut!==null;)yi(Ut)}function UA(I,d){var b=Vn;Vn|=2;var S=tl(),V=nl();Un!==I||vn!==d?(pI=null,eu=Io()+500,Ga(I,d)):Ts=H(I,d);e:do try{if(On!==0&&Ut!==null){d=Ut;var K=Ha;t:switch(On){case 1:On=0,Ha=null,lo(I,d,K,1);break;case 2:if(mt(K)){On=0,Ha=null,Xn(d);break}d=function(){On===2&&Un===I&&(On=7),Me(I)},K.then(d,d);break e;case 3:On=7;break e;case 4:On=5;break e;case 7:mt(K)?(On=0,Ha=null,Xn(d)):(On=0,Ha=null,lo(I,d,K,7));break;case 5:var te=null;switch(Ut.tag){case 26:te=Ut.memoizedState;case 5:case 27:var he=Ut,Xe=he.type,st=he.pendingProps;if(te?Wg(te):_C(Xe,st)){On=0,Ha=null;var pt=he.sibling;if(pt!==null)Ut=pt;else{var St=he.return;St!==null?(Ut=St,Ws(St)):Ut=null}break t}}On=0,Ha=null,lo(I,d,K,5);break;case 6:On=0,Ha=null,lo(I,d,K,6);break;case 8:Vc(),$n=6;break e;default:throw Error(i(462))}}_a();break}catch(wt){xs(I,wt)}while(!0);return Fs=Lo=null,Pt.H=S,Pt.A=V,Vn=b,Ut!==null?0:(Un=null,vn=0,q(),$n)}function _a(){for(;Ut!==null&&!rm();)yi(Ut)}function yi(I){var d=Ap(I.alternate,I,Xa);I.memoizedProps=I.pendingProps,d===null?Ws(I):Ut=d}function Xn(I){var d=I,b=d.alternate;switch(d.tag){case 15:case 0:d=Nu(b,d,d.pendingProps,d.type,void 0,vn);break;case 11:d=Nu(b,d,d.pendingProps,d.type.render,d.ref,vn);break;case 5:ts(d);default:pp(b,d),d=Ut=qu(d,Xa),d=Ap(b,d,Xa)}I.memoizedProps=I.pendingProps,d===null?Ws(I):Ut=d}function lo(I,d,b,S){Fs=Lo=null,ts(d),jr=null,qr=0;var V=d.return;try{if(vA(I,V,d,b,vn)){$n=1,ao(I,se(b,I.current)),Ut=null;return}}catch(K){if(V!==null)throw Ut=V,K;$n=1,ao(I,se(b,I.current)),Ut=null;return}d.flags&32768?(xn||S===1?I=!0:Ts||(vn&536870912)!==0?I=!1:(mo=I=!0,(S===2||S===3||S===6)&&(S=Ys.current,S!==null&&S.tag===13&&(S.flags|=16384))),XC(d,I)):Ws(d)}function Ws(I){var d=I;do{if((d.flags&32768)!==0){XC(d,mo);return}I=d.return;var b=fp(d.alternate,d,Xa);if(b!==null){Ut=b;return}if(d=d.sibling,d!==null){Ut=d;return}Ut=d=I}while(d!==null);$n===0&&($n=5)}function XC(I,d){do{var b=iG(I.alternate,I);if(b!==null){b.flags&=32767,Ut=b;return}if(b=I.return,b!==null&&(b.flags|=32768,b.subtreeFlags=0,b.deletions=null),!d&&(I=I.sibling,I!==null)){Ut=I;return}Ut=I=b}while(I!==null);$n=6,Ut=null}function Er(I,d,b,S,V,K,te,he,Xe,st){var pt=Pt.T,St=er();try{Ma(2),Pt.T=null,Gp(I,d,b,S,St,V,K,te,he,Xe,st)}finally{Pt.T=pt,Ma(St)}}function Gp(I,d,b,S,V,K,te,he){do Xo();while(Al!==null);if((Vn&6)!==0)throw Error(i(327));var Xe=I.finishedWork;if(S=I.finishedLanes,Xe===null)return null;if(I.finishedWork=null,I.finishedLanes=0,Xe===I.current)throw Error(i(177));I.callbackNode=null,I.callbackPriority=0,I.cancelPendingCommit=null;var st=Xe.lanes|Xe.childLanes;if(st|=To,O(I,S,st,K,te,he),I===Un&&(Ut=Un=null,vn=0),(Xe.subtreeFlags&10256)===0&&(Xe.flags&10256)===0||Uo||(Uo=!0,ig=st,gd=b,Ql(nd,function(){return Xo(),null})),b=(Xe.flags&15990)!==0,(Xe.subtreeFlags&15990)!==0||b?(b=Pt.T,Pt.T=null,K=er(),Ma(2),te=Vn,Vn|=4,Du(I,Xe),FA(Xe,I),Sp(I.containerInfo),I.current=Xe,RC(I,Xe.alternate,Xe),ed(),Vn=te,Ma(K),Pt.T=b):I.current=Xe,Uo?(Uo=!1,Al=I,Dg=S):DA(I,st),st=I.pendingLanes,st===0&&(ng=null),T(Xe.stateNode),Me(I),d!==null)for(V=I.onRecoverableError,Xe=0;Xe<d.length;Xe++)st=d[Xe],V(st.value,{componentStack:st.stack});return(Dg&3)!==0&&Xo(),st=I.pendingLanes,(S&4194218)!==0&&(st&42)!==0?I===cd?tu++:(tu=0,cd=I):tu=0,Ze(0),null}function DA(I,d){(I.pooledCacheLanes&=d)===0&&(d=I.pooledCache,d!=null&&(I.pooledCache=null,zu(d)))}function Xo(){if(Al!==null){var I=Al,d=ig;ig=0;var b=le(Dg),S=32>b?32:b;b=Pt.T;var V=er();try{if(Ma(S),Pt.T=null,Al===null)var K=!1;else{S=gd,gd=null;var te=Al,he=Dg;if(Al=null,Dg=0,(Vn&6)!==0)throw Error(i(331));var Xe=Vn;if(Vn|=4,VC(te.current),EA(te,te.current,he,S),Vn=Xe,Ze(0,!1),Cs&&typeof Cs.onPostCommitFiberRoot=="function")try{Cs.onPostCommitFiberRoot(_i,te)}catch{}K=!0}return K}finally{Ma(V),Pt.T=b,DA(I,d)}}return!1}function Mc(I,d,b){d=se(b,d),d=so(I.stateNode,d,2),I=tt(I,d,2),I!==null&&(U(I,2),Me(I))}function Ln(I,d,b){if(I.tag===3)Mc(I,I,b);else for(;d!==null;){if(d.tag===3){Mc(d,I,b);break}else if(d.tag===1){var S=d.stateNode;if(typeof d.type.getDerivedStateFromError=="function"||typeof S.componentDidCatch=="function"&&(ng===null||!ng.has(S))){I=se(b,I),b=vg(2),S=tt(d,b,2),S!==null&&(Wa(b,S,d,I),U(S,2),Me(S));break}}d=d.return}}function Rg(I,d,b){var S=I.pingCache;if(S===null){S=I.pingCache=new po;var V=new Set;S.set(d,V)}else V=S.get(d),V===void 0&&(V=new Set,S.set(d,V));V.has(b)||(ra=!0,V.add(b),I=kA.bind(null,I,d,b),d.then(I,I))}function kA(I,d,b){var S=I.pingCache;S!==null&&S.delete(d),I.pingedLanes|=I.suspendedLanes&b,I.warmLanes&=~b,Un===I&&(vn&b)===b&&($n===4||$n===3&&(vn&62914560)===vn&&300>Io()-Ja?(Vn&2)===0&&Ga(I,0):fI|=b,dl===vn&&(dl=0)),Me(I)}function Tr(I,d){d===0&&(d=Y()),I=Ee(I,d),I!==null&&(U(I,d),Me(I))}function Pl(I){var d=I.memoizedState,b=0;d!==null&&(b=d.retryLane),Tr(I,b)}function zr(I,d){var b=0;switch(I.tag){case 13:var S=I.stateNode,V=I.memoizedState;V!==null&&(b=V.retryLane);break;case 19:S=I.stateNode;break;case 22:S=I.stateNode._retryCache;break;default:throw Error(i(314))}S!==null&&S.delete(d),Tr(I,b)}function Ql(I,d){return II(I,d)}function OA(I,d,b,S){this.tag=I,this.key=b,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=d,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=S,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function ju(I){return I=I.prototype,!(!I||!I.isReactComponent)}function ro(I,d){var b=I.alternate;return b===null?(b=t(I.tag,d,I.key,I.mode),b.elementType=I.elementType,b.type=I.type,b.stateNode=I.stateNode,b.alternate=I,I.alternate=b):(b.pendingProps=d,b.type=I.type,b.flags=0,b.subtreeFlags=0,b.deletions=null),b.flags=I.flags&31457280,b.childLanes=I.childLanes,b.lanes=I.lanes,b.child=I.child,b.memoizedProps=I.memoizedProps,b.memoizedState=I.memoizedState,b.updateQueue=I.updateQueue,d=I.dependencies,b.dependencies=d===null?null:{lanes:d.lanes,firstContext:d.firstContext},b.sibling=I.sibling,b.index=I.index,b.ref=I.ref,b.refCleanup=I.refCleanup,b}function qu(I,d){I.flags&=31457282;var b=I.alternate;return b===null?(I.childLanes=0,I.lanes=d,I.child=null,I.subtreeFlags=0,I.memoizedProps=null,I.memoizedState=null,I.updateQueue=null,I.dependencies=null,I.stateNode=null):(I.childLanes=b.childLanes,I.lanes=b.lanes,I.child=b.child,I.subtreeFlags=0,I.deletions=null,I.memoizedProps=b.memoizedProps,I.memoizedState=b.memoizedState,I.updateQueue=b.updateQueue,I.type=b.type,d=b.dependencies,I.dependencies=d===null?null:{lanes:d.lanes,firstContext:d.firstContext}),I}function il(I,d,b,S,V,K){var te=0;if(S=I,typeof I=="function")ju(I)&&(te=1);else if(typeof I=="string")te=Ms&&Qn?gI(I,b,oa.current)?26:sl(I)?27:5:Ms?gI(I,b,oa.current)?26:5:Qn&&sl(I)?27:5;else e:switch(I){case Lr:return wi(b.children,V,K,d);case nI:te=8,V|=24;break;case FC:return I=t(12,b,d,V|2),I.elementType=FC,I.lanes=K,I;case EC:return I=t(13,b,d,V),I.elementType=EC,I.lanes=K,I;case Yc:return I=t(19,b,d,V),I.elementType=Yc,I.lanes=K,I;case QA:return $u(b,V,K,d);default:if(typeof I=="object"&&I!==null)switch(I.$$typeof){case iI:case No:te=10;break e;case PA:te=9;break e;case aI:te=11;break e;case TC:te=14;break e;case co:te=16,S=null;break e}te=29,b=Error(i(130,I===null?"null":typeof I,"")),S=null}return d=t(te,b,d,V),d.elementType=I,d.type=S,d.lanes=K,d}function wi(I,d,b,S){return I=t(7,I,S,d),I.lanes=b,I}function $u(I,d,b,S){I=t(22,I,S,d),I.elementType=QA,I.lanes=b;var V={_visibility:1,_pendingVisibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null,_current:null,detach:function(){var K=V._current;if(K===null)throw Error(i(456));if((V._pendingVisibility&2)===0){var te=Ee(K,2);te!==null&&(V._pendingVisibility|=2,Ia(te,K,2))}},attach:function(){var K=V._current;if(K===null)throw Error(i(456));if((V._pendingVisibility&2)!==0){var te=Ee(K,2);te!==null&&(V._pendingVisibility&=-3,Ia(te,K,2))}}};return I.stateNode=V,I}function NC(I,d,b){return I=t(6,I,null,d),I.lanes=b,I}function JA(I,d,b){return d=t(4,I.children!==null?I.children:[],I.key,d),d.lanes=b,d.stateNode={containerInfo:I.containerInfo,pendingChildren:null,implementation:I.implementation},d}function aG(I,d,b,S,V,K,te,he){this.tag=1,this.containerInfo=I,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=_r,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=X(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.finishedLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=X(0),this.hiddenUpdates=X(null),this.identifierPrefix=S,this.onUncaughtError=V,this.onCaughtError=K,this.onRecoverableError=te,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=he,this.incompleteTransitions=new Map}function Bp(I,d,b,S,V,K,te,he,Xe,st,pt,St){return I=new aG(I,d,b,te,he,Xe,st,St),d=1,K===!0&&(d|=24),K=t(3,null,null,d),I.current=K,K.stateNode=I,d=Mr(),d.refCount++,I.pooledCache=d,d.refCount++,K.memoizedState={element:S,isDehydrated:b,cache:d},Ct(K),I}function ji(I){return I?(I=Jr,I):Jr}function YC(I){var d=I._reactInternals;if(d===void 0)throw typeof I.render=="function"?Error(i(188)):(I=Object.keys(I).join(","),Error(i(268,I)));return I=p(d),I=I!==null?y(I):null,I===null?null:Ec(I.stateNode)}function Hc(I,d,b,S,V,K){V=ji(V),S.context===null?S.context=V:S.pendingContext=V,S=Ne(d),S.payload={element:b},K=K===void 0?null:K,K!==null&&(S.callback=K),b=tt(I,S,d),b!==null&&(Ia(b,I,d),nt(b,I,d))}function Xc(I,d){if(I=I.memoizedState,I!==null&&I.dehydrated!==null){var b=I.retryLane;I.retryLane=b!==0&&b<d?b:d}}function eI(I,d){Xc(I,d),(I=I.alternate)&&Xc(I,d)}var an={},Nc=uA(),Vs=pL(),KC=Object.assign,sG=Symbol.for("react.element"),tI=Symbol.for("react.transitional.element"),go=Symbol.for("react.portal"),Lr=Symbol.for("react.fragment"),nI=Symbol.for("react.strict_mode"),FC=Symbol.for("react.profiler"),iI=Symbol.for("react.provider"),PA=Symbol.for("react.consumer"),No=Symbol.for("react.context"),aI=Symbol.for("react.forward_ref"),EC=Symbol.for("react.suspense"),Yc=Symbol.for("react.suspense_list"),TC=Symbol.for("react.memo"),co=Symbol.for("react.lazy"),QA=Symbol.for("react.offscreen"),vp=Symbol.for("react.memo_cache_sentinel"),jl=Symbol.iterator,jA=Symbol.for("react.client.reference"),Pt=Nc.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,al,ql,wg=!1,Kc=Array.isArray,qA=e.rendererVersion,sI=e.rendererPackageName,Fc=e.extraDevToolsConfig,Ec=e.getPublicInstance,Zp=e.getRootHostContext,Tc=e.getChildHostContext,zC=e.prepareForCommit,Sp=e.resetAfterCommit,$A=e.createInstance,oI=e.appendInitialChild,$l=e.finalizeInitialChildren,sn=e.shouldSetTextContent,kn=e.createTextInstance,qi=e.scheduleTimeout,LC=e.cancelTimeout,_r=e.noTimeout,Ua=e.isPrimaryRenderer;e.warnsIfNotActing;var sa=e.supportsMutation,uo=e.supportsPersistence,Ba=e.supportsHydration,Rp=e.getInstanceFromNode;e.beforeActiveInstanceBlur,e.afterActiveInstanceBlur;var zi=e.preparePortalMount;e.prepareScopeUpdate,e.getInstanceFromScope;var Ma=e.setCurrentUpdatePriority,er=e.getCurrentUpdatePriority,wp=e.resolveUpdatePriority;e.resolveEventType,e.resolveEventTimeStamp;var xp=e.shouldAttemptEagerTransition,oG=e.detachDeletedInstance;e.requestPostPaintCallback;var eh=e.maySuspendCommit,_C=e.preloadInstance,th=e.startSuspendingCommit,Da=e.suspendInstance,$i=e.waitForCommitToBeReady,Ur=e.NotPendingTransition,Yo=e.HostTransitionContext,UC=e.resetFormInstance;e.bindToConsole;var nh=e.supportsMicrotasks,tr=e.scheduleMicrotask,Dr=e.supportsTestSelectors,ih=e.findFiberRoot,ah=e.getBoundingRect,Wp=e.getTextContent,zc=e.isHiddenSubtree,Vp=e.matchAccessibilityRole,Mp=e.setFocusIfFocusable,Hp=e.setupIntersectionObserver,Xp=e.appendChild,sh=e.appendChildToContainer,Np=e.commitTextUpdate,lG=e.commitMount,Yp=e.commitUpdate,Kp=e.insertBefore,Fp=e.insertInContainerBefore,oh=e.removeChild,Ep=e.removeChildFromContainer,lh=e.resetTextContent,Tp=e.hideInstance,zp=e.hideTextInstance,Lp=e.unhideInstance,rG=e.unhideTextInstance,_p=e.clearContainer,Lc=e.cloneInstance,lI=e.createContainerChildSet,rh=e.appendChildToContainerChildSet,DC=e.finalizeContainerChildren,_c=e.replaceContainerChildren,gh=e.cloneHiddenInstance,ch=e.cloneHiddenTextInstance,kC=e.isSuspenseInstancePending,OC=e.isSuspenseInstanceFallback,Up=e.getSuspenseInstanceFallbackErrorDetails,Dp=e.registerSuspenseInstanceRetry,uh=e.canHydrateFormStateMarker,kp=e.isFormStateMarkerMatching,Ih=e.getNextHydratableSibling,JC=e.getFirstHydratableChild,Op=e.getFirstHydratableChildWithinContainer,Jp=e.getFirstHydratableChildWithinSuspenseInstance,gG=e.canHydrateInstance,Ch=e.canHydrateTextInstance,Pp=e.canHydrateSuspenseInstance,Qp=e.hydrateInstance,dh=e.hydrateTextInstance,jp=e.hydrateSuspenseInstance,qp=e.getNextHydratableInstanceAfterSuspenseInstance,cG=e.commitHydratedContainer,uG=e.commitHydratedSuspenseInstance,$p=e.clearSuspenseBoundary,rI=e.clearSuspenseBoundaryFromContainer,PC=e.shouldDeleteUnhydratedTailInstances;e.diffHydratedPropsForDevWarnings,e.diffHydratedTextForDevWarnings,e.describeHydratableInstanceForDevWarnings;var QC=e.validateHydratableInstance,em=e.validateHydratableTextInstance,Ms=e.supportsResources,gI=e.isHostHoistableType,jC=e.getHoistableRoot,Ah=e.getResource,tm=e.acquireResource,xg=e.releaseResource,cI=e.hydrateHoistable,uI=e.mountHoistable,Uc=e.unmountHoistable,qC=e.createHoistableInstance,nm=e.prepareToCommitHoistables,im=e.mayResourceSuspendCommit,Wg=e.preloadResource,am=e.suspendResource,Qn=e.supportsSingletons,Ko=e.resolveSingletonInstance,kr=e.clearSingleton,sm=e.acquireSingletonInstance,Or=e.releaseSingletonInstance,sl=e.isHostSingletonType,Li=[],nr=-1,Jr={},ka=Math.clz32?Math.clz32:x,om=Math.log,lm=Math.LN2,ol=128,Vg=4194304,II=Vs.unstable_scheduleCallback,$C=Vs.unstable_cancelCallback,rm=Vs.unstable_shouldYield,ed=Vs.unstable_requestPaint,Io=Vs.unstable_now,td=Vs.unstable_ImmediatePriority,gm=Vs.unstable_UserBlockingPriority,nd=Vs.unstable_NormalPriority,IG=Vs.unstable_IdlePriority,cm=Vs.log,Ca=Vs.unstable_setDisableYieldValue,_i=null,Cs=null,ds=typeof Object.is=="function"?Object.is:Q,hh=new WeakMap,Mg=[],Hg=0,Xg=null,Dc=0,Hs=[],Xs=0,Pr=null,Fo=1,Eo="",oa=G(null),kc=G(null),ll=G(null),Ng=G(null),va=null,Za=null,xn=!1,Co=null,da=!1,CI=Error(i(519)),Ao=[],Yg=0,To=0,dI=null,ir=null,Kg=!1,ni=!1,fh=!1,Oc=0,Jc=null,Fg=0,Ns=0,Eg=null,ar=!1,Tg=!1,rl=Object.prototype.hasOwnProperty,Pc=Error(i(460)),AI=Error(i(474)),hI={then:function(){}},Qr=null,jr=null,qr=0,$r=gn(!0),gl=gn(!1),ii=G(null),Qc=G(0),Ys=G(null),jn=null,la=G(0),sr=0,dn=null,_t=null,Wn=null,ho=!1,zg=!1,eg=!1,id=0,Lg=0,Aa=null,zo=0,ad=function(){return{lastEffect:null,events:null,stores:null,memoCache:null}},xi={readContext:ma,use:Be,useCallback:Bn,useContext:Bn,useEffect:Bn,useImperativeHandle:Bn,useLayoutEffect:Bn,useInsertionEffect:Bn,useMemo:Bn,useReducer:Bn,useRef:Bn,useState:Bn,useDebugValue:Bn,useDeferredValue:Bn,useTransition:Bn,useSyncExternalStore:Bn,useId:Bn};xi.useCacheRefresh=Bn,xi.useMemoCache=Bn,xi.useHostTransitionStatus=Bn,xi.useFormState=Bn,xi.useActionState=Bn,xi.useOptimistic=Bn;var tg={readContext:ma,use:Be,useCallback:function(I,d){return $().memoizedState=[I,d===void 0?null:d],I},useContext:ma,useEffect:wr,useImperativeHandle:function(I,d,b){b=b!=null?b.concat([I]):null,Sr(4194308,4,Vo.bind(null,d,I),b)},useLayoutEffect:function(I,d){return Sr(4194308,4,I,d)},useInsertionEffect:function(I,d){Sr(4,2,I,d)},useMemo:function(I,d){var b=$();d=d===void 0?null:d;var S=I();if(eg){J(!0);try{I()}finally{J(!1)}}return b.memoizedState=[S,d],S},useReducer:function(I,d,b){var S=$();if(b!==void 0){var V=b(d);if(eg){J(!0);try{b(d)}finally{J(!1)}}}else V=d;return S.memoizedState=S.baseState=V,I={pending:null,lanes:0,dispatch:null,lastRenderedReducer:I,lastRenderedState:V},S.queue=I,I=I.dispatch=Bg.bind(null,dn,I),[S.memoizedState,I]},useRef:function(I){var d=$();return I={current:I},d.memoizedState=I},useState:function(I){I=cn(I);var d=I.queue,b=Bc.bind(null,dn,d);return d.dispatch=b,[I.memoizedState,b]},useDebugValue:as,useDeferredValue:function(I,d){var b=$();return Hl(b,I,d)},useTransition:function(){var I=cn(!1);return I=Xl.bind(null,dn,I.queue,!0,!1),$().memoizedState=I,[!1,I]},useSyncExternalStore:function(I,d,b){var S=dn,V=$();if(xn){if(b===void 0)throw Error(i(407));b=b()}else{if(b=d(),Un===null)throw Error(i(349));(vn&60)!==0||Xt(S,d,b)}V.memoizedState=b;var K={value:b,getSnapshot:d};return V.queue=K,wr(en.bind(null,S,K,I),[I]),S.flags|=2048,Pi(9,Wt.bind(null,S,K,b,d),{destroy:void 0},null),b},useId:function(){var I=$(),d=Un.identifierPrefix;if(xn){var b=Eo,S=Fo;b=(S&~(1<<32-ka(S)-1)).toString(32)+b,d=":"+d+"R"+b,b=id++,0<b&&(d+="H"+b.toString(32)),d+=":"}else b=zo++,d=":"+d+"r"+b.toString(32)+":";return I.memoizedState=d},useCacheRefresh:function(){return $().memoizedState=Gg.bind(null,dn)}};tg.useMemoCache=We,tg.useHostTransitionStatus=Nl,tg.useFormState=zn,tg.useActionState=zn,tg.useOptimistic=function(I){var d=$();d.memoizedState=d.baseState=I;var b={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return d.queue=b,d=Kl.bind(null,dn,!0,b),b.dispatch=d,[I,d]};var Oa={readContext:ma,use:Be,useCallback:el,useContext:ma,useEffect:Vl,useImperativeHandle:Mo,useInsertionEffect:Hu,useLayoutEffect:$o,useMemo:Ml,useReducer:bt,useRef:is,useState:function(){return bt(dt)},useDebugValue:as,useDeferredValue:function(I,d){var b=Se();return yg(b,_t.memoizedState,I,d)},useTransition:function(){var I=bt(dt)[0],d=Se().memoizedState;return[typeof I=="boolean"?I:ze(I),d]},useSyncExternalStore:Tt,useId:Yl};Oa.useCacheRefresh=Fi,Oa.useMemoCache=We,Oa.useHostTransitionStatus=Nl,Oa.useFormState=Si,Oa.useActionState=Si,Oa.useOptimistic=function(I,d){var b=Se();return fn(b,_t,I,d)};var Ks={readContext:ma,use:Be,useCallback:el,useContext:ma,useEffect:Vl,useImperativeHandle:Mo,useInsertionEffect:Hu,useLayoutEffect:$o,useMemo:Ml,useReducer:Zt,useRef:is,useState:function(){return Zt(dt)},useDebugValue:as,useDeferredValue:function(I,d){var b=Se();return _t===null?Hl(b,I,d):yg(b,_t.memoizedState,I,d)},useTransition:function(){var I=Zt(dt)[0],d=Se().memoizedState;return[typeof I=="boolean"?I:ze(I),d]},useSyncExternalStore:Tt,useId:Yl};Ks.useCacheRefresh=Fi,Ks.useMemoCache=We,Ks.useHostTransitionStatus=Nl,Ks.useFormState=bi,Ks.useActionState=bi,Ks.useOptimistic=function(I,d){var b=Se();return _t!==null?fn(b,_t,I,d):(b.baseState=I,[I,b.queue.dispatch])};var cl={isMounted:function(I){return(I=I._reactInternals)?h(I)===I:!1},enqueueSetState:function(I,d,b){I=I._reactInternals;var S=Ti(),V=Ne(S);V.payload=d,b!=null&&(V.callback=b),d=tt(I,V,S),d!==null&&(Ia(d,I,S),nt(d,I,S))},enqueueReplaceState:function(I,d,b){I=I._reactInternals;var S=Ti(),V=Ne(S);V.tag=1,V.payload=d,b!=null&&(V.callback=b),d=tt(I,V,S),d!==null&&(Ia(d,I,S),nt(d,I,S))},enqueueForceUpdate:function(I,d){I=I._reactInternals;var b=Ti(),S=Ne(b);S.tag=2,d!=null&&(S.callback=d),d=tt(I,S,b),d!==null&&(Ia(d,I,b),nt(d,I,b))}},sd=typeof reportError=="function"?reportError:function(I){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var d=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof I=="object"&&I!==null&&typeof I.message=="string"?String(I.message):String(I),error:I});if(!window.dispatchEvent(d))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",I);return}console.error(I)},od=Error(i(461)),qn=!1,ld={dehydrated:null,treeContext:null,retryLane:0},or=G(null),Lo=null,Fs=null,jc=typeof AbortController<"u"?AbortController:function(){var I=[],d=this.signal={aborted:!1,addEventListener:function(b,S){I.push(S)}};this.abort=function(){d.aborted=!0,I.forEach(function(b){return b()})}},um=Vs.unstable_scheduleCallback,Im=Vs.unstable_NormalPriority,ai={$$typeof:No,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0},ph=Pt.S;Pt.S=function(I,d){typeof d=="object"&&d!==null&&typeof d.then=="function"&&we(I,d),ph!==null&&ph(I,d)};var ul=G(null),Il=!1,Wi=!1,mh=!1,_n=typeof WeakSet=="function"?WeakSet:Set,tn=null,mn=!1,Lt=null,In=!1,Gi=null,Es=8192,qc={getCacheForType:function(I){var d=ma(ai),b=d.data.get(I);return b===void 0&&(b=I(),d.data.set(I,b)),b}},$c=0,fo=1,di=2,_o=3,Cl=4;if(typeof Symbol=="function"&&Symbol.for){var _g=Symbol.for;$c=_g("selector.component"),fo=_g("selector.has_pseudo_class"),di=_g("selector.role"),_o=_g("selector.test_id"),Cl=_g("selector.text")}var po=typeof WeakMap=="function"?WeakMap:Map,Vn=0,Un=null,Ut=null,vn=0,On=0,Ha=null,mo=!1,Ts=!1,ra=!1,Xa=0,$n=0,zs=0,lr=0,fI=0,Ls=0,dl=0,Ug=null,Vi=null,rd=!1,Ja=0,eu=1/0,pI=null,ng=null,Uo=!1,Al=null,Dg=0,ig=0,gd=null,tu=0,cd=null;return an.attemptContinuousHydration=function(I){if(I.tag===13){var d=Ee(I,67108864);d!==null&&Ia(d,I,67108864),eI(I,67108864)}},an.attemptHydrationAtCurrentPriority=function(I){if(I.tag===13){var d=Ti(),b=Ee(I,d);b!==null&&Ia(b,I,d),eI(I,d)}},an.attemptSynchronousHydration=function(I){switch(I.tag){case 3:if(I=I.stateNode,I.current.memoizedState.isDehydrated){var d=w(I.pendingLanes);if(d!==0){for(I.pendingLanes|=2,I.entangledLanes|=2;d;){var b=1<<31-ka(d);I.entanglements[1]|=b,d&=~b}Me(I),(Vn&6)===0&&(eu=Io()+500,Ze(0))}}break;case 13:d=Ee(I,2),d!==null&&Ia(d,I,2),Qu(),eI(I,2)}},an.batchedUpdates=function(I,d){return I(d)},an.createComponentSelector=function(I){return{$$typeof:$c,value:I}},an.createContainer=function(I,d,b,S,V,K,te,he,Xe,st){return Bp(I,d,!1,null,b,S,K,te,he,Xe,st,null)},an.createHasPseudoClassSelector=function(I){return{$$typeof:fo,value:I}},an.createHydrationContainer=function(I,d,b,S,V,K,te,he,Xe,st,pt,St,wt){return I=Bp(b,S,!0,I,V,K,he,Xe,st,pt,St,wt),I.context=ji(null),b=I.current,S=Ti(),V=Ne(S),V.callback=d??null,tt(b,V,S),I.current.lanes=S,U(I,S),Me(I),I},an.createPortal=function(I,d,b){var S=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:go,key:S==null?null:""+S,children:I,containerInfo:d,implementation:b}},an.createRoleSelector=function(I){return{$$typeof:di,value:I}},an.createTestNameSelector=function(I){return{$$typeof:_o,value:I}},an.createTextSelector=function(I){return{$$typeof:Cl,value:I}},an.defaultOnCaughtError=function(I){console.error(I)},an.defaultOnRecoverableError=function(I){sd(I)},an.defaultOnUncaughtError=function(I){sd(I)},an.deferredUpdates=function(I){var d=Pt.T,b=er();try{return Ma(32),Pt.T=null,I()}finally{Ma(b),Pt.T=d}},an.discreteUpdates=function(I,d,b,S,V){var K=Pt.T,te=er();try{return Ma(2),Pt.T=null,I(d,b,S,V)}finally{Ma(te),Pt.T=K,Vn===0&&(eu=Io()+500)}},an.findAllNodes=Ju,an.findBoundingRects=function(I,d){if(!Dr)throw Error(i(363));d=Ju(I,d),I=[];for(var b=0;b<d.length;b++)I.push(ah(d[b]));for(d=I.length-1;0<d;d--){b=I[d];for(var S=b.x,V=S+b.width,K=b.y,te=K+b.height,he=d-1;0<=he;he--)if(d!==he){var Xe=I[he],st=Xe.x,pt=st+Xe.width,St=Xe.y,wt=St+Xe.height;if(S>=st&&K>=St&&V<=pt&&te<=wt){I.splice(d,1);break}else if(S!==st||b.width!==Xe.width||wt<K||St>te){if(!(K!==St||b.height!==Xe.height||pt<S||st>V)){st>S&&(Xe.width+=st-S,Xe.x=S),pt<V&&(Xe.width=V-st),I.splice(d,1);break}}else{St>K&&(Xe.height+=St-K,Xe.y=K),wt<te&&(Xe.height=te-St),I.splice(d,1);break}}}return I},an.findHostInstance=YC,an.findHostInstanceWithNoPortals=function(I){return I=p(I),I=I!==null?v(I):null,I===null?null:Ec(I.stateNode)},an.findHostInstanceWithWarning=function(I){return YC(I)},an.flushPassiveEffects=Xo,an.flushSyncFromReconciler=function(I){var d=Vn;Vn|=1;var b=Pt.T,S=er();try{if(Ma(2),Pt.T=null,I)return I()}finally{Ma(S),Pt.T=b,Vn=d,(Vn&6)===0&&Ze(0)}},an.flushSyncWork=Qu,an.focusWithin=function(I,d){if(!Dr)throw Error(i(363));for(I=xc(I),d=us(I,d),d=Array.from(d),I=0;I<d.length;){var b=d[I++],S=b.tag;if(!zc(b)){if((S===5||S===26||S===27)&&Mp(b.stateNode))return!0;for(b=b.child;b!==null;)d.push(b),b=b.sibling}}return!1},an.getFindAllNodesFailureDescription=function(I,d){if(!Dr)throw Error(i(363));var b=0,S=[];I=[xc(I),0];for(var V=0;V<I.length;){var K=I[V++],te=K.tag,he=I[V++],Xe=d[he];if((te!==5&&te!==26&&te!==27||!zc(K))&&(Yr(K,Xe)&&(S.push(zA(Xe)),he++,he>b&&(b=he)),he<d.length))for(K=K.child;K!==null;)I.push(K,he),K=K.sibling}if(b<d.length){for(I=[];b<d.length;b++)I.push(zA(d[b]));return`findAllNodes was able to match part of the selector:
  `+(S.join(" > ")+`

No matching component was found for:
  `)+I.join(" > ")}return null},an.getPublicRootInstance=function(I){if(I=I.current,!I.child)return null;switch(I.child.tag){case 27:case 5:return Ec(I.child.stateNode);default:return I.child.stateNode}},an.injectIntoDevTools=function(){var I={bundleType:0,version:qA,rendererPackageName:sI,currentDispatcherRef:Pt,findFiberByHostInstance:Rp,reconcilerVersion:"19.0.0"};if(Fc!==null&&(I.rendererConfig=Fc),typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u")I=!1;else{var d=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(d.isDisabled||!d.supportsFiber)I=!0;else{try{_i=d.inject(I),Cs=d}catch{}I=!!d.checkDCE}}return I},an.isAlreadyRendering=function(){return!1},an.observeVisibleRects=function(I,d,b,S){if(!Dr)throw Error(i(363));I=Ju(I,d);var V=Hp(I,b,S).disconnect;return{disconnect:function(){V()}}},an.shouldError=function(){return null},an.shouldSuspend=function(){return!1},an.startHostTransition=function(I,d,b,S){if(I.tag!==5)throw Error(i(476));var V=Ta(I).queue;Xl(I,V,d,Ur,b===null?n:function(){var K=Ta(I).next.queue;return io(I,K,{},Ti()),b(S)})},an.updateContainer=function(I,d,b,S){var V=d.current,K=Ti();return Hc(V,K,I,d,b,S),K},an.updateContainerSync=function(I,d,b,S){return d.tag===0&&Xo(),Hc(d.current,2,I,d,b,S),2},an},a.exports.default=a.exports,Object.defineProperty(a.exports,"__esModule",{value:!0})}(FB)),FB.exports}var Lw;function bL(){return Lw||(Lw=1,KB.exports=mL()),KB.exports}var yL=bL();const GL=CC(yL);var zB={exports:{}},LB={};/**
 * @license React
 * scheduler.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var _w;function BL(){return _w||(_w=1,function(a){function e(T,J){var Q=T.length;T.push(J);e:for(;0<Q;){var se=Q-1>>>1,L=T[se];if(0<i(L,J))T[se]=J,T[Q]=L,Q=se;else break e}}function t(T){return T.length===0?null:T[0]}function n(T){if(T.length===0)return null;var J=T[0],Q=T.pop();if(Q!==J){T[0]=Q;e:for(var se=0,L=T.length,D=L>>>1;se<D;){var ne=2*(se+1)-1,oe=T[ne],j=ne+1,re=T[j];if(0>i(oe,Q))j<L&&0>i(re,oe)?(T[se]=re,T[j]=Q,se=j):(T[se]=oe,T[ne]=Q,se=ne);else if(j<L&&0>i(re,Q))T[se]=re,T[j]=Q,se=j;else break e}}return J}function i(T,J){var Q=T.sortIndex-J.sortIndex;return Q!==0?Q:T.id-J.id}if(a.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var s=performance;a.unstable_now=function(){return s.now()}}else{var o=Date,r=o.now();a.unstable_now=function(){return o.now()-r}}var g=[],u=[],C=1,h=null,f=3,p=!1,y=!1,v=!1,G=typeof setTimeout=="function"?setTimeout:null,B=typeof clearTimeout=="function"?clearTimeout:null,R=typeof setImmediate<"u"?setImmediate:null;function x(T){for(var J=t(u);J!==null;){if(J.callback===null)n(u);else if(J.startTime<=T)n(u),J.sortIndex=J.expirationTime,e(g,J);else break;J=t(u)}}function w(T){if(v=!1,x(T),!y)if(t(g)!==null)y=!0,ie();else{var J=t(u);J!==null&&le(w,J.startTime-T)}}var M=!1,H=-1,N=5,F=-1;function Y(){return!(a.unstable_now()-F<N)}function X(){if(M){var T=a.unstable_now();F=T;var J=!0;try{e:{y=!1,v&&(v=!1,B(H),H=-1),p=!0;var Q=f;try{t:{for(x(T),h=t(g);h!==null&&!(h.expirationTime>T&&Y());){var se=h.callback;if(typeof se=="function"){h.callback=null,f=h.priorityLevel;var L=se(h.expirationTime<=T);if(T=a.unstable_now(),typeof L=="function"){h.callback=L,x(T),J=!0;break t}h===t(g)&&n(g),x(T)}else n(g);h=t(g)}if(h!==null)J=!0;else{var D=t(u);D!==null&&le(w,D.startTime-T),J=!1}}break e}finally{h=null,f=Q,p=!1}J=void 0}}finally{J?U():M=!1}}}var U;if(typeof R=="function")U=function(){R(X)};else if(typeof MessageChannel<"u"){var O=new MessageChannel,P=O.port2;O.port1.onmessage=X,U=function(){P.postMessage(null)}}else U=function(){G(X,0)};function ie(){M||(M=!0,U())}function le(T,J){H=G(function(){T(a.unstable_now())},J)}a.unstable_IdlePriority=5,a.unstable_ImmediatePriority=1,a.unstable_LowPriority=4,a.unstable_NormalPriority=3,a.unstable_Profiling=null,a.unstable_UserBlockingPriority=2,a.unstable_cancelCallback=function(T){T.callback=null},a.unstable_continueExecution=function(){y||p||(y=!0,ie())},a.unstable_forceFrameRate=function(T){0>T||125<T?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):N=0<T?Math.floor(1e3/T):5},a.unstable_getCurrentPriorityLevel=function(){return f},a.unstable_getFirstCallbackNode=function(){return t(g)},a.unstable_next=function(T){switch(f){case 1:case 2:case 3:var J=3;break;default:J=f}var Q=f;f=J;try{return T()}finally{f=Q}},a.unstable_pauseExecution=function(){},a.unstable_requestPaint=function(){},a.unstable_runWithPriority=function(T,J){switch(T){case 1:case 2:case 3:case 4:case 5:break;default:T=3}var Q=f;f=T;try{return J()}finally{f=Q}},a.unstable_scheduleCallback=function(T,J,Q){var se=a.unstable_now();switch(typeof Q=="object"&&Q!==null?(Q=Q.delay,Q=typeof Q=="number"&&0<Q?se+Q:se):Q=se,T){case 1:var L=-1;break;case 2:L=250;break;case 5:L=1073741823;break;case 4:L=1e4;break;default:L=5e3}return L=Q+L,T={id:C++,callback:J,priorityLevel:T,startTime:Q,expirationTime:L,sortIndex:-1},Q>se?(T.sortIndex=Q,e(u,T),t(g)===null&&T===t(u)&&(v?(B(H),H=-1):v=!0,le(w,Q-se))):(T.sortIndex=L,e(g,T),y||p||(y=!0,ie())),T},a.unstable_shouldYield=Y,a.unstable_wrapCallback=function(T){var J=f;return function(){var Q=f;f=J;try{return T.apply(this,arguments)}finally{f=Q}}}}(LB)),LB}var Uw;function vL(){return Uw||(Uw=1,zB.exports=BL()),zB.exports}var Dw=vL();const ZL=a=>typeof a=="object"&&typeof a.then=="function",PI=[];function HM(a,e,t=(n,i)=>n===i){if(a===e)return!0;if(!a||!e)return!1;const n=a.length;if(e.length!==n)return!1;for(let i=0;i<n;i++)if(!t(a[i],e[i]))return!1;return!0}function XM(a,e=null,t=!1,n={}){e===null&&(e=[a]);for(const s of PI)if(HM(e,s.keys,s.equal)){if(t)return;if(Object.prototype.hasOwnProperty.call(s,"error"))throw s.error;if(Object.prototype.hasOwnProperty.call(s,"response"))return n.lifespan&&n.lifespan>0&&(s.timeout&&clearTimeout(s.timeout),s.timeout=setTimeout(s.remove,n.lifespan)),s.response;if(!t)throw s.promise}const i={keys:e,equal:n.equal,remove:()=>{const s=PI.indexOf(i);s!==-1&&PI.splice(s,1)},promise:(ZL(a)?a:a(...e)).then(s=>{i.response=s,n.lifespan&&n.lifespan>0&&(i.timeout=setTimeout(i.remove,n.lifespan))}).catch(s=>i.error=s)};if(PI.push(i),!t)throw i.promise}const NM=(a,e,t)=>XM(a,e,!1,t),SL=(a,e,t)=>void XM(a,e,!0,t),RL=a=>{if(a===void 0||a.length===0)PI.splice(0,PI.length);else{const e=PI.find(t=>HM(a,t.keys,t.equal));e&&e.remove()}};function wZ(a,e,t){if(!a)return;if(t(a)===!0)return a;let n=e?a.return:a.child;for(;n;){const i=wZ(n,e,t);if(i)return i;n=e?null:n.sibling}}function YM(a){try{return Object.defineProperties(a,{_currentRenderer:{get(){return null},set(){}},_currentRenderer2:{get(){return null},set(){}}})}catch{return a}}const xZ=YM(E.createContext(null));let KM=class extends E.Component{render(){return E.createElement(xZ.Provider,{value:this._reactInternals},this.props.children)}};function FM(){const a=E.useContext(xZ);if(a===null)throw new Error("its-fine: useFiber must be called within a <FiberProvider />!");const e=E.useId();return E.useMemo(()=>{for(const t of[a,a?.alternate]){if(!t)continue;const n=wZ(t,!1,i=>{let s=i.memoizedState;for(;s;){if(s.memoizedState===e)return!0;s=s.next}});if(n)return n}},[a,e])}const wL=Symbol.for("react.context"),xL=a=>a!==null&&typeof a=="object"&&"$$typeof"in a&&a.$$typeof===wL;function WL(){const a=FM(),[e]=E.useState(()=>new Map);e.clear();let t=a;for(;t;){const n=t.type;xL(n)&&n!==xZ&&!e.has(n)&&e.set(n,E.use(YM(n))),t=t.return}return e}function VL(){const a=WL();return E.useMemo(()=>Array.from(a.keys()).reduce((e,t)=>n=>E.createElement(e,null,E.createElement(t.Provider,{...n,value:a.get(t)})),e=>E.createElement(KM,{...e})),[a])}function EM(a){let e=a.root;for(;e.getState().previousRoot;)e=e.getState().previousRoot;return e}const TM=a=>a&&a.isOrthographicCamera,ML=a=>a&&a.hasOwnProperty("current"),HL=a=>a!=null&&(typeof a=="string"||typeof a=="number"||a.isColor),$f=((a,e)=>typeof window<"u"&&(((a=window.document)==null?void 0:a.createElement)||((e=window.navigator)==null?void 0:e.product)==="ReactNative"))()?E.useLayoutEffect:E.useEffect;function zM(a){const e=E.useRef(a);return $f(()=>void(e.current=a),[a]),e}function XL(){const a=FM(),e=VL();return E.useMemo(()=>({children:t})=>{const i=!!wZ(a,!0,s=>s.type===E.StrictMode)?E.StrictMode:E.Fragment;return de.jsx(i,{children:de.jsx(e,{children:t})})},[a,e])}function NL({set:a}){return $f(()=>(a(new Promise(()=>null)),()=>a(!1)),[a]),null}const YL=(a=>(a=class extends E.Component{constructor(...t){super(...t),this.state={error:!1}}componentDidCatch(t){this.props.set(t)}render(){return this.state.error?null:this.props.children}},a.getDerivedStateFromError=()=>({error:!0}),a))();function LM(a){var e;const t=typeof window<"u"?(e=window.devicePixelRatio)!=null?e:2:1;return Array.isArray(a)?Math.min(Math.max(a[0],t),a[1]):a}function Xd(a){var e;return(e=a.__r3f)==null?void 0:e.root.getState()}const Hi={obj:a=>a===Object(a)&&!Hi.arr(a)&&typeof a!="function",fun:a=>typeof a=="function",str:a=>typeof a=="string",num:a=>typeof a=="number",boo:a=>typeof a=="boolean",und:a=>a===void 0,nul:a=>a===null,arr:a=>Array.isArray(a),equ(a,e,{arrays:t="shallow",objects:n="reference",strict:i=!0}={}){if(typeof a!=typeof e||!!a!=!!e)return!1;if(Hi.str(a)||Hi.num(a)||Hi.boo(a))return a===e;const s=Hi.obj(a);if(s&&n==="reference")return a===e;const o=Hi.arr(a);if(o&&t==="reference")return a===e;if((o||s)&&a===e)return!0;let r;for(r in a)if(!(r in e))return!1;if(s&&t==="shallow"&&n==="shallow"){for(r in i?e:a)if(!Hi.equ(a[r],e[r],{strict:i,objects:"reference"}))return!1}else for(r in i?e:a)if(a[r]!==e[r])return!1;if(Hi.und(r)){if(o&&a.length===0&&e.length===0||s&&Object.keys(a).length===0&&Object.keys(e).length===0)return!0;if(a!==e)return!1}return!0}};function KL(a){const e={nodes:{},materials:{},meshes:{}};return a&&a.traverse(t=>{t.name&&(e.nodes[t.name]=t),t.material&&!e.materials[t.material.name]&&(e.materials[t.material.name]=t.material),t.isMesh&&!e.meshes[t.name]&&(e.meshes[t.name]=t)}),e}function FL(a){a.type!=="Scene"&&(a.dispose==null||a.dispose());for(const e in a){const t=a[e];t?.type!=="Scene"&&(t==null||t.dispose==null||t.dispose())}}const _M=["children","key","ref"];function EL(a){const e={};for(const t in a)_M.includes(t)||(e[t]=a[t]);return e}function F0(a,e,t,n){const i=a;let s=i?.__r3f;return s||(s={root:e,type:t,parent:null,children:[],props:EL(n),object:i,eventCount:0,handlers:{},isHidden:!1},i&&(i.__r3f=s)),s}function Kf(a,e){let t=a[e];if(!e.includes("-"))return{root:a,key:e,target:t};t=a;for(const i of e.split("-")){var n;e=i,a=t,t=(n=t)==null?void 0:n[e]}return{root:a,key:e,target:t}}const kw=/-\d+$/;function E0(a,e){if(Hi.str(e.props.attach)){if(kw.test(e.props.attach)){const i=e.props.attach.replace(kw,""),{root:s,key:o}=Kf(a.object,i);Array.isArray(s[o])||(s[o]=[])}const{root:t,key:n}=Kf(a.object,e.props.attach);e.previousAttach=t[n],t[n]=e.object}else Hi.fun(e.props.attach)&&(e.previousAttach=e.props.attach(a.object,e.object))}function T0(a,e){if(Hi.str(e.props.attach)){const{root:t,key:n}=Kf(a.object,e.props.attach),i=e.previousAttach;i===void 0?delete t[n]:t[n]=i}else e.previousAttach==null||e.previousAttach(a.object,e.object);delete e.previousAttach}const qv=[..._M,"args","dispose","attach","object","onUpdate","dispose"],Ow=new Map;function TL(a){let e=Ow.get(a.constructor);try{e||(e=new a.constructor,Ow.set(a.constructor,e))}catch{}return e}function zL(a,e){const t={};for(const n in e)if(!qv.includes(n)&&!Hi.equ(e[n],a.props[n])){t[n]=e[n];for(const i in e)i.startsWith(`${n}-`)&&(t[i]=e[i])}for(const n in a.props){if(qv.includes(n)||e.hasOwnProperty(n))continue;const{root:i,key:s}=Kf(a.object,n);if(i.constructor&&i.constructor.length===0){const o=TL(i);Hi.und(o)||(t[s]=o[s])}else t[s]=0}return t}const LL=["map","emissiveMap","sheenColorMap","specularColorMap","envMap"],_L=/^on(Pointer|Click|DoubleClick|ContextMenu|Wheel)/;function pu(a,e){var t;const n=a.__r3f,i=n&&EM(n).getState(),s=n?.eventCount;for(const r in e){let g=e[r];if(qv.includes(r))continue;if(n&&_L.test(r)){typeof g=="function"?n.handlers[r]=g:delete n.handlers[r],n.eventCount=Object.keys(n.handlers).length;continue}if(g===void 0)continue;let{root:u,key:C,target:h}=Kf(a,r);if(h instanceof aA&&g instanceof aA)h.mask=g.mask;else if(h instanceof Gt&&HL(g))h.set(g);else if(h!==null&&typeof h=="object"&&typeof h.set=="function"&&typeof h.copy=="function"&&g!=null&&g.constructor&&h.constructor===g.constructor)h.copy(g);else if(h!==null&&typeof h=="object"&&typeof h.set=="function"&&Array.isArray(g))typeof h.fromArray=="function"?h.fromArray(g):h.set(...g);else if(h!==null&&typeof h=="object"&&typeof h.set=="function"&&typeof g=="number")typeof h.setScalar=="function"?h.setScalar(g):h.set(g);else{var o;u[C]=g,i&&!i.linear&&LL.includes(C)&&(o=u[C])!=null&&o.isTexture&&u[C].format===Gs&&u[C].type===vl&&(u[C].colorSpace=ys)}}if(n!=null&&n.parent&&i!=null&&i.internal&&(t=n.object)!=null&&t.isObject3D&&s!==n.eventCount){const r=n.object,g=i.internal.interaction.indexOf(r);g>-1&&i.internal.interaction.splice(g,1),n.eventCount&&r.raycast!==null&&i.internal.interaction.push(r)}return n&&n.props.attach===void 0&&(n.object.isBufferGeometry?n.props.attach="geometry":n.object.isMaterial&&(n.props.attach="material")),n&&hA(n),a}function hA(a){var e;if(!a.parent)return;a.props.onUpdate==null||a.props.onUpdate(a.object);const t=(e=a.root)==null||e.getState==null?void 0:e.getState();t&&t.internal.frames===0&&t.invalidate()}function UL(a,e){a.manual||(TM(a)?(a.left=e.width/-2,a.right=e.width/2,a.top=e.height/2,a.bottom=e.height/-2):a.aspect=e.width/e.height,a.updateProjectionMatrix())}const Js=a=>a?.isObject3D;function bb(a){return(a.eventObject||a.object).uuid+"/"+a.index+a.instanceId}function UM(a,e,t,n){const i=t.get(e);i&&(t.delete(e),t.size===0&&(a.delete(n),i.target.releasePointerCapture(n)))}function DL(a,e){const{internal:t}=a.getState();t.interaction=t.interaction.filter(n=>n!==e),t.initialHits=t.initialHits.filter(n=>n!==e),t.hovered.forEach((n,i)=>{(n.eventObject===e||n.object===e)&&t.hovered.delete(i)}),t.capturedMap.forEach((n,i)=>{UM(t.capturedMap,e,n,i)})}function kL(a){function e(g){const{internal:u}=a.getState(),C=g.offsetX-u.initialClick[0],h=g.offsetY-u.initialClick[1];return Math.round(Math.sqrt(C*C+h*h))}function t(g){return g.filter(u=>["Move","Over","Enter","Out","Leave"].some(C=>{var h;return(h=u.__r3f)==null?void 0:h.handlers["onPointer"+C]}))}function n(g,u){const C=a.getState(),h=new Set,f=[],p=u?u(C.internal.interaction):C.internal.interaction;for(let B=0;B<p.length;B++){const R=Xd(p[B]);R&&(R.raycaster.camera=void 0)}C.previousRoot||C.events.compute==null||C.events.compute(g,C);function y(B){const R=Xd(B);if(!R||!R.events.enabled||R.raycaster.camera===null)return[];if(R.raycaster.camera===void 0){var x;R.events.compute==null||R.events.compute(g,R,(x=R.previousRoot)==null?void 0:x.getState()),R.raycaster.camera===void 0&&(R.raycaster.camera=null)}return R.raycaster.camera?R.raycaster.intersectObject(B,!0):[]}let v=p.flatMap(y).sort((B,R)=>{const x=Xd(B.object),w=Xd(R.object);return!x||!w?B.distance-R.distance:w.events.priority-x.events.priority||B.distance-R.distance}).filter(B=>{const R=bb(B);return h.has(R)?!1:(h.add(R),!0)});C.events.filter&&(v=C.events.filter(v,C));for(const B of v){let R=B.object;for(;R;){var G;(G=R.__r3f)!=null&&G.eventCount&&f.push({...B,eventObject:R}),R=R.parent}}if("pointerId"in g&&C.internal.capturedMap.has(g.pointerId))for(let B of C.internal.capturedMap.get(g.pointerId).values())h.has(bb(B.intersection))||f.push(B.intersection);return f}function i(g,u,C,h){if(g.length){const f={stopped:!1};for(const p of g){let y=Xd(p.object);if(y||p.object.traverseAncestors(v=>{const G=Xd(v);if(G)return y=G,!1}),y){const{raycaster:v,pointer:G,camera:B,internal:R}=y,x=new ae(G.x,G.y,0).unproject(B),w=Y=>{var X,U;return(X=(U=R.capturedMap.get(Y))==null?void 0:U.has(p.eventObject))!=null?X:!1},M=Y=>{const X={intersection:p,target:u.target};R.capturedMap.has(Y)?R.capturedMap.get(Y).set(p.eventObject,X):R.capturedMap.set(Y,new Map([[p.eventObject,X]])),u.target.setPointerCapture(Y)},H=Y=>{const X=R.capturedMap.get(Y);X&&UM(R.capturedMap,p.eventObject,X,Y)};let N={};for(let Y in u){let X=u[Y];typeof X!="function"&&(N[Y]=X)}let F={...p,...N,pointer:G,intersections:g,stopped:f.stopped,delta:C,unprojectedPoint:x,ray:v.ray,camera:B,stopPropagation(){const Y="pointerId"in u&&R.capturedMap.get(u.pointerId);if((!Y||Y.has(p.eventObject))&&(F.stopped=f.stopped=!0,R.hovered.size&&Array.from(R.hovered.values()).find(X=>X.eventObject===p.eventObject))){const X=g.slice(0,g.indexOf(p));s([...X,p])}},target:{hasPointerCapture:w,setPointerCapture:M,releasePointerCapture:H},currentTarget:{hasPointerCapture:w,setPointerCapture:M,releasePointerCapture:H},nativeEvent:u};if(h(F),f.stopped===!0)break}}}return g}function s(g){const{internal:u}=a.getState();for(const C of u.hovered.values())if(!g.length||!g.find(h=>h.object===C.object&&h.index===C.index&&h.instanceId===C.instanceId)){const f=C.eventObject.__r3f;if(u.hovered.delete(bb(C)),f!=null&&f.eventCount){const p=f.handlers,y={...C,intersections:g};p.onPointerOut==null||p.onPointerOut(y),p.onPointerLeave==null||p.onPointerLeave(y)}}}function o(g,u){for(let C=0;C<u.length;C++){const h=u[C].__r3f;h==null||h.handlers.onPointerMissed==null||h.handlers.onPointerMissed(g)}}function r(g){switch(g){case"onPointerLeave":case"onPointerCancel":return()=>s([]);case"onLostPointerCapture":return u=>{const{internal:C}=a.getState();"pointerId"in u&&C.capturedMap.has(u.pointerId)&&requestAnimationFrame(()=>{C.capturedMap.has(u.pointerId)&&(C.capturedMap.delete(u.pointerId),s([]))})}}return function(C){const{onPointerMissed:h,internal:f}=a.getState();f.lastEvent.current=C;const p=g==="onPointerMove",y=g==="onClick"||g==="onContextMenu"||g==="onDoubleClick",G=n(C,p?t:void 0),B=y?e(C):0;g==="onPointerDown"&&(f.initialClick=[C.offsetX,C.offsetY],f.initialHits=G.map(x=>x.eventObject)),y&&!G.length&&B<=2&&(o(C,f.interaction),h&&h(C)),p&&s(G);function R(x){const w=x.eventObject,M=w.__r3f;if(!(M!=null&&M.eventCount))return;const H=M.handlers;if(p){if(H.onPointerOver||H.onPointerEnter||H.onPointerOut||H.onPointerLeave){const N=bb(x),F=f.hovered.get(N);F?F.stopped&&x.stopPropagation():(f.hovered.set(N,x),H.onPointerOver==null||H.onPointerOver(x),H.onPointerEnter==null||H.onPointerEnter(x))}H.onPointerMove==null||H.onPointerMove(x)}else{const N=H[g];N?(!y||f.initialHits.includes(w))&&(o(C,f.interaction.filter(F=>!f.initialHits.includes(F))),N(x)):y&&f.initialHits.includes(w)&&o(C,f.interaction.filter(F=>!f.initialHits.includes(F)))}}i(G,C,B,R)}}return{handlePointer:r}}const Jw=a=>!!(a!=null&&a.render),DM=E.createContext(null),OL=(a,e)=>{const t=hL((r,g)=>{const u=new ae,C=new ae,h=new ae;function f(B=g().camera,R=C,x=g().size){const{width:w,height:M,top:H,left:N}=x,F=w/M;R.isVector3?h.copy(R):h.set(...R);const Y=B.getWorldPosition(u).distanceTo(h);if(TM(B))return{width:w/B.zoom,height:M/B.zoom,top:H,left:N,factor:1,distance:Y,aspect:F};{const X=B.fov*Math.PI/180,U=2*Math.tan(X/2)*Y,O=U*(w/M);return{width:O,height:U,top:H,left:N,factor:w/O,distance:Y,aspect:F}}}let p;const y=B=>r(R=>({performance:{...R.performance,current:B}})),v=new at;return{set:r,get:g,gl:null,camera:null,raycaster:null,events:{priority:1,enabled:!0,connected:!1},scene:null,xr:null,invalidate:(B=1)=>a(g(),B),advance:(B,R)=>e(B,R,g()),legacy:!1,linear:!1,flat:!1,controls:null,clock:new BZ,pointer:v,mouse:v,frameloop:"always",onPointerMissed:void 0,performance:{current:1,min:.5,max:1,debounce:200,regress:()=>{const B=g();p&&clearTimeout(p),B.performance.current!==B.performance.min&&y(B.performance.min),p=setTimeout(()=>y(g().performance.max),B.performance.debounce)}},size:{width:0,height:0,top:0,left:0},viewport:{initialDpr:0,dpr:0,width:0,height:0,top:0,left:0,aspect:0,distance:0,factor:0,getCurrentViewport:f},setEvents:B=>r(R=>({...R,events:{...R.events,...B}})),setSize:(B,R,x=0,w=0)=>{const M=g().camera,H={width:B,height:R,top:x,left:w};r(N=>({size:H,viewport:{...N.viewport,...f(M,C,H)}}))},setDpr:B=>r(R=>{const x=LM(B);return{viewport:{...R.viewport,dpr:x,initialDpr:R.viewport.initialDpr||x}}}),setFrameloop:(B="always")=>{const R=g().clock;R.stop(),R.elapsedTime=0,B!=="never"&&(R.start(),R.elapsedTime=0),r(()=>({frameloop:B}))},previousRoot:void 0,internal:{interaction:[],hovered:new Map,subscribers:[],initialClick:[0,0],initialHits:[],capturedMap:new Map,lastEvent:E.createRef(),active:!1,frames:0,priority:0,subscribe:(B,R,x)=>{const w=g().internal;return w.priority=w.priority+(R>0?1:0),w.subscribers.push({ref:B,priority:R,store:x}),w.subscribers=w.subscribers.sort((M,H)=>M.priority-H.priority),()=>{const M=g().internal;M!=null&&M.subscribers&&(M.priority=M.priority-(R>0?1:0),M.subscribers=M.subscribers.filter(H=>H.ref!==B))}}}}}),n=t.getState();let i=n.size,s=n.viewport.dpr,o=n.camera;return t.subscribe(()=>{const{camera:r,size:g,viewport:u,gl:C,set:h}=t.getState();if(g.width!==i.width||g.height!==i.height||u.dpr!==s){i=g,s=u.dpr,UL(r,g),u.dpr>0&&C.setPixelRatio(u.dpr);const f=typeof HTMLCanvasElement<"u"&&C.domElement instanceof HTMLCanvasElement;C.setSize(g.width,g.height,f)}r!==o&&(o=r,h(f=>({viewport:{...f.viewport,...f.viewport.getCurrentViewport(r)}})))}),t.subscribe(r=>a(r)),t};function kM(){const a=E.useContext(DM);if(!a)throw new Error("R3F: Hooks can only be used within the Canvas component!");return a}function qa(a=t=>t,e){return kM()(a,e)}function Wo(a,e=0){const t=kM(),n=t.getState().internal.subscribe,i=zM(a);return $f(()=>n(i,e,t),[e,n,t]),null}const Pw=new WeakMap,JL=a=>{var e;return typeof a=="function"&&(a==null||(e=a.prototype)==null?void 0:e.constructor)===a};function OM(a,e){return function(t,...n){let i;return JL(t)?(i=Pw.get(t),i||(i=new t,Pw.set(t,i))):i=t,a&&a(i),Promise.all(n.map(s=>new Promise((o,r)=>i.load(s,g=>{Js(g?.scene)&&Object.assign(g,KL(g.scene)),o(g)},e,g=>r(new Error(`Could not load ${s}: ${g?.message}`))))))}}function ep(a,e,t,n){const i=Array.isArray(e)?e:[e],s=NM(OM(t,n),[a,...i],{equal:Hi.equ});return Array.isArray(e)?s:s[0]}ep.preload=function(a,e,t){const n=Array.isArray(e)?e:[e];return SL(OM(t),[a,...n])};ep.clear=function(a,e){const t=Array.isArray(e)?e:[e];return RL([a,...t])};function PL(a){const e=GL(a);return e.injectIntoDevTools({bundleType:0,rendererPackageName:"@react-three/fiber",version:E.version}),e}const JM=0,rA={},QL=/^three(?=[A-Z])/,Uy=a=>`${a[0].toUpperCase()}${a.slice(1)}`;let jL=0;const qL=a=>typeof a=="function";function WZ(a){if(qL(a)){const e=`${jL++}`;return rA[e]=a,e}else Object.assign(rA,a)}function PM(a,e){const t=Uy(a),n=rA[t];if(a!=="primitive"&&!n)throw new Error(`R3F: ${t} is not part of the THREE namespace! Did you forget to extend? See: https://docs.pmnd.rs/react-three-fiber/api/objects#using-3rd-party-objects-declaratively`);if(a==="primitive"&&!e.object)throw new Error("R3F: Primitives without 'object' are invalid!");if(e.args!==void 0&&!Array.isArray(e.args))throw new Error("R3F: The args prop must be an array!")}function $L(a,e,t){var n;return a=Uy(a)in rA?a:a.replace(QL,""),PM(a,e),a==="primitive"&&(n=e.object)!=null&&n.__r3f&&delete e.object.__r3f,F0(e.object,t,a,e)}function e_(a){if(!a.isHidden){var e;a.props.attach&&(e=a.parent)!=null&&e.object?T0(a.parent,a):Js(a.object)&&(a.object.visible=!1),a.isHidden=!0,hA(a)}}function QM(a){if(a.isHidden){var e;a.props.attach&&(e=a.parent)!=null&&e.object?E0(a.parent,a):Js(a.object)&&a.props.visible!==!1&&(a.object.visible=!0),a.isHidden=!1,hA(a)}}function VZ(a,e,t){const n=e.root.getState();if(!(!a.parent&&a.object!==n.scene)){if(!e.object){var i,s;const o=rA[Uy(e.type)];e.object=(i=e.props.object)!=null?i:new o(...(s=e.props.args)!=null?s:[]),e.object.__r3f=e}if(pu(e.object,e.props),e.props.attach)E0(a,e);else if(Js(e.object)&&Js(a.object)){const o=a.object.children.indexOf(t?.object);if(t&&o!==-1){const r=a.object.children.indexOf(e.object);if(r!==-1){a.object.children.splice(r,1);const g=r<o?o-1:o;a.object.children.splice(g,0,e.object)}else e.object.parent=a.object,a.object.children.splice(o,0,e.object),e.object.dispatchEvent({type:"added"}),a.object.dispatchEvent({type:"childadded",child:e.object})}else a.object.add(e.object)}for(const o of e.children)VZ(e,o);hA(e)}}function _B(a,e){e&&(e.parent=a,a.children.push(e),VZ(a,e))}function Qw(a,e,t){if(!e||!t)return;e.parent=a;const n=a.children.indexOf(t);n!==-1?a.children.splice(n,0,e):a.children.push(e),VZ(a,e,t)}function jM(a){if(typeof a.dispose=="function"){const e=()=>{try{a.dispose()}catch{}};typeof IS_REACT_ACT_ENVIRONMENT<"u"?e():Dw.unstable_scheduleCallback(Dw.unstable_IdlePriority,e)}}function $v(a,e,t){if(!e)return;e.parent=null;const n=a.children.indexOf(e);n!==-1&&a.children.splice(n,1),e.props.attach?T0(a,e):Js(e.object)&&Js(a.object)&&(a.object.remove(e.object),DL(EM(e),e.object));const i=e.props.dispose!==null&&t!==!1;for(let s=e.children.length-1;s>=0;s--){const o=e.children[s];$v(e,o,i)}e.children.length=0,delete e.object.__r3f,i&&e.type!=="primitive"&&e.object.type!=="Scene"&&jM(e.object),t===void 0&&hA(e)}function t_(a,e){for(const t of[a,a.alternate])if(t!==null)if(typeof t.ref=="function"){t.refCleanup==null||t.refCleanup();const n=t.ref(e);typeof n=="function"&&(t.refCleanup=n)}else t.ref&&(t.ref.current=e)}const Db=[];function n_(){for(const[t]of Db){const n=t.parent;if(n){t.props.attach?T0(n,t):Js(t.object)&&Js(n.object)&&n.object.remove(t.object);for(const i of t.children)i.props.attach?T0(t,i):Js(i.object)&&Js(t.object)&&t.object.remove(i.object)}t.isHidden&&QM(t),t.object.__r3f&&delete t.object.__r3f,t.type!=="primitive"&&jM(t.object)}for(const[t,n,i]of Db){t.props=n;const s=t.parent;if(s){var a,e;const o=rA[Uy(t.type)];t.object=(a=t.props.object)!=null?a:new o(...(e=t.props.args)!=null?e:[]),t.object.__r3f=t,t_(i,t.object),pu(t.object,t.props),t.props.attach?E0(s,t):Js(t.object)&&Js(s.object)&&s.object.add(t.object);for(const r of t.children)r.props.attach?E0(t,r):Js(r.object)&&Js(t.object)&&t.object.add(r.object);hA(t)}}Db.length=0}const UB=()=>{},jw={};let yb=JM;const i_=0,a_=4,e2=PL({isPrimaryRenderer:!1,warnsIfNotActing:!1,supportsMutation:!0,supportsPersistence:!1,supportsHydration:!1,createInstance:$L,removeChild:$v,appendChild:_B,appendInitialChild:_B,insertBefore:Qw,appendChildToContainer(a,e){const t=a.getState().scene.__r3f;!e||!t||_B(t,e)},removeChildFromContainer(a,e){const t=a.getState().scene.__r3f;!e||!t||$v(t,e)},insertInContainerBefore(a,e,t){const n=a.getState().scene.__r3f;!e||!t||!n||Qw(n,e,t)},getRootHostContext:()=>jw,getChildHostContext:()=>jw,commitUpdate(a,e,t,n,i){var s,o,r;PM(e,n);let g=!1;if((a.type==="primitive"&&t.object!==n.object||((s=n.args)==null?void 0:s.length)!==((o=t.args)==null?void 0:o.length)||(r=n.args)!=null&&r.some((C,h)=>{var f;return C!==((f=t.args)==null?void 0:f[h])}))&&(g=!0),g)Db.push([a,{...n},i]);else{const C=zL(a,n);Object.keys(C).length&&(Object.assign(a.props,C),pu(a.object,C))}(i.sibling===null||(i.flags&a_)===i_)&&n_()},finalizeInitialChildren:()=>!1,commitMount(){},getPublicInstance:a=>a?.object,prepareForCommit:()=>null,preparePortalMount:a=>F0(a.getState().scene,a,"",{}),resetAfterCommit:()=>{},shouldSetTextContent:()=>!1,clearContainer:()=>!1,hideInstance:e_,unhideInstance:QM,createTextInstance:UB,hideTextInstance:UB,unhideTextInstance:UB,scheduleTimeout:typeof setTimeout=="function"?setTimeout:void 0,cancelTimeout:typeof clearTimeout=="function"?clearTimeout:void 0,noTimeout:-1,getInstanceFromNode:()=>null,beforeActiveInstanceBlur(){},afterActiveInstanceBlur(){},detachDeletedInstance(){},prepareScopeUpdate(){},getInstanceFromScope:()=>null,shouldAttemptEagerTransition:()=>!1,trackSchedulerEvent:()=>{},resolveEventType:()=>null,resolveEventTimeStamp:()=>-1.1,requestPostPaintCallback(){},maySuspendCommit:()=>!1,preloadInstance:()=>!0,startSuspendingCommit(){},suspendInstance(){},waitForCommitToBeReady:()=>null,NotPendingTransition:null,HostTransitionContext:E.createContext(null),setCurrentUpdatePriority(a){yb=a},getCurrentUpdatePriority(){return yb},resolveUpdatePriority(){var a;if(yb!==JM)return yb;switch(typeof window<"u"&&((a=window.event)==null?void 0:a.type)){case"click":case"contextmenu":case"dblclick":case"pointercancel":case"pointerdown":case"pointerup":return Ub.DiscreteEventPriority;case"pointermove":case"pointerout":case"pointerover":case"pointerenter":case"pointerleave":case"wheel":return Ub.ContinuousEventPriority;default:return Ub.DefaultEventPriority}},resetFormInstance(){}}),cC=new Map,Nd={objects:"shallow",strict:!1};function s_(a,e){if(!e&&typeof HTMLCanvasElement<"u"&&a instanceof HTMLCanvasElement&&a.parentElement){const{width:t,height:n,top:i,left:s}=a.parentElement.getBoundingClientRect();return{width:t,height:n,top:i,left:s}}else if(!e&&typeof OffscreenCanvas<"u"&&a instanceof OffscreenCanvas)return{width:a.width,height:a.height,top:0,left:0};return{width:0,height:0,top:0,left:0,...e}}function o_(a){const e=cC.get(a),t=e?.fiber,n=e?.store;e&&console.warn("R3F.createRoot should only be called once!");const i=typeof reportError=="function"?reportError:console.error,s=n||OL(i2,$w),o=t||e2.createContainer(s,Ub.ConcurrentRoot,null,!1,null,"",i,i,i,null);e||cC.set(a,{fiber:o,store:s});let r,g,u=!1,C=null;return{async configure(h={}){let f;C=new Promise(D=>f=D);let{gl:p,size:y,scene:v,events:G,onCreated:B,shadows:R=!1,linear:x=!1,flat:w=!1,legacy:M=!1,orthographic:H=!1,frameloop:N="always",dpr:F=[1,2],performance:Y,raycaster:X,camera:U,onPointerMissed:O}=h,P=s.getState(),ie=P.gl;if(!P.gl){const D={canvas:a,powerPreference:"high-performance",antialias:!0,alpha:!0},ne=typeof p=="function"?await p(D):p;Jw(ne)?ie=ne:ie=new MM({...D,...p}),P.set({gl:ie})}let le=P.raycaster;le||P.set({raycaster:le=new vM});const{params:T,...J}=X||{};if(Hi.equ(J,le,Nd)||pu(le,{...J}),Hi.equ(T,le.params,Nd)||pu(le,{params:{...le.params,...T}}),!P.camera||P.camera===g&&!Hi.equ(g,U,Nd)){g=U;const D=U?.isCamera,ne=D?U:H?new pr(0,0,0,0,.1,1e3):new Xi(75,0,.1,1e3);D||(ne.position.z=5,U&&(pu(ne,U),ne.manual||("aspect"in U||"left"in U||"right"in U||"bottom"in U||"top"in U)&&(ne.manual=!0,ne.updateProjectionMatrix())),!P.camera&&!(U!=null&&U.rotation)&&ne.lookAt(0,0,0)),P.set({camera:ne}),le.camera=ne}if(!P.scene){let D;v!=null&&v.isScene?(D=v,F0(D,s,"",{})):(D=new nZ,F0(D,s,"",{}),v&&pu(D,v)),P.set({scene:D})}G&&!P.events.handlers&&P.set({events:G(s)});const Q=s_(a,y);if(Hi.equ(Q,P.size,Nd)||P.setSize(Q.width,Q.height,Q.top,Q.left),F&&P.viewport.dpr!==LM(F)&&P.setDpr(F),P.frameloop!==N&&P.setFrameloop(N),P.onPointerMissed||P.set({onPointerMissed:O}),Y&&!Hi.equ(Y,P.performance,Nd)&&P.set(D=>({performance:{...D.performance,...Y}})),!P.xr){var se;const D=(j,re)=>{const pe=s.getState();pe.frameloop!=="never"&&$w(j,!0,pe,re)},ne=()=>{const j=s.getState();j.gl.xr.enabled=j.gl.xr.isPresenting,j.gl.xr.setAnimationLoop(j.gl.xr.isPresenting?D:null),j.gl.xr.isPresenting||i2(j)},oe={connect(){const j=s.getState().gl;j.xr.addEventListener("sessionstart",ne),j.xr.addEventListener("sessionend",ne)},disconnect(){const j=s.getState().gl;j.xr.removeEventListener("sessionstart",ne),j.xr.removeEventListener("sessionend",ne)}};typeof((se=ie.xr)==null?void 0:se.addEventListener)=="function"&&oe.connect(),P.set({xr:oe})}if(ie.shadowMap){const D=ie.shadowMap.enabled,ne=ie.shadowMap.type;if(ie.shadowMap.enabled=!!R,Hi.boo(R))ie.shadowMap.type=cf;else if(Hi.str(R)){var L;const oe={basic:LW,percentage:sy,soft:cf,variance:Ar};ie.shadowMap.type=(L=oe[R])!=null?L:cf}else Hi.obj(R)&&Object.assign(ie.shadowMap,R);(D!==ie.shadowMap.enabled||ne!==ie.shadowMap.type)&&(ie.shadowMap.needsUpdate=!0)}return Mn.enabled=!M,u||(ie.outputColorSpace=x?vu:ys,ie.toneMapping=w?Ag:T2),P.legacy!==M&&P.set(()=>({legacy:M})),P.linear!==x&&P.set(()=>({linear:x})),P.flat!==w&&P.set(()=>({flat:w})),p&&!Hi.fun(p)&&!Jw(p)&&!Hi.equ(p,ie,Nd)&&pu(ie,p),r=B,u=!0,f(),this},render(h){return!u&&!C&&this.configure(),C.then(()=>{e2.updateContainer(de.jsx(l_,{store:s,children:h,onCreated:r,rootElement:a}),o,null,()=>{})}),s},unmount(){qM(a)}}}function l_({store:a,children:e,onCreated:t,rootElement:n}){return $f(()=>{const i=a.getState();i.set(s=>({internal:{...s.internal,active:!0}})),t&&t(i),a.getState().events.connected||i.events.connect==null||i.events.connect(n)},[]),de.jsx(DM.Provider,{value:a,children:e})}function qM(a,e){const t=cC.get(a),n=t?.fiber;if(n){const i=t?.store.getState();i&&(i.internal.active=!1),e2.updateContainer(null,n,null,()=>{i&&setTimeout(()=>{try{var s,o,r,g;i.events.disconnect==null||i.events.disconnect(),(s=i.gl)==null||(o=s.renderLists)==null||o.dispose==null||o.dispose(),(r=i.gl)==null||r.forceContextLoss==null||r.forceContextLoss(),(g=i.gl)!=null&&g.xr&&i.xr.disconnect(),FL(i.scene),cC.delete(a)}catch{}},500)})}}const r_=new Set,g_=new Set,c_=new Set;function DB(a,e){if(a.size)for(const{callback:t}of a.values())t(e)}function mf(a,e){switch(a){case"before":return DB(r_,e);case"after":return DB(g_,e);case"tail":return DB(c_,e)}}let kB,OB;function t2(a,e,t){let n=e.clock.getDelta();e.frameloop==="never"&&typeof a=="number"&&(n=a-e.clock.elapsedTime,e.clock.oldTime=e.clock.elapsedTime,e.clock.elapsedTime=a),kB=e.internal.subscribers;for(let i=0;i<kB.length;i++)OB=kB[i],OB.ref.current(OB.store.getState(),n,t);return!e.internal.priority&&e.gl.render&&e.gl.render(e.scene,e.camera),e.internal.frames=Math.max(0,e.internal.frames-1),e.frameloop==="always"?1:e.internal.frames}let z0=!1,n2=!1,JB,qw,Yd;function $M(a){qw=requestAnimationFrame($M),z0=!0,JB=0,mf("before",a),n2=!0;for(const t of cC.values()){var e;Yd=t.store.getState(),Yd.internal.active&&(Yd.frameloop==="always"||Yd.internal.frames>0)&&!((e=Yd.gl.xr)!=null&&e.isPresenting)&&(JB+=t2(a,Yd))}if(n2=!1,mf("after",a),JB===0)return mf("tail",a),z0=!1,cancelAnimationFrame(qw)}function i2(a,e=1){var t;if(!a)return cC.forEach(n=>i2(n.store.getState(),e));(t=a.gl.xr)!=null&&t.isPresenting||!a.internal.active||a.frameloop==="never"||(e>1?a.internal.frames=Math.min(60,a.internal.frames+e):n2?a.internal.frames=2:a.internal.frames=1,z0||(z0=!0,requestAnimationFrame($M)))}function $w(a,e=!0,t,n){if(e&&mf("before",a),t)t2(a,t,n);else for(const i of cC.values())t2(a,i.store.getState());e&&mf("after",a)}const PB={onClick:["click",!1],onContextMenu:["contextmenu",!1],onDoubleClick:["dblclick",!1],onWheel:["wheel",!0],onPointerDown:["pointerdown",!0],onPointerUp:["pointerup",!0],onPointerLeave:["pointerleave",!0],onPointerMove:["pointermove",!0],onPointerCancel:["pointercancel",!0],onLostPointerCapture:["lostpointercapture",!0]};function u_(a){const{handlePointer:e}=kL(a);return{priority:1,enabled:!0,compute(t,n,i){n.pointer.set(t.offsetX/n.size.width*2-1,-(t.offsetY/n.size.height)*2+1),n.raycaster.setFromCamera(n.pointer,n.camera)},connected:void 0,handlers:Object.keys(PB).reduce((t,n)=>({...t,[n]:e(n)}),{}),update:()=>{var t;const{events:n,internal:i}=a.getState();(t=i.lastEvent)!=null&&t.current&&n.handlers&&n.handlers.onPointerMove(i.lastEvent.current)},connect:t=>{const{set:n,events:i}=a.getState();if(i.disconnect==null||i.disconnect(),n(s=>({events:{...s.events,connected:t}})),i.handlers)for(const s in i.handlers){const o=i.handlers[s],[r,g]=PB[s];t.addEventListener(r,o,{passive:g})}},disconnect:()=>{const{set:t,events:n}=a.getState();if(n.connected){if(n.handlers)for(const i in n.handlers){const s=n.handlers[i],[o]=PB[i];n.connected.removeEventListener(o,s)}t(i=>({events:{...i.events,connected:void 0}}))}}}}function e1(a,e){let t;return(...n)=>{window.clearTimeout(t),t=window.setTimeout(()=>a(...n),e)}}function I_({debounce:a,scroll:e,polyfill:t,offsetSize:n}={debounce:0,scroll:!1,offsetSize:!1}){const i=t||(typeof window>"u"?class{}:window.ResizeObserver);if(!i)throw new Error("This browser does not support ResizeObserver out of the box. See: https://github.com/react-spring/react-use-measure/#resize-observer-polyfills");const[s,o]=E.useState({left:0,top:0,width:0,height:0,bottom:0,right:0,x:0,y:0}),r=E.useRef({element:null,scrollContainers:null,resizeObserver:null,lastBounds:s,orientationHandler:null}),g=a?typeof a=="number"?a:a.scroll:null,u=a?typeof a=="number"?a:a.resize:null,C=E.useRef(!1);E.useEffect(()=>(C.current=!0,()=>void(C.current=!1)));const[h,f,p]=E.useMemo(()=>{const B=()=>{if(!r.current.element)return;const{left:R,top:x,width:w,height:M,bottom:H,right:N,x:F,y:Y}=r.current.element.getBoundingClientRect(),X={left:R,top:x,width:w,height:M,bottom:H,right:N,x:F,y:Y};r.current.element instanceof HTMLElement&&n&&(X.height=r.current.element.offsetHeight,X.width=r.current.element.offsetWidth),Object.freeze(X),C.current&&!h_(r.current.lastBounds,X)&&o(r.current.lastBounds=X)};return[B,u?e1(B,u):B,g?e1(B,g):B]},[o,n,g,u]);function y(){r.current.scrollContainers&&(r.current.scrollContainers.forEach(B=>B.removeEventListener("scroll",p,!0)),r.current.scrollContainers=null),r.current.resizeObserver&&(r.current.resizeObserver.disconnect(),r.current.resizeObserver=null),r.current.orientationHandler&&("orientation"in screen&&"removeEventListener"in screen.orientation?screen.orientation.removeEventListener("change",r.current.orientationHandler):"onorientationchange"in window&&window.removeEventListener("orientationchange",r.current.orientationHandler))}function v(){r.current.element&&(r.current.resizeObserver=new i(p),r.current.resizeObserver.observe(r.current.element),e&&r.current.scrollContainers&&r.current.scrollContainers.forEach(B=>B.addEventListener("scroll",p,{capture:!0,passive:!0})),r.current.orientationHandler=()=>{p()},"orientation"in screen&&"addEventListener"in screen.orientation?screen.orientation.addEventListener("change",r.current.orientationHandler):"onorientationchange"in window&&window.addEventListener("orientationchange",r.current.orientationHandler))}const G=B=>{!B||B===r.current.element||(y(),r.current.element=B,r.current.scrollContainers=eH(B),v())};return d_(p,!!e),C_(f),E.useEffect(()=>{y(),v()},[e,p,f]),E.useEffect(()=>y,[]),[G,s,h]}function C_(a){E.useEffect(()=>{const e=a;return window.addEventListener("resize",e),()=>void window.removeEventListener("resize",e)},[a])}function d_(a,e){E.useEffect(()=>{if(e){const t=a;return window.addEventListener("scroll",t,{capture:!0,passive:!0}),()=>void window.removeEventListener("scroll",t,!0)}},[a,e])}function eH(a){const e=[];if(!a||a===document.body)return e;const{overflow:t,overflowX:n,overflowY:i}=window.getComputedStyle(a);return[t,n,i].some(s=>s==="auto"||s==="scroll")&&e.push(a),[...e,...eH(a.parentElement)]}const A_=["x","y","top","bottom","left","right","width","height"],h_=(a,e)=>A_.every(t=>a[t]===e[t]);function f_({ref:a,children:e,fallback:t,resize:n,style:i,gl:s,events:o=u_,eventSource:r,eventPrefix:g,shadows:u,linear:C,flat:h,legacy:f,orthographic:p,frameloop:y,dpr:v,performance:G,raycaster:B,camera:R,scene:x,onPointerMissed:w,onCreated:M,...H}){E.useMemo(()=>WZ(iL),[]);const N=XL(),[F,Y]=I_({scroll:!0,debounce:{scroll:50,resize:0},...n}),X=E.useRef(null),U=E.useRef(null);E.useImperativeHandle(a,()=>X.current);const O=zM(w),[P,ie]=E.useState(!1),[le,T]=E.useState(!1);if(P)throw P;if(le)throw le;const J=E.useRef(null);$f(()=>{const se=X.current;if(Y.width>0&&Y.height>0&&se){J.current||(J.current=o_(se));async function L(){await J.current.configure({gl:s,scene:x,events:o,shadows:u,linear:C,flat:h,legacy:f,orthographic:p,frameloop:y,dpr:v,performance:G,raycaster:B,camera:R,size:Y,onPointerMissed:(...D)=>O.current==null?void 0:O.current(...D),onCreated:D=>{D.events.connect==null||D.events.connect(r?ML(r)?r.current:r:U.current),g&&D.setEvents({compute:(ne,oe)=>{const j=ne[g+"X"],re=ne[g+"Y"];oe.pointer.set(j/oe.size.width*2-1,-(re/oe.size.height)*2+1),oe.raycaster.setFromCamera(oe.pointer,oe.camera)}}),M?.(D)}}),J.current.render(de.jsx(N,{children:de.jsx(YL,{set:T,children:de.jsx(E.Suspense,{fallback:de.jsx(NL,{set:ie}),children:e??null})})}))}L()}}),E.useEffect(()=>{const se=X.current;if(se)return()=>qM(se)},[]);const Q=r?"none":"auto";return de.jsx("div",{ref:U,style:{position:"relative",width:"100%",height:"100%",overflow:"hidden",pointerEvents:Q,...i},...H,children:de.jsx("div",{ref:F,style:{width:"100%",height:"100%"},children:de.jsx("canvas",{ref:X,style:{display:"block"},children:t})})})}function p_(a){return de.jsx(KM,{children:de.jsx(f_,{...a})})}function gi(){return gi=Object.assign?Object.assign.bind():function(a){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var n in t)({}).hasOwnProperty.call(t,n)&&(a[n]=t[n])}return a},gi.apply(null,arguments)}const tp=new ae,MZ=new ae,m_=new ae,t1=new at;function b_(a,e,t){const n=tp.setFromMatrixPosition(a.matrixWorld);n.project(e);const i=t.width/2,s=t.height/2;return[n.x*i+i,-(n.y*s)+s]}function y_(a,e){const t=tp.setFromMatrixPosition(a.matrixWorld),n=MZ.setFromMatrixPosition(e.matrixWorld),i=t.sub(n),s=e.getWorldDirection(m_);return i.angleTo(s)>Math.PI/2}function G_(a,e,t,n){const i=tp.setFromMatrixPosition(a.matrixWorld),s=i.clone();s.project(e),t1.set(s.x,s.y),t.setFromCamera(t1,e);const o=t.intersectObjects(n,!0);if(o.length){const r=o[0].distance;return i.distanceTo(t.ray.origin)<r}return!0}function B_(a,e){if(e instanceof pr)return e.zoom;if(e instanceof Xi){const t=tp.setFromMatrixPosition(a.matrixWorld),n=MZ.setFromMatrixPosition(e.matrixWorld),i=e.fov*Math.PI/180,s=t.distanceTo(n);return 1/(2*Math.tan(i/2)*s)}else return 1}function v_(a,e,t){if(e instanceof Xi||e instanceof pr){const n=tp.setFromMatrixPosition(a.matrixWorld),i=MZ.setFromMatrixPosition(e.matrixWorld),s=n.distanceTo(i),o=(t[1]-t[0])/(e.far-e.near),r=t[1]-o*e.far;return Math.round(o*s+r)}}const a2=a=>Math.abs(a)<1e-10?0:a;function tH(a,e,t=""){let n="matrix3d(";for(let i=0;i!==16;i++)n+=a2(e[i]*a.elements[i])+(i!==15?",":")");return t+n}const Z_=(a=>e=>tH(e,a))([1,-1,1,1,1,-1,1,1,1,-1,1,1,1,-1,1,1]),S_=(a=>(e,t)=>tH(e,a(t),"translate(-50%,-50%)"))(a=>[1/a,1/a,1/a,1,-1/a,-1/a,-1/a,-1,1/a,1/a,1/a,1,1,1,1,1]);function R_(a){return a&&typeof a=="object"&&"current"in a}const HZ=E.forwardRef(({children:a,eps:e=.001,style:t,className:n,prepend:i,center:s,fullscreen:o,portal:r,distanceFactor:g,sprite:u=!1,transform:C=!1,occlude:h,onOcclude:f,castShadow:p,receiveShadow:y,material:v,geometry:G,zIndexRange:B=[16777271,0],calculatePosition:R=b_,as:x="div",wrapperClass:w,pointerEvents:M="auto",...H},N)=>{const{gl:F,camera:Y,scene:X,size:U,raycaster:O,events:P,viewport:ie}=qa(),[le]=E.useState(()=>document.createElement(x)),T=E.useRef(null),J=E.useRef(null),Q=E.useRef(0),se=E.useRef([0,0]),L=E.useRef(null),D=E.useRef(null),ne=r?.current||P.connected||F.domElement.parentNode,oe=E.useRef(null),j=E.useRef(!1),re=E.useMemo(()=>h&&h!=="blending"||Array.isArray(h)&&h.length&&R_(h[0]),[h]);E.useLayoutEffect(()=>{const qe=F.domElement;h&&h==="blending"?(qe.style.zIndex=`${Math.floor(B[0]/2)}`,qe.style.position="absolute",qe.style.pointerEvents="none"):(qe.style.zIndex=null,qe.style.position=null,qe.style.pointerEvents=null)},[h]),E.useLayoutEffect(()=>{if(J.current){const qe=T.current=E2.createRoot(le);if(X.updateMatrixWorld(),C)le.style.cssText="position:absolute;top:0;left:0;pointer-events:none;overflow:hidden;";else{const ke=R(J.current,Y,U);le.style.cssText=`position:absolute;top:0;left:0;transform:translate3d(${ke[0]}px,${ke[1]}px,0);transform-origin:0 0;`}return ne&&(i?ne.prepend(le):ne.appendChild(le)),()=>{ne&&ne.removeChild(le),qe.unmount()}}},[ne,C]),E.useLayoutEffect(()=>{w&&(le.className=w)},[w]);const pe=E.useMemo(()=>C?{position:"absolute",top:0,left:0,width:U.width,height:U.height,transformStyle:"preserve-3d",pointerEvents:"none"}:{position:"absolute",transform:s?"translate3d(-50%,-50%,0)":"none",...o&&{top:-U.height/2,left:-U.width/2,width:U.width,height:U.height},...t},[t,s,o,U,C]),me=E.useMemo(()=>({position:"absolute",pointerEvents:M}),[M]);E.useLayoutEffect(()=>{if(j.current=!1,C){var qe;(qe=T.current)==null||qe.render(E.createElement("div",{ref:L,style:pe},E.createElement("div",{ref:D,style:me},E.createElement("div",{ref:N,className:n,style:t,children:a}))))}else{var ke;(ke=T.current)==null||ke.render(E.createElement("div",{ref:N,style:pe,className:n,children:a}))}});const be=E.useRef(!0);Wo(qe=>{if(J.current){Y.updateMatrixWorld(),J.current.updateWorldMatrix(!0,!1);const ke=C?se.current:R(J.current,Y,U);if(C||Math.abs(Q.current-Y.zoom)>e||Math.abs(se.current[0]-ke[0])>e||Math.abs(se.current[1]-ke[1])>e){const Te=y_(J.current,Y);let ut=!1;re&&(Array.isArray(h)?ut=h.map(Ee=>Ee.current):h!=="blending"&&(ut=[X]));const q=be.current;if(ut){const Ee=G_(J.current,Y,O,ut);be.current=Ee&&!Te}else be.current=!Te;q!==be.current&&(f?f(!be.current):le.style.display=be.current?"block":"none");const De=Math.floor(B[0]/2),Ke=h?re?[B[0],De]:[De-1,0]:B;if(le.style.zIndex=`${v_(J.current,Y,Ke)}`,C){const[Ee,ye]=[U.width/2,U.height/2],Je=Y.projectionMatrix.elements[5]*ye,{isOrthographicCamera:Me,top:Ze,left:gt,bottom:k,right:z}=Y,Ce=Z_(Y.matrixWorldInverse),Ve=Me?`scale(${Je})translate(${a2(-(z+gt)/2)}px,${a2((Ze+k)/2)}px)`:`translateZ(${Je}px)`;let Ge=J.current.matrixWorld;u&&(Ge=Y.matrixWorldInverse.clone().transpose().copyPosition(Ge).scale(J.current.scale),Ge.elements[3]=Ge.elements[7]=Ge.elements[11]=0,Ge.elements[15]=1),le.style.width=U.width+"px",le.style.height=U.height+"px",le.style.perspective=Me?"":`${Je}px`,L.current&&D.current&&(L.current.style.transform=`${Ve}${Ce}translate(${Ee}px,${ye}px)`,D.current.style.transform=S_(Ge,1/((g||10)/400)))}else{const Ee=g===void 0?1:B_(J.current,Y)*g;le.style.transform=`translate3d(${ke[0]}px,${ke[1]}px,0) scale(${Ee})`}se.current=ke,Q.current=Y.zoom}}if(!re&&oe.current&&!j.current)if(C){if(L.current){const ke=L.current.children[0];if(ke!=null&&ke.clientWidth&&ke!=null&&ke.clientHeight){const{isOrthographicCamera:Te}=Y;if(Te||G)H.scale&&(Array.isArray(H.scale)?H.scale instanceof ae?oe.current.scale.copy(H.scale.clone().divideScalar(1)):oe.current.scale.set(1/H.scale[0],1/H.scale[1],1/H.scale[2]):oe.current.scale.setScalar(1/H.scale));else{const ut=(g||10)/400,q=ke.clientWidth*ut,De=ke.clientHeight*ut;oe.current.scale.set(q,De,1)}j.current=!0}}}else{const ke=le.children[0];if(ke!=null&&ke.clientWidth&&ke!=null&&ke.clientHeight){const Te=1/ie.factor,ut=ke.clientWidth*Te,q=ke.clientHeight*Te;oe.current.scale.set(ut,q,1),j.current=!0}oe.current.lookAt(qe.camera.position)}});const $e=E.useMemo(()=>({vertexShader:C?void 0:`
          /*
            This shader is from the THREE's SpriteMaterial.
            We need to turn the backing plane into a Sprite
            (make it always face the camera) if "transfrom"
            is false.
          */
          #include <common>

          void main() {
            vec2 center = vec2(0., 1.);
            float rotation = 0.0;

            // This is somewhat arbitrary, but it seems to work well
            // Need to figure out how to derive this dynamically if it even matters
            float size = 0.03;

            vec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );
            vec2 scale;
            scale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );
            scale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );

            bool isPerspective = isPerspectiveMatrix( projectionMatrix );
            if ( isPerspective ) scale *= - mvPosition.z;

            vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale * size;
            vec2 rotatedPosition;
            rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
            rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;
            mvPosition.xy += rotatedPosition;

            gl_Position = projectionMatrix * mvPosition;
          }
      `,fragmentShader:`
        void main() {
          gl_FragColor = vec4(0.0, 0.0, 0.0, 0.0);
        }
      `}),[C]);return E.createElement("group",gi({},H,{ref:J}),h&&!re&&E.createElement("mesh",{castShadow:p,receiveShadow:y,ref:oe},G||E.createElement("planeGeometry",null),v||E.createElement("shaderMaterial",{side:Oo,vertexShader:$e.vertexShader,fragmentShader:$e.fragmentShader})))});function w_(a,e,t){return Math.max(e,Math.min(a,t))}const Bs={toVector(a,e){return a===void 0&&(a=e),Array.isArray(a)?a:[a,a]},add(a,e){return[a[0]+e[0],a[1]+e[1]]},sub(a,e){return[a[0]-e[0],a[1]-e[1]]},addTo(a,e){a[0]+=e[0],a[1]+=e[1]},subTo(a,e){a[0]-=e[0],a[1]-=e[1]}};function n1(a,e,t){return e===0||Math.abs(e)===1/0?Math.pow(a,t*5):a*e*t/(e+t*a)}function i1(a,e,t,n=.15){return n===0?w_(a,e,t):a<e?-n1(e-a,t-e,n)+e:a>t?+n1(a-t,t-e,n)+t:a}function x_(a,[e,t],[n,i]){const[[s,o],[r,g]]=a;return[i1(e,s,o,n),i1(t,r,g,i)]}function W_(a,e){if(typeof a!="object"||a===null)return a;var t=a[Symbol.toPrimitive];if(t!==void 0){var n=t.call(a,e);if(typeof n!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(a)}function V_(a){var e=W_(a,"string");return typeof e=="symbol"?e:String(e)}function vo(a,e,t){return e=V_(e),e in a?Object.defineProperty(a,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):a[e]=t,a}function a1(a,e){var t=Object.keys(a);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(a);e&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(a,i).enumerable})),t.push.apply(t,n)}return t}function Ji(a){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?a1(Object(t),!0).forEach(function(n){vo(a,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(a,Object.getOwnPropertyDescriptors(t)):a1(Object(t)).forEach(function(n){Object.defineProperty(a,n,Object.getOwnPropertyDescriptor(t,n))})}return a}const nH={pointer:{start:"down",change:"move",end:"up"},mouse:{start:"down",change:"move",end:"up"},touch:{start:"start",change:"move",end:"end"},gesture:{start:"start",change:"change",end:"end"}};function s1(a){return a?a[0].toUpperCase()+a.slice(1):""}const M_=["enter","leave"];function H_(a=!1,e){return a&&!M_.includes(e)}function X_(a,e="",t=!1){const n=nH[a],i=n&&n[e]||e;return"on"+s1(a)+s1(i)+(H_(t,i)?"Capture":"")}const N_=["gotpointercapture","lostpointercapture"];function Y_(a){let e=a.substring(2).toLowerCase();const t=!!~e.indexOf("passive");t&&(e=e.replace("passive",""));const n=N_.includes(e)?"capturecapture":"capture",i=!!~e.indexOf(n);return i&&(e=e.replace("capture","")),{device:e,capture:i,passive:t}}function K_(a,e=""){const t=nH[a],n=t&&t[e]||e;return a+n}function Dy(a){return"touches"in a}function iH(a){return Dy(a)?"touch":"pointerType"in a?a.pointerType:"mouse"}function F_(a){return Array.from(a.touches).filter(e=>{var t,n;return e.target===a.currentTarget||((t=a.currentTarget)===null||t===void 0||(n=t.contains)===null||n===void 0?void 0:n.call(t,e.target))})}function E_(a){return a.type==="touchend"||a.type==="touchcancel"?a.changedTouches:a.targetTouches}function aH(a){return Dy(a)?E_(a)[0]:a}function T_(a){return F_(a).map(e=>e.identifier)}function QB(a){const e=aH(a);return Dy(a)?e.identifier:e.pointerId}function o1(a){const e=aH(a);return[e.clientX,e.clientY]}function z_(a){const e={};if("buttons"in a&&(e.buttons=a.buttons),"shiftKey"in a){const{shiftKey:t,altKey:n,metaKey:i,ctrlKey:s}=a;Object.assign(e,{shiftKey:t,altKey:n,metaKey:i,ctrlKey:s})}return e}function L0(a,...e){return typeof a=="function"?a(...e):a}function L_(){}function __(...a){return a.length===0?L_:a.length===1?a[0]:function(){let e;for(const t of a)e=t.apply(this,arguments)||e;return e}}function l1(a,e){return Object.assign({},e,a||{})}const U_=32;class D_{constructor(e,t,n){this.ctrl=e,this.args=t,this.key=n,this.state||(this.state={},this.computeValues([0,0]),this.computeInitial(),this.init&&this.init(),this.reset())}get state(){return this.ctrl.state[this.key]}set state(e){this.ctrl.state[this.key]=e}get shared(){return this.ctrl.state.shared}get eventStore(){return this.ctrl.gestureEventStores[this.key]}get timeoutStore(){return this.ctrl.gestureTimeoutStores[this.key]}get config(){return this.ctrl.config[this.key]}get sharedConfig(){return this.ctrl.config.shared}get handler(){return this.ctrl.handlers[this.key]}reset(){const{state:e,shared:t,ingKey:n,args:i}=this;t[n]=e._active=e.active=e._blocked=e._force=!1,e._step=[!1,!1],e.intentional=!1,e._movement=[0,0],e._distance=[0,0],e._direction=[0,0],e._delta=[0,0],e._bounds=[[-1/0,1/0],[-1/0,1/0]],e.args=i,e.axis=void 0,e.memo=void 0,e.elapsedTime=e.timeDelta=0,e.direction=[0,0],e.distance=[0,0],e.overflow=[0,0],e._movementBound=[!1,!1],e.velocity=[0,0],e.movement=[0,0],e.delta=[0,0],e.timeStamp=0}start(e){const t=this.state,n=this.config;t._active||(this.reset(),this.computeInitial(),t._active=!0,t.target=e.target,t.currentTarget=e.currentTarget,t.lastOffset=n.from?L0(n.from,t):t.offset,t.offset=t.lastOffset,t.startTime=t.timeStamp=e.timeStamp)}computeValues(e){const t=this.state;t._values=e,t.values=this.config.transform(e)}computeInitial(){const e=this.state;e._initial=e._values,e.initial=e.values}compute(e){const{state:t,config:n,shared:i}=this;t.args=this.args;let s=0;if(e&&(t.event=e,n.preventDefault&&e.cancelable&&t.event.preventDefault(),t.type=e.type,i.touches=this.ctrl.pointerIds.size||this.ctrl.touchIds.size,i.locked=!!document.pointerLockElement,Object.assign(i,z_(e)),i.down=i.pressed=i.buttons%2===1||i.touches>0,s=e.timeStamp-t.timeStamp,t.timeStamp=e.timeStamp,t.elapsedTime=t.timeStamp-t.startTime),t._active){const H=t._delta.map(Math.abs);Bs.addTo(t._distance,H)}this.axisIntent&&this.axisIntent(e);const[o,r]=t._movement,[g,u]=n.threshold,{_step:C,values:h}=t;if(n.hasCustomTransform?(C[0]===!1&&(C[0]=Math.abs(o)>=g&&h[0]),C[1]===!1&&(C[1]=Math.abs(r)>=u&&h[1])):(C[0]===!1&&(C[0]=Math.abs(o)>=g&&Math.sign(o)*g),C[1]===!1&&(C[1]=Math.abs(r)>=u&&Math.sign(r)*u)),t.intentional=C[0]!==!1||C[1]!==!1,!t.intentional)return;const f=[0,0];if(n.hasCustomTransform){const[H,N]=h;f[0]=C[0]!==!1?H-C[0]:0,f[1]=C[1]!==!1?N-C[1]:0}else f[0]=C[0]!==!1?o-C[0]:0,f[1]=C[1]!==!1?r-C[1]:0;this.restrictToAxis&&!t._blocked&&this.restrictToAxis(f);const p=t.offset,y=t._active&&!t._blocked||t.active;y&&(t.first=t._active&&!t.active,t.last=!t._active&&t.active,t.active=i[this.ingKey]=t._active,e&&(t.first&&("bounds"in n&&(t._bounds=L0(n.bounds,t)),this.setup&&this.setup()),t.movement=f,this.computeOffset()));const[v,G]=t.offset,[[B,R],[x,w]]=t._bounds;t.overflow=[v<B?-1:v>R?1:0,G<x?-1:G>w?1:0],t._movementBound[0]=t.overflow[0]?t._movementBound[0]===!1?t._movement[0]:t._movementBound[0]:!1,t._movementBound[1]=t.overflow[1]?t._movementBound[1]===!1?t._movement[1]:t._movementBound[1]:!1;const M=t._active?n.rubberband||[0,0]:[0,0];if(t.offset=x_(t._bounds,t.offset,M),t.delta=Bs.sub(t.offset,p),this.computeMovement(),y&&(!t.last||s>U_)){t.delta=Bs.sub(t.offset,p);const H=t.delta.map(Math.abs);Bs.addTo(t.distance,H),t.direction=t.delta.map(Math.sign),t._direction=t._delta.map(Math.sign),!t.first&&s>0&&(t.velocity=[H[0]/s,H[1]/s],t.timeDelta=s)}}emit(){const e=this.state,t=this.shared,n=this.config;if(e._active||this.clean(),(e._blocked||!e.intentional)&&!e._force&&!n.triggerAllEvents)return;const i=this.handler(Ji(Ji(Ji({},t),e),{},{[this.aliasKey]:e.values}));i!==void 0&&(e.memo=i)}clean(){this.eventStore.clean(),this.timeoutStore.clean()}}function k_([a,e],t){const n=Math.abs(a),i=Math.abs(e);if(n>i&&n>t)return"x";if(i>n&&i>t)return"y"}class O_ extends D_{constructor(...e){super(...e),vo(this,"aliasKey","xy")}reset(){super.reset(),this.state.axis=void 0}init(){this.state.offset=[0,0],this.state.lastOffset=[0,0]}computeOffset(){this.state.offset=Bs.add(this.state.lastOffset,this.state.movement)}computeMovement(){this.state.movement=Bs.sub(this.state.offset,this.state.lastOffset)}axisIntent(e){const t=this.state,n=this.config;if(!t.axis&&e){const i=typeof n.axisThreshold=="object"?n.axisThreshold[iH(e)]:n.axisThreshold;t.axis=k_(t._movement,i)}t._blocked=(n.lockDirection||!!n.axis)&&!t.axis||!!n.axis&&n.axis!==t.axis}restrictToAxis(e){if(this.config.axis||this.config.lockDirection)switch(this.state.axis){case"x":e[1]=0;break;case"y":e[0]=0;break}}}const J_=a=>a,r1=.15,sH={enabled(a=!0){return a},eventOptions(a,e,t){return Ji(Ji({},t.shared.eventOptions),a)},preventDefault(a=!1){return a},triggerAllEvents(a=!1){return a},rubberband(a=0){switch(a){case!0:return[r1,r1];case!1:return[0,0];default:return Bs.toVector(a)}},from(a){if(typeof a=="function")return a;if(a!=null)return Bs.toVector(a)},transform(a,e,t){const n=a||t.shared.transform;return this.hasCustomTransform=!!n,n||J_},threshold(a){return Bs.toVector(a,0)}},P_=0,np=Ji(Ji({},sH),{},{axis(a,e,{axis:t}){if(this.lockDirection=t==="lock",!this.lockDirection)return t},axisThreshold(a=P_){return a},bounds(a={}){if(typeof a=="function")return s=>np.bounds(a(s));if("current"in a)return()=>a.current;if(typeof HTMLElement=="function"&&a instanceof HTMLElement)return a;const{left:e=-1/0,right:t=1/0,top:n=-1/0,bottom:i=1/0}=a;return[[e,t],[n,i]]}}),g1={ArrowRight:(a,e=1)=>[a*e,0],ArrowLeft:(a,e=1)=>[-1*a*e,0],ArrowUp:(a,e=1)=>[0,-1*a*e],ArrowDown:(a,e=1)=>[0,a*e]};class Q_ extends O_{constructor(...e){super(...e),vo(this,"ingKey","dragging")}reset(){super.reset();const e=this.state;e._pointerId=void 0,e._pointerActive=!1,e._keyboardActive=!1,e._preventScroll=!1,e._delayed=!1,e.swipe=[0,0],e.tap=!1,e.canceled=!1,e.cancel=this.cancel.bind(this)}setup(){const e=this.state;if(e._bounds instanceof HTMLElement){const t=e._bounds.getBoundingClientRect(),n=e.currentTarget.getBoundingClientRect(),i={left:t.left-n.left+e.offset[0],right:t.right-n.right+e.offset[0],top:t.top-n.top+e.offset[1],bottom:t.bottom-n.bottom+e.offset[1]};e._bounds=np.bounds(i)}}cancel(){const e=this.state;e.canceled||(e.canceled=!0,e._active=!1,setTimeout(()=>{this.compute(),this.emit()},0))}setActive(){this.state._active=this.state._pointerActive||this.state._keyboardActive}clean(){this.pointerClean(),this.state._pointerActive=!1,this.state._keyboardActive=!1,super.clean()}pointerDown(e){const t=this.config,n=this.state;if(e.buttons!=null&&(Array.isArray(t.pointerButtons)?!t.pointerButtons.includes(e.buttons):t.pointerButtons!==-1&&t.pointerButtons!==e.buttons))return;const i=this.ctrl.setEventIds(e);t.pointerCapture&&e.target.setPointerCapture(e.pointerId),!(i&&i.size>1&&n._pointerActive)&&(this.start(e),this.setupPointer(e),n._pointerId=QB(e),n._pointerActive=!0,this.computeValues(o1(e)),this.computeInitial(),t.preventScrollAxis&&iH(e)!=="mouse"?(n._active=!1,this.setupScrollPrevention(e)):t.delay>0?(this.setupDelayTrigger(e),t.triggerAllEvents&&(this.compute(e),this.emit())):this.startPointerDrag(e))}startPointerDrag(e){const t=this.state;t._active=!0,t._preventScroll=!0,t._delayed=!1,this.compute(e),this.emit()}pointerMove(e){const t=this.state,n=this.config;if(!t._pointerActive)return;const i=QB(e);if(t._pointerId!==void 0&&i!==t._pointerId)return;const s=o1(e);if(document.pointerLockElement===e.target?t._delta=[e.movementX,e.movementY]:(t._delta=Bs.sub(s,t._values),this.computeValues(s)),Bs.addTo(t._movement,t._delta),this.compute(e),t._delayed&&t.intentional){this.timeoutStore.remove("dragDelay"),t.active=!1,this.startPointerDrag(e);return}if(n.preventScrollAxis&&!t._preventScroll)if(t.axis)if(t.axis===n.preventScrollAxis||n.preventScrollAxis==="xy"){t._active=!1,this.clean();return}else{this.timeoutStore.remove("startPointerDrag"),this.startPointerDrag(e);return}else return;this.emit()}pointerUp(e){this.ctrl.setEventIds(e);try{this.config.pointerCapture&&e.target.hasPointerCapture(e.pointerId)&&e.target.releasePointerCapture(e.pointerId)}catch{}const t=this.state,n=this.config;if(!t._active||!t._pointerActive)return;const i=QB(e);if(t._pointerId!==void 0&&i!==t._pointerId)return;this.state._pointerActive=!1,this.setActive(),this.compute(e);const[s,o]=t._distance;if(t.tap=s<=n.tapsThreshold&&o<=n.tapsThreshold,t.tap&&n.filterTaps)t._force=!0;else{const[r,g]=t._delta,[u,C]=t._movement,[h,f]=n.swipe.velocity,[p,y]=n.swipe.distance,v=n.swipe.duration;if(t.elapsedTime<v){const G=Math.abs(r/t.timeDelta),B=Math.abs(g/t.timeDelta);G>h&&Math.abs(u)>p&&(t.swipe[0]=Math.sign(r)),B>f&&Math.abs(C)>y&&(t.swipe[1]=Math.sign(g))}}this.emit()}pointerClick(e){!this.state.tap&&e.detail>0&&(e.preventDefault(),e.stopPropagation())}setupPointer(e){const t=this.config,n=t.device;t.pointerLock&&e.currentTarget.requestPointerLock(),t.pointerCapture||(this.eventStore.add(this.sharedConfig.window,n,"change",this.pointerMove.bind(this)),this.eventStore.add(this.sharedConfig.window,n,"end",this.pointerUp.bind(this)),this.eventStore.add(this.sharedConfig.window,n,"cancel",this.pointerUp.bind(this)))}pointerClean(){this.config.pointerLock&&document.pointerLockElement===this.state.currentTarget&&document.exitPointerLock()}preventScroll(e){this.state._preventScroll&&e.cancelable&&e.preventDefault()}setupScrollPrevention(e){this.state._preventScroll=!1,j_(e);const t=this.eventStore.add(this.sharedConfig.window,"touch","change",this.preventScroll.bind(this),{passive:!1});this.eventStore.add(this.sharedConfig.window,"touch","end",t),this.eventStore.add(this.sharedConfig.window,"touch","cancel",t),this.timeoutStore.add("startPointerDrag",this.startPointerDrag.bind(this),this.config.preventScrollDelay,e)}setupDelayTrigger(e){this.state._delayed=!0,this.timeoutStore.add("dragDelay",()=>{this.state._step=[0,0],this.startPointerDrag(e)},this.config.delay)}keyDown(e){const t=g1[e.key];if(t){const n=this.state,i=e.shiftKey?10:e.altKey?.1:1;this.start(e),n._delta=t(this.config.keyboardDisplacement,i),n._keyboardActive=!0,Bs.addTo(n._movement,n._delta),this.compute(e),this.emit()}}keyUp(e){e.key in g1&&(this.state._keyboardActive=!1,this.setActive(),this.compute(e),this.emit())}bind(e){const t=this.config.device;e(t,"start",this.pointerDown.bind(this)),this.config.pointerCapture&&(e(t,"change",this.pointerMove.bind(this)),e(t,"end",this.pointerUp.bind(this)),e(t,"cancel",this.pointerUp.bind(this)),e("lostPointerCapture","",this.pointerUp.bind(this))),this.config.keys&&(e("key","down",this.keyDown.bind(this)),e("key","up",this.keyUp.bind(this))),this.config.filterTaps&&e("click","",this.pointerClick.bind(this),{capture:!0,passive:!1})}}function j_(a){"persist"in a&&typeof a.persist=="function"&&a.persist()}const ip=typeof window<"u"&&window.document&&window.document.createElement;function oH(){return ip&&"ontouchstart"in window}function q_(){return oH()||ip&&window.navigator.maxTouchPoints>1}function $_(){return ip&&"onpointerdown"in window}function eU(){return ip&&"exitPointerLock"in window.document}function tU(){try{return"constructor"in GestureEvent}catch{return!1}}const bl={isBrowser:ip,gesture:tU(),touch:oH(),touchscreen:q_(),pointer:$_(),pointerLock:eU()},nU=250,iU=180,aU=.5,sU=50,oU=250,lU=10,c1={mouse:0,touch:0,pen:8},rU=Ji(Ji({},np),{},{device(a,e,{pointer:{touch:t=!1,lock:n=!1,mouse:i=!1}={}}){return this.pointerLock=n&&bl.pointerLock,bl.touch&&t?"touch":this.pointerLock?"mouse":bl.pointer&&!i?"pointer":bl.touch?"touch":"mouse"},preventScrollAxis(a,e,{preventScroll:t}){if(this.preventScrollDelay=typeof t=="number"?t:t||t===void 0&&a?nU:void 0,!(!bl.touchscreen||t===!1))return a||(t!==void 0?"y":void 0)},pointerCapture(a,e,{pointer:{capture:t=!0,buttons:n=1,keys:i=!0}={}}){return this.pointerButtons=n,this.keys=i,!this.pointerLock&&this.device==="pointer"&&t},threshold(a,e,{filterTaps:t=!1,tapsThreshold:n=3,axis:i=void 0}){const s=Bs.toVector(a,t?n:i?1:0);return this.filterTaps=t,this.tapsThreshold=n,s},swipe({velocity:a=aU,distance:e=sU,duration:t=oU}={}){return{velocity:this.transform(Bs.toVector(a)),distance:this.transform(Bs.toVector(e)),duration:t}},delay(a=0){switch(a){case!0:return iU;case!1:return 0;default:return a}},axisThreshold(a){return a?Ji(Ji({},c1),a):c1},keyboardDisplacement(a=lU){return a}});Ji(Ji({},sH),{},{device(a,e,{shared:t,pointer:{touch:n=!1}={}}){if(t.target&&!bl.touch&&bl.gesture)return"gesture";if(bl.touch&&n)return"touch";if(bl.touchscreen){if(bl.pointer)return"pointer";if(bl.touch)return"touch"}},bounds(a,e,{scaleBounds:t={},angleBounds:n={}}){const i=o=>{const r=l1(L0(t,o),{min:-1/0,max:1/0});return[r.min,r.max]},s=o=>{const r=l1(L0(n,o),{min:-1/0,max:1/0});return[r.min,r.max]};return typeof t!="function"&&typeof n!="function"?[i(),s()]:o=>[i(o),s(o)]},threshold(a,e,t){return this.lockDirection=t.axis==="lock",Bs.toVector(a,this.lockDirection?[.1,3]:0)},modifierKey(a){return a===void 0?"ctrlKey":a},pinchOnWheel(a=!0){return a}});Ji(Ji({},np),{},{mouseOnly:(a=!0)=>a});Ji(Ji({},np),{},{mouseOnly:(a=!0)=>a});const lH=new Map,s2=new Map;function gU(a){lH.set(a.key,a.engine),s2.set(a.key,a.resolver)}const cU={key:"drag",engine:Q_,resolver:rU};function uU(a,e){if(a==null)return{};var t={},n=Object.keys(a),i,s;for(s=0;s<n.length;s++)i=n[s],!(e.indexOf(i)>=0)&&(t[i]=a[i]);return t}function IU(a,e){if(a==null)return{};var t=uU(a,e),n,i;if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(a);for(i=0;i<s.length;i++)n=s[i],!(e.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(a,n)&&(t[n]=a[n])}return t}const CU={target(a){if(a)return()=>"current"in a?a.current:a},enabled(a=!0){return a},window(a=bl.isBrowser?window:void 0){return a},eventOptions({passive:a=!0,capture:e=!1}={}){return{passive:a,capture:e}},transform(a){return a}},dU=["target","eventOptions","window","enabled","transform"];function kb(a={},e){const t={};for(const[n,i]of Object.entries(e))switch(typeof i){case"function":t[n]=i.call(t,a[n],n,a);break;case"object":t[n]=kb(a[n],i);break;case"boolean":i&&(t[n]=a[n]);break}return t}function AU(a,e,t={}){const n=a,{target:i,eventOptions:s,window:o,enabled:r,transform:g}=n,u=IU(n,dU);if(t.shared=kb({target:i,eventOptions:s,window:o,enabled:r,transform:g},CU),e){const C=s2.get(e);t[e]=kb(Ji({shared:t.shared},u),C)}else for(const C in u){const h=s2.get(C);h&&(t[C]=kb(Ji({shared:t.shared},u[C]),h))}return t}class rH{constructor(e,t){vo(this,"_listeners",new Set),this._ctrl=e,this._gestureKey=t}add(e,t,n,i,s){const o=this._listeners,r=K_(t,n),g=this._gestureKey?this._ctrl.config[this._gestureKey].eventOptions:{},u=Ji(Ji({},g),s);e.addEventListener(r,i,u);const C=()=>{e.removeEventListener(r,i,u),o.delete(C)};return o.add(C),C}clean(){this._listeners.forEach(e=>e()),this._listeners.clear()}}class hU{constructor(){vo(this,"_timeouts",new Map)}add(e,t,n=140,...i){this.remove(e),this._timeouts.set(e,window.setTimeout(t,n,...i))}remove(e){const t=this._timeouts.get(e);t&&window.clearTimeout(t)}clean(){this._timeouts.forEach(e=>void window.clearTimeout(e)),this._timeouts.clear()}}class fU{constructor(e){vo(this,"gestures",new Set),vo(this,"_targetEventStore",new rH(this)),vo(this,"gestureEventStores",{}),vo(this,"gestureTimeoutStores",{}),vo(this,"handlers",{}),vo(this,"config",{}),vo(this,"pointerIds",new Set),vo(this,"touchIds",new Set),vo(this,"state",{shared:{shiftKey:!1,metaKey:!1,ctrlKey:!1,altKey:!1}}),pU(this,e)}setEventIds(e){if(Dy(e))return this.touchIds=new Set(T_(e)),this.touchIds;if("pointerId"in e)return e.type==="pointerup"||e.type==="pointercancel"?this.pointerIds.delete(e.pointerId):e.type==="pointerdown"&&this.pointerIds.add(e.pointerId),this.pointerIds}applyHandlers(e,t){this.handlers=e,this.nativeHandlers=t}applyConfig(e,t){this.config=AU(e,t,this.config)}clean(){this._targetEventStore.clean();for(const e of this.gestures)this.gestureEventStores[e].clean(),this.gestureTimeoutStores[e].clean()}effect(){return this.config.shared.target&&this.bind(),()=>this._targetEventStore.clean()}bind(...e){const t=this.config.shared,n={};let i;if(!(t.target&&(i=t.target(),!i))){if(t.enabled){for(const o of this.gestures){const r=this.config[o],g=u1(n,r.eventOptions,!!i);if(r.enabled){const u=lH.get(o);new u(this,e,o).bind(g)}}const s=u1(n,t.eventOptions,!!i);for(const o in this.nativeHandlers)s(o,"",r=>this.nativeHandlers[o](Ji(Ji({},this.state.shared),{},{event:r,args:e})),void 0,!0)}for(const s in n)n[s]=__(...n[s]);if(!i)return n;for(const s in n){const{device:o,capture:r,passive:g}=Y_(s);this._targetEventStore.add(i,o,"",n[s],{capture:r,passive:g})}}}}function Kd(a,e){a.gestures.add(e),a.gestureEventStores[e]=new rH(a,e),a.gestureTimeoutStores[e]=new hU}function pU(a,e){e.drag&&Kd(a,"drag"),e.wheel&&Kd(a,"wheel"),e.scroll&&Kd(a,"scroll"),e.move&&Kd(a,"move"),e.pinch&&Kd(a,"pinch"),e.hover&&Kd(a,"hover")}const u1=(a,e,t)=>(n,i,s,o={},r=!1)=>{var g,u;const C=(g=o.capture)!==null&&g!==void 0?g:e.capture,h=(u=o.passive)!==null&&u!==void 0?u:e.passive;let f=r?n:X_(n,i,C);t&&h&&(f+="Passive"),a[f]=a[f]||[],a[f].push(s)};function mU(a,e={},t,n){const i=fe.useMemo(()=>new fU(a),[]);if(i.applyHandlers(a,n),i.applyConfig(e,t),fe.useEffect(i.effect.bind(i)),fe.useEffect(()=>i.clean.bind(i),[]),e.target===void 0)return i.bind.bind(i)}function bU(a,e){return gU(cU),mU({drag:a},e||{},"drag")}const yU=parseInt(Lf.replace(/\D+/g,""));function I1(a,e){if(e===mV)return console.warn("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Geometry already defined as triangles."),a;if(e===M0||e===P2){let t=a.getIndex();if(t===null){const o=[],r=a.getAttribute("position");if(r!==void 0){for(let g=0;g<r.count;g++)o.push(g);a.setIndex(o),t=a.getIndex()}else return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),a}const n=t.count-2,i=[];if(t)if(e===M0)for(let o=1;o<=n;o++)i.push(t.getX(0)),i.push(t.getX(o)),i.push(t.getX(o+1));else for(let o=0;o<n;o++)o%2===0?(i.push(t.getX(o)),i.push(t.getX(o+1)),i.push(t.getX(o+2))):(i.push(t.getX(o+2)),i.push(t.getX(o+1)),i.push(t.getX(o)));i.length/3!==n&&console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");const s=a.clone();return s.setIndex(i),s.clearGroups(),s}else return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unknown draw mode:",e),a}var GU=Object.defineProperty,BU=(a,e,t)=>e in a?GU(a,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):a[e]=t,vU=(a,e,t)=>(BU(a,e+"",t),t);class ZU{constructor(){vU(this,"_listeners")}addEventListener(e,t){this._listeners===void 0&&(this._listeners={});const n=this._listeners;n[e]===void 0&&(n[e]=[]),n[e].indexOf(t)===-1&&n[e].push(t)}hasEventListener(e,t){if(this._listeners===void 0)return!1;const n=this._listeners;return n[e]!==void 0&&n[e].indexOf(t)!==-1}removeEventListener(e,t){if(this._listeners===void 0)return;const i=this._listeners[e];if(i!==void 0){const s=i.indexOf(t);s!==-1&&i.splice(s,1)}}dispatchEvent(e){if(this._listeners===void 0)return;const n=this._listeners[e.type];if(n!==void 0){e.target=this;const i=n.slice(0);for(let s=0,o=i.length;s<o;s++)i[s].call(this,e);e.target=null}}}var SU=Object.defineProperty,RU=(a,e,t)=>e in a?SU(a,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):a[e]=t,Dt=(a,e,t)=>(RU(a,typeof e!="symbol"?e+"":e,t),t);const Gb=new AC,C1=new nc,wU=Math.cos(70*(Math.PI/180)),d1=(a,e)=>(a%e+e)%e;let xU=class extends ZU{constructor(e,t){super(),Dt(this,"object"),Dt(this,"domElement"),Dt(this,"enabled",!0),Dt(this,"target",new ae),Dt(this,"minDistance",0),Dt(this,"maxDistance",1/0),Dt(this,"minZoom",0),Dt(this,"maxZoom",1/0),Dt(this,"minPolarAngle",0),Dt(this,"maxPolarAngle",Math.PI),Dt(this,"minAzimuthAngle",-1/0),Dt(this,"maxAzimuthAngle",1/0),Dt(this,"enableDamping",!1),Dt(this,"dampingFactor",.05),Dt(this,"enableZoom",!0),Dt(this,"zoomSpeed",1),Dt(this,"enableRotate",!0),Dt(this,"rotateSpeed",1),Dt(this,"enablePan",!0),Dt(this,"panSpeed",1),Dt(this,"screenSpacePanning",!0),Dt(this,"keyPanSpeed",7),Dt(this,"zoomToCursor",!1),Dt(this,"autoRotate",!1),Dt(this,"autoRotateSpeed",2),Dt(this,"reverseOrbit",!1),Dt(this,"reverseHorizontalOrbit",!1),Dt(this,"reverseVerticalOrbit",!1),Dt(this,"keys",{LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"}),Dt(this,"mouseButtons",{LEFT:YI.ROTATE,MIDDLE:YI.DOLLY,RIGHT:YI.PAN}),Dt(this,"touches",{ONE:KI.ROTATE,TWO:KI.DOLLY_PAN}),Dt(this,"target0"),Dt(this,"position0"),Dt(this,"zoom0"),Dt(this,"_domElementKeyEvents",null),Dt(this,"getPolarAngle"),Dt(this,"getAzimuthalAngle"),Dt(this,"setPolarAngle"),Dt(this,"setAzimuthalAngle"),Dt(this,"getDistance"),Dt(this,"getZoomScale"),Dt(this,"listenToKeyEvents"),Dt(this,"stopListenToKeyEvents"),Dt(this,"saveState"),Dt(this,"reset"),Dt(this,"update"),Dt(this,"connect"),Dt(this,"dispose"),Dt(this,"dollyIn"),Dt(this,"dollyOut"),Dt(this,"getScale"),Dt(this,"setScale"),this.object=e,this.domElement=t,this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this.getPolarAngle=()=>C.phi,this.getAzimuthalAngle=()=>C.theta,this.setPolarAngle=ue=>{let xe=d1(ue,2*Math.PI),ct=C.phi;ct<0&&(ct+=2*Math.PI),xe<0&&(xe+=2*Math.PI);let Ie=Math.abs(xe-ct);2*Math.PI-Ie<Ie&&(xe<ct?xe+=2*Math.PI:ct+=2*Math.PI),h.phi=xe-ct,n.update()},this.setAzimuthalAngle=ue=>{let xe=d1(ue,2*Math.PI),ct=C.theta;ct<0&&(ct+=2*Math.PI),xe<0&&(xe+=2*Math.PI);let Ie=Math.abs(xe-ct);2*Math.PI-Ie<Ie&&(xe<ct?xe+=2*Math.PI:ct+=2*Math.PI),h.theta=xe-ct,n.update()},this.getDistance=()=>n.object.position.distanceTo(n.target),this.listenToKeyEvents=ue=>{ue.addEventListener("keydown",we),this._domElementKeyEvents=ue},this.stopListenToKeyEvents=()=>{this._domElementKeyEvents.removeEventListener("keydown",we),this._domElementKeyEvents=null},this.saveState=()=>{n.target0.copy(n.target),n.position0.copy(n.object.position),n.zoom0=n.object.zoom},this.reset=()=>{n.target.copy(n.target0),n.object.position.copy(n.position0),n.object.zoom=n.zoom0,n.object.updateProjectionMatrix(),n.dispatchEvent(i),n.update(),g=r.NONE},this.update=(()=>{const ue=new ae,xe=new ae(0,1,0),ct=new ca().setFromUnitVectors(e.up,xe),Ie=ct.clone().invert(),Qe=new ae,je=new ca,mt=2*Math.PI;return function(){const _e=n.object.position;ct.setFromUnitVectors(e.up,xe),Ie.copy(ct).invert(),ue.copy(_e).sub(n.target),ue.applyQuaternion(ct),C.setFromVector3(ue),n.autoRotate&&g===r.NONE&&ie(O()),n.enableDamping?(C.theta+=h.theta*n.dampingFactor,C.phi+=h.phi*n.dampingFactor):(C.theta+=h.theta,C.phi+=h.phi);let ht=n.minAzimuthAngle,yt=n.maxAzimuthAngle;isFinite(ht)&&isFinite(yt)&&(ht<-Math.PI?ht+=mt:ht>Math.PI&&(ht-=mt),yt<-Math.PI?yt+=mt:yt>Math.PI&&(yt-=mt),ht<=yt?C.theta=Math.max(ht,Math.min(yt,C.theta)):C.theta=C.theta>(ht+yt)/2?Math.max(ht,C.theta):Math.min(yt,C.theta)),C.phi=Math.max(n.minPolarAngle,Math.min(n.maxPolarAngle,C.phi)),C.makeSafe(),n.enableDamping===!0?n.target.addScaledVector(p,n.dampingFactor):n.target.add(p),n.zoomToCursor&&Y||n.object.isOrthographicCamera?C.radius=oe(C.radius):C.radius=oe(C.radius*f),ue.setFromSpherical(C),ue.applyQuaternion(Ie),_e.copy(n.target).add(ue),n.object.matrixAutoUpdate||n.object.updateMatrix(),n.object.lookAt(n.target),n.enableDamping===!0?(h.theta*=1-n.dampingFactor,h.phi*=1-n.dampingFactor,p.multiplyScalar(1-n.dampingFactor)):(h.set(0,0,0),p.set(0,0,0));let Bt=!1;if(n.zoomToCursor&&Y){let xt=null;if(n.object instanceof Xi&&n.object.isPerspectiveCamera){const Gn=ue.length();xt=oe(Gn*f);const gn=Gn-xt;n.object.position.addScaledVector(N,gn),n.object.updateMatrixWorld()}else if(n.object.isOrthographicCamera){const Gn=new ae(F.x,F.y,0);Gn.unproject(n.object),n.object.zoom=Math.max(n.minZoom,Math.min(n.maxZoom,n.object.zoom/f)),n.object.updateProjectionMatrix(),Bt=!0;const gn=new ae(F.x,F.y,0);gn.unproject(n.object),n.object.position.sub(gn).add(Gn),n.object.updateMatrixWorld(),xt=ue.length()}else console.warn("WARNING: OrbitControls.js encountered an unknown camera type - zoom to cursor disabled."),n.zoomToCursor=!1;xt!==null&&(n.screenSpacePanning?n.target.set(0,0,-1).transformDirection(n.object.matrix).multiplyScalar(xt).add(n.object.position):(Gb.origin.copy(n.object.position),Gb.direction.set(0,0,-1).transformDirection(n.object.matrix),Math.abs(n.object.up.dot(Gb.direction))<wU?e.lookAt(n.target):(C1.setFromNormalAndCoplanarPoint(n.object.up,n.target),Gb.intersectPlane(C1,n.target))))}else n.object instanceof pr&&n.object.isOrthographicCamera&&(Bt=f!==1,Bt&&(n.object.zoom=Math.max(n.minZoom,Math.min(n.maxZoom,n.object.zoom/f)),n.object.updateProjectionMatrix()));return f=1,Y=!1,Bt||Qe.distanceToSquared(n.object.position)>u||8*(1-je.dot(n.object.quaternion))>u?(n.dispatchEvent(i),Qe.copy(n.object.position),je.copy(n.object.quaternion),Bt=!1,!0):!1}})(),this.connect=ue=>{n.domElement=ue,n.domElement.style.touchAction="none",n.domElement.addEventListener("contextmenu",Ct),n.domElement.addEventListener("pointerdown",gt),n.domElement.addEventListener("pointercancel",z),n.domElement.addEventListener("wheel",Ge)},this.dispose=()=>{var ue,xe,ct,Ie,Qe,je;n.domElement&&(n.domElement.style.touchAction="auto"),(ue=n.domElement)==null||ue.removeEventListener("contextmenu",Ct),(xe=n.domElement)==null||xe.removeEventListener("pointerdown",gt),(ct=n.domElement)==null||ct.removeEventListener("pointercancel",z),(Ie=n.domElement)==null||Ie.removeEventListener("wheel",Ge),(Qe=n.domElement)==null||Qe.ownerDocument.removeEventListener("pointermove",k),(je=n.domElement)==null||je.ownerDocument.removeEventListener("pointerup",z),n._domElementKeyEvents!==null&&n._domElementKeyEvents.removeEventListener("keydown",we)};const n=this,i={type:"change"},s={type:"start"},o={type:"end"},r={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6};let g=r.NONE;const u=1e-6,C=new Jv,h=new Jv;let f=1;const p=new ae,y=new at,v=new at,G=new at,B=new at,R=new at,x=new at,w=new at,M=new at,H=new at,N=new ae,F=new at;let Y=!1;const X=[],U={};function O(){return 2*Math.PI/60/60*n.autoRotateSpeed}function P(){return Math.pow(.95,n.zoomSpeed)}function ie(ue){n.reverseOrbit||n.reverseHorizontalOrbit?h.theta+=ue:h.theta-=ue}function le(ue){n.reverseOrbit||n.reverseVerticalOrbit?h.phi+=ue:h.phi-=ue}const T=(()=>{const ue=new ae;return function(ct,Ie){ue.setFromMatrixColumn(Ie,0),ue.multiplyScalar(-ct),p.add(ue)}})(),J=(()=>{const ue=new ae;return function(ct,Ie){n.screenSpacePanning===!0?ue.setFromMatrixColumn(Ie,1):(ue.setFromMatrixColumn(Ie,0),ue.crossVectors(n.object.up,ue)),ue.multiplyScalar(ct),p.add(ue)}})(),Q=(()=>{const ue=new ae;return function(ct,Ie){const Qe=n.domElement;if(Qe&&n.object instanceof Xi&&n.object.isPerspectiveCamera){const je=n.object.position;ue.copy(je).sub(n.target);let mt=ue.length();mt*=Math.tan(n.object.fov/2*Math.PI/180),T(2*ct*mt/Qe.clientHeight,n.object.matrix),J(2*Ie*mt/Qe.clientHeight,n.object.matrix)}else Qe&&n.object instanceof pr&&n.object.isOrthographicCamera?(T(ct*(n.object.right-n.object.left)/n.object.zoom/Qe.clientWidth,n.object.matrix),J(Ie*(n.object.top-n.object.bottom)/n.object.zoom/Qe.clientHeight,n.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),n.enablePan=!1)}})();function se(ue){n.object instanceof Xi&&n.object.isPerspectiveCamera||n.object instanceof pr&&n.object.isOrthographicCamera?f=ue:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),n.enableZoom=!1)}function L(ue){se(f/ue)}function D(ue){se(f*ue)}function ne(ue){if(!n.zoomToCursor||!n.domElement)return;Y=!0;const xe=n.domElement.getBoundingClientRect(),ct=ue.clientX-xe.left,Ie=ue.clientY-xe.top,Qe=xe.width,je=xe.height;F.x=ct/Qe*2-1,F.y=-(Ie/je)*2+1,N.set(F.x,F.y,1).unproject(n.object).sub(n.object.position).normalize()}function oe(ue){return Math.max(n.minDistance,Math.min(n.maxDistance,ue))}function j(ue){y.set(ue.clientX,ue.clientY)}function re(ue){ne(ue),w.set(ue.clientX,ue.clientY)}function pe(ue){B.set(ue.clientX,ue.clientY)}function me(ue){v.set(ue.clientX,ue.clientY),G.subVectors(v,y).multiplyScalar(n.rotateSpeed);const xe=n.domElement;xe&&(ie(2*Math.PI*G.x/xe.clientHeight),le(2*Math.PI*G.y/xe.clientHeight)),y.copy(v),n.update()}function be(ue){M.set(ue.clientX,ue.clientY),H.subVectors(M,w),H.y>0?L(P()):H.y<0&&D(P()),w.copy(M),n.update()}function $e(ue){R.set(ue.clientX,ue.clientY),x.subVectors(R,B).multiplyScalar(n.panSpeed),Q(x.x,x.y),B.copy(R),n.update()}function qe(ue){ne(ue),ue.deltaY<0?D(P()):ue.deltaY>0&&L(P()),n.update()}function ke(ue){let xe=!1;switch(ue.code){case n.keys.UP:Q(0,n.keyPanSpeed),xe=!0;break;case n.keys.BOTTOM:Q(0,-n.keyPanSpeed),xe=!0;break;case n.keys.LEFT:Q(n.keyPanSpeed,0),xe=!0;break;case n.keys.RIGHT:Q(-n.keyPanSpeed,0),xe=!0;break}xe&&(ue.preventDefault(),n.update())}function Te(){if(X.length==1)y.set(X[0].pageX,X[0].pageY);else{const ue=.5*(X[0].pageX+X[1].pageX),xe=.5*(X[0].pageY+X[1].pageY);y.set(ue,xe)}}function ut(){if(X.length==1)B.set(X[0].pageX,X[0].pageY);else{const ue=.5*(X[0].pageX+X[1].pageX),xe=.5*(X[0].pageY+X[1].pageY);B.set(ue,xe)}}function q(){const ue=X[0].pageX-X[1].pageX,xe=X[0].pageY-X[1].pageY,ct=Math.sqrt(ue*ue+xe*xe);w.set(0,ct)}function De(){n.enableZoom&&q(),n.enablePan&&ut()}function Ke(){n.enableZoom&&q(),n.enableRotate&&Te()}function Ee(ue){if(X.length==1)v.set(ue.pageX,ue.pageY);else{const ct=nt(ue),Ie=.5*(ue.pageX+ct.x),Qe=.5*(ue.pageY+ct.y);v.set(Ie,Qe)}G.subVectors(v,y).multiplyScalar(n.rotateSpeed);const xe=n.domElement;xe&&(ie(2*Math.PI*G.x/xe.clientHeight),le(2*Math.PI*G.y/xe.clientHeight)),y.copy(v)}function ye(ue){if(X.length==1)R.set(ue.pageX,ue.pageY);else{const xe=nt(ue),ct=.5*(ue.pageX+xe.x),Ie=.5*(ue.pageY+xe.y);R.set(ct,Ie)}x.subVectors(R,B).multiplyScalar(n.panSpeed),Q(x.x,x.y),B.copy(R)}function Je(ue){const xe=nt(ue),ct=ue.pageX-xe.x,Ie=ue.pageY-xe.y,Qe=Math.sqrt(ct*ct+Ie*Ie);M.set(0,Qe),H.set(0,Math.pow(M.y/w.y,n.zoomSpeed)),L(H.y),w.copy(M)}function Me(ue){n.enableZoom&&Je(ue),n.enablePan&&ye(ue)}function Ze(ue){n.enableZoom&&Je(ue),n.enableRotate&&Ee(ue)}function gt(ue){var xe,ct;n.enabled!==!1&&(X.length===0&&((xe=n.domElement)==null||xe.ownerDocument.addEventListener("pointermove",k),(ct=n.domElement)==null||ct.ownerDocument.addEventListener("pointerup",z)),At(ue),ue.pointerType==="touch"?et(ue):Ce(ue))}function k(ue){n.enabled!==!1&&(ue.pointerType==="touch"?lt(ue):Ve(ue))}function z(ue){var xe,ct,Ie;Ne(ue),X.length===0&&((xe=n.domElement)==null||xe.releasePointerCapture(ue.pointerId),(ct=n.domElement)==null||ct.ownerDocument.removeEventListener("pointermove",k),(Ie=n.domElement)==null||Ie.ownerDocument.removeEventListener("pointerup",z)),n.dispatchEvent(o),g=r.NONE}function Ce(ue){let xe;switch(ue.button){case 0:xe=n.mouseButtons.LEFT;break;case 1:xe=n.mouseButtons.MIDDLE;break;case 2:xe=n.mouseButtons.RIGHT;break;default:xe=-1}switch(xe){case YI.DOLLY:if(n.enableZoom===!1)return;re(ue),g=r.DOLLY;break;case YI.ROTATE:if(ue.ctrlKey||ue.metaKey||ue.shiftKey){if(n.enablePan===!1)return;pe(ue),g=r.PAN}else{if(n.enableRotate===!1)return;j(ue),g=r.ROTATE}break;case YI.PAN:if(ue.ctrlKey||ue.metaKey||ue.shiftKey){if(n.enableRotate===!1)return;j(ue),g=r.ROTATE}else{if(n.enablePan===!1)return;pe(ue),g=r.PAN}break;default:g=r.NONE}g!==r.NONE&&n.dispatchEvent(s)}function Ve(ue){if(n.enabled!==!1)switch(g){case r.ROTATE:if(n.enableRotate===!1)return;me(ue);break;case r.DOLLY:if(n.enableZoom===!1)return;be(ue);break;case r.PAN:if(n.enablePan===!1)return;$e(ue);break}}function Ge(ue){n.enabled===!1||n.enableZoom===!1||g!==r.NONE&&g!==r.ROTATE||(ue.preventDefault(),n.dispatchEvent(s),qe(ue),n.dispatchEvent(o))}function we(ue){n.enabled===!1||n.enablePan===!1||ke(ue)}function et(ue){switch(tt(ue),X.length){case 1:switch(n.touches.ONE){case KI.ROTATE:if(n.enableRotate===!1)return;Te(),g=r.TOUCH_ROTATE;break;case KI.PAN:if(n.enablePan===!1)return;ut(),g=r.TOUCH_PAN;break;default:g=r.NONE}break;case 2:switch(n.touches.TWO){case KI.DOLLY_PAN:if(n.enableZoom===!1&&n.enablePan===!1)return;De(),g=r.TOUCH_DOLLY_PAN;break;case KI.DOLLY_ROTATE:if(n.enableZoom===!1&&n.enableRotate===!1)return;Ke(),g=r.TOUCH_DOLLY_ROTATE;break;default:g=r.NONE}break;default:g=r.NONE}g!==r.NONE&&n.dispatchEvent(s)}function lt(ue){switch(tt(ue),g){case r.TOUCH_ROTATE:if(n.enableRotate===!1)return;Ee(ue),n.update();break;case r.TOUCH_PAN:if(n.enablePan===!1)return;ye(ue),n.update();break;case r.TOUCH_DOLLY_PAN:if(n.enableZoom===!1&&n.enablePan===!1)return;Me(ue),n.update();break;case r.TOUCH_DOLLY_ROTATE:if(n.enableZoom===!1&&n.enableRotate===!1)return;Ze(ue),n.update();break;default:g=r.NONE}}function Ct(ue){n.enabled!==!1&&ue.preventDefault()}function At(ue){X.push(ue)}function Ne(ue){delete U[ue.pointerId];for(let xe=0;xe<X.length;xe++)if(X[xe].pointerId==ue.pointerId){X.splice(xe,1);return}}function tt(ue){let xe=U[ue.pointerId];xe===void 0&&(xe=new at,U[ue.pointerId]=xe),xe.set(ue.pageX,ue.pageY)}function nt(ue){const xe=ue.pointerId===X[0].pointerId?X[1]:X[0];return U[xe.pointerId]}this.dollyIn=(ue=P())=>{D(ue),n.update()},this.dollyOut=(ue=P())=>{L(ue),n.update()},this.getScale=()=>f,this.setScale=ue=>{se(ue),n.update()},this.getZoomScale=()=>P(),t!==void 0&&this.connect(t),this.update()}};function _0(a){if(typeof TextDecoder<"u")return new TextDecoder().decode(a);let e="";for(let t=0,n=a.length;t<n;t++)e+=String.fromCharCode(a[t]);try{return decodeURIComponent(escape(e))}catch{return e}}const QI="srgb",Ic="srgb-linear",A1=3001,WU=3e3;class XZ extends Zs{constructor(e){super(e),this.dracoLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register(function(t){return new NU(t)}),this.register(function(t){return new YU(t)}),this.register(function(t){return new DU(t)}),this.register(function(t){return new kU(t)}),this.register(function(t){return new OU(t)}),this.register(function(t){return new FU(t)}),this.register(function(t){return new EU(t)}),this.register(function(t){return new TU(t)}),this.register(function(t){return new zU(t)}),this.register(function(t){return new XU(t)}),this.register(function(t){return new LU(t)}),this.register(function(t){return new KU(t)}),this.register(function(t){return new UU(t)}),this.register(function(t){return new _U(t)}),this.register(function(t){return new MU(t)}),this.register(function(t){return new JU(t)}),this.register(function(t){return new PU(t)})}load(e,t,n,i){const s=this;let o;if(this.resourcePath!=="")o=this.resourcePath;else if(this.path!==""){const u=bu.extractUrlBase(e);o=bu.resolveURL(u,this.path)}else o=bu.extractUrlBase(e);this.manager.itemStart(e);const r=function(u){i?i(u):console.error(u),s.manager.itemError(e),s.manager.itemEnd(e)},g=new Qo(this.manager);g.setPath(this.path),g.setResponseType("arraybuffer"),g.setRequestHeader(this.requestHeader),g.setWithCredentials(this.withCredentials),g.load(e,function(u){try{s.parse(u,o,function(C){t(C),s.manager.itemEnd(e)},r)}catch(C){r(C)}},n,r)}setDRACOLoader(e){return this.dracoLoader=e,this}setDDSLoader(){throw new Error('THREE.GLTFLoader: "MSFT_texture_dds" no longer supported. Please update to "KHR_texture_basisu".')}setKTX2Loader(e){return this.ktx2Loader=e,this}setMeshoptDecoder(e){return this.meshoptDecoder=e,this}register(e){return this.pluginCallbacks.indexOf(e)===-1&&this.pluginCallbacks.push(e),this}unregister(e){return this.pluginCallbacks.indexOf(e)!==-1&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(e),1),this}parse(e,t,n,i){let s;const o={},r={};if(typeof e=="string")s=JSON.parse(e);else if(e instanceof ArrayBuffer)if(_0(new Uint8Array(e.slice(0,4)))===gH){try{o[Rn.KHR_BINARY_GLTF]=new QU(e)}catch(C){i&&i(C);return}s=JSON.parse(o[Rn.KHR_BINARY_GLTF].content)}else s=JSON.parse(_0(new Uint8Array(e)));else s=e;if(s.asset===void 0||s.asset.version[0]<2){i&&i(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported."));return}const g=new gD(s,{path:t||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});g.fileLoader.setRequestHeader(this.requestHeader);for(let u=0;u<this.pluginCallbacks.length;u++){const C=this.pluginCallbacks[u](g);C.name||console.error("THREE.GLTFLoader: Invalid plugin found: missing name"),r[C.name]=C,o[C.name]=!0}if(s.extensionsUsed)for(let u=0;u<s.extensionsUsed.length;++u){const C=s.extensionsUsed[u],h=s.extensionsRequired||[];switch(C){case Rn.KHR_MATERIALS_UNLIT:o[C]=new HU;break;case Rn.KHR_DRACO_MESH_COMPRESSION:o[C]=new jU(s,this.dracoLoader);break;case Rn.KHR_TEXTURE_TRANSFORM:o[C]=new qU;break;case Rn.KHR_MESH_QUANTIZATION:o[C]=new $U;break;default:h.indexOf(C)>=0&&r[C]===void 0&&console.warn('THREE.GLTFLoader: Unknown extension "'+C+'".')}}g.setExtensions(o),g.setPlugins(r),g.parse(n,i)}parseAsync(e,t){const n=this;return new Promise(function(i,s){n.parse(e,t,i,s)})}}function VU(){let a={};return{get:function(e){return a[e]},add:function(e,t){a[e]=t},remove:function(e){delete a[e]},removeAll:function(){a={}}}}const Rn={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_DISPERSION:"KHR_materials_dispersion",KHR_MATERIALS_IOR:"KHR_materials_ior",KHR_MATERIALS_SHEEN:"KHR_materials_sheen",KHR_MATERIALS_SPECULAR:"KHR_materials_specular",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_IRIDESCENCE:"KHR_materials_iridescence",KHR_MATERIALS_ANISOTROPY:"KHR_materials_anisotropy",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_MATERIALS_VOLUME:"KHR_materials_volume",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",KHR_MATERIALS_EMISSIVE_STRENGTH:"KHR_materials_emissive_strength",EXT_MATERIALS_BUMP:"EXT_materials_bump",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_TEXTURE_AVIF:"EXT_texture_avif",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression",EXT_MESH_GPU_INSTANCING:"EXT_mesh_gpu_instancing"};class MU{constructor(e){this.parser=e,this.name=Rn.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}_markDefs(){const e=this.parser,t=this.parser.json.nodes||[];for(let n=0,i=t.length;n<i;n++){const s=t[n];s.extensions&&s.extensions[this.name]&&s.extensions[this.name].light!==void 0&&e._addNodeRef(this.cache,s.extensions[this.name].light)}}_loadLight(e){const t=this.parser,n="light:"+e;let i=t.cache.get(n);if(i)return i;const s=t.json,g=((s.extensions&&s.extensions[this.name]||{}).lights||[])[e];let u;const C=new Gt(16777215);g.color!==void 0&&C.setRGB(g.color[0],g.color[1],g.color[2],Ic);const h=g.range!==void 0?g.range:0;switch(g.type){case"directional":u=new bZ(C),u.target.position.set(0,0,-1),u.add(u.target);break;case"point":u=new mZ(C),u.distance=h;break;case"spot":u=new pZ(C),u.distance=h,g.spot=g.spot||{},g.spot.innerConeAngle=g.spot.innerConeAngle!==void 0?g.spot.innerConeAngle:0,g.spot.outerConeAngle=g.spot.outerConeAngle!==void 0?g.spot.outerConeAngle:Math.PI/4,u.angle=g.spot.outerConeAngle,u.penumbra=1-g.spot.innerConeAngle/g.spot.outerConeAngle,u.target.position.set(0,0,-1),u.add(u.target);break;default:throw new Error("THREE.GLTFLoader: Unexpected light type: "+g.type)}return u.position.set(0,0,0),u.decay=2,tc(u,g),g.intensity!==void 0&&(u.intensity=g.intensity),u.name=t.createUniqueName(g.name||"light_"+e),i=Promise.resolve(u),t.cache.add(n,i),i}getDependency(e,t){if(e==="light")return this._loadLight(t)}createNodeAttachment(e){const t=this,n=this.parser,s=n.json.nodes[e],r=(s.extensions&&s.extensions[this.name]||{}).light;return r===void 0?null:this._loadLight(r).then(function(g){return n._getNodeRef(t.cache,r,g)})}}class HU{constructor(){this.name=Rn.KHR_MATERIALS_UNLIT}getMaterialType(){return wo}extendParams(e,t,n){const i=[];e.color=new Gt(1,1,1),e.opacity=1;const s=t.pbrMetallicRoughness;if(s){if(Array.isArray(s.baseColorFactor)){const o=s.baseColorFactor;e.color.setRGB(o[0],o[1],o[2],Ic),e.opacity=o[3]}s.baseColorTexture!==void 0&&i.push(n.assignTexture(e,"map",s.baseColorTexture,QI))}return Promise.all(i)}}class XU{constructor(e){this.parser=e,this.name=Rn.KHR_MATERIALS_EMISSIVE_STRENGTH}extendMaterialParams(e,t){const i=this.parser.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const s=i.extensions[this.name].emissiveStrength;return s!==void 0&&(t.emissiveIntensity=s),Promise.resolve()}}class NU{constructor(e){this.parser=e,this.name=Rn.KHR_MATERIALS_CLEARCOAT}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:Sl}extendMaterialParams(e,t){const n=this.parser,i=n.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const s=[],o=i.extensions[this.name];if(o.clearcoatFactor!==void 0&&(t.clearcoat=o.clearcoatFactor),o.clearcoatTexture!==void 0&&s.push(n.assignTexture(t,"clearcoatMap",o.clearcoatTexture)),o.clearcoatRoughnessFactor!==void 0&&(t.clearcoatRoughness=o.clearcoatRoughnessFactor),o.clearcoatRoughnessTexture!==void 0&&s.push(n.assignTexture(t,"clearcoatRoughnessMap",o.clearcoatRoughnessTexture)),o.clearcoatNormalTexture!==void 0&&(s.push(n.assignTexture(t,"clearcoatNormalMap",o.clearcoatNormalTexture)),o.clearcoatNormalTexture.scale!==void 0)){const r=o.clearcoatNormalTexture.scale;t.clearcoatNormalScale=new at(r,r)}return Promise.all(s)}}class YU{constructor(e){this.parser=e,this.name=Rn.KHR_MATERIALS_DISPERSION}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:Sl}extendMaterialParams(e,t){const i=this.parser.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const s=i.extensions[this.name];return t.dispersion=s.dispersion!==void 0?s.dispersion:0,Promise.resolve()}}class KU{constructor(e){this.parser=e,this.name=Rn.KHR_MATERIALS_IRIDESCENCE}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:Sl}extendMaterialParams(e,t){const n=this.parser,i=n.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const s=[],o=i.extensions[this.name];return o.iridescenceFactor!==void 0&&(t.iridescence=o.iridescenceFactor),o.iridescenceTexture!==void 0&&s.push(n.assignTexture(t,"iridescenceMap",o.iridescenceTexture)),o.iridescenceIor!==void 0&&(t.iridescenceIOR=o.iridescenceIor),t.iridescenceThicknessRange===void 0&&(t.iridescenceThicknessRange=[100,400]),o.iridescenceThicknessMinimum!==void 0&&(t.iridescenceThicknessRange[0]=o.iridescenceThicknessMinimum),o.iridescenceThicknessMaximum!==void 0&&(t.iridescenceThicknessRange[1]=o.iridescenceThicknessMaximum),o.iridescenceThicknessTexture!==void 0&&s.push(n.assignTexture(t,"iridescenceThicknessMap",o.iridescenceThicknessTexture)),Promise.all(s)}}class FU{constructor(e){this.parser=e,this.name=Rn.KHR_MATERIALS_SHEEN}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:Sl}extendMaterialParams(e,t){const n=this.parser,i=n.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const s=[];t.sheenColor=new Gt(0,0,0),t.sheenRoughness=0,t.sheen=1;const o=i.extensions[this.name];if(o.sheenColorFactor!==void 0){const r=o.sheenColorFactor;t.sheenColor.setRGB(r[0],r[1],r[2],Ic)}return o.sheenRoughnessFactor!==void 0&&(t.sheenRoughness=o.sheenRoughnessFactor),o.sheenColorTexture!==void 0&&s.push(n.assignTexture(t,"sheenColorMap",o.sheenColorTexture,QI)),o.sheenRoughnessTexture!==void 0&&s.push(n.assignTexture(t,"sheenRoughnessMap",o.sheenRoughnessTexture)),Promise.all(s)}}class EU{constructor(e){this.parser=e,this.name=Rn.KHR_MATERIALS_TRANSMISSION}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:Sl}extendMaterialParams(e,t){const n=this.parser,i=n.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const s=[],o=i.extensions[this.name];return o.transmissionFactor!==void 0&&(t.transmission=o.transmissionFactor),o.transmissionTexture!==void 0&&s.push(n.assignTexture(t,"transmissionMap",o.transmissionTexture)),Promise.all(s)}}class TU{constructor(e){this.parser=e,this.name=Rn.KHR_MATERIALS_VOLUME}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:Sl}extendMaterialParams(e,t){const n=this.parser,i=n.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const s=[],o=i.extensions[this.name];t.thickness=o.thicknessFactor!==void 0?o.thicknessFactor:0,o.thicknessTexture!==void 0&&s.push(n.assignTexture(t,"thicknessMap",o.thicknessTexture)),t.attenuationDistance=o.attenuationDistance||1/0;const r=o.attenuationColor||[1,1,1];return t.attenuationColor=new Gt().setRGB(r[0],r[1],r[2],Ic),Promise.all(s)}}class zU{constructor(e){this.parser=e,this.name=Rn.KHR_MATERIALS_IOR}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:Sl}extendMaterialParams(e,t){const i=this.parser.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const s=i.extensions[this.name];return t.ior=s.ior!==void 0?s.ior:1.5,Promise.resolve()}}class LU{constructor(e){this.parser=e,this.name=Rn.KHR_MATERIALS_SPECULAR}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:Sl}extendMaterialParams(e,t){const n=this.parser,i=n.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const s=[],o=i.extensions[this.name];t.specularIntensity=o.specularFactor!==void 0?o.specularFactor:1,o.specularTexture!==void 0&&s.push(n.assignTexture(t,"specularIntensityMap",o.specularTexture));const r=o.specularColorFactor||[1,1,1];return t.specularColor=new Gt().setRGB(r[0],r[1],r[2],Ic),o.specularColorTexture!==void 0&&s.push(n.assignTexture(t,"specularColorMap",o.specularColorTexture,QI)),Promise.all(s)}}class _U{constructor(e){this.parser=e,this.name=Rn.EXT_MATERIALS_BUMP}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:Sl}extendMaterialParams(e,t){const n=this.parser,i=n.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const s=[],o=i.extensions[this.name];return t.bumpScale=o.bumpFactor!==void 0?o.bumpFactor:1,o.bumpTexture!==void 0&&s.push(n.assignTexture(t,"bumpMap",o.bumpTexture)),Promise.all(s)}}class UU{constructor(e){this.parser=e,this.name=Rn.KHR_MATERIALS_ANISOTROPY}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:Sl}extendMaterialParams(e,t){const n=this.parser,i=n.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const s=[],o=i.extensions[this.name];return o.anisotropyStrength!==void 0&&(t.anisotropy=o.anisotropyStrength),o.anisotropyRotation!==void 0&&(t.anisotropyRotation=o.anisotropyRotation),o.anisotropyTexture!==void 0&&s.push(n.assignTexture(t,"anisotropyMap",o.anisotropyTexture)),Promise.all(s)}}class DU{constructor(e){this.parser=e,this.name=Rn.KHR_TEXTURE_BASISU}loadTexture(e){const t=this.parser,n=t.json,i=n.textures[e];if(!i.extensions||!i.extensions[this.name])return null;const s=i.extensions[this.name],o=t.options.ktx2Loader;if(!o){if(n.extensionsRequired&&n.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}return t.loadTextureImage(e,s.source,o)}}class kU{constructor(e){this.parser=e,this.name=Rn.EXT_TEXTURE_WEBP,this.isSupported=null}loadTexture(e){const t=this.name,n=this.parser,i=n.json,s=i.textures[e];if(!s.extensions||!s.extensions[t])return null;const o=s.extensions[t],r=i.images[o.source];let g=n.textureLoader;if(r.uri){const u=n.options.manager.getHandler(r.uri);u!==null&&(g=u)}return this.detectSupport().then(function(u){if(u)return n.loadTextureImage(e,o.source,g);if(i.extensionsRequired&&i.extensionsRequired.indexOf(t)>=0)throw new Error("THREE.GLTFLoader: WebP required by asset but unsupported.");return n.loadTexture(e)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(e){const t=new Image;t.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",t.onload=t.onerror=function(){e(t.height===1)}})),this.isSupported}}class OU{constructor(e){this.parser=e,this.name=Rn.EXT_TEXTURE_AVIF,this.isSupported=null}loadTexture(e){const t=this.name,n=this.parser,i=n.json,s=i.textures[e];if(!s.extensions||!s.extensions[t])return null;const o=s.extensions[t],r=i.images[o.source];let g=n.textureLoader;if(r.uri){const u=n.options.manager.getHandler(r.uri);u!==null&&(g=u)}return this.detectSupport().then(function(u){if(u)return n.loadTextureImage(e,o.source,g);if(i.extensionsRequired&&i.extensionsRequired.indexOf(t)>=0)throw new Error("THREE.GLTFLoader: AVIF required by asset but unsupported.");return n.loadTexture(e)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(e){const t=new Image;t.src="data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAABcAAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAEAAAABAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQAMAAAAABNjb2xybmNseAACAAIABoAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAAB9tZGF0EgAKCBgABogQEDQgMgkQAAAAB8dSLfI=",t.onload=t.onerror=function(){e(t.height===1)}})),this.isSupported}}class JU{constructor(e){this.name=Rn.EXT_MESHOPT_COMPRESSION,this.parser=e}loadBufferView(e){const t=this.parser.json,n=t.bufferViews[e];if(n.extensions&&n.extensions[this.name]){const i=n.extensions[this.name],s=this.parser.getDependency("buffer",i.buffer),o=this.parser.options.meshoptDecoder;if(!o||!o.supported){if(t.extensionsRequired&&t.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return s.then(function(r){const g=i.byteOffset||0,u=i.byteLength||0,C=i.count,h=i.byteStride,f=new Uint8Array(r,g,u);return o.decodeGltfBufferAsync?o.decodeGltfBufferAsync(C,h,f,i.mode,i.filter).then(function(p){return p.buffer}):o.ready.then(function(){const p=new ArrayBuffer(C*h);return o.decodeGltfBuffer(new Uint8Array(p),C,h,f,i.mode,i.filter),p})})}else return null}}class PU{constructor(e){this.name=Rn.EXT_MESH_GPU_INSTANCING,this.parser=e}createNodeMesh(e){const t=this.parser.json,n=t.nodes[e];if(!n.extensions||!n.extensions[this.name]||n.mesh===void 0)return null;const i=t.meshes[n.mesh];for(const u of i.primitives)if(u.mode!==ml.TRIANGLES&&u.mode!==ml.TRIANGLE_STRIP&&u.mode!==ml.TRIANGLE_FAN&&u.mode!==void 0)return null;const o=n.extensions[this.name].attributes,r=[],g={};for(const u in o)r.push(this.parser.getDependency("accessor",o[u]).then(C=>(g[u]=C,g[u])));return r.length<1?null:(r.push(this.parser.createNodeMesh(e)),Promise.all(r).then(u=>{const C=u.pop(),h=C.isGroup?C.children:[C],f=u[0].count,p=[];for(const y of h){const v=new Yt,G=new ae,B=new ca,R=new ae(1,1,1),x=new eC(y.geometry,y.material,f);for(let w=0;w<f;w++)g.TRANSLATION&&G.fromBufferAttribute(g.TRANSLATION,w),g.ROTATION&&B.fromBufferAttribute(g.ROTATION,w),g.SCALE&&R.fromBufferAttribute(g.SCALE,w),x.setMatrixAt(w,v.compose(G,B,R));for(const w in g)if(w==="_COLOR_0"){const M=g[w];x.instanceColor=new Su(M.array,M.itemSize,M.normalized)}else w!=="TRANSLATION"&&w!=="ROTATION"&&w!=="SCALE"&&y.geometry.setAttribute(w,g[w]);wn.prototype.copy.call(x,y),this.parser.assignFinalMaterial(x),p.push(x)}return C.isGroup?(C.clear(),C.add(...p),C):p[0]}))}}const gH="glTF",kh=12,h1={JSON:1313821514,BIN:5130562};class QU{constructor(e){this.name=Rn.KHR_BINARY_GLTF,this.content=null,this.body=null;const t=new DataView(e,0,kh);if(this.header={magic:_0(new Uint8Array(e.slice(0,4))),version:t.getUint32(4,!0),length:t.getUint32(8,!0)},this.header.magic!==gH)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");const n=this.header.length-kh,i=new DataView(e,kh);let s=0;for(;s<n;){const o=i.getUint32(s,!0);s+=4;const r=i.getUint32(s,!0);if(s+=4,r===h1.JSON){const g=new Uint8Array(e,kh+s,o);this.content=_0(g)}else if(r===h1.BIN){const g=kh+s;this.body=e.slice(g,g+o)}s+=o}if(this.content===null)throw new Error("THREE.GLTFLoader: JSON content not found.")}}class jU{constructor(e,t){if(!t)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=Rn.KHR_DRACO_MESH_COMPRESSION,this.json=e,this.dracoLoader=t,this.dracoLoader.preload()}decodePrimitive(e,t){const n=this.json,i=this.dracoLoader,s=e.extensions[this.name].bufferView,o=e.extensions[this.name].attributes,r={},g={},u={};for(const C in o){const h=o2[C]||C.toLowerCase();r[h]=o[C]}for(const C in e.attributes){const h=o2[C]||C.toLowerCase();if(o[C]!==void 0){const f=n.accessors[e.attributes[C]],p=Od[f.componentType];u[h]=p.name,g[h]=f.normalized===!0}}return t.getDependency("bufferView",s).then(function(C){return new Promise(function(h,f){i.decodeDracoFile(C,function(p){for(const y in p.attributes){const v=p.attributes[y],G=g[y];G!==void 0&&(v.normalized=G)}h(p)},r,u,Ic,f)})})}}class qU{constructor(){this.name=Rn.KHR_TEXTURE_TRANSFORM}extendTexture(e,t){return(t.texCoord===void 0||t.texCoord===e.channel)&&t.offset===void 0&&t.rotation===void 0&&t.scale===void 0||(e=e.clone(),t.texCoord!==void 0&&(e.channel=t.texCoord),t.offset!==void 0&&e.offset.fromArray(t.offset),t.rotation!==void 0&&(e.rotation=t.rotation),t.scale!==void 0&&e.repeat.fromArray(t.scale),e.needsUpdate=!0),e}}class $U{constructor(){this.name=Rn.KHR_MESH_QUANTIZATION}}class cH extends dA{constructor(e,t,n,i){super(e,t,n,i)}copySampleValue_(e){const t=this.resultBuffer,n=this.sampleValues,i=this.valueSize,s=e*i*3+i;for(let o=0;o!==i;o++)t[o]=n[s+o];return t}interpolate_(e,t,n,i){const s=this.resultBuffer,o=this.sampleValues,r=this.valueSize,g=r*2,u=r*3,C=i-t,h=(n-t)/C,f=h*h,p=f*h,y=e*u,v=y-u,G=-2*p+3*f,B=p-f,R=1-G,x=B-f+h;for(let w=0;w!==r;w++){const M=o[v+w+r],H=o[v+w+g]*C,N=o[y+w+r],F=o[y+w]*C;s[w]=R*M+x*H+G*N+B*F}return s}}const eD=new ca;class tD extends cH{interpolate_(e,t,n,i){const s=super.interpolate_(e,t,n,i);return eD.fromArray(s).normalize().toArray(s),s}}const ml={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6},Od={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},f1={9728:Fa,9729:Bi,9984:ly,9985:Ud,9986:UI,9987:yl},p1={33071:Jo,33648:Qd,10497:Bu},jB={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},o2={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",...yU>=152?{TEXCOORD_0:"uv",TEXCOORD_1:"uv1",TEXCOORD_2:"uv2",TEXCOORD_3:"uv3"}:{TEXCOORD_0:"uv",TEXCOORD_1:"uv2"},COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},Au={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},nD={CUBICSPLINE:void 0,LINEAR:nA,STEP:tA},qB={OPAQUE:"OPAQUE",MASK:"MASK",BLEND:"BLEND"};function iD(a){return a.DefaultMaterial===void 0&&(a.DefaultMaterial=new qf({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:fg})),a.DefaultMaterial}function XI(a,e,t){for(const n in t.extensions)a[n]===void 0&&(e.userData.gltfExtensions=e.userData.gltfExtensions||{},e.userData.gltfExtensions[n]=t.extensions[n])}function tc(a,e){e.extras!==void 0&&(typeof e.extras=="object"?Object.assign(a.userData,e.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+e.extras))}function aD(a,e,t){let n=!1,i=!1,s=!1;for(let u=0,C=e.length;u<C;u++){const h=e[u];if(h.POSITION!==void 0&&(n=!0),h.NORMAL!==void 0&&(i=!0),h.COLOR_0!==void 0&&(s=!0),n&&i&&s)break}if(!n&&!i&&!s)return Promise.resolve(a);const o=[],r=[],g=[];for(let u=0,C=e.length;u<C;u++){const h=e[u];if(n){const f=h.POSITION!==void 0?t.getDependency("accessor",h.POSITION):a.attributes.position;o.push(f)}if(i){const f=h.NORMAL!==void 0?t.getDependency("accessor",h.NORMAL):a.attributes.normal;r.push(f)}if(s){const f=h.COLOR_0!==void 0?t.getDependency("accessor",h.COLOR_0):a.attributes.color;g.push(f)}}return Promise.all([Promise.all(o),Promise.all(r),Promise.all(g)]).then(function(u){const C=u[0],h=u[1],f=u[2];return n&&(a.morphAttributes.position=C),i&&(a.morphAttributes.normal=h),s&&(a.morphAttributes.color=f),a.morphTargetsRelative=!0,a})}function sD(a,e){if(a.updateMorphTargets(),e.weights!==void 0)for(let t=0,n=e.weights.length;t<n;t++)a.morphTargetInfluences[t]=e.weights[t];if(e.extras&&Array.isArray(e.extras.targetNames)){const t=e.extras.targetNames;if(a.morphTargetInfluences.length===t.length){a.morphTargetDictionary={};for(let n=0,i=t.length;n<i;n++)a.morphTargetDictionary[t[n]]=n}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function oD(a){let e;const t=a.extensions&&a.extensions[Rn.KHR_DRACO_MESH_COMPRESSION];if(t?e="draco:"+t.bufferView+":"+t.indices+":"+$B(t.attributes):e=a.indices+":"+$B(a.attributes)+":"+a.mode,a.targets!==void 0)for(let n=0,i=a.targets.length;n<i;n++)e+=":"+$B(a.targets[n]);return e}function $B(a){let e="";const t=Object.keys(a).sort();for(let n=0,i=t.length;n<i;n++)e+=t[n]+":"+a[t[n]]+";";return e}function l2(a){switch(a){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:throw new Error("THREE.GLTFLoader: Unsupported normalized accessor component type.")}}function lD(a){return a.search(/\.jpe?g($|\?)/i)>0||a.search(/^data\:image\/jpeg/)===0?"image/jpeg":a.search(/\.webp($|\?)/i)>0||a.search(/^data\:image\/webp/)===0?"image/webp":"image/png"}const rD=new Yt;class gD{constructor(e={},t={}){this.json=e,this.extensions={},this.plugins={},this.options=t,this.cache=new VU,this.associations=new Map,this.primitiveCache={},this.nodeCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.sourceCache={},this.textureCache={},this.nodeNamesUsed={};let n=!1,i=!1,s=-1;typeof navigator<"u"&&typeof navigator.userAgent<"u"&&(n=/^((?!chrome|android).)*safari/i.test(navigator.userAgent)===!0,i=navigator.userAgent.indexOf("Firefox")>-1,s=i?navigator.userAgent.match(/Firefox\/([0-9]+)\./)[1]:-1),typeof createImageBitmap>"u"||n||i&&s<98?this.textureLoader=new IM(this.options.manager):this.textureLoader=new mM(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new Qo(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),this.options.crossOrigin==="use-credentials"&&this.fileLoader.setWithCredentials(!0)}setExtensions(e){this.extensions=e}setPlugins(e){this.plugins=e}parse(e,t){const n=this,i=this.json,s=this.extensions;this.cache.removeAll(),this.nodeCache={},this._invokeAll(function(o){return o._markDefs&&o._markDefs()}),Promise.all(this._invokeAll(function(o){return o.beforeRoot&&o.beforeRoot()})).then(function(){return Promise.all([n.getDependencies("scene"),n.getDependencies("animation"),n.getDependencies("camera")])}).then(function(o){const r={scene:o[0][i.scene||0],scenes:o[0],animations:o[1],cameras:o[2],asset:i.asset,parser:n,userData:{}};return XI(s,r,i),tc(r,i),Promise.all(n._invokeAll(function(g){return g.afterRoot&&g.afterRoot(r)})).then(function(){for(const g of r.scenes)g.updateMatrixWorld();e(r)})}).catch(t)}_markDefs(){const e=this.json.nodes||[],t=this.json.skins||[],n=this.json.meshes||[];for(let i=0,s=t.length;i<s;i++){const o=t[i].joints;for(let r=0,g=o.length;r<g;r++)e[o[r]].isBone=!0}for(let i=0,s=e.length;i<s;i++){const o=e[i];o.mesh!==void 0&&(this._addNodeRef(this.meshCache,o.mesh),o.skin!==void 0&&(n[o.mesh].isSkinnedMesh=!0)),o.camera!==void 0&&this._addNodeRef(this.cameraCache,o.camera)}}_addNodeRef(e,t){t!==void 0&&(e.refs[t]===void 0&&(e.refs[t]=e.uses[t]=0),e.refs[t]++)}_getNodeRef(e,t,n){if(e.refs[t]<=1)return n;const i=n.clone(),s=(o,r)=>{const g=this.associations.get(o);g!=null&&this.associations.set(r,g);for(const[u,C]of o.children.entries())s(C,r.children[u])};return s(n,i),i.name+="_instance_"+e.uses[t]++,i}_invokeOne(e){const t=Object.values(this.plugins);t.push(this);for(let n=0;n<t.length;n++){const i=e(t[n]);if(i)return i}return null}_invokeAll(e){const t=Object.values(this.plugins);t.unshift(this);const n=[];for(let i=0;i<t.length;i++){const s=e(t[i]);s&&n.push(s)}return n}getDependency(e,t){const n=e+":"+t;let i=this.cache.get(n);if(!i){switch(e){case"scene":i=this.loadScene(t);break;case"node":i=this._invokeOne(function(s){return s.loadNode&&s.loadNode(t)});break;case"mesh":i=this._invokeOne(function(s){return s.loadMesh&&s.loadMesh(t)});break;case"accessor":i=this.loadAccessor(t);break;case"bufferView":i=this._invokeOne(function(s){return s.loadBufferView&&s.loadBufferView(t)});break;case"buffer":i=this.loadBuffer(t);break;case"material":i=this._invokeOne(function(s){return s.loadMaterial&&s.loadMaterial(t)});break;case"texture":i=this._invokeOne(function(s){return s.loadTexture&&s.loadTexture(t)});break;case"skin":i=this.loadSkin(t);break;case"animation":i=this._invokeOne(function(s){return s.loadAnimation&&s.loadAnimation(t)});break;case"camera":i=this.loadCamera(t);break;default:if(i=this._invokeOne(function(s){return s!=this&&s.getDependency&&s.getDependency(e,t)}),!i)throw new Error("Unknown type: "+e);break}this.cache.add(n,i)}return i}getDependencies(e){let t=this.cache.get(e);if(!t){const n=this,i=this.json[e+(e==="mesh"?"es":"s")]||[];t=Promise.all(i.map(function(s,o){return n.getDependency(e,o)})),this.cache.add(e,t)}return t}loadBuffer(e){const t=this.json.buffers[e],n=this.fileLoader;if(t.type&&t.type!=="arraybuffer")throw new Error("THREE.GLTFLoader: "+t.type+" buffer type is not supported.");if(t.uri===void 0&&e===0)return Promise.resolve(this.extensions[Rn.KHR_BINARY_GLTF].body);const i=this.options;return new Promise(function(s,o){n.load(bu.resolveURL(t.uri,i.path),s,void 0,function(){o(new Error('THREE.GLTFLoader: Failed to load buffer "'+t.uri+'".'))})})}loadBufferView(e){const t=this.json.bufferViews[e];return this.getDependency("buffer",t.buffer).then(function(n){const i=t.byteLength||0,s=t.byteOffset||0;return n.slice(s,s+i)})}loadAccessor(e){const t=this,n=this.json,i=this.json.accessors[e];if(i.bufferView===void 0&&i.sparse===void 0){const o=jB[i.type],r=Od[i.componentType],g=i.normalized===!0,u=new r(i.count*o);return Promise.resolve(new En(u,o,g))}const s=[];return i.bufferView!==void 0?s.push(this.getDependency("bufferView",i.bufferView)):s.push(null),i.sparse!==void 0&&(s.push(this.getDependency("bufferView",i.sparse.indices.bufferView)),s.push(this.getDependency("bufferView",i.sparse.values.bufferView))),Promise.all(s).then(function(o){const r=o[0],g=jB[i.type],u=Od[i.componentType],C=u.BYTES_PER_ELEMENT,h=C*g,f=i.byteOffset||0,p=i.bufferView!==void 0?n.bufferViews[i.bufferView].byteStride:void 0,y=i.normalized===!0;let v,G;if(p&&p!==h){const B=Math.floor(f/p),R="InterleavedBuffer:"+i.bufferView+":"+i.componentType+":"+B+":"+i.count;let x=t.cache.get(R);x||(v=new u(r,B*p,i.count*p/C),x=new kf(v,p/C),t.cache.add(R,x)),G=new Zu(x,g,f%p/C,y)}else r===null?v=new u(i.count*g):v=new u(r,f,i.count*g),G=new En(v,g,y);if(i.sparse!==void 0){const B=jB.SCALAR,R=Od[i.sparse.indices.componentType],x=i.sparse.indices.byteOffset||0,w=i.sparse.values.byteOffset||0,M=new R(o[1],x,i.sparse.count*B),H=new u(o[2],w,i.sparse.count*g);r!==null&&(G=new En(G.array.slice(),G.itemSize,G.normalized));for(let N=0,F=M.length;N<F;N++){const Y=M[N];if(G.setX(Y,H[N*g]),g>=2&&G.setY(Y,H[N*g+1]),g>=3&&G.setZ(Y,H[N*g+2]),g>=4&&G.setW(Y,H[N*g+3]),g>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return G})}loadTexture(e){const t=this.json,n=this.options,s=t.textures[e].source,o=t.images[s];let r=this.textureLoader;if(o.uri){const g=n.manager.getHandler(o.uri);g!==null&&(r=g)}return this.loadTextureImage(e,s,r)}loadTextureImage(e,t,n){const i=this,s=this.json,o=s.textures[e],r=s.images[t],g=(r.uri||r.bufferView)+":"+o.sampler;if(this.textureCache[g])return this.textureCache[g];const u=this.loadImageSource(t,n).then(function(C){C.flipY=!1,C.name=o.name||r.name||"",C.name===""&&typeof r.uri=="string"&&r.uri.startsWith("data:image/")===!1&&(C.name=r.uri);const f=(s.samplers||{})[o.sampler]||{};return C.magFilter=f1[f.magFilter]||Bi,C.minFilter=f1[f.minFilter]||yl,C.wrapS=p1[f.wrapS]||Bu,C.wrapT=p1[f.wrapT]||Bu,i.associations.set(C,{textures:e}),C}).catch(function(){return null});return this.textureCache[g]=u,u}loadImageSource(e,t){const n=this,i=this.json,s=this.options;if(this.sourceCache[e]!==void 0)return this.sourceCache[e].then(h=>h.clone());const o=i.images[e],r=self.URL||self.webkitURL;let g=o.uri||"",u=!1;if(o.bufferView!==void 0)g=n.getDependency("bufferView",o.bufferView).then(function(h){u=!0;const f=new Blob([h],{type:o.mimeType});return g=r.createObjectURL(f),g});else if(o.uri===void 0)throw new Error("THREE.GLTFLoader: Image "+e+" is missing URI and bufferView");const C=Promise.resolve(g).then(function(h){return new Promise(function(f,p){let y=f;t.isImageBitmapLoader===!0&&(y=function(v){const G=new Zi(v);G.needsUpdate=!0,f(G)}),t.load(bu.resolveURL(h,s.path),y,void 0,p)})}).then(function(h){return u===!0&&r.revokeObjectURL(g),tc(h,o),h.userData.mimeType=o.mimeType||lD(o.uri),h}).catch(function(h){throw console.error("THREE.GLTFLoader: Couldn't load texture",g),h});return this.sourceCache[e]=C,C}assignTexture(e,t,n,i){const s=this;return this.getDependency("texture",n.index).then(function(o){if(!o)return null;if(n.texCoord!==void 0&&n.texCoord>0&&(o=o.clone(),o.channel=n.texCoord),s.extensions[Rn.KHR_TEXTURE_TRANSFORM]){const r=n.extensions!==void 0?n.extensions[Rn.KHR_TEXTURE_TRANSFORM]:void 0;if(r){const g=s.associations.get(o);o=s.extensions[Rn.KHR_TEXTURE_TRANSFORM].extendTexture(o,r),s.associations.set(o,g)}}return i!==void 0&&(typeof i=="number"&&(i=i===A1?QI:Ic),"colorSpace"in o?o.colorSpace=i:o.encoding=i===QI?A1:WU),e[t]=o,o})}assignFinalMaterial(e){const t=e.geometry;let n=e.material;const i=t.attributes.tangent===void 0,s=t.attributes.color!==void 0,o=t.attributes.normal===void 0;if(e.isPoints){const r="PointsMaterial:"+n.uuid;let g=this.cache.get(r);g||(g=new By,fa.prototype.copy.call(g,n),g.color.copy(n.color),g.map=n.map,g.sizeAttenuation=!1,this.cache.add(r,g)),n=g}else if(e.isLine){const r="LineBasicMaterial:"+n.uuid;let g=this.cache.get(r);g||(g=new vs,fa.prototype.copy.call(g,n),g.color.copy(n.color),g.map=n.map,this.cache.add(r,g)),n=g}if(i||s||o){let r="ClonedMaterial:"+n.uuid+":";i&&(r+="derivative-tangents:"),s&&(r+="vertex-colors:"),o&&(r+="flat-shading:");let g=this.cache.get(r);g||(g=n.clone(),s&&(g.vertexColors=!0),o&&(g.flatShading=!0),i&&(g.normalScale&&(g.normalScale.y*=-1),g.clearcoatNormalScale&&(g.clearcoatNormalScale.y*=-1)),this.cache.add(r,g),this.associations.set(g,this.associations.get(n))),n=g}e.material=n}getMaterialType(){return qf}loadMaterial(e){const t=this,n=this.json,i=this.extensions,s=n.materials[e];let o;const r={},g=s.extensions||{},u=[];if(g[Rn.KHR_MATERIALS_UNLIT]){const h=i[Rn.KHR_MATERIALS_UNLIT];o=h.getMaterialType(),u.push(h.extendParams(r,s,t))}else{const h=s.pbrMetallicRoughness||{};if(r.color=new Gt(1,1,1),r.opacity=1,Array.isArray(h.baseColorFactor)){const f=h.baseColorFactor;r.color.setRGB(f[0],f[1],f[2],Ic),r.opacity=f[3]}h.baseColorTexture!==void 0&&u.push(t.assignTexture(r,"map",h.baseColorTexture,QI)),r.metalness=h.metallicFactor!==void 0?h.metallicFactor:1,r.roughness=h.roughnessFactor!==void 0?h.roughnessFactor:1,h.metallicRoughnessTexture!==void 0&&(u.push(t.assignTexture(r,"metalnessMap",h.metallicRoughnessTexture)),u.push(t.assignTexture(r,"roughnessMap",h.metallicRoughnessTexture))),o=this._invokeOne(function(f){return f.getMaterialType&&f.getMaterialType(e)}),u.push(Promise.all(this._invokeAll(function(f){return f.extendMaterialParams&&f.extendMaterialParams(e,r)})))}s.doubleSided===!0&&(r.side=Oo);const C=s.alphaMode||qB.OPAQUE;if(C===qB.BLEND?(r.transparent=!0,r.depthWrite=!1):(r.transparent=!1,C===qB.MASK&&(r.alphaTest=s.alphaCutoff!==void 0?s.alphaCutoff:.5)),s.normalTexture!==void 0&&o!==wo&&(u.push(t.assignTexture(r,"normalMap",s.normalTexture)),r.normalScale=new at(1,1),s.normalTexture.scale!==void 0)){const h=s.normalTexture.scale;r.normalScale.set(h,h)}if(s.occlusionTexture!==void 0&&o!==wo&&(u.push(t.assignTexture(r,"aoMap",s.occlusionTexture)),s.occlusionTexture.strength!==void 0&&(r.aoMapIntensity=s.occlusionTexture.strength)),s.emissiveFactor!==void 0&&o!==wo){const h=s.emissiveFactor;r.emissive=new Gt().setRGB(h[0],h[1],h[2],Ic)}return s.emissiveTexture!==void 0&&o!==wo&&u.push(t.assignTexture(r,"emissiveMap",s.emissiveTexture,QI)),Promise.all(u).then(function(){const h=new o(r);return s.name&&(h.name=s.name),tc(h,s),t.associations.set(h,{materials:e}),s.extensions&&XI(i,h,s),h})}createUniqueName(e){const t=Yn.sanitizeNodeName(e||"");return t in this.nodeNamesUsed?t+"_"+ ++this.nodeNamesUsed[t]:(this.nodeNamesUsed[t]=0,t)}loadGeometries(e){const t=this,n=this.extensions,i=this.primitiveCache;function s(r){return n[Rn.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(r,t).then(function(g){return m1(g,r,t)})}const o=[];for(let r=0,g=e.length;r<g;r++){const u=e[r],C=oD(u),h=i[C];if(h)o.push(h.promise);else{let f;u.extensions&&u.extensions[Rn.KHR_DRACO_MESH_COMPRESSION]?f=s(u):f=m1(new rn,u,t),i[C]={primitive:u,promise:f},o.push(f)}}return Promise.all(o)}loadMesh(e){const t=this,n=this.json,i=this.extensions,s=n.meshes[e],o=s.primitives,r=[];for(let g=0,u=o.length;g<u;g++){const C=o[g].material===void 0?iD(this.cache):this.getDependency("material",o[g].material);r.push(C)}return r.push(t.loadGeometries(o)),Promise.all(r).then(function(g){const u=g.slice(0,g.length-1),C=g[g.length-1],h=[];for(let p=0,y=C.length;p<y;p++){const v=C[p],G=o[p];let B;const R=u[p];if(G.mode===ml.TRIANGLES||G.mode===ml.TRIANGLE_STRIP||G.mode===ml.TRIANGLE_FAN||G.mode===void 0)B=s.isSkinnedMesh===!0?new aZ(v,R):new vi(v,R),B.isSkinnedMesh===!0&&B.normalizeSkinWeights(),G.mode===ml.TRIANGLE_STRIP?B.geometry=I1(B.geometry,P2):G.mode===ml.TRIANGLE_FAN&&(B.geometry=I1(B.geometry,M0));else if(G.mode===ml.LINES)B=new Gr(v,R);else if(G.mode===ml.LINE_STRIP)B=new pc(v,R);else if(G.mode===ml.LINE_LOOP)B=new sZ(v,R);else if(G.mode===ml.POINTS)B=new oZ(v,R);else throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+G.mode);Object.keys(B.geometry.morphAttributes).length>0&&sD(B,s),B.name=t.createUniqueName(s.name||"mesh_"+e),tc(B,s),G.extensions&&XI(i,B,G),t.assignFinalMaterial(B),h.push(B)}for(let p=0,y=h.length;p<y;p++)t.associations.set(h[p],{meshes:e,primitives:p});if(h.length===1)return s.extensions&&XI(i,h[0],s),h[0];const f=new dg;s.extensions&&XI(i,f,s),t.associations.set(f,{meshes:e});for(let p=0,y=h.length;p<y;p++)f.add(h[p]);return f})}loadCamera(e){let t;const n=this.json.cameras[e],i=n[n.type];if(!i){console.warn("THREE.GLTFLoader: Missing camera parameters.");return}return n.type==="perspective"?t=new Xi(OI.radToDeg(i.yfov),i.aspectRatio||1,i.znear||1,i.zfar||2e6):n.type==="orthographic"&&(t=new pr(-i.xmag,i.xmag,i.ymag,-i.ymag,i.znear,i.zfar)),n.name&&(t.name=this.createUniqueName(n.name)),tc(t,n),Promise.resolve(t)}loadSkin(e){const t=this.json.skins[e],n=[];for(let i=0,s=t.joints.length;i<s;i++)n.push(this._loadNodeShallow(t.joints[i]));return t.inverseBindMatrices!==void 0?n.push(this.getDependency("accessor",t.inverseBindMatrices)):n.push(null),Promise.all(n).then(function(i){const s=i.pop(),o=i,r=[],g=[];for(let u=0,C=o.length;u<C;u++){const h=o[u];if(h){r.push(h);const f=new Yt;s!==null&&f.fromArray(s.array,u*16),g.push(f)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',t.joints[u])}return new Of(r,g)})}loadAnimation(e){const t=this.json,n=this,i=t.animations[e],s=i.name?i.name:"animation_"+e,o=[],r=[],g=[],u=[],C=[];for(let h=0,f=i.channels.length;h<f;h++){const p=i.channels[h],y=i.samplers[p.sampler],v=p.target,G=v.node,B=i.parameters!==void 0?i.parameters[y.input]:y.input,R=i.parameters!==void 0?i.parameters[y.output]:y.output;v.node!==void 0&&(o.push(this.getDependency("node",G)),r.push(this.getDependency("accessor",B)),g.push(this.getDependency("accessor",R)),u.push(y),C.push(v))}return Promise.all([Promise.all(o),Promise.all(r),Promise.all(g),Promise.all(u),Promise.all(C)]).then(function(h){const f=h[0],p=h[1],y=h[2],v=h[3],G=h[4],B=[];for(let R=0,x=f.length;R<x;R++){const w=f[R],M=p[R],H=y[R],N=v[R],F=G[R];if(w===void 0)continue;w.updateMatrix&&w.updateMatrix();const Y=n._createAnimationTracks(w,M,H,N,F);if(Y)for(let X=0;X<Y.length;X++)B.push(Y[X])}return new lA(s,void 0,B)})}createNodeMesh(e){const t=this.json,n=this,i=t.nodes[e];return i.mesh===void 0?null:n.getDependency("mesh",i.mesh).then(function(s){const o=n._getNodeRef(n.meshCache,i.mesh,s);return i.weights!==void 0&&o.traverse(function(r){if(r.isMesh)for(let g=0,u=i.weights.length;g<u;g++)r.morphTargetInfluences[g]=i.weights[g]}),o})}loadNode(e){const t=this.json,n=this,i=t.nodes[e],s=n._loadNodeShallow(e),o=[],r=i.children||[];for(let u=0,C=r.length;u<C;u++)o.push(n.getDependency("node",r[u]));const g=i.skin===void 0?Promise.resolve(null):n.getDependency("skin",i.skin);return Promise.all([s,Promise.all(o),g]).then(function(u){const C=u[0],h=u[1],f=u[2];f!==null&&C.traverse(function(p){p.isSkinnedMesh&&p.bind(f,rD)});for(let p=0,y=h.length;p<y;p++)C.add(h[p]);return C})}_loadNodeShallow(e){const t=this.json,n=this.extensions,i=this;if(this.nodeCache[e]!==void 0)return this.nodeCache[e];const s=t.nodes[e],o=s.name?i.createUniqueName(s.name):"",r=[],g=i._invokeOne(function(u){return u.createNodeMesh&&u.createNodeMesh(e)});return g&&r.push(g),s.camera!==void 0&&r.push(i.getDependency("camera",s.camera).then(function(u){return i._getNodeRef(i.cameraCache,s.camera,u)})),i._invokeAll(function(u){return u.createNodeAttachment&&u.createNodeAttachment(e)}).forEach(function(u){r.push(u)}),this.nodeCache[e]=Promise.all(r).then(function(u){let C;if(s.isBone===!0?C=new yy:u.length>1?C=new dg:u.length===1?C=u[0]:C=new wn,C!==u[0])for(let h=0,f=u.length;h<f;h++)C.add(u[h]);if(s.name&&(C.userData.name=s.name,C.name=o),tc(C,s),s.extensions&&XI(n,C,s),s.matrix!==void 0){const h=new Yt;h.fromArray(s.matrix),C.applyMatrix4(h)}else s.translation!==void 0&&C.position.fromArray(s.translation),s.rotation!==void 0&&C.quaternion.fromArray(s.rotation),s.scale!==void 0&&C.scale.fromArray(s.scale);return i.associations.has(C)||i.associations.set(C,{}),i.associations.get(C).nodes=e,C}),this.nodeCache[e]}loadScene(e){const t=this.extensions,n=this.json.scenes[e],i=this,s=new dg;n.name&&(s.name=i.createUniqueName(n.name)),tc(s,n),n.extensions&&XI(t,s,n);const o=n.nodes||[],r=[];for(let g=0,u=o.length;g<u;g++)r.push(i.getDependency("node",o[g]));return Promise.all(r).then(function(g){for(let C=0,h=g.length;C<h;C++)s.add(g[C]);const u=C=>{const h=new Map;for(const[f,p]of i.associations)(f instanceof fa||f instanceof Zi)&&h.set(f,p);return C.traverse(f=>{const p=i.associations.get(f);p!=null&&h.set(f,p)}),h};return i.associations=u(s),s})}_createAnimationTracks(e,t,n,i,s){const o=[],r=e.name?e.name:e.uuid,g=[];Au[s.path]===Au.weights?e.traverse(function(f){f.morphTargetInfluences&&g.push(f.name?f.name:f.uuid)}):g.push(r);let u;switch(Au[s.path]){case Au.weights:u=lC;break;case Au.rotation:u=rC;break;case Au.position:case Au.scale:u=gC;break;default:switch(n.itemSize){case 1:u=lC;break;case 2:case 3:default:u=gC;break}break}const C=i.interpolation!==void 0?nD[i.interpolation]:nA,h=this._getArrayFromAccessor(n);for(let f=0,p=g.length;f<p;f++){const y=new u(g[f]+"."+Au[s.path],t.array,h,C);i.interpolation==="CUBICSPLINE"&&this._createCubicSplineTrackInterpolant(y),o.push(y)}return o}_getArrayFromAccessor(e){let t=e.array;if(e.normalized){const n=l2(t.constructor),i=new Float32Array(t.length);for(let s=0,o=t.length;s<o;s++)i[s]=t[s]*n;t=i}return t}_createCubicSplineTrackInterpolant(e){e.createInterpolant=function(n){const i=this instanceof rC?tD:cH;return new i(this.times,this.values,this.getValueSize()/3,n)},e.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0}}function cD(a,e,t){const n=e.attributes,i=new Sa;if(n.POSITION!==void 0){const r=t.json.accessors[n.POSITION],g=r.min,u=r.max;if(g!==void 0&&u!==void 0){if(i.set(new ae(g[0],g[1],g[2]),new ae(u[0],u[1],u[2])),r.normalized){const C=l2(Od[r.componentType]);i.min.multiplyScalar(C),i.max.multiplyScalar(C)}}else{console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.");return}}else return;const s=e.targets;if(s!==void 0){const r=new ae,g=new ae;for(let u=0,C=s.length;u<C;u++){const h=s[u];if(h.POSITION!==void 0){const f=t.json.accessors[h.POSITION],p=f.min,y=f.max;if(p!==void 0&&y!==void 0){if(g.setX(Math.max(Math.abs(p[0]),Math.abs(y[0]))),g.setY(Math.max(Math.abs(p[1]),Math.abs(y[1]))),g.setZ(Math.max(Math.abs(p[2]),Math.abs(y[2]))),f.normalized){const v=l2(Od[f.componentType]);g.multiplyScalar(v)}r.max(g)}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}i.expandByVector(r)}a.boundingBox=i;const o=new Ra;i.getCenter(o.center),o.radius=i.min.distanceTo(i.max)/2,a.boundingSphere=o}function m1(a,e,t){const n=e.attributes,i=[];function s(o,r){return t.getDependency("accessor",o).then(function(g){a.setAttribute(r,g)})}for(const o in n){const r=o2[o]||o.toLowerCase();r in a.attributes||i.push(s(n[o],r))}if(e.indices!==void 0&&!a.index){const o=t.getDependency("accessor",e.indices).then(function(r){a.setIndex(r)});i.push(o)}return tc(a,e),cD(a,e,t),Promise.all(i).then(function(){return e.targets!==void 0?aD(a,e.targets,t):a})}const ev=new WeakMap;class uD extends Zs{constructor(e){super(e),this.decoderPath="",this.decoderConfig={},this.decoderBinary=null,this.decoderPending=null,this.workerLimit=4,this.workerPool=[],this.workerNextTaskID=1,this.workerSourceURL="",this.defaultAttributeIDs={position:"POSITION",normal:"NORMAL",color:"COLOR",uv:"TEX_COORD"},this.defaultAttributeTypes={position:"Float32Array",normal:"Float32Array",color:"Float32Array",uv:"Float32Array"}}setDecoderPath(e){return this.decoderPath=e,this}setDecoderConfig(e){return this.decoderConfig=e,this}setWorkerLimit(e){return this.workerLimit=e,this}load(e,t,n,i){const s=new Qo(this.manager);s.setPath(this.path),s.setResponseType("arraybuffer"),s.setRequestHeader(this.requestHeader),s.setWithCredentials(this.withCredentials),s.load(e,o=>{const r={attributeIDs:this.defaultAttributeIDs,attributeTypes:this.defaultAttributeTypes,useUniqueIDs:!1};this.decodeGeometry(o,r).then(t).catch(i)},n,i)}decodeDracoFile(e,t,n,i){const s={attributeIDs:n||this.defaultAttributeIDs,attributeTypes:i||this.defaultAttributeTypes,useUniqueIDs:!!n};this.decodeGeometry(e,s).then(t)}decodeGeometry(e,t){for(const g in t.attributeTypes){const u=t.attributeTypes[g];u.BYTES_PER_ELEMENT!==void 0&&(t.attributeTypes[g]=u.name)}const n=JSON.stringify(t);if(ev.has(e)){const g=ev.get(e);if(g.key===n)return g.promise;if(e.byteLength===0)throw new Error("THREE.DRACOLoader: Unable to re-decode a buffer with different settings. Buffer has already been transferred.")}let i;const s=this.workerNextTaskID++,o=e.byteLength,r=this._getWorker(s,o).then(g=>(i=g,new Promise((u,C)=>{i._callbacks[s]={resolve:u,reject:C},i.postMessage({type:"decode",id:s,taskConfig:t,buffer:e},[e])}))).then(g=>this._createGeometry(g.geometry));return r.catch(()=>!0).then(()=>{i&&s&&this._releaseTask(i,s)}),ev.set(e,{key:n,promise:r}),r}_createGeometry(e){const t=new rn;e.index&&t.setIndex(new En(e.index.array,1));for(let n=0;n<e.attributes.length;n++){const i=e.attributes[n],s=i.name,o=i.array,r=i.itemSize;t.setAttribute(s,new En(o,r))}return t}_loadLibrary(e,t){const n=new Qo(this.manager);return n.setPath(this.decoderPath),n.setResponseType(t),n.setWithCredentials(this.withCredentials),new Promise((i,s)=>{n.load(e,i,void 0,s)})}preload(){return this._initDecoder(),this}_initDecoder(){if(this.decoderPending)return this.decoderPending;const e=typeof WebAssembly!="object"||this.decoderConfig.type==="js",t=[];return e?t.push(this._loadLibrary("draco_decoder.js","text")):(t.push(this._loadLibrary("draco_wasm_wrapper.js","text")),t.push(this._loadLibrary("draco_decoder.wasm","arraybuffer"))),this.decoderPending=Promise.all(t).then(n=>{const i=n[0];e||(this.decoderConfig.wasmBinary=n[1]);const s=ID.toString(),o=["/* draco decoder */",i,"","/* worker */",s.substring(s.indexOf("{")+1,s.lastIndexOf("}"))].join(`
`);this.workerSourceURL=URL.createObjectURL(new Blob([o]))}),this.decoderPending}_getWorker(e,t){return this._initDecoder().then(()=>{if(this.workerPool.length<this.workerLimit){const i=new Worker(this.workerSourceURL);i._callbacks={},i._taskCosts={},i._taskLoad=0,i.postMessage({type:"init",decoderConfig:this.decoderConfig}),i.onmessage=function(s){const o=s.data;switch(o.type){case"decode":i._callbacks[o.id].resolve(o);break;case"error":i._callbacks[o.id].reject(o);break;default:console.error('THREE.DRACOLoader: Unexpected message, "'+o.type+'"')}},this.workerPool.push(i)}else this.workerPool.sort(function(i,s){return i._taskLoad>s._taskLoad?-1:1});const n=this.workerPool[this.workerPool.length-1];return n._taskCosts[e]=t,n._taskLoad+=t,n})}_releaseTask(e,t){e._taskLoad-=e._taskCosts[t],delete e._callbacks[t],delete e._taskCosts[t]}debug(){console.log("Task load: ",this.workerPool.map(e=>e._taskLoad))}dispose(){for(let e=0;e<this.workerPool.length;++e)this.workerPool[e].terminate();return this.workerPool.length=0,this}}function ID(){let a,e;onmessage=function(o){const r=o.data;switch(r.type){case"init":a=r.decoderConfig,e=new Promise(function(C){a.onModuleLoaded=function(h){C({draco:h})},DracoDecoderModule(a)});break;case"decode":const g=r.buffer,u=r.taskConfig;e.then(C=>{const h=C.draco,f=new h.Decoder,p=new h.DecoderBuffer;p.Init(new Int8Array(g),g.byteLength);try{const y=t(h,f,p,u),v=y.attributes.map(G=>G.array.buffer);y.index&&v.push(y.index.array.buffer),self.postMessage({type:"decode",id:r.id,geometry:y},v)}catch(y){console.error(y),self.postMessage({type:"error",id:r.id,error:y.message})}finally{h.destroy(p),h.destroy(f)}});break}};function t(o,r,g,u){const C=u.attributeIDs,h=u.attributeTypes;let f,p;const y=r.GetEncodedGeometryType(g);if(y===o.TRIANGULAR_MESH)f=new o.Mesh,p=r.DecodeBufferToMesh(g,f);else if(y===o.POINT_CLOUD)f=new o.PointCloud,p=r.DecodeBufferToPointCloud(g,f);else throw new Error("THREE.DRACOLoader: Unexpected geometry type.");if(!p.ok()||f.ptr===0)throw new Error("THREE.DRACOLoader: Decoding failed: "+p.error_msg());const v={index:null,attributes:[]};for(const G in C){const B=self[h[G]];let R,x;if(u.useUniqueIDs)x=C[G],R=r.GetAttributeByUniqueId(f,x);else{if(x=r.GetAttributeId(f,o[C[G]]),x===-1)continue;R=r.GetAttribute(f,x)}v.attributes.push(i(o,r,f,G,B,R))}return y===o.TRIANGULAR_MESH&&(v.index=n(o,r,f)),o.destroy(f),v}function n(o,r,g){const C=g.num_faces()*3,h=C*4,f=o._malloc(h);r.GetTrianglesUInt32Array(g,h,f);const p=new Uint32Array(o.HEAPF32.buffer,f,C).slice();return o._free(f),{array:p,itemSize:1}}function i(o,r,g,u,C,h){const f=h.num_components(),y=g.num_points()*f,v=y*C.BYTES_PER_ELEMENT,G=s(o,C),B=o._malloc(v);r.GetAttributeDataArrayForAllPoints(g,h,G,v,B);const R=new C(o.HEAPF32.buffer,B,y).slice();return o._free(B),{name:u,array:R,itemSize:f}}function s(o,r){switch(r){case Float32Array:return o.DT_FLOAT32;case Int8Array:return o.DT_INT8;case Int16Array:return o.DT_INT16;case Int32Array:return o.DT_INT32;case Uint8Array:return o.DT_UINT8;case Uint16Array:return o.DT_UINT16;case Uint32Array:return o.DT_UINT32}}}let Bb;const tv=()=>{if(Bb)return Bb;const a="B9h9z9tFBBBF8fL9gBB9gLaaaaaFa9gEaaaB9gFaFa9gEaaaFaEMcBFFFGGGEIIILF9wFFFLEFBFKNFaFCx/IFMO/LFVK9tv9t9vq95GBt9f9f939h9z9t9f9j9h9s9s9f9jW9vq9zBBp9tv9z9o9v9wW9f9kv9j9v9kv9WvqWv94h919m9mvqBF8Z9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv94h919m9mvqBGy9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv949TvZ91v9u9jvBEn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9P9jWBIi9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9R919hWBLn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9F949wBKI9z9iqlBOc+x8ycGBM/qQFTa8jUUUUBCU/EBlHL8kUUUUBC9+RKGXAGCFJAI9LQBCaRKAE2BBC+gF9HQBALAEAIJHOAGlAGTkUUUBRNCUoBAG9uC/wgBZHKCUGAKCUG9JyRVAECFJRICBRcGXEXAcAF9PQFAVAFAclAcAVJAF9JyRMGXGXAG9FQBAMCbJHKC9wZRSAKCIrCEJCGrRQANCUGJRfCBRbAIRTEXGXAOATlAQ9PQBCBRISEMATAQJRIGXAS9FQBCBRtCBREEXGXAOAIlCi9PQBCBRISLMANCU/CBJAEJRKGXGXGXGXGXATAECKrJ2BBAtCKZrCEZfIBFGEBMAKhB83EBAKCNJhB83EBSEMAKAI2BIAI2BBHmCKrHYAYCE6HYy86BBAKCFJAICIJAYJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCGJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCEJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCIJAYAmJHY2BBAI2BFHmCKrHPAPCE6HPy86BBAKCLJAYAPJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCKJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCOJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCNJAYAmJHY2BBAI2BGHmCKrHPAPCE6HPy86BBAKCVJAYAPJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCcJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCMJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCSJAYAmJHm2BBAI2BEHICKrHYAYCE6HYy86BBAKCQJAmAYJHm2BBAICIrCEZHYAYCE6HYy86BBAKCfJAmAYJHm2BBAICGrCEZHYAYCE6HYy86BBAKCbJAmAYJHK2BBAICEZHIAICE6HIy86BBAKAIJRISGMAKAI2BNAI2BBHmCIrHYAYCb6HYy86BBAKCFJAICNJAYJHY2BBAmCbZHmAmCb6Hmy86BBAKCGJAYAmJHm2BBAI2BFHYCIrHPAPCb6HPy86BBAKCEJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCIJAmAYJHm2BBAI2BGHYCIrHPAPCb6HPy86BBAKCLJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCKJAmAYJHm2BBAI2BEHYCIrHPAPCb6HPy86BBAKCOJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCNJAmAYJHm2BBAI2BIHYCIrHPAPCb6HPy86BBAKCVJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCcJAmAYJHm2BBAI2BLHYCIrHPAPCb6HPy86BBAKCMJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCSJAmAYJHm2BBAI2BKHYCIrHPAPCb6HPy86BBAKCQJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCfJAmAYJHm2BBAI2BOHICIrHYAYCb6HYy86BBAKCbJAmAYJHK2BBAICbZHIAICb6HIy86BBAKAIJRISFMAKAI8pBB83BBAKCNJAICNJ8pBB83BBAICTJRIMAtCGJRtAECTJHEAS9JQBMMGXAIQBCBRISEMGXAM9FQBANAbJ2BBRtCBRKAfREEXAEANCU/CBJAKJ2BBHTCFrCBATCFZl9zAtJHt86BBAEAGJREAKCFJHKAM9HQBMMAfCFJRfAIRTAbCFJHbAG9HQBMMABAcAG9sJANCUGJAMAG9sTkUUUBpANANCUGJAMCaJAG9sJAGTkUUUBpMAMCBAIyAcJRcAIQBMC9+RKSFMCBC99AOAIlAGCAAGCA9Ly6yRKMALCU/EBJ8kUUUUBAKM+OmFTa8jUUUUBCoFlHL8kUUUUBC9+RKGXAFCE9uHOCtJAI9LQBCaRKAE2BBHNC/wFZC/gF9HQBANCbZHVCF9LQBALCoBJCgFCUFT+JUUUBpALC84Jha83EBALC8wJha83EBALC8oJha83EBALCAJha83EBALCiJha83EBALCTJha83EBALha83ENALha83EBAEAIJC9wJRcAECFJHNAOJRMGXAF9FQBCQCbAVCF6yRSABRECBRVCBRQCBRfCBRICBRKEXGXAMAcuQBC9+RKSEMGXGXAN2BBHOC/vF9LQBALCoBJAOCIrCa9zAKJCbZCEWJHb8oGIRTAb8oGBRtGXAOCbZHbAS9PQBALAOCa9zAIJCbZCGWJ8oGBAVAbyROAb9FRbGXGXAGCG9HQBABAt87FBABCIJAO87FBABCGJAT87FBSFMAEAtjGBAECNJAOjGBAECIJATjGBMAVAbJRVALCoBJAKCEWJHmAOjGBAmATjGIALAICGWJAOjGBALCoBJAKCFJCbZHKCEWJHTAtjGBATAOjGIAIAbJRIAKCFJRKSGMGXGXAbCb6QBAQAbJAbC989zJCFJRQSFMAM1BBHbCgFZROGXGXAbCa9MQBAMCFJRMSFMAM1BFHbCgBZCOWAOCgBZqROGXAbCa9MQBAMCGJRMSFMAM1BGHbCgBZCfWAOqROGXAbCa9MQBAMCEJRMSFMAM1BEHbCgBZCdWAOqROGXAbCa9MQBAMCIJRMSFMAM2BIC8cWAOqROAMCLJRMMAOCFrCBAOCFZl9zAQJRQMGXGXAGCG9HQBABAt87FBABCIJAQ87FBABCGJAT87FBSFMAEAtjGBAECNJAQjGBAECIJATjGBMALCoBJAKCEWJHOAQjGBAOATjGIALAICGWJAQjGBALCoBJAKCFJCbZHKCEWJHOAtjGBAOAQjGIAICFJRIAKCFJRKSFMGXAOCDF9LQBALAIAcAOCbZJ2BBHbCIrHTlCbZCGWJ8oGBAVCFJHtATyROALAIAblCbZCGWJ8oGBAtAT9FHmJHtAbCbZHTyRbAT9FRTGXGXAGCG9HQBABAV87FBABCIJAb87FBABCGJAO87FBSFMAEAVjGBAECNJAbjGBAECIJAOjGBMALAICGWJAVjGBALCoBJAKCEWJHYAOjGBAYAVjGIALAICFJHICbZCGWJAOjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAIAmJCbZHICGWJAbjGBALCoBJAKCGJCbZHKCEWJHOAVjGBAOAbjGIAKCFJRKAIATJRIAtATJRVSFMAVCBAM2BBHYyHTAOC/+F6HPJROAYCbZRtGXGXAYCIrHmQBAOCFJRbSFMAORbALAIAmlCbZCGWJ8oGBROMGXGXAtQBAbCFJRVSFMAbRVALAIAYlCbZCGWJ8oGBRbMGXGXAP9FQBAMCFJRYSFMAM1BFHYCgFZRTGXGXAYCa9MQBAMCGJRYSFMAM1BGHYCgBZCOWATCgBZqRTGXAYCa9MQBAMCEJRYSFMAM1BEHYCgBZCfWATqRTGXAYCa9MQBAMCIJRYSFMAM1BIHYCgBZCdWATqRTGXAYCa9MQBAMCLJRYSFMAMCKJRYAM2BLC8cWATqRTMATCFrCBATCFZl9zAQJHQRTMGXGXAmCb6QBAYRPSFMAY1BBHMCgFZROGXGXAMCa9MQBAYCFJRPSFMAY1BFHMCgBZCOWAOCgBZqROGXAMCa9MQBAYCGJRPSFMAY1BGHMCgBZCfWAOqROGXAMCa9MQBAYCEJRPSFMAY1BEHMCgBZCdWAOqROGXAMCa9MQBAYCIJRPSFMAYCLJRPAY2BIC8cWAOqROMAOCFrCBAOCFZl9zAQJHQROMGXGXAtCb6QBAPRMSFMAP1BBHMCgFZRbGXGXAMCa9MQBAPCFJRMSFMAP1BFHMCgBZCOWAbCgBZqRbGXAMCa9MQBAPCGJRMSFMAP1BGHMCgBZCfWAbqRbGXAMCa9MQBAPCEJRMSFMAP1BEHMCgBZCdWAbqRbGXAMCa9MQBAPCIJRMSFMAPCLJRMAP2BIC8cWAbqRbMAbCFrCBAbCFZl9zAQJHQRbMGXGXAGCG9HQBABAT87FBABCIJAb87FBABCGJAO87FBSFMAEATjGBAECNJAbjGBAECIJAOjGBMALCoBJAKCEWJHYAOjGBAYATjGIALAICGWJATjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAICFJHICbZCGWJAOjGBALCoBJAKCGJCbZCEWJHOATjGBAOAbjGIALAIAm9FAmCb6qJHICbZCGWJAbjGBAIAt9FAtCb6qJRIAKCEJRKMANCFJRNABCKJRBAECSJREAKCbZRKAICbZRIAfCEJHfAF9JQBMMCBC99AMAc6yRKMALCoFJ8kUUUUBAKM/tIFGa8jUUUUBCTlRLC9+RKGXAFCLJAI9LQBCaRKAE2BBC/+FZC/QF9HQBALhB83ENAECFJRKAEAIJC98JREGXAF9FQBGXAGCG6QBEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMALCNJAICFZCGWqHGAICGrCBAICFrCFZl9zAG8oGBJHIjGBABAIjGBABCIJRBAFCaJHFQBSGMMEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMABAICGrCBAICFrCFZl9zALCNJAICFZCGWqHI8oGBJHG87FBAIAGjGBABCGJRBAFCaJHFQBMMCBC99AKAE6yRKMAKM+lLKFaF99GaG99FaG99GXGXAGCI9HQBAF9FQFEXGXGX9DBBB8/9DBBB+/ABCGJHG1BB+yAB1BBHE+yHI+L+TABCFJHL1BBHK+yHO+L+THN9DBBBB9gHVyAN9DBB/+hANAN+U9DBBBBANAVyHcAc+MHMAECa3yAI+SHIAI+UAcAMAKCa3yAO+SHcAc+U+S+S+R+VHO+U+SHN+L9DBBB9P9d9FQBAN+oRESFMCUUUU94REMAGAE86BBGXGX9DBBB8/9DBBB+/Ac9DBBBB9gyAcAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMALAG86BBGXGX9DBBB8/9DBBB+/AI9DBBBB9gyAIAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMABAG86BBABCIJRBAFCaJHFQBSGMMAF9FQBEXGXGX9DBBB8/9DBBB+/ABCIJHG8uFB+yAB8uFBHE+yHI+L+TABCGJHL8uFBHK+yHO+L+THN9DBBBB9gHVyAN9DB/+g6ANAN+U9DBBBBANAVyHcAc+MHMAECa3yAI+SHIAI+UAcAMAKCa3yAO+SHcAc+U+S+S+R+VHO+U+SHN+L9DBBB9P9d9FQBAN+oRESFMCUUUU94REMAGAE87FBGXGX9DBBB8/9DBBB+/Ac9DBBBB9gyAcAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMALAG87FBGXGX9DBBB8/9DBBB+/AI9DBBBB9gyAIAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMABAG87FBABCNJRBAFCaJHFQBMMM/SEIEaE99EaF99GXAF9FQBCBREABRIEXGXGX9D/zI818/AICKJ8uFBHLCEq+y+VHKAI8uFB+y+UHO9DB/+g6+U9DBBB8/9DBBB+/AO9DBBBB9gy+SHN+L9DBBB9P9d9FQBAN+oRVSFMCUUUU94RVMAICIJ8uFBRcAICGJ8uFBRMABALCFJCEZAEqCFWJAV87FBGXGXAKAM+y+UHN9DB/+g6+U9DBBB8/9DBBB+/AN9DBBBB9gy+SHS+L9DBBB9P9d9FQBAS+oRMSFMCUUUU94RMMABALCGJCEZAEqCFWJAM87FBGXGXAKAc+y+UHK9DB/+g6+U9DBBB8/9DBBB+/AK9DBBBB9gy+SHS+L9DBBB9P9d9FQBAS+oRcSFMCUUUU94RcMABALCaJCEZAEqCFWJAc87FBGXGX9DBBU8/AOAO+U+TANAN+U+TAKAK+U+THO9DBBBBAO9DBBBB9gy+R9DB/+g6+U9DBBB8/+SHO+L9DBBB9P9d9FQBAO+oRcSFMCUUUU94RcMABALCEZAEqCFWJAc87FBAICNJRIAECIJREAFCaJHFQBMMM9JBGXAGCGrAF9sHF9FQBEXABAB8oGBHGCNWCN91+yAGCi91CnWCUUU/8EJ+++U84GBABCIJRBAFCaJHFQBMMM9TFEaCBCB8oGUkUUBHFABCEJC98ZJHBjGUkUUBGXGXAB8/BCTWHGuQBCaREABAGlCggEJCTrXBCa6QFMAFREMAEM/lFFFaGXGXAFABqCEZ9FQBABRESFMGXGXAGCT9PQBABRESFMABREEXAEAF8oGBjGBAECIJAFCIJ8oGBjGBAECNJAFCNJ8oGBjGBAECSJAFCSJ8oGBjGBAECTJREAFCTJRFAGC9wJHGCb9LQBMMAGCI9JQBEXAEAF8oGBjGBAFCIJRFAECIJREAGC98JHGCE9LQBMMGXAG9FQBEXAEAF2BB86BBAECFJREAFCFJRFAGCaJHGQBMMABMoFFGaGXGXABCEZ9FQBABRESFMAFCgFZC+BwsN9sRIGXGXAGCT9PQBABRESFMABREEXAEAIjGBAECSJAIjGBAECNJAIjGBAECIJAIjGBAECTJREAGC9wJHGCb9LQBMMAGCI9JQBEXAEAIjGBAECIJREAGC98JHGCE9LQBMMGXAG9FQBEXAEAF86BBAECFJREAGCaJHGQBMMABMMMFBCUNMIT9kBB",e="B9h9z9tFBBBFiI9gBB9gLaaaaaFa9gEaaaB9gFaFaEMcBBFBFFGGGEILF9wFFFLEFBFKNFaFCx/aFMO/LFVK9tv9t9vq95GBt9f9f939h9z9t9f9j9h9s9s9f9jW9vq9zBBp9tv9z9o9v9wW9f9kv9j9v9kv9WvqWv94h919m9mvqBG8Z9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv94h919m9mvqBIy9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv949TvZ91v9u9jvBLn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9P9jWBKi9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9R919hWBOn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9F949wBNI9z9iqlBVc+N9IcIBTEM9+FLa8jUUUUBCTlRBCBRFEXCBRGCBREEXABCNJAGJAECUaAFAGrCFZHIy86BBAEAIJREAGCFJHGCN9HQBMAFCx+YUUBJAE86BBAFCEWCxkUUBJAB8pEN83EBAFCFJHFCUG9HQBMMk8lLbaE97F9+FaL978jUUUUBCU/KBlHL8kUUUUBC9+RKGXAGCFJAI9LQBCaRKAE2BBC+gF9HQBALAEAIJHOAGlAG/8cBBCUoBAG9uC/wgBZHKCUGAKCUG9JyRNAECFJRKCBRVGXEXAVAF9PQFANAFAVlAVANJAF9JyRcGXGXAG9FQBAcCbJHIC9wZHMCE9sRSAMCFWRQAICIrCEJCGrRfCBRbEXAKRTCBRtGXEXGXAOATlAf9PQBCBRKSLMALCU/CBJAtAM9sJRmATAfJRKCBREGXAMCoB9JQBAOAKlC/gB9JQBCBRIEXAmAIJREGXGXGXGXGXATAICKrJ2BBHYCEZfIBFGEBMAECBDtDMIBSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHiCEWCxkUUBJDBEBAiCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHiCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCIJAeDeBJAiCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHiCEWCxkUUBJDBEBAiCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHiCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCNJAeDeBJAiCx+YUUBJ2BBJRKSFMAEAKDBBBDMIBAKCTJRKMGXGXGXGXGXAYCGrCEZfIBFGEBMAECBDtDMITSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHiCEWCxkUUBJDBEBAiCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHiCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMITAKCIJAeDeBJAiCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHiCEWCxkUUBJDBEBAiCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHiCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMITAKCNJAeDeBJAiCx+YUUBJ2BBJRKSFMAEAKDBBBDMITAKCTJRKMGXGXGXGXGXAYCIrCEZfIBFGEBMAECBDtDMIASEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHiCEWCxkUUBJDBEBAiCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHiCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIAAKCIJAeDeBJAiCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHiCEWCxkUUBJDBEBAiCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHiCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIAAKCNJAeDeBJAiCx+YUUBJ2BBJRKSFMAEAKDBBBDMIAAKCTJRKMGXGXGXGXGXAYCKrfIBFGEBMAECBDtDMI8wSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHYCEWCxkUUBJDBEBAYCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHYCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMI8wAKCIJAeDeBJAYCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHYCEWCxkUUBJDBEBAYCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHYCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMI8wAKCNJAeDeBJAYCx+YUUBJ2BBJRKSFMAEAKDBBBDMI8wAKCTJRKMAICoBJREAICUFJAM9LQFAERIAOAKlC/fB9LQBMMGXAEAM9PQBAECErRIEXGXAOAKlCi9PQBCBRKSOMAmAEJRYGXGXGXGXGXATAECKrJ2BBAICKZrCEZfIBFGEBMAYCBDtDMIBSEMAYAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHiCEWCxkUUBJDBEBAiCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHiCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCIJAeDeBJAiCx+YUUBJ2BBJRKSGMAYAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHiCEWCxkUUBJDBEBAiCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHiCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCNJAeDeBJAiCx+YUUBJ2BBJRKSFMAYAKDBBBDMIBAKCTJRKMAICGJRIAECTJHEAM9JQBMMGXAK9FQBAKRTAtCFJHtCI6QGSFMMCBRKSEMGXAM9FQBALCUGJAbJREALAbJDBGBReCBRYEXAEALCU/CBJAYJHIDBIBHdCFD9tAdCFDbHPD9OD9hD9RHdAIAMJDBIBH8ZCFD9tA8ZAPD9OD9hD9RH8ZDQBTFtGmEYIPLdKeOnHpAIAQJDBIBHyCFD9tAyAPD9OD9hD9RHyAIASJDBIBH8cCFD9tA8cAPD9OD9hD9RH8cDQBTFtGmEYIPLdKeOnH8dDQBFTtGEmYILPdKOenHPAPDQBFGEBFGEBFGEBFGEAeD9uHeDyBjGBAEAGJHIAeAPAPDQILKOILKOILKOILKOD9uHeDyBjGBAIAGJHIAeAPAPDQNVcMNVcMNVcMNVcMD9uHeDyBjGBAIAGJHIAeAPAPDQSQfbSQfbSQfbSQfbD9uHeDyBjGBAIAGJHIAeApA8dDQNVi8ZcMpySQ8c8dfb8e8fHPAPDQBFGEBFGEBFGEBFGED9uHeDyBjGBAIAGJHIAeAPAPDQILKOILKOILKOILKOD9uHeDyBjGBAIAGJHIAeAPAPDQNVcMNVcMNVcMNVcMD9uHeDyBjGBAIAGJHIAeAPAPDQSQfbSQfbSQfbSQfbD9uHeDyBjGBAIAGJHIAeAdA8ZDQNiV8ZcpMyS8cQ8df8eb8fHdAyA8cDQNiV8ZcpMyS8cQ8df8eb8fH8ZDQBFTtGEmYILPdKOenHPAPDQBFGEBFGEBFGEBFGED9uHeDyBjGBAIAGJHIAeAPAPDQILKOILKOILKOILKOD9uHeDyBjGBAIAGJHIAeAPAPDQNVcMNVcMNVcMNVcMD9uHeDyBjGBAIAGJHIAeAPAPDQSQfbSQfbSQfbSQfbD9uHeDyBjGBAIAGJHIAeAdA8ZDQNVi8ZcMpySQ8c8dfb8e8fHPAPDQBFGEBFGEBFGEBFGED9uHeDyBjGBAIAGJHIAeAPAPDQILKOILKOILKOILKOD9uHeDyBjGBAIAGJHIAeAPAPDQNVcMNVcMNVcMNVcMD9uHeDyBjGBAIAGJHIAeAPAPDQSQfbSQfbSQfbSQfbD9uHeDyBjGBAIAGJREAYCTJHYAM9JQBMMAbCIJHbAG9JQBMMABAVAG9sJALCUGJAcAG9s/8cBBALALCUGJAcCaJAG9sJAG/8cBBMAcCBAKyAVJRVAKQBMC9+RKSFMCBC99AOAKlAGCAAGCA9Ly6yRKMALCU/KBJ8kUUUUBAKMNBT+BUUUBM+KmFTa8jUUUUBCoFlHL8kUUUUBC9+RKGXAFCE9uHOCtJAI9LQBCaRKAE2BBHNC/wFZC/gF9HQBANCbZHVCF9LQBALCoBJCgFCUF/8MBALC84Jha83EBALC8wJha83EBALC8oJha83EBALCAJha83EBALCiJha83EBALCTJha83EBALha83ENALha83EBAEAIJC9wJRcAECFJHNAOJRMGXAF9FQBCQCbAVCF6yRSABRECBRVCBRQCBRfCBRICBRKEXGXAMAcuQBC9+RKSEMGXGXAN2BBHOC/vF9LQBALCoBJAOCIrCa9zAKJCbZCEWJHb8oGIRTAb8oGBRtGXAOCbZHbAS9PQBALAOCa9zAIJCbZCGWJ8oGBAVAbyROAb9FRbGXGXAGCG9HQBABAt87FBABCIJAO87FBABCGJAT87FBSFMAEAtjGBAECNJAOjGBAECIJATjGBMAVAbJRVALCoBJAKCEWJHmAOjGBAmATjGIALAICGWJAOjGBALCoBJAKCFJCbZHKCEWJHTAtjGBATAOjGIAIAbJRIAKCFJRKSGMGXGXAbCb6QBAQAbJAbC989zJCFJRQSFMAM1BBHbCgFZROGXGXAbCa9MQBAMCFJRMSFMAM1BFHbCgBZCOWAOCgBZqROGXAbCa9MQBAMCGJRMSFMAM1BGHbCgBZCfWAOqROGXAbCa9MQBAMCEJRMSFMAM1BEHbCgBZCdWAOqROGXAbCa9MQBAMCIJRMSFMAM2BIC8cWAOqROAMCLJRMMAOCFrCBAOCFZl9zAQJRQMGXGXAGCG9HQBABAt87FBABCIJAQ87FBABCGJAT87FBSFMAEAtjGBAECNJAQjGBAECIJATjGBMALCoBJAKCEWJHOAQjGBAOATjGIALAICGWJAQjGBALCoBJAKCFJCbZHKCEWJHOAtjGBAOAQjGIAICFJRIAKCFJRKSFMGXAOCDF9LQBALAIAcAOCbZJ2BBHbCIrHTlCbZCGWJ8oGBAVCFJHtATyROALAIAblCbZCGWJ8oGBAtAT9FHmJHtAbCbZHTyRbAT9FRTGXGXAGCG9HQBABAV87FBABCIJAb87FBABCGJAO87FBSFMAEAVjGBAECNJAbjGBAECIJAOjGBMALAICGWJAVjGBALCoBJAKCEWJHYAOjGBAYAVjGIALAICFJHICbZCGWJAOjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAIAmJCbZHICGWJAbjGBALCoBJAKCGJCbZHKCEWJHOAVjGBAOAbjGIAKCFJRKAIATJRIAtATJRVSFMAVCBAM2BBHYyHTAOC/+F6HPJROAYCbZRtGXGXAYCIrHmQBAOCFJRbSFMAORbALAIAmlCbZCGWJ8oGBROMGXGXAtQBAbCFJRVSFMAbRVALAIAYlCbZCGWJ8oGBRbMGXGXAP9FQBAMCFJRYSFMAM1BFHYCgFZRTGXGXAYCa9MQBAMCGJRYSFMAM1BGHYCgBZCOWATCgBZqRTGXAYCa9MQBAMCEJRYSFMAM1BEHYCgBZCfWATqRTGXAYCa9MQBAMCIJRYSFMAM1BIHYCgBZCdWATqRTGXAYCa9MQBAMCLJRYSFMAMCKJRYAM2BLC8cWATqRTMATCFrCBATCFZl9zAQJHQRTMGXGXAmCb6QBAYRPSFMAY1BBHMCgFZROGXGXAMCa9MQBAYCFJRPSFMAY1BFHMCgBZCOWAOCgBZqROGXAMCa9MQBAYCGJRPSFMAY1BGHMCgBZCfWAOqROGXAMCa9MQBAYCEJRPSFMAY1BEHMCgBZCdWAOqROGXAMCa9MQBAYCIJRPSFMAYCLJRPAY2BIC8cWAOqROMAOCFrCBAOCFZl9zAQJHQROMGXGXAtCb6QBAPRMSFMAP1BBHMCgFZRbGXGXAMCa9MQBAPCFJRMSFMAP1BFHMCgBZCOWAbCgBZqRbGXAMCa9MQBAPCGJRMSFMAP1BGHMCgBZCfWAbqRbGXAMCa9MQBAPCEJRMSFMAP1BEHMCgBZCdWAbqRbGXAMCa9MQBAPCIJRMSFMAPCLJRMAP2BIC8cWAbqRbMAbCFrCBAbCFZl9zAQJHQRbMGXGXAGCG9HQBABAT87FBABCIJAb87FBABCGJAO87FBSFMAEATjGBAECNJAbjGBAECIJAOjGBMALCoBJAKCEWJHYAOjGBAYATjGIALAICGWJATjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAICFJHICbZCGWJAOjGBALCoBJAKCGJCbZCEWJHOATjGBAOAbjGIALAIAm9FAmCb6qJHICbZCGWJAbjGBAIAt9FAtCb6qJRIAKCEJRKMANCFJRNABCKJRBAECSJREAKCbZRKAICbZRIAfCEJHfAF9JQBMMCBC99AMAc6yRKMALCoFJ8kUUUUBAKM/tIFGa8jUUUUBCTlRLC9+RKGXAFCLJAI9LQBCaRKAE2BBC/+FZC/QF9HQBALhB83ENAECFJRKAEAIJC98JREGXAF9FQBGXAGCG6QBEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMALCNJAICFZCGWqHGAICGrCBAICFrCFZl9zAG8oGBJHIjGBABAIjGBABCIJRBAFCaJHFQBSGMMEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMABAICGrCBAICFrCFZl9zALCNJAICFZCGWqHI8oGBJHG87FBAIAGjGBABCGJRBAFCaJHFQBMMCBC99AKAE6yRKMAKM/dLEK97FaF97GXGXAGCI9HQBAF9FQFCBRGEXABABDBBBHECiD+rFCiD+sFD/6FHIAECND+rFCiD+sFD/6FAID/gFAECTD+rFCiD+sFD/6FHLD/gFD/kFD/lFHKCBDtD+2FHOAICUUUU94DtHND9OD9RD/kFHI9DBB/+hDYAIAID/mFAKAKD/mFALAOALAND9OD9RD/kFHIAID/mFD/kFD/kFD/jFD/nFHLD/mF9DBBX9LDYHOD/kFCgFDtD9OAECUUU94DtD9OD9QAIALD/mFAOD/kFCND+rFCU/+EDtD9OD9QAKALD/mFAOD/kFCTD+rFCUU/8ODtD9OD9QDMBBABCTJRBAGCIJHGAF9JQBSGMMAF9FQBCBRGEXABCTJHVAVDBBBHECBDtHOCUU98D8cFCUU98D8cEHND9OABDBBBHKAEDQILKOSQfbPden8c8d8e8fCggFDtD9OD/6FAKAEDQBFGENVcMTtmYi8ZpyHECTD+sFD/6FHID/gFAECTD+rFCTD+sFD/6FHLD/gFD/kFD/lFHE9DB/+g6DYALAEAOD+2FHOALCUUUU94DtHcD9OD9RD/kFHLALD/mFAEAED/mFAIAOAIAcD9OD9RD/kFHEAED/mFD/kFD/kFD/jFD/nFHID/mF9DBBX9LDYHOD/kFCTD+rFALAID/mFAOD/kFCggEDtD9OD9QHLAEAID/mFAOD/kFCaDbCBDnGCBDnECBDnKCBDnOCBDncCBDnMCBDnfCBDnbD9OHEDQNVi8ZcMpySQ8c8dfb8e8fD9QDMBBABAKAND9OALAEDQBFTtGEmYILPdKOenD9QDMBBABCAJRBAGCIJHGAF9JQBMMM/hEIGaF97FaL978jUUUUBCTlREGXAF9FQBCBRIEXAEABDBBBHLABCTJHKDBBBHODQILKOSQfbPden8c8d8e8fHNCTD+sFHVCID+rFDMIBAB9DBBU8/DY9D/zI818/DYAVCEDtD9QD/6FD/nFHVALAODQBFGENVcMTtmYi8ZpyHLCTD+rFCTD+sFD/6FD/mFHOAOD/mFAVALCTD+sFD/6FD/mFHcAcD/mFAVANCTD+rFCTD+sFD/6FD/mFHNAND/mFD/kFD/kFD/lFCBDtD+4FD/jF9DB/+g6DYHVD/mF9DBBX9LDYHLD/kFCggEDtHMD9OAcAVD/mFALD/kFCTD+rFD9QHcANAVD/mFALD/kFCTD+rFAOAVD/mFALD/kFAMD9OD9QHVDQBFTtGEmYILPdKOenHLD8dBAEDBIBDyB+t+J83EBABCNJALD8dFAEDBIBDyF+t+J83EBAKAcAVDQNVi8ZcMpySQ8c8dfb8e8fHVD8dBAEDBIBDyG+t+J83EBABCiJAVD8dFAEDBIBDyE+t+J83EBABCAJRBAICIJHIAF9JQBMMM9jFF97GXAGCGrAF9sHG9FQBCBRFEXABABDBBBHECND+rFCND+sFD/6FAECiD+sFCnD+rFCUUU/8EDtD+uFD/mFDMBBABCTJRBAFCIJHFAG9JQBMMM9TFEaCBCB8oGUkUUBHFABCEJC98ZJHBjGUkUUBGXGXAB8/BCTWHGuQBCaREABAGlCggEJCTrXBCa6QFMAFREMAEMMMFBCUNMIT9tBB",t=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]),n=new Uint8Array([32,0,65,253,3,1,2,34,4,106,6,5,11,8,7,20,13,33,12,16,128,9,116,64,19,113,127,15,10,21,22,14,255,66,24,54,136,107,18,23,192,26,114,118,132,17,77,101,130,144,27,87,131,44,45,74,156,154,70,167]);if(typeof WebAssembly!="object")return{supported:!1};let i=a;WebAssembly.validate(t)&&(i=e);let s;const o=WebAssembly.instantiate(r(i),{}).then(h=>{s=h.instance,s.exports.__wasm_call_ctors()});function r(h){const f=new Uint8Array(h.length);for(let y=0;y<h.length;++y){const v=h.charCodeAt(y);f[y]=v>96?v-71:v>64?v-65:v>47?v+4:v>46?63:62}let p=0;for(let y=0;y<h.length;++y)f[p++]=f[y]<60?n[f[y]]:(f[y]-60)*64+f[++y];return f.buffer.slice(0,p)}function g(h,f,p,y,v,G){const B=s.exports.sbrk,R=p+3&-4,x=B(R*y),w=B(v.length),M=new Uint8Array(s.exports.memory.buffer);M.set(v,w);const H=h(x,p,y,w,v.length);if(H===0&&G&&G(x,R,y),f.set(M.subarray(x,x+p*y)),B(x-B(0)),H!==0)throw new Error(`Malformed buffer data: ${H}`)}const u={0:"",1:"meshopt_decodeFilterOct",2:"meshopt_decodeFilterQuat",3:"meshopt_decodeFilterExp",NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},C={0:"meshopt_decodeVertexBuffer",1:"meshopt_decodeIndexBuffer",2:"meshopt_decodeIndexSequence",ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};return Bb={ready:o,supported:!0,decodeVertexBuffer(h,f,p,y,v){g(s.exports.meshopt_decodeVertexBuffer,h,f,p,y,s.exports[u[v]])},decodeIndexBuffer(h,f,p,y){g(s.exports.meshopt_decodeIndexBuffer,h,f,p,y)},decodeIndexSequence(h,f,p,y){g(s.exports.meshopt_decodeIndexSequence,h,f,p,y)},decodeGltfBuffer(h,f,p,y,v,G){g(s.exports[C[v]],h,f,p,y,s.exports[u[G]])}},Bb};function CD(){var a=Object.create(null);function e(i,s){var o=i.id,r=i.name,g=i.dependencies;g===void 0&&(g=[]);var u=i.init;u===void 0&&(u=function(){});var C=i.getTransferables;if(C===void 0&&(C=null),!a[o])try{g=g.map(function(f){return f&&f.isWorkerModule&&(e(f,function(p){if(p instanceof Error)throw p}),f=a[f.id].value),f}),u=n("<"+r+">.init",u),C&&(C=n("<"+r+">.getTransferables",C));var h=null;typeof u=="function"?h=u.apply(void 0,g):console.error("worker module init function failed to rehydrate"),a[o]={id:o,value:h,getTransferables:C},s(h)}catch(f){f&&f.noLog||console.error(f),s(f)}}function t(i,s){var o,r=i.id,g=i.args;(!a[r]||typeof a[r].value!="function")&&s(new Error("Worker module "+r+": not found or its 'init' did not return a function"));try{var u=(o=a[r]).value.apply(o,g);u&&typeof u.then=="function"?u.then(C,function(h){return s(h instanceof Error?h:new Error(""+h))}):C(u)}catch(h){s(h)}function C(h){try{var f=a[r].getTransferables&&a[r].getTransferables(h);(!f||!Array.isArray(f)||!f.length)&&(f=void 0),s(h,f)}catch(p){console.error(p),s(p)}}}function n(i,s){var o=void 0;self.troikaDefine=function(g){return o=g};var r=URL.createObjectURL(new Blob(["/** "+i.replace(/\*/g,"")+` **/

troikaDefine(
`+s+`
)`],{type:"application/javascript"}));try{importScripts(r)}catch(g){console.error(g)}return URL.revokeObjectURL(r),delete self.troikaDefine,o}self.addEventListener("message",function(i){var s=i.data,o=s.messageId,r=s.action,g=s.data;try{r==="registerModule"&&e(g,function(u){u instanceof Error?postMessage({messageId:o,success:!1,error:u.message}):postMessage({messageId:o,success:!0,result:{isCallable:typeof u=="function"}})}),r==="callModule"&&t(g,function(u,C){u instanceof Error?postMessage({messageId:o,success:!1,error:u.message}):postMessage({messageId:o,success:!0,result:u},C||void 0)})}catch(u){postMessage({messageId:o,success:!1,error:u.stack})}})}function dD(a){var e=function(){for(var t=[],n=arguments.length;n--;)t[n]=arguments[n];return e._getInitResult().then(function(i){if(typeof i=="function")return i.apply(void 0,t);throw new Error("Worker module function was called but `init` did not return a callable function")})};return e._getInitResult=function(){var t=a.dependencies,n=a.init;t=Array.isArray(t)?t.map(function(s){return s&&(s=s.onMainThread||s,s._getInitResult&&(s=s._getInitResult())),s}):[];var i=Promise.all(t).then(function(s){return n.apply(null,s)});return e._getInitResult=function(){return i},i},e}var uH=function(){var a=!1;if(typeof window<"u"&&typeof window.document<"u")try{var e=new Worker(URL.createObjectURL(new Blob([""],{type:"application/javascript"})));e.terminate(),a=!0}catch(t){console.log("Troika createWorkerModule: web workers not allowed; falling back to main thread execution. Cause: ["+t.message+"]")}return uH=function(){return a},a},AD=0,hD=0,nv=!1,bf=Object.create(null),yf=Object.create(null),r2=Object.create(null);function fA(a){if((!a||typeof a.init!="function")&&!nv)throw new Error("requires `options.init` function");var e=a.dependencies,t=a.init,n=a.getTransferables,i=a.workerId,s=dD(a);i==null&&(i="#default");var o="workerModule"+ ++AD,r=a.name||o,g=null;e=e&&e.map(function(C){return typeof C=="function"&&!C.workerModuleData&&(nv=!0,C=fA({workerId:i,name:"<"+r+"> function dependency: "+C.name,init:`function(){return (
`+Ob(C)+`
)}`}),nv=!1),C&&C.workerModuleData&&(C=C.workerModuleData),C});function u(){for(var C=[],h=arguments.length;h--;)C[h]=arguments[h];if(!uH())return s.apply(void 0,C);if(!g){g=b1(i,"registerModule",u.workerModuleData);var f=function(){g=null,yf[i].delete(f)};(yf[i]||(yf[i]=new Set)).add(f)}return g.then(function(p){var y=p.isCallable;if(y)return b1(i,"callModule",{id:o,args:C});throw new Error("Worker module function was called but `init` did not return a callable function")})}return u.workerModuleData={isWorkerModule:!0,id:o,name:r,dependencies:e,init:Ob(t),getTransferables:n&&Ob(n)},u.onMainThread=s,u}function fD(a){yf[a]&&yf[a].forEach(function(e){e()}),bf[a]&&(bf[a].terminate(),delete bf[a])}function Ob(a){var e=a.toString();return!/^function/.test(e)&&/^\w+\s*\(/.test(e)&&(e="function "+e),e}function pD(a){var e=bf[a];if(!e){var t=Ob(CD);e=bf[a]=new Worker(URL.createObjectURL(new Blob(["/** Worker Module Bootstrap: "+a.replace(/\*/g,"")+` **/

;(`+t+")()"],{type:"application/javascript"}))),e.onmessage=function(n){var i=n.data,s=i.messageId,o=r2[s];if(!o)throw new Error("WorkerModule response with empty or unknown messageId");delete r2[s],o(i)}}return e}function b1(a,e,t){return new Promise(function(n,i){var s=++hD;r2[s]=function(o){o.success?n(o.result):i(new Error("Error in worker "+e+" call: "+o.error))},pD(a).postMessage({messageId:s,action:e,data:t})})}function IH(){var a=function(e){function t(se,L,D,ne,oe,j,re,pe){var me=1-re;pe.x=me*me*se+2*me*re*D+re*re*oe,pe.y=me*me*L+2*me*re*ne+re*re*j}function n(se,L,D,ne,oe,j,re,pe,me,be){var $e=1-me;be.x=$e*$e*$e*se+3*$e*$e*me*D+3*$e*me*me*oe+me*me*me*re,be.y=$e*$e*$e*L+3*$e*$e*me*ne+3*$e*me*me*j+me*me*me*pe}function i(se,L){for(var D=/([MLQCZ])([^MLQCZ]*)/g,ne,oe,j,re,pe;ne=D.exec(se);){var me=ne[2].replace(/^\s*|\s*$/g,"").split(/[,\s]+/).map(function(be){return parseFloat(be)});switch(ne[1]){case"M":re=oe=me[0],pe=j=me[1];break;case"L":(me[0]!==re||me[1]!==pe)&&L("L",re,pe,re=me[0],pe=me[1]);break;case"Q":{L("Q",re,pe,re=me[2],pe=me[3],me[0],me[1]);break}case"C":{L("C",re,pe,re=me[4],pe=me[5],me[0],me[1],me[2],me[3]);break}case"Z":(re!==oe||pe!==j)&&L("L",re,pe,oe,j);break}}}function s(se,L,D){D===void 0&&(D=16);var ne={x:0,y:0};i(se,function(oe,j,re,pe,me,be,$e,qe,ke){switch(oe){case"L":L(j,re,pe,me);break;case"Q":{for(var Te=j,ut=re,q=1;q<D;q++)t(j,re,be,$e,pe,me,q/(D-1),ne),L(Te,ut,ne.x,ne.y),Te=ne.x,ut=ne.y;break}case"C":{for(var De=j,Ke=re,Ee=1;Ee<D;Ee++)n(j,re,be,$e,qe,ke,pe,me,Ee/(D-1),ne),L(De,Ke,ne.x,ne.y),De=ne.x,Ke=ne.y;break}}})}var o="precision highp float;attribute vec2 aUV;varying vec2 vUV;void main(){vUV=aUV;gl_Position=vec4(mix(vec2(-1.0),vec2(1.0),aUV),0.0,1.0);}",r="precision highp float;uniform sampler2D tex;varying vec2 vUV;void main(){gl_FragColor=texture2D(tex,vUV);}",g=new WeakMap,u={premultipliedAlpha:!1,preserveDrawingBuffer:!0,antialias:!1,depth:!1};function C(se,L){var D=se.getContext?se.getContext("webgl",u):se,ne=g.get(D);if(!ne){let De=function(Ze){var gt=j[Ze];if(!gt&&(gt=j[Ze]=D.getExtension(Ze),!gt))throw new Error(Ze+" not supported");return gt},Ke=function(Ze,gt){var k=D.createShader(gt);return D.shaderSource(k,Ze),D.compileShader(k),k},Ee=function(Ze,gt,k,z){if(!re[Ze]){var Ce={},Ve={},Ge=D.createProgram();D.attachShader(Ge,Ke(gt,D.VERTEX_SHADER)),D.attachShader(Ge,Ke(k,D.FRAGMENT_SHADER)),D.linkProgram(Ge),re[Ze]={program:Ge,transaction:function(et){D.useProgram(Ge),et({setUniform:function(Ct,At){for(var Ne=[],tt=arguments.length-2;tt-- >0;)Ne[tt]=arguments[tt+2];var nt=Ve[At]||(Ve[At]=D.getUniformLocation(Ge,At));D["uniform"+Ct].apply(D,[nt].concat(Ne))},setAttribute:function(Ct,At,Ne,tt,nt){var ue=Ce[Ct];ue||(ue=Ce[Ct]={buf:D.createBuffer(),loc:D.getAttribLocation(Ge,Ct),data:null}),D.bindBuffer(D.ARRAY_BUFFER,ue.buf),D.vertexAttribPointer(ue.loc,At,D.FLOAT,!1,0,0),D.enableVertexAttribArray(ue.loc),oe?D.vertexAttribDivisor(ue.loc,tt):De("ANGLE_instanced_arrays").vertexAttribDivisorANGLE(ue.loc,tt),nt!==ue.data&&(D.bufferData(D.ARRAY_BUFFER,nt,Ne),ue.data=nt)}})}}}re[Ze].transaction(z)},ye=function(Ze,gt){me++;try{D.activeTexture(D.TEXTURE0+me);var k=pe[Ze];k||(k=pe[Ze]=D.createTexture(),D.bindTexture(D.TEXTURE_2D,k),D.texParameteri(D.TEXTURE_2D,D.TEXTURE_MIN_FILTER,D.NEAREST),D.texParameteri(D.TEXTURE_2D,D.TEXTURE_MAG_FILTER,D.NEAREST)),D.bindTexture(D.TEXTURE_2D,k),gt(k,me)}finally{me--}},Je=function(Ze,gt,k){var z=D.createFramebuffer();be.push(z),D.bindFramebuffer(D.FRAMEBUFFER,z),D.activeTexture(D.TEXTURE0+gt),D.bindTexture(D.TEXTURE_2D,Ze),D.framebufferTexture2D(D.FRAMEBUFFER,D.COLOR_ATTACHMENT0,D.TEXTURE_2D,Ze,0);try{k(z)}finally{D.deleteFramebuffer(z),D.bindFramebuffer(D.FRAMEBUFFER,be[--be.length-1]||null)}},Me=function(){j={},re={},pe={},me=-1,be.length=0};var $e=De,qe=Ke,ke=Ee,Te=ye,ut=Je,q=Me,oe=typeof WebGL2RenderingContext<"u"&&D instanceof WebGL2RenderingContext,j={},re={},pe={},me=-1,be=[];D.canvas.addEventListener("webglcontextlost",function(Ze){Me(),Ze.preventDefault()},!1),g.set(D,ne={gl:D,isWebGL2:oe,getExtension:De,withProgram:Ee,withTexture:ye,withTextureFramebuffer:Je,handleContextLoss:Me})}L(ne)}function h(se,L,D,ne,oe,j,re,pe){re===void 0&&(re=15),pe===void 0&&(pe=null),C(se,function(me){var be=me.gl,$e=me.withProgram,qe=me.withTexture;qe("copy",function(ke,Te){be.texImage2D(be.TEXTURE_2D,0,be.RGBA,oe,j,0,be.RGBA,be.UNSIGNED_BYTE,L),$e("copy",o,r,function(ut){var q=ut.setUniform,De=ut.setAttribute;De("aUV",2,be.STATIC_DRAW,0,new Float32Array([0,0,2,0,0,2])),q("1i","image",Te),be.bindFramebuffer(be.FRAMEBUFFER,pe||null),be.disable(be.BLEND),be.colorMask(re&8,re&4,re&2,re&1),be.viewport(D,ne,oe,j),be.scissor(D,ne,oe,j),be.drawArrays(be.TRIANGLES,0,3)})})})}function f(se,L,D){var ne=se.width,oe=se.height;C(se,function(j){var re=j.gl,pe=new Uint8Array(ne*oe*4);re.readPixels(0,0,ne,oe,re.RGBA,re.UNSIGNED_BYTE,pe),se.width=L,se.height=D,h(re,pe,0,0,ne,oe)})}var p=Object.freeze({__proto__:null,withWebGLContext:C,renderImageData:h,resizeWebGLCanvasWithoutClearing:f});function y(se,L,D,ne,oe,j){j===void 0&&(j=1);var re=new Uint8Array(se*L),pe=ne[2]-ne[0],me=ne[3]-ne[1],be=[];s(D,function(De,Ke,Ee,ye){be.push({x1:De,y1:Ke,x2:Ee,y2:ye,minX:Math.min(De,Ee),minY:Math.min(Ke,ye),maxX:Math.max(De,Ee),maxY:Math.max(Ke,ye)})}),be.sort(function(De,Ke){return De.maxX-Ke.maxX});for(var $e=0;$e<se;$e++)for(var qe=0;qe<L;qe++){var ke=ut(ne[0]+pe*($e+.5)/se,ne[1]+me*(qe+.5)/L),Te=Math.pow(1-Math.abs(ke)/oe,j)/2;ke<0&&(Te=1-Te),Te=Math.max(0,Math.min(255,Math.round(Te*255))),re[qe*se+$e]=Te}return re;function ut(De,Ke){for(var Ee=1/0,ye=1/0,Je=be.length;Je--;){var Me=be[Je];if(Me.maxX+ye<=De)break;if(De+ye>Me.minX&&Ke-ye<Me.maxY&&Ke+ye>Me.minY){var Ze=B(De,Ke,Me.x1,Me.y1,Me.x2,Me.y2);Ze<Ee&&(Ee=Ze,ye=Math.sqrt(Ee))}}return q(De,Ke)&&(ye=-ye),ye}function q(De,Ke){for(var Ee=0,ye=be.length;ye--;){var Je=be[ye];if(Je.maxX<=De)break;var Me=Je.y1>Ke!=Je.y2>Ke&&De<(Je.x2-Je.x1)*(Ke-Je.y1)/(Je.y2-Je.y1)+Je.x1;Me&&(Ee+=Je.y1<Je.y2?1:-1)}return Ee!==0}}function v(se,L,D,ne,oe,j,re,pe,me,be){j===void 0&&(j=1),pe===void 0&&(pe=0),me===void 0&&(me=0),be===void 0&&(be=0),G(se,L,D,ne,oe,j,re,null,pe,me,be)}function G(se,L,D,ne,oe,j,re,pe,me,be,$e){j===void 0&&(j=1),me===void 0&&(me=0),be===void 0&&(be=0),$e===void 0&&($e=0);for(var qe=y(se,L,D,ne,oe,j),ke=new Uint8Array(qe.length*4),Te=0;Te<qe.length;Te++)ke[Te*4+$e]=qe[Te];h(re,ke,me,be,se,L,1<<3-$e,pe)}function B(se,L,D,ne,oe,j){var re=oe-D,pe=j-ne,me=re*re+pe*pe,be=me?Math.max(0,Math.min(1,((se-D)*re+(L-ne)*pe)/me)):0,$e=se-(D+be*re),qe=L-(ne+be*pe);return $e*$e+qe*qe}var R=Object.freeze({__proto__:null,generate:y,generateIntoCanvas:v,generateIntoFramebuffer:G}),x="precision highp float;uniform vec4 uGlyphBounds;attribute vec2 aUV;attribute vec4 aLineSegment;varying vec4 vLineSegment;varying vec2 vGlyphXY;void main(){vLineSegment=aLineSegment;vGlyphXY=mix(uGlyphBounds.xy,uGlyphBounds.zw,aUV);gl_Position=vec4(mix(vec2(-1.0),vec2(1.0),aUV),0.0,1.0);}",w="precision highp float;uniform vec4 uGlyphBounds;uniform float uMaxDistance;uniform float uExponent;varying vec4 vLineSegment;varying vec2 vGlyphXY;float absDistToSegment(vec2 point,vec2 lineA,vec2 lineB){vec2 lineDir=lineB-lineA;float lenSq=dot(lineDir,lineDir);float t=lenSq==0.0 ? 0.0 : clamp(dot(point-lineA,lineDir)/lenSq,0.0,1.0);vec2 linePt=lineA+t*lineDir;return distance(point,linePt);}void main(){vec4 seg=vLineSegment;vec2 p=vGlyphXY;float dist=absDistToSegment(p,seg.xy,seg.zw);float val=pow(1.0-clamp(dist/uMaxDistance,0.0,1.0),uExponent)*0.5;bool crossing=(seg.y>p.y!=seg.w>p.y)&&(p.x<(seg.z-seg.x)*(p.y-seg.y)/(seg.w-seg.y)+seg.x);bool crossingUp=crossing&&vLineSegment.y<vLineSegment.w;gl_FragColor=vec4(crossingUp ? 1.0/255.0 : 0.0,crossing&&!crossingUp ? 1.0/255.0 : 0.0,0.0,val);}",M="precision highp float;uniform sampler2D tex;varying vec2 vUV;void main(){vec4 color=texture2D(tex,vUV);bool inside=color.r!=color.g;float val=inside ? 1.0-color.a : color.a;gl_FragColor=vec4(val);}",H=new Float32Array([0,0,2,0,0,2]),N=null,F=!1,Y={},X=new WeakMap;function U(se){if(!F&&!le(se))throw new Error("WebGL generation not supported")}function O(se,L,D,ne,oe,j,re){if(j===void 0&&(j=1),re===void 0&&(re=null),!re&&(re=N,!re)){var pe=typeof OffscreenCanvas=="function"?new OffscreenCanvas(1,1):typeof document<"u"?document.createElement("canvas"):null;if(!pe)throw new Error("OffscreenCanvas or DOM canvas not supported");re=N=pe.getContext("webgl",{depth:!1})}U(re);var me=new Uint8Array(se*L*4);C(re,function(ke){var Te=ke.gl,ut=ke.withTexture,q=ke.withTextureFramebuffer;ut("readable",function(De,Ke){Te.texImage2D(Te.TEXTURE_2D,0,Te.RGBA,se,L,0,Te.RGBA,Te.UNSIGNED_BYTE,null),q(De,Ke,function(Ee){ie(se,L,D,ne,oe,j,Te,Ee,0,0,0),Te.readPixels(0,0,se,L,Te.RGBA,Te.UNSIGNED_BYTE,me)})})});for(var be=new Uint8Array(se*L),$e=0,qe=0;$e<me.length;$e+=4)be[qe++]=me[$e];return be}function P(se,L,D,ne,oe,j,re,pe,me,be){j===void 0&&(j=1),pe===void 0&&(pe=0),me===void 0&&(me=0),be===void 0&&(be=0),ie(se,L,D,ne,oe,j,re,null,pe,me,be)}function ie(se,L,D,ne,oe,j,re,pe,me,be,$e){j===void 0&&(j=1),me===void 0&&(me=0),be===void 0&&(be=0),$e===void 0&&($e=0),U(re);var qe=[];s(D,function(ke,Te,ut,q){qe.push(ke,Te,ut,q)}),qe=new Float32Array(qe),C(re,function(ke){var Te=ke.gl,ut=ke.isWebGL2,q=ke.getExtension,De=ke.withProgram,Ke=ke.withTexture,Ee=ke.withTextureFramebuffer,ye=ke.handleContextLoss;if(Ke("rawDistances",function(Je,Me){(se!==Je._lastWidth||L!==Je._lastHeight)&&Te.texImage2D(Te.TEXTURE_2D,0,Te.RGBA,Je._lastWidth=se,Je._lastHeight=L,0,Te.RGBA,Te.UNSIGNED_BYTE,null),De("main",x,w,function(Ze){var gt=Ze.setAttribute,k=Ze.setUniform,z=!ut&&q("ANGLE_instanced_arrays"),Ce=!ut&&q("EXT_blend_minmax");gt("aUV",2,Te.STATIC_DRAW,0,H),gt("aLineSegment",4,Te.DYNAMIC_DRAW,1,qe),k.apply(void 0,["4f","uGlyphBounds"].concat(ne)),k("1f","uMaxDistance",oe),k("1f","uExponent",j),Ee(Je,Me,function(Ve){Te.enable(Te.BLEND),Te.colorMask(!0,!0,!0,!0),Te.viewport(0,0,se,L),Te.scissor(0,0,se,L),Te.blendFunc(Te.ONE,Te.ONE),Te.blendEquationSeparate(Te.FUNC_ADD,ut?Te.MAX:Ce.MAX_EXT),Te.clear(Te.COLOR_BUFFER_BIT),ut?Te.drawArraysInstanced(Te.TRIANGLES,0,3,qe.length/4):z.drawArraysInstancedANGLE(Te.TRIANGLES,0,3,qe.length/4)})}),De("post",o,M,function(Ze){Ze.setAttribute("aUV",2,Te.STATIC_DRAW,0,H),Ze.setUniform("1i","tex",Me),Te.bindFramebuffer(Te.FRAMEBUFFER,pe),Te.disable(Te.BLEND),Te.colorMask($e===0,$e===1,$e===2,$e===3),Te.viewport(me,be,se,L),Te.scissor(me,be,se,L),Te.drawArrays(Te.TRIANGLES,0,3)})}),Te.isContextLost())throw ye(),new Error("webgl context lost")})}function le(se){var L=!se||se===N?Y:se.canvas||se,D=X.get(L);if(D===void 0){F=!0;var ne=null;try{var oe=[97,106,97,61,99,137,118,80,80,118,137,99,61,97,106,97],j=O(4,4,"M8,8L16,8L24,24L16,24Z",[0,0,32,32],24,1,se);D=j&&oe.length===j.length&&j.every(function(re,pe){return re===oe[pe]}),D||(ne="bad trial run results",console.info(oe,j))}catch(re){D=!1,ne=re.message}ne&&console.warn("WebGL SDF generation not supported:",ne),F=!1,X.set(L,D)}return D}var T=Object.freeze({__proto__:null,generate:O,generateIntoCanvas:P,generateIntoFramebuffer:ie,isSupported:le});function J(se,L,D,ne,oe,j){oe===void 0&&(oe=Math.max(ne[2]-ne[0],ne[3]-ne[1])/2),j===void 0&&(j=1);try{return O.apply(T,arguments)}catch(re){return console.info("WebGL SDF generation failed, falling back to JS",re),y.apply(R,arguments)}}function Q(se,L,D,ne,oe,j,re,pe,me,be){oe===void 0&&(oe=Math.max(ne[2]-ne[0],ne[3]-ne[1])/2),j===void 0&&(j=1),pe===void 0&&(pe=0),me===void 0&&(me=0),be===void 0&&(be=0);try{return P.apply(T,arguments)}catch($e){return console.info("WebGL SDF generation failed, falling back to JS",$e),v.apply(R,arguments)}}return e.forEachPathCommand=i,e.generate=J,e.generateIntoCanvas=Q,e.javascript=R,e.pathToLineSegments=s,e.webgl=T,e.webglUtils=p,Object.defineProperty(e,"__esModule",{value:!0}),e}({});return a}function mD(){var a=function(e){var t={R:"13k,1a,2,3,3,2+1j,ch+16,a+1,5+2,2+n,5,a,4,6+16,4+3,h+1b,4mo,179q,2+9,2+11,2i9+7y,2+68,4,3+4,5+13,4+3,2+4k,3+29,8+cf,1t+7z,w+17,3+3m,1t+3z,16o1+5r,8+30,8+mc,29+1r,29+4v,75+73",EN:"1c+9,3d+1,6,187+9,513,4+5,7+9,sf+j,175h+9,qw+q,161f+1d,4xt+a,25i+9",ES:"17,2,6dp+1,f+1,av,16vr,mx+1,4o,2",ET:"z+2,3h+3,b+1,ym,3e+1,2o,p4+1,8,6u,7c,g6,1wc,1n9+4,30+1b,2n,6d,qhx+1,h0m,a+1,49+2,63+1,4+1,6bb+3,12jj",AN:"16o+5,2j+9,2+1,35,ed,1ff2+9,87+u",CS:"18,2+1,b,2u,12k,55v,l,17v0,2,3,53,2+1,b",B:"a,3,f+2,2v,690",S:"9,2,k",WS:"c,k,4f4,1vk+a,u,1j,335",ON:"x+1,4+4,h+5,r+5,r+3,z,5+3,2+1,2+1,5,2+2,3+4,o,w,ci+1,8+d,3+d,6+8,2+g,39+1,9,6+1,2,33,b8,3+1,3c+1,7+1,5r,b,7h+3,sa+5,2,3i+6,jg+3,ur+9,2v,ij+1,9g+9,7+a,8m,4+1,49+x,14u,2+2,c+2,e+2,e+2,e+1,i+n,e+e,2+p,u+2,e+2,36+1,2+3,2+1,b,2+2,6+5,2,2,2,h+1,5+4,6+3,3+f,16+2,5+3l,3+81,1y+p,2+40,q+a,m+13,2r+ch,2+9e,75+hf,3+v,2+2w,6e+5,f+6,75+2a,1a+p,2+2g,d+5x,r+b,6+3,4+o,g,6+1,6+2,2k+1,4,2j,5h+z,1m+1,1e+f,t+2,1f+e,d+3,4o+3,2s+1,w,535+1r,h3l+1i,93+2,2s,b+1,3l+x,2v,4g+3,21+3,kz+1,g5v+1,5a,j+9,n+v,2,3,2+8,2+1,3+2,2,3,46+1,4+4,h+5,r+5,r+a,3h+2,4+6,b+4,78,1r+24,4+c,4,1hb,ey+6,103+j,16j+c,1ux+7,5+g,fsh,jdq+1t,4,57+2e,p1,1m,1m,1m,1m,4kt+1,7j+17,5+2r,d+e,3+e,2+e,2+10,m+4,w,1n+5,1q,4z+5,4b+rb,9+c,4+c,4+37,d+2g,8+b,l+b,5+1j,9+9,7+13,9+t,3+1,27+3c,2+29,2+3q,d+d,3+4,4+2,6+6,a+o,8+6,a+2,e+6,16+42,2+1i",BN:"0+8,6+d,2s+5,2+p,e,4m9,1kt+2,2b+5,5+5,17q9+v,7k,6p+8,6+1,119d+3,440+7,96s+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+75,6p+2rz,1ben+1,1ekf+1,1ekf+1",NSM:"lc+33,7o+6,7c+18,2,2+1,2+1,2,21+a,1d+k,h,2u+6,3+5,3+1,2+3,10,v+q,2k+a,1n+8,a,p+3,2+8,2+2,2+4,18+2,3c+e,2+v,1k,2,5+7,5,4+6,b+1,u,1n,5+3,9,l+1,r,3+1,1m,5+1,5+1,3+2,4,v+1,4,c+1,1m,5+4,2+1,5,l+1,n+5,2,1n,3,2+3,9,8+1,c+1,v,1q,d,1f,4,1m+2,6+2,2+3,8+1,c+1,u,1n,g+1,l+1,t+1,1m+1,5+3,9,l+1,u,21,8+2,2,2j,3+6,d+7,2r,3+8,c+5,23+1,s,2,2,1k+d,2+4,2+1,6+a,2+z,a,2v+3,2+5,2+1,3+1,q+1,5+2,h+3,e,3+1,7,g,jk+2,qb+2,u+2,u+1,v+1,1t+1,2+6,9,3+a,a,1a+2,3c+1,z,3b+2,5+1,a,7+2,64+1,3,1n,2+6,2,2,3+7,7+9,3,1d+g,1s+3,1d,2+4,2,6,15+8,d+1,x+3,3+1,2+2,1l,2+1,4,2+2,1n+7,3+1,49+2,2+c,2+6,5,7,4+1,5j+1l,2+4,k1+w,2db+2,3y,2p+v,ff+3,30+1,n9x+3,2+9,x+1,29+1,7l,4,5,q+1,6,48+1,r+h,e,13+7,q+a,1b+2,1d,3+3,3+1,14,1w+5,3+1,3+1,d,9,1c,1g,2+2,3+1,6+1,2,17+1,9,6n,3,5,fn5,ki+f,h+f,r2,6b,46+4,1af+2,2+1,6+3,15+2,5,4m+1,fy+3,as+1,4a+a,4x,1j+e,1l+2,1e+3,3+1,1y+2,11+4,2+7,1r,d+1,1h+8,b+3,3,2o+2,3,2+1,7,4h,4+7,m+1,1m+1,4,12+6,4+4,5g+7,3+2,2,o,2d+5,2,5+1,2+1,6n+3,7+1,2+1,s+1,2e+7,3,2+1,2z,2,3+5,2,2u+2,3+3,2+4,78+8,2+1,75+1,2,5,41+3,3+1,5,x+5,3+1,15+5,3+3,9,a+5,3+2,1b+c,2+1,bb+6,2+5,2d+l,3+6,2+1,2+1,3f+5,4,2+1,2+6,2,21+1,4,2,9o+1,f0c+4,1o+6,t5,1s+3,2a,f5l+1,43t+2,i+7,3+6,v+3,45+2,1j0+1i,5+1d,9,f,n+4,2+e,11t+6,2+g,3+6,2+1,2+4,7a+6,c6+3,15t+6,32+6,gzhy+6n",AL:"16w,3,2,e+1b,z+2,2+2s,g+1,8+1,b+m,2+t,s+2i,c+e,4h+f,1d+1e,1bwe+dp,3+3z,x+c,2+1,35+3y,2rm+z,5+7,b+5,dt+l,c+u,17nl+27,1t+27,4x+6n,3+d",LRO:"6ct",RLO:"6cu",LRE:"6cq",RLE:"6cr",PDF:"6cs",LRI:"6ee",RLI:"6ef",FSI:"6eg",PDI:"6eh"},n={},i={};n.L=1,i[1]="L",Object.keys(t).forEach(function(ye,Je){n[ye]=1<<Je+1,i[n[ye]]=ye}),Object.freeze(n);var s=n.LRI|n.RLI|n.FSI,o=n.L|n.R|n.AL,r=n.B|n.S|n.WS|n.ON|n.FSI|n.LRI|n.RLI|n.PDI,g=n.BN|n.RLE|n.LRE|n.RLO|n.LRO|n.PDF,u=n.S|n.WS|n.B|s|n.PDI|g,C=null;function h(){if(!C){C=new Map;var ye=function(Me){if(t.hasOwnProperty(Me)){var Ze=0;t[Me].split(",").forEach(function(gt){var k=gt.split("+"),z=k[0],Ce=k[1];z=parseInt(z,36),Ce=Ce?parseInt(Ce,36):0,C.set(Ze+=z,n[Me]);for(var Ve=0;Ve<Ce;Ve++)C.set(++Ze,n[Me])})}};for(var Je in t)ye(Je)}}function f(ye){return h(),C.get(ye.codePointAt(0))||n.L}function p(ye){return i[f(ye)]}var y={pairs:"14>1,1e>2,u>2,2wt>1,1>1,1ge>1,1wp>1,1j>1,f>1,hm>1,1>1,u>1,u6>1,1>1,+5,28>1,w>1,1>1,+3,b8>1,1>1,+3,1>3,-1>-1,3>1,1>1,+2,1s>1,1>1,x>1,th>1,1>1,+2,db>1,1>1,+3,3>1,1>1,+2,14qm>1,1>1,+1,4q>1,1e>2,u>2,2>1,+1",canonical:"6f1>-6dx,6dy>-6dx,6ec>-6ed,6ee>-6ed,6ww>2jj,-2ji>2jj,14r4>-1e7l,1e7m>-1e7l,1e7m>-1e5c,1e5d>-1e5b,1e5c>-14qx,14qy>-14qx,14vn>-1ecg,1ech>-1ecg,1edu>-1ecg,1eci>-1ecg,1eda>-1ecg,1eci>-1ecg,1eci>-168q,168r>-168q,168s>-14ye,14yf>-14ye"};function v(ye,Je){var Me=36,Ze=0,gt=new Map,k=Je&&new Map,z;return ye.split(",").forEach(function Ce(Ve){if(Ve.indexOf("+")!==-1)for(var Ge=+Ve;Ge--;)Ce(z);else{z=Ve;var we=Ve.split(">"),et=we[0],lt=we[1];et=String.fromCodePoint(Ze+=parseInt(et,Me)),lt=String.fromCodePoint(Ze+=parseInt(lt,Me)),gt.set(et,lt),Je&&k.set(lt,et)}}),{map:gt,reverseMap:k}}var G,B,R;function x(){if(!G){var ye=v(y.pairs,!0),Je=ye.map,Me=ye.reverseMap;G=Je,B=Me,R=v(y.canonical,!1).map}}function w(ye){return x(),G.get(ye)||null}function M(ye){return x(),B.get(ye)||null}function H(ye){return x(),R.get(ye)||null}var N=n.L,F=n.R,Y=n.EN,X=n.ES,U=n.ET,O=n.AN,P=n.CS,ie=n.B,le=n.S,T=n.ON,J=n.BN,Q=n.NSM,se=n.AL,L=n.LRO,D=n.RLO,ne=n.LRE,oe=n.RLE,j=n.PDF,re=n.LRI,pe=n.RLI,me=n.FSI,be=n.PDI;function $e(ye,Je){for(var Me=125,Ze=new Uint32Array(ye.length),gt=0;gt<ye.length;gt++)Ze[gt]=f(ye[gt]);var k=new Map;function z(pa,os){var Qi=Ze[pa];Ze[pa]=os,k.set(Qi,k.get(Qi)-1),Qi&r&&k.set(r,k.get(r)-1),k.set(os,(k.get(os)||0)+1),os&r&&k.set(r,(k.get(r)||0)+1)}for(var Ce=new Uint8Array(ye.length),Ve=new Map,Ge=[],we=null,et=0;et<ye.length;et++)we||Ge.push(we={start:et,end:ye.length-1,level:Je==="rtl"?1:Je==="ltr"?0:Xu(et,!1)}),Ze[et]&ie&&(we.end=et,we=null);for(var lt=oe|ne|D|L|s|be|j|ie,Ct=function(pa){return pa+(pa&1?1:2)},At=function(pa){return pa+(pa&1?2:1)},Ne=0;Ne<Ge.length;Ne++){we=Ge[Ne];var tt=[{_level:we.level,_override:0,_isolate:0}],nt=void 0,ue=0,xe=0,ct=0;k.clear();for(var Ie=we.start;Ie<=we.end;Ie++){var Qe=Ze[Ie];if(nt=tt[tt.length-1],k.set(Qe,(k.get(Qe)||0)+1),Qe&r&&k.set(r,(k.get(r)||0)+1),Qe&lt)if(Qe&(oe|ne)){Ce[Ie]=nt._level;var je=(Qe===oe?At:Ct)(nt._level);je<=Me&&!ue&&!xe?tt.push({_level:je,_override:0,_isolate:0}):ue||xe++}else if(Qe&(D|L)){Ce[Ie]=nt._level;var mt=(Qe===D?At:Ct)(nt._level);mt<=Me&&!ue&&!xe?tt.push({_level:mt,_override:Qe&D?F:N,_isolate:0}):ue||xe++}else if(Qe&s){Qe&me&&(Qe=Xu(Ie+1,!0)===1?pe:re),Ce[Ie]=nt._level,nt._override&&z(Ie,nt._override);var it=(Qe===pe?At:Ct)(nt._level);it<=Me&&ue===0&&xe===0?(ct++,tt.push({_level:it,_override:0,_isolate:1,_isolInitIndex:Ie})):ue++}else if(Qe&be){if(ue>0)ue--;else if(ct>0){for(xe=0;!tt[tt.length-1]._isolate;)tt.pop();var _e=tt[tt.length-1]._isolInitIndex;_e!=null&&(Ve.set(_e,Ie),Ve.set(Ie,_e)),tt.pop(),ct--}nt=tt[tt.length-1],Ce[Ie]=nt._level,nt._override&&z(Ie,nt._override)}else Qe&j?(ue===0&&(xe>0?xe--:!nt._isolate&&tt.length>1&&(tt.pop(),nt=tt[tt.length-1])),Ce[Ie]=nt._level):Qe&ie&&(Ce[Ie]=we.level);else Ce[Ie]=nt._level,nt._override&&Qe!==J&&z(Ie,nt._override)}for(var ht=[],yt=null,Bt=we.start;Bt<=we.end;Bt++){var xt=Ze[Bt];if(!(xt&g)){var Gn=Ce[Bt],gn=xt&s,Cn=xt===be;yt&&Gn===yt._level?(yt._end=Bt,yt._endsWithIsolInit=gn):ht.push(yt={_start:Bt,_end:Bt,_level:Gn,_startsWithPDI:Cn,_endsWithIsolInit:gn})}}for(var Kn=[],ui=0;ui<ht.length;ui++){var hi=ht[ui];if(!hi._startsWithPDI||hi._startsWithPDI&&!Ve.has(hi._start)){for(var $a=[yt=hi],aa=void 0;yt&&yt._endsWithIsolInit&&(aa=Ve.get(yt._end))!=null;)for(var Ii=ui+1;Ii<ht.length;Ii++)if(ht[Ii]._start===aa){$a.push(yt=ht[Ii]);break}for(var Jn=[],Bn=0;Bn<$a.length;Bn++)for(var es=$a[Bn],Ea=es._start;Ea<=es._end;Ea++)Jn.push(Ea);for(var jo=Ce[Jn[0]],no=we.level,Ci=Jn[0]-1;Ci>=0;Ci--)if(!(Ze[Ci]&g)){no=Ce[Ci];break}var qo=Jn[Jn.length-1],Zr=Ce[qo],ts=we.level;if(!(Ze[qo]&s)){for(var $=qo+1;$<=we.end;$++)if(!(Ze[$]&g)){ts=Ce[$];break}}Kn.push({_seqIndices:Jn,_sosType:Math.max(no,jo)%2?F:N,_eosType:Math.max(ts,Zr)%2?F:N})}}for(var Se=0;Se<Kn.length;Se++){var ze=Kn[Se],Be=ze._seqIndices,We=ze._sosType,dt=ze._eosType,bt=Ce[Be[0]]&1?F:N;if(k.get(Q))for(var vt=0;vt<Be.length;vt++){var Zt=Be[vt];if(Ze[Zt]&Q){for(var Tt=We,Xt=vt-1;Xt>=0;Xt--)if(!(Ze[Be[Xt]]&g)){Tt=Ze[Be[Xt]];break}z(Zt,Tt&(s|be)?T:Tt)}}if(k.get(Y))for(var Wt=0;Wt<Be.length;Wt++){var en=Be[Wt];if(Ze[en]&Y)for(var bn=Wt-1;bn>=-1;bn--){var Tn=bn===-1?We:Ze[Be[bn]];if(Tn&o){Tn===se&&z(en,O);break}}}if(k.get(se))for(var cn=0;cn<Be.length;cn++){var fn=Be[cn];Ze[fn]&se&&z(fn,F)}if(k.get(X)||k.get(P))for(var Nt=1;Nt<Be.length-1;Nt++){var Pn=Be[Nt];if(Ze[Pn]&(X|P)){for(var un=0,Ni=0,ns=Nt-1;ns>=0&&(un=Ze[Be[ns]],!!(un&g));ns--);for(var Fn=Nt+1;Fn<Be.length&&(Ni=Ze[Be[Fn]],!!(Ni&g));Fn++);un===Ni&&(Ze[Pn]===X?un===Y:un&(Y|O))&&z(Pn,un)}}if(k.get(Y))for(var Yi=0;Yi<Be.length;Yi++){var zn=Be[Yi];if(Ze[zn]&Y){for(var Si=Yi-1;Si>=0&&Ze[Be[Si]]&(U|g);Si--)z(Be[Si],Y);for(Yi++;Yi<Be.length&&Ze[Be[Yi]]&(U|g|Y);Yi++)Ze[Be[Yi]]!==Y&&z(Be[Yi],Y)}}if(k.get(U)||k.get(X)||k.get(P))for(var ti=0;ti<Be.length;ti++){var Ki=Be[ti];if(Ze[Ki]&(U|X|P)){z(Ki,T);for(var bi=ti-1;bi>=0&&Ze[Be[bi]]&g;bi--)z(Be[bi],T);for(var Pi=ti+1;Pi<Be.length&&Ze[Be[Pi]]&g;Pi++)z(Be[Pi],T)}}if(k.get(Y))for(var is=0,Sr=We;is<Be.length;is++){var Rr=Be[is],wr=Ze[Rr];wr&Y?Sr===N&&z(Rr,N):wr&o&&(Sr=wr)}if(k.get(r)){var Vl=F|Y|O,Hu=Vl|N,$o=[];{for(var Vo=[],Mo=0;Mo<Be.length;Mo++)if(Ze[Be[Mo]]&r){var as=ye[Be[Mo]],el=void 0;if(w(as)!==null)if(Vo.length<63)Vo.push({char:as,seqIndex:Mo});else break;else if((el=M(as))!==null)for(var Ml=Vo.length-1;Ml>=0;Ml--){var Hl=Vo[Ml].char;if(Hl===el||Hl===M(H(as))||w(H(Hl))===as){$o.push([Vo[Ml].seqIndex,Mo]),Vo.length=Ml;break}}}$o.sort(function(pa,os){return pa[0]-os[0]})}for(var yg=0;yg<$o.length;yg++){for(var Xl=$o[yg],Ta=Xl[0],Nl=Xl[1],Yl=!1,Fi=0,Gg=Ta+1;Gg<Nl;Gg++){var Bg=Be[Gg];if(Ze[Bg]&Hu){Yl=!0;var Bc=Ze[Bg]&Vl?F:N;if(Bc===bt){Fi=Bc;break}}}if(Yl&&!Fi){Fi=We;for(var io=Ta-1;io>=0;io--){var Kl=Be[io];if(Ze[Kl]&Hu){var xr=Ze[Kl]&Vl?F:N;xr!==bt?Fi=xr:Fi=bt;break}}}if(Fi){if(Ze[Be[Ta]]=Ze[Be[Nl]]=Fi,Fi!==bt){for(var Ei=Ta+1;Ei<Be.length;Ei++)if(!(Ze[Be[Ei]]&g)){f(ye[Be[Ei]])&Q&&(Ze[Be[Ei]]=Fi);break}}if(Fi!==bt){for(var ss=Nl+1;ss<Be.length;ss++)if(!(Ze[Be[ss]]&g)){f(ye[Be[ss]])&Q&&(Ze[Be[ss]]=Fi);break}}}}for(var za=0;za<Be.length;za++)if(Ze[Be[za]]&r){for(var Fl=za,vc=za,Rs=We,ao=za-1;ao>=0;ao--)if(Ze[Be[ao]]&g)Fl=ao;else{Rs=Ze[Be[ao]]&Vl?F:N;break}for(var El=dt,so=za+1;so<Be.length;so++)if(Ze[Be[so]]&(r|g))vc=so;else{El=Ze[Be[so]]&Vl?F:N;break}for(var vg=Fl;vg<=vc;vg++)Ze[Be[vg]]=Rs===El?Rs:bt;za=vc}}}for(var Wa=we.start;Wa<=we.end;Wa++){var vA=Ce[Wa],Ri=Ze[Wa];if(vA&1?Ri&(N|Y|O)&&Ce[Wa]++:Ri&F?Ce[Wa]++:Ri&(O|Y)&&(Ce[Wa]+=2),Ri&g&&(Ce[Wa]=Wa===0?we.level:Ce[Wa-1]),Wa===we.end||f(ye[Wa])&(le|ie))for(var Tl=Wa;Tl>=0&&f(ye[Tl])&u;Tl--)Ce[Tl]=we.level}}return{levels:Ce,paragraphs:Ge};function Xu(pa,os){for(var Qi=pa;Qi<ye.length;Qi++){var ws=Ze[Qi];if(ws&(F|se))return 1;if(ws&(ie|N)||os&&ws===be)return 0;if(ws&s){var Nu=bC(Qi);Qi=Nu===-1?ye.length:Nu}}return 0}function bC(pa){for(var os=1,Qi=pa+1;Qi<ye.length;Qi++){var ws=Ze[Qi];if(ws&ie)break;if(ws&be){if(--os===0)return Qi}else ws&s&&os++}return-1}}var qe="14>1,j>2,t>2,u>2,1a>g,2v3>1,1>1,1ge>1,1wd>1,b>1,1j>1,f>1,ai>3,-2>3,+1,8>1k0,-1jq>1y7,-1y6>1hf,-1he>1h6,-1h5>1ha,-1h8>1qi,-1pu>1,6>3u,-3s>7,6>1,1>1,f>1,1>1,+2,3>1,1>1,+13,4>1,1>1,6>1eo,-1ee>1,3>1mg,-1me>1mk,-1mj>1mi,-1mg>1mi,-1md>1,1>1,+2,1>10k,-103>1,1>1,4>1,5>1,1>1,+10,3>1,1>8,-7>8,+1,-6>7,+1,a>1,1>1,u>1,u6>1,1>1,+5,26>1,1>1,2>1,2>2,8>1,7>1,4>1,1>1,+5,b8>1,1>1,+3,1>3,-2>1,2>1,1>1,+2,c>1,3>1,1>1,+2,h>1,3>1,a>1,1>1,2>1,3>1,1>1,d>1,f>1,3>1,1a>1,1>1,6>1,7>1,13>1,k>1,1>1,+19,4>1,1>1,+2,2>1,1>1,+18,m>1,a>1,1>1,lk>1,1>1,4>1,2>1,f>1,3>1,1>1,+3,db>1,1>1,+3,3>1,1>1,+2,14qm>1,1>1,+1,6>1,4j>1,j>2,t>2,u>2,2>1,+1",ke;function Te(){if(!ke){var ye=v(qe,!0),Je=ye.map,Me=ye.reverseMap;Me.forEach(function(Ze,gt){Je.set(gt,Ze)}),ke=Je}}function ut(ye){return Te(),ke.get(ye)||null}function q(ye,Je,Me,Ze){var gt=ye.length;Me=Math.max(0,Me==null?0:+Me),Ze=Math.min(gt-1,Ze==null?gt-1:+Ze);for(var k=new Map,z=Me;z<=Ze;z++)if(Je[z]&1){var Ce=ut(ye[z]);Ce!==null&&k.set(z,Ce)}return k}function De(ye,Je,Me,Ze){var gt=ye.length;Me=Math.max(0,Me==null?0:+Me),Ze=Math.min(gt-1,Ze==null?gt-1:+Ze);var k=[];return Je.paragraphs.forEach(function(z){var Ce=Math.max(Me,z.start),Ve=Math.min(Ze,z.end);if(Ce<Ve){for(var Ge=Je.levels.slice(Ce,Ve+1),we=Ve;we>=Ce&&f(ye[we])&u;we--)Ge[we]=z.level;for(var et=z.level,lt=1/0,Ct=0;Ct<Ge.length;Ct++){var At=Ge[Ct];At>et&&(et=At),At<lt&&(lt=At|1)}for(var Ne=et;Ne>=lt;Ne--)for(var tt=0;tt<Ge.length;tt++)if(Ge[tt]>=Ne){for(var nt=tt;tt+1<Ge.length&&Ge[tt+1]>=Ne;)tt++;tt>nt&&k.push([nt+Ce,tt+Ce])}}}),k}function Ke(ye,Je,Me,Ze){var gt=Ee(ye,Je,Me,Ze),k=[].concat(ye);return gt.forEach(function(z,Ce){k[Ce]=(Je.levels[z]&1?ut(ye[z]):null)||ye[z]}),k.join("")}function Ee(ye,Je,Me,Ze){for(var gt=De(ye,Je,Me,Ze),k=[],z=0;z<ye.length;z++)k[z]=z;return gt.forEach(function(Ce){for(var Ve=Ce[0],Ge=Ce[1],we=k.slice(Ve,Ge+1),et=we.length;et--;)k[Ge-et]=we[et]}),k}return e.closingToOpeningBracket=M,e.getBidiCharType=f,e.getBidiCharTypeName=p,e.getCanonicalBracket=H,e.getEmbeddingLevels=$e,e.getMirroredCharacter=ut,e.getMirroredCharactersMap=q,e.getReorderSegments=De,e.getReorderedIndices=Ee,e.getReorderedString=Ke,e.openingToClosingBracket=w,Object.defineProperty(e,"__esModule",{value:!0}),e}({});return a}const CH=/\bvoid\s+main\s*\(\s*\)\s*{/g;function g2(a){const e=/^[ \t]*#include +<([\w\d./]+)>/gm;function t(n,i){let s=An[i];return s?g2(s):n}return a.replace(e,t)}const Qa=[];for(let a=0;a<256;a++)Qa[a]=(a<16?"0":"")+a.toString(16);function bD(){const a=Math.random()*4294967295|0,e=Math.random()*4294967295|0,t=Math.random()*4294967295|0,n=Math.random()*4294967295|0;return(Qa[a&255]+Qa[a>>8&255]+Qa[a>>16&255]+Qa[a>>24&255]+"-"+Qa[e&255]+Qa[e>>8&255]+"-"+Qa[e>>16&15|64]+Qa[e>>24&255]+"-"+Qa[t&63|128]+Qa[t>>8&255]+"-"+Qa[t>>16&255]+Qa[t>>24&255]+Qa[n&255]+Qa[n>>8&255]+Qa[n>>16&255]+Qa[n>>24&255]).toUpperCase()}const NI=Object.assign||function(){let a=arguments[0];for(let e=1,t=arguments.length;e<t;e++){let n=arguments[e];if(n)for(let i in n)Object.prototype.hasOwnProperty.call(n,i)&&(a[i]=n[i])}return a},yD=Date.now(),y1=new WeakMap,G1=new Map;let GD=1e10;function c2(a,e){const t=SD(e);let n=y1.get(a);if(n||y1.set(a,n=Object.create(null)),n[t])return new n[t];const i=`_onBeforeCompile${t}`,s=function(u,C){a.onBeforeCompile.call(this,u,C);const h=this.customProgramCacheKey()+"|"+u.vertexShader+"|"+u.fragmentShader;let f=G1[h];if(!f){const p=BD(this,u,e,t);f=G1[h]=p}u.vertexShader=f.vertexShader,u.fragmentShader=f.fragmentShader,NI(u.uniforms,this.uniforms),e.timeUniform&&(u.uniforms[e.timeUniform]={get value(){return Date.now()-yD}}),this[i]&&this[i](u)},o=function(){return r(e.chained?a:a.clone())},r=function(u){const C=Object.create(u,g);return Object.defineProperty(C,"baseMaterial",{value:a}),Object.defineProperty(C,"id",{value:GD++}),C.uuid=bD(),C.uniforms=NI({},u.uniforms,e.uniforms),C.defines=NI({},u.defines,e.defines),C.defines[`TROIKA_DERIVED_MATERIAL_${t}`]="",C.extensions=NI({},u.extensions,e.extensions),C._listeners=void 0,C},g={constructor:{value:o},isDerivedMaterial:{value:!0},type:{get:()=>a.type,set:u=>{a.type=u}},isDerivedFrom:{writable:!0,configurable:!0,value:function(u){const C=this.baseMaterial;return u===C||C.isDerivedMaterial&&C.isDerivedFrom(u)||!1}},customProgramCacheKey:{writable:!0,configurable:!0,value:function(){return a.customProgramCacheKey()+"|"+t}},onBeforeCompile:{get(){return s},set(u){this[i]=u}},copy:{writable:!0,configurable:!0,value:function(u){return a.copy.call(this,u),!a.isShaderMaterial&&!a.isDerivedMaterial&&(NI(this.extensions,u.extensions),NI(this.defines,u.defines),NI(this.uniforms,fy.clone(u.uniforms))),this}},clone:{writable:!0,configurable:!0,value:function(){const u=new a.constructor;return r(u).copy(this)}},getDepthMaterial:{writable:!0,configurable:!0,value:function(){let u=this._depthMaterial;return u||(u=this._depthMaterial=c2(a.isDerivedMaterial?a.getDepthMaterial():new Ey({depthPacking:Q2}),e),u.defines.IS_DEPTH_MATERIAL="",u.uniforms=this.uniforms),u}},getDistanceMaterial:{writable:!0,configurable:!0,value:function(){let u=this._distanceMaterial;return u||(u=this._distanceMaterial=c2(a.isDerivedMaterial?a.getDistanceMaterial():new Ty,e),u.defines.IS_DISTANCE_MATERIAL="",u.uniforms=this.uniforms),u}},dispose:{writable:!0,configurable:!0,value(){const{_depthMaterial:u,_distanceMaterial:C}=this;u&&u.dispose(),C&&C.dispose(),a.dispose.call(this)}}};return n[t]=o,new o}function BD(a,{vertexShader:e,fragmentShader:t},n,i){let{vertexDefs:s,vertexMainIntro:o,vertexMainOutro:r,vertexTransform:g,fragmentDefs:u,fragmentMainIntro:C,fragmentMainOutro:h,fragmentColorTransform:f,customRewriter:p,timeUniform:y}=n;if(s=s||"",o=o||"",r=r||"",u=u||"",C=C||"",h=h||"",(g||p)&&(e=g2(e)),(f||p)&&(t=t.replace(/^[ \t]*#include <((?:tonemapping|encodings|colorspace|fog|premultiplied_alpha|dithering)_fragment)>/gm,`
//!BEGIN_POST_CHUNK $1
$&
//!END_POST_CHUNK
`),t=g2(t)),p){let v=p({vertexShader:e,fragmentShader:t});e=v.vertexShader,t=v.fragmentShader}if(f){let v=[];t=t.replace(/^\/\/!BEGIN_POST_CHUNK[^]+?^\/\/!END_POST_CHUNK/gm,G=>(v.push(G),"")),h=`${f}
${v.join(`
`)}
${h}`}if(y){const v=`
uniform float ${y};
`;s=v+s,u=v+u}return g&&(e=`vec3 troika_position_${i};
vec3 troika_normal_${i};
vec2 troika_uv_${i};
${e}
`,s=`${s}
void troikaVertexTransform${i}(inout vec3 position, inout vec3 normal, inout vec2 uv) {
  ${g}
}
`,o=`
troika_position_${i} = vec3(position);
troika_normal_${i} = vec3(normal);
troika_uv_${i} = vec2(uv);
troikaVertexTransform${i}(troika_position_${i}, troika_normal_${i}, troika_uv_${i});
${o}
`,e=e.replace(/\b(position|normal|uv)\b/g,(v,G,B,R)=>/\battribute\s+vec[23]\s+$/.test(R.substr(0,B))?G:`troika_${G}_${i}`),a.map&&a.map.channel>0||(e=e.replace(/\bMAP_UV\b/g,`troika_uv_${i}`))),e=B1(e,i,s,o,r),t=B1(t,i,u,C,h),{vertexShader:e,fragmentShader:t}}function B1(a,e,t,n,i){return(n||i||t)&&(a=a.replace(CH,`
${t}
void troikaOrigMain${e}() {`),a+=`
void main() {
  ${n}
  troikaOrigMain${e}();
  ${i}
}`),a}function vD(a,e){return a==="uniforms"?void 0:typeof e=="function"?e.toString():e}let ZD=0;const v1=new Map;function SD(a){const e=JSON.stringify(a,vD);let t=v1.get(e);return t==null&&v1.set(e,t=++ZD),t}/*!
Custom build of Typr.ts (https://github.com/fredli74/Typr.ts) for use in Troika text rendering.
Original MIT license applies: https://github.com/fredli74/Typr.ts/blob/master/LICENSE
*/function RD(){return typeof window>"u"&&(self.window=self),function(a){var e={parse:function(i){var s=e._bin,o=new Uint8Array(i);if(s.readASCII(o,0,4)=="ttcf"){var r=4;s.readUshort(o,r),r+=2,s.readUshort(o,r),r+=2;var g=s.readUint(o,r);r+=4;for(var u=[],C=0;C<g;C++){var h=s.readUint(o,r);r+=4,u.push(e._readFont(o,h))}return u}return[e._readFont(o,0)]},_readFont:function(i,s){var o=e._bin,r=s;o.readFixed(i,s),s+=4;var g=o.readUshort(i,s);s+=2,o.readUshort(i,s),s+=2,o.readUshort(i,s),s+=2,o.readUshort(i,s),s+=2;for(var u=["cmap","head","hhea","maxp","hmtx","name","OS/2","post","loca","glyf","kern","CFF ","GDEF","GPOS","GSUB","SVG "],C={_data:i,_offset:r},h={},f=0;f<g;f++){var p=o.readASCII(i,s,4);s+=4,o.readUint(i,s),s+=4;var y=o.readUint(i,s);s+=4;var v=o.readUint(i,s);s+=4,h[p]={offset:y,length:v}}for(f=0;f<u.length;f++){var G=u[f];h[G]&&(C[G.trim()]=e[G.trim()].parse(i,h[G].offset,h[G].length,C))}return C},_tabOffset:function(i,s,o){for(var r=e._bin,g=r.readUshort(i,o+4),u=o+12,C=0;C<g;C++){var h=r.readASCII(i,u,4);u+=4,r.readUint(i,u),u+=4;var f=r.readUint(i,u);if(u+=4,r.readUint(i,u),u+=4,h==s)return f}return 0}};e._bin={readFixed:function(i,s){return(i[s]<<8|i[s+1])+(i[s+2]<<8|i[s+3])/65540},readF2dot14:function(i,s){return e._bin.readShort(i,s)/16384},readInt:function(i,s){return e._bin._view(i).getInt32(s)},readInt8:function(i,s){return e._bin._view(i).getInt8(s)},readShort:function(i,s){return e._bin._view(i).getInt16(s)},readUshort:function(i,s){return e._bin._view(i).getUint16(s)},readUshorts:function(i,s,o){for(var r=[],g=0;g<o;g++)r.push(e._bin.readUshort(i,s+2*g));return r},readUint:function(i,s){return e._bin._view(i).getUint32(s)},readUint64:function(i,s){return 4294967296*e._bin.readUint(i,s)+e._bin.readUint(i,s+4)},readASCII:function(i,s,o){for(var r="",g=0;g<o;g++)r+=String.fromCharCode(i[s+g]);return r},readUnicode:function(i,s,o){for(var r="",g=0;g<o;g++){var u=i[s++]<<8|i[s++];r+=String.fromCharCode(u)}return r},_tdec:typeof window<"u"&&window.TextDecoder?new window.TextDecoder:null,readUTF8:function(i,s,o){var r=e._bin._tdec;return r&&s==0&&o==i.length?r.decode(i):e._bin.readASCII(i,s,o)},readBytes:function(i,s,o){for(var r=[],g=0;g<o;g++)r.push(i[s+g]);return r},readASCIIArray:function(i,s,o){for(var r=[],g=0;g<o;g++)r.push(String.fromCharCode(i[s+g]));return r},_view:function(i){return i._dataView||(i._dataView=i.buffer?new DataView(i.buffer,i.byteOffset,i.byteLength):new DataView(new Uint8Array(i).buffer))}},e._lctf={},e._lctf.parse=function(i,s,o,r,g){var u=e._bin,C={},h=s;u.readFixed(i,s),s+=4;var f=u.readUshort(i,s);s+=2;var p=u.readUshort(i,s);s+=2;var y=u.readUshort(i,s);return s+=2,C.scriptList=e._lctf.readScriptList(i,h+f),C.featureList=e._lctf.readFeatureList(i,h+p),C.lookupList=e._lctf.readLookupList(i,h+y,g),C},e._lctf.readLookupList=function(i,s,o){var r=e._bin,g=s,u=[],C=r.readUshort(i,s);s+=2;for(var h=0;h<C;h++){var f=r.readUshort(i,s);s+=2;var p=e._lctf.readLookupTable(i,g+f,o);u.push(p)}return u},e._lctf.readLookupTable=function(i,s,o){var r=e._bin,g=s,u={tabs:[]};u.ltype=r.readUshort(i,s),s+=2,u.flag=r.readUshort(i,s),s+=2;var C=r.readUshort(i,s);s+=2;for(var h=u.ltype,f=0;f<C;f++){var p=r.readUshort(i,s);s+=2;var y=o(i,h,g+p,u);u.tabs.push(y)}return u},e._lctf.numOfOnes=function(i){for(var s=0,o=0;o<32;o++)(i>>>o&1)!=0&&s++;return s},e._lctf.readClassDef=function(i,s){var o=e._bin,r=[],g=o.readUshort(i,s);if(s+=2,g==1){var u=o.readUshort(i,s);s+=2;var C=o.readUshort(i,s);s+=2;for(var h=0;h<C;h++)r.push(u+h),r.push(u+h),r.push(o.readUshort(i,s)),s+=2}if(g==2){var f=o.readUshort(i,s);for(s+=2,h=0;h<f;h++)r.push(o.readUshort(i,s)),s+=2,r.push(o.readUshort(i,s)),s+=2,r.push(o.readUshort(i,s)),s+=2}return r},e._lctf.getInterval=function(i,s){for(var o=0;o<i.length;o+=3){var r=i[o],g=i[o+1];if(i[o+2],r<=s&&s<=g)return o}return-1},e._lctf.readCoverage=function(i,s){var o=e._bin,r={};r.fmt=o.readUshort(i,s),s+=2;var g=o.readUshort(i,s);return s+=2,r.fmt==1&&(r.tab=o.readUshorts(i,s,g)),r.fmt==2&&(r.tab=o.readUshorts(i,s,3*g)),r},e._lctf.coverageIndex=function(i,s){var o=i.tab;if(i.fmt==1)return o.indexOf(s);if(i.fmt==2){var r=e._lctf.getInterval(o,s);if(r!=-1)return o[r+2]+(s-o[r])}return-1},e._lctf.readFeatureList=function(i,s){var o=e._bin,r=s,g=[],u=o.readUshort(i,s);s+=2;for(var C=0;C<u;C++){var h=o.readASCII(i,s,4);s+=4;var f=o.readUshort(i,s);s+=2;var p=e._lctf.readFeatureTable(i,r+f);p.tag=h.trim(),g.push(p)}return g},e._lctf.readFeatureTable=function(i,s){var o=e._bin,r=s,g={},u=o.readUshort(i,s);s+=2,u>0&&(g.featureParams=r+u);var C=o.readUshort(i,s);s+=2,g.tab=[];for(var h=0;h<C;h++)g.tab.push(o.readUshort(i,s+2*h));return g},e._lctf.readScriptList=function(i,s){var o=e._bin,r=s,g={},u=o.readUshort(i,s);s+=2;for(var C=0;C<u;C++){var h=o.readASCII(i,s,4);s+=4;var f=o.readUshort(i,s);s+=2,g[h.trim()]=e._lctf.readScriptTable(i,r+f)}return g},e._lctf.readScriptTable=function(i,s){var o=e._bin,r=s,g={},u=o.readUshort(i,s);s+=2,u>0&&(g.default=e._lctf.readLangSysTable(i,r+u));var C=o.readUshort(i,s);s+=2;for(var h=0;h<C;h++){var f=o.readASCII(i,s,4);s+=4;var p=o.readUshort(i,s);s+=2,g[f.trim()]=e._lctf.readLangSysTable(i,r+p)}return g},e._lctf.readLangSysTable=function(i,s){var o=e._bin,r={};o.readUshort(i,s),s+=2,r.reqFeature=o.readUshort(i,s),s+=2;var g=o.readUshort(i,s);return s+=2,r.features=o.readUshorts(i,s,g),r},e.CFF={},e.CFF.parse=function(i,s,o){var r=e._bin;(i=new Uint8Array(i.buffer,s,o))[s=0],i[++s],i[++s],i[++s],s++;var g=[];s=e.CFF.readIndex(i,s,g);for(var u=[],C=0;C<g.length-1;C++)u.push(r.readASCII(i,s+g[C],g[C+1]-g[C]));s+=g[g.length-1];var h=[];s=e.CFF.readIndex(i,s,h);var f=[];for(C=0;C<h.length-1;C++)f.push(e.CFF.readDict(i,s+h[C],s+h[C+1]));s+=h[h.length-1];var p=f[0],y=[];s=e.CFF.readIndex(i,s,y);var v=[];for(C=0;C<y.length-1;C++)v.push(r.readASCII(i,s+y[C],y[C+1]-y[C]));if(s+=y[y.length-1],e.CFF.readSubrs(i,s,p),p.CharStrings){s=p.CharStrings,y=[],s=e.CFF.readIndex(i,s,y);var G=[];for(C=0;C<y.length-1;C++)G.push(r.readBytes(i,s+y[C],y[C+1]-y[C]));p.CharStrings=G}if(p.ROS){s=p.FDArray;var B=[];for(s=e.CFF.readIndex(i,s,B),p.FDArray=[],C=0;C<B.length-1;C++){var R=e.CFF.readDict(i,s+B[C],s+B[C+1]);e.CFF._readFDict(i,R,v),p.FDArray.push(R)}s+=B[B.length-1],s=p.FDSelect,p.FDSelect=[];var x=i[s];if(s++,x!=3)throw x;var w=r.readUshort(i,s);for(s+=2,C=0;C<w+1;C++)p.FDSelect.push(r.readUshort(i,s),i[s+2]),s+=3}return p.Encoding&&(p.Encoding=e.CFF.readEncoding(i,p.Encoding,p.CharStrings.length)),p.charset&&(p.charset=e.CFF.readCharset(i,p.charset,p.CharStrings.length)),e.CFF._readFDict(i,p,v),p},e.CFF._readFDict=function(i,s,o){var r;for(var g in s.Private&&(r=s.Private[1],s.Private=e.CFF.readDict(i,r,r+s.Private[0]),s.Private.Subrs&&e.CFF.readSubrs(i,r+s.Private.Subrs,s.Private)),s)["FamilyName","FontName","FullName","Notice","version","Copyright"].indexOf(g)!=-1&&(s[g]=o[s[g]-426+35])},e.CFF.readSubrs=function(i,s,o){var r=e._bin,g=[];s=e.CFF.readIndex(i,s,g);var u,C=g.length;u=C<1240?107:C<33900?1131:32768,o.Bias=u,o.Subrs=[];for(var h=0;h<g.length-1;h++)o.Subrs.push(r.readBytes(i,s+g[h],g[h+1]-g[h]))},e.CFF.tableSE=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,0,111,112,113,114,0,115,116,117,118,119,120,121,122,0,123,0,124,125,126,127,128,129,130,131,0,132,133,0,134,135,136,137,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,138,0,139,0,0,0,0,140,141,142,143,0,0,0,0,0,144,0,0,0,145,0,0,146,147,148,149,0,0,0,0],e.CFF.glyphByUnicode=function(i,s){for(var o=0;o<i.charset.length;o++)if(i.charset[o]==s)return o;return-1},e.CFF.glyphBySE=function(i,s){return s<0||s>255?-1:e.CFF.glyphByUnicode(i,e.CFF.tableSE[s])},e.CFF.readEncoding=function(i,s,o){e._bin;var r=[".notdef"],g=i[s];if(s++,g!=0)throw"error: unknown encoding format: "+g;var u=i[s];s++;for(var C=0;C<u;C++)r.push(i[s+C]);return r},e.CFF.readCharset=function(i,s,o){var r=e._bin,g=[".notdef"],u=i[s];if(s++,u==0)for(var C=0;C<o;C++){var h=r.readUshort(i,s);s+=2,g.push(h)}else{if(u!=1&&u!=2)throw"error: format: "+u;for(;g.length<o;){h=r.readUshort(i,s),s+=2;var f=0;for(u==1?(f=i[s],s++):(f=r.readUshort(i,s),s+=2),C=0;C<=f;C++)g.push(h),h++}}return g},e.CFF.readIndex=function(i,s,o){var r=e._bin,g=r.readUshort(i,s)+1,u=i[s+=2];if(s++,u==1)for(var C=0;C<g;C++)o.push(i[s+C]);else if(u==2)for(C=0;C<g;C++)o.push(r.readUshort(i,s+2*C));else if(u==3)for(C=0;C<g;C++)o.push(16777215&r.readUint(i,s+3*C-1));else if(g!=1)throw"unsupported offset size: "+u+", count: "+g;return(s+=g*u)-1},e.CFF.getCharString=function(i,s,o){var r=e._bin,g=i[s],u=i[s+1];i[s+2],i[s+3],i[s+4];var C=1,h=null,f=null;g<=20&&(h=g,C=1),g==12&&(h=100*g+u,C=2),21<=g&&g<=27&&(h=g,C=1),g==28&&(f=r.readShort(i,s+1),C=3),29<=g&&g<=31&&(h=g,C=1),32<=g&&g<=246&&(f=g-139,C=1),247<=g&&g<=250&&(f=256*(g-247)+u+108,C=2),251<=g&&g<=254&&(f=256*-(g-251)-u-108,C=2),g==255&&(f=r.readInt(i,s+1)/65535,C=5),o.val=f??"o"+h,o.size=C},e.CFF.readCharString=function(i,s,o){for(var r=s+o,g=e._bin,u=[];s<r;){var C=i[s],h=i[s+1];i[s+2],i[s+3],i[s+4];var f=1,p=null,y=null;C<=20&&(p=C,f=1),C==12&&(p=100*C+h,f=2),C!=19&&C!=20||(p=C,f=2),21<=C&&C<=27&&(p=C,f=1),C==28&&(y=g.readShort(i,s+1),f=3),29<=C&&C<=31&&(p=C,f=1),32<=C&&C<=246&&(y=C-139,f=1),247<=C&&C<=250&&(y=256*(C-247)+h+108,f=2),251<=C&&C<=254&&(y=256*-(C-251)-h-108,f=2),C==255&&(y=g.readInt(i,s+1)/65535,f=5),u.push(y??"o"+p),s+=f}return u},e.CFF.readDict=function(i,s,o){for(var r=e._bin,g={},u=[];s<o;){var C=i[s],h=i[s+1];i[s+2],i[s+3],i[s+4];var f=1,p=null,y=null;if(C==28&&(y=r.readShort(i,s+1),f=3),C==29&&(y=r.readInt(i,s+1),f=5),32<=C&&C<=246&&(y=C-139,f=1),247<=C&&C<=250&&(y=256*(C-247)+h+108,f=2),251<=C&&C<=254&&(y=256*-(C-251)-h-108,f=2),C==255)throw y=r.readInt(i,s+1)/65535,f=5,"unknown number";if(C==30){var v=[];for(f=1;;){var G=i[s+f];f++;var B=G>>4,R=15&G;if(B!=15&&v.push(B),R!=15&&v.push(R),R==15)break}for(var x="",w=[0,1,2,3,4,5,6,7,8,9,".","e","e-","reserved","-","endOfNumber"],M=0;M<v.length;M++)x+=w[v[M]];y=parseFloat(x)}C<=21&&(p=["version","Notice","FullName","FamilyName","Weight","FontBBox","BlueValues","OtherBlues","FamilyBlues","FamilyOtherBlues","StdHW","StdVW","escape","UniqueID","XUID","charset","Encoding","CharStrings","Private","Subrs","defaultWidthX","nominalWidthX"][C],f=1,C==12&&(p=["Copyright","isFixedPitch","ItalicAngle","UnderlinePosition","UnderlineThickness","PaintType","CharstringType","FontMatrix","StrokeWidth","BlueScale","BlueShift","BlueFuzz","StemSnapH","StemSnapV","ForceBold",0,0,"LanguageGroup","ExpansionFactor","initialRandomSeed","SyntheticBase","PostScript","BaseFontName","BaseFontBlend",0,0,0,0,0,0,"ROS","CIDFontVersion","CIDFontRevision","CIDFontType","CIDCount","UIDBase","FDArray","FDSelect","FontName"][h],f=2)),p!=null?(g[p]=u.length==1?u[0]:u,u=[]):u.push(y),s+=f}return g},e.cmap={},e.cmap.parse=function(i,s,o){i=new Uint8Array(i.buffer,s,o),s=0;var r=e._bin,g={};r.readUshort(i,s),s+=2;var u=r.readUshort(i,s);s+=2;var C=[];g.tables=[];for(var h=0;h<u;h++){var f=r.readUshort(i,s);s+=2;var p=r.readUshort(i,s);s+=2;var y=r.readUint(i,s);s+=4;var v="p"+f+"e"+p,G=C.indexOf(y);if(G==-1){var B;G=g.tables.length,C.push(y);var R=r.readUshort(i,y);R==0?B=e.cmap.parse0(i,y):R==4?B=e.cmap.parse4(i,y):R==6?B=e.cmap.parse6(i,y):R==12?B=e.cmap.parse12(i,y):console.debug("unknown format: "+R,f,p,y),g.tables.push(B)}if(g[v]!=null)throw"multiple tables for one platform+encoding";g[v]=G}return g},e.cmap.parse0=function(i,s){var o=e._bin,r={};r.format=o.readUshort(i,s),s+=2;var g=o.readUshort(i,s);s+=2,o.readUshort(i,s),s+=2,r.map=[];for(var u=0;u<g-6;u++)r.map.push(i[s+u]);return r},e.cmap.parse4=function(i,s){var o=e._bin,r=s,g={};g.format=o.readUshort(i,s),s+=2;var u=o.readUshort(i,s);s+=2,o.readUshort(i,s),s+=2;var C=o.readUshort(i,s);s+=2;var h=C/2;g.searchRange=o.readUshort(i,s),s+=2,g.entrySelector=o.readUshort(i,s),s+=2,g.rangeShift=o.readUshort(i,s),s+=2,g.endCount=o.readUshorts(i,s,h),s+=2*h,s+=2,g.startCount=o.readUshorts(i,s,h),s+=2*h,g.idDelta=[];for(var f=0;f<h;f++)g.idDelta.push(o.readShort(i,s)),s+=2;for(g.idRangeOffset=o.readUshorts(i,s,h),s+=2*h,g.glyphIdArray=[];s<r+u;)g.glyphIdArray.push(o.readUshort(i,s)),s+=2;return g},e.cmap.parse6=function(i,s){var o=e._bin,r={};r.format=o.readUshort(i,s),s+=2,o.readUshort(i,s),s+=2,o.readUshort(i,s),s+=2,r.firstCode=o.readUshort(i,s),s+=2;var g=o.readUshort(i,s);s+=2,r.glyphIdArray=[];for(var u=0;u<g;u++)r.glyphIdArray.push(o.readUshort(i,s)),s+=2;return r},e.cmap.parse12=function(i,s){var o=e._bin,r={};r.format=o.readUshort(i,s),s+=2,s+=2,o.readUint(i,s),s+=4,o.readUint(i,s),s+=4;var g=o.readUint(i,s);s+=4,r.groups=[];for(var u=0;u<g;u++){var C=s+12*u,h=o.readUint(i,C+0),f=o.readUint(i,C+4),p=o.readUint(i,C+8);r.groups.push([h,f,p])}return r},e.glyf={},e.glyf.parse=function(i,s,o,r){for(var g=[],u=0;u<r.maxp.numGlyphs;u++)g.push(null);return g},e.glyf._parseGlyf=function(i,s){var o=e._bin,r=i._data,g=e._tabOffset(r,"glyf",i._offset)+i.loca[s];if(i.loca[s]==i.loca[s+1])return null;var u={};if(u.noc=o.readShort(r,g),g+=2,u.xMin=o.readShort(r,g),g+=2,u.yMin=o.readShort(r,g),g+=2,u.xMax=o.readShort(r,g),g+=2,u.yMax=o.readShort(r,g),g+=2,u.xMin>=u.xMax||u.yMin>=u.yMax)return null;if(u.noc>0){u.endPts=[];for(var C=0;C<u.noc;C++)u.endPts.push(o.readUshort(r,g)),g+=2;var h=o.readUshort(r,g);if(g+=2,r.length-g<h)return null;u.instructions=o.readBytes(r,g,h),g+=h;var f=u.endPts[u.noc-1]+1;for(u.flags=[],C=0;C<f;C++){var p=r[g];if(g++,u.flags.push(p),(8&p)!=0){var y=r[g];g++;for(var v=0;v<y;v++)u.flags.push(p),C++}}for(u.xs=[],C=0;C<f;C++){var G=(2&u.flags[C])!=0,B=(16&u.flags[C])!=0;G?(u.xs.push(B?r[g]:-r[g]),g++):B?u.xs.push(0):(u.xs.push(o.readShort(r,g)),g+=2)}for(u.ys=[],C=0;C<f;C++)G=(4&u.flags[C])!=0,B=(32&u.flags[C])!=0,G?(u.ys.push(B?r[g]:-r[g]),g++):B?u.ys.push(0):(u.ys.push(o.readShort(r,g)),g+=2);var R=0,x=0;for(C=0;C<f;C++)R+=u.xs[C],x+=u.ys[C],u.xs[C]=R,u.ys[C]=x}else{var w;u.parts=[];do{w=o.readUshort(r,g),g+=2;var M={m:{a:1,b:0,c:0,d:1,tx:0,ty:0},p1:-1,p2:-1};if(u.parts.push(M),M.glyphIndex=o.readUshort(r,g),g+=2,1&w){var H=o.readShort(r,g);g+=2;var N=o.readShort(r,g);g+=2}else H=o.readInt8(r,g),g++,N=o.readInt8(r,g),g++;2&w?(M.m.tx=H,M.m.ty=N):(M.p1=H,M.p2=N),8&w?(M.m.a=M.m.d=o.readF2dot14(r,g),g+=2):64&w?(M.m.a=o.readF2dot14(r,g),g+=2,M.m.d=o.readF2dot14(r,g),g+=2):128&w&&(M.m.a=o.readF2dot14(r,g),g+=2,M.m.b=o.readF2dot14(r,g),g+=2,M.m.c=o.readF2dot14(r,g),g+=2,M.m.d=o.readF2dot14(r,g),g+=2)}while(32&w);if(256&w){var F=o.readUshort(r,g);for(g+=2,u.instr=[],C=0;C<F;C++)u.instr.push(r[g]),g++}}return u},e.GDEF={},e.GDEF.parse=function(i,s,o,r){var g=s;s+=4;var u=e._bin.readUshort(i,s);return{glyphClassDef:u===0?null:e._lctf.readClassDef(i,g+u)}},e.GPOS={},e.GPOS.parse=function(i,s,o,r){return e._lctf.parse(i,s,o,r,e.GPOS.subt)},e.GPOS.subt=function(i,s,o,r){var g=e._bin,u=o,C={};if(C.fmt=g.readUshort(i,o),o+=2,s==1||s==2||s==3||s==7||s==8&&C.fmt<=2){var h=g.readUshort(i,o);o+=2,C.coverage=e._lctf.readCoverage(i,h+u)}if(s==1&&C.fmt==1){var f=g.readUshort(i,o);o+=2,f!=0&&(C.pos=e.GPOS.readValueRecord(i,o,f))}else if(s==2&&C.fmt>=1&&C.fmt<=2){f=g.readUshort(i,o),o+=2;var p=g.readUshort(i,o);o+=2;var y=e._lctf.numOfOnes(f),v=e._lctf.numOfOnes(p);if(C.fmt==1){C.pairsets=[];var G=g.readUshort(i,o);o+=2;for(var B=0;B<G;B++){var R=u+g.readUshort(i,o);o+=2;var x=g.readUshort(i,R);R+=2;for(var w=[],M=0;M<x;M++){var H=g.readUshort(i,R);R+=2,f!=0&&(O=e.GPOS.readValueRecord(i,R,f),R+=2*y),p!=0&&(P=e.GPOS.readValueRecord(i,R,p),R+=2*v),w.push({gid2:H,val1:O,val2:P})}C.pairsets.push(w)}}if(C.fmt==2){var N=g.readUshort(i,o);o+=2;var F=g.readUshort(i,o);o+=2;var Y=g.readUshort(i,o);o+=2;var X=g.readUshort(i,o);for(o+=2,C.classDef1=e._lctf.readClassDef(i,u+N),C.classDef2=e._lctf.readClassDef(i,u+F),C.matrix=[],B=0;B<Y;B++){var U=[];for(M=0;M<X;M++){var O=null,P=null;f!=0&&(O=e.GPOS.readValueRecord(i,o,f),o+=2*y),p!=0&&(P=e.GPOS.readValueRecord(i,o,p),o+=2*v),U.push({val1:O,val2:P})}C.matrix.push(U)}}}else if(s==4&&C.fmt==1)C.markCoverage=e._lctf.readCoverage(i,g.readUshort(i,o)+u),C.baseCoverage=e._lctf.readCoverage(i,g.readUshort(i,o+2)+u),C.markClassCount=g.readUshort(i,o+4),C.markArray=e.GPOS.readMarkArray(i,g.readUshort(i,o+6)+u),C.baseArray=e.GPOS.readBaseArray(i,g.readUshort(i,o+8)+u,C.markClassCount);else if(s==6&&C.fmt==1)C.mark1Coverage=e._lctf.readCoverage(i,g.readUshort(i,o)+u),C.mark2Coverage=e._lctf.readCoverage(i,g.readUshort(i,o+2)+u),C.markClassCount=g.readUshort(i,o+4),C.mark1Array=e.GPOS.readMarkArray(i,g.readUshort(i,o+6)+u),C.mark2Array=e.GPOS.readBaseArray(i,g.readUshort(i,o+8)+u,C.markClassCount);else{if(s==9&&C.fmt==1){var ie=g.readUshort(i,o);o+=2;var le=g.readUint(i,o);if(o+=4,r.ltype==9)r.ltype=ie;else if(r.ltype!=ie)throw"invalid extension substitution";return e.GPOS.subt(i,r.ltype,u+le)}console.debug("unsupported GPOS table LookupType",s,"format",C.fmt)}return C},e.GPOS.readValueRecord=function(i,s,o){var r=e._bin,g=[];return g.push(1&o?r.readShort(i,s):0),s+=1&o?2:0,g.push(2&o?r.readShort(i,s):0),s+=2&o?2:0,g.push(4&o?r.readShort(i,s):0),s+=4&o?2:0,g.push(8&o?r.readShort(i,s):0),s+=8&o?2:0,g},e.GPOS.readBaseArray=function(i,s,o){var r=e._bin,g=[],u=s,C=r.readUshort(i,s);s+=2;for(var h=0;h<C;h++){for(var f=[],p=0;p<o;p++)f.push(e.GPOS.readAnchorRecord(i,u+r.readUshort(i,s))),s+=2;g.push(f)}return g},e.GPOS.readMarkArray=function(i,s){var o=e._bin,r=[],g=s,u=o.readUshort(i,s);s+=2;for(var C=0;C<u;C++){var h=e.GPOS.readAnchorRecord(i,o.readUshort(i,s+2)+g);h.markClass=o.readUshort(i,s),r.push(h),s+=4}return r},e.GPOS.readAnchorRecord=function(i,s){var o=e._bin,r={};return r.fmt=o.readUshort(i,s),r.x=o.readShort(i,s+2),r.y=o.readShort(i,s+4),r},e.GSUB={},e.GSUB.parse=function(i,s,o,r){return e._lctf.parse(i,s,o,r,e.GSUB.subt)},e.GSUB.subt=function(i,s,o,r){var g=e._bin,u=o,C={};if(C.fmt=g.readUshort(i,o),o+=2,s!=1&&s!=2&&s!=4&&s!=5&&s!=6)return null;if(s==1||s==2||s==4||s==5&&C.fmt<=2||s==6&&C.fmt<=2){var h=g.readUshort(i,o);o+=2,C.coverage=e._lctf.readCoverage(i,u+h)}if(s==1&&C.fmt>=1&&C.fmt<=2){if(C.fmt==1)C.delta=g.readShort(i,o),o+=2;else if(C.fmt==2){var f=g.readUshort(i,o);o+=2,C.newg=g.readUshorts(i,o,f),o+=2*C.newg.length}}else if(s==2&&C.fmt==1){f=g.readUshort(i,o),o+=2,C.seqs=[];for(var p=0;p<f;p++){var y=g.readUshort(i,o)+u;o+=2;var v=g.readUshort(i,y);C.seqs.push(g.readUshorts(i,y+2,v))}}else if(s==4)for(C.vals=[],f=g.readUshort(i,o),o+=2,p=0;p<f;p++){var G=g.readUshort(i,o);o+=2,C.vals.push(e.GSUB.readLigatureSet(i,u+G))}else if(s==5&&C.fmt==2){if(C.fmt==2){var B=g.readUshort(i,o);o+=2,C.cDef=e._lctf.readClassDef(i,u+B),C.scset=[];var R=g.readUshort(i,o);for(o+=2,p=0;p<R;p++){var x=g.readUshort(i,o);o+=2,C.scset.push(x==0?null:e.GSUB.readSubClassSet(i,u+x))}}}else if(s==6&&C.fmt==3){if(C.fmt==3){for(p=0;p<3;p++){f=g.readUshort(i,o),o+=2;for(var w=[],M=0;M<f;M++)w.push(e._lctf.readCoverage(i,u+g.readUshort(i,o+2*M)));o+=2*f,p==0&&(C.backCvg=w),p==1&&(C.inptCvg=w),p==2&&(C.ahedCvg=w)}f=g.readUshort(i,o),o+=2,C.lookupRec=e.GSUB.readSubstLookupRecords(i,o,f)}}else{if(s==7&&C.fmt==1){var H=g.readUshort(i,o);o+=2;var N=g.readUint(i,o);if(o+=4,r.ltype==9)r.ltype=H;else if(r.ltype!=H)throw"invalid extension substitution";return e.GSUB.subt(i,r.ltype,u+N)}console.debug("unsupported GSUB table LookupType",s,"format",C.fmt)}return C},e.GSUB.readSubClassSet=function(i,s){var o=e._bin.readUshort,r=s,g=[],u=o(i,s);s+=2;for(var C=0;C<u;C++){var h=o(i,s);s+=2,g.push(e.GSUB.readSubClassRule(i,r+h))}return g},e.GSUB.readSubClassRule=function(i,s){var o=e._bin.readUshort,r={},g=o(i,s),u=o(i,s+=2);s+=2,r.input=[];for(var C=0;C<g-1;C++)r.input.push(o(i,s)),s+=2;return r.substLookupRecords=e.GSUB.readSubstLookupRecords(i,s,u),r},e.GSUB.readSubstLookupRecords=function(i,s,o){for(var r=e._bin.readUshort,g=[],u=0;u<o;u++)g.push(r(i,s),r(i,s+2)),s+=4;return g},e.GSUB.readChainSubClassSet=function(i,s){var o=e._bin,r=s,g=[],u=o.readUshort(i,s);s+=2;for(var C=0;C<u;C++){var h=o.readUshort(i,s);s+=2,g.push(e.GSUB.readChainSubClassRule(i,r+h))}return g},e.GSUB.readChainSubClassRule=function(i,s){for(var o=e._bin,r={},g=["backtrack","input","lookahead"],u=0;u<g.length;u++){var C=o.readUshort(i,s);s+=2,u==1&&C--,r[g[u]]=o.readUshorts(i,s,C),s+=2*r[g[u]].length}return C=o.readUshort(i,s),s+=2,r.subst=o.readUshorts(i,s,2*C),s+=2*r.subst.length,r},e.GSUB.readLigatureSet=function(i,s){var o=e._bin,r=s,g=[],u=o.readUshort(i,s);s+=2;for(var C=0;C<u;C++){var h=o.readUshort(i,s);s+=2,g.push(e.GSUB.readLigature(i,r+h))}return g},e.GSUB.readLigature=function(i,s){var o=e._bin,r={chain:[]};r.nglyph=o.readUshort(i,s),s+=2;var g=o.readUshort(i,s);s+=2;for(var u=0;u<g-1;u++)r.chain.push(o.readUshort(i,s)),s+=2;return r},e.head={},e.head.parse=function(i,s,o){var r=e._bin,g={};return r.readFixed(i,s),s+=4,g.fontRevision=r.readFixed(i,s),s+=4,r.readUint(i,s),s+=4,r.readUint(i,s),s+=4,g.flags=r.readUshort(i,s),s+=2,g.unitsPerEm=r.readUshort(i,s),s+=2,g.created=r.readUint64(i,s),s+=8,g.modified=r.readUint64(i,s),s+=8,g.xMin=r.readShort(i,s),s+=2,g.yMin=r.readShort(i,s),s+=2,g.xMax=r.readShort(i,s),s+=2,g.yMax=r.readShort(i,s),s+=2,g.macStyle=r.readUshort(i,s),s+=2,g.lowestRecPPEM=r.readUshort(i,s),s+=2,g.fontDirectionHint=r.readShort(i,s),s+=2,g.indexToLocFormat=r.readShort(i,s),s+=2,g.glyphDataFormat=r.readShort(i,s),s+=2,g},e.hhea={},e.hhea.parse=function(i,s,o){var r=e._bin,g={};return r.readFixed(i,s),s+=4,g.ascender=r.readShort(i,s),s+=2,g.descender=r.readShort(i,s),s+=2,g.lineGap=r.readShort(i,s),s+=2,g.advanceWidthMax=r.readUshort(i,s),s+=2,g.minLeftSideBearing=r.readShort(i,s),s+=2,g.minRightSideBearing=r.readShort(i,s),s+=2,g.xMaxExtent=r.readShort(i,s),s+=2,g.caretSlopeRise=r.readShort(i,s),s+=2,g.caretSlopeRun=r.readShort(i,s),s+=2,g.caretOffset=r.readShort(i,s),s+=2,s+=8,g.metricDataFormat=r.readShort(i,s),s+=2,g.numberOfHMetrics=r.readUshort(i,s),s+=2,g},e.hmtx={},e.hmtx.parse=function(i,s,o,r){for(var g=e._bin,u={aWidth:[],lsBearing:[]},C=0,h=0,f=0;f<r.maxp.numGlyphs;f++)f<r.hhea.numberOfHMetrics&&(C=g.readUshort(i,s),s+=2,h=g.readShort(i,s),s+=2),u.aWidth.push(C),u.lsBearing.push(h);return u},e.kern={},e.kern.parse=function(i,s,o,r){var g=e._bin,u=g.readUshort(i,s);if(s+=2,u==1)return e.kern.parseV1(i,s-2,o,r);var C=g.readUshort(i,s);s+=2;for(var h={glyph1:[],rval:[]},f=0;f<C;f++){s+=2,o=g.readUshort(i,s),s+=2;var p=g.readUshort(i,s);s+=2;var y=p>>>8;if((y&=15)!=0)throw"unknown kern table format: "+y;s=e.kern.readFormat0(i,s,h)}return h},e.kern.parseV1=function(i,s,o,r){var g=e._bin;g.readFixed(i,s),s+=4;var u=g.readUint(i,s);s+=4;for(var C={glyph1:[],rval:[]},h=0;h<u;h++){g.readUint(i,s),s+=4;var f=g.readUshort(i,s);s+=2,g.readUshort(i,s),s+=2;var p=f>>>8;if((p&=15)!=0)throw"unknown kern table format: "+p;s=e.kern.readFormat0(i,s,C)}return C},e.kern.readFormat0=function(i,s,o){var r=e._bin,g=-1,u=r.readUshort(i,s);s+=2,r.readUshort(i,s),s+=2,r.readUshort(i,s),s+=2,r.readUshort(i,s),s+=2;for(var C=0;C<u;C++){var h=r.readUshort(i,s);s+=2;var f=r.readUshort(i,s);s+=2;var p=r.readShort(i,s);s+=2,h!=g&&(o.glyph1.push(h),o.rval.push({glyph2:[],vals:[]}));var y=o.rval[o.rval.length-1];y.glyph2.push(f),y.vals.push(p),g=h}return s},e.loca={},e.loca.parse=function(i,s,o,r){var g=e._bin,u=[],C=r.head.indexToLocFormat,h=r.maxp.numGlyphs+1;if(C==0)for(var f=0;f<h;f++)u.push(g.readUshort(i,s+(f<<1))<<1);if(C==1)for(f=0;f<h;f++)u.push(g.readUint(i,s+(f<<2)));return u},e.maxp={},e.maxp.parse=function(i,s,o){var r=e._bin,g={},u=r.readUint(i,s);return s+=4,g.numGlyphs=r.readUshort(i,s),s+=2,u==65536&&(g.maxPoints=r.readUshort(i,s),s+=2,g.maxContours=r.readUshort(i,s),s+=2,g.maxCompositePoints=r.readUshort(i,s),s+=2,g.maxCompositeContours=r.readUshort(i,s),s+=2,g.maxZones=r.readUshort(i,s),s+=2,g.maxTwilightPoints=r.readUshort(i,s),s+=2,g.maxStorage=r.readUshort(i,s),s+=2,g.maxFunctionDefs=r.readUshort(i,s),s+=2,g.maxInstructionDefs=r.readUshort(i,s),s+=2,g.maxStackElements=r.readUshort(i,s),s+=2,g.maxSizeOfInstructions=r.readUshort(i,s),s+=2,g.maxComponentElements=r.readUshort(i,s),s+=2,g.maxComponentDepth=r.readUshort(i,s),s+=2),g},e.name={},e.name.parse=function(i,s,o){var r=e._bin,g={};r.readUshort(i,s),s+=2;var u=r.readUshort(i,s);s+=2,r.readUshort(i,s);for(var C,h=["copyright","fontFamily","fontSubfamily","ID","fullName","version","postScriptName","trademark","manufacturer","designer","description","urlVendor","urlDesigner","licence","licenceURL","---","typoFamilyName","typoSubfamilyName","compatibleFull","sampleText","postScriptCID","wwsFamilyName","wwsSubfamilyName","lightPalette","darkPalette"],f=s+=2,p=0;p<u;p++){var y=r.readUshort(i,s);s+=2;var v=r.readUshort(i,s);s+=2;var G=r.readUshort(i,s);s+=2;var B=r.readUshort(i,s);s+=2;var R=r.readUshort(i,s);s+=2;var x=r.readUshort(i,s);s+=2;var w,M=h[B],H=f+12*u+x;if(y==0)w=r.readUnicode(i,H,R/2);else if(y==3&&v==0)w=r.readUnicode(i,H,R/2);else if(v==0)w=r.readASCII(i,H,R);else if(v==1)w=r.readUnicode(i,H,R/2);else if(v==3)w=r.readUnicode(i,H,R/2);else{if(y!=1)throw"unknown encoding "+v+", platformID: "+y;w=r.readASCII(i,H,R),console.debug("reading unknown MAC encoding "+v+" as ASCII")}var N="p"+y+","+G.toString(16);g[N]==null&&(g[N]={}),g[N][M!==void 0?M:B]=w,g[N]._lang=G}for(var F in g)if(g[F].postScriptName!=null&&g[F]._lang==1033)return g[F];for(var F in g)if(g[F].postScriptName!=null&&g[F]._lang==0)return g[F];for(var F in g)if(g[F].postScriptName!=null&&g[F]._lang==3084)return g[F];for(var F in g)if(g[F].postScriptName!=null)return g[F];for(var F in g){C=F;break}return console.debug("returning name table with languageID "+g[C]._lang),g[C]},e["OS/2"]={},e["OS/2"].parse=function(i,s,o){var r=e._bin.readUshort(i,s);s+=2;var g={};if(r==0)e["OS/2"].version0(i,s,g);else if(r==1)e["OS/2"].version1(i,s,g);else if(r==2||r==3||r==4)e["OS/2"].version2(i,s,g);else{if(r!=5)throw"unknown OS/2 table version: "+r;e["OS/2"].version5(i,s,g)}return g},e["OS/2"].version0=function(i,s,o){var r=e._bin;return o.xAvgCharWidth=r.readShort(i,s),s+=2,o.usWeightClass=r.readUshort(i,s),s+=2,o.usWidthClass=r.readUshort(i,s),s+=2,o.fsType=r.readUshort(i,s),s+=2,o.ySubscriptXSize=r.readShort(i,s),s+=2,o.ySubscriptYSize=r.readShort(i,s),s+=2,o.ySubscriptXOffset=r.readShort(i,s),s+=2,o.ySubscriptYOffset=r.readShort(i,s),s+=2,o.ySuperscriptXSize=r.readShort(i,s),s+=2,o.ySuperscriptYSize=r.readShort(i,s),s+=2,o.ySuperscriptXOffset=r.readShort(i,s),s+=2,o.ySuperscriptYOffset=r.readShort(i,s),s+=2,o.yStrikeoutSize=r.readShort(i,s),s+=2,o.yStrikeoutPosition=r.readShort(i,s),s+=2,o.sFamilyClass=r.readShort(i,s),s+=2,o.panose=r.readBytes(i,s,10),s+=10,o.ulUnicodeRange1=r.readUint(i,s),s+=4,o.ulUnicodeRange2=r.readUint(i,s),s+=4,o.ulUnicodeRange3=r.readUint(i,s),s+=4,o.ulUnicodeRange4=r.readUint(i,s),s+=4,o.achVendID=[r.readInt8(i,s),r.readInt8(i,s+1),r.readInt8(i,s+2),r.readInt8(i,s+3)],s+=4,o.fsSelection=r.readUshort(i,s),s+=2,o.usFirstCharIndex=r.readUshort(i,s),s+=2,o.usLastCharIndex=r.readUshort(i,s),s+=2,o.sTypoAscender=r.readShort(i,s),s+=2,o.sTypoDescender=r.readShort(i,s),s+=2,o.sTypoLineGap=r.readShort(i,s),s+=2,o.usWinAscent=r.readUshort(i,s),s+=2,o.usWinDescent=r.readUshort(i,s),s+=2},e["OS/2"].version1=function(i,s,o){var r=e._bin;return s=e["OS/2"].version0(i,s,o),o.ulCodePageRange1=r.readUint(i,s),s+=4,o.ulCodePageRange2=r.readUint(i,s),s+=4},e["OS/2"].version2=function(i,s,o){var r=e._bin;return s=e["OS/2"].version1(i,s,o),o.sxHeight=r.readShort(i,s),s+=2,o.sCapHeight=r.readShort(i,s),s+=2,o.usDefault=r.readUshort(i,s),s+=2,o.usBreak=r.readUshort(i,s),s+=2,o.usMaxContext=r.readUshort(i,s),s+=2},e["OS/2"].version5=function(i,s,o){var r=e._bin;return s=e["OS/2"].version2(i,s,o),o.usLowerOpticalPointSize=r.readUshort(i,s),s+=2,o.usUpperOpticalPointSize=r.readUshort(i,s),s+=2},e.post={},e.post.parse=function(i,s,o){var r=e._bin,g={};return g.version=r.readFixed(i,s),s+=4,g.italicAngle=r.readFixed(i,s),s+=4,g.underlinePosition=r.readShort(i,s),s+=2,g.underlineThickness=r.readShort(i,s),s+=2,g},e==null&&(e={}),e.U==null&&(e.U={}),e.U.codeToGlyph=function(i,s){var o=i.cmap,r=-1;if(o.p0e4!=null?r=o.p0e4:o.p3e1!=null?r=o.p3e1:o.p1e0!=null?r=o.p1e0:o.p0e3!=null&&(r=o.p0e3),r==-1)throw"no familiar platform and encoding!";var g=o.tables[r];if(g.format==0)return s>=g.map.length?0:g.map[s];if(g.format==4){for(var u=-1,C=0;C<g.endCount.length;C++)if(s<=g.endCount[C]){u=C;break}return u==-1||g.startCount[u]>s?0:65535&(g.idRangeOffset[u]!=0?g.glyphIdArray[s-g.startCount[u]+(g.idRangeOffset[u]>>1)-(g.idRangeOffset.length-u)]:s+g.idDelta[u])}if(g.format==12){if(s>g.groups[g.groups.length-1][1])return 0;for(C=0;C<g.groups.length;C++){var h=g.groups[C];if(h[0]<=s&&s<=h[1])return h[2]+(s-h[0])}return 0}throw"unknown cmap table format "+g.format},e.U.glyphToPath=function(i,s){var o={cmds:[],crds:[]};if(i.SVG&&i.SVG.entries[s]){var r=i.SVG.entries[s];return r==null?o:(typeof r=="string"&&(r=e.SVG.toPath(r),i.SVG.entries[s]=r),r)}if(i.CFF){var g={x:0,y:0,stack:[],nStems:0,haveWidth:!1,width:i.CFF.Private?i.CFF.Private.defaultWidthX:0,open:!1},u=i.CFF,C=i.CFF.Private;if(u.ROS){for(var h=0;u.FDSelect[h+2]<=s;)h+=2;C=u.FDArray[u.FDSelect[h+1]].Private}e.U._drawCFF(i.CFF.CharStrings[s],g,u,C,o)}else i.glyf&&e.U._drawGlyf(s,i,o);return o},e.U._drawGlyf=function(i,s,o){var r=s.glyf[i];r==null&&(r=s.glyf[i]=e.glyf._parseGlyf(s,i)),r!=null&&(r.noc>-1?e.U._simpleGlyph(r,o):e.U._compoGlyph(r,s,o))},e.U._simpleGlyph=function(i,s){for(var o=0;o<i.noc;o++){for(var r=o==0?0:i.endPts[o-1]+1,g=i.endPts[o],u=r;u<=g;u++){var C=u==r?g:u-1,h=u==g?r:u+1,f=1&i.flags[u],p=1&i.flags[C],y=1&i.flags[h],v=i.xs[u],G=i.ys[u];if(u==r)if(f){if(!p){e.U.P.moveTo(s,v,G);continue}e.U.P.moveTo(s,i.xs[C],i.ys[C])}else p?e.U.P.moveTo(s,i.xs[C],i.ys[C]):e.U.P.moveTo(s,(i.xs[C]+v)/2,(i.ys[C]+G)/2);f?p&&e.U.P.lineTo(s,v,G):y?e.U.P.qcurveTo(s,v,G,i.xs[h],i.ys[h]):e.U.P.qcurveTo(s,v,G,(v+i.xs[h])/2,(G+i.ys[h])/2)}e.U.P.closePath(s)}},e.U._compoGlyph=function(i,s,o){for(var r=0;r<i.parts.length;r++){var g={cmds:[],crds:[]},u=i.parts[r];e.U._drawGlyf(u.glyphIndex,s,g);for(var C=u.m,h=0;h<g.crds.length;h+=2){var f=g.crds[h],p=g.crds[h+1];o.crds.push(f*C.a+p*C.b+C.tx),o.crds.push(f*C.c+p*C.d+C.ty)}for(h=0;h<g.cmds.length;h++)o.cmds.push(g.cmds[h])}},e.U._getGlyphClass=function(i,s){var o=e._lctf.getInterval(s,i);return o==-1?0:s[o+2]},e.U._applySubs=function(i,s,o,r){for(var g=i.length-s-1,u=0;u<o.tabs.length;u++)if(o.tabs[u]!=null){var C,h=o.tabs[u];if(!h.coverage||(C=e._lctf.coverageIndex(h.coverage,i[s]))!=-1){if(o.ltype==1)i[s],h.fmt==1?i[s]=i[s]+h.delta:i[s]=h.newg[C];else if(o.ltype==4)for(var f=h.vals[C],p=0;p<f.length;p++){var y=f[p],v=y.chain.length;if(!(v>g)){for(var G=!0,B=0,R=0;R<v;R++){for(;i[s+B+(1+R)]==-1;)B++;y.chain[R]!=i[s+B+(1+R)]&&(G=!1)}if(G){for(i[s]=y.nglyph,R=0;R<v+B;R++)i[s+R+1]=-1;break}}}else if(o.ltype==5&&h.fmt==2)for(var x=e._lctf.getInterval(h.cDef,i[s]),w=h.cDef[x+2],M=h.scset[w],H=0;H<M.length;H++){var N=M[H],F=N.input;if(!(F.length>g)){for(G=!0,R=0;R<F.length;R++){var Y=e._lctf.getInterval(h.cDef,i[s+1+R]);if(x==-1&&h.cDef[Y+2]!=F[R]){G=!1;break}}if(G){var X=N.substLookupRecords;for(p=0;p<X.length;p+=2)X[p],X[p+1]}}}else if(o.ltype==6&&h.fmt==3){if(!e.U._glsCovered(i,h.backCvg,s-h.backCvg.length)||!e.U._glsCovered(i,h.inptCvg,s)||!e.U._glsCovered(i,h.ahedCvg,s+h.inptCvg.length))continue;var U=h.lookupRec;for(H=0;H<U.length;H+=2){x=U[H];var O=r[U[H+1]];e.U._applySubs(i,s+x,O,r)}}}}},e.U._glsCovered=function(i,s,o){for(var r=0;r<s.length;r++)if(e._lctf.coverageIndex(s[r],i[o+r])==-1)return!1;return!0},e.U.glyphsToPath=function(i,s,o){for(var r={cmds:[],crds:[]},g=0,u=0;u<s.length;u++){var C=s[u];if(C!=-1){for(var h=u<s.length-1&&s[u+1]!=-1?s[u+1]:0,f=e.U.glyphToPath(i,C),p=0;p<f.crds.length;p+=2)r.crds.push(f.crds[p]+g),r.crds.push(f.crds[p+1]);for(o&&r.cmds.push(o),p=0;p<f.cmds.length;p++)r.cmds.push(f.cmds[p]);o&&r.cmds.push("X"),g+=i.hmtx.aWidth[C],u<s.length-1&&(g+=e.U.getPairAdjustment(i,C,h))}}return r},e.U.P={},e.U.P.moveTo=function(i,s,o){i.cmds.push("M"),i.crds.push(s,o)},e.U.P.lineTo=function(i,s,o){i.cmds.push("L"),i.crds.push(s,o)},e.U.P.curveTo=function(i,s,o,r,g,u,C){i.cmds.push("C"),i.crds.push(s,o,r,g,u,C)},e.U.P.qcurveTo=function(i,s,o,r,g){i.cmds.push("Q"),i.crds.push(s,o,r,g)},e.U.P.closePath=function(i){i.cmds.push("Z")},e.U._drawCFF=function(i,s,o,r,g){for(var u=s.stack,C=s.nStems,h=s.haveWidth,f=s.width,p=s.open,y=0,v=s.x,G=s.y,B=0,R=0,x=0,w=0,M=0,H=0,N=0,F=0,Y=0,X=0,U={val:0,size:0};y<i.length;){e.CFF.getCharString(i,y,U);var O=U.val;if(y+=U.size,O=="o1"||O=="o18")u.length%2!=0&&!h&&(f=u.shift()+r.nominalWidthX),C+=u.length>>1,u.length=0,h=!0;else if(O=="o3"||O=="o23")u.length%2!=0&&!h&&(f=u.shift()+r.nominalWidthX),C+=u.length>>1,u.length=0,h=!0;else if(O=="o4")u.length>1&&!h&&(f=u.shift()+r.nominalWidthX,h=!0),p&&e.U.P.closePath(g),G+=u.pop(),e.U.P.moveTo(g,v,G),p=!0;else if(O=="o5")for(;u.length>0;)v+=u.shift(),G+=u.shift(),e.U.P.lineTo(g,v,G);else if(O=="o6"||O=="o7")for(var P=u.length,ie=O=="o6",le=0;le<P;le++){var T=u.shift();ie?v+=T:G+=T,ie=!ie,e.U.P.lineTo(g,v,G)}else if(O=="o8"||O=="o24"){P=u.length;for(var J=0;J+6<=P;)B=v+u.shift(),R=G+u.shift(),x=B+u.shift(),w=R+u.shift(),v=x+u.shift(),G=w+u.shift(),e.U.P.curveTo(g,B,R,x,w,v,G),J+=6;O=="o24"&&(v+=u.shift(),G+=u.shift(),e.U.P.lineTo(g,v,G))}else{if(O=="o11")break;if(O=="o1234"||O=="o1235"||O=="o1236"||O=="o1237")O=="o1234"&&(R=G,x=(B=v+u.shift())+u.shift(),X=w=R+u.shift(),H=w,F=G,v=(N=(M=(Y=x+u.shift())+u.shift())+u.shift())+u.shift(),e.U.P.curveTo(g,B,R,x,w,Y,X),e.U.P.curveTo(g,M,H,N,F,v,G)),O=="o1235"&&(B=v+u.shift(),R=G+u.shift(),x=B+u.shift(),w=R+u.shift(),Y=x+u.shift(),X=w+u.shift(),M=Y+u.shift(),H=X+u.shift(),N=M+u.shift(),F=H+u.shift(),v=N+u.shift(),G=F+u.shift(),u.shift(),e.U.P.curveTo(g,B,R,x,w,Y,X),e.U.P.curveTo(g,M,H,N,F,v,G)),O=="o1236"&&(B=v+u.shift(),R=G+u.shift(),x=B+u.shift(),X=w=R+u.shift(),H=w,N=(M=(Y=x+u.shift())+u.shift())+u.shift(),F=H+u.shift(),v=N+u.shift(),e.U.P.curveTo(g,B,R,x,w,Y,X),e.U.P.curveTo(g,M,H,N,F,v,G)),O=="o1237"&&(B=v+u.shift(),R=G+u.shift(),x=B+u.shift(),w=R+u.shift(),Y=x+u.shift(),X=w+u.shift(),M=Y+u.shift(),H=X+u.shift(),N=M+u.shift(),F=H+u.shift(),Math.abs(N-v)>Math.abs(F-G)?v=N+u.shift():G=F+u.shift(),e.U.P.curveTo(g,B,R,x,w,Y,X),e.U.P.curveTo(g,M,H,N,F,v,G));else if(O=="o14"){if(u.length>0&&!h&&(f=u.shift()+o.nominalWidthX,h=!0),u.length==4){var Q=u.shift(),se=u.shift(),L=u.shift(),D=u.shift(),ne=e.CFF.glyphBySE(o,L),oe=e.CFF.glyphBySE(o,D);e.U._drawCFF(o.CharStrings[ne],s,o,r,g),s.x=Q,s.y=se,e.U._drawCFF(o.CharStrings[oe],s,o,r,g)}p&&(e.U.P.closePath(g),p=!1)}else if(O=="o19"||O=="o20")u.length%2!=0&&!h&&(f=u.shift()+r.nominalWidthX),C+=u.length>>1,u.length=0,h=!0,y+=C+7>>3;else if(O=="o21")u.length>2&&!h&&(f=u.shift()+r.nominalWidthX,h=!0),G+=u.pop(),v+=u.pop(),p&&e.U.P.closePath(g),e.U.P.moveTo(g,v,G),p=!0;else if(O=="o22")u.length>1&&!h&&(f=u.shift()+r.nominalWidthX,h=!0),v+=u.pop(),p&&e.U.P.closePath(g),e.U.P.moveTo(g,v,G),p=!0;else if(O=="o25"){for(;u.length>6;)v+=u.shift(),G+=u.shift(),e.U.P.lineTo(g,v,G);B=v+u.shift(),R=G+u.shift(),x=B+u.shift(),w=R+u.shift(),v=x+u.shift(),G=w+u.shift(),e.U.P.curveTo(g,B,R,x,w,v,G)}else if(O=="o26")for(u.length%2&&(v+=u.shift());u.length>0;)B=v,R=G+u.shift(),v=x=B+u.shift(),G=(w=R+u.shift())+u.shift(),e.U.P.curveTo(g,B,R,x,w,v,G);else if(O=="o27")for(u.length%2&&(G+=u.shift());u.length>0;)R=G,x=(B=v+u.shift())+u.shift(),w=R+u.shift(),v=x+u.shift(),G=w,e.U.P.curveTo(g,B,R,x,w,v,G);else if(O=="o10"||O=="o29"){var j=O=="o10"?r:o;if(u.length==0)console.debug("error: empty stack");else{var re=u.pop(),pe=j.Subrs[re+j.Bias];s.x=v,s.y=G,s.nStems=C,s.haveWidth=h,s.width=f,s.open=p,e.U._drawCFF(pe,s,o,r,g),v=s.x,G=s.y,C=s.nStems,h=s.haveWidth,f=s.width,p=s.open}}else if(O=="o30"||O=="o31"){var me=u.length,be=(J=0,O=="o31");for(J+=me-(P=-3&me);J<P;)be?(R=G,x=(B=v+u.shift())+u.shift(),G=(w=R+u.shift())+u.shift(),P-J==5?(v=x+u.shift(),J++):v=x,be=!1):(B=v,R=G+u.shift(),x=B+u.shift(),w=R+u.shift(),v=x+u.shift(),P-J==5?(G=w+u.shift(),J++):G=w,be=!0),e.U.P.curveTo(g,B,R,x,w,v,G),J+=4}else{if((O+"").charAt(0)=="o")throw console.debug("Unknown operation: "+O,i),O;u.push(O)}}}s.x=v,s.y=G,s.nStems=C,s.haveWidth=h,s.width=f,s.open=p};var t=e,n={Typr:t};return a.Typr=t,a.default=n,Object.defineProperty(a,"__esModule",{value:!0}),a}({}).Typr}/*!
Custom bundle of woff2otf (https://github.com/arty-name/woff2otf) with fflate
(https://github.com/101arrowz/fflate) for use in Troika text rendering. 
Original licenses apply: 
- fflate: https://github.com/101arrowz/fflate/blob/master/LICENSE (MIT)
- woff2otf.js: https://github.com/arty-name/woff2otf/blob/master/woff2otf.js (Apache2)
*/function wD(){return function(a){var e=Uint8Array,t=Uint16Array,n=Uint32Array,i=new e([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),s=new e([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),o=new e([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),r=function(O,P){for(var ie=new t(31),le=0;le<31;++le)ie[le]=P+=1<<O[le-1];var T=new n(ie[30]);for(le=1;le<30;++le)for(var J=ie[le];J<ie[le+1];++J)T[J]=J-ie[le]<<5|le;return[ie,T]},g=r(i,2),u=g[0],C=g[1];u[28]=258,C[258]=28;for(var h=r(s,0)[0],f=new t(32768),p=0;p<32768;++p){var y=(43690&p)>>>1|(21845&p)<<1;y=(61680&(y=(52428&y)>>>2|(13107&y)<<2))>>>4|(3855&y)<<4,f[p]=((65280&y)>>>8|(255&y)<<8)>>>1}var v=function(O,P,ie){for(var le=O.length,T=0,J=new t(P);T<le;++T)++J[O[T]-1];var Q,se=new t(P);for(T=0;T<P;++T)se[T]=se[T-1]+J[T-1]<<1;{Q=new t(1<<P);var L=15-P;for(T=0;T<le;++T)if(O[T])for(var D=T<<4|O[T],ne=P-O[T],oe=se[O[T]-1]++<<ne,j=oe|(1<<ne)-1;oe<=j;++oe)Q[f[oe]>>>L]=D}return Q},G=new e(288);for(p=0;p<144;++p)G[p]=8;for(p=144;p<256;++p)G[p]=9;for(p=256;p<280;++p)G[p]=7;for(p=280;p<288;++p)G[p]=8;var B=new e(32);for(p=0;p<32;++p)B[p]=5;var R=v(G,9),x=v(B,5),w=function(O){for(var P=O[0],ie=1;ie<O.length;++ie)O[ie]>P&&(P=O[ie]);return P},M=function(O,P,ie){var le=P/8|0;return(O[le]|O[le+1]<<8)>>(7&P)&ie},H=function(O,P){var ie=P/8|0;return(O[ie]|O[ie+1]<<8|O[ie+2]<<16)>>(7&P)},N=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],F=function(O,P,ie){var le=new Error(P||N[O]);if(le.code=O,Error.captureStackTrace&&Error.captureStackTrace(le,F),!ie)throw le;return le},Y=function(O,P,ie){var le=O.length;if(!le||ie&&!ie.l&&le<5)return P||new e(0);var T=!P||ie,J=!ie||ie.i;ie||(ie={}),P||(P=new e(3*le));var Q,se=function(nt){var ue=P.length;if(nt>ue){var xe=new e(Math.max(2*ue,nt));xe.set(P),P=xe}},L=ie.f||0,D=ie.p||0,ne=ie.b||0,oe=ie.l,j=ie.d,re=ie.m,pe=ie.n,me=8*le;do{if(!oe){ie.f=L=M(O,D,1);var be=M(O,D+1,3);if(D+=3,!be){var $e=O[(Me=((Q=D)/8|0)+(7&Q&&1)+4)-4]|O[Me-3]<<8,qe=Me+$e;if(qe>le){J&&F(0);break}T&&se(ne+$e),P.set(O.subarray(Me,qe),ne),ie.b=ne+=$e,ie.p=D=8*qe;continue}if(be==1)oe=R,j=x,re=9,pe=5;else if(be==2){var ke=M(O,D,31)+257,Te=M(O,D+10,15)+4,ut=ke+M(O,D+5,31)+1;D+=14;for(var q=new e(ut),De=new e(19),Ke=0;Ke<Te;++Ke)De[o[Ke]]=M(O,D+3*Ke,7);D+=3*Te;var Ee=w(De),ye=(1<<Ee)-1,Je=v(De,Ee);for(Ke=0;Ke<ut;){var Me,Ze=Je[M(O,D,ye)];if(D+=15&Ze,(Me=Ze>>>4)<16)q[Ke++]=Me;else{var gt=0,k=0;for(Me==16?(k=3+M(O,D,3),D+=2,gt=q[Ke-1]):Me==17?(k=3+M(O,D,7),D+=3):Me==18&&(k=11+M(O,D,127),D+=7);k--;)q[Ke++]=gt}}var z=q.subarray(0,ke),Ce=q.subarray(ke);re=w(z),pe=w(Ce),oe=v(z,re),j=v(Ce,pe)}else F(1);if(D>me){J&&F(0);break}}T&&se(ne+131072);for(var Ve=(1<<re)-1,Ge=(1<<pe)-1,we=D;;we=D){var et=(gt=oe[H(O,D)&Ve])>>>4;if((D+=15&gt)>me){J&&F(0);break}if(gt||F(2),et<256)P[ne++]=et;else{if(et==256){we=D,oe=null;break}var lt=et-254;if(et>264){var Ct=i[Ke=et-257];lt=M(O,D,(1<<Ct)-1)+u[Ke],D+=Ct}var At=j[H(O,D)&Ge],Ne=At>>>4;if(At||F(3),D+=15&At,Ce=h[Ne],Ne>3&&(Ct=s[Ne],Ce+=H(O,D)&(1<<Ct)-1,D+=Ct),D>me){J&&F(0);break}T&&se(ne+131072);for(var tt=ne+lt;ne<tt;ne+=4)P[ne]=P[ne-Ce],P[ne+1]=P[ne+1-Ce],P[ne+2]=P[ne+2-Ce],P[ne+3]=P[ne+3-Ce];ne=tt}}ie.l=oe,ie.p=we,ie.b=ne,oe&&(L=1,ie.m=re,ie.d=j,ie.n=pe)}while(!L);return ne==P.length?P:function(nt,ue,xe){(xe==null||xe>nt.length)&&(xe=nt.length);var ct=new(nt instanceof t?t:nt instanceof n?n:e)(xe-ue);return ct.set(nt.subarray(ue,xe)),ct}(P,0,ne)},X=new e(0),U=typeof TextDecoder<"u"&&new TextDecoder;try{U.decode(X,{stream:!0})}catch{}return a.convert_streams=function(O){var P=new DataView(O),ie=0;function le(){var ke=P.getUint16(ie);return ie+=2,ke}function T(){var ke=P.getUint32(ie);return ie+=4,ke}function J(ke){$e.setUint16(qe,ke),qe+=2}function Q(ke){$e.setUint32(qe,ke),qe+=4}for(var se={signature:T(),flavor:T(),length:T(),numTables:le(),reserved:le(),totalSfntSize:T(),majorVersion:le(),minorVersion:le(),metaOffset:T(),metaLength:T(),metaOrigLength:T(),privOffset:T(),privLength:T()},L=0;Math.pow(2,L)<=se.numTables;)L++;L--;for(var D=16*Math.pow(2,L),ne=16*se.numTables-D,oe=12,j=[],re=0;re<se.numTables;re++)j.push({tag:T(),offset:T(),compLength:T(),origLength:T(),origChecksum:T()}),oe+=16;var pe,me=new Uint8Array(12+16*j.length+j.reduce(function(ke,Te){return ke+Te.origLength+4},0)),be=me.buffer,$e=new DataView(be),qe=0;return Q(se.flavor),J(se.numTables),J(D),J(L),J(ne),j.forEach(function(ke){Q(ke.tag),Q(ke.origChecksum),Q(oe),Q(ke.origLength),ke.outOffset=oe,(oe+=ke.origLength)%4!=0&&(oe+=4-oe%4)}),j.forEach(function(ke){var Te,ut=O.slice(ke.offset,ke.offset+ke.compLength);if(ke.compLength!=ke.origLength){var q=new Uint8Array(ke.origLength);Te=new Uint8Array(ut,2),Y(Te,q)}else q=new Uint8Array(ut);me.set(q,ke.outOffset);var De=0;(oe=ke.outOffset+ke.origLength)%4!=0&&(De=4-oe%4),me.set(new Uint8Array(De).buffer,ke.outOffset+ke.origLength),pe=oe+De}),be.slice(0,pe)},Object.defineProperty(a,"__esModule",{value:!0}),a}({}).convert_streams}function xD(a,e){const t={M:2,L:2,Q:4,C:6,Z:0},n={C:"18g,ca,368,1kz",D:"17k,6,2,2+4,5+c,2+6,2+1,10+1,9+f,j+11,2+1,a,2,2+1,15+2,3,j+2,6+3,2+8,2,2,2+1,w+a,4+e,3+3,2,3+2,3+5,23+w,2f+4,3,2+9,2,b,2+3,3,1k+9,6+1,3+1,2+2,2+d,30g,p+y,1,1+1g,f+x,2,sd2+1d,jf3+4,f+3,2+4,2+2,b+3,42,2,4+2,2+1,2,3,t+1,9f+w,2,el+2,2+g,d+2,2l,2+1,5,3+1,2+1,2,3,6,16wm+1v",R:"17m+3,2,2,6+3,m,15+2,2+2,h+h,13,3+8,2,2,3+1,2,p+1,x,5+4,5,a,2,2,3,u,c+2,g+1,5,2+1,4+1,5j,6+1,2,b,2+2,f,2+1,1s+2,2,3+1,7,1ez0,2,2+1,4+4,b,4,3,b,42,2+2,4,3,2+1,2,o+3,ae,ep,x,2o+2,3+1,3,5+1,6",L:"x9u,jff,a,fd,jv",T:"4t,gj+33,7o+4,1+1,7c+18,2,2+1,2+1,2,21+a,2,1b+k,h,2u+6,3+5,3+1,2+3,y,2,v+q,2k+a,1n+8,a,p+3,2+8,2+2,2+4,18+2,3c+e,2+v,1k,2,5+7,5,4+6,b+1,u,1n,5+3,9,l+1,r,3+1,1m,5+1,5+1,3+2,4,v+1,4,c+1,1m,5+4,2+1,5,l+1,n+5,2,1n,3,2+3,9,8+1,c+1,v,1q,d,1f,4,1m+2,6+2,2+3,8+1,c+1,u,1n,3,7,6+1,l+1,t+1,1m+1,5+3,9,l+1,u,21,8+2,2,2j,3+6,d+7,2r,3+8,c+5,23+1,s,2,2,1k+d,2+4,2+1,6+a,2+z,a,2v+3,2+5,2+1,3+1,q+1,5+2,h+3,e,3+1,7,g,jk+2,qb+2,u+2,u+1,v+1,1t+1,2+6,9,3+a,a,1a+2,3c+1,z,3b+2,5+1,a,7+2,64+1,3,1n,2+6,2,2,3+7,7+9,3,1d+d,1,1+1,1s+3,1d,2+4,2,6,15+8,d+1,x+3,3+1,2+2,1l,2+1,4,2+2,1n+7,3+1,49+2,2+c,2+6,5,7,4+1,5j+1l,2+4,ek,3+1,r+4,1e+4,6+5,2p+c,1+3,1,1+2,1+b,2db+2,3y,2p+v,ff+3,30+1,n9x,1+2,2+9,x+1,29+1,7l,4,5,q+1,6,48+1,r+h,e,13+7,q+a,1b+2,1d,3+3,3+1,14,1w+5,3+1,3+1,d,9,1c,1g,2+2,3+1,6+1,2,17+1,9,6n,3,5,fn5,ki+f,h+f,5s,6y+2,ea,6b,46+4,1af+2,2+1,6+3,15+2,5,4m+1,fy+3,as+1,4a+a,4x,1j+e,1l+2,1e+3,3+1,1y+2,11+4,2+7,1r,d+1,1h+8,b+3,3,2o+2,3,2+1,7,4h,4+7,m+1,1m+1,4,12+6,4+4,5g+7,3+2,2,o,2d+5,2,5+1,2+1,6n+3,7+1,2+1,s+1,2e+7,3,2+1,2z,2,3+5,2,2u+2,3+3,2+4,78+8,2+1,75+1,2,5,41+3,3+1,5,x+9,15+5,3+3,9,a+5,3+2,1b+c,2+1,bb+6,2+5,2,2b+l,3+6,2+1,2+1,3f+5,4,2+1,2+6,2,21+1,4,2,9o+1,470+8,at4+4,1o+6,t5,1s+3,2a,f5l+1,2+3,43o+2,a+7,1+7,3+6,v+3,45+2,1j0+1i,5+1d,9,f,n+4,2+e,11t+6,2+g,3+6,2+1,2+4,7a+6,c6+3,15t+6,32+6,1,gzau,v+2n,3l+6n"},i=1,s=2,o=4,r=8,g=16,u=32;let C;function h(N){if(!C){const F={R:s,L:i,D:o,C:g,U:u,T:r};C=new Map;for(let Y in n){let X=0;n[Y].split(",").forEach(U=>{let[O,P]=U.split("+");O=parseInt(O,36),P=P?parseInt(P,36):0,C.set(X+=O,F[Y]);for(let ie=P;ie--;)C.set(++X,F[Y])})}}return C.get(N)||u}const f=1,p=2,y=3,v=4,G=[null,"isol","init","fina","medi"];function B(N){const F=new Uint8Array(N.length);let Y=u,X=f,U=-1;for(let O=0;O<N.length;O++){const P=N.codePointAt(O);let ie=h(P)|0,le=f;ie&r||(Y&(i|o|g)?ie&(s|o|g)?(le=y,(X===f||X===y)&&F[U]++):ie&(i|u)&&(X===p||X===v)&&F[U]--:Y&(s|u)&&(X===p||X===v)&&F[U]--,X=F[O]=le,Y=ie,U=O,P>65535&&O++)}return F}function R(N,F){const Y=[];for(let U=0;U<F.length;U++){const O=F.codePointAt(U);O>65535&&U++,Y.push(a.U.codeToGlyph(N,O))}const X=N.GSUB;if(X){const{lookupList:U,featureList:O}=X;let P;const ie=/^(rlig|liga|mset|isol|init|fina|medi|half|pres|blws|ccmp)$/,le=[];O.forEach(T=>{if(ie.test(T.tag))for(let J=0;J<T.tab.length;J++){if(le[T.tab[J]])continue;le[T.tab[J]]=!0;const Q=U[T.tab[J]],se=/^(isol|init|fina|medi)$/.test(T.tag);se&&!P&&(P=B(F));for(let L=0;L<Y.length;L++)(!P||!se||G[P[L]]===T.tag)&&a.U._applySubs(Y,L,Q,U)}})}return Y}function x(N,F){const Y=new Int16Array(F.length*3);let X=0;for(;X<F.length;X++){const ie=F[X];if(ie===-1)continue;Y[X*3+2]=N.hmtx.aWidth[ie];const le=N.GPOS;if(le){const T=le.lookupList;for(let J=0;J<T.length;J++){const Q=T[J];for(let se=0;se<Q.tabs.length;se++){const L=Q.tabs[se];if(Q.ltype===1){if(a._lctf.coverageIndex(L.coverage,ie)!==-1&&L.pos){P(L.pos,X);break}}else if(Q.ltype===2){let D=null,ne=U();if(ne!==-1){const oe=a._lctf.coverageIndex(L.coverage,F[ne]);if(oe!==-1){if(L.fmt===1){const j=L.pairsets[oe];for(let re=0;re<j.length;re++)j[re].gid2===ie&&(D=j[re])}else if(L.fmt===2){const j=a.U._getGlyphClass(F[ne],L.classDef1),re=a.U._getGlyphClass(ie,L.classDef2);D=L.matrix[j][re]}if(D){D.val1&&P(D.val1,ne),D.val2&&P(D.val2,X);break}}}}else if(Q.ltype===4){const D=a._lctf.coverageIndex(L.markCoverage,ie);if(D!==-1){const ne=U(O),oe=ne===-1?-1:a._lctf.coverageIndex(L.baseCoverage,F[ne]);if(oe!==-1){const j=L.markArray[D],re=L.baseArray[oe][j.markClass];Y[X*3]=re.x-j.x+Y[ne*3]-Y[ne*3+2],Y[X*3+1]=re.y-j.y+Y[ne*3+1];break}}}else if(Q.ltype===6){const D=a._lctf.coverageIndex(L.mark1Coverage,ie);if(D!==-1){const ne=U();if(ne!==-1){const oe=F[ne];if(w(N,oe)===3){const j=a._lctf.coverageIndex(L.mark2Coverage,oe);if(j!==-1){const re=L.mark1Array[D],pe=L.mark2Array[j][re.markClass];Y[X*3]=pe.x-re.x+Y[ne*3]-Y[ne*3+2],Y[X*3+1]=pe.y-re.y+Y[ne*3+1];break}}}}}}}}else if(N.kern&&!N.cff){const T=U();if(T!==-1){const J=N.kern.glyph1.indexOf(F[T]);if(J!==-1){const Q=N.kern.rval[J].glyph2.indexOf(ie);Q!==-1&&(Y[T*3+2]+=N.kern.rval[J].vals[Q])}}}}return Y;function U(ie){for(let le=X-1;le>=0;le--)if(F[le]!==-1&&(!ie||ie(F[le])))return le;return-1}function O(ie){return w(N,ie)===1}function P(ie,le){for(let T=0;T<3;T++)Y[le*3+T]+=ie[T]||0}}function w(N,F){const Y=N.GDEF&&N.GDEF.glyphClassDef;return Y?a.U._getGlyphClass(F,Y):0}function M(...N){for(let F=0;F<N.length;F++)if(typeof N[F]=="number")return N[F]}function H(N){const F=Object.create(null),Y=N["OS/2"],X=N.hhea,U=N.head.unitsPerEm,O=M(Y&&Y.sTypoAscender,X&&X.ascender,U),P={unitsPerEm:U,ascender:O,descender:M(Y&&Y.sTypoDescender,X&&X.descender,0),capHeight:M(Y&&Y.sCapHeight,O),xHeight:M(Y&&Y.sxHeight,O),lineGap:M(Y&&Y.sTypoLineGap,X&&X.lineGap),supportsCodePoint(ie){return a.U.codeToGlyph(N,ie)>0},forEachGlyph(ie,le,T,J){let Q=0;const se=1/P.unitsPerEm*le,L=R(N,ie);let D=0;const ne=x(N,L);return L.forEach((oe,j)=>{if(oe!==-1){let re=F[oe];if(!re){const{cmds:pe,crds:me}=a.U.glyphToPath(N,oe);let be="",$e=0;for(let q=0,De=pe.length;q<De;q++){const Ke=t[pe[q]];be+=pe[q];for(let Ee=1;Ee<=Ke;Ee++)be+=(Ee>1?",":"")+me[$e++]}let qe,ke,Te,ut;if(me.length){qe=ke=1/0,Te=ut=-1/0;for(let q=0,De=me.length;q<De;q+=2){let Ke=me[q],Ee=me[q+1];Ke<qe&&(qe=Ke),Ee<ke&&(ke=Ee),Ke>Te&&(Te=Ke),Ee>ut&&(ut=Ee)}}else qe=Te=ke=ut=0;re=F[oe]={index:oe,advanceWidth:N.hmtx.aWidth[oe],xMin:qe,yMin:ke,xMax:Te,yMax:ut,path:be}}J.call(null,re,Q+ne[j*3]*se,ne[j*3+1]*se,D),Q+=ne[j*3+2]*se,T&&(Q+=T*le)}D+=ie.codePointAt(D)>65535?2:1}),Q}};return P}return function(F){const Y=new Uint8Array(F,0,4),X=a._bin.readASCII(Y,0,4);if(X==="wOFF")F=e(F);else if(X==="wOF2")throw new Error("woff2 fonts not supported");return H(a.parse(F)[0])}}const WD=fA({name:"Typr Font Parser",dependencies:[RD,wD,xD],init(a,e,t){const n=a(),i=e();return t(n,i)}});/*!
Custom bundle of @unicode-font-resolver/client v1.0.2 (https://github.com/lojjic/unicode-font-resolver)
for use in Troika text rendering. 
Original MIT license applies
*/function VD(){return function(a){var e=function(){this.buckets=new Map};e.prototype.add=function(x){var w=x>>5;this.buckets.set(w,(this.buckets.get(w)||0)|1<<(31&x))},e.prototype.has=function(x){var w=this.buckets.get(x>>5);return w!==void 0&&(w&1<<(31&x))!=0},e.prototype.serialize=function(){var x=[];return this.buckets.forEach(function(w,M){x.push((+M).toString(36)+":"+w.toString(36))}),x.join(",")},e.prototype.deserialize=function(x){var w=this;this.buckets.clear(),x.split(",").forEach(function(M){var H=M.split(":");w.buckets.set(parseInt(H[0],36),parseInt(H[1],36))})};var t=Math.pow(2,8),n=t-1,i=~n;function s(x){var w=function(H){return H&i}(x).toString(16),M=function(H){return(H&i)+t-1}(x).toString(16);return"codepoint-index/plane"+(x>>16)+"/"+w+"-"+M+".json"}function o(x,w){var M=x&n,H=w.codePointAt(M/6|0);return((H=(H||48)-48)&1<<M%6)!=0}function r(x,w){var M;(M=x,M.replace(/U\+/gi,"").replace(/^,+|,+$/g,"").split(/,+/).map(function(H){return H.split("-").map(function(N){return parseInt(N.trim(),16)})})).forEach(function(H){var N=H[0],F=H[1];F===void 0&&(F=N),w(N,F)})}function g(x,w){r(x,function(M,H){for(var N=M;N<=H;N++)w(N)})}var u={},C={},h=new WeakMap,f="https://cdn.jsdelivr.net/gh/lojjic/unicode-font-resolver@v1.0.1/packages/data";function p(x){var w=h.get(x);return w||(w=new e,g(x.ranges,function(M){return w.add(M)}),h.set(x,w)),w}var y,v=new Map;function G(x,w,M){return x[w]?w:x[M]?M:function(H){for(var N in H)return N}(x)}function B(x,w){var M=w;if(!x.includes(M)){M=1/0;for(var H=0;H<x.length;H++)Math.abs(x[H]-w)<Math.abs(M-w)&&(M=x[H])}return M}function R(x){return y||(y=new Set,g("9-D,20,85,A0,1680,2000-200A,2028-202F,205F,3000",function(w){y.add(w)})),y.has(x)}return a.CodePointSet=e,a.clearCache=function(){u={},C={}},a.getFontsForString=function(x,w){w===void 0&&(w={});var M,H=w.lang;H===void 0&&(H=new RegExp("\\p{Script=Hangul}","u").test(M=x)?"ko":new RegExp("\\p{Script=Hiragana}|\\p{Script=Katakana}","u").test(M)?"ja":"en");var N=w.category;N===void 0&&(N="sans-serif");var F=w.style;F===void 0&&(F="normal");var Y=w.weight;Y===void 0&&(Y=400);var X=(w.dataUrl||f).replace(/\/$/g,""),U=new Map,O=new Uint8Array(x.length),P={},ie={},le=new Array(x.length),T=new Map,J=!1;function Q(D){var ne=v.get(D);return ne||(ne=fetch(X+"/"+D).then(function(oe){if(!oe.ok)throw new Error(oe.statusText);return oe.json().then(function(j){if(!Array.isArray(j)||j[0]!==1)throw new Error("Incorrect schema version; need 1, got "+j[0]);return j[1]})}).catch(function(oe){if(X!==f)return J||(console.error('unicode-font-resolver: Failed loading from dataUrl "'+X+'", trying default CDN. '+oe.message),J=!0),X=f,v.delete(D),Q(D);throw oe}),v.set(D,ne)),ne}for(var se=function(D){var ne=x.codePointAt(D),oe=s(ne);le[D]=oe,u[oe]||T.has(oe)||T.set(oe,Q(oe).then(function(j){u[oe]=j})),ne>65535&&(D++,L=D)},L=0;L<x.length;L++)se(L);return Promise.all(T.values()).then(function(){T.clear();for(var D=function(oe){var j=x.codePointAt(oe),re=null,pe=u[le[oe]],me=void 0;for(var be in pe){var $e=ie[be];if($e===void 0&&($e=ie[be]=new RegExp(be).test(H||"en")),$e){for(var qe in me=be,pe[be])if(o(j,pe[be][qe])){re=qe;break}break}}if(!re){e:for(var ke in pe)if(ke!==me){for(var Te in pe[ke])if(o(j,pe[ke][Te])){re=Te;break e}}}re||(console.debug("No font coverage for U+"+j.toString(16)),re="latin"),le[oe]=re,C[re]||T.has(re)||T.set(re,Q("font-meta/"+re+".json").then(function(ut){C[re]=ut})),j>65535&&(oe++,ne=oe)},ne=0;ne<x.length;ne++)D(ne);return Promise.all(T.values())}).then(function(){for(var D,ne=null,oe=0;oe<x.length;oe++){var j=x.codePointAt(oe);if(ne&&(R(j)||p(ne).has(j)))O[oe]=O[oe-1];else{ne=C[le[oe]];var re=P[ne.id];if(!re){var pe=ne.typeforms,me=G(pe,N,"sans-serif"),be=G(pe[me],F,"normal"),$e=B((D=pe[me])===null||D===void 0?void 0:D[be],Y);re=P[ne.id]=X+"/font-files/"+ne.id+"/"+me+"."+be+"."+$e+".woff"}var qe=U.get(re);qe==null&&(qe=U.size,U.set(re,qe)),O[oe]=qe}j>65535&&(oe++,O[oe]=O[oe-1])}return{fontUrls:Array.from(U.keys()),chars:O}})},Object.defineProperty(a,"__esModule",{value:!0}),a}({})}function MD(a,e){const t=Object.create(null),n=Object.create(null);function i(o,r){const g=u=>{console.error(`Failure loading font ${o}`,u)};try{const u=new XMLHttpRequest;u.open("get",o,!0),u.responseType="arraybuffer",u.onload=function(){if(u.status>=400)g(new Error(u.statusText));else if(u.status>0)try{const C=a(u.response);C.src=o,r(C)}catch(C){g(C)}},u.onerror=g,u.send()}catch(u){g(u)}}function s(o,r){let g=t[o];g?r(g):n[o]?n[o].push(r):(n[o]=[r],i(o,u=>{u.src=o,t[o]=u,n[o].forEach(C=>C(u)),delete n[o]}))}return function(o,r,{lang:g,fonts:u=[],style:C="normal",weight:h="normal",unicodeFontsURL:f}={}){const p=new Uint8Array(o.length),y=[];o.length||R();const v=new Map,G=[];if(C!=="italic"&&(C="normal"),typeof h!="number"&&(h=h==="bold"?700:400),u&&!Array.isArray(u)&&(u=[u]),u=u.slice().filter(w=>!w.lang||w.lang.test(g)).reverse(),u.length){let N=0;(function F(Y=0){for(let X=Y,U=o.length;X<U;X++){const O=o.codePointAt(X);if(N===1&&y[p[X-1]].supportsCodePoint(O)||X>0&&/\s/.test(o[X]))p[X]=p[X-1],N===2&&(G[G.length-1][1]=X);else for(let P=p[X],ie=u.length;P<=ie;P++)if(P===ie){const le=N===2?G[G.length-1]:G[G.length]=[X,X];le[1]=X,N=2}else{p[X]=P;const{src:le,unicodeRange:T}=u[P];if(!T||x(O,T)){const J=t[le];if(!J){s(le,()=>{F(X)});return}if(J.supportsCodePoint(O)){let Q=v.get(J);typeof Q!="number"&&(Q=y.length,y.push(J),v.set(J,Q)),p[X]=Q,N=1;break}}}O>65535&&X+1<U&&(p[X+1]=p[X],X++,N===2&&(G[G.length-1][1]=X))}B()})()}else G.push([0,o.length-1]),B();function B(){if(G.length){const w=G.map(M=>o.substring(M[0],M[1]+1)).join(`
`);e.getFontsForString(w,{lang:g||void 0,style:C,weight:h,dataUrl:f}).then(({fontUrls:M,chars:H})=>{const N=y.length;let F=0;G.forEach(X=>{for(let U=0,O=X[1]-X[0];U<=O;U++)p[X[0]+U]=H[F++]+N;F++});let Y=0;M.forEach((X,U)=>{s(X,O=>{y[U+N]=O,++Y===M.length&&R()})})})}else R()}function R(){r({chars:p,fonts:y})}function x(w,M){for(let H=0;H<M.length;H++){const[N,F=N]=M[H];if(N<=w&&w<=F)return!0}return!1}}}const HD=fA({name:"FontResolver",dependencies:[MD,WD,VD],init(a,e,t){return a(e,t())}});function XD(a,e){const n=/[\u00AD\u034F\u061C\u115F-\u1160\u17B4-\u17B5\u180B-\u180E\u200B-\u200F\u202A-\u202E\u2060-\u206F\u3164\uFE00-\uFE0F\uFEFF\uFFA0\uFFF0-\uFFF8]/,i="[^\\S\\u00A0]",s=new RegExp(`${i}|[\\-\\u007C\\u00AD\\u2010\\u2012-\\u2014\\u2027\\u2056\\u2E17\\u2E40]`);function o({text:y,lang:v,fonts:G,style:B,weight:R,preResolvedFonts:x,unicodeFontsURL:w},M){const H=({chars:N,fonts:F})=>{let Y,X;const U=[];for(let O=0;O<N.length;O++)N[O]!==X?(X=N[O],U.push(Y={start:O,end:O,fontObj:F[N[O]]})):Y.end=O;M(U)};x?H(x):a(y,H,{lang:v,fonts:G,style:B,weight:R,unicodeFontsURL:w})}function r({text:y="",font:v,lang:G,sdfGlyphSize:B=64,fontSize:R=400,fontWeight:x=1,fontStyle:w="normal",letterSpacing:M=0,lineHeight:H="normal",maxWidth:N=1/0,direction:F,textAlign:Y="left",textIndent:X=0,whiteSpace:U="normal",overflowWrap:O="normal",anchorX:P=0,anchorY:ie=0,metricsOnly:le=!1,unicodeFontsURL:T,preResolvedFonts:J=null,includeCaretPositions:Q=!1,chunkedBoundsSize:se=8192,colorRanges:L=null},D){const ne=h(),oe={fontLoad:0,typesetting:0};y.indexOf("\r")>-1&&(console.info("Typesetter: got text with \\r chars; normalizing to \\n"),y=y.replace(/\r\n/g,`
`).replace(/\r/g,`
`)),R=+R,M=+M,N=+N,H=H||"normal",X=+X,o({text:y,lang:G,style:w,weight:x,fonts:typeof v=="string"?[{src:v}]:v,unicodeFontsURL:T,preResolvedFonts:J},j=>{oe.fontLoad=h()-ne;const re=isFinite(N);let pe=null,me=null,be=null,$e=null,qe=null,ke=null,Te=null,ut=null,q=0,De=0,Ke=U!=="nowrap";const Ee=new Map,ye=h();let Je=X,Me=0,Ze=new f;const gt=[Ze];j.forEach(Ge=>{const{fontObj:we}=Ge,{ascender:et,descender:lt,unitsPerEm:Ct,lineGap:At,capHeight:Ne,xHeight:tt}=we;let nt=Ee.get(we);if(!nt){const Qe=R/Ct,je=H==="normal"?(et-lt+At)*Qe:H*R,mt=(je-(et-lt)*Qe)/2,it=Math.min(je,(et-lt)*Qe),_e=(et+lt)/2*Qe+it/2;nt={index:Ee.size,src:we.src,fontObj:we,fontSizeMult:Qe,unitsPerEm:Ct,ascender:et*Qe,descender:lt*Qe,capHeight:Ne*Qe,xHeight:tt*Qe,lineHeight:je,baseline:-mt-et*Qe,caretTop:_e,caretBottom:_e-it},Ee.set(we,nt)}const{fontSizeMult:ue}=nt,xe=y.slice(Ge.start,Ge.end+1);let ct,Ie;we.forEachGlyph(xe,R,M,(Qe,je,mt,it)=>{je+=Me,it+=Ge.start,ct=je,Ie=Qe;const _e=y.charAt(it),ht=Qe.advanceWidth*ue,yt=Ze.count;let Bt;if("isEmpty"in Qe||(Qe.isWhitespace=!!_e&&new RegExp(i).test(_e),Qe.canBreakAfter=!!_e&&s.test(_e),Qe.isEmpty=Qe.xMin===Qe.xMax||Qe.yMin===Qe.yMax||n.test(_e)),!Qe.isWhitespace&&!Qe.isEmpty&&De++,Ke&&re&&!Qe.isWhitespace&&je+ht+Je>N&&yt){if(Ze.glyphAt(yt-1).glyphObj.canBreakAfter)Bt=new f,Je=-je;else for(let Gn=yt;Gn--;)if(Gn===0&&O==="break-word"){Bt=new f,Je=-je;break}else if(Ze.glyphAt(Gn).glyphObj.canBreakAfter){Bt=Ze.splitAt(Gn+1);const gn=Bt.glyphAt(0).x;Je-=gn;for(let Cn=Bt.count;Cn--;)Bt.glyphAt(Cn).x-=gn;break}Bt&&(Ze.isSoftWrapped=!0,Ze=Bt,gt.push(Ze),q=N)}let xt=Ze.glyphAt(Ze.count);xt.glyphObj=Qe,xt.x=je+Je,xt.y=mt,xt.width=ht,xt.charIndex=it,xt.fontData=nt,_e===`
`&&(Ze=new f,gt.push(Ze),Je=-(je+ht+M*R)+X)}),Me=ct+Ie.advanceWidth*ue+M*R});let k=0;gt.forEach(Ge=>{let we=!0;for(let et=Ge.count;et--;){const lt=Ge.glyphAt(et);we&&!lt.glyphObj.isWhitespace&&(Ge.width=lt.x+lt.width,Ge.width>q&&(q=Ge.width),we=!1);let{lineHeight:Ct,capHeight:At,xHeight:Ne,baseline:tt}=lt.fontData;Ct>Ge.lineHeight&&(Ge.lineHeight=Ct);const nt=tt-Ge.baseline;nt<0&&(Ge.baseline+=nt,Ge.cap+=nt,Ge.ex+=nt),Ge.cap=Math.max(Ge.cap,Ge.baseline+At),Ge.ex=Math.max(Ge.ex,Ge.baseline+Ne)}Ge.baseline-=k,Ge.cap-=k,Ge.ex-=k,k+=Ge.lineHeight});let z=0,Ce=0;if(P&&(typeof P=="number"?z=-P:typeof P=="string"&&(z=-q*(P==="left"?0:P==="center"?.5:P==="right"?1:u(P)))),ie&&(typeof ie=="number"?Ce=-ie:typeof ie=="string"&&(Ce=ie==="top"?0:ie==="top-baseline"?-gt[0].baseline:ie==="top-cap"?-gt[0].cap:ie==="top-ex"?-gt[0].ex:ie==="middle"?k/2:ie==="bottom"?k:ie==="bottom-baseline"?-gt[gt.length-1].baseline:u(ie)*k)),!le){const Ge=e.getEmbeddingLevels(y,F);pe=new Uint16Array(De),me=new Uint8Array(De),be=new Float32Array(De*2),$e={},Te=[1/0,1/0,-1/0,-1/0],ut=[],Q&&(ke=new Float32Array(y.length*4)),L&&(qe=new Uint8Array(De*3));let we=0,et=-1,lt=-1,Ct,At;if(gt.forEach((Ne,tt)=>{let{count:nt,width:ue}=Ne;if(nt>0){let xe=0;for(let it=nt;it--&&Ne.glyphAt(it).glyphObj.isWhitespace;)xe++;let ct=0,Ie=0;if(Y==="center")ct=(q-ue)/2;else if(Y==="right")ct=q-ue;else if(Y==="justify"&&Ne.isSoftWrapped){let it=0;for(let _e=nt-xe;_e--;)Ne.glyphAt(_e).glyphObj.isWhitespace&&it++;Ie=(q-ue)/it}if(Ie||ct){let it=0;for(let _e=0;_e<nt;_e++){let ht=Ne.glyphAt(_e);const yt=ht.glyphObj;ht.x+=ct+it,Ie!==0&&yt.isWhitespace&&_e<nt-xe&&(it+=Ie,ht.width+=Ie)}}const Qe=e.getReorderSegments(y,Ge,Ne.glyphAt(0).charIndex,Ne.glyphAt(Ne.count-1).charIndex);for(let it=0;it<Qe.length;it++){const[_e,ht]=Qe[it];let yt=1/0,Bt=-1/0;for(let xt=0;xt<nt;xt++)if(Ne.glyphAt(xt).charIndex>=_e){let Gn=xt,gn=xt;for(;gn<nt;gn++){let Cn=Ne.glyphAt(gn);if(Cn.charIndex>ht)break;gn<nt-xe&&(yt=Math.min(yt,Cn.x),Bt=Math.max(Bt,Cn.x+Cn.width))}for(let Cn=Gn;Cn<gn;Cn++){const Kn=Ne.glyphAt(Cn);Kn.x=Bt-(Kn.x+Kn.width-yt)}break}}let je;const mt=it=>je=it;for(let it=0;it<nt;it++){const _e=Ne.glyphAt(it);je=_e.glyphObj;const ht=je.index,yt=Ge.levels[_e.charIndex]&1;if(yt){const Bt=e.getMirroredCharacter(y[_e.charIndex]);Bt&&_e.fontData.fontObj.forEachGlyph(Bt,0,0,mt)}if(Q){const{charIndex:Bt,fontData:xt}=_e,Gn=_e.x+z,gn=_e.x+_e.width+z;ke[Bt*4]=yt?gn:Gn,ke[Bt*4+1]=yt?Gn:gn,ke[Bt*4+2]=Ne.baseline+xt.caretBottom+Ce,ke[Bt*4+3]=Ne.baseline+xt.caretTop+Ce;const Cn=Bt-et;Cn>1&&C(ke,et,Cn),et=Bt}if(L){const{charIndex:Bt}=_e;for(;Bt>lt;)lt++,L.hasOwnProperty(lt)&&(At=L[lt])}if(!je.isWhitespace&&!je.isEmpty){const Bt=we++,{fontSizeMult:xt,src:Gn,index:gn}=_e.fontData,Cn=$e[Gn]||($e[Gn]={});Cn[ht]||(Cn[ht]={path:je.path,pathBounds:[je.xMin,je.yMin,je.xMax,je.yMax]});const Kn=_e.x+z,ui=_e.y+Ne.baseline+Ce;be[Bt*2]=Kn,be[Bt*2+1]=ui;const hi=Kn+je.xMin*xt,$a=ui+je.yMin*xt,aa=Kn+je.xMax*xt,Ii=ui+je.yMax*xt;hi<Te[0]&&(Te[0]=hi),$a<Te[1]&&(Te[1]=$a),aa>Te[2]&&(Te[2]=aa),Ii>Te[3]&&(Te[3]=Ii),Bt%se===0&&(Ct={start:Bt,end:Bt,rect:[1/0,1/0,-1/0,-1/0]},ut.push(Ct)),Ct.end++;const Jn=Ct.rect;if(hi<Jn[0]&&(Jn[0]=hi),$a<Jn[1]&&(Jn[1]=$a),aa>Jn[2]&&(Jn[2]=aa),Ii>Jn[3]&&(Jn[3]=Ii),pe[Bt]=ht,me[Bt]=gn,L){const Bn=Bt*3;qe[Bn]=At>>16&255,qe[Bn+1]=At>>8&255,qe[Bn+2]=At&255}}}}}),ke){const Ne=y.length-et;Ne>1&&C(ke,et,Ne)}}const Ve=[];Ee.forEach(({index:Ge,src:we,unitsPerEm:et,ascender:lt,descender:Ct,lineHeight:At,capHeight:Ne,xHeight:tt})=>{Ve[Ge]={src:we,unitsPerEm:et,ascender:lt,descender:Ct,lineHeight:At,capHeight:Ne,xHeight:tt}}),oe.typesetting=h()-ye,D({glyphIds:pe,glyphFontIndices:me,glyphPositions:be,glyphData:$e,fontData:Ve,caretPositions:ke,glyphColors:qe,chunkedBounds:ut,fontSize:R,topBaseline:Ce+gt[0].baseline,blockBounds:[z,Ce-k,z+q,Ce],visibleBounds:Te,timings:oe})})}function g(y,v){r({...y,metricsOnly:!0},G=>{const[B,R,x,w]=G.blockBounds;v({width:x-B,height:w-R})})}function u(y){let v=y.match(/^([\d.]+)%$/),G=v?parseFloat(v[1]):NaN;return isNaN(G)?0:G/100}function C(y,v,G){const B=y[v*4],R=y[v*4+1],x=y[v*4+2],w=y[v*4+3],M=(R-B)/G;for(let H=0;H<G;H++){const N=(v+H)*4;y[N]=B+M*H,y[N+1]=B+M*(H+1),y[N+2]=x,y[N+3]=w}}function h(){return(self.performance||Date).now()}function f(){this.data=[]}const p=["glyphObj","x","y","width","charIndex","fontData"];return f.prototype={width:0,lineHeight:0,baseline:0,cap:0,ex:0,isSoftWrapped:!1,get count(){return Math.ceil(this.data.length/p.length)},glyphAt(y){let v=f.flyweight;return v.data=this.data,v.index=y,v},splitAt(y){let v=new f;return v.data=this.data.splice(y*p.length),v}},f.flyweight=p.reduce((y,v,G,B)=>(Object.defineProperty(y,v,{get(){return this.data[this.index*p.length+G]},set(R){this.data[this.index*p.length+G]=R}}),y),{data:null,index:0}),{typeset:r,measure:g}}const nC=()=>(self.performance||Date).now(),ky=IH();let Z1;function ND(a,e,t,n,i,s,o,r,g,u,C=!0){return C?KD(a,e,t,n,i,s,o,r,g,u).then(null,h=>(Z1||(console.warn("WebGL SDF generation failed, falling back to JS",h),Z1=!0),R1(a,e,t,n,i,s,o,r,g,u))):R1(a,e,t,n,i,s,o,r,g,u)}const Jb=[],YD=5;let u2=0;function dH(){const a=nC();for(;Jb.length&&nC()-a<YD;)Jb.shift()();u2=Jb.length?setTimeout(dH,0):0}const KD=(...a)=>new Promise((e,t)=>{Jb.push(()=>{const n=nC();try{ky.webgl.generateIntoCanvas(...a),e({timing:nC()-n})}catch(i){t(i)}}),u2||(u2=setTimeout(dH,0))}),FD=4,ED=2e3,S1={};let TD=0;function R1(a,e,t,n,i,s,o,r,g,u){const C="TroikaTextSDFGenerator_JS_"+TD++%FD;let h=S1[C];return h||(h=S1[C]={workerModule:fA({name:C,workerId:C,dependencies:[IH,nC],init(f,p){const y=f().javascript.generate;return function(...v){const G=p();return{textureData:y(...v),timing:p()-G}}},getTransferables(f){return[f.textureData.buffer]}}),requests:0,idleTimer:null}),h.requests++,clearTimeout(h.idleTimer),h.workerModule(a,e,t,n,i,s).then(({textureData:f,timing:p})=>{const y=nC(),v=new Uint8Array(f.length*4);for(let G=0;G<f.length;G++)v[G*4+u]=f[G];return ky.webglUtils.renderImageData(o,v,r,g,a,e,1<<3-u),p+=nC()-y,--h.requests===0&&(h.idleTimer=setTimeout(()=>{fD(C)},ED)),{timing:p}})}function zD(a){a._warm||(ky.webgl.isSupported(a),a._warm=!0)}const LD=ky.webglUtils.resizeWebGLCanvasWithoutClearing,lf={unicodeFontsURL:null,sdfGlyphSize:64,sdfMargin:1/16,sdfExponent:9,textureWidth:2048},_D=new Gt;function Fd(){return(self.performance||Date).now()}const w1=Object.create(null);function AH(a,e){a=kD({},a);const t=Fd(),n=[];if(a.font&&n.push({label:"user",src:OD(a.font)}),a.font=n,a.text=""+a.text,a.sdfGlyphSize=a.sdfGlyphSize||lf.sdfGlyphSize,a.unicodeFontsURL=a.unicodeFontsURL||lf.unicodeFontsURL,a.colorRanges!=null){let f={};for(let p in a.colorRanges)if(a.colorRanges.hasOwnProperty(p)){let y=a.colorRanges[p];typeof y!="number"&&(y=_D.set(y).getHex()),f[p]=y}a.colorRanges=f}Object.freeze(a);const{textureWidth:i,sdfExponent:s}=lf,{sdfGlyphSize:o}=a,r=i/o*4;let g=w1[o];if(!g){const f=document.createElement("canvas");f.width=i,f.height=o*256/r,g=w1[o]={glyphCount:0,sdfGlyphSize:o,sdfCanvas:f,sdfTexture:new Zi(f,void 0,void 0,void 0,Bi,Bi),contextLost:!1,glyphsByFont:new Map},g.sdfTexture.generateMipmaps=!1,UD(g)}const{sdfTexture:u,sdfCanvas:C}=g;pH(a).then(f=>{const{glyphIds:p,glyphFontIndices:y,fontData:v,glyphPositions:G,fontSize:B,timings:R}=f,x=[],w=new Float32Array(p.length*4);let M=0,H=0;const N=Fd(),F=v.map(P=>{let ie=g.glyphsByFont.get(P.src);return ie||g.glyphsByFont.set(P.src,ie=new Map),ie});p.forEach((P,ie)=>{const le=y[ie],{src:T,unitsPerEm:J}=v[le];let Q=F[le].get(P);if(!Q){const{path:oe,pathBounds:j}=f.glyphData[T][P],re=Math.max(j[2]-j[0],j[3]-j[1])/o*(lf.sdfMargin*o+.5),pe=g.glyphCount++,me=[j[0]-re,j[1]-re,j[2]+re,j[3]+re];F[le].set(P,Q={path:oe,atlasIndex:pe,sdfViewBox:me}),x.push(Q)}const{sdfViewBox:se}=Q,L=G[H++],D=G[H++],ne=B/J;w[M++]=L+se[0]*ne,w[M++]=D+se[1]*ne,w[M++]=L+se[2]*ne,w[M++]=D+se[3]*ne,p[ie]=Q.atlasIndex}),R.quads=(R.quads||0)+(Fd()-N);const Y=Fd();R.sdf={};const X=C.height,U=Math.ceil(g.glyphCount/r),O=Math.pow(2,Math.ceil(Math.log2(U*o)));O>X&&(console.info(`Increasing SDF texture size ${X}->${O}`),LD(C,i,O),u.dispose()),Promise.all(x.map(P=>hH(P,g,a.gpuAccelerateSDF).then(({timing:ie})=>{R.sdf[P.atlasIndex]=ie}))).then(()=>{x.length&&!g.contextLost&&(fH(g),u.needsUpdate=!0),R.sdfTotal=Fd()-Y,R.total=Fd()-t,e(Object.freeze({parameters:a,sdfTexture:u,sdfGlyphSize:o,sdfExponent:s,glyphBounds:w,glyphAtlasIndices:p,glyphColors:f.glyphColors,caretPositions:f.caretPositions,chunkedBounds:f.chunkedBounds,ascender:f.ascender,descender:f.descender,lineHeight:f.lineHeight,capHeight:f.capHeight,xHeight:f.xHeight,topBaseline:f.topBaseline,blockBounds:f.blockBounds,visibleBounds:f.visibleBounds,timings:f.timings}))})}),Promise.resolve().then(()=>{g.contextLost||zD(C)})}function hH({path:a,atlasIndex:e,sdfViewBox:t},{sdfGlyphSize:n,sdfCanvas:i,contextLost:s},o){if(s)return Promise.resolve({timing:-1});const{textureWidth:r,sdfExponent:g}=lf,u=Math.max(t[2]-t[0],t[3]-t[1]),C=Math.floor(e/4),h=C%(r/n)*n,f=Math.floor(C/(r/n))*n,p=e%4;return ND(n,n,a,t,u,g,i,h,f,p,o)}function UD(a){const e=a.sdfCanvas;e.addEventListener("webglcontextlost",t=>{console.log("Context Lost",t),t.preventDefault(),a.contextLost=!0}),e.addEventListener("webglcontextrestored",t=>{console.log("Context Restored",t),a.contextLost=!1;const n=[];a.glyphsByFont.forEach(i=>{i.forEach(s=>{n.push(hH(s,a,!0))})}),Promise.all(n).then(()=>{fH(a),a.sdfTexture.needsUpdate=!0})})}function DD({font:a,characters:e,sdfGlyphSize:t},n){let i=Array.isArray(e)?e.join(`
`):""+e;AH({font:a,sdfGlyphSize:t,text:i},n)}function kD(a,e){for(let t in e)e.hasOwnProperty(t)&&(a[t]=e[t]);return a}let vb;function OD(a){return vb||(vb=typeof document>"u"?{}:document.createElement("a")),vb.href=a,vb.href}function fH(a){if(typeof createImageBitmap!="function"){console.info("Safari<15: applying SDF canvas workaround");const{sdfCanvas:e,sdfTexture:t}=a,{width:n,height:i}=e,s=a.sdfCanvas.getContext("webgl");let o=t.image.data;(!o||o.length!==n*i*4)&&(o=new Uint8Array(n*i*4),t.image={width:n,height:i,data:o},t.flipY=!1,t.isDataTexture=!0),s.readPixels(0,0,n,i,s.RGBA,s.UNSIGNED_BYTE,o)}}const JD=fA({name:"Typesetter",dependencies:[XD,HD,mD],init(a,e,t){return a(e,t())}}),pH=fA({name:"Typesetter",dependencies:[JD],init(a){return function(e){return new Promise(t=>{a.typeset(e,t)})}},getTransferables(a){const e=[];for(let t in a)a[t]&&a[t].buffer&&e.push(a[t].buffer);return e}});pH.onMainThread;const x1={};function PD(a){let e=x1[a];return e||(e=x1[a]=new bc(1,1,a,a).translate(.5,.5,0)),e}const QD="aTroikaGlyphBounds",W1="aTroikaGlyphIndex",jD="aTroikaGlyphColor";class qD extends yZ{constructor(){super(),this.detail=1,this.curveRadius=0,this.groups=[{start:0,count:1/0,materialIndex:0},{start:0,count:1/0,materialIndex:1}],this.boundingSphere=new Ra,this.boundingBox=new Sa}computeBoundingSphere(){}computeBoundingBox(){}set detail(e){if(e!==this._detail){this._detail=e,(typeof e!="number"||e<1)&&(e=1);let t=PD(e);["position","normal","uv"].forEach(n=>{this.attributes[n]=t.attributes[n].clone()}),this.setIndex(t.getIndex().clone())}}get detail(){return this._detail}set curveRadius(e){e!==this._curveRadius&&(this._curveRadius=e,this._updateBounds())}get curveRadius(){return this._curveRadius}updateGlyphs(e,t,n,i,s){this.updateAttributeData(QD,e,4),this.updateAttributeData(W1,t,1),this.updateAttributeData(jD,s,3),this._blockBounds=n,this._chunkedBounds=i,this.instanceCount=t.length,this._updateBounds()}_updateBounds(){const e=this._blockBounds;if(e){const{curveRadius:t,boundingBox:n}=this;if(t){const{PI:i,floor:s,min:o,max:r,sin:g,cos:u}=Math,C=i/2,h=i*2,f=Math.abs(t),p=e[0]/f,y=e[2]/f,v=s((p+C)/h)!==s((y+C)/h)?-f:o(g(p)*f,g(y)*f),G=s((p-C)/h)!==s((y-C)/h)?f:r(g(p)*f,g(y)*f),B=s((p+i)/h)!==s((y+i)/h)?f*2:r(f-u(p)*f,f-u(y)*f);n.min.set(v,e[1],t<0?-B:0),n.max.set(G,e[3],t<0?0:B)}else n.min.set(e[0],e[1],0),n.max.set(e[2],e[3],0);n.getBoundingSphere(this.boundingSphere)}}applyClipRect(e){let t=this.getAttribute(W1).count,n=this._chunkedBounds;if(n)for(let i=n.length;i--;){t=n[i].end;let s=n[i].rect;if(s[1]<e.w&&s[3]>e.y&&s[0]<e.z&&s[2]>e.x)break}this.instanceCount=t}updateAttributeData(e,t,n){const i=this.getAttribute(e);t?i&&i.array.length===t.length?(i.array.set(t),i.needsUpdate=!0):(this.setAttribute(e,new Su(t,n)),delete this._maxInstanceCount,this.dispose()):i&&this.deleteAttribute(e)}}const $D=`
uniform vec2 uTroikaSDFTextureSize;
uniform float uTroikaSDFGlyphSize;
uniform vec4 uTroikaTotalBounds;
uniform vec4 uTroikaClipRect;
uniform mat3 uTroikaOrient;
uniform bool uTroikaUseGlyphColors;
uniform float uTroikaEdgeOffset;
uniform float uTroikaBlurRadius;
uniform vec2 uTroikaPositionOffset;
uniform float uTroikaCurveRadius;
attribute vec4 aTroikaGlyphBounds;
attribute float aTroikaGlyphIndex;
attribute vec3 aTroikaGlyphColor;
varying vec2 vTroikaGlyphUV;
varying vec4 vTroikaTextureUVBounds;
varying float vTroikaTextureChannel;
varying vec3 vTroikaGlyphColor;
varying vec2 vTroikaGlyphDimensions;
`,ek=`
vec4 bounds = aTroikaGlyphBounds;
bounds.xz += uTroikaPositionOffset.x;
bounds.yw -= uTroikaPositionOffset.y;

vec4 outlineBounds = vec4(
  bounds.xy - uTroikaEdgeOffset - uTroikaBlurRadius,
  bounds.zw + uTroikaEdgeOffset + uTroikaBlurRadius
);
vec4 clippedBounds = vec4(
  clamp(outlineBounds.xy, uTroikaClipRect.xy, uTroikaClipRect.zw),
  clamp(outlineBounds.zw, uTroikaClipRect.xy, uTroikaClipRect.zw)
);

vec2 clippedXY = (mix(clippedBounds.xy, clippedBounds.zw, position.xy) - bounds.xy) / (bounds.zw - bounds.xy);

position.xy = mix(bounds.xy, bounds.zw, clippedXY);

uv = (position.xy - uTroikaTotalBounds.xy) / (uTroikaTotalBounds.zw - uTroikaTotalBounds.xy);

float rad = uTroikaCurveRadius;
if (rad != 0.0) {
  float angle = position.x / rad;
  position.xz = vec2(sin(angle) * rad, rad - cos(angle) * rad);
  normal.xz = vec2(sin(angle), cos(angle));
}
  
position = uTroikaOrient * position;
normal = uTroikaOrient * normal;

vTroikaGlyphUV = clippedXY.xy;
vTroikaGlyphDimensions = vec2(bounds[2] - bounds[0], bounds[3] - bounds[1]);


float txCols = uTroikaSDFTextureSize.x / uTroikaSDFGlyphSize;
vec2 txUvPerSquare = uTroikaSDFGlyphSize / uTroikaSDFTextureSize;
vec2 txStartUV = txUvPerSquare * vec2(
  mod(floor(aTroikaGlyphIndex / 4.0), txCols),
  floor(floor(aTroikaGlyphIndex / 4.0) / txCols)
);
vTroikaTextureUVBounds = vec4(txStartUV, vec2(txStartUV) + txUvPerSquare);
vTroikaTextureChannel = mod(aTroikaGlyphIndex, 4.0);
`,tk=`
uniform sampler2D uTroikaSDFTexture;
uniform vec2 uTroikaSDFTextureSize;
uniform float uTroikaSDFGlyphSize;
uniform float uTroikaSDFExponent;
uniform float uTroikaEdgeOffset;
uniform float uTroikaFillOpacity;
uniform float uTroikaBlurRadius;
uniform vec3 uTroikaStrokeColor;
uniform float uTroikaStrokeWidth;
uniform float uTroikaStrokeOpacity;
uniform bool uTroikaSDFDebug;
varying vec2 vTroikaGlyphUV;
varying vec4 vTroikaTextureUVBounds;
varying float vTroikaTextureChannel;
varying vec2 vTroikaGlyphDimensions;

float troikaSdfValueToSignedDistance(float alpha) {
  // Inverse of exponential encoding in webgl-sdf-generator
  
  float maxDimension = max(vTroikaGlyphDimensions.x, vTroikaGlyphDimensions.y);
  float absDist = (1.0 - pow(2.0 * (alpha > 0.5 ? 1.0 - alpha : alpha), 1.0 / uTroikaSDFExponent)) * maxDimension;
  float signedDist = absDist * (alpha > 0.5 ? -1.0 : 1.0);
  return signedDist;
}

float troikaGlyphUvToSdfValue(vec2 glyphUV) {
  vec2 textureUV = mix(vTroikaTextureUVBounds.xy, vTroikaTextureUVBounds.zw, glyphUV);
  vec4 rgba = texture2D(uTroikaSDFTexture, textureUV);
  float ch = floor(vTroikaTextureChannel + 0.5); //NOTE: can't use round() in WebGL1
  return ch == 0.0 ? rgba.r : ch == 1.0 ? rgba.g : ch == 2.0 ? rgba.b : rgba.a;
}

float troikaGlyphUvToDistance(vec2 uv) {
  return troikaSdfValueToSignedDistance(troikaGlyphUvToSdfValue(uv));
}

float troikaGetAADist() {
  
  #if defined(GL_OES_standard_derivatives) || __VERSION__ >= 300
  return length(fwidth(vTroikaGlyphUV * vTroikaGlyphDimensions)) * 0.5;
  #else
  return vTroikaGlyphDimensions.x / 64.0;
  #endif
}

float troikaGetFragDistValue() {
  vec2 clampedGlyphUV = clamp(vTroikaGlyphUV, 0.5 / uTroikaSDFGlyphSize, 1.0 - 0.5 / uTroikaSDFGlyphSize);
  float distance = troikaGlyphUvToDistance(clampedGlyphUV);
 
  // Extrapolate distance when outside bounds:
  distance += clampedGlyphUV == vTroikaGlyphUV ? 0.0 : 
    length((vTroikaGlyphUV - clampedGlyphUV) * vTroikaGlyphDimensions);

  

  return distance;
}

float troikaGetEdgeAlpha(float distance, float distanceOffset, float aaDist) {
  #if defined(IS_DEPTH_MATERIAL) || defined(IS_DISTANCE_MATERIAL)
  float alpha = step(-distanceOffset, -distance);
  #else

  float alpha = smoothstep(
    distanceOffset + aaDist,
    distanceOffset - aaDist,
    distance
  );
  #endif

  return alpha;
}
`,nk=`
float aaDist = troikaGetAADist();
float fragDistance = troikaGetFragDistValue();
float edgeAlpha = uTroikaSDFDebug ?
  troikaGlyphUvToSdfValue(vTroikaGlyphUV) :
  troikaGetEdgeAlpha(fragDistance, uTroikaEdgeOffset, max(aaDist, uTroikaBlurRadius));

#if !defined(IS_DEPTH_MATERIAL) && !defined(IS_DISTANCE_MATERIAL)
vec4 fillRGBA = gl_FragColor;
fillRGBA.a *= uTroikaFillOpacity;
vec4 strokeRGBA = uTroikaStrokeWidth == 0.0 ? fillRGBA : vec4(uTroikaStrokeColor, uTroikaStrokeOpacity);
if (fillRGBA.a == 0.0) fillRGBA.rgb = strokeRGBA.rgb;
gl_FragColor = mix(fillRGBA, strokeRGBA, smoothstep(
  -uTroikaStrokeWidth - aaDist,
  -uTroikaStrokeWidth + aaDist,
  fragDistance
));
gl_FragColor.a *= edgeAlpha;
#endif

if (edgeAlpha == 0.0) {
  discard;
}
`;function ik(a){const e=c2(a,{chained:!0,extensions:{derivatives:!0},uniforms:{uTroikaSDFTexture:{value:null},uTroikaSDFTextureSize:{value:new at},uTroikaSDFGlyphSize:{value:0},uTroikaSDFExponent:{value:0},uTroikaTotalBounds:{value:new Hn(0,0,0,0)},uTroikaClipRect:{value:new Hn(0,0,0,0)},uTroikaEdgeOffset:{value:0},uTroikaFillOpacity:{value:1},uTroikaPositionOffset:{value:new at},uTroikaCurveRadius:{value:0},uTroikaBlurRadius:{value:0},uTroikaStrokeWidth:{value:0},uTroikaStrokeColor:{value:new Gt},uTroikaStrokeOpacity:{value:1},uTroikaOrient:{value:new on},uTroikaUseGlyphColors:{value:!0},uTroikaSDFDebug:{value:!1}},vertexDefs:$D,vertexTransform:ek,fragmentDefs:tk,fragmentColorTransform:nk,customRewriter({vertexShader:t,fragmentShader:n}){let i=/\buniform\s+vec3\s+diffuse\b/;return i.test(n)&&(n=n.replace(i,"varying vec3 vTroikaGlyphColor").replace(/\bdiffuse\b/g,"vTroikaGlyphColor"),i.test(t)||(t=t.replace(CH,`uniform vec3 diffuse;
$&
vTroikaGlyphColor = uTroikaUseGlyphColors ? aTroikaGlyphColor / 255.0 : diffuse;
`))),{vertexShader:t,fragmentShader:n}}});return e.transparent=!0,e.forceSinglePass=!0,Object.defineProperties(e,{isTroikaTextMaterial:{value:!0},shadowSide:{get(){return this.side},set(){}}}),e}const NZ=new wo({color:16777215,side:Oo,transparent:!0}),V1=8421504,M1=new Yt,Zb=new ae,iv=new ae,Oh=[],ak=new ae,av="+x+y";function H1(a){return Array.isArray(a)?a[0]:a}let mH=()=>{const a=new vi(new bc(1,1),NZ);return mH=()=>a,a},bH=()=>{const a=new vi(new bc(1,1,32,1),NZ);return bH=()=>a,a};const sk={type:"syncstart"},ok={type:"synccomplete"},yH=["font","fontSize","fontStyle","fontWeight","lang","letterSpacing","lineHeight","maxWidth","overflowWrap","text","direction","textAlign","textIndent","whiteSpace","anchorX","anchorY","colorRanges","sdfGlyphSize"],lk=yH.concat("material","color","depthOffset","clipRect","curveRadius","orientation","glyphGeometryDetail");let GH=class extends vi{constructor(){const e=new qD;super(e,null),this.text="",this.anchorX=0,this.anchorY=0,this.curveRadius=0,this.direction="auto",this.font=null,this.unicodeFontsURL=null,this.fontSize=.1,this.fontWeight="normal",this.fontStyle="normal",this.lang=null,this.letterSpacing=0,this.lineHeight="normal",this.maxWidth=1/0,this.overflowWrap="normal",this.textAlign="left",this.textIndent=0,this.whiteSpace="normal",this.material=null,this.color=null,this.colorRanges=null,this.outlineWidth=0,this.outlineColor=0,this.outlineOpacity=1,this.outlineBlur=0,this.outlineOffsetX=0,this.outlineOffsetY=0,this.strokeWidth=0,this.strokeColor=V1,this.strokeOpacity=1,this.fillOpacity=1,this.depthOffset=0,this.clipRect=null,this.orientation=av,this.glyphGeometryDetail=1,this.sdfGlyphSize=null,this.gpuAccelerateSDF=!0,this.debugSDF=!1}sync(e){this._needsSync&&(this._needsSync=!1,this._isSyncing?(this._queuedSyncs||(this._queuedSyncs=[])).push(e):(this._isSyncing=!0,this.dispatchEvent(sk),AH({text:this.text,font:this.font,lang:this.lang,fontSize:this.fontSize||.1,fontWeight:this.fontWeight||"normal",fontStyle:this.fontStyle||"normal",letterSpacing:this.letterSpacing||0,lineHeight:this.lineHeight||"normal",maxWidth:this.maxWidth,direction:this.direction||"auto",textAlign:this.textAlign,textIndent:this.textIndent,whiteSpace:this.whiteSpace,overflowWrap:this.overflowWrap,anchorX:this.anchorX,anchorY:this.anchorY,colorRanges:this.colorRanges,includeCaretPositions:!0,sdfGlyphSize:this.sdfGlyphSize,gpuAccelerateSDF:this.gpuAccelerateSDF,unicodeFontsURL:this.unicodeFontsURL},t=>{this._isSyncing=!1,this._textRenderInfo=t,this.geometry.updateGlyphs(t.glyphBounds,t.glyphAtlasIndices,t.blockBounds,t.chunkedBounds,t.glyphColors);const n=this._queuedSyncs;n&&(this._queuedSyncs=null,this._needsSync=!0,this.sync(()=>{n.forEach(i=>i&&i())})),this.dispatchEvent(ok),e&&e()})))}onBeforeRender(e,t,n,i,s,o){this.sync(),s.isTroikaTextMaterial&&this._prepareForRender(s)}dispose(){this.geometry.dispose()}get textRenderInfo(){return this._textRenderInfo||null}createDerivedMaterial(e){return ik(e)}get material(){let e=this._derivedMaterial;const t=this._baseMaterial||this._defaultMaterial||(this._defaultMaterial=NZ.clone());if((!e||!e.isDerivedFrom(t))&&(e=this._derivedMaterial=this.createDerivedMaterial(t),t.addEventListener("dispose",function n(){t.removeEventListener("dispose",n),e.dispose()})),this.hasOutline()){let n=e._outlineMtl;return n||(n=e._outlineMtl=Object.create(e,{id:{value:e.id+.1}}),n.isTextOutlineMaterial=!0,n.depthWrite=!1,n.map=null,e.addEventListener("dispose",function i(){e.removeEventListener("dispose",i),n.dispose()})),[n,e]}else return e}set material(e){e&&e.isTroikaTextMaterial?(this._derivedMaterial=e,this._baseMaterial=e.baseMaterial):this._baseMaterial=e}hasOutline(){return!!(this.outlineWidth||this.outlineBlur||this.outlineOffsetX||this.outlineOffsetY)}get glyphGeometryDetail(){return this.geometry.detail}set glyphGeometryDetail(e){this.geometry.detail=e}get curveRadius(){return this.geometry.curveRadius}set curveRadius(e){this.geometry.curveRadius=e}get customDepthMaterial(){return H1(this.material).getDepthMaterial()}set customDepthMaterial(e){}get customDistanceMaterial(){return H1(this.material).getDistanceMaterial()}set customDistanceMaterial(e){}_prepareForRender(e){const t=e.isTextOutlineMaterial,n=e.uniforms,i=this.textRenderInfo;if(i){const{sdfTexture:r,blockBounds:g}=i;n.uTroikaSDFTexture.value=r,n.uTroikaSDFTextureSize.value.set(r.image.width,r.image.height),n.uTroikaSDFGlyphSize.value=i.sdfGlyphSize,n.uTroikaSDFExponent.value=i.sdfExponent,n.uTroikaTotalBounds.value.fromArray(g),n.uTroikaUseGlyphColors.value=!t&&!!i.glyphColors;let u=0,C=0,h=0,f,p,y,v=0,G=0;if(t){let{outlineWidth:R,outlineOffsetX:x,outlineOffsetY:w,outlineBlur:M,outlineOpacity:H}=this;u=this._parsePercent(R)||0,C=Math.max(0,this._parsePercent(M)||0),f=H,v=this._parsePercent(x)||0,G=this._parsePercent(w)||0}else h=Math.max(0,this._parsePercent(this.strokeWidth)||0),h&&(y=this.strokeColor,n.uTroikaStrokeColor.value.set(y??V1),p=this.strokeOpacity,p==null&&(p=1)),f=this.fillOpacity;n.uTroikaEdgeOffset.value=u,n.uTroikaPositionOffset.value.set(v,G),n.uTroikaBlurRadius.value=C,n.uTroikaStrokeWidth.value=h,n.uTroikaStrokeOpacity.value=p,n.uTroikaFillOpacity.value=f??1,n.uTroikaCurveRadius.value=this.curveRadius||0;let B=this.clipRect;if(B&&Array.isArray(B)&&B.length===4)n.uTroikaClipRect.value.fromArray(B);else{const R=(this.fontSize||.1)*100;n.uTroikaClipRect.value.set(g[0]-R,g[1]-R,g[2]+R,g[3]+R)}this.geometry.applyClipRect(n.uTroikaClipRect.value)}n.uTroikaSDFDebug.value=!!this.debugSDF,e.polygonOffset=!!this.depthOffset,e.polygonOffsetFactor=e.polygonOffsetUnits=this.depthOffset||0;const s=t?this.outlineColor||0:this.color;if(s==null)delete e.color;else{const r=e.hasOwnProperty("color")?e.color:e.color=new Gt;(s!==r._input||typeof s=="object")&&r.set(r._input=s)}let o=this.orientation||av;if(o!==e._orientation){let r=n.uTroikaOrient.value;o=o.replace(/[^-+xyz]/g,"");let g=o!==av&&o.match(/^([-+])([xyz])([-+])([xyz])$/);if(g){let[,u,C,h,f]=g;Zb.set(0,0,0)[C]=u==="-"?1:-1,iv.set(0,0,0)[f]=h==="-"?-1:1,M1.lookAt(ak,Zb.cross(iv),iv),r.setFromMatrix4(M1)}else r.identity();e._orientation=o}}_parsePercent(e){if(typeof e=="string"){let t=e.match(/^(-?[\d.]+)%$/),n=t?parseFloat(t[1]):NaN;e=(isNaN(n)?0:n/100)*this.fontSize}return e}localPositionToTextCoords(e,t=new at){t.copy(e);const n=this.curveRadius;return n&&(t.x=Math.atan2(e.x,Math.abs(n)-Math.abs(e.z))*Math.abs(n)),t}worldPositionToTextCoords(e,t=new at){return Zb.copy(e),this.localPositionToTextCoords(this.worldToLocal(Zb),t)}raycast(e,t){const{textRenderInfo:n,curveRadius:i}=this;if(n){const s=n.blockBounds,o=i?bH():mH(),r=o.geometry,{position:g,uv:u}=r.attributes;for(let C=0;C<u.count;C++){let h=s[0]+u.getX(C)*(s[2]-s[0]);const f=s[1]+u.getY(C)*(s[3]-s[1]);let p=0;i&&(p=i-Math.cos(h/i)*i,h=Math.sin(h/i)*i),g.setXYZ(C,h,f,p)}r.boundingSphere=this.geometry.boundingSphere,r.boundingBox=this.geometry.boundingBox,o.matrixWorld=this.matrixWorld,o.material.side=this.material.side,Oh.length=0,o.raycast(e,Oh);for(let C=0;C<Oh.length;C++)Oh[C].object=this,t.push(Oh[C])}}copy(e){const t=this.geometry;return super.copy(e),this.geometry=t,lk.forEach(n=>{this[n]=e[n]}),this}clone(){return new this.constructor().copy(this)}};yH.forEach(a=>{const e="_private_"+a;Object.defineProperty(GH.prototype,a,{get(){return this[e]},set(t){t!==this[e]&&(this[e]=t,this._needsSync=!0)}})});new Sa;new Gt;const gA=E.forwardRef(({sdfGlyphSize:a=64,anchorX:e="center",anchorY:t="middle",font:n,fontSize:i=1,children:s,characters:o,onSync:r,...g},u)=>{const C=qa(({invalidate:y})=>y),[h]=E.useState(()=>new GH),[f,p]=E.useMemo(()=>{const y=[];let v="";return E.Children.forEach(s,G=>{typeof G=="string"||typeof G=="number"?v+=G:y.push(G)}),[y,v]},[s]);return NM(()=>new Promise(y=>DD({font:n,characters:o},y)),["troika-text",n,o]),E.useLayoutEffect(()=>void h.sync(()=>{C(),r&&r(h)})),E.useEffect(()=>()=>h.dispose(),[h]),E.createElement("primitive",gi({object:h,ref:u,font:n,text:p,anchorX:e,anchorY:t,fontSize:i,sdfGlyphSize:a},g),f)});function rk(a,e,t,n){var i;return i=class extends Zl{constructor(s){super({vertexShader:e,fragmentShader:t,...s});for(const o in a)this.uniforms[o]=new Ly(a[o]),Object.defineProperty(this,o,{get(){return this.uniforms[o].value},set(r){this.uniforms[o].value=r}});this.uniforms=fy.clone(this.uniforms)}},i.key=OI.generateUUID(),i}let Sb=null,BH="https://www.gstatic.com/draco/versioned/decoders/1.5.5/";function vH(a=!0,e=!0,t){return n=>{t&&t(n),a&&(Sb||(Sb=new uD),Sb.setDecoderPath(typeof a=="string"?a:BH),n.setDRACOLoader(Sb)),e&&n.setMeshoptDecoder(typeof tv=="function"?tv():tv)}}const $t=(a,e,t,n)=>ep(XZ,a,vH(e,t,n));$t.preload=(a,e,t,n)=>ep.preload(XZ,a,vH(e,t,n));$t.clear=a=>ep.clear(XZ,a);$t.setDecoderPath=a=>{BH=a};function gk(a,e,t){const n=qa(f=>f.size),i=qa(f=>f.viewport),s=typeof a=="number"?a:n.width*i.dpr,o=n.height*i.dpr,r=(typeof a=="number"?t:a)||{},{samples:g=0,depth:u,...C}=r,h=E.useMemo(()=>{const f=new br(s,o,{minFilter:Bi,magFilter:Bi,type:dC,...C});return u&&(f.depthTexture=new Zy(s,o,qs)),f.samples=g,f},[]);return E.useLayoutEffect(()=>{h.setSize(s,o),g&&(h.samples=g)},[g,h,s,o]),E.useEffect(()=>()=>h.dispose(),[]),h}const ck=a=>typeof a=="function",uk=E.forwardRef(({envMap:a,resolution:e=256,frames:t=1/0,makeDefault:n,children:i,...s},o)=>{const r=qa(({set:G})=>G),g=qa(({camera:G})=>G),u=qa(({size:G})=>G),C=E.useRef(null);E.useImperativeHandle(o,()=>C.current,[]);const h=E.useRef(null),f=gk(e);E.useLayoutEffect(()=>{s.manual||(C.current.aspect=u.width/u.height)},[u,s]),E.useLayoutEffect(()=>{C.current.updateProjectionMatrix()});let p=0,y=null;const v=ck(i);return Wo(G=>{v&&(t===1/0||p<t)&&(h.current.visible=!1,G.gl.setRenderTarget(f),y=G.scene.background,a&&(G.scene.background=a),G.gl.render(G.scene,C.current),G.scene.background=y,G.gl.setRenderTarget(null),h.current.visible=!0,p++)}),E.useLayoutEffect(()=>{if(n){const G=g;return r(()=>({camera:C.current})),()=>r(()=>({camera:G}))}},[C,n,r]),E.createElement(E.Fragment,null,E.createElement("perspectiveCamera",gi({ref:C},s),!v&&i),E.createElement("group",{ref:h},v&&i(f.texture)))}),Ik=E.forwardRef(({makeDefault:a,camera:e,regress:t,domElement:n,enableDamping:i=!0,keyEvents:s=!1,onChange:o,onStart:r,onEnd:g,...u},C)=>{const h=qa(H=>H.invalidate),f=qa(H=>H.camera),p=qa(H=>H.gl),y=qa(H=>H.events),v=qa(H=>H.setEvents),G=qa(H=>H.set),B=qa(H=>H.get),R=qa(H=>H.performance),x=e||f,w=n||y.connected||p.domElement,M=E.useMemo(()=>new xU(x),[x]);return Wo(()=>{M.enabled&&M.update()},-1),E.useEffect(()=>(s&&M.connect(s===!0?w:s),M.connect(w),()=>void M.dispose()),[s,w,t,M,h]),E.useEffect(()=>{const H=Y=>{h(),t&&R.regress(),o&&o(Y)},N=Y=>{r&&r(Y)},F=Y=>{g&&g(Y)};return M.addEventListener("change",H),M.addEventListener("start",N),M.addEventListener("end",F),()=>{M.removeEventListener("start",N),M.removeEventListener("end",F),M.removeEventListener("change",H)}},[o,r,g,M,h,v]),E.useEffect(()=>{if(a){const H=B().controls;return G({controls:M}),()=>G({controls:H})}},[a,M]),E.createElement("primitive",gi({ref:C,object:M,enableDamping:i},u))}),X1=(a,e)=>{a.updateRanges[0]=e};function Ck(a){return typeof a=="function"}const N1=new Yt,Y1=new Yt,Rb=[],Jh=new vi;class dk extends dg{constructor(){super(),this.color=new Gt("white"),this.instance={current:void 0},this.instanceKey={current:void 0}}get geometry(){var e;return(e=this.instance.current)==null?void 0:e.geometry}raycast(e,t){const n=this.instance.current;if(!n||!n.geometry||!n.material)return;Jh.geometry=n.geometry;const i=n.matrixWorld,s=n.userData.instances.indexOf(this.instanceKey);if(!(s===-1||s>n.count)){n.getMatrixAt(s,N1),Y1.multiplyMatrices(i,N1),Jh.matrixWorld=Y1,n.material instanceof fa?Jh.material.side=n.material.side:Jh.material.side=n.material[0].side,Jh.raycast(e,Rb);for(let o=0,r=Rb.length;o<r;o++){const g=Rb[o];g.instanceId=s,g.object=this,t.push(g)}Rb.length=0}}}const ZH=E.createContext(null),K1=new Yt,F1=new Yt,Ak=new Yt,E1=new ae,T1=new ca,z1=new ae,hk=a=>a.isInstancedBufferAttribute,SH=E.forwardRef(({context:a,children:e,...t},n)=>{E.useMemo(()=>WZ({PositionMesh:dk}),[]);const i=E.useRef(null);E.useImperativeHandle(n,()=>i.current,[]);const{subscribe:s,getParent:o}=E.useContext(a||ZH);return E.useLayoutEffect(()=>s(i),[]),E.createElement("positionMesh",gi({instance:o(),instanceKey:i,ref:i},t),e)}),fk=E.forwardRef(({context:a,children:e,range:t,limit:n=1e3,frames:i=1/0,...s},o)=>{const[{localContext:r,instance:g}]=E.useState(()=>{const R=E.createContext(null);return{localContext:R,instance:E.forwardRef((x,w)=>E.createElement(SH,gi({context:R},x,{ref:w})))}}),u=E.useRef(null);E.useImperativeHandle(o,()=>u.current,[]);const[C,h]=E.useState([]),[[f,p]]=E.useState(()=>{const R=new Float32Array(n*16);for(let x=0;x<n;x++)Ak.identity().toArray(R,x*16);return[R,new Float32Array([...new Array(n*3)].map(()=>1))]});E.useEffect(()=>{u.current.instanceMatrix.needsUpdate=!0});let y=0,v=0;const G=E.useRef([]);E.useLayoutEffect(()=>{G.current=Object.entries(u.current.geometry.attributes).filter(([R,x])=>hk(x))}),Wo(()=>{if(i===1/0||y<i){u.current.updateMatrix(),u.current.updateMatrixWorld(),K1.copy(u.current.matrixWorld).invert(),v=Math.min(n,t!==void 0?t:n,C.length),u.current.count=v,X1(u.current.instanceMatrix,{start:0,count:v*16}),X1(u.current.instanceColor,{start:0,count:v*3});for(let R=0;R<C.length;R++){const x=C[R].current;x.matrixWorld.decompose(E1,T1,z1),F1.compose(E1,T1,z1).premultiply(K1),F1.toArray(f,R*16),u.current.instanceMatrix.needsUpdate=!0,x.color.toArray(p,R*3),u.current.instanceColor.needsUpdate=!0}y++}});const B=E.useMemo(()=>({getParent:()=>u,subscribe:R=>(h(x=>[...x,R]),()=>h(x=>x.filter(w=>w.current!==R.current)))}),[]);return E.createElement("instancedMesh",gi({userData:{instances:C,limit:n,frames:i},matrixAutoUpdate:!1,ref:u,args:[null,null,0],raycast:()=>null},s),E.createElement("instancedBufferAttribute",{attach:"instanceMatrix",args:[f,16],usage:H0}),E.createElement("instancedBufferAttribute",{attach:"instanceColor",args:[p,3],usage:H0}),Ck(e)?E.createElement(r.Provider,{value:B},e(g)):a?E.createElement(a.Provider,{value:B},e):E.createElement(ZH.Provider,{value:B},e))});var Oy=EW();const pk=CC(Oy);function mk(a,e){typeof a=="function"?a(e):a!=null&&(a.current=e)}function bk(...a){return e=>a.forEach(t=>mk(t,e))}const RH=E.forwardRef((a,e)=>{const{children:t,...n}=a,i=E.Children.toArray(t),s=i.find(Gk);if(s){const o=s.props.children,r=i.map(g=>g===s?E.Children.count(o)>1?E.Children.only(null):E.isValidElement(o)?o.props.children:null:g);return E.createElement(I2,gi({},n,{ref:e}),E.isValidElement(o)?E.cloneElement(o,void 0,r):null)}return E.createElement(I2,gi({},n,{ref:e}),t)});RH.displayName="Slot";const I2=E.forwardRef((a,e)=>{const{children:t,...n}=a;return E.isValidElement(t)?E.cloneElement(t,{...Bk(n,t.props),ref:bk(e,t.ref)}):E.Children.count(t)>1?E.Children.only(null):null});I2.displayName="SlotClone";const yk=({children:a})=>E.createElement(E.Fragment,null,a);function Gk(a){return E.isValidElement(a)&&a.type===yk}function Bk(a,e){const t={...e};for(const n in e){const i=a[n],s=e[n];/^on[A-Z]/.test(n)?i&&s?t[n]=(...r)=>{s(...r),i(...r)}:i&&(t[n]=i):n==="style"?t[n]={...i,...s}:n==="className"&&(t[n]=[i,s].filter(Boolean).join(" "))}return{...a,...t}}const vk=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","span","svg","ul"],Zk=vk.reduce((a,e)=>{const t=E.forwardRef((n,i)=>{const{asChild:s,...o}=n,r=s?RH:e;return E.useEffect(()=>{window[Symbol.for("radix-ui")]=!0},[]),E.createElement(r,gi({},o,{ref:i}))});return t.displayName=`Primitive.${e}`,{...a,[e]:t}},{}),Sk=E.forwardRef((a,e)=>{var t;const{container:n=globalThis==null||(t=globalThis.document)===null||t===void 0?void 0:t.body,...i}=a;return n?pk.createPortal(E.createElement(Zk.div,gi({},i,{ref:e})),n):null}),Rk=Sk;var L1=Object.prototype.hasOwnProperty;function Ff(a,e){var t,n;if(a===e)return!0;if(a&&e&&(t=a.constructor)===e.constructor){if(t===Date)return a.getTime()===e.getTime();if(t===RegExp)return a.toString()===e.toString();if(t===Array){if((n=a.length)===e.length)for(;n--&&Ff(a[n],e[n]););return n===-1}if(!t||typeof a=="object"){n=0;for(t in a)if(L1.call(a,t)&&++n&&!L1.call(e,t)||!(t in e)||!Ff(a[t],e[t]))return!1;return Object.keys(e).length===n}}return a!==a&&e!==e}function Jy(a,e){if(Object.is(a,e))return!0;if(typeof a!="object"||a===null||typeof e!="object"||e===null)return!1;const t=Object.keys(a);if(t.length!==Object.keys(e).length)return!1;for(let n=0;n<t.length;n++)if(!Object.prototype.hasOwnProperty.call(e,t[n])||!Object.is(a[t[n]],e[t[n]]))return!1;return!0}var Py=function(e,t,n,i){this.name=e,this.fn=t,this.args=n,this.modifiers=i};Py.prototype._test=function(e){var t=this.fn;try{Jd(this.modifiers.slice(),t,this)(e)}catch{t=function(){return!1}}try{return Jd(this.modifiers.slice(),t,this)(e)}catch{return!1}};Py.prototype._check=function(e){try{Jd(this.modifiers.slice(),this.fn,this)(e)}catch{if(Jd(this.modifiers.slice(),function(n){return n},this)(!1))return}if(!Jd(this.modifiers.slice(),this.fn,this)(e))throw null};Py.prototype._testAsync=function(e){var t=this;return new Promise(function(n,i){xH(t.modifiers.slice(),t.fn,t)(e).then(function(s){s?n(e):i(null)}).catch(function(s){return i(s)})})};function wH(a,e){return e===void 0&&(e="simple"),typeof a=="object"?a[e]:a}function Jd(a,e,t){if(a.length){var n=a.shift(),i=Jd(a,e,t);return n.perform(i,t)}else return wH(e)}function xH(a,e,t){if(a.length){var n=a.shift(),i=xH(a,e,t);return n.performAsync(i,t)}else return function(s){return Promise.resolve(wH(e,"async")(s))}}var wk=function(e,t,n){this.name=e,this.perform=t,this.performAsync=n},YZ=function(a){function e(t,n,i,s){for(var o=[],r=arguments.length-4;r-- >0;)o[r]=arguments[r+4];a.call(this,o),a.captureStackTrace&&a.captureStackTrace(this,e),this.rule=t,this.value=n,this.cause=i,this.target=s}return a&&(e.__proto__=a),e.prototype=Object.create(a&&a.prototype),e.prototype.constructor=e,e}(Error),pg=function(e,t){e===void 0&&(e=[]),t===void 0&&(t=[]),this.chain=e,this.nextRuleModifiers=t};pg.prototype._applyRule=function(e,t){var n=this;return function(){for(var i=[],s=arguments.length;s--;)i[s]=arguments[s];return n.chain.push(new Py(t,e.apply(n,i),i,n.nextRuleModifiers)),n.nextRuleModifiers=[],n}};pg.prototype._applyModifier=function(e,t){return this.nextRuleModifiers.push(new wk(t,e.simple,e.async)),this};pg.prototype._clone=function(){return new pg(this.chain.slice(),this.nextRuleModifiers.slice())};pg.prototype.test=function(e){return this.chain.every(function(t){return t._test(e)})};pg.prototype.testAll=function(e){var t=[];return this.chain.forEach(function(n){try{n._check(e)}catch(i){t.push(new YZ(n,e,i))}}),t};pg.prototype.check=function(e){this.chain.forEach(function(t){try{t._check(e)}catch(n){throw new YZ(t,e,n)}})};pg.prototype.testAsync=function(e){var t=this;return new Promise(function(n,i){WH(e,t.chain.slice(),n,i)})};function WH(a,e,t,n){if(e.length){var i=e.shift();i._testAsync(a).then(function(){WH(a,e,t,n)},function(s){n(new YZ(i,a,s))})}else t(a)}var _1=function(a,e){return e&&typeof a=="string"&&a.trim().length===0?!0:a==null};function xk(a,e){return e===void 0&&(e=!1),{simple:function(t){return _1(t,e)||a.check(t)===void 0},async:function(t){return _1(t,e)||a.testAsync(t)}}}function xo(){return typeof Proxy<"u"?VH(new pg):C2(new pg)}var Ef={};xo.extend=function(a){Object.assign(Ef,a)};xo.clearCustomRules=function(){Ef={}};function VH(a){return new Proxy(a,{get:function(t,n){if(n in t)return t[n];var i=VH(a._clone());if(n in U0)return i._applyModifier(U0[n],n);if(n in Ef)return i._applyRule(Ef[n],n);if(n in d2)return i._applyRule(d2[n],n)}})}function C2(a){var e=function(i,s){return Object.keys(i).forEach(function(o){s[o]=function(){for(var r=[],g=arguments.length;g--;)r[g]=arguments[g];var u=C2(s._clone()),C=u._applyRule(i[o],o).apply(void 0,r);return C}}),s},t=e(d2,a),n=e(Ef,t);return Object.keys(U0).forEach(function(i){Object.defineProperty(n,i,{get:function(){var s=C2(n._clone());return s._applyModifier(U0[i],i)}})}),n}var U0={not:{simple:function(a){return function(e){return!a(e)}},async:function(a){return function(e){return Promise.resolve(a(e)).then(function(t){return!t}).catch(function(){return!0})}}},some:{simple:function(a){return function(e){return wb(e).some(function(t){try{return a(t)}catch{return!1}})}},async:function(a){return function(e){return Promise.all(wb(e).map(function(t){try{return a(t).catch(function(){return!1})}catch{return!1}})).then(function(t){return t.some(Boolean)})}}},every:{simple:function(a){return function(e){return e!==!1&&wb(e).every(a)}},async:function(a){return function(e){return Promise.all(wb(e).map(a)).then(function(t){return t.every(Boolean)})}}},strict:{simple:function(a,e){return function(t){return U1(e)&&t&&typeof t=="object"?Object.keys(e.args[0]).length===Object.keys(t).length&&a(t):a(t)}},async:function(a,e){return function(t){return Promise.resolve(a(t)).then(function(n){return U1(e)&&t&&typeof t=="object"?Object.keys(e.args[0]).length===Object.keys(t).length&&n:n}).catch(function(){return!1})}}}};function U1(a){return a&&a.name==="schema"&&a.args.length>0&&typeof a.args[0]=="object"}function wb(a){return typeof a=="string"?a.split(""):a}var d2={equal:function(a){return function(e){return e==a}},exact:function(a){return function(e){return e===a}},number:function(a){return a===void 0&&(a=!0),function(e){return typeof e=="number"&&(a||isFinite(e))}},integer:function(){return function(a){var e=Number.isInteger||Wk;return e(a)}},numeric:function(){return function(a){return!isNaN(parseFloat(a))&&isFinite(a)}},string:function(){return Ed("string")},boolean:function(){return Ed("boolean")},undefined:function(){return Ed("undefined")},null:function(){return Ed("null")},array:function(){return Ed("array")},object:function(){return Ed("object")},instanceOf:function(a){return function(e){return e instanceof a}},pattern:function(a){return function(e){return a.test(e)}},lowercase:function(){return function(a){return typeof a=="boolean"||a===a.toLowerCase()&&a.trim()!==""}},uppercase:function(){return function(a){return a===a.toUpperCase()&&a.trim()!==""}},vowel:function(){return function(a){return/^[aeiou]+$/i.test(a)}},consonant:function(){return function(a){return/^(?=[^aeiou])([a-z]+)$/i.test(a)}},first:function(a){return function(e){return e[0]==a}},last:function(a){return function(e){return e[e.length-1]==a}},empty:function(){return function(a){return a.length===0}},length:function(a,e){return function(t){return t.length>=a&&t.length<=(e||a)}},minLength:function(a){return function(e){return e.length>=a}},maxLength:function(a){return function(e){return e.length<=a}},negative:function(){return function(a){return a<0}},positive:function(){return function(a){return a>=0}},between:function(a,e){return function(t){return t>=a&&t<=e}},range:function(a,e){return function(t){return t>=a&&t<=e}},lessThan:function(a){return function(e){return e<a}},lessThanOrEqual:function(a){return function(e){return e<=a}},greaterThan:function(a){return function(e){return e>a}},greaterThanOrEqual:function(a){return function(e){return e>=a}},even:function(){return function(a){return a%2===0}},odd:function(){return function(a){return a%2!==0}},includes:function(a){return function(e){return~e.indexOf(a)}},schema:function(a){return Vk(a)},passesAnyOf:function(){for(var a=[],e=arguments.length;e--;)a[e]=arguments[e];return function(t){return a.some(function(n){return n.test(t)})}},optional:xk};function Ed(a){return function(e){return Array.isArray(e)&&a==="array"||e===null&&a==="null"||typeof e===a}}function Wk(a){return typeof a=="number"&&isFinite(a)&&Math.floor(a)===a}function Vk(a){return{simple:function(e){var t=[];if(Object.keys(a).forEach(function(n){var i=a[n];try{i.check((e||{})[n])}catch(s){s.target=n,t.push(s)}}),t.length>0)throw t;return!0},async:function(e){var t=[],n=Object.keys(a).map(function(i){var s=a[i];return s.testAsync((e||{})[i]).catch(function(o){o.target=i,t.push(o)})});return Promise.all(n).then(function(){if(t.length>0)throw t;return!0})}}}var li="colors",Ds="sizes",Vt="space",Mk={gap:Vt,gridGap:Vt,columnGap:Vt,gridColumnGap:Vt,rowGap:Vt,gridRowGap:Vt,inset:Vt,insetBlock:Vt,insetBlockEnd:Vt,insetBlockStart:Vt,insetInline:Vt,insetInlineEnd:Vt,insetInlineStart:Vt,margin:Vt,marginTop:Vt,marginRight:Vt,marginBottom:Vt,marginLeft:Vt,marginBlock:Vt,marginBlockEnd:Vt,marginBlockStart:Vt,marginInline:Vt,marginInlineEnd:Vt,marginInlineStart:Vt,padding:Vt,paddingTop:Vt,paddingRight:Vt,paddingBottom:Vt,paddingLeft:Vt,paddingBlock:Vt,paddingBlockEnd:Vt,paddingBlockStart:Vt,paddingInline:Vt,paddingInlineEnd:Vt,paddingInlineStart:Vt,top:Vt,right:Vt,bottom:Vt,left:Vt,scrollMargin:Vt,scrollMarginTop:Vt,scrollMarginRight:Vt,scrollMarginBottom:Vt,scrollMarginLeft:Vt,scrollMarginX:Vt,scrollMarginY:Vt,scrollMarginBlock:Vt,scrollMarginBlockEnd:Vt,scrollMarginBlockStart:Vt,scrollMarginInline:Vt,scrollMarginInlineEnd:Vt,scrollMarginInlineStart:Vt,scrollPadding:Vt,scrollPaddingTop:Vt,scrollPaddingRight:Vt,scrollPaddingBottom:Vt,scrollPaddingLeft:Vt,scrollPaddingX:Vt,scrollPaddingY:Vt,scrollPaddingBlock:Vt,scrollPaddingBlockEnd:Vt,scrollPaddingBlockStart:Vt,scrollPaddingInline:Vt,scrollPaddingInlineEnd:Vt,scrollPaddingInlineStart:Vt,fontSize:"fontSizes",background:li,backgroundColor:li,backgroundImage:li,borderImage:li,border:li,borderBlock:li,borderBlockEnd:li,borderBlockStart:li,borderBottom:li,borderBottomColor:li,borderColor:li,borderInline:li,borderInlineEnd:li,borderInlineStart:li,borderLeft:li,borderLeftColor:li,borderRight:li,borderRightColor:li,borderTop:li,borderTopColor:li,caretColor:li,color:li,columnRuleColor:li,fill:li,outline:li,outlineColor:li,stroke:li,textDecorationColor:li,fontFamily:"fonts",fontWeight:"fontWeights",lineHeight:"lineHeights",letterSpacing:"letterSpacings",blockSize:Ds,minBlockSize:Ds,maxBlockSize:Ds,inlineSize:Ds,minInlineSize:Ds,maxInlineSize:Ds,width:Ds,minWidth:Ds,maxWidth:Ds,height:Ds,minHeight:Ds,maxHeight:Ds,flexBasis:Ds,gridTemplateColumns:Ds,gridTemplateRows:Ds,borderWidth:"borderWidths",borderTopWidth:"borderWidths",borderRightWidth:"borderWidths",borderBottomWidth:"borderWidths",borderLeftWidth:"borderWidths",borderStyle:"borderStyles",borderTopStyle:"borderStyles",borderRightStyle:"borderStyles",borderBottomStyle:"borderStyles",borderLeftStyle:"borderStyles",borderRadius:"radii",borderTopLeftRadius:"radii",borderTopRightRadius:"radii",borderBottomRightRadius:"radii",borderBottomLeftRadius:"radii",boxShadow:"shadows",textShadow:"shadows",transition:"transitions",zIndex:"zIndices"},Hk=(a,e)=>typeof e=="function"?{"()":Function.prototype.toString.call(e)}:e,pA=()=>{const a=Object.create(null);return(e,t,...n)=>{const i=(s=>JSON.stringify(s,Hk))(e);return i in a?a[i]:a[i]=t(e,...n)}},iC=Symbol.for("sxs.internal"),KZ=(a,e)=>Object.defineProperties(a,Object.getOwnPropertyDescriptors(e)),D1=a=>{for(const e in a)return!0;return!1},{hasOwnProperty:Xk}=Object.prototype,A2=a=>a.includes("-")?a:a.replace(/[A-Z]/g,e=>"-"+e.toLowerCase()),Nk=/\s+(?![^()]*\))/,Td=a=>e=>a(...typeof e=="string"?String(e).split(Nk):[e]),k1={appearance:a=>({WebkitAppearance:a,appearance:a}),backfaceVisibility:a=>({WebkitBackfaceVisibility:a,backfaceVisibility:a}),backdropFilter:a=>({WebkitBackdropFilter:a,backdropFilter:a}),backgroundClip:a=>({WebkitBackgroundClip:a,backgroundClip:a}),boxDecorationBreak:a=>({WebkitBoxDecorationBreak:a,boxDecorationBreak:a}),clipPath:a=>({WebkitClipPath:a,clipPath:a}),content:a=>({content:a.includes('"')||a.includes("'")||/^([A-Za-z]+\([^]*|[^]*-quote|inherit|initial|none|normal|revert|unset)$/.test(a)?a:`"${a}"`}),hyphens:a=>({WebkitHyphens:a,hyphens:a}),maskImage:a=>({WebkitMaskImage:a,maskImage:a}),maskSize:a=>({WebkitMaskSize:a,maskSize:a}),tabSize:a=>({MozTabSize:a,tabSize:a}),textSizeAdjust:a=>({WebkitTextSizeAdjust:a,textSizeAdjust:a}),userSelect:a=>({WebkitUserSelect:a,userSelect:a}),marginBlock:Td((a,e)=>({marginBlockStart:a,marginBlockEnd:e||a})),marginInline:Td((a,e)=>({marginInlineStart:a,marginInlineEnd:e||a})),maxSize:Td((a,e)=>({maxBlockSize:a,maxInlineSize:e||a})),minSize:Td((a,e)=>({minBlockSize:a,minInlineSize:e||a})),paddingBlock:Td((a,e)=>({paddingBlockStart:a,paddingBlockEnd:e||a})),paddingInline:Td((a,e)=>({paddingInlineStart:a,paddingInlineEnd:e||a}))},sv=/([\d.]+)([^]*)/,Yk=(a,e)=>a.length?a.reduce((t,n)=>(t.push(...e.map(i=>i.includes("&")?i.replace(/&/g,/[ +>|~]/.test(n)&&/&.*&/.test(i)?`:is(${n})`:n):n+" "+i)),t),[]):e,Kk=(a,e)=>a in Fk&&typeof e=="string"?e.replace(/^((?:[^]*[^\w-])?)(fit-content|stretch)((?:[^\w-][^]*)?)$/,(t,n,i,s)=>n+(i==="stretch"?`-moz-available${s};${A2(a)}:${n}-webkit-fill-available`:`-moz-fit-content${s};${A2(a)}:${n}fit-content`)+s):String(e),Fk={blockSize:1,height:1,inlineSize:1,maxBlockSize:1,maxHeight:1,maxInlineSize:1,maxWidth:1,minBlockSize:1,minHeight:1,minInlineSize:1,minWidth:1,width:1},mc=a=>a?a+"-":"",MH=(a,e,t)=>a.replace(/([+-])?((?:\d+(?:\.\d*)?|\.\d+)(?:[Ee][+-]?\d+)?)?(\$|--)([$\w-]+)/g,(n,i,s,o,r)=>o=="$"==!!s?n:(i||o=="--"?"calc(":"")+"var(--"+(o==="$"?mc(e)+(r.includes("$")?"":mc(t))+r.replace(/\$/g,"-"):r)+")"+(i||o=="--"?"*"+(i||"")+(s||"1")+")":"")),Ek=/\s*,\s*(?![^()]*\))/,Tk=Object.prototype.toString,_d=(a,e,t,n,i)=>{let s,o,r;const g=(u,C,h)=>{let f,p;const y=v=>{for(f in v){const R=f.charCodeAt(0)===64,x=R&&Array.isArray(v[f])?v[f]:[v[f]];for(p of x){const w=/[A-Z]/.test(B=f)?B:B.replace(/-[^]/g,H=>H[1].toUpperCase()),M=typeof p=="object"&&p&&p.toString===Tk&&(!n.utils[w]||!C.length);if(w in n.utils&&!M){const H=n.utils[w];if(H!==o){o=H,y(H(p)),o=null;continue}}else if(w in k1){const H=k1[w];if(H!==r){r=H,y(H(p)),r=null;continue}}if(R&&(G=f.slice(1)in n.media?"@media "+n.media[f.slice(1)]:f,f=G.replace(/\(\s*([\w-]+)\s*(=|<|<=|>|>=)\s*([\w-]+)\s*(?:(<|<=|>|>=)\s*([\w-]+)\s*)?\)/g,(H,N,F,Y,X,U)=>{const O=sv.test(N),P=.0625*(O?-1:1),[ie,le]=O?[Y,N]:[N,Y];return"("+(F[0]==="="?"":F[0]===">"===O?"max-":"min-")+ie+":"+(F[0]!=="="&&F.length===1?le.replace(sv,(T,J,Q)=>Number(J)+P*(F===">"?1:-1)+Q):le)+(X?") and ("+(X[0]===">"?"min-":"max-")+ie+":"+(X.length===1?U.replace(sv,(T,J,Q)=>Number(J)+P*(X===">"?-1:1)+Q):U):"")+")"})),M){const H=R?h.concat(f):[...h],N=R?[...C]:Yk(C,f.split(Ek));s!==void 0&&i(O1(...s)),s=void 0,g(p,N,H)}else s===void 0&&(s=[[],C,h]),f=R||f.charCodeAt(0)!==36?f:`--${mc(n.prefix)}${f.slice(1).replace(/\$/g,"-")}`,p=M?p:typeof p=="number"?p&&w in zk?String(p)+"px":String(p):MH(Kk(w,p??""),n.prefix,n.themeMap[w]),s[0].push(`${R?`${f} `:`${A2(f)}:`}${p}`)}}var G,B};y(u),s!==void 0&&i(O1(...s)),s=void 0};g(a,e,t)},O1=(a,e,t)=>`${t.map(n=>`${n}{`).join("")}${e.length?`${e.join(",")}{`:""}${a.join(";")}${e.length?"}":""}${Array(t.length?t.length+1:0).join("}")}`,zk={animationDelay:1,animationDuration:1,backgroundSize:1,blockSize:1,border:1,borderBlock:1,borderBlockEnd:1,borderBlockEndWidth:1,borderBlockStart:1,borderBlockStartWidth:1,borderBlockWidth:1,borderBottom:1,borderBottomLeftRadius:1,borderBottomRightRadius:1,borderBottomWidth:1,borderEndEndRadius:1,borderEndStartRadius:1,borderInlineEnd:1,borderInlineEndWidth:1,borderInlineStart:1,borderInlineStartWidth:1,borderInlineWidth:1,borderLeft:1,borderLeftWidth:1,borderRadius:1,borderRight:1,borderRightWidth:1,borderSpacing:1,borderStartEndRadius:1,borderStartStartRadius:1,borderTop:1,borderTopLeftRadius:1,borderTopRightRadius:1,borderTopWidth:1,borderWidth:1,bottom:1,columnGap:1,columnRule:1,columnRuleWidth:1,columnWidth:1,containIntrinsicSize:1,flexBasis:1,fontSize:1,gap:1,gridAutoColumns:1,gridAutoRows:1,gridTemplateColumns:1,gridTemplateRows:1,height:1,inlineSize:1,inset:1,insetBlock:1,insetBlockEnd:1,insetBlockStart:1,insetInline:1,insetInlineEnd:1,insetInlineStart:1,left:1,letterSpacing:1,margin:1,marginBlock:1,marginBlockEnd:1,marginBlockStart:1,marginBottom:1,marginInline:1,marginInlineEnd:1,marginInlineStart:1,marginLeft:1,marginRight:1,marginTop:1,maxBlockSize:1,maxHeight:1,maxInlineSize:1,maxWidth:1,minBlockSize:1,minHeight:1,minInlineSize:1,minWidth:1,offsetDistance:1,offsetRotate:1,outline:1,outlineOffset:1,outlineWidth:1,overflowClipMargin:1,padding:1,paddingBlock:1,paddingBlockEnd:1,paddingBlockStart:1,paddingBottom:1,paddingInline:1,paddingInlineEnd:1,paddingInlineStart:1,paddingLeft:1,paddingRight:1,paddingTop:1,perspective:1,right:1,rowGap:1,scrollMargin:1,scrollMarginBlock:1,scrollMarginBlockEnd:1,scrollMarginBlockStart:1,scrollMarginBottom:1,scrollMarginInline:1,scrollMarginInlineEnd:1,scrollMarginInlineStart:1,scrollMarginLeft:1,scrollMarginRight:1,scrollMarginTop:1,scrollPadding:1,scrollPaddingBlock:1,scrollPaddingBlockEnd:1,scrollPaddingBlockStart:1,scrollPaddingBottom:1,scrollPaddingInline:1,scrollPaddingInlineEnd:1,scrollPaddingInlineStart:1,scrollPaddingLeft:1,scrollPaddingRight:1,scrollPaddingTop:1,shapeMargin:1,textDecoration:1,textDecorationThickness:1,textIndent:1,textUnderlineOffset:1,top:1,transitionDelay:1,transitionDuration:1,verticalAlign:1,width:1,wordSpacing:1},J1=a=>String.fromCharCode(a+(a>25?39:97)),aC=a=>(e=>{let t,n="";for(t=Math.abs(e);t>52;t=t/52|0)n=J1(t%52)+n;return J1(t%52)+n})(((e,t)=>{let n=t.length;for(;n;)e=33*e^t.charCodeAt(--n);return e})(5381,JSON.stringify(a))>>>0),rf=["themed","global","styled","onevar","resonevar","allvar","inline"],Lk=a=>{if(a.href&&!a.href.startsWith(location.origin))return!1;try{return!!a.cssRules}catch{return!1}},_k=a=>{let e;const t=()=>{const{cssRules:i}=e.sheet;return[].map.call(i,(s,o)=>{const{cssText:r}=s;let g="";if(r.startsWith("--sxs"))return"";if(i[o-1]&&(g=i[o-1].cssText).startsWith("--sxs")){if(!s.cssRules.length)return"";for(const u in e.rules)if(e.rules[u].group===s)return`--sxs{--sxs:${[...e.rules[u].cache].join(" ")}}${r}`;return s.cssRules.length?`${g}${r}`:""}return r}).join("")},n=()=>{if(e){const{rules:r,sheet:g}=e;if(!g.deleteRule){for(;Object(Object(g.cssRules)[0]).type===3;)g.cssRules.splice(0,1);g.cssRules=[]}for(const u in r)delete r[u]}const i=Object(a).styleSheets||[];for(const r of i)if(Lk(r)){for(let g=0,u=r.cssRules;u[g];++g){const C=Object(u[g]);if(C.type!==1)continue;const h=Object(u[g+1]);if(h.type!==4)continue;++g;const{cssText:f}=C;if(!f.startsWith("--sxs"))continue;const p=f.slice(14,-3).trim().split(/\s+/),y=rf[p[0]];y&&(e||(e={sheet:r,reset:n,rules:{},toString:t}),e.rules[y]={group:h,index:g,cache:new Set(p)})}if(e)break}if(!e){const r=(g,u)=>({type:u,cssRules:[],insertRule(C,h){this.cssRules.splice(h,0,r(C,{import:3,undefined:1}[(C.toLowerCase().match(/^@([a-z]+)/)||[])[1]]||4))},get cssText(){return g==="@media{}"?`@media{${[].map.call(this.cssRules,C=>C.cssText).join("")}}`:g}});e={sheet:a?(a.head||a).appendChild(document.createElement("style")).sheet:r("","text/css"),rules:{},reset:n,toString:t}}const{sheet:s,rules:o}=e;for(let r=rf.length-1;r>=0;--r){const g=rf[r];if(!o[g]){const u=rf[r+1],C=o[u]?o[u].index:s.cssRules.length;s.insertRule("@media{}",C),s.insertRule(`--sxs{--sxs:${r}}`,C),o[g]={group:s.cssRules[C+1],index:C,cache:new Set([r])}}Uk(o[g])}};return n(),e},Uk=a=>{const e=a.group;let t=e.cssRules.length;a.apply=n=>{try{e.insertRule(n,t),++t}catch{}}},Ph=Symbol(),Dk=pA(),P1=(a,e)=>Dk(a,()=>(...t)=>{let n={type:null,composers:new Set};for(const i of t)if(i!=null)if(i[iC]){n.type==null&&(n.type=i[iC].type);for(const s of i[iC].composers)n.composers.add(s)}else i.constructor!==Object||i.$$typeof?n.type==null&&(n.type=i):n.composers.add(kk(i,a));return n.type==null&&(n.type="span"),n.composers.size||n.composers.add(["PJLV",{},[],[],{},[]]),Ok(a,n,e)}),kk=({variants:a,compoundVariants:e,defaultVariants:t,...n},i)=>{const s=`${mc(i.prefix)}c-${aC(n)}`,o=[],r=[],g=Object.create(null),u=[];for(const f in t)g[f]=String(t[f]);if(typeof a=="object"&&a)for(const f in a){C=g,h=f,Xk.call(C,h)||(g[f]="undefined");const p=a[f];for(const y in p){const v={[f]:String(y)};String(y)==="undefined"&&u.push(f);const G=p[y],B=[v,G,!D1(G)];o.push(B)}}var C,h;if(typeof e=="object"&&e)for(const f of e){let{css:p,...y}=f;p=typeof p=="object"&&p||{};for(const G in y)y[G]=String(y[G]);const v=[y,p,!D1(p)];r.push(v)}return[s,n,o,r,g,u]},Ok=(a,e,t)=>{const[n,i,s,o]=Jk(e.composers),r=typeof e.type=="function"||e.type.$$typeof?(h=>{function f(){for(let p=0;p<f[Ph].length;p++){const[y,v]=f[Ph][p];h.rules[y].apply(v)}return f[Ph]=[],null}return f[Ph]=[],f.rules={},rf.forEach(p=>f.rules[p]={apply:y=>f[Ph].push([p,y])}),f})(t):null,g=(r||t).rules,u=`.${n}${i.length>1?`:where(.${i.slice(1).join(".")})`:""}`,C=h=>{h=typeof h=="object"&&h||Pk;const{css:f,...p}=h,y={};for(const B in s)if(delete p[B],B in h){let R=h[B];typeof R=="object"&&R?y[B]={"@initial":s[B],...R}:(R=String(R),y[B]=R!=="undefined"||o.has(B)?R:s[B])}else y[B]=s[B];const v=new Set([...i]);for(const[B,R,x,w]of e.composers){t.rules.styled.cache.has(B)||(t.rules.styled.cache.add(B),_d(R,[`.${B}`],[],a,N=>{g.styled.apply(N)}));const M=Q1(x,y,a.media),H=Q1(w,y,a.media,!0);for(const N of M)if(N!==void 0)for(const[F,Y,X]of N){const U=`${B}-${aC(Y)}-${F}`;v.add(U);const O=(X?t.rules.resonevar:t.rules.onevar).cache,P=X?g.resonevar:g.onevar;O.has(U)||(O.add(U),_d(Y,[`.${U}`],[],a,ie=>{P.apply(ie)}))}for(const N of H)if(N!==void 0)for(const[F,Y]of N){const X=`${B}-${aC(Y)}-${F}`;v.add(X),t.rules.allvar.cache.has(X)||(t.rules.allvar.cache.add(X),_d(Y,[`.${X}`],[],a,U=>{g.allvar.apply(U)}))}}if(typeof f=="object"&&f){const B=`${n}-i${aC(f)}-css`;v.add(B),t.rules.inline.cache.has(B)||(t.rules.inline.cache.add(B),_d(f,[`.${B}`],[],a,R=>{g.inline.apply(R)}))}for(const B of String(h.className||"").trim().split(/\s+/))B&&v.add(B);const G=p.className=[...v].join(" ");return{type:e.type,className:G,selector:u,props:p,toString:()=>G,deferredInjector:r}};return KZ(C,{className:n,selector:u,[iC]:e,toString:()=>(t.rules.styled.cache.has(n)||C(),n)})},Jk=a=>{let e="";const t=[],n={},i=[];for(const[s,,,,o,r]of a){e===""&&(e=s),t.push(s),i.push(...r);for(const g in o){const u=o[g];(n[g]===void 0||u!=="undefined"||r.includes(u))&&(n[g]=u)}}return[e,t,n,new Set(i)]},Q1=(a,e,t,n)=>{const i=[];e:for(let[s,o,r]of a){if(r)continue;let g,u=0,C=!1;for(g in s){const h=s[g];let f=e[g];if(f!==h){if(typeof f!="object"||!f)continue e;{let p,y,v=0;for(const G in f){if(h===String(f[G])){if(G!=="@initial"){const B=G.slice(1);(y=y||[]).push(B in t?t[B]:G.replace(/^@media ?/,"")),C=!0}u+=v,p=!0}++v}if(y&&y.length&&(o={["@media "+y.join(", ")]:o}),!p)continue e}}}(i[u]=i[u]||[]).push([n?"cv":`${g}-${s[g]}`,o,C])}return i},Pk={},Qk=pA(),jk=(a,e)=>Qk(a,()=>(...t)=>{const n=()=>{for(let i of t){i=typeof i=="object"&&i||{};let s=aC(i);if(!e.rules.global.cache.has(s)){if(e.rules.global.cache.add(s),"@import"in i){let o=[].indexOf.call(e.sheet.cssRules,e.rules.themed.group)-1;for(let r of[].concat(i["@import"]))r=r.includes('"')||r.includes("'")?r:`"${r}"`,e.sheet.insertRule(`@import ${r};`,o++);delete i["@import"]}_d(i,[],[],a,o=>{e.rules.global.apply(o)})}}return""};return KZ(n,{toString:n})}),qk=pA(),$k=(a,e)=>qk(a,()=>t=>{const n=`${mc(a.prefix)}k-${aC(t)}`,i=()=>{if(!e.rules.global.cache.has(n)){e.rules.global.cache.add(n);const s=[];_d(t,[],[],a,r=>s.push(r));const o=`@keyframes ${n}{${s.join("")}}`;e.rules.global.apply(o)}return n};return KZ(i,{get name(){return i()},toString:i})}),eO=class{constructor(a,e,t,n){this.token=a==null?"":String(a),this.value=e==null?"":String(e),this.scale=t==null?"":String(t),this.prefix=n==null?"":String(n)}get computedValue(){return"var("+this.variable+")"}get variable(){return"--"+mc(this.prefix)+mc(this.scale)+this.token}toString(){return this.computedValue}},tO=pA(),nO=(a,e)=>tO(a,()=>(t,n)=>{n=typeof t=="object"&&t||Object(n);const i=`.${t=(t=typeof t=="string"?t:"")||`${mc(a.prefix)}t-${aC(n)}`}`,s={},o=[];for(const g in n){s[g]={};for(const u in n[g]){const C=`--${mc(a.prefix)}${g}-${u}`,h=MH(String(n[g][u]),a.prefix,g);s[g][u]=new eO(u,h,g,a.prefix),o.push(`${C}:${h}`)}}const r=()=>{if(o.length&&!e.rules.themed.cache.has(t)){e.rules.themed.cache.add(t);const g=`${n===a.theme?":root,":""}.${t}{${o.join(";")}}`;e.rules.themed.apply(g)}return t};return{...s,get className(){return r()},selector:i,toString:r}}),iO=pA(),aO=pA(),sO=a=>{const e=(t=>{let n=!1;const i=iO(t,s=>{n=!0;const o="prefix"in(s=typeof s=="object"&&s||{})?String(s.prefix):"",r=typeof s.media=="object"&&s.media||{},g=typeof s.root=="object"?s.root||null:globalThis.document||null,u=typeof s.theme=="object"&&s.theme||{},C={prefix:o,media:r,theme:u,themeMap:typeof s.themeMap=="object"&&s.themeMap||{...Mk},utils:typeof s.utils=="object"&&s.utils||{}},h=_k(g),f={css:P1(C,h),globalCss:jk(C,h),keyframes:$k(C,h),createTheme:nO(C,h),reset(){h.reset(),f.theme.toString()},theme:{},sheet:h,config:C,prefix:o,getCssText:h.toString,toString:h.toString};return String(f.theme=f.createTheme(u)),f});return n||i.reset(),i})(a);return e.styled=(({config:t,sheet:n})=>aO(t,()=>{const i=P1(t,n);return(...s)=>{const o=i(...s),r=o[iC].type,g=fe.forwardRef((u,C)=>{const h=u&&u.as||r,{props:f,deferredInjector:p}=o(u);return delete f.as,f.ref=C,p?fe.createElement(fe.Fragment,null,fe.createElement(h,f),fe.createElement(p,null)):fe.createElement(h,f)});return g.className=o.className,g.displayName=`Styled.${r.displayName||r.name||r}`,g.selector=o.selector,g.toString=()=>o.selector,g[iC]=o[iC],g}}))(e),e};function ic(a,e,{checkForDefaultPrevented:t=!0}={}){return function(i){if(a?.(i),t===!1||!i.defaultPrevented)return e?.(i)}}function oO(a,e){typeof a=="function"?a(e):a!=null&&(a.current=e)}function HH(...a){return e=>a.forEach(t=>oO(t,e))}function mA(...a){return E.useCallback(HH(...a),a)}function XH(a,e=[]){let t=[];function n(s,o){const r=E.createContext(o),g=t.length;t=[...t,o];function u(h){const{scope:f,children:p,...y}=h,v=f?.[a][g]||r,G=E.useMemo(()=>y,Object.values(y));return E.createElement(v.Provider,{value:G},p)}function C(h,f){const p=f?.[a][g]||r,y=E.useContext(p);if(y)return y;if(o!==void 0)return o;throw new Error(`\`${h}\` must be used within \`${s}\``)}return u.displayName=s+"Provider",[u,C]}const i=()=>{const s=t.map(o=>E.createContext(o));return function(r){const g=r?.[a]||s;return E.useMemo(()=>({[`__scope${a}`]:{...r,[a]:g}}),[r,g])}};return i.scopeName=a,[n,lO(i,...e)]}function lO(...a){const e=a[0];if(a.length===1)return e;const t=()=>{const n=a.map(i=>({useScope:i(),scopeName:i.scopeName}));return function(s){const o=n.reduce((r,{useScope:g,scopeName:u})=>{const h=g(s)[`__scope${u}`];return{...r,...h}},{});return E.useMemo(()=>({[`__scope${e.scopeName}`]:o}),[o])}};return t.scopeName=e.scopeName,t}const NH=E.forwardRef((a,e)=>{const{children:t,...n}=a,i=E.Children.toArray(t),s=i.find(rO);if(s){const o=s.props.children,r=i.map(g=>g===s?E.Children.count(o)>1?E.Children.only(null):E.isValidElement(o)?o.props.children:null:g);return E.createElement(h2,gi({},n,{ref:e}),E.isValidElement(o)?E.cloneElement(o,void 0,r):null)}return E.createElement(h2,gi({},n,{ref:e}),t)});NH.displayName="Slot";const h2=E.forwardRef((a,e)=>{const{children:t,...n}=a;return E.isValidElement(t)?E.cloneElement(t,{...gO(n,t.props),ref:HH(e,t.ref)}):E.Children.count(t)>1?E.Children.only(null):null});h2.displayName="SlotClone";const YH=({children:a})=>E.createElement(E.Fragment,null,a);function rO(a){return E.isValidElement(a)&&a.type===YH}function gO(a,e){const t={...e};for(const n in e){const i=a[n],s=e[n];/^on[A-Z]/.test(n)?i&&s?t[n]=(...r)=>{s(...r),i(...r)}:i&&(t[n]=i):n==="style"?t[n]={...i,...s}:n==="className"&&(t[n]=[i,s].filter(Boolean).join(" "))}return{...a,...t}}const cO=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","span","svg","ul"],uC=cO.reduce((a,e)=>{const t=E.forwardRef((n,i)=>{const{asChild:s,...o}=n,r=s?NH:e;return E.useEffect(()=>{window[Symbol.for("radix-ui")]=!0},[]),E.createElement(r,gi({},o,{ref:i}))});return t.displayName=`Primitive.${e}`,{...a,[e]:t}},{});function uO(a,e){a&&Oy.flushSync(()=>a.dispatchEvent(e))}function FZ(a){const e=E.useRef(a);return E.useEffect(()=>{e.current=a}),E.useMemo(()=>(...t)=>{var n;return(n=e.current)===null||n===void 0?void 0:n.call(e,...t)},[])}function IO(a,e=globalThis?.document){const t=FZ(a);E.useEffect(()=>{const n=i=>{i.key==="Escape"&&t(i)};return e.addEventListener("keydown",n),()=>e.removeEventListener("keydown",n)},[t,e])}const f2="dismissableLayer.update",CO="dismissableLayer.pointerDownOutside",dO="dismissableLayer.focusOutside";let j1;const AO=E.createContext({layers:new Set,layersWithOutsidePointerEventsDisabled:new Set,branches:new Set}),hO=E.forwardRef((a,e)=>{var t;const{disableOutsidePointerEvents:n=!1,onEscapeKeyDown:i,onPointerDownOutside:s,onFocusOutside:o,onInteractOutside:r,onDismiss:g,...u}=a,C=E.useContext(AO),[h,f]=E.useState(null),p=(t=h?.ownerDocument)!==null&&t!==void 0?t:globalThis?.document,[,y]=E.useState({}),v=mA(e,F=>f(F)),G=Array.from(C.layers),[B]=[...C.layersWithOutsidePointerEventsDisabled].slice(-1),R=G.indexOf(B),x=h?G.indexOf(h):-1,w=C.layersWithOutsidePointerEventsDisabled.size>0,M=x>=R,H=fO(F=>{const Y=F.target,X=[...C.branches].some(U=>U.contains(Y));!M||X||(s?.(F),r?.(F),F.defaultPrevented||g?.())},p),N=pO(F=>{const Y=F.target;[...C.branches].some(U=>U.contains(Y))||(o?.(F),r?.(F),F.defaultPrevented||g?.())},p);return IO(F=>{x===C.layers.size-1&&(i?.(F),!F.defaultPrevented&&g&&(F.preventDefault(),g()))},p),E.useEffect(()=>{if(h)return n&&(C.layersWithOutsidePointerEventsDisabled.size===0&&(j1=p.body.style.pointerEvents,p.body.style.pointerEvents="none"),C.layersWithOutsidePointerEventsDisabled.add(h)),C.layers.add(h),q1(),()=>{n&&C.layersWithOutsidePointerEventsDisabled.size===1&&(p.body.style.pointerEvents=j1)}},[h,p,n,C]),E.useEffect(()=>()=>{h&&(C.layers.delete(h),C.layersWithOutsidePointerEventsDisabled.delete(h),q1())},[h,C]),E.useEffect(()=>{const F=()=>y({});return document.addEventListener(f2,F),()=>document.removeEventListener(f2,F)},[]),E.createElement(uC.div,gi({},u,{ref:v,style:{pointerEvents:w?M?"auto":"none":void 0,...a.style},onFocusCapture:ic(a.onFocusCapture,N.onFocusCapture),onBlurCapture:ic(a.onBlurCapture,N.onBlurCapture),onPointerDownCapture:ic(a.onPointerDownCapture,H.onPointerDownCapture)}))});function fO(a,e=globalThis?.document){const t=FZ(a),n=E.useRef(!1),i=E.useRef(()=>{});return E.useEffect(()=>{const s=r=>{if(r.target&&!n.current){let C=function(){KH(CO,t,u,{discrete:!0})};var g=C;const u={originalEvent:r};r.pointerType==="touch"?(e.removeEventListener("click",i.current),i.current=C,e.addEventListener("click",i.current,{once:!0})):C()}n.current=!1},o=window.setTimeout(()=>{e.addEventListener("pointerdown",s)},0);return()=>{window.clearTimeout(o),e.removeEventListener("pointerdown",s),e.removeEventListener("click",i.current)}},[e,t]),{onPointerDownCapture:()=>n.current=!0}}function pO(a,e=globalThis?.document){const t=FZ(a),n=E.useRef(!1);return E.useEffect(()=>{const i=s=>{s.target&&!n.current&&KH(dO,t,{originalEvent:s},{discrete:!1})};return e.addEventListener("focusin",i),()=>e.removeEventListener("focusin",i)},[e,t]),{onFocusCapture:()=>n.current=!0,onBlurCapture:()=>n.current=!1}}function q1(){const a=new CustomEvent(f2);document.dispatchEvent(a)}function KH(a,e,t,{discrete:n}){const i=t.originalEvent.target,s=new CustomEvent(a,{bubbles:!1,cancelable:!0,detail:t});e&&i.addEventListener(a,e,{once:!0}),n?uO(i,s):i.dispatchEvent(s)}const mO=globalThis?.document?E.useLayoutEffect:()=>{},bO=U9.useId||(()=>{});let yO=0;function GO(a){const[e,t]=E.useState(bO());return mO(()=>{t(n=>n??String(yO++))},[a]),e?`radix-${e}`:""}function mC(a){return a.split("-")[0]}function ap(a){return a.split("-")[1]}function bA(a){return["top","bottom"].includes(mC(a))?"x":"y"}function EZ(a){return a==="y"?"height":"width"}function $1(a,e,t){let{reference:n,floating:i}=a;const s=n.x+n.width/2-i.width/2,o=n.y+n.height/2-i.height/2,r=bA(e),g=EZ(r),u=n[g]/2-i[g]/2,C=r==="x";let h;switch(mC(e)){case"top":h={x:s,y:n.y-i.height};break;case"bottom":h={x:s,y:n.y+n.height};break;case"right":h={x:n.x+n.width,y:o};break;case"left":h={x:n.x-i.width,y:o};break;default:h={x:n.x,y:n.y}}switch(ap(e)){case"start":h[r]-=u*(t&&C?-1:1);break;case"end":h[r]+=u*(t&&C?-1:1)}return h}const BO=async(a,e,t)=>{const{placement:n="bottom",strategy:i="absolute",middleware:s=[],platform:o}=t,r=await(o.isRTL==null?void 0:o.isRTL(e));let g=await o.getElementRects({reference:a,floating:e,strategy:i}),{x:u,y:C}=$1(g,n,r),h=n,f={},p=0;for(let y=0;y<s.length;y++){const{name:v,fn:G}=s[y],{x:B,y:R,data:x,reset:w}=await G({x:u,y:C,initialPlacement:n,placement:h,strategy:i,middlewareData:f,rects:g,platform:o,elements:{reference:a,floating:e}});u=B??u,C=R??C,f={...f,[v]:{...f[v],...x}},w&&p<=50&&(p++,typeof w=="object"&&(w.placement&&(h=w.placement),w.rects&&(g=w.rects===!0?await o.getElementRects({reference:a,floating:e,strategy:i}):w.rects),{x:u,y:C}=$1(g,h,r)),y=-1)}return{x:u,y:C,placement:h,strategy:i,middlewareData:f}};function FH(a){return typeof a!="number"?function(e){return{top:0,right:0,bottom:0,left:0,...e}}(a):{top:a,right:a,bottom:a,left:a}}function D0(a){return{...a,top:a.y,left:a.x,right:a.x+a.width,bottom:a.y+a.height}}async function Tf(a,e){var t;e===void 0&&(e={});const{x:n,y:i,platform:s,rects:o,elements:r,strategy:g}=a,{boundary:u="clippingAncestors",rootBoundary:C="viewport",elementContext:h="floating",altBoundary:f=!1,padding:p=0}=e,y=FH(p),v=r[f?h==="floating"?"reference":"floating":h],G=D0(await s.getClippingRect({element:(t=await(s.isElement==null?void 0:s.isElement(v)))==null||t?v:v.contextElement||await(s.getDocumentElement==null?void 0:s.getDocumentElement(r.floating)),boundary:u,rootBoundary:C,strategy:g})),B=D0(s.convertOffsetParentRelativeRectToViewportRelativeRect?await s.convertOffsetParentRelativeRectToViewportRelativeRect({rect:h==="floating"?{...o.floating,x:n,y:i}:o.reference,offsetParent:await(s.getOffsetParent==null?void 0:s.getOffsetParent(r.floating)),strategy:g}):o[h]);return{top:G.top-B.top+y.top,bottom:B.bottom-G.bottom+y.bottom,left:G.left-B.left+y.left,right:B.right-G.right+y.right}}const vO=Math.min,TI=Math.max;function p2(a,e,t){return TI(a,vO(e,t))}const ex=a=>({name:"arrow",options:a,async fn(e){const{element:t,padding:n=0}=a??{},{x:i,y:s,placement:o,rects:r,platform:g}=e;if(t==null)return{};const u=FH(n),C={x:i,y:s},h=bA(o),f=ap(o),p=EZ(h),y=await g.getDimensions(t),v=h==="y"?"top":"left",G=h==="y"?"bottom":"right",B=r.reference[p]+r.reference[h]-C[h]-r.floating[p],R=C[h]-r.reference[h],x=await(g.getOffsetParent==null?void 0:g.getOffsetParent(t));let w=x?h==="y"?x.clientHeight||0:x.clientWidth||0:0;w===0&&(w=r.floating[p]);const M=B/2-R/2,H=u[v],N=w-y[p]-u[G],F=w/2-y[p]/2+M,Y=p2(H,F,N),X=(f==="start"?u[v]:u[G])>0&&F!==Y&&r.reference[p]<=r.floating[p];return{[h]:C[h]-(X?F<H?H-F:N-F:0),data:{[h]:Y,centerOffset:F-Y}}}}),ZO={left:"right",right:"left",bottom:"top",top:"bottom"};function k0(a){return a.replace(/left|right|bottom|top/g,e=>ZO[e])}function SO(a,e,t){t===void 0&&(t=!1);const n=ap(a),i=bA(a),s=EZ(i);let o=i==="x"?n===(t?"end":"start")?"right":"left":n==="start"?"bottom":"top";return e.reference[s]>e.floating[s]&&(o=k0(o)),{main:o,cross:k0(o)}}const RO={start:"end",end:"start"};function tx(a){return a.replace(/start|end/g,e=>RO[e])}const EH=["top","right","bottom","left"];EH.reduce((a,e)=>a.concat(e,e+"-start",e+"-end"),[]);const wO=function(a){return a===void 0&&(a={}),{name:"flip",options:a,async fn(e){var t;const{placement:n,middlewareData:i,rects:s,initialPlacement:o,platform:r,elements:g}=e,{mainAxis:u=!0,crossAxis:C=!0,fallbackPlacements:h,fallbackStrategy:f="bestFit",flipAlignment:p=!0,...y}=a,v=mC(n),G=h||(v===o||!p?[k0(o)]:function(F){const Y=k0(F);return[tx(F),Y,tx(Y)]}(o)),B=[o,...G],R=await Tf(e,y),x=[];let w=((t=i.flip)==null?void 0:t.overflows)||[];if(u&&x.push(R[v]),C){const{main:F,cross:Y}=SO(n,s,await(r.isRTL==null?void 0:r.isRTL(g.floating)));x.push(R[F],R[Y])}if(w=[...w,{placement:n,overflows:x}],!x.every(F=>F<=0)){var M,H;const F=((M=(H=i.flip)==null?void 0:H.index)!=null?M:0)+1,Y=B[F];if(Y)return{data:{index:F,overflows:w},reset:{placement:Y}};let X="bottom";switch(f){case"bestFit":{var N;const U=(N=w.map(O=>[O,O.overflows.filter(P=>P>0).reduce((P,ie)=>P+ie,0)]).sort((O,P)=>O[1]-P[1])[0])==null?void 0:N[0].placement;U&&(X=U);break}case"initialPlacement":X=o}if(n!==X)return{reset:{placement:X}}}return{}}}};function nx(a,e){return{top:a.top-e.height,right:a.right-e.width,bottom:a.bottom-e.height,left:a.left-e.width}}function ix(a){return EH.some(e=>a[e]>=0)}const xO=function(a){let{strategy:e="referenceHidden",...t}=a===void 0?{}:a;return{name:"hide",async fn(n){const{rects:i}=n;switch(e){case"referenceHidden":{const s=nx(await Tf(n,{...t,elementContext:"reference"}),i.reference);return{data:{referenceHiddenOffsets:s,referenceHidden:ix(s)}}}case"escaped":{const s=nx(await Tf(n,{...t,altBoundary:!0}),i.floating);return{data:{escapedOffsets:s,escaped:ix(s)}}}default:return{}}}}},WO=function(a){return a===void 0&&(a=0),{name:"offset",options:a,async fn(e){const{x:t,y:n}=e,i=await async function(s,o){const{placement:r,platform:g,elements:u}=s,C=await(g.isRTL==null?void 0:g.isRTL(u.floating)),h=mC(r),f=ap(r),p=bA(r)==="x",y=["left","top"].includes(h)?-1:1,v=C&&p?-1:1,G=typeof o=="function"?o(s):o;let{mainAxis:B,crossAxis:R,alignmentAxis:x}=typeof G=="number"?{mainAxis:G,crossAxis:0,alignmentAxis:null}:{mainAxis:0,crossAxis:0,alignmentAxis:null,...G};return f&&typeof x=="number"&&(R=f==="end"?-1*x:x),p?{x:R*v,y:B*y}:{x:B*y,y:R*v}}(e,a);return{x:t+i.x,y:n+i.y,data:i}}}};function TH(a){return a==="x"?"y":"x"}const VO=function(a){return a===void 0&&(a={}),{name:"shift",options:a,async fn(e){const{x:t,y:n,placement:i}=e,{mainAxis:s=!0,crossAxis:o=!1,limiter:r={fn:G=>{let{x:B,y:R}=G;return{x:B,y:R}}},...g}=a,u={x:t,y:n},C=await Tf(e,g),h=bA(mC(i)),f=TH(h);let p=u[h],y=u[f];if(s){const G=h==="y"?"bottom":"right";p=p2(p+C[h==="y"?"top":"left"],p,p-C[G])}if(o){const G=f==="y"?"bottom":"right";y=p2(y+C[f==="y"?"top":"left"],y,y-C[G])}const v=r.fn({...e,[h]:p,[f]:y});return{...v,data:{x:v.x-t,y:v.y-n}}}}},MO=function(a){return a===void 0&&(a={}),{options:a,fn(e){const{x:t,y:n,placement:i,rects:s,middlewareData:o}=e,{offset:r=0,mainAxis:g=!0,crossAxis:u=!0}=a,C={x:t,y:n},h=bA(i),f=TH(h);let p=C[h],y=C[f];const v=typeof r=="function"?r({...s,placement:i}):r,G=typeof v=="number"?{mainAxis:v,crossAxis:0}:{mainAxis:0,crossAxis:0,...v};if(g){const M=h==="y"?"height":"width",H=s.reference[h]-s.floating[M]+G.mainAxis,N=s.reference[h]+s.reference[M]-G.mainAxis;p<H?p=H:p>N&&(p=N)}if(u){var B,R,x,w;const M=h==="y"?"width":"height",H=["top","left"].includes(mC(i)),N=s.reference[f]-s.floating[M]+(H&&(B=(R=o.offset)==null?void 0:R[f])!=null?B:0)+(H?0:G.crossAxis),F=s.reference[f]+s.reference[M]+(H?0:(x=(w=o.offset)==null?void 0:w[f])!=null?x:0)-(H?G.crossAxis:0);y<N?y=N:y>F&&(y=F)}return{[h]:p,[f]:y}}}},HO=function(a){return a===void 0&&(a={}),{name:"size",options:a,async fn(e){const{placement:t,rects:n,platform:i,elements:s}=e,{apply:o,...r}=a,g=await Tf(e,r),u=mC(t),C=ap(t);let h,f;u==="top"||u==="bottom"?(h=u,f=C===(await(i.isRTL==null?void 0:i.isRTL(s.floating))?"start":"end")?"left":"right"):(f=u,h=C==="end"?"top":"bottom");const p=TI(g.left,0),y=TI(g.right,0),v=TI(g.top,0),G=TI(g.bottom,0),B={availableHeight:n.floating.height-(["left","right"].includes(t)?2*(v!==0||G!==0?v+G:TI(g.top,g.bottom)):g[h]),availableWidth:n.floating.width-(["top","bottom"].includes(t)?2*(p!==0||y!==0?p+y:TI(g.left,g.right)):g[f])},R=await i.getDimensions(s.floating);o?.({...e,...B});const x=await i.getDimensions(s.floating);return R.width!==x.width||R.height!==x.height?{reset:{rects:!0}}:{}}}};function zH(a){return a&&a.document&&a.location&&a.alert&&a.setInterval}function yc(a){if(a==null)return window;if(!zH(a)){const e=a.ownerDocument;return e&&e.defaultView||window}return a}function sp(a){return yc(a).getComputedStyle(a)}function Cc(a){return zH(a)?"":a?(a.nodeName||"").toLowerCase():""}function LH(){const a=navigator.userAgentData;return a!=null&&a.brands?a.brands.map(e=>e.brand+"/"+e.version).join(" "):navigator.userAgent}function mg(a){return a instanceof yc(a).HTMLElement}function Ru(a){return a instanceof yc(a).Element}function TZ(a){return typeof ShadowRoot>"u"?!1:a instanceof yc(a).ShadowRoot||a instanceof ShadowRoot}function Qy(a){const{overflow:e,overflowX:t,overflowY:n}=sp(a);return/auto|scroll|overlay|hidden/.test(e+n+t)}function XO(a){return["table","td","th"].includes(Cc(a))}function ax(a){const e=/firefox/i.test(LH()),t=sp(a);return t.transform!=="none"||t.perspective!=="none"||t.contain==="paint"||["transform","perspective"].includes(t.willChange)||e&&t.willChange==="filter"||e&&!!t.filter&&t.filter!=="none"}function _H(){return!/^((?!chrome|android).)*safari/i.test(LH())}const sx=Math.min,Gf=Math.max,O0=Math.round;function dc(a,e,t){var n,i,s,o;e===void 0&&(e=!1),t===void 0&&(t=!1);const r=a.getBoundingClientRect();let g=1,u=1;e&&mg(a)&&(g=a.offsetWidth>0&&O0(r.width)/a.offsetWidth||1,u=a.offsetHeight>0&&O0(r.height)/a.offsetHeight||1);const C=Ru(a)?yc(a):window,h=!_H()&&t,f=(r.left+(h&&(n=(i=C.visualViewport)==null?void 0:i.offsetLeft)!=null?n:0))/g,p=(r.top+(h&&(s=(o=C.visualViewport)==null?void 0:o.offsetTop)!=null?s:0))/u,y=r.width/g,v=r.height/u;return{width:y,height:v,top:p,right:f+y,bottom:p+v,left:f,x:f,y:p}}function yu(a){return(e=a,(e instanceof yc(e).Node?a.ownerDocument:a.document)||window.document).documentElement;var e}function jy(a){return Ru(a)?{scrollLeft:a.scrollLeft,scrollTop:a.scrollTop}:{scrollLeft:a.pageXOffset,scrollTop:a.pageYOffset}}function UH(a){return dc(yu(a)).left+jy(a).scrollLeft}function NO(a,e,t){const n=mg(e),i=yu(e),s=dc(a,n&&function(g){const u=dc(g);return O0(u.width)!==g.offsetWidth||O0(u.height)!==g.offsetHeight}(e),t==="fixed");let o={scrollLeft:0,scrollTop:0};const r={x:0,y:0};if(n||!n&&t!=="fixed")if((Cc(e)!=="body"||Qy(i))&&(o=jy(e)),mg(e)){const g=dc(e,!0);r.x=g.x+e.clientLeft,r.y=g.y+e.clientTop}else i&&(r.x=UH(i));return{x:s.left+o.scrollLeft-r.x,y:s.top+o.scrollTop-r.y,width:s.width,height:s.height}}function DH(a){return Cc(a)==="html"?a:a.assignedSlot||a.parentNode||(TZ(a)?a.host:null)||yu(a)}function ox(a){return mg(a)&&getComputedStyle(a).position!=="fixed"?a.offsetParent:null}function m2(a){const e=yc(a);let t=ox(a);for(;t&&XO(t)&&getComputedStyle(t).position==="static";)t=ox(t);return t&&(Cc(t)==="html"||Cc(t)==="body"&&getComputedStyle(t).position==="static"&&!ax(t))?e:t||function(n){let i=DH(n);for(TZ(i)&&(i=i.host);mg(i)&&!["html","body"].includes(Cc(i));){if(ax(i))return i;i=i.parentNode}return null}(a)||e}function lx(a){if(mg(a))return{width:a.offsetWidth,height:a.offsetHeight};const e=dc(a);return{width:e.width,height:e.height}}function kH(a){const e=DH(a);return["html","body","#document"].includes(Cc(e))?a.ownerDocument.body:mg(e)&&Qy(e)?e:kH(e)}function J0(a,e){var t;e===void 0&&(e=[]);const n=kH(a),i=n===((t=a.ownerDocument)==null?void 0:t.body),s=yc(n),o=i?[s].concat(s.visualViewport||[],Qy(n)?n:[]):n,r=e.concat(o);return i?r:r.concat(J0(o))}function rx(a,e,t){return e==="viewport"?D0(function(n,i){const s=yc(n),o=yu(n),r=s.visualViewport;let g=o.clientWidth,u=o.clientHeight,C=0,h=0;if(r){g=r.width,u=r.height;const f=_H();(f||!f&&i==="fixed")&&(C=r.offsetLeft,h=r.offsetTop)}return{width:g,height:u,x:C,y:h}}(a,t)):Ru(e)?function(n,i){const s=dc(n,!1,i==="fixed"),o=s.top+n.clientTop,r=s.left+n.clientLeft;return{top:o,left:r,x:r,y:o,right:r+n.clientWidth,bottom:o+n.clientHeight,width:n.clientWidth,height:n.clientHeight}}(e,t):D0(function(n){var i;const s=yu(n),o=jy(n),r=(i=n.ownerDocument)==null?void 0:i.body,g=Gf(s.scrollWidth,s.clientWidth,r?r.scrollWidth:0,r?r.clientWidth:0),u=Gf(s.scrollHeight,s.clientHeight,r?r.scrollHeight:0,r?r.clientHeight:0);let C=-o.scrollLeft+UH(n);const h=-o.scrollTop;return sp(r||s).direction==="rtl"&&(C+=Gf(s.clientWidth,r?r.clientWidth:0)-g),{width:g,height:u,x:C,y:h}}(yu(a)))}function YO(a){const e=J0(a),t=["absolute","fixed"].includes(sp(a).position)&&mg(a)?m2(a):a;return Ru(t)?e.filter(n=>Ru(n)&&function(i,s){const o=s.getRootNode==null?void 0:s.getRootNode();if(i.contains(s))return!0;if(o&&TZ(o)){let r=s;do{if(r&&i===r)return!0;r=r.parentNode||r.host}while(r)}return!1}(n,t)&&Cc(n)!=="body"):[]}const KO={getClippingRect:function(a){let{element:e,boundary:t,rootBoundary:n,strategy:i}=a;const s=[...t==="clippingAncestors"?YO(e):[].concat(t),n],o=s[0],r=s.reduce((g,u)=>{const C=rx(e,u,i);return g.top=Gf(C.top,g.top),g.right=sx(C.right,g.right),g.bottom=sx(C.bottom,g.bottom),g.left=Gf(C.left,g.left),g},rx(e,o,i));return{width:r.right-r.left,height:r.bottom-r.top,x:r.left,y:r.top}},convertOffsetParentRelativeRectToViewportRelativeRect:function(a){let{rect:e,offsetParent:t,strategy:n}=a;const i=mg(t),s=yu(t);if(t===s)return e;let o={scrollLeft:0,scrollTop:0};const r={x:0,y:0};if((i||!i&&n!=="fixed")&&((Cc(t)!=="body"||Qy(s))&&(o=jy(t)),mg(t))){const g=dc(t,!0);r.x=g.x+t.clientLeft,r.y=g.y+t.clientTop}return{...e,x:e.x-o.scrollLeft+r.x,y:e.y-o.scrollTop+r.y}},isElement:Ru,getDimensions:lx,getOffsetParent:m2,getDocumentElement:yu,getElementRects:a=>{let{reference:e,floating:t,strategy:n}=a;return{reference:NO(e,m2(t),n),floating:{...lx(t),x:0,y:0}}},getClientRects:a=>Array.from(a.getClientRects()),isRTL:a=>sp(a).direction==="rtl"};function FO(a,e,t,n){n===void 0&&(n={});const{ancestorScroll:i=!0,ancestorResize:s=!0,elementResize:o=!0,animationFrame:r=!1}=n,g=i&&!r,u=s&&!r,C=g||u?[...Ru(a)?J0(a):[],...J0(e)]:[];C.forEach(y=>{g&&y.addEventListener("scroll",t,{passive:!0}),u&&y.addEventListener("resize",t)});let h,f=null;if(o){let y=!0;f=new ResizeObserver(()=>{y||t(),y=!1}),Ru(a)&&!r&&f.observe(a),f.observe(e)}let p=r?dc(a):null;return r&&function y(){const v=dc(a);!p||v.x===p.x&&v.y===p.y&&v.width===p.width&&v.height===p.height||t(),p=v,h=requestAnimationFrame(y)}(),t(),()=>{var y;C.forEach(v=>{g&&v.removeEventListener("scroll",t),u&&v.removeEventListener("resize",t)}),(y=f)==null||y.disconnect(),f=null,r&&cancelAnimationFrame(h)}}const EO=(a,e,t)=>BO(a,e,{platform:KO,...t});var b2=typeof document<"u"?E.useLayoutEffect:E.useEffect;function y2(a,e){if(a===e)return!0;if(typeof a!=typeof e)return!1;if(typeof a=="function"&&a.toString()===e.toString())return!0;let t,n,i;if(a&&e&&typeof a=="object"){if(Array.isArray(a)){if(t=a.length,t!=e.length)return!1;for(n=t;n--!==0;)if(!y2(a[n],e[n]))return!1;return!0}if(i=Object.keys(a),t=i.length,t!==Object.keys(e).length)return!1;for(n=t;n--!==0;)if(!Object.prototype.hasOwnProperty.call(e,i[n]))return!1;for(n=t;n--!==0;){const s=i[n];if(!(s==="_owner"&&a.$$typeof)&&!y2(a[s],e[s]))return!1}return!0}return a!==a&&e!==e}function TO(a){const e=E.useRef(a);return b2(()=>{e.current=a}),e}function zO(a){let{middleware:e,placement:t="bottom",strategy:n="absolute",whileElementsMounted:i}=a===void 0?{}:a;const s=E.useRef(null),o=E.useRef(null),r=TO(i),g=E.useRef(null),[u,C]=E.useState({x:null,y:null,strategy:n,placement:t,middlewareData:{}}),[h,f]=E.useState(e);y2(h?.map(x=>{let{options:w}=x;return w}),e?.map(x=>{let{options:w}=x;return w}))||f(e);const p=E.useCallback(()=>{!s.current||!o.current||EO(s.current,o.current,{middleware:h,placement:t,strategy:n}).then(x=>{y.current&&Oy.flushSync(()=>{C(x)})})},[h,t,n]);b2(()=>{y.current&&p()},[p]);const y=E.useRef(!1);b2(()=>(y.current=!0,()=>{y.current=!1}),[]);const v=E.useCallback(()=>{if(typeof g.current=="function"&&(g.current(),g.current=null),s.current&&o.current)if(r.current){const x=r.current(s.current,o.current,p);g.current=x}else p()},[p,r]),G=E.useCallback(x=>{s.current=x,v()},[v]),B=E.useCallback(x=>{o.current=x,v()},[v]),R=E.useMemo(()=>({reference:s,floating:o}),[]);return E.useMemo(()=>({...u,update:p,refs:R,reference:G,floating:B}),[u,p,R,G,B])}const LO=a=>{const{element:e,padding:t}=a;function n(i){return Object.prototype.hasOwnProperty.call(i,"current")}return{name:"arrow",options:a,fn(i){return n(e)?e.current!=null?ex({element:e.current,padding:t}).fn(i):{}:e?ex({element:e,padding:t}).fn(i):{}}}},_O=E.forwardRef((a,e)=>{const{children:t,width:n=10,height:i=5,...s}=a;return E.createElement(uC.svg,gi({},s,{ref:e,width:n,height:i,viewBox:"0 0 30 10",preserveAspectRatio:"none"}),a.asChild?t:E.createElement("polygon",{points:"0,0 30,0 15,10"}))}),UO=_O;function DO(a){const e=E.useRef(a);return E.useEffect(()=>{e.current=a}),E.useMemo(()=>(...t)=>{var n;return(n=e.current)===null||n===void 0?void 0:n.call(e,...t)},[])}const gf=globalThis?.document?E.useLayoutEffect:()=>{};function kO(a){const[e,t]=E.useState(void 0);return gf(()=>{if(a){t({width:a.offsetWidth,height:a.offsetHeight});const n=new ResizeObserver(i=>{if(!Array.isArray(i)||!i.length)return;const s=i[0];let o,r;if("borderBoxSize"in s){const g=s.borderBoxSize,u=Array.isArray(g)?g[0]:g;o=u.inlineSize,r=u.blockSize}else o=a.offsetWidth,r=a.offsetHeight;t({width:o,height:r})});return n.observe(a,{box:"border-box"}),()=>n.unobserve(a)}else t(void 0)},[a]),e}const OH="Popper",[zZ,JH]=XH(OH),[OO,PH]=zZ(OH),JO=a=>{const{__scopePopper:e,children:t}=a,[n,i]=E.useState(null);return E.createElement(OO,{scope:e,anchor:n,onAnchorChange:i},t)},PO="PopperAnchor",QO=E.forwardRef((a,e)=>{const{__scopePopper:t,virtualRef:n,...i}=a,s=PH(PO,t),o=E.useRef(null),r=mA(e,o);return E.useEffect(()=>{s.onAnchorChange(n?.current||o.current)}),n?null:E.createElement(uC.div,gi({},i,{ref:r}))}),P0="PopperContent",[jO,qO]=zZ(P0),[$O,eJ]=zZ(P0,{hasParent:!1,positionUpdateFns:new Set}),tJ=E.forwardRef((a,e)=>{var t,n,i,s,o,r,g,u;const{__scopePopper:C,side:h="bottom",sideOffset:f=0,align:p="center",alignOffset:y=0,arrowPadding:v=0,collisionBoundary:G=[],collisionPadding:B=0,sticky:R="partial",hideWhenDetached:x=!1,avoidCollisions:w=!0,onPlaced:M,...H}=a,N=PH(P0,C),[F,Y]=E.useState(null),X=mA(e,gt=>Y(gt)),[U,O]=E.useState(null),P=kO(U),ie=(t=P?.width)!==null&&t!==void 0?t:0,le=(n=P?.height)!==null&&n!==void 0?n:0,T=h+(p!=="center"?"-"+p:""),J=typeof B=="number"?B:{top:0,right:0,bottom:0,left:0,...B},Q=Array.isArray(G)?G:[G],se=Q.length>0,L={padding:J,boundary:Q.filter(oJ),altBoundary:se},{reference:D,floating:ne,strategy:oe,x:j,y:re,placement:pe,middlewareData:me,update:be}=zO({strategy:"fixed",placement:T,whileElementsMounted:FO,middleware:[lJ(),WO({mainAxis:f+le,alignmentAxis:y}),w?VO({mainAxis:!0,crossAxis:!1,limiter:R==="partial"?MO():void 0,...L}):void 0,U?LO({element:U,padding:v}):void 0,w?wO({...L}):void 0,HO({...L,apply:({elements:gt,availableWidth:k,availableHeight:z})=>{gt.floating.style.setProperty("--radix-popper-available-width",`${k}px`),gt.floating.style.setProperty("--radix-popper-available-height",`${z}px`)}}),rJ({arrowWidth:ie,arrowHeight:le}),x?xO({strategy:"referenceHidden"}):void 0].filter(sJ)});gf(()=>{D(N.anchor)},[D,N.anchor]);const $e=j!==null&&re!==null,[qe,ke]=QH(pe),Te=DO(M);gf(()=>{$e&&Te?.()},[$e,Te]);const ut=(i=me.arrow)===null||i===void 0?void 0:i.x,q=(s=me.arrow)===null||s===void 0?void 0:s.y,De=((o=me.arrow)===null||o===void 0?void 0:o.centerOffset)!==0,[Ke,Ee]=E.useState();gf(()=>{F&&Ee(window.getComputedStyle(F).zIndex)},[F]);const{hasParent:ye,positionUpdateFns:Je}=eJ(P0,C),Me=!ye;E.useLayoutEffect(()=>{if(!Me)return Je.add(be),()=>{Je.delete(be)}},[Me,Je,be]),gf(()=>{Me&&$e&&Array.from(Je).reverse().forEach(gt=>requestAnimationFrame(gt))},[Me,$e,Je]);const Ze={"data-side":qe,"data-align":ke,...H,ref:X,style:{...H.style,animation:$e?void 0:"none",opacity:(r=me.hide)!==null&&r!==void 0&&r.referenceHidden?0:void 0}};return E.createElement("div",{ref:ne,"data-radix-popper-content-wrapper":"",style:{position:oe,left:0,top:0,transform:$e?`translate3d(${Math.round(j)}px, ${Math.round(re)}px, 0)`:"translate3d(0, -200%, 0)",minWidth:"max-content",zIndex:Ke,"--radix-popper-transform-origin":[(g=me.transformOrigin)===null||g===void 0?void 0:g.x,(u=me.transformOrigin)===null||u===void 0?void 0:u.y].join(" ")},dir:a.dir},E.createElement(jO,{scope:C,placedSide:qe,onArrowChange:O,arrowX:ut,arrowY:q,shouldHideArrow:De},Me?E.createElement($O,{scope:C,hasParent:!0,positionUpdateFns:Je},E.createElement(uC.div,Ze)):E.createElement(uC.div,Ze)))}),nJ="PopperArrow",iJ={top:"bottom",right:"left",bottom:"top",left:"right"},aJ=E.forwardRef(function(e,t){const{__scopePopper:n,...i}=e,s=qO(nJ,n),o=iJ[s.placedSide];return E.createElement("span",{ref:s.onArrowChange,style:{position:"absolute",left:s.arrowX,top:s.arrowY,[o]:0,transformOrigin:{top:"",right:"0 0",bottom:"center 0",left:"100% 0"}[s.placedSide],transform:{top:"translateY(100%)",right:"translateY(50%) rotate(90deg) translateX(-50%)",bottom:"rotate(180deg)",left:"translateY(50%) rotate(-90deg) translateX(50%)"}[s.placedSide],visibility:s.shouldHideArrow?"hidden":void 0}},E.createElement(UO,gi({},i,{ref:t,style:{...i.style,display:"block"}})))});function sJ(a){return a!==void 0}function oJ(a){return a!==null}const lJ=()=>({name:"anchorCssProperties",fn(a){const{rects:e,elements:t}=a,{width:n,height:i}=e.reference;return t.floating.style.setProperty("--radix-popper-anchor-width",`${n}px`),t.floating.style.setProperty("--radix-popper-anchor-height",`${i}px`),{}}}),rJ=a=>({name:"transformOrigin",options:a,fn(e){var t,n,i,s,o;const{placement:r,rects:g,middlewareData:u}=e,h=((t=u.arrow)===null||t===void 0?void 0:t.centerOffset)!==0,f=h?0:a.arrowWidth,p=h?0:a.arrowHeight,[y,v]=QH(r),G={start:"0%",center:"50%",end:"100%"}[v],B=((n=(i=u.arrow)===null||i===void 0?void 0:i.x)!==null&&n!==void 0?n:0)+f/2,R=((s=(o=u.arrow)===null||o===void 0?void 0:o.y)!==null&&s!==void 0?s:0)+p/2;let x="",w="";return y==="bottom"?(x=h?G:`${B}px`,w=`${-p}px`):y==="top"?(x=h?G:`${B}px`,w=`${g.floating.height+p}px`):y==="right"?(x=`${-p}px`,w=h?G:`${R}px`):y==="left"&&(x=`${g.floating.width+p}px`,w=h?G:`${R}px`),{data:{x,y:w}}}});function QH(a){const[e,t="center"]=a.split("-");return[e,t]}const gJ=JO,cJ=QO,uJ=tJ,IJ=aJ,gx=globalThis?.document?E.useLayoutEffect:()=>{};function CJ(a,e){return E.useReducer((t,n)=>{const i=e[t][n];return i??t},a)}const jH=a=>{const{present:e,children:t}=a,n=dJ(e),i=typeof t=="function"?t({present:n.isPresent}):E.Children.only(t),s=mA(n.ref,i.ref);return typeof t=="function"||n.isPresent?E.cloneElement(i,{ref:s}):null};jH.displayName="Presence";function dJ(a){const[e,t]=E.useState(),n=E.useRef({}),i=E.useRef(a),s=E.useRef("none"),o=a?"mounted":"unmounted",[r,g]=CJ(o,{mounted:{UNMOUNT:"unmounted",ANIMATION_OUT:"unmountSuspended"},unmountSuspended:{MOUNT:"mounted",ANIMATION_END:"unmounted"},unmounted:{MOUNT:"mounted"}});return E.useEffect(()=>{const u=xb(n.current);s.current=r==="mounted"?u:"none"},[r]),gx(()=>{const u=n.current,C=i.current;if(C!==a){const f=s.current,p=xb(u);a?g("MOUNT"):p==="none"||u?.display==="none"?g("UNMOUNT"):g(C&&f!==p?"ANIMATION_OUT":"UNMOUNT"),i.current=a}},[a,g]),gx(()=>{if(e){const u=h=>{const p=xb(n.current).includes(h.animationName);h.target===e&&p&&Oy.flushSync(()=>g("ANIMATION_END"))},C=h=>{h.target===e&&(s.current=xb(n.current))};return e.addEventListener("animationstart",C),e.addEventListener("animationcancel",u),e.addEventListener("animationend",u),()=>{e.removeEventListener("animationstart",C),e.removeEventListener("animationcancel",u),e.removeEventListener("animationend",u)}}else g("ANIMATION_END")},[e,g]),{isPresent:["mounted","unmountSuspended"].includes(r),ref:E.useCallback(u=>{u&&(n.current=getComputedStyle(u)),t(u)},[])}}function xb(a){return a?.animationName||"none"}function qH(a){const e=E.useRef(a);return E.useEffect(()=>{e.current=a}),E.useMemo(()=>(...t)=>{var n;return(n=e.current)===null||n===void 0?void 0:n.call(e,...t)},[])}function AJ({prop:a,defaultProp:e,onChange:t=()=>{}}){const[n,i]=hJ({defaultProp:e,onChange:t}),s=a!==void 0,o=s?a:n,r=qH(t),g=E.useCallback(u=>{if(s){const h=typeof u=="function"?u(a):u;h!==a&&r(h)}else i(u)},[s,a,i,r]);return[o,g]}function hJ({defaultProp:a,onChange:e}){const t=E.useState(a),[n]=t,i=E.useRef(n),s=qH(e);return E.useEffect(()=>{i.current!==n&&(s(n),i.current=n)},[n,i,s]),t}const fJ=E.forwardRef((a,e)=>E.createElement(uC.span,gi({},a,{ref:e,style:{position:"absolute",border:0,width:1,height:1,padding:0,margin:-1,overflow:"hidden",clip:"rect(0, 0, 0, 0)",whiteSpace:"nowrap",wordWrap:"normal",...a.style}}))),pJ=fJ,[qy,tq]=XH("Tooltip",[JH]),$y=JH(),mJ="TooltipProvider",G2="tooltip.open",[nq,LZ]=qy(mJ),_Z="Tooltip",[bJ,eG]=qy(_Z),yJ=a=>{const{__scopeTooltip:e,children:t,open:n,defaultOpen:i=!1,onOpenChange:s,disableHoverableContent:o,delayDuration:r}=a,g=LZ(_Z,a.__scopeTooltip),u=$y(e),[C,h]=E.useState(null),f=GO(),p=E.useRef(0),y=o??g.disableHoverableContent,v=r??g.delayDuration,G=E.useRef(!1),[B=!1,R]=AJ({prop:n,defaultProp:i,onChange:N=>{N?(g.onOpen(),document.dispatchEvent(new CustomEvent(G2))):g.onClose(),s?.(N)}}),x=E.useMemo(()=>B?G.current?"delayed-open":"instant-open":"closed",[B]),w=E.useCallback(()=>{window.clearTimeout(p.current),G.current=!1,R(!0)},[R]),M=E.useCallback(()=>{window.clearTimeout(p.current),R(!1)},[R]),H=E.useCallback(()=>{window.clearTimeout(p.current),p.current=window.setTimeout(()=>{G.current=!0,R(!0)},v)},[v,R]);return E.useEffect(()=>()=>window.clearTimeout(p.current),[]),E.createElement(gJ,u,E.createElement(bJ,{scope:e,contentId:f,open:B,stateAttribute:x,trigger:C,onTriggerChange:h,onTriggerEnter:E.useCallback(()=>{g.isOpenDelayed?H():w()},[g.isOpenDelayed,H,w]),onTriggerLeave:E.useCallback(()=>{y?M():window.clearTimeout(p.current)},[M,y]),onOpen:w,onClose:M,disableHoverableContent:y},t))},cx="TooltipTrigger",GJ=E.forwardRef((a,e)=>{const{__scopeTooltip:t,...n}=a,i=eG(cx,t),s=LZ(cx,t),o=$y(t),r=E.useRef(null),g=mA(e,r,i.onTriggerChange),u=E.useRef(!1),C=E.useRef(!1),h=E.useCallback(()=>u.current=!1,[]);return E.useEffect(()=>()=>document.removeEventListener("pointerup",h),[h]),E.createElement(cJ,gi({asChild:!0},o),E.createElement(uC.button,gi({"aria-describedby":i.open?i.contentId:void 0,"data-state":i.stateAttribute},n,{ref:g,onPointerMove:ic(a.onPointerMove,f=>{f.pointerType!=="touch"&&!C.current&&!s.isPointerInTransitRef.current&&(i.onTriggerEnter(),C.current=!0)}),onPointerLeave:ic(a.onPointerLeave,()=>{i.onTriggerLeave(),C.current=!1}),onPointerDown:ic(a.onPointerDown,()=>{u.current=!0,document.addEventListener("pointerup",h,{once:!0})}),onFocus:ic(a.onFocus,()=>{u.current||i.onOpen()}),onBlur:ic(a.onBlur,i.onClose),onClick:ic(a.onClick,i.onClose)})))}),BJ="TooltipPortal",[iq,vJ]=qy(BJ,{forceMount:void 0}),zf="TooltipContent",ZJ=E.forwardRef((a,e)=>{const t=vJ(zf,a.__scopeTooltip),{forceMount:n=t.forceMount,side:i="top",...s}=a,o=eG(zf,a.__scopeTooltip);return E.createElement(jH,{present:n||o.open},o.disableHoverableContent?E.createElement($H,gi({side:i},s,{ref:e})):E.createElement(SJ,gi({side:i},s,{ref:e})))}),SJ=E.forwardRef((a,e)=>{const t=eG(zf,a.__scopeTooltip),n=LZ(zf,a.__scopeTooltip),i=E.useRef(null),s=mA(e,i),[o,r]=E.useState(null),{trigger:g,onClose:u}=t,C=i.current,{onPointerInTransitChange:h}=n,f=E.useCallback(()=>{r(null),h(!1)},[h]),p=E.useCallback((y,v)=>{const G=y.currentTarget,B={x:y.clientX,y:y.clientY},R=VJ(B,G.getBoundingClientRect()),x=R==="right"||R==="bottom"?-5:5,M=R==="right"||R==="left"?{x:y.clientX+x,y:y.clientY}:{x:y.clientX,y:y.clientY+x},H=MJ(v.getBoundingClientRect()),N=XJ([M,...H]);r(N),h(!0)},[h]);return E.useEffect(()=>()=>f(),[f]),E.useEffect(()=>{if(g&&C){const y=G=>p(G,C),v=G=>p(G,g);return g.addEventListener("pointerleave",y),C.addEventListener("pointerleave",v),()=>{g.removeEventListener("pointerleave",y),C.removeEventListener("pointerleave",v)}}},[g,C,p,f]),E.useEffect(()=>{if(o){const y=v=>{const G=v.target,B={x:v.clientX,y:v.clientY},R=g?.contains(G)||C?.contains(G),x=!HJ(B,o);R?f():x&&(f(),u())};return document.addEventListener("pointermove",y),()=>document.removeEventListener("pointermove",y)}},[g,C,o,u,f]),E.createElement($H,gi({},a,{ref:s}))}),[RJ,wJ]=qy(_Z,{isInside:!1}),$H=E.forwardRef((a,e)=>{const{__scopeTooltip:t,children:n,"aria-label":i,onEscapeKeyDown:s,onPointerDownOutside:o,...r}=a,g=eG(zf,t),u=$y(t),{onClose:C}=g;return E.useEffect(()=>(document.addEventListener(G2,C),()=>document.removeEventListener(G2,C)),[C]),E.useEffect(()=>{if(g.trigger){const h=f=>{const p=f.target;p!=null&&p.contains(g.trigger)&&C()};return window.addEventListener("scroll",h,{capture:!0}),()=>window.removeEventListener("scroll",h,{capture:!0})}},[g.trigger,C]),E.createElement(hO,{asChild:!0,disableOutsidePointerEvents:!1,onEscapeKeyDown:s,onPointerDownOutside:o,onFocusOutside:h=>h.preventDefault(),onDismiss:C},E.createElement(uJ,gi({"data-state":g.stateAttribute},u,r,{ref:e,style:{...r.style,"--radix-tooltip-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-tooltip-content-available-width":"var(--radix-popper-available-width)","--radix-tooltip-content-available-height":"var(--radix-popper-available-height)","--radix-tooltip-trigger-width":"var(--radix-popper-anchor-width)","--radix-tooltip-trigger-height":"var(--radix-popper-anchor-height)"}}),E.createElement(YH,null,n),E.createElement(RJ,{scope:t,isInside:!0},E.createElement(pJ,{id:g.contentId,role:"tooltip"},i||n))))}),xJ="TooltipArrow",WJ=E.forwardRef((a,e)=>{const{__scopeTooltip:t,...n}=a,i=$y(t);return wJ(xJ,t).isInside?null:E.createElement(IJ,gi({},i,n,{ref:e}))});function VJ(a,e){const t=Math.abs(e.top-a.y),n=Math.abs(e.bottom-a.y),i=Math.abs(e.right-a.x),s=Math.abs(e.left-a.x);switch(Math.min(t,n,i,s)){case s:return"left";case i:return"right";case t:return"top";case n:return"bottom";default:return null}}function MJ(a){const{top:e,right:t,bottom:n,left:i}=a;return[{x:i,y:e},{x:t,y:e},{x:t,y:n},{x:i,y:n}]}function HJ(a,e){const{x:t,y:n}=a;let i=!1;for(let s=0,o=e.length-1;s<e.length;o=s++){const r=e[s].x,g=e[s].y,u=e[o].x,C=e[o].y;g>n!=C>n&&t<(u-r)*(n-g)/(C-g)+r&&(i=!i)}return i}function XJ(a){const e=a.slice();return e.sort((t,n)=>t.x<n.x?-1:t.x>n.x?1:t.y<n.y?-1:t.y>n.y?1:0),NJ(e)}function NJ(a){if(a.length<=1)return a.slice();const e=[];for(let n=0;n<a.length;n++){const i=a[n];for(;e.length>=2;){const s=e[e.length-1],o=e[e.length-2];if((s.x-o.x)*(i.y-o.y)>=(s.y-o.y)*(i.x-o.x))e.pop();else break}e.push(i)}e.pop();const t=[];for(let n=a.length-1;n>=0;n--){const i=a[n];for(;t.length>=2;){const s=t[t.length-1],o=t[t.length-2];if((s.x-o.x)*(i.y-o.y)>=(s.y-o.y)*(i.x-o.x))t.pop();else break}t.push(i)}return t.pop(),e.length===1&&t.length===1&&e[0].x===t[0].x&&e[0].y===t[0].y?e:e.concat(t)}const YJ=yJ,KJ=GJ,FJ=ZJ,EJ=WJ;function TJ(a,e){if(a==null)return{};var t={},n=Object.keys(a),i,s;for(s=0;s<n.length;s++)i=n[s],!(e.indexOf(i)>=0)&&(t[i]=a[i]);return t}function ri(a,e){if(a==null)return{};var t=TJ(a,e),n,i;if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(a);for(i=0;i<s.length;i++)n=s[i],!(e.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(a,n)&&(t[n]=a[n])}return t}let ki;(function(a){a[a.UNSUPPORTED_INPUT=0]="UNSUPPORTED_INPUT",a[a.NO_COMPONENT_FOR_TYPE=1]="NO_COMPONENT_FOR_TYPE",a[a.UNKNOWN_INPUT=2]="UNKNOWN_INPUT",a[a.DUPLICATE_KEYS=3]="DUPLICATE_KEYS",a[a.ALREADY_REGISTERED_TYPE=4]="ALREADY_REGISTERED_TYPE",a[a.CLIPBOARD_ERROR=5]="CLIPBOARD_ERROR",a[a.THEME_ERROR=6]="THEME_ERROR",a[a.PATH_DOESNT_EXIST=7]="PATH_DOESNT_EXIST",a[a.INPUT_TYPE_OVERRIDE=8]="INPUT_TYPE_OVERRIDE",a[a.EMPTY_KEY=9]="EMPTY_KEY"})(ki||(ki={}));const zJ={[ki.UNSUPPORTED_INPUT]:(a,e)=>[`An input with type \`${a}\` input was found at path \`${e}\` but it's not supported yet.`],[ki.NO_COMPONENT_FOR_TYPE]:(a,e)=>[`Type \`${a}\` found at path \`${e}\` can't be displayed in panel because no component supports it yet.`],[ki.UNKNOWN_INPUT]:(a,e)=>[`input at path \`${a}\` is not recognized.`,e],[ki.DUPLICATE_KEYS]:(a,e,t)=>[`Key \`${a}\` of path \`${e}\` already exists at path \`${t}\`. Even nested keys need to be unique. Rename one of the keys.`],[ki.ALREADY_REGISTERED_TYPE]:a=>[`Type ${a} has already been registered. You can't register a component with the same type.`],[ki.CLIPBOARD_ERROR]:a=>["Error copying the value",a],[ki.THEME_ERROR]:(a,e)=>[`Error accessing the theme \`${a}.${e}\` value.`],[ki.PATH_DOESNT_EXIST]:a=>[`Error getting the value at path \`${a}\`. There is probably an error in your \`render\` function.`],[ki.PATH_DOESNT_EXIST]:a=>[`Error accessing the value at path \`${a}\``],[ki.INPUT_TYPE_OVERRIDE]:(a,e,t)=>[`Input at path \`${a}\` already exists with type: \`${e}\`. Its type cannot be overridden with type \`${t}\`.`],[ki.EMPTY_KEY]:()=>["Keys can not be empty, if you want to hide a label use whitespace."]};function eX(a,e,...t){const[n,...i]=zJ[e](...t);console[a]("LEVA: "+n,...i)}const oc=eX.bind(null,"warn"),LJ=eX.bind(null,"log"),_J=["value"],UJ=["schema"],DJ=["value"],tX=[],IC={};function ux(a){let{value:e}=a,t=ri(a,_J);for(let n of tX){const i=n(e,t);if(i)return i}}function Gc(a,e){let{schema:t}=e,n=ri(e,UJ);if(a in IC){oc(ki.ALREADY_REGISTERED_TYPE,a);return}tX.push((i,s)=>t(i,s)&&a),IC[a]=n}function ov(a,e,t,n){const{normalize:i}=IC[a];if(i)return i(e,t,n);if(typeof e!="object"||!("value"in e))return{value:e};const{value:s}=e,o=ri(e,DJ);return{value:s,settings:o}}function kJ(a,e,t,n,i,s){const{sanitize:o}=IC[a];return o?o(e,t,n,i,s):e}function Ix(a,e,t){const{format:n}=IC[a];return n?n(e,t):e}function OJ(a,e,t){return e in a?Object.defineProperty(a,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):a[e]=t,a}function Cx(a,e){var t=Object.keys(a);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(a);e&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(a,i).enumerable})),t.push.apply(t,n)}return t}function jt(a){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?Cx(Object(t),!0).forEach(function(n){OJ(a,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(a,Object.getOwnPropertyDescriptors(t)):Cx(Object(t)).forEach(function(n){Object.defineProperty(a,n,Object.getOwnPropertyDescriptor(t,n))})}return a}const wu=(a,e,t)=>a>t?t:a<e?e:a,JJ=a=>{if(a===""||typeof a=="number")return a;try{const e=hu(a);if(!isNaN(e))return e}catch{}return parseFloat(a)},PJ=Math.log(10);function dx(a){let e=Math.abs(+String(a).replace(".",""));if(e===0)return .01;for(;e!==0&&e%10===0;)e/=10;const t=Math.floor(Math.log(e)/PJ)+1,n=Math.floor(Math.log10(Math.abs(a))),i=Math.pow(10,n-t);return Math.max(i,.001)}const Q0=(a,e,t)=>t===e?0:(wu(a,e,t)-e)/(t-e),j0=(a,e,t)=>a*(t-e)+e,QJ=()=>"_"+Math.random().toString(36).substr(2,9),Ax=/\(([0-9+\-*/^ .]+)\)/,hx=/(\d+(?:\.\d+)?) ?\^ ?(\d+(?:\.\d+)?)/,fx=/(\d+(?:\.\d+)?) ?\* ?(\d+(?:\.\d+)?)/,px=/(\d+(?:\.\d+)?) ?\/ ?(\d+(?:\.\d+)?)/,mx=/(\d+(?:\.\d+)?) ?\+ ?(\d+(?:\.\d+)?)/,bx=/(\d+(?:\.\d+)?) ?- ?(\d+(?:\.\d+)?)/;function hu(a){if(isNaN(Number(a)))if(Ax.test(a)){const e=a.replace(Ax,(t,n)=>String(hu(n)));return hu(e)}else if(hx.test(a)){const e=a.replace(hx,(t,n,i)=>String(Math.pow(Number(n),Number(i))));return hu(e)}else if(fx.test(a)){const e=a.replace(fx,(t,n,i)=>String(Number(n)*Number(i)));return hu(e)}else if(px.test(a)){const e=a.replace(px,(t,n,i)=>{if(i!=0)return String(Number(n)/Number(i));throw new Error("Division by zero")});return hu(e)}else if(mx.test(a)){const e=a.replace(mx,(t,n,i)=>String(Number(n)+Number(i)));return hu(e)}else if(bx.test(a)){const e=a.replace(bx,(t,n,i)=>String(Number(n)-Number(i)));return hu(e)}else return Number(a);return Number(a)}function jJ(a,e){return e.reduce((t,n)=>(a&&a.hasOwnProperty(n)&&(t[n]=a[n]),t),{})}function qJ(a,e){const t=jt({},a);return e.forEach(n=>n in a&&delete t[n]),t}function $J(a,e){return a.reduce((t,n,i)=>Object.assign(t,{[e[i]]:n}),{})}function nX(a){return Object.prototype.toString.call(a)==="[object Object]"}const eP=a=>nX(a)&&Object.keys(a).length===0;let mr;(function(a){a.BUTTON="BUTTON",a.BUTTON_GROUP="BUTTON_GROUP",a.MONITOR="MONITOR",a.FOLDER="FOLDER"})(mr||(mr={}));let yr;(function(a){a.SELECT="SELECT",a.IMAGE="IMAGE",a.NUMBER="NUMBER",a.COLOR="COLOR",a.STRING="STRING",a.BOOLEAN="BOOLEAN",a.INTERVAL="INTERVAL",a.VECTOR3D="VECTOR3D",a.VECTOR2D="VECTOR2D"})(yr||(yr={}));const tP=["type","__customInput"],nP=["render","label","optional","order","disabled","hint","onChange","onEditStart","onEditEnd","transient"],iP=["type"];function iX(a,e,t={},n){var i,s;if(typeof a!="object"||Array.isArray(a))return{type:n,input:a,options:jt({key:e,label:e,optional:!1,disabled:!1,order:0},t)};if("__customInput"in a){const{type:M,__customInput:H}=a,N=ri(a,tP);return iX(H,e,N,M)}const{render:o,label:r,optional:g,order:u=0,disabled:C,hint:h,onChange:f,onEditStart:p,onEditEnd:y,transient:v}=a,G=ri(a,nP),B=jt({render:o,key:e,label:r??e,hint:h,transient:v??!!f,onEditStart:p,onEditEnd:y,disabled:C,optional:g,order:u},t);let{type:R}=G,x=ri(G,iP);if(R=n??R,R in mr)return{type:R,input:x,options:B};let w;return n&&nX(x)&&"value"in x?w=x.value:w=eP(x)?void 0:x,{type:R,input:w,options:jt(jt({},B),{},{onChange:f,optional:(i=B.optional)!==null&&i!==void 0?i:!1,disabled:(s=B.disabled)!==null&&s!==void 0?s:!1})}}function aP(a,e,t,n){const i=iX(a,e),{type:s,input:o,options:r}=i;if(s)return s in mr?i:{type:s,input:ov(s,o,t,n),options:r};let g=ux(o);return g?{type:g,input:ov(g,o,t,n),options:r}:(g=ux({value:o}),g?{type:g,input:ov(g,{value:o},t,n),options:r}:!1)}function yx(a,e,t,n,i){const{value:s,type:o,settings:r}=a;a.value=aX({type:o,value:s,settings:r},e,t,n),a.fromPanel=i}const sP=function(e,t,n){this.type="LEVA_ERROR",this.message="LEVA: "+e,this.previousValue=t,this.error=n};function aX({type:a,value:e,settings:t},n,i,s){const o=a!=="SELECT"&&typeof n=="function"?n(e):n;let r;try{r=kJ(a,o,t,e,i,s)}catch(g){throw new sP(`The value \`${n}\` did not result in a correct value.`,e,g)}return Ff(r,e)?e:r}const sX=(a,e,t=!1)=>{let n=0;return function(){const i=arguments,s=t&&!n,o=()=>a.apply(this,i);window.clearTimeout(n),n=window.setTimeout(o,e),s&&o()}},oX=a=>a.shiftKey?5:a.altKey?1/5:1,oP=["value"],lP=["min","max"],rP=a=>{if(typeof a=="number")return!0;if(typeof a=="string"){const e=parseFloat(a);return isNaN(e)?!1:a.substring((""+e).length).trim().length<4}return!1},lX=(a,{min:e=-1/0,max:t=1/0,suffix:n})=>{const i=parseFloat(a);if(a===""||isNaN(i))throw Error("Invalid number");const s=wu(i,e,t);return n?s+n:s},gP=(a,{pad:e=0,suffix:t})=>{const n=parseFloat(a).toFixed(e);return t?n+t:n},rX=a=>{let{value:e}=a,t=ri(a,oP);const{min:n=-1/0,max:i=1/0}=t,s=ri(t,lP);let o=parseFloat(e);const r=typeof e=="string"?e.substring((""+o).length):void 0;o=wu(o,n,i);let g=t.step;g||(Number.isFinite(n)?Number.isFinite(i)?g=+(Math.abs(i-n)/100).toPrecision(1):g=+(Math.abs(o-n)/100).toPrecision(1):Number.isFinite(i)&&(g=+(Math.abs(i-o)/100).toPrecision(1)));const u=g?dx(g)*10:dx(o);g=g||u/10;const C=Math.round(wu(Math.log10(1/u),0,2));return{value:r?o+r:o,settings:jt({initialValue:o,step:g,pad:C,min:n,max:i,suffix:r},s)}},gX=(a,{step:e,initialValue:t})=>{const n=Math.round((a-t)/e);return t+n*e};var cX=Object.freeze({__proto__:null,schema:rP,sanitize:lX,format:gP,normalize:rX,sanitizeStep:gX});function ia(){return ia=Object.assign?Object.assign.bind():function(a){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(a[n]=t[n])}return a},ia.apply(this,arguments)}const uX=E.createContext({});function Ss(){return E.useContext(uX)}const UZ=E.createContext(null),IX=E.createContext(null),CX=E.createContext(null);function op(){return E.useContext(IX)}function cP(){return E.useContext(CX)}const dX=()=>({colors:{elevation1:"#292d39",elevation2:"#181c20",elevation3:"#373c4b",accent1:"#0066dc",accent2:"#007bff",accent3:"#3c93ff",highlight1:"#535760",highlight2:"#8c92a4",highlight3:"#fefefe",vivid1:"#ffcc00",folderWidgetColor:"$highlight2",folderTextColor:"$highlight3",toolTipBackground:"$highlight3",toolTipText:"$elevation2"},radii:{xs:"2px",sm:"3px",lg:"10px"},space:{xs:"3px",sm:"6px",md:"10px",rowGap:"7px",colGap:"7px"},fonts:{mono:"ui-monospace, SFMono-Regular, Menlo, 'Roboto Mono', monospace",sans:"system-ui, sans-serif"},fontSizes:{root:"11px",toolTip:"$root"},sizes:{rootWidth:"280px",controlWidth:"160px",numberInputMinWidth:"38px",scrubberWidth:"8px",scrubberHeight:"16px",rowHeight:"24px",folderTitleHeight:"20px",checkboxSize:"16px",joystickWidth:"100px",joystickHeight:"100px",colorPickerWidth:"$controlWidth",colorPickerHeight:"100px",imagePreviewWidth:"$controlWidth",imagePreviewHeight:"100px",monitorHeight:"60px",titleBarHeight:"39px"},shadows:{level1:"0 0 9px 0 #00000088",level2:"0 4px 14px #00000033"},borderWidths:{root:"0px",input:"1px",focus:"1px",hover:"1px",active:"1px",folder:"1px"},fontWeights:{label:"normal",folder:"normal",button:"normal"}});function Wb(a,e){const[t,n]=a.split(" "),i={};return t!=="none"&&(i.boxShadow=`${e.inset?"inset ":""}0 0 0 $borderWidths${[e.key]} $colors${t!=="default"&&t||e.borderColor}`),n&&(i.backgroundColor=n),i}const Qh={$inputStyle:()=>a=>Wb(a,{key:"$input",borderColor:"$highlight1",inset:!0}),$focusStyle:()=>a=>Wb(a,{key:"$focus",borderColor:"$accent2"}),$hoverStyle:()=>a=>Wb(a,{key:"$hover",borderColor:"$accent1",inset:!0}),$activeStyle:()=>a=>Wb(a,{key:"$active",borderColor:"$accent1",inset:!0})},{styled:kt,css:aq,createTheme:uP,globalCss:IP,keyframes:sq}=sO({prefix:"leva",theme:dX(),utils:jt(jt({},Qh),{},{$flex:()=>({display:"flex",alignItems:"center"}),$flexCenter:()=>({display:"flex",alignItems:"center",justifyContent:"center"}),$reset:()=>({outline:"none",fontSize:"inherit",fontWeight:"inherit",color:"inherit",fontFamily:"inherit",border:"none",backgroundColor:"transparent",appearance:"none"}),$draggable:()=>({touchAction:"none",WebkitUserDrag:"none",userSelect:"none"}),$focus:a=>({"&:focus":Qh.$focusStyle()(a)}),$focusWithin:a=>({"&:focus-within":Qh.$focusStyle()(a)}),$hover:a=>({"&:hover":Qh.$hoverStyle()(a)}),$active:a=>({"&:active":Qh.$activeStyle()(a)})})}),CP=IP({".leva__panel__dragged":{WebkitUserDrag:"none",userSelect:"none",input:{userSelect:"none"},"*":{cursor:"ew-resize !important"}}});function dP(a){const e=dX();if(!a)return{theme:e,className:""};Object.keys(a).forEach(n=>{Object.assign(e[n],a[n])});const t=uP(e);return{theme:e,className:t.className}}function Ac(a,e){const{theme:t}=E.useContext(UZ);if(!(a in t)||!(e in t[a]))return oc(ki.THEME_ERROR,a,e),"";let n=e;for(;;){let i=t[a][n];if(typeof i=="string"&&i.charAt(0)==="$")n=i.substr(1);else return i}}const AX=kt("input",{$reset:"",padding:"0 $sm",width:0,minWidth:0,flex:1,height:"100%",variants:{levaType:{number:{textAlign:"right"}},as:{textarea:{padding:"$sm"}}}}),hX=kt("div",{$draggable:"",height:"100%",$flexCenter:"",position:"relative",padding:"0 $xs",fontSize:"0.8em",opacity:.8,cursor:"default",touchAction:"none",[`& + ${AX}`]:{paddingLeft:0}}),AP=kt(hX,{cursor:"ew-resize",marginRight:"-$xs",textTransform:"uppercase",opacity:.3,"&:hover":{opacity:1},variants:{dragging:{true:{backgroundColor:"$accent2",opacity:1}}}}),hP=kt("div",{$flex:"",position:"relative",borderRadius:"$sm",overflow:"hidden",color:"inherit",height:"$rowHeight",backgroundColor:"$elevation3",$inputStyle:"$elevation1",$hover:"",$focusWithin:"",variants:{textArea:{true:{height:"auto"}}}}),fP=["innerLabel","value","onUpdate","onChange","onKeyDown","type","id","inputType","rows"],pP=["onUpdate"];function DZ(a){let{innerLabel:e,value:t,onUpdate:n,onChange:i,onKeyDown:s,type:o,id:r,inputType:g="text",rows:u=0}=a,C=ri(a,fP);const{id:h,emitOnEditStart:f,emitOnEditEnd:p,disabled:y}=Ss(),v=r||h,G=E.useRef(null),B=u>0,R=B?"textarea":"input",x=E.useCallback(H=>N=>{const F=N.currentTarget.value;H(F)},[]);fe.useEffect(()=>{const H=G.current,N=x(F=>{n(F),p()});return H?.addEventListener("blur",N),()=>H?.removeEventListener("blur",N)},[x,n,p]);const w=E.useCallback(H=>{H.key==="Enter"&&x(n)(H)},[x,n]),M=Object.assign({as:R},B?{rows:u}:{},C);return fe.createElement(hP,{textArea:B},e&&typeof e=="string"?fe.createElement(hX,null,e):e,fe.createElement(AX,ia({levaType:o,ref:G,id:v,type:g,autoComplete:"off",spellCheck:"false",value:t,onChange:x(i),onFocus:()=>f(),onKeyPress:w,onKeyDown:s,disabled:y},M)))}function mP(a){let{onUpdate:e}=a,t=ri(a,pP);const n=E.useCallback(s=>e(JJ(s)),[e]),i=E.useCallback(s=>{const o=s.key==="ArrowUp"?1:s.key==="ArrowDown"?-1:0;if(o){s.preventDefault();const r=s.altKey?.1:s.shiftKey?10:1;e(g=>parseFloat(g)+o*r)}},[e]);return fe.createElement(DZ,ia({},t,{onUpdate:n,onKeyDown:i,type:"number"}))}const q0=kt("div",{}),B2=kt("div",{position:"relative",background:"$elevation2",transition:"height 300ms ease",variants:{fill:{true:{},false:{}},flat:{false:{},true:{}},isRoot:{true:{},false:{paddingLeft:"$md","&::after":{content:'""',position:"absolute",left:0,top:0,width:"$borderWidths$folder",height:"100%",backgroundColor:"$folderWidgetColor",opacity:.4,transform:"translateX(-50%)"}}}},compoundVariants:[{isRoot:!0,fill:!1,css:{overflowY:"auto",maxHeight:"calc(100vh - 20px - $$titleBarHeight)"}},{isRoot:!0,flat:!1,css:{borderRadius:"$lg"}}]}),bP=kt("div",{$flex:"",color:"$folderTextColor",userSelect:"none",cursor:"pointer",height:"$folderTitleHeight",fontWeight:"$folder","> svg":{marginLeft:-4,marginRight:4,cursor:"pointer",fill:"$folderWidgetColor",opacity:.6},"&:hover > svg":{fill:"$folderWidgetColor"},[`&:hover + ${B2}::after`]:{opacity:.6},[`${q0}:hover > & + ${B2}::after`]:{opacity:.6},[`${q0}:hover > & > svg`]:{opacity:1}}),fX=kt("div",{position:"relative",display:"grid",gridTemplateColumns:"100%",rowGap:"$rowGap",transition:"opacity 250ms ease",variants:{toggled:{true:{opacity:1,transitionDelay:"250ms"},false:{opacity:0,transitionDelay:"0ms",pointerEvents:"none"}},isRoot:{true:{"& > div":{paddingLeft:"$md",paddingRight:"$md"},"& > div:first-of-type":{paddingTop:"$sm"},"& > div:last-of-type":{paddingBottom:"$sm"},[`> ${q0}:not(:first-of-type)`]:{paddingTop:"$sm",marginTop:"$md",borderTop:"$borderWidths$folder solid $colors$elevation1"}}}}}),pX=kt("div",{position:"relative",zIndex:100,display:"grid",rowGap:"$rowGap",gridTemplateRows:"minmax($sizes$rowHeight, max-content)",alignItems:"center",color:"$highlight2",[`${fX} > &`]:{"&:first-of-type":{marginTop:"$rowGap"},"&:last-of-type":{marginBottom:"$rowGap"}},variants:{disabled:{true:{pointerEvents:"none"},false:{"&:hover,&:focus-within":{color:"$highlight3"}}}}}),mX=kt(pX,{gridTemplateColumns:"auto $sizes$controlWidth",columnGap:"$colGap"}),yP=kt("div",{$flex:"",height:"100%",position:"relative",overflow:"hidden","& > div":{marginLeft:"$colGap",padding:"0 $xs",opacity:.4},"& > div:hover":{opacity:.8},"& > div > svg":{display:"none",cursor:"pointer",width:13,minWidth:13,height:13,backgroundColor:"$elevation2"},"&:hover > div > svg":{display:"block"},variants:{align:{top:{height:"100%",alignItems:"flex-start",paddingTop:"$sm"}}}}),GP=kt("input",{$reset:"",height:0,width:0,opacity:0,margin:0,"& + label":{position:"relative",$flexCenter:"",height:"100%",userSelect:"none",cursor:"pointer",paddingLeft:2,paddingRight:"$sm",pointerEvents:"auto"},"& + label:after":{content:'""',width:6,height:6,backgroundColor:"$elevation3",borderRadius:"50%",$activeStyle:""},"&:focus + label:after":{$focusStyle:""},"& + label:active:after":{backgroundColor:"$accent1",$focusStyle:""},"&:checked + label:after":{backgroundColor:"$accent1"}}),v2=kt("label",{fontWeight:"$label",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap","& > svg":{display:"block"}}),BP=kt("div",{opacity:1,variants:{disabled:{true:{opacity:.6,pointerEvents:"none",[`& ${v2}`]:{pointerEvents:"auto"}}}}}),bX=kt("div",{position:"fixed",top:0,bottom:0,right:0,left:0,zIndex:1e3,userSelect:"none"}),vP=kt("div",{background:"$toolTipBackground",fontFamily:"$sans",fontSize:"$toolTip",padding:"$xs $sm",color:"$toolTipText",borderRadius:"$xs",boxShadow:"$level2",maxWidth:260}),ZP=kt(EJ,{fill:"$toolTipBackground"});function kZ({children:a}){const{className:e}=E.useContext(UZ);return fe.createElement(Rk,{className:e},a)}const SP=["align"];function RP(){const{id:a,disable:e,disabled:t}=Ss();return fe.createElement(fe.Fragment,null,fe.createElement(GP,{id:a+"__disable",type:"checkbox",checked:!t,onChange:()=>e(!t)}),fe.createElement("label",{htmlFor:a+"__disable"}))}function wP(a){const{id:e,optional:t,hint:n}=Ss(),i=a.htmlFor||(e?{htmlFor:e}:null),s=!n&&typeof a.children=="string"?{title:a.children}:null;return fe.createElement(fe.Fragment,null,t&&fe.createElement(RP,null),n!==void 0?fe.createElement(YJ,null,fe.createElement(KJ,{asChild:!0},fe.createElement(v2,ia({},i,a))),fe.createElement(FJ,{side:"top",sideOffset:2},fe.createElement(vP,null,n,fe.createElement(ZP,null)))):fe.createElement(v2,ia({},i,s,a)))}function vr(a){let{align:e}=a,t=ri(a,SP);const{value:n,label:i,key:s,disabled:o}=Ss(),{hideCopyButton:r}=cP(),g=!r&&s!==void 0,[u,C]=E.useState(!1),h=async()=>{try{await navigator.clipboard.writeText(JSON.stringify({[s]:n??""})),C(!0)}catch{oc(ki.CLIPBOARD_ERROR,{[s]:n})}};return fe.createElement(yP,{align:e,onPointerLeave:()=>C(!1)},fe.createElement(wP,t),g&&!o&&fe.createElement("div",{title:`Click to copy ${typeof i=="string"?i:s} value`},u?fe.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor"},fe.createElement("path",{d:"M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"}),fe.createElement("path",{fillRule:"evenodd",d:"M4 5a2 2 0 012-2 3 3 0 003 3h2a3 3 0 003-3 2 2 0 012 2v11a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm9.707 5.707a1 1 0 00-1.414-1.414L9 12.586l-1.293-1.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z",clipRule:"evenodd"})):fe.createElement("svg",{onClick:h,xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor"},fe.createElement("path",{d:"M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z"}),fe.createElement("path",{d:"M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z"}))))}const xP=["toggled"],WP=kt("svg",{fill:"currentColor",transition:"transform 350ms ease, fill 250ms ease"});function OZ(a){let{toggled:e}=a,t=ri(a,xP);return fe.createElement(WP,ia({width:"9",height:"5",viewBox:"0 0 9 5",xmlns:"http://www.w3.org/2000/svg",style:{transform:`rotate(${e?0:-90}deg)`}},t),fe.createElement("path",{d:"M3.8 4.4c.4.3 1 .3 1.4 0L8 1.7A1 1 0 007.4 0H1.6a1 1 0 00-.7 1.7l3 2.7z"}))}const VP=["input"];function wl(a){let{input:e}=a,t=ri(a,VP);return e?fe.createElement(mX,t):fe.createElement(pX,t)}function yX({value:a,type:e,settings:t,setValue:n}){const[i,s]=E.useState(Ix(e,a,t)),o=E.useRef(a),r=E.useRef(t);r.current=t;const g=E.useCallback(C=>s(Ix(e,C,r.current)),[e]),u=E.useCallback(C=>{try{n(C)}catch(h){const{type:f,previousValue:p}=h;if(f!=="LEVA_ERROR")throw h;g(p)}},[g,n]);return E.useEffect(()=>{Ff(a,o.current)||g(a),o.current=a},[a,g]),{displayValue:i,onChange:s,onUpdate:u}}function lp(a,e){const{emitOnEditStart:t,emitOnEditEnd:n}=Ss();return bU(i=>{i.first&&(document.body.classList.add("leva__panel__dragged"),t?.());const s=a(i);return i.last&&(document.body.classList.remove("leva__panel__dragged"),n?.()),s},e)}function MP(a){const e=E.useRef(null),t=E.useRef(null),n=E.useRef(!1);return E.useEffect(()=>{const i=sX(()=>{e.current.width=e.current.offsetWidth*window.devicePixelRatio,e.current.height=e.current.offsetHeight*window.devicePixelRatio,a(e.current,t.current)},250);return window.addEventListener("resize",i),n.current||(i(),n.current=!0),()=>window.removeEventListener("resize",i)},[a]),E.useEffect(()=>{t.current=e.current.getContext("2d")},[]),[e,t]}function GX(){const a=E.useRef(null),e=E.useRef({x:0,y:0}),t=E.useCallback(n=>{Object.assign(e.current,n),a.current&&(a.current.style.transform=`translate3d(${e.current.x}px, ${e.current.y}px, 0)`)},[]);return[a,t]}const HP=["__refCount"],lv=(a,e)=>{if(!a[e])return null;const t=a[e];return ri(t,HP)};function XP(a){const e=op(),[t,n]=E.useState(lv(e.getData(),a)),i=E.useCallback(u=>e.setValueAtPath(a,u,!0),[a,e]),s=E.useCallback(u=>e.setSettingsAtPath(a,u),[a,e]),o=E.useCallback(u=>e.disableInputAtPath(a,u),[a,e]),r=E.useCallback(()=>e.emitOnEditStart(a),[a,e]),g=E.useCallback(()=>e.emitOnEditEnd(a),[a,e]);return E.useEffect(()=>{n(lv(e.getData(),a));const u=e.useStore.subscribe(C=>lv(C.data,a),n,{equalityFn:Jy});return()=>u()},[e,a]),[t,{set:i,setSettings:s,disable:o,storeId:e.storeId,emitOnEditStart:r,emitOnEditEnd:g}]}const NP=kt("div",{variants:{hasRange:{true:{position:"relative",display:"grid",gridTemplateColumns:"auto $sizes$numberInputMinWidth",columnGap:"$colGap",alignItems:"center"}}}}),BX=kt("div",{position:"relative",width:"100%",height:2,borderRadius:"$xs",backgroundColor:"$elevation1"}),Z2=kt("div",{position:"absolute",width:"$scrubberWidth",height:"$scrubberHeight",borderRadius:"$xs",boxShadow:"0 0 0 2px $colors$elevation2",backgroundColor:"$accent2",cursor:"pointer",$active:"none $accent1",$hover:"none $accent3",variants:{position:{left:{borderTopRightRadius:0,borderBottomRightRadius:0,transform:"translateX(calc(-0.5 * ($sizes$scrubberWidth + 4px)))"},right:{borderTopLeftRadius:0,borderBottomLeftRadius:0,transform:"translateX(calc(0.5 * ($sizes$scrubberWidth + 4px)))"}}}}),vX=kt("div",{position:"relative",$flex:"",height:"100%",cursor:"pointer",touchAction:"none"}),ZX=kt("div",{position:"absolute",height:"100%",backgroundColor:"$accent2"});function YP({value:a,min:e,max:t,onDrag:n,step:i,initialValue:s}){const o=E.useRef(null),r=E.useRef(null),g=E.useRef(0),u=Ac("sizes","scrubberWidth"),C=lp(({event:f,first:p,xy:[y],movement:[v],memo:G})=>{if(p){const{width:R,left:x}=o.current.getBoundingClientRect();g.current=R-parseFloat(u),G=f?.target===r.current?a:j0((y-x)/R,e,t)}const B=G+j0(v/g.current,0,t-e);return n(gX(B,{step:i,initialValue:s})),G}),h=Q0(a,e,t);return fe.createElement(vX,ia({ref:o},C()),fe.createElement(BX,null,fe.createElement(ZX,{style:{left:0,right:`${(1-h)*100}%`}})),fe.createElement(Z2,{ref:r,style:{left:`calc(${h} * (100% - ${u}))`}}))}const KP=fe.memo(({label:a,onUpdate:e,step:t,innerLabelTrim:n})=>{const[i,s]=E.useState(!1),o=lp(({active:r,delta:[g],event:u,memo:C=0,first:h,last:f,target:p})=>(h&&p.requestPointerLock(),f&&document.exitPointerLock(),s(r),C+=g/2,Math.abs(C)>=1&&(e(y=>parseFloat(y)+Math.floor(C)*t*oX(u)),C=0),C));return fe.createElement(AP,ia({dragging:i,title:a.length>1?a:""},o()),a.slice(0,n))});function SX({label:a,id:e,displayValue:t,onUpdate:n,onChange:i,settings:s,innerLabelTrim:o=1}){const r=o>0&&fe.createElement(KP,{label:a,step:s.step,onUpdate:n,innerLabelTrim:o});return fe.createElement(mP,{id:e,value:String(t),onUpdate:n,onChange:i,innerLabel:r})}function FP(){const a=Ss(),{label:e,value:t,onUpdate:n,settings:i,id:s}=a,{min:o,max:r}=i,g=r!==1/0&&o!==-1/0;return fe.createElement(wl,{input:!0},fe.createElement(vr,null,e),fe.createElement(NP,{hasRange:g},g&&fe.createElement(YP,ia({value:parseFloat(t),onDrag:n},i)),fe.createElement(SX,ia({},a,{id:s,label:"value",innerLabelTrim:g?0:1}))))}const{sanitizeStep:EP}=cX,TP=ri(cX,["sanitizeStep"]);var zP=jt({component:FP},TP);const LP=(a,e)=>xo().schema({options:xo().passesAnyOf(xo().object(),xo().array())}).test(e),_P=(a,{values:e})=>{if(e.indexOf(a)<0)throw Error("Selected value doesn't match Select options");return a},UP=(a,{values:e})=>e.indexOf(a),DP=a=>{let{value:e,options:t}=a,n,i;return Array.isArray(t)?(i=t,n=t.map(s=>String(s))):(i=Object.values(t),n=Object.keys(t)),"value"in a?i.includes(e)||(n.unshift(String(e)),i.unshift(e)):e=i[0],Object.values(t).includes(e)||(t[String(e)]=e),{value:e,settings:{keys:n,values:i}}};var kP=Object.freeze({__proto__:null,schema:LP,sanitize:_P,format:UP,normalize:DP});const OP=kt("div",{$flexCenter:"",position:"relative","> svg":{pointerEvents:"none",position:"absolute",right:"$md"}}),S2=kt("select",{position:"absolute",top:0,left:0,width:"100%",height:"100%",opacity:0}),JP=kt("div",{display:"flex",alignItems:"center",width:"100%",height:"$rowHeight",backgroundColor:"$elevation3",borderRadius:"$sm",padding:"0 $sm",cursor:"pointer",[`${S2}:focus + &`]:{$focusStyle:""},[`${S2}:hover + &`]:{$hoverStyle:""}});function PP({displayValue:a,value:e,onUpdate:t,id:n,settings:i,disabled:s}){const{keys:o,values:r}=i,g=E.useRef();return e===r[a]&&(g.current=o[a]),fe.createElement(OP,null,fe.createElement(S2,{id:n,value:a,onChange:u=>t(r[Number(u.currentTarget.value)]),disabled:s},o.map((u,C)=>fe.createElement("option",{key:u,value:C},u))),fe.createElement(JP,null,g.current),fe.createElement(OZ,{toggled:!0}))}function QP(){const{label:a,value:e,displayValue:t,onUpdate:n,id:i,disabled:s,settings:o}=Ss();return fe.createElement(wl,{input:!0},fe.createElement(vr,null,a),fe.createElement(PP,{id:i,value:e,displayValue:t,onUpdate:n,settings:o,disabled:s}))}var jP=jt({component:QP},kP);const qP=a=>xo().string().test(a),$P=a=>{if(typeof a!="string")throw Error("Invalid string");return a},eQ=({value:a,editable:e=!0,rows:t=!1})=>({value:a,settings:{editable:e,rows:typeof t=="number"?t:t?5:0}});var tQ=Object.freeze({__proto__:null,schema:qP,sanitize:$P,normalize:eQ});const nQ=["displayValue","onUpdate","onChange","editable"],iQ=kt("div",{whiteSpace:"pre-wrap"});function aQ(a){let{displayValue:e,onUpdate:t,onChange:n,editable:i=!0}=a,s=ri(a,nQ);return i?fe.createElement(DZ,ia({value:e,onUpdate:t,onChange:n},s)):fe.createElement(iQ,null,e)}function sQ(){const{label:a,settings:e,displayValue:t,onUpdate:n,onChange:i}=Ss();return fe.createElement(wl,{input:!0},fe.createElement(vr,null,a),fe.createElement(aQ,ia({displayValue:t,onUpdate:n,onChange:i},e)))}var oQ=jt({component:sQ},tQ);const lQ=a=>xo().boolean().test(a),rQ=a=>{if(typeof a!="boolean")throw Error("Invalid boolean");return a};var gQ=Object.freeze({__proto__:null,schema:lQ,sanitize:rQ});const cQ=kt("div",{position:"relative",$flex:"",height:"$rowHeight",input:{$reset:"",height:0,width:0,opacity:0,margin:0},label:{position:"relative",$flexCenter:"",userSelect:"none",cursor:"pointer",height:"$checkboxSize",width:"$checkboxSize",backgroundColor:"$elevation3",borderRadius:"$sm",$hover:""},"input:focus + label":{$focusStyle:""},"input:focus:checked + label, input:checked + label:hover":{$hoverStyle:"$accent3"},"input + label:active":{backgroundColor:"$accent1"},"input:checked + label:active":{backgroundColor:"$accent1"},"label > svg":{display:"none",width:"90%",height:"90%",stroke:"$highlight3"},"input:checked + label":{backgroundColor:"$accent2"},"input:checked + label > svg":{display:"block"}});function uQ({value:a,onUpdate:e,id:t,disabled:n}){return fe.createElement(cQ,null,fe.createElement("input",{id:t,type:"checkbox",checked:a,onChange:i=>e(i.currentTarget.checked),disabled:n}),fe.createElement("label",{htmlFor:t},fe.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},fe.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"}))))}function IQ(){const{label:a,value:e,onUpdate:t,disabled:n,id:i}=Ss();return fe.createElement(wl,{input:!0},fe.createElement(vr,null,a),fe.createElement(uQ,{value:e,onUpdate:t,id:i,disabled:n}))}var CQ=jt({component:IQ},gQ);const dQ=["locked"];function AQ({value:a,id:e,valueKey:t,settings:n,onUpdate:i,innerLabelTrim:s}){const o=E.useRef(a[t]);o.current=a[t];const r=E.useCallback(u=>i({[t]:aX({type:"NUMBER",value:o.current,settings:n},u)}),[i,n,t]),g=yX({type:"NUMBER",value:a[t],settings:n,setValue:r});return fe.createElement(SX,{id:e,label:t,value:a[t],displayValue:g.displayValue,onUpdate:g.onUpdate,onChange:g.onChange,settings:n,innerLabelTrim:s})}const hQ=kt("div",{display:"grid",columnGap:"$colGap",gridAutoFlow:"column dense",alignItems:"center",variants:{withLock:{true:{gridTemplateColumns:"10px auto","> svg":{cursor:"pointer"}}}}});function fQ(a){let{locked:e}=a,t=ri(a,dQ);return fe.createElement("svg",ia({width:"10",height:"10",viewBox:"0 0 15 15",fill:"none",xmlns:"http://www.w3.org/2000/svg"},t),e?fe.createElement("path",{d:"M5 4.63601C5 3.76031 5.24219 3.1054 5.64323 2.67357C6.03934 2.24705 6.64582 1.9783 7.5014 1.9783C8.35745 1.9783 8.96306 2.24652 9.35823 2.67208C9.75838 3.10299 10 3.75708 10 4.63325V5.99999H5V4.63601ZM4 5.99999V4.63601C4 3.58148 4.29339 2.65754 4.91049 1.99307C5.53252 1.32329 6.42675 0.978302 7.5014 0.978302C8.57583 0.978302 9.46952 1.32233 10.091 1.99162C10.7076 2.65557 11 3.57896 11 4.63325V5.99999H12C12.5523 5.99999 13 6.44771 13 6.99999V13C13 13.5523 12.5523 14 12 14H3C2.44772 14 2 13.5523 2 13V6.99999C2 6.44771 2.44772 5.99999 3 5.99999H4ZM3 6.99999H12V13H3V6.99999Z",fill:"currentColor",fillRule:"evenodd",clipRule:"evenodd"}):fe.createElement("path",{d:"M9 3.63601C9 2.76044 9.24207 2.11211 9.64154 1.68623C10.0366 1.26502 10.6432 1 11.5014 1C12.4485 1 13.0839 1.30552 13.4722 1.80636C13.8031 2.23312 14 2.84313 14 3.63325H15C15 2.68242 14.7626 1.83856 14.2625 1.19361C13.6389 0.38943 12.6743 0 11.5014 0C10.4294 0 9.53523 0.337871 8.91218 1.0021C8.29351 1.66167 8 2.58135 8 3.63601V6H1C0.447715 6 0 6.44772 0 7V13C0 13.5523 0.447715 14 1 14H10C10.5523 14 11 13.5523 11 13V7C11 6.44772 10.5523 6 10 6H9V3.63601ZM1 7H10V13H1V7Z",fill:"currentColor",fillRule:"evenodd",clipRule:"evenodd"}))}function JZ({value:a,onUpdate:e,settings:t,innerLabelTrim:n}){const{id:i,setSettings:s}=Ss(),{lock:o,locked:r}=t;return fe.createElement(hQ,{withLock:o},o&&fe.createElement(fQ,{locked:r,onClick:()=>s({locked:!r})}),Object.keys(a).map((g,u)=>fe.createElement(AQ,{id:u===0?i:`${i}.${g}`,key:g,valueKey:g,value:a,settings:t[g],onUpdate:e,innerLabelTrim:n})))}const RX=(a,e)=>{const t={};let n=0,i=1/0;Object.entries(a).forEach(([s,o])=>{t[s]=rX(jt({value:o},e[s])).settings,n=Math.max(n,t[s].step),i=Math.min(i,t[s].pad)});for(let s in t){const{step:o,min:r,max:g}=e[s]||{};!isFinite(o)&&(!isFinite(r)||!isFinite(g))&&(t[s].step=n,t[s].pad=i)}return t},pQ=["lock"],mQ=["value"];function bQ(a){const e=xo().array().length(a).every.number(),t=n=>{if(!n||typeof n!="object")return!1;const i=Object.values(n);return i.length===a&&i.every(s=>isFinite(s))};return n=>e.test(n)||t(n)}function yQ(a){return Array.isArray(a)?"array":"object"}function Bf(a,e,t){return yQ(a)===e?a:e==="array"?Object.values(a):$J(a,t)}const GQ=(a,e,t)=>{const n=Bf(a,"object",e.keys);for(let o in n)n[o]=lX(n[o],e[o]);const i=Object.keys(n);let s={};if(i.length===e.keys.length)s=n;else{const o=Bf(t,"object",e.keys);if(i.length===1&&e.locked){const r=i[0],g=n[r],u=o[r],C=u!==0?g/u:1;for(let h in o)h===r?s[r]=g:s[h]=o[h]*C}else s=jt(jt({},o),n)}return Bf(s,e.format,e.keys)},BQ=(a,e)=>Bf(a,"object",e.keys),vQ=a=>!!a&&("step"in a||"min"in a||"max"in a);function ZQ(a,e,t=[]){const{lock:n=!1}=e,i=ri(e,pQ),s=Array.isArray(a)?"array":"object",o=s==="object"?Object.keys(a):t,r=Bf(a,"object",o),g=vQ(i)?o.reduce((C,h)=>Object.assign(C,{[h]:i}),{}):i,u=RX(r,g);return{value:s==="array"?a:r,settings:jt(jt({},u),{},{format:s,keys:o,lock:n,locked:!1})}}function wX(a){return{schema:bQ(a.length),normalize:e=>{let{value:t}=e,n=ri(e,mQ);return ZQ(t,n,a)},format:(e,t)=>BQ(e,t),sanitize:(e,t,n)=>GQ(e,t,n)}}var SQ={grad:.9,turn:360,rad:360/(2*Math.PI)},ec=function(a){return typeof a=="string"?a.length>0:typeof a=="number"},Ka=function(a,e,t){return e===void 0&&(e=0),t===void 0&&(t=Math.pow(10,e)),Math.round(t*a)/t+0},Bl=function(a,e,t){return e===void 0&&(e=0),t===void 0&&(t=1),a>t?t:a>e?a:e},xX=function(a){return(a=isFinite(a)?a%360:0)>0?a:a+360},Gx=function(a){return{r:Bl(a.r,0,255),g:Bl(a.g,0,255),b:Bl(a.b,0,255),a:Bl(a.a)}},rv=function(a){return{r:Ka(a.r),g:Ka(a.g),b:Ka(a.b),a:Ka(a.a,3)}},RQ=/^#([0-9a-f]{3,8})$/i,Vb=function(a){var e=a.toString(16);return e.length<2?"0"+e:e},WX=function(a){var e=a.r,t=a.g,n=a.b,i=a.a,s=Math.max(e,t,n),o=s-Math.min(e,t,n),r=o?s===e?(t-n)/o:s===t?2+(n-e)/o:4+(e-t)/o:0;return{h:60*(r<0?r+6:r),s:s?o/s*100:0,v:s/255*100,a:i}},VX=function(a){var e=a.h,t=a.s,n=a.v,i=a.a;e=e/360*6,t/=100,n/=100;var s=Math.floor(e),o=n*(1-t),r=n*(1-(e-s)*t),g=n*(1-(1-e+s)*t),u=s%6;return{r:255*[n,r,o,o,g,n][u],g:255*[g,n,n,r,o,o][u],b:255*[o,o,g,n,n,r][u],a:i}},Bx=function(a){return{h:xX(a.h),s:Bl(a.s,0,100),l:Bl(a.l,0,100),a:Bl(a.a)}},vx=function(a){return{h:Ka(a.h),s:Ka(a.s),l:Ka(a.l),a:Ka(a.a,3)}},Zx=function(a){return VX((t=(e=a).s,{h:e.h,s:(t*=((n=e.l)<50?n:100-n)/100)>0?2*t/(n+t)*100:0,v:n+t,a:e.a}));var e,t,n},vf=function(a){return{h:(e=WX(a)).h,s:(i=(200-(t=e.s))*(n=e.v)/100)>0&&i<200?t*n/100/(i<=100?i:200-i)*100:0,l:i/2,a:e.a};var e,t,n,i},wQ=/^hsla?\(\s*([+-]?\d*\.?\d+)(deg|rad|grad|turn)?\s*,\s*([+-]?\d*\.?\d+)%\s*,\s*([+-]?\d*\.?\d+)%\s*(?:,\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,xQ=/^hsla?\(\s*([+-]?\d*\.?\d+)(deg|rad|grad|turn)?\s+([+-]?\d*\.?\d+)%\s+([+-]?\d*\.?\d+)%\s*(?:\/\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,WQ=/^rgba?\(\s*([+-]?\d*\.?\d+)(%)?\s*,\s*([+-]?\d*\.?\d+)(%)?\s*,\s*([+-]?\d*\.?\d+)(%)?\s*(?:,\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,VQ=/^rgba?\(\s*([+-]?\d*\.?\d+)(%)?\s+([+-]?\d*\.?\d+)(%)?\s+([+-]?\d*\.?\d+)(%)?\s*(?:\/\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,R2={string:[[function(a){var e=RQ.exec(a);return e?(a=e[1]).length<=4?{r:parseInt(a[0]+a[0],16),g:parseInt(a[1]+a[1],16),b:parseInt(a[2]+a[2],16),a:a.length===4?Ka(parseInt(a[3]+a[3],16)/255,2):1}:a.length===6||a.length===8?{r:parseInt(a.substr(0,2),16),g:parseInt(a.substr(2,2),16),b:parseInt(a.substr(4,2),16),a:a.length===8?Ka(parseInt(a.substr(6,2),16)/255,2):1}:null:null},"hex"],[function(a){var e=WQ.exec(a)||VQ.exec(a);return e?e[2]!==e[4]||e[4]!==e[6]?null:Gx({r:Number(e[1])/(e[2]?100/255:1),g:Number(e[3])/(e[4]?100/255:1),b:Number(e[5])/(e[6]?100/255:1),a:e[7]===void 0?1:Number(e[7])/(e[8]?100:1)}):null},"rgb"],[function(a){var e=wQ.exec(a)||xQ.exec(a);if(!e)return null;var t,n,i=Bx({h:(t=e[1],n=e[2],n===void 0&&(n="deg"),Number(t)*(SQ[n]||1)),s:Number(e[3]),l:Number(e[4]),a:e[5]===void 0?1:Number(e[5])/(e[6]?100:1)});return Zx(i)},"hsl"]],object:[[function(a){var e=a.r,t=a.g,n=a.b,i=a.a,s=i===void 0?1:i;return ec(e)&&ec(t)&&ec(n)?Gx({r:Number(e),g:Number(t),b:Number(n),a:Number(s)}):null},"rgb"],[function(a){var e=a.h,t=a.s,n=a.l,i=a.a,s=i===void 0?1:i;if(!ec(e)||!ec(t)||!ec(n))return null;var o=Bx({h:Number(e),s:Number(t),l:Number(n),a:Number(s)});return Zx(o)},"hsl"],[function(a){var e=a.h,t=a.s,n=a.v,i=a.a,s=i===void 0?1:i;if(!ec(e)||!ec(t)||!ec(n))return null;var o=function(r){return{h:xX(r.h),s:Bl(r.s,0,100),v:Bl(r.v,0,100),a:Bl(r.a)}}({h:Number(e),s:Number(t),v:Number(n),a:Number(s)});return VX(o)},"hsv"]]},Sx=function(a,e){for(var t=0;t<e.length;t++){var n=e[t][0](a);if(n)return[n,e[t][1]]}return[null,void 0]},MX=function(a){return typeof a=="string"?Sx(a.trim(),R2.string):typeof a=="object"&&a!==null?Sx(a,R2.object):[null,void 0]},MQ=function(a){return MX(a)[1]},gv=function(a,e){var t=vf(a);return{h:t.h,s:Bl(t.s+100*e,0,100),l:t.l,a:t.a}},cv=function(a){return(299*a.r+587*a.g+114*a.b)/1e3/255},Rx=function(a,e){var t=vf(a);return{h:t.h,s:t.s,l:Bl(t.l+100*e,0,100),a:t.a}},w2=function(){function a(e){this.parsed=MX(e)[0],this.rgba=this.parsed||{r:0,g:0,b:0,a:1}}return a.prototype.isValid=function(){return this.parsed!==null},a.prototype.brightness=function(){return Ka(cv(this.rgba),2)},a.prototype.isDark=function(){return cv(this.rgba)<.5},a.prototype.isLight=function(){return cv(this.rgba)>=.5},a.prototype.toHex=function(){return e=rv(this.rgba),t=e.r,n=e.g,i=e.b,o=(s=e.a)<1?Vb(Ka(255*s)):"","#"+Vb(t)+Vb(n)+Vb(i)+o;var e,t,n,i,s,o},a.prototype.toRgb=function(){return rv(this.rgba)},a.prototype.toRgbString=function(){return e=rv(this.rgba),t=e.r,n=e.g,i=e.b,(s=e.a)<1?"rgba("+t+", "+n+", "+i+", "+s+")":"rgb("+t+", "+n+", "+i+")";var e,t,n,i,s},a.prototype.toHsl=function(){return vx(vf(this.rgba))},a.prototype.toHslString=function(){return e=vx(vf(this.rgba)),t=e.h,n=e.s,i=e.l,(s=e.a)<1?"hsla("+t+", "+n+"%, "+i+"%, "+s+")":"hsl("+t+", "+n+"%, "+i+"%)";var e,t,n,i,s},a.prototype.toHsv=function(){return e=WX(this.rgba),{h:Ka(e.h),s:Ka(e.s),v:Ka(e.v),a:Ka(e.a,3)};var e},a.prototype.invert=function(){return Os({r:255-(e=this.rgba).r,g:255-e.g,b:255-e.b,a:e.a});var e},a.prototype.saturate=function(e){return e===void 0&&(e=.1),Os(gv(this.rgba,e))},a.prototype.desaturate=function(e){return e===void 0&&(e=.1),Os(gv(this.rgba,-e))},a.prototype.grayscale=function(){return Os(gv(this.rgba,-1))},a.prototype.lighten=function(e){return e===void 0&&(e=.1),Os(Rx(this.rgba,e))},a.prototype.darken=function(e){return e===void 0&&(e=.1),Os(Rx(this.rgba,-e))},a.prototype.rotate=function(e){return e===void 0&&(e=15),this.hue(this.hue()+e)},a.prototype.alpha=function(e){return typeof e=="number"?Os({r:(t=this.rgba).r,g:t.g,b:t.b,a:e}):Ka(this.rgba.a,3);var t},a.prototype.hue=function(e){var t=vf(this.rgba);return typeof e=="number"?Os({h:e,s:t.s,l:t.l,a:t.a}):Ka(t.h)},a.prototype.isEqual=function(e){return this.toHex()===Os(e).toHex()},a}(),Os=function(a){return a instanceof w2?a:new w2(a)},wx=[],HQ=function(a){a.forEach(function(e){wx.indexOf(e)<0&&(e(w2,R2),wx.push(e))})};function XQ(a,e){var t={white:"#ffffff",bisque:"#ffe4c4",blue:"#0000ff",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",antiquewhite:"#faebd7",aqua:"#00ffff",azure:"#f0ffff",whitesmoke:"#f5f5f5",papayawhip:"#ffefd5",plum:"#dda0dd",blanchedalmond:"#ffebcd",black:"#000000",gold:"#ffd700",goldenrod:"#daa520",gainsboro:"#dcdcdc",cornsilk:"#fff8dc",cornflowerblue:"#6495ed",burlywood:"#deb887",aquamarine:"#7fffd4",beige:"#f5f5dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkkhaki:"#bdb76b",darkgray:"#a9a9a9",darkgreen:"#006400",darkgrey:"#a9a9a9",peachpuff:"#ffdab9",darkmagenta:"#8b008b",darkred:"#8b0000",darkorchid:"#9932cc",darkorange:"#ff8c00",darkslateblue:"#483d8b",gray:"#808080",darkslategray:"#2f4f4f",darkslategrey:"#2f4f4f",deeppink:"#ff1493",deepskyblue:"#00bfff",wheat:"#f5deb3",firebrick:"#b22222",floralwhite:"#fffaf0",ghostwhite:"#f8f8ff",darkviolet:"#9400d3",magenta:"#ff00ff",green:"#008000",dodgerblue:"#1e90ff",grey:"#808080",honeydew:"#f0fff0",hotpink:"#ff69b4",blueviolet:"#8a2be2",forestgreen:"#228b22",lawngreen:"#7cfc00",indianred:"#cd5c5c",indigo:"#4b0082",fuchsia:"#ff00ff",brown:"#a52a2a",maroon:"#800000",mediumblue:"#0000cd",lightcoral:"#f08080",darkturquoise:"#00ced1",lightcyan:"#e0ffff",ivory:"#fffff0",lightyellow:"#ffffe0",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",linen:"#faf0e6",mediumaquamarine:"#66cdaa",lemonchiffon:"#fffacd",lime:"#00ff00",khaki:"#f0e68c",mediumseagreen:"#3cb371",limegreen:"#32cd32",mediumspringgreen:"#00fa9a",lightskyblue:"#87cefa",lightblue:"#add8e6",midnightblue:"#191970",lightpink:"#ffb6c1",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",mintcream:"#f5fffa",lightslategray:"#778899",lightslategrey:"#778899",navajowhite:"#ffdead",navy:"#000080",mediumvioletred:"#c71585",powderblue:"#b0e0e6",palegoldenrod:"#eee8aa",oldlace:"#fdf5e6",paleturquoise:"#afeeee",mediumturquoise:"#48d1cc",mediumorchid:"#ba55d3",rebeccapurple:"#663399",lightsteelblue:"#b0c4de",mediumslateblue:"#7b68ee",thistle:"#d8bfd8",tan:"#d2b48c",orchid:"#da70d6",mediumpurple:"#9370db",purple:"#800080",pink:"#ffc0cb",skyblue:"#87ceeb",springgreen:"#00ff7f",palegreen:"#98fb98",red:"#ff0000",yellow:"#ffff00",slateblue:"#6a5acd",lavenderblush:"#fff0f5",peru:"#cd853f",palevioletred:"#db7093",violet:"#ee82ee",teal:"#008080",slategray:"#708090",slategrey:"#708090",aliceblue:"#f0f8ff",darkseagreen:"#8fbc8f",darkolivegreen:"#556b2f",greenyellow:"#adff2f",seagreen:"#2e8b57",seashell:"#fff5ee",tomato:"#ff6347",silver:"#c0c0c0",sienna:"#a0522d",lavender:"#e6e6fa",lightgreen:"#90ee90",orange:"#ffa500",orangered:"#ff4500",steelblue:"#4682b4",royalblue:"#4169e1",turquoise:"#40e0d0",yellowgreen:"#9acd32",salmon:"#fa8072",saddlebrown:"#8b4513",sandybrown:"#f4a460",rosybrown:"#bc8f8f",darksalmon:"#e9967a",lightgoldenrodyellow:"#fafad2",snow:"#fffafa",lightgrey:"#d3d3d3",lightgray:"#d3d3d3",dimgray:"#696969",dimgrey:"#696969",olivedrab:"#6b8e23",olive:"#808000"},n={};for(var i in t)n[t[i]]=i;var s={};a.prototype.toName=function(o){if(!(this.rgba.a||this.rgba.r||this.rgba.g||this.rgba.b))return"transparent";var r,g,u=n[this.toHex()];if(u)return u;if(o?.closest){var C=this.toRgb(),h=1/0,f="black";if(!s.length)for(var p in t)s[p]=new a(t[p]).toRgb();for(var y in t){var v=(r=C,g=s[y],Math.pow(r.r-g.r,2)+Math.pow(r.g-g.g,2)+Math.pow(r.b-g.b,2));v<h&&(h=v,f=y)}return f}},e.string.push([function(o){var r=o.toLowerCase(),g=r==="transparent"?"#0000":t[r];return g?new a(g).toRgb():null},"name"])}function yA(){return(yA=Object.assign||function(a){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(a[n]=t[n])}return a}).apply(this,arguments)}function PZ(a,e){if(a==null)return{};var t,n,i={},s=Object.keys(a);for(n=0;n<s.length;n++)e.indexOf(t=s[n])>=0||(i[t]=a[t]);return i}function x2(a){var e=E.useRef(a),t=E.useRef(function(n){e.current&&e.current(n)});return e.current=a,t.current}var cA=function(a,e,t){return e===void 0&&(e=0),t===void 0&&(t=1),a>t?t:a<e?e:a},Zf=function(a){return"touches"in a},W2=function(a){return a&&a.ownerDocument.defaultView||self},xx=function(a,e,t){var n=a.getBoundingClientRect(),i=Zf(e)?function(s,o){for(var r=0;r<s.length;r++)if(s[r].identifier===o)return s[r];return s[0]}(e.touches,t):e;return{left:cA((i.pageX-(n.left+W2(a).pageXOffset))/n.width),top:cA((i.pageY-(n.top+W2(a).pageYOffset))/n.height)}},Wx=function(a){!Zf(a)&&a.preventDefault()},QZ=fe.memo(function(a){var e=a.onMove,t=a.onKey,n=PZ(a,["onMove","onKey"]),i=E.useRef(null),s=x2(e),o=x2(t),r=E.useRef(null),g=E.useRef(!1),u=E.useMemo(function(){var p=function(G){Wx(G),(Zf(G)?G.touches.length>0:G.buttons>0)&&i.current?s(xx(i.current,G,r.current)):v(!1)},y=function(){return v(!1)};function v(G){var B=g.current,R=W2(i.current),x=G?R.addEventListener:R.removeEventListener;x(B?"touchmove":"mousemove",p),x(B?"touchend":"mouseup",y)}return[function(G){var B=G.nativeEvent,R=i.current;if(R&&(Wx(B),!function(w,M){return M&&!Zf(w)}(B,g.current)&&R)){if(Zf(B)){g.current=!0;var x=B.changedTouches||[];x.length&&(r.current=x[0].identifier)}R.focus(),s(xx(R,B,r.current)),v(!0)}},function(G){var B=G.which||G.keyCode;B<37||B>40||(G.preventDefault(),o({left:B===39?.05:B===37?-.05:0,top:B===40?.05:B===38?-.05:0}))},v]},[o,s]),C=u[0],h=u[1],f=u[2];return E.useEffect(function(){return f},[f]),fe.createElement("div",yA({},n,{onTouchStart:C,onMouseDown:C,className:"react-colorful__interactive",ref:i,onKeyDown:h,tabIndex:0,role:"slider"}))}),rp=function(a){return a.filter(Boolean).join(" ")},jZ=function(a){var e=a.color,t=a.left,n=a.top,i=n===void 0?.5:n,s=rp(["react-colorful__pointer",a.className]);return fe.createElement("div",{className:s,style:{top:100*i+"%",left:100*t+"%"}},fe.createElement("div",{className:"react-colorful__pointer-fill",style:{backgroundColor:e}}))},$s=function(a,e,t){return e===void 0&&(e=0),t===void 0&&(t=Math.pow(10,e)),Math.round(t*a)/t},HX=function(a){var e=a.s,t=a.v,n=a.a,i=(200-e)*t/100;return{h:$s(a.h),s:$s(i>0&&i<200?e*t/100/(i<=100?i:200-i)*100:0),l:$s(i/2),a:$s(n,2)}},V2=function(a){var e=HX(a);return"hsl("+e.h+", "+e.s+"%, "+e.l+"%)"},uv=function(a){var e=HX(a);return"hsla("+e.h+", "+e.s+"%, "+e.l+"%, "+e.a+")"},XX=function(a){var e=a.h,t=a.s,n=a.v,i=a.a;e=e/360*6,t/=100,n/=100;var s=Math.floor(e),o=n*(1-t),r=n*(1-(e-s)*t),g=n*(1-(1-e+s)*t),u=s%6;return{r:$s(255*[n,r,o,o,g,n][u]),g:$s(255*[g,n,n,r,o,o][u]),b:$s(255*[o,o,g,n,n,r][u]),a:$s(i,2)}},NX=function(a){var e=a.r,t=a.g,n=a.b,i=a.a,s=Math.max(e,t,n),o=s-Math.min(e,t,n),r=o?s===e?(t-n)/o:s===t?2+(n-e)/o:4+(e-t)/o:0;return{h:$s(60*(r<0?r+6:r)),s:$s(s?o/s*100:0),v:$s(s/255*100),a:i}},YX=fe.memo(function(a){var e=a.hue,t=a.onChange,n=rp(["react-colorful__hue",a.className]);return fe.createElement("div",{className:n},fe.createElement(QZ,{onMove:function(i){t({h:360*i.left})},onKey:function(i){t({h:cA(e+360*i.left,0,360)})},"aria-label":"Hue","aria-valuenow":$s(e),"aria-valuemax":"360","aria-valuemin":"0"},fe.createElement(jZ,{className:"react-colorful__hue-pointer",left:e/360,color:V2({h:e,s:100,v:100,a:1})})))}),KX=fe.memo(function(a){var e=a.hsva,t=a.onChange,n={backgroundColor:V2({h:e.h,s:100,v:100,a:1})};return fe.createElement("div",{className:"react-colorful__saturation",style:n},fe.createElement(QZ,{onMove:function(i){t({s:100*i.left,v:100-100*i.top})},onKey:function(i){t({s:cA(e.s+100*i.left,0,100),v:cA(e.v-100*i.top,0,100)})},"aria-label":"Color","aria-valuetext":"Saturation "+$s(e.s)+"%, Brightness "+$s(e.v)+"%"},fe.createElement(jZ,{className:"react-colorful__saturation-pointer",top:1-e.v/100,left:e.s/100,color:V2(e)})))}),qZ=function(a,e){if(a===e)return!0;for(var t in a)if(a[t]!==e[t])return!1;return!0};function FX(a,e,t){var n=x2(t),i=E.useState(function(){return a.toHsva(e)}),s=i[0],o=i[1],r=E.useRef({color:e,hsva:s});E.useEffect(function(){if(!a.equal(e,r.current.color)){var u=a.toHsva(e);r.current={hsva:u,color:e},o(u)}},[e,a]),E.useEffect(function(){var u;qZ(s,r.current.hsva)||a.equal(u=a.fromHsva(s),r.current.color)||(r.current={hsva:s,color:u},n(u))},[s,a,n]);var g=E.useCallback(function(u){o(function(C){return Object.assign({},C,u)})},[]);return[s,g]}var NQ=typeof window<"u"?E.useLayoutEffect:E.useEffect,YQ=function(){return typeof __webpack_nonce__<"u"?__webpack_nonce__:void 0},Vx=new Map,EX=function(a){NQ(function(){var e=a.current?a.current.ownerDocument:document;if(e!==void 0&&!Vx.has(e)){var t=e.createElement("style");t.innerHTML=`.react-colorful{position:relative;display:flex;flex-direction:column;width:200px;height:200px;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;cursor:default}.react-colorful__saturation{position:relative;flex-grow:1;border-color:transparent;border-bottom:12px solid #000;border-radius:8px 8px 0 0;background-image:linear-gradient(0deg,#000,transparent),linear-gradient(90deg,#fff,hsla(0,0%,100%,0))}.react-colorful__alpha-gradient,.react-colorful__pointer-fill{content:"";position:absolute;left:0;top:0;right:0;bottom:0;pointer-events:none;border-radius:inherit}.react-colorful__alpha-gradient,.react-colorful__saturation{box-shadow:inset 0 0 0 1px rgba(0,0,0,.05)}.react-colorful__alpha,.react-colorful__hue{position:relative;height:24px}.react-colorful__hue{background:linear-gradient(90deg,red 0,#ff0 17%,#0f0 33%,#0ff 50%,#00f 67%,#f0f 83%,red)}.react-colorful__last-control{border-radius:0 0 8px 8px}.react-colorful__interactive{position:absolute;left:0;top:0;right:0;bottom:0;border-radius:inherit;outline:none;touch-action:none}.react-colorful__pointer{position:absolute;z-index:1;box-sizing:border-box;width:28px;height:28px;transform:translate(-50%,-50%);background-color:#fff;border:2px solid #fff;border-radius:50%;box-shadow:0 2px 4px rgba(0,0,0,.2)}.react-colorful__interactive:focus .react-colorful__pointer{transform:translate(-50%,-50%) scale(1.1)}.react-colorful__alpha,.react-colorful__alpha-pointer{background-color:#fff;background-image:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill-opacity=".05"><path d="M8 0h8v8H8zM0 8h8v8H0z"/></svg>')}.react-colorful__saturation-pointer{z-index:3}.react-colorful__hue-pointer{z-index:2}`,Vx.set(e,t);var n=YQ();n&&t.setAttribute("nonce",n),e.head.appendChild(t)}},[])},KQ=function(a){var e=a.className,t=a.colorModel,n=a.color,i=n===void 0?t.defaultColor:n,s=a.onChange,o=PZ(a,["className","colorModel","color","onChange"]),r=E.useRef(null);EX(r);var g=FX(t,i,s),u=g[0],C=g[1],h=rp(["react-colorful",e]);return fe.createElement("div",yA({},o,{ref:r,className:h}),fe.createElement(KX,{hsva:u,onChange:C}),fe.createElement(YX,{hue:u.h,onChange:C,className:"react-colorful__last-control"}))},FQ=function(a){var e=a.className,t=a.hsva,n=a.onChange,i={backgroundImage:"linear-gradient(90deg, "+uv(Object.assign({},t,{a:0}))+", "+uv(Object.assign({},t,{a:1}))+")"},s=rp(["react-colorful__alpha",e]),o=$s(100*t.a);return fe.createElement("div",{className:s},fe.createElement("div",{className:"react-colorful__alpha-gradient",style:i}),fe.createElement(QZ,{onMove:function(r){n({a:r.left})},onKey:function(r){n({a:cA(t.a+r.left)})},"aria-label":"Alpha","aria-valuetext":o+"%","aria-valuenow":o,"aria-valuemin":"0","aria-valuemax":"100"},fe.createElement(jZ,{className:"react-colorful__alpha-pointer",left:t.a,color:uv(t)})))},EQ=function(a){var e=a.className,t=a.colorModel,n=a.color,i=n===void 0?t.defaultColor:n,s=a.onChange,o=PZ(a,["className","colorModel","color","onChange"]),r=E.useRef(null);EX(r);var g=FX(t,i,s),u=g[0],C=g[1],h=rp(["react-colorful",e]);return fe.createElement("div",yA({},o,{ref:r,className:h}),fe.createElement(KX,{hsva:u,onChange:C}),fe.createElement(YX,{hue:u.h,onChange:C}),fe.createElement(FQ,{hsva:u,onChange:C,className:"react-colorful__last-control"}))},TQ={defaultColor:{r:0,g:0,b:0,a:1},toHsva:NX,fromHsva:XX,equal:qZ},zQ=function(a){return fe.createElement(EQ,yA({},a,{colorModel:TQ}))},LQ={defaultColor:{r:0,g:0,b:0},toHsva:function(a){return NX({r:a.r,g:a.g,b:a.b,a:1})},fromHsva:function(a){return{r:(e=XX(a)).r,g:e.g,b:e.b};var e},equal:qZ},_Q=function(a){return fe.createElement(KQ,yA({},a,{colorModel:LQ}))},Iv={exports:{}},Cv,Mx;function UQ(){if(Mx)return Cv;Mx=1;var a="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED";return Cv=a,Cv}var dv,Hx;function DQ(){if(Hx)return dv;Hx=1;var a=UQ();function e(){}function t(){}return t.resetWarningCache=e,dv=function(){function n(o,r,g,u,C,h){if(h!==a){var f=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw f.name="Invariant Violation",f}}n.isRequired=n;function i(){return n}var s={array:n,bigint:n,bool:n,func:n,number:n,object:n,string:n,symbol:n,any:n,arrayOf:i,element:n,elementType:n,instanceOf:i,node:n,objectOf:i,oneOf:i,oneOfType:i,shape:i,exact:i,checkPropTypes:t,resetWarningCache:e};return s.PropTypes=s,s},dv}var Xx;function kQ(){return Xx||(Xx=1,Iv.exports=DQ()()),Iv.exports}var OQ=kQ();const pi=CC(OQ);function GA(a,e,t,n){function i(s){return s instanceof t?s:new t(function(o){o(s)})}return new(t||(t=Promise))(function(s,o){function r(C){try{u(n.next(C))}catch(h){o(h)}}function g(C){try{u(n.throw(C))}catch(h){o(h)}}function u(C){C.done?s(C.value):i(C.value).then(r,g)}u((n=n.apply(a,e||[])).next())})}function BA(a,e){var t={label:0,sent:function(){if(s[0]&1)throw s[1];return s[1]},trys:[],ops:[]},n,i,s,o=Object.create((typeof Iterator=="function"?Iterator:Object).prototype);return o.next=r(0),o.throw=r(1),o.return=r(2),typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function r(u){return function(C){return g([u,C])}}function g(u){if(n)throw new TypeError("Generator is already executing.");for(;o&&(o=0,u[0]&&(t=0)),t;)try{if(n=1,i&&(s=u[0]&2?i.return:u[0]?i.throw||((s=i.return)&&s.call(i),0):i.next)&&!(s=s.call(i,u[1])).done)return s;switch(i=0,s&&(u=[u[0]&2,s.value]),u[0]){case 0:case 1:s=u;break;case 4:return t.label++,{value:u[1],done:!1};case 5:t.label++,i=u[1],u=[0];continue;case 7:u=t.ops.pop(),t.trys.pop();continue;default:if(s=t.trys,!(s=s.length>0&&s[s.length-1])&&(u[0]===6||u[0]===2)){t=0;continue}if(u[0]===3&&(!s||u[1]>s[0]&&u[1]<s[3])){t.label=u[1];break}if(u[0]===6&&t.label<s[1]){t.label=s[1],s=u;break}if(s&&t.label<s[2]){t.label=s[2],t.ops.push(u);break}s[2]&&t.ops.pop(),t.trys.pop();continue}u=e.call(a,t)}catch(C){u=[6,C],i=0}finally{n=s=0}if(u[0]&5)throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}}function JQ(a,e){var t=typeof Symbol=="function"&&a[Symbol.iterator];if(!t)return a;var n=t.call(a),i,s=[],o;try{for(;(e===void 0||e-- >0)&&!(i=n.next()).done;)s.push(i.value)}catch(r){o={error:r}}finally{try{i&&!i.done&&(t=n.return)&&t.call(n)}finally{if(o)throw o.error}}return s}function PQ(){for(var a=[],e=0;e<arguments.length;e++)a=a.concat(JQ(arguments[e]));return a}var QQ=new Map([["aac","audio/aac"],["abw","application/x-abiword"],["arc","application/x-freearc"],["avif","image/avif"],["avi","video/x-msvideo"],["azw","application/vnd.amazon.ebook"],["bin","application/octet-stream"],["bmp","image/bmp"],["bz","application/x-bzip"],["bz2","application/x-bzip2"],["cda","application/x-cdf"],["csh","application/x-csh"],["css","text/css"],["csv","text/csv"],["doc","application/msword"],["docx","application/vnd.openxmlformats-officedocument.wordprocessingml.document"],["eot","application/vnd.ms-fontobject"],["epub","application/epub+zip"],["gz","application/gzip"],["gif","image/gif"],["heic","image/heic"],["heif","image/heif"],["htm","text/html"],["html","text/html"],["ico","image/vnd.microsoft.icon"],["ics","text/calendar"],["jar","application/java-archive"],["jpeg","image/jpeg"],["jpg","image/jpeg"],["js","text/javascript"],["json","application/json"],["jsonld","application/ld+json"],["mid","audio/midi"],["midi","audio/midi"],["mjs","text/javascript"],["mp3","audio/mpeg"],["mp4","video/mp4"],["mpeg","video/mpeg"],["mpkg","application/vnd.apple.installer+xml"],["odp","application/vnd.oasis.opendocument.presentation"],["ods","application/vnd.oasis.opendocument.spreadsheet"],["odt","application/vnd.oasis.opendocument.text"],["oga","audio/ogg"],["ogv","video/ogg"],["ogx","application/ogg"],["opus","audio/opus"],["otf","font/otf"],["png","image/png"],["pdf","application/pdf"],["php","application/x-httpd-php"],["ppt","application/vnd.ms-powerpoint"],["pptx","application/vnd.openxmlformats-officedocument.presentationml.presentation"],["rar","application/vnd.rar"],["rtf","application/rtf"],["sh","application/x-sh"],["svg","image/svg+xml"],["swf","application/x-shockwave-flash"],["tar","application/x-tar"],["tif","image/tiff"],["tiff","image/tiff"],["ts","video/mp2t"],["ttf","font/ttf"],["txt","text/plain"],["vsd","application/vnd.visio"],["wav","audio/wav"],["weba","audio/webm"],["webm","video/webm"],["webp","image/webp"],["woff","font/woff"],["woff2","font/woff2"],["xhtml","application/xhtml+xml"],["xls","application/vnd.ms-excel"],["xlsx","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"],["xml","application/xml"],["xul","application/vnd.mozilla.xul+xml"],["zip","application/zip"],["7z","application/x-7z-compressed"],["mkv","video/x-matroska"],["mov","video/quicktime"],["msg","application/vnd.ms-outlook"]]);function gp(a,e){var t=jQ(a);if(typeof t.path!="string"){var n=a.webkitRelativePath;Object.defineProperty(t,"path",{value:typeof e=="string"?e:typeof n=="string"&&n.length>0?n:a.name,writable:!1,configurable:!1,enumerable:!0})}return t}function jQ(a){var e=a.name,t=e&&e.lastIndexOf(".")!==-1;if(t&&!a.type){var n=e.split(".").pop().toLowerCase(),i=QQ.get(n);i&&Object.defineProperty(a,"type",{value:i,writable:!1,configurable:!1,enumerable:!0})}return a}var qQ=[".DS_Store","Thumbs.db"];function $Q(a){return GA(this,void 0,void 0,function(){return BA(this,function(e){return $0(a)&&e4(a)?[2,a4(a.dataTransfer,a.type)]:t4(a)?[2,n4(a)]:Array.isArray(a)&&a.every(function(t){return"getFile"in t&&typeof t.getFile=="function"})?[2,i4(a)]:[2,[]]})})}function e4(a){return $0(a.dataTransfer)}function t4(a){return $0(a)&&$0(a.target)}function $0(a){return typeof a=="object"&&a!==null}function n4(a){return M2(a.target.files).map(function(e){return gp(e)})}function i4(a){return GA(this,void 0,void 0,function(){var e;return BA(this,function(t){switch(t.label){case 0:return[4,Promise.all(a.map(function(n){return n.getFile()}))];case 1:return e=t.sent(),[2,e.map(function(n){return gp(n)})]}})})}function a4(a,e){return GA(this,void 0,void 0,function(){var t,n;return BA(this,function(i){switch(i.label){case 0:return a===null?[2,[]]:a.items?(t=M2(a.items).filter(function(s){return s.kind==="file"}),e!=="drop"?[2,t]:[4,Promise.all(t.map(s4))]):[3,2];case 1:return n=i.sent(),[2,Nx(TX(n))];case 2:return[2,Nx(M2(a.files).map(function(s){return gp(s)}))]}})})}function Nx(a){return a.filter(function(e){return qQ.indexOf(e.name)===-1})}function M2(a){if(a===null)return[];for(var e=[],t=0;t<a.length;t++){var n=a[t];e.push(n)}return e}function s4(a){if(typeof a.webkitGetAsEntry!="function")return Yx(a);var e=a.webkitGetAsEntry();return e&&e.isDirectory?zX(e):Yx(a)}function TX(a){return a.reduce(function(e,t){return PQ(e,Array.isArray(t)?TX(t):[t])},[])}function Yx(a){var e=a.getAsFile();if(!e)return Promise.reject(a+" is not a File");var t=gp(e);return Promise.resolve(t)}function o4(a){return GA(this,void 0,void 0,function(){return BA(this,function(e){return[2,a.isDirectory?zX(a):l4(a)]})})}function zX(a){var e=a.createReader();return new Promise(function(t,n){var i=[];function s(){var o=this;e.readEntries(function(r){return GA(o,void 0,void 0,function(){var g,u,C;return BA(this,function(h){switch(h.label){case 0:if(r.length)return[3,5];h.label=1;case 1:return h.trys.push([1,3,,4]),[4,Promise.all(i)];case 2:return g=h.sent(),t(g),[3,4];case 3:return u=h.sent(),n(u),[3,4];case 4:return[3,6];case 5:C=Promise.all(r.map(o4)),i.push(C),s(),h.label=6;case 6:return[2]}})})},function(r){n(r)})}s()})}function l4(a){return GA(this,void 0,void 0,function(){return BA(this,function(e){return[2,new Promise(function(t,n){a.file(function(i){var s=gp(i,a.fullPath);t(s)},function(i){n(i)})})]})})}var Mb={},Kx;function r4(){return Kx||(Kx=1,Mb.__esModule=!0,Mb.default=function(a,e){if(a&&e){var t=Array.isArray(e)?e:e.split(",");if(t.length===0)return!0;var n=a.name||"",i=(a.type||"").toLowerCase(),s=i.replace(/\/.*$/,"");return t.some(function(o){var r=o.trim().toLowerCase();return r.charAt(0)==="."?n.toLowerCase().endsWith(r):r.endsWith("/*")?s===r.replace(/\/.*$/,""):i===r})}return!0}),Mb}var g4=r4();const c4=CC(g4);function Fx(a,e){var t=Object.keys(a);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(a);e&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(a,i).enumerable})),t.push.apply(t,n)}return t}function Ex(a){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?Fx(Object(t),!0).forEach(function(n){LX(a,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(a,Object.getOwnPropertyDescriptors(t)):Fx(Object(t)).forEach(function(n){Object.defineProperty(a,n,Object.getOwnPropertyDescriptor(t,n))})}return a}function LX(a,e,t){return e in a?Object.defineProperty(a,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):a[e]=t,a}function Tx(a,e){return d4(a)||C4(a,e)||I4(a,e)||u4()}function u4(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function I4(a,e){if(a){if(typeof a=="string")return zx(a,e);var t=Object.prototype.toString.call(a).slice(8,-1);if(t==="Object"&&a.constructor&&(t=a.constructor.name),t==="Map"||t==="Set")return Array.from(a);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return zx(a,e)}}function zx(a,e){(e==null||e>a.length)&&(e=a.length);for(var t=0,n=new Array(e);t<e;t++)n[t]=a[t];return n}function C4(a,e){var t=a==null?null:typeof Symbol<"u"&&a[Symbol.iterator]||a["@@iterator"];if(t!=null){var n=[],i=!0,s=!1,o,r;try{for(t=t.call(a);!(i=(o=t.next()).done)&&(n.push(o.value),!(e&&n.length===e));i=!0);}catch(g){s=!0,r=g}finally{try{!i&&t.return!=null&&t.return()}finally{if(s)throw r}}return n}}function d4(a){if(Array.isArray(a))return a}var A4="file-invalid-type",h4="file-too-large",f4="file-too-small",p4="too-many-files",m4=function(e){e=Array.isArray(e)&&e.length===1?e[0]:e;var t=Array.isArray(e)?"one of ".concat(e.join(", ")):e;return{code:A4,message:"File type must be ".concat(t)}},Lx=function(e){return{code:h4,message:"File is larger than ".concat(e," ").concat(e===1?"byte":"bytes")}},_x=function(e){return{code:f4,message:"File is smaller than ".concat(e," ").concat(e===1?"byte":"bytes")}},b4={code:p4,message:"Too many files"};function _X(a,e){var t=a.type==="application/x-moz-file"||c4(a,e);return[t,t?null:m4(e)]}function UX(a,e,t){if(jh(a.size))if(jh(e)&&jh(t)){if(a.size>t)return[!1,Lx(t)];if(a.size<e)return[!1,_x(e)]}else{if(jh(e)&&a.size<e)return[!1,_x(e)];if(jh(t)&&a.size>t)return[!1,Lx(t)]}return[!0,null]}function jh(a){return a!=null}function y4(a){var e=a.files,t=a.accept,n=a.minSize,i=a.maxSize,s=a.multiple,o=a.maxFiles;return!s&&e.length>1||s&&o>=1&&e.length>o?!1:e.every(function(r){var g=_X(r,t),u=Tx(g,1),C=u[0],h=UX(r,n,i),f=Tx(h,1),p=f[0];return C&&p})}function ey(a){return typeof a.isPropagationStopped=="function"?a.isPropagationStopped():typeof a.cancelBubble<"u"?a.cancelBubble:!1}function Hb(a){return a.dataTransfer?Array.prototype.some.call(a.dataTransfer.types,function(e){return e==="Files"||e==="application/x-moz-file"}):!!a.target&&!!a.target.files}function Ux(a){a.preventDefault()}function G4(a){return a.indexOf("MSIE")!==-1||a.indexOf("Trident/")!==-1}function B4(a){return a.indexOf("Edge/")!==-1}function v4(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:window.navigator.userAgent;return G4(a)||B4(a)}function gg(){for(var a=arguments.length,e=new Array(a),t=0;t<a;t++)e[t]=arguments[t];return function(n){for(var i=arguments.length,s=new Array(i>1?i-1:0),o=1;o<i;o++)s[o-1]=arguments[o];return e.some(function(r){return!ey(n)&&r&&r.apply(void 0,[n].concat(s)),ey(n)})}}function Z4(){return"showOpenFilePicker"in window}function S4(a){return a=typeof a=="string"?a.split(","):a,[{description:"everything",accept:Array.isArray(a)?a.filter(function(e){return e==="audio/*"||e==="video/*"||e==="image/*"||e==="text/*"||/\w+\/[-+.\w]+/g.test(e)}).reduce(function(e,t){return Ex(Ex({},e),{},LX({},t,[]))},{}):{}}]}function R4(a){return a instanceof DOMException&&(a.name==="AbortError"||a.code===a.ABORT_ERR)}function w4(a){return a instanceof DOMException&&(a.name==="SecurityError"||a.code===a.SECURITY_ERR)}var x4=["children"],W4=["open"],V4=["refKey","role","onKeyDown","onFocus","onBlur","onClick","onDragEnter","onDragOver","onDragLeave","onDrop"],M4=["refKey","onChange","onClick"];function H4(a){return Y4(a)||N4(a)||DX(a)||X4()}function X4(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function N4(a){if(typeof Symbol<"u"&&a[Symbol.iterator]!=null||a["@@iterator"]!=null)return Array.from(a)}function Y4(a){if(Array.isArray(a))return H2(a)}function Av(a,e){return E4(a)||F4(a,e)||DX(a,e)||K4()}function K4(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function DX(a,e){if(a){if(typeof a=="string")return H2(a,e);var t=Object.prototype.toString.call(a).slice(8,-1);if(t==="Object"&&a.constructor&&(t=a.constructor.name),t==="Map"||t==="Set")return Array.from(a);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return H2(a,e)}}function H2(a,e){(e==null||e>a.length)&&(e=a.length);for(var t=0,n=new Array(e);t<e;t++)n[t]=a[t];return n}function F4(a,e){var t=a==null?null:typeof Symbol<"u"&&a[Symbol.iterator]||a["@@iterator"];if(t!=null){var n=[],i=!0,s=!1,o,r;try{for(t=t.call(a);!(i=(o=t.next()).done)&&(n.push(o.value),!(e&&n.length===e));i=!0);}catch(g){s=!0,r=g}finally{try{!i&&t.return!=null&&t.return()}finally{if(s)throw r}}return n}}function E4(a){if(Array.isArray(a))return a}function Dx(a,e){var t=Object.keys(a);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(a);e&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(a,i).enumerable})),t.push.apply(t,n)}return t}function Di(a){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?Dx(Object(t),!0).forEach(function(n){X2(a,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(a,Object.getOwnPropertyDescriptors(t)):Dx(Object(t)).forEach(function(n){Object.defineProperty(a,n,Object.getOwnPropertyDescriptor(t,n))})}return a}function X2(a,e,t){return e in a?Object.defineProperty(a,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):a[e]=t,a}function ty(a,e){if(a==null)return{};var t=T4(a,e),n,i;if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(a);for(i=0;i<s.length;i++)n=s[i],!(e.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(a,n)&&(t[n]=a[n])}return t}function T4(a,e){if(a==null)return{};var t={},n=Object.keys(a),i,s;for(s=0;s<n.length;s++)i=n[s],!(e.indexOf(i)>=0)&&(t[i]=a[i]);return t}var $Z=E.forwardRef(function(a,e){var t=a.children,n=ty(a,x4),i=OX(n),s=i.open,o=ty(i,W4);return E.useImperativeHandle(e,function(){return{open:s}},[s]),fe.createElement(E.Fragment,null,t(Di(Di({},o),{},{open:s})))});$Z.displayName="Dropzone";var kX={disabled:!1,getFilesFromEvent:$Q,maxSize:1/0,minSize:0,multiple:!0,maxFiles:0,preventDropOnDocument:!0,noClick:!1,noKeyboard:!1,noDrag:!1,noDragEventsBubbling:!1,validator:null,useFsAccessApi:!0};$Z.defaultProps=kX;$Z.propTypes={children:pi.func,accept:pi.oneOfType([pi.string,pi.arrayOf(pi.string)]),multiple:pi.bool,preventDropOnDocument:pi.bool,noClick:pi.bool,noKeyboard:pi.bool,noDrag:pi.bool,noDragEventsBubbling:pi.bool,minSize:pi.number,maxSize:pi.number,maxFiles:pi.number,disabled:pi.bool,getFilesFromEvent:pi.func,onFileDialogCancel:pi.func,onFileDialogOpen:pi.func,useFsAccessApi:pi.bool,onDragEnter:pi.func,onDragLeave:pi.func,onDragOver:pi.func,onDrop:pi.func,onDropAccepted:pi.func,onDropRejected:pi.func,validator:pi.func};var N2={isFocused:!1,isFileDialogActive:!1,isDragActive:!1,isDragAccept:!1,isDragReject:!1,draggedFiles:[],acceptedFiles:[],fileRejections:[]};function OX(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},e=Di(Di({},kX),a),t=e.accept,n=e.disabled,i=e.getFilesFromEvent,s=e.maxSize,o=e.minSize,r=e.multiple,g=e.maxFiles,u=e.onDragEnter,C=e.onDragLeave,h=e.onDragOver,f=e.onDrop,p=e.onDropAccepted,y=e.onDropRejected,v=e.onFileDialogCancel,G=e.onFileDialogOpen,B=e.useFsAccessApi,R=e.preventDropOnDocument,x=e.noClick,w=e.noKeyboard,M=e.noDrag,H=e.noDragEventsBubbling,N=e.validator,F=E.useMemo(function(){return typeof G=="function"?G:kx},[G]),Y=E.useMemo(function(){return typeof v=="function"?v:kx},[v]),X=E.useRef(null),U=E.useRef(null),O=E.useReducer(z4,N2),P=Av(O,2),ie=P[0],le=P[1],T=ie.isFocused,J=ie.isFileDialogActive,Q=ie.draggedFiles,se=E.useRef(typeof window<"u"&&window.isSecureContext&&B&&Z4()),L=function(){!se.current&&J&&setTimeout(function(){if(U.current){var z=U.current.files;z.length||(le({type:"closeDialog"}),Y())}},300)};E.useEffect(function(){return window.addEventListener("focus",L,!1),function(){window.removeEventListener("focus",L,!1)}},[U,J,Y,se]);var D=E.useRef([]),ne=function(z){X.current&&X.current.contains(z.target)||(z.preventDefault(),D.current=[])};E.useEffect(function(){return R&&(document.addEventListener("dragover",Ux,!1),document.addEventListener("drop",ne,!1)),function(){R&&(document.removeEventListener("dragover",Ux),document.removeEventListener("drop",ne))}},[X,R]);var oe=E.useCallback(function(k){k.preventDefault(),k.persist(),Ke(k),D.current=[].concat(H4(D.current),[k.target]),Hb(k)&&Promise.resolve(i(k)).then(function(z){ey(k)&&!H||(le({draggedFiles:z,isDragActive:!0,type:"setDraggedFiles"}),u&&u(k))})},[i,u,H]),j=E.useCallback(function(k){k.preventDefault(),k.persist(),Ke(k);var z=Hb(k);if(z&&k.dataTransfer)try{k.dataTransfer.dropEffect="copy"}catch{}return z&&h&&h(k),!1},[h,H]),re=E.useCallback(function(k){k.preventDefault(),k.persist(),Ke(k);var z=D.current.filter(function(Ve){return X.current&&X.current.contains(Ve)}),Ce=z.indexOf(k.target);Ce!==-1&&z.splice(Ce,1),D.current=z,!(z.length>0)&&(le({isDragActive:!1,type:"setDraggedFiles",draggedFiles:[]}),Hb(k)&&C&&C(k))},[X,C,H]),pe=E.useCallback(function(k,z){var Ce=[],Ve=[];k.forEach(function(Ge){var we=_X(Ge,t),et=Av(we,2),lt=et[0],Ct=et[1],At=UX(Ge,o,s),Ne=Av(At,2),tt=Ne[0],nt=Ne[1],ue=N?N(Ge):null;if(lt&&tt&&!ue)Ce.push(Ge);else{var xe=[Ct,nt];ue&&(xe=xe.concat(ue)),Ve.push({file:Ge,errors:xe.filter(function(ct){return ct})})}}),(!r&&Ce.length>1||r&&g>=1&&Ce.length>g)&&(Ce.forEach(function(Ge){Ve.push({file:Ge,errors:[b4]})}),Ce.splice(0)),le({acceptedFiles:Ce,fileRejections:Ve,type:"setFiles"}),f&&f(Ce,Ve,z),Ve.length>0&&y&&y(Ve,z),Ce.length>0&&p&&p(Ce,z)},[le,r,t,o,s,g,f,p,y,N]),me=E.useCallback(function(k){k.preventDefault(),k.persist(),Ke(k),D.current=[],Hb(k)&&Promise.resolve(i(k)).then(function(z){ey(k)&&!H||pe(z,k)}),le({type:"reset"})},[i,pe,H]),be=E.useCallback(function(){if(se.current){le({type:"openDialog"}),F();var k={multiple:r,types:S4(t)};window.showOpenFilePicker(k).then(function(z){return i(z)}).then(function(z){pe(z,null),le({type:"closeDialog"})}).catch(function(z){R4(z)?(Y(z),le({type:"closeDialog"})):w4(z)&&(se.current=!1,U.current&&(U.current.value=null,U.current.click()))});return}U.current&&(le({type:"openDialog"}),F(),U.current.value=null,U.current.click())},[le,F,Y,B,pe,t,r]),$e=E.useCallback(function(k){!X.current||!X.current.isEqualNode(k.target)||(k.key===" "||k.key==="Enter"||k.keyCode===32||k.keyCode===13)&&(k.preventDefault(),be())},[X,be]),qe=E.useCallback(function(){le({type:"focus"})},[]),ke=E.useCallback(function(){le({type:"blur"})},[]),Te=E.useCallback(function(){x||(v4()?setTimeout(be,0):be())},[x,be]),ut=function(z){return n?null:z},q=function(z){return w?null:ut(z)},De=function(z){return M?null:ut(z)},Ke=function(z){H&&z.stopPropagation()},Ee=E.useMemo(function(){return function(){var k=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},z=k.refKey,Ce=z===void 0?"ref":z,Ve=k.role,Ge=k.onKeyDown,we=k.onFocus,et=k.onBlur,lt=k.onClick,Ct=k.onDragEnter,At=k.onDragOver,Ne=k.onDragLeave,tt=k.onDrop,nt=ty(k,V4);return Di(Di(X2({onKeyDown:q(gg(Ge,$e)),onFocus:q(gg(we,qe)),onBlur:q(gg(et,ke)),onClick:ut(gg(lt,Te)),onDragEnter:De(gg(Ct,oe)),onDragOver:De(gg(At,j)),onDragLeave:De(gg(Ne,re)),onDrop:De(gg(tt,me)),role:typeof Ve=="string"&&Ve!==""?Ve:"button"},Ce,X),!n&&!w?{tabIndex:0}:{}),nt)}},[X,$e,qe,ke,Te,oe,j,re,me,w,M,n]),ye=E.useCallback(function(k){k.stopPropagation()},[]),Je=E.useMemo(function(){return function(){var k=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},z=k.refKey,Ce=z===void 0?"ref":z,Ve=k.onChange,Ge=k.onClick,we=ty(k,M4),et=X2({accept:t,multiple:r,type:"file",style:{display:"none"},onChange:ut(gg(Ve,me)),onClick:ut(gg(Ge,ye)),tabIndex:-1},Ce,U);return Di(Di({},et),we)}},[U,t,r,me,n]),Me=Q.length,Ze=Me>0&&y4({files:Q,accept:t,minSize:o,maxSize:s,multiple:r,maxFiles:g}),gt=Me>0&&!Ze;return Di(Di({},ie),{},{isDragAccept:Ze,isDragReject:gt,isFocused:T&&!n,getRootProps:Ee,getInputProps:Je,rootRef:X,inputRef:U,open:ut(be)})}function z4(a,e){switch(e.type){case"focus":return Di(Di({},a),{},{isFocused:!0});case"blur":return Di(Di({},a),{},{isFocused:!1});case"openDialog":return Di(Di({},N2),{},{isFileDialogActive:!0});case"closeDialog":return Di(Di({},a),{},{isFileDialogActive:!1});case"setDraggedFiles":var t=e.isDragActive,n=e.draggedFiles;return Di(Di({},a),{},{draggedFiles:n,isDragActive:t});case"setFiles":return Di(Di({},a),{},{acceptedFiles:e.acceptedFiles,fileRejections:e.fileRejections});case"reset":return Di({},N2);default:return a}}function kx(){}function L4(a){let e;const t=new Set,n=(u,C)=>{const h=typeof u=="function"?u(e):u;if(h!==e){const f=e;e=C?h:Object.assign({},e,h),t.forEach(p=>p(e,f))}},i=()=>e,s=(u,C=i,h=Object.is)=>{console.warn("[DEPRECATED] Please use `subscribeWithSelector` middleware");let f=C(e);function p(){const y=C(e);if(!h(f,y)){const v=f;u(f=y,v)}}return t.add(p),()=>t.delete(p)},g={setState:n,getState:i,subscribe:(u,C,h)=>C||h?s(u,C,h):(t.add(u),()=>t.delete(u)),destroy:()=>t.clear()};return e=a(n,i,g),g}const _4=typeof window>"u"||!window.navigator||/ServerSideRendering|^Deno\//.test(window.navigator.userAgent),Ox=_4?E.useEffect:E.useLayoutEffect;function U4(a){const e=typeof a=="function"?L4(a):a,t=(n=e.getState,i=Object.is)=>{const[,s]=E.useReducer(G=>G+1,0),o=e.getState(),r=E.useRef(o),g=E.useRef(n),u=E.useRef(i),C=E.useRef(!1),h=E.useRef();h.current===void 0&&(h.current=n(o));let f,p=!1;(r.current!==o||g.current!==n||u.current!==i||C.current)&&(f=n(o),p=!i(h.current,f)),Ox(()=>{p&&(h.current=f),r.current=o,g.current=n,u.current=i,C.current=!1});const y=E.useRef(o);Ox(()=>{const G=()=>{try{const R=e.getState(),x=g.current(R);u.current(h.current,x)||(r.current=R,h.current=x,s())}catch{C.current=!0,s()}},B=e.subscribe(G);return e.getState()!==y.current&&G(),B},[]);const v=p?f:h.current;return E.useDebugValue(v),v};return Object.assign(t,e),t[Symbol.iterator]=function(){console.warn("[useStore, api] = create() is deprecated and will be removed in v4");const n=[t,e];return{next(){const i=n.length<=0;return{value:n.shift(),done:i}}}},t}const D4=a=>(e,t,n)=>{const i=n.subscribe;return n.subscribe=(o,r,g)=>{let u=o;if(r){const C=g?.equalityFn||Object.is;let h=o(n.getState());u=f=>{const p=o(f);if(!C(h,p)){const y=h;r(h=p,y)}},g?.fireImmediately&&r(h,h)}return i(u)},a(e,t,n)};/*!
 * isobject <https://github.com/jonschlinkert/isobject>
 *
 * Copyright (c) 2014-2017, Jon Schlinkert.
 * Released under the MIT License.
 */var hv,Jx;function k4(){return Jx||(Jx=1,hv=function(e){return e!=null&&typeof e=="object"&&Array.isArray(e)===!1}),hv}/*!
 * is-plain-object <https://github.com/jonschlinkert/is-plain-object>
 *
 * Copyright (c) 2014-2017, Jon Schlinkert.
 * Released under the MIT License.
 */var fv,Px;function JX(){if(Px)return fv;Px=1;var a=k4();function e(t){return a(t)===!0&&Object.prototype.toString.call(t)==="[object Object]"}return fv=function(n){var i,s;return!(e(n)===!1||(i=n.constructor,typeof i!="function")||(s=i.prototype,e(s)===!1)||s.hasOwnProperty("isPrototypeOf")===!1)},fv}/*!
 * is-extendable <https://github.com/jonschlinkert/is-extendable>
 *
 * Copyright (c) 2015-2017, Jon Schlinkert.
 * Released under the MIT License.
 */var pv,Qx;function eS(){if(Qx)return pv;Qx=1;var a=JX();return pv=function(t){return a(t)||typeof t=="function"||Array.isArray(t)},pv}/*!
 * for-in <https://github.com/jonschlinkert/for-in>
 *
 * Copyright (c) 2014-2017, Jon Schlinkert.
 * Released under the MIT License.
 */var mv,jx;function O4(){return jx||(jx=1,mv=function(e,t,n){for(var i in e)if(t.call(n,e[i],i,e)===!1)break}),mv}var bv,qx;function J4(){if(qx)return bv;qx=1;var a=eS(),e=O4();function t(o,r){for(var g=arguments.length,u=0;++u<g;){var C=arguments[u];i(C)&&e(C,n,o)}return o}function n(o,r){if(s(r)){var g=this[r];i(o)&&i(g)?t(g,o):this[r]=o}}function i(o){return a(o)&&!Array.isArray(o)}function s(o){return o!=="__proto__"&&o!=="constructor"&&o!=="prototype"}return bv=t,bv}/*!
 * get-value <https://github.com/jonschlinkert/get-value>
 *
 * Copyright (c) 2014-2015, Jon Schlinkert.
 * Licensed under the MIT License.
 */var yv,$x;function P4(){if($x)return yv;$x=1,yv=function(t,n,i,s,o){if(!a(t)||!n)return t;if(n=e(n),i&&(n+="."+e(i)),s&&(n+="."+e(s)),o&&(n+="."+e(o)),n in t)return t[n];for(var r=n.split("."),g=r.length,u=-1;t&&++u<g;){for(var C=r[u];C[C.length-1]==="\\";)C=C.slice(0,-1)+"."+r[++u];t=t[C]}return t};function a(t){return t!==null&&(typeof t=="object"||typeof t=="function")}function e(t){return t?Array.isArray(t)?t.join("."):t:""}return yv}/*!
 * assign-symbols <https://github.com/jonschlinkert/assign-symbols>
 *
 * Copyright (c) 2015, Jon Schlinkert.
 * Licensed under the MIT License.
 */var Gv,eW;function Q4(){return eW||(eW=1,Gv=function(a,e){if(a===null||typeof a>"u")throw new TypeError("expected first argument to be an object.");if(typeof e>"u"||typeof Symbol>"u"||typeof Object.getOwnPropertySymbols!="function")return a;for(var t=Object.prototype.propertyIsEnumerable,n=Object(a),i=arguments.length,s=0;++s<i;)for(var o=Object(arguments[s]),r=Object.getOwnPropertySymbols(o),g=0;g<r.length;g++){var u=r[g];t.call(o,u)&&(n[u]=o[u])}return n}),Gv}var Bv,tW;function j4(){if(tW)return Bv;tW=1;var a=eS(),e=Q4();Bv=Object.assign||function(r){if(r===null||typeof r>"u")throw new TypeError("Cannot convert undefined or null to object");s(r)||(r={});for(var g=1;g<arguments.length;g++){var u=arguments[g];n(u)&&(u=i(u)),s(u)&&(t(r,u),e(r,u))}return r};function t(r,g){for(var u in g)o(g,u)&&(r[u]=g[u])}function n(r){return r&&typeof r=="string"}function i(r){var g={};for(var u in r)g[u]=r[u];return g}function s(r){return r&&typeof r=="object"||a(r)}function o(r,g){return Object.prototype.hasOwnProperty.call(r,g)}return Bv}/*!
 * split-string <https://github.com/jonschlinkert/split-string>
 *
 * Copyright (c) 2015-2017, Jon Schlinkert.
 * Released under the MIT License.
 */var vv,nW;function q4(){if(nW)return vv;nW=1;var a=j4();vv=function(i,s,o){if(typeof i!="string")throw new TypeError("expected a string");typeof s=="function"&&(o=s,s=null),typeof s=="string"&&(s={sep:s});var r=a({sep:"."},s),g=r.quotes||['"',"'","`"],u;r.brackets===!0?u={"<":">","(":")","[":"]","{":"}"}:r.brackets&&(u=r.brackets);var C=[],h=[],f=[""],p=r.sep,y=i.length,v=-1,G;function B(){if(u&&h.length)return u[h[h.length-1]]}for(;++v<y;){var R=i[v],x=i[v+1],w={val:R,idx:v,arr:f,str:i};if(C.push(w),R==="\\"){w.val=n(r,i,v)===!0?R+x:x,w.escaped=!0,typeof o=="function"&&o(w),f[f.length-1]+=w.val,v++;continue}if(u&&u[R]){h.push(R);var M=B(),H=v+1;if(i.indexOf(M,H+1)!==-1)for(;h.length&&H<y;){var N=i[++H];if(N==="\\"){N++;continue}if(g.indexOf(N)!==-1){H=e(i,N,H+1);continue}if(M=B(),h.length&&i.indexOf(M,H+1)===-1)break;if(u[N]){h.push(N);continue}M===N&&h.pop()}if(G=H,G===-1){f[f.length-1]+=R;continue}R=i.slice(v,G+1),w.val=R,w.idx=v=G}if(g.indexOf(R)!==-1){if(G=e(i,R,v+1),G===-1){f[f.length-1]+=R;continue}t(R,r)===!0?R=i.slice(v,G+1):R=i.slice(v+1,G),w.val=R,w.idx=v=G}if(typeof o=="function"&&(o(w,C),R=w.val,v=w.idx),w.val===p&&w.split!==!1){f.push("");continue}f[f.length-1]+=w.val}return f};function e(i,s,o,r){var g=i.indexOf(s,o);return i.charAt(g-1)==="\\"?e(i,s,g+1):g}function t(i,s){return s.keepDoubleQuotes===!0&&i==='"'||s.keepSingleQuotes===!0&&i==="'"?!0:s.keepQuotes}function n(i,s,o){return typeof i.keepEscaping=="function"?i.keepEscaping(s,o):i.keepEscaping===!0||s[o+1]==="\\"}return vv}/*!
 * is-extendable <https://github.com/jonschlinkert/is-extendable>
 *
 * Copyright (c) 2015, Jon Schlinkert.
 * Licensed under the MIT License.
 */var Zv,iW;function $4(){return iW||(iW=1,Zv=function(e){return typeof e<"u"&&e!==null&&(typeof e=="object"||typeof e=="function")}),Zv}var Sv,aW;function ej(){if(aW)return Sv;aW=1;var a=$4();Sv=function(i){a(i)||(i={});for(var s=arguments.length,o=1;o<s;o++){var r=arguments[o];a(r)&&e(i,r)}return i};function e(n,i){for(var s in i)t(i,s)&&(n[s]=i[s])}function t(n,i){return Object.prototype.hasOwnProperty.call(n,i)}return Sv}/*!
 * is-extendable <https://github.com/jonschlinkert/is-extendable>
 *
 * Copyright (c) 2015, Jon Schlinkert.
 * Licensed under the MIT License.
 */var Rv,sW;function tj(){return sW||(sW=1,Rv=function(e){return typeof e<"u"&&e!==null&&(typeof e=="object"||typeof e=="function")}),Rv}/*!
 * set-value <https://github.com/jonschlinkert/set-value>
 *
 * Copyright (c) 2014-2015, 2017, Jon Schlinkert.
 * Released under the MIT License.
 */var wv,oW;function nj(){if(oW)return wv;oW=1;var a=q4(),e=ej(),t=JX(),n=tj();wv=function(s,o,r){if(!n(s)||(Array.isArray(o)&&(o=[].concat.apply([],o).join(".")),typeof o!="string"))return s;for(var g=a(o,{sep:".",brackets:!0}).filter(i),u=g.length,C=-1,h=s;++C<u;){var f=g[C];if(C!==u-1){n(h[f])||(h[f]={}),h=h[f];continue}t(h[f])&&t(r)?h[f]=e({},h[f],r):h[f]=r}return s};function i(s){return s!=="__proto__"&&s!=="constructor"&&s!=="prototype"}return wv}var xv,lW;function ij(){if(lW)return xv;lW=1;var a=eS(),e=J4(),t=P4(),n=nj();return xv=function(s,o,r){if(!a(s))throw new TypeError("expected an object");if(typeof o!="string"||r==null)return e.apply(null,arguments);if(typeof r=="string")return n(s,o,r),s;var g=t(s,o);return a(r)&&a(g)&&(r=e({},g,r)),n(s,o,r),s},xv}var aj=ij();const sj=CC(aj),tS=(...a)=>a.filter(Boolean).join(".");function oj(a){const e=a.split(".");return[e.pop(),e.join(".")||void 0]}function lj(a,e){return Object.entries(jJ(a,e)).reduce((t,[,{value:n,disabled:i,key:s}])=>(t[s]=i?void 0:n,t),{})}function rj(a,e){const t=E.useRef();return Ff(a,t.current)||(t.current=a),t.current}function PX(a,e){return E.useMemo(a,rj(e))}function gj(a){const e=E.useRef(null),t=E.useRef(null),n=E.useRef(!0);return E.useLayoutEffect(()=>{a||(e.current.style.height="0px",e.current.style.overflow="hidden")},[]),E.useEffect(()=>{if(n.current){n.current=!1;return}let i;const s=e.current,o=()=>{a&&(s.style.removeProperty("height"),s.style.removeProperty("overflow"),t.current.scrollIntoView({behavior:"smooth",block:"nearest"}))};s.addEventListener("transitionend",o,{once:!0});const{height:r}=t.current.getBoundingClientRect();return s.style.height=r+"px",a||(s.style.overflow="hidden",i=window.setTimeout(()=>s.style.height="0px",50)),()=>{s.removeEventListener("transitionend",o),clearTimeout(i)}},[a]),{wrapperRef:e,contentRef:t}}const cj=a=>{const[e,t]=E.useState(a.getVisiblePaths());return E.useEffect(()=>{t(a.getVisiblePaths());const n=a.useStore.subscribe(a.getVisiblePaths,t,{equalityFn:Jy});return()=>n()},[a]),e};function uj(a,e,t){return a.useStore(i=>{const s=jt(jt({},t),i.data);return lj(s,e)},Jy)}function QX(a=3){const e=E.useRef(null),t=E.useRef(null),[n,i]=E.useState(!1),s=E.useCallback(()=>i(!0),[]),o=E.useCallback(()=>i(!1),[]);return E.useLayoutEffect(()=>{if(n){const{bottom:r,top:g,left:u}=e.current.getBoundingClientRect(),{height:C}=t.current.getBoundingClientRect(),h=r+C>window.innerHeight-40?"up":"down";t.current.style.position="fixed",t.current.style.zIndex="10000",t.current.style.left=u+"px",h==="down"?t.current.style.top=r+a+"px":t.current.style.bottom=window.innerHeight-g+a+"px"}},[a,n]),{popinRef:e,wrapperRef:t,shown:n,show:s,hide:o}}HQ([XQ]);const Ij={rgb:"toRgb",hsl:"toHsl",hsv:"toHsv",hex:"toHex"};xo.extend({color:()=>a=>Os(a).isValid()});const Cj=a=>xo().color().test(a);function jX(a,{format:e,hasAlpha:t,isString:n}){const i=Ij[e]+(n&&e!=="hex"?"String":""),s=a[i]();return typeof s=="object"&&!t?qJ(s,["a"]):s}const qX=(a,e)=>{const t=Os(a);if(!t.isValid())throw Error("Invalid color");return jX(t,e)},dj=(a,e)=>jX(Os(a),jt(jt({},e),{},{isString:!0,format:"hex"})),Aj=({value:a})=>{const e=MQ(a),t=e==="name"?"hex":e,n=typeof a=="object"?"a"in a:e==="hex"&&a.length===8||/^(rgba)|(hsla)|(hsva)/.test(a),i={format:t,hasAlpha:n,isString:typeof a=="string"};return{value:qX(a,i),settings:i}};var hj=Object.freeze({__proto__:null,schema:Cj,sanitize:qX,format:dj,normalize:Aj});const fj=kt("div",{position:"relative",boxSizing:"border-box",borderRadius:"$sm",overflow:"hidden",cursor:"pointer",height:"$rowHeight",width:"$rowHeight",backgroundColor:"#fff",backgroundImage:`url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill-opacity=".05"><path d="M8 0h8v8H8zM0 8h8v8H0z"/></svg>')`,$inputStyle:"",$hover:"",zIndex:1,variants:{active:{true:{$inputStyle:"$accent1"}}},"&::before":{content:'""',position:"absolute",top:0,bottom:0,right:0,left:0,backgroundColor:"currentColor",zIndex:1}}),pj=kt("div",{position:"relative",display:"grid",gridTemplateColumns:"$sizes$rowHeight auto",columnGap:"$colGap",alignItems:"center"}),mj=kt("div",{width:"$colorPickerWidth",height:"$colorPickerHeight",".react-colorful":{width:"100%",height:"100%",boxShadow:"$level2",cursor:"crosshair"},".react-colorful__saturation":{borderRadius:"$sm $sm 0 0"},".react-colorful__alpha, .react-colorful__hue":{height:10},".react-colorful__last-control":{borderRadius:"0 0 $sm $sm"},".react-colorful__pointer":{height:12,width:12}});function rW(a,e){return e!=="rgb"?Os(a).toRgb():a}function bj({value:a,displayValue:e,settings:t,onUpdate:n}){const{emitOnEditStart:i,emitOnEditEnd:s}=Ss(),{format:o,hasAlpha:r}=t,{popinRef:g,wrapperRef:u,shown:C,show:h,hide:f}=QX(),p=E.useRef(0),[y,v]=E.useState(()=>rW(a,o)),G=r?zQ:_Q,B=()=>{v(rW(a,o)),h(),i()},R=()=>{f(),s(),window.clearTimeout(p.current)},x=()=>{p.current=window.setTimeout(R,500)};return E.useEffect(()=>()=>window.clearTimeout(p.current),[]),fe.createElement(fe.Fragment,null,fe.createElement(fj,{ref:g,active:C,onClick:()=>B(),style:{color:e}}),C&&fe.createElement(kZ,null,fe.createElement(bX,{onPointerUp:R}),fe.createElement(mj,{ref:u,onMouseEnter:()=>window.clearTimeout(p.current),onMouseLeave:w=>w.buttons===0&&x()},fe.createElement(G,{color:y,onChange:n}))))}function yj(){const{value:a,displayValue:e,label:t,onChange:n,onUpdate:i,settings:s}=Ss();return fe.createElement(wl,{input:!0},fe.createElement(vr,null,t),fe.createElement(pj,null,fe.createElement(bj,{value:a,displayValue:e,onChange:n,onUpdate:i,settings:s}),fe.createElement(DZ,{value:e,onChange:n,onUpdate:i})))}var Gj=jt({component:yj},hj);function Bj(){const{label:a,displayValue:e,onUpdate:t,settings:n}=Ss();return fe.createElement(wl,{input:!0},fe.createElement(vr,null,a),fe.createElement(JZ,{value:e,settings:n,onUpdate:t}))}var vj=jt({component:Bj},wX(["x","y","z"]));const Zj=kt("div",{$flexCenter:"",position:"relative",backgroundColor:"$elevation3",borderRadius:"$sm",cursor:"pointer",height:"$rowHeight",width:"$rowHeight",touchAction:"none",$draggable:"",$hover:"","&:active":{cursor:"none"},"&::after":{content:'""',backgroundColor:"$accent2",height:4,width:4,borderRadius:2}}),Sj=kt("div",{$flexCenter:"",width:"$joystickWidth",height:"$joystickHeight",borderRadius:"$sm",boxShadow:"$level2",position:"fixed",zIndex:1e4,overflow:"hidden",$draggable:"",transform:"translate(-50%, -50%)",variants:{isOutOfBounds:{true:{backgroundColor:"$elevation1"},false:{backgroundColor:"$elevation3"}}},"> div":{position:"absolute",$flexCenter:"",borderStyle:"solid",borderWidth:1,borderColor:"$highlight1",backgroundColor:"$elevation3",width:"80%",height:"80%","&::after,&::before":{content:'""',position:"absolute",zindex:10,backgroundColor:"$highlight1"},"&::before":{width:"100%",height:1},"&::after":{height:"100%",width:1}},"> span":{position:"relative",zindex:100,width:10,height:10,backgroundColor:"$accent2",borderRadius:"50%"}});function Rj({value:a,settings:e,onUpdate:t}){const n=E.useRef(),i=E.useRef(0),s=E.useRef(0),o=E.useRef(1),[r,g]=E.useState(!1),[u,C]=E.useState(!1),[h,f]=GX(),p=E.useRef(null),y=E.useRef(null);E.useLayoutEffect(()=>{if(r){const{top:O,left:P,width:ie,height:le}=p.current.getBoundingClientRect();y.current.style.left=P+ie/2+"px",y.current.style.top=O+le/2+"px"}},[r]);const{keys:[v,G],joystick:B}=e,R=B==="invertY"?1:-1,{[v]:{step:x},[G]:{step:w}}=e,M=Ac("sizes","joystickWidth"),H=Ac("sizes","joystickHeight"),N=parseFloat(M)*.8/2,F=parseFloat(H)*.8/2,Y=E.useCallback(()=>{n.current||(C(!0),i.current&&f({x:i.current*N}),s.current&&f({y:s.current*-F}),n.current=window.setInterval(()=>{t(O=>{const P=x*i.current*o.current,ie=R*w*s.current*o.current;return Array.isArray(O)?{[v]:O[0]+P,[G]:O[1]+ie}:{[v]:O[v]+P,[G]:O[G]+ie}})},16))},[N,F,t,f,x,w,v,G,R]),X=E.useCallback(()=>{window.clearTimeout(n.current),n.current=void 0,C(!1)},[]);E.useEffect(()=>{function O(P){o.current=oX(P)}return window.addEventListener("keydown",O),window.addEventListener("keyup",O),()=>{window.clearTimeout(n.current),window.removeEventListener("keydown",O),window.removeEventListener("keyup",O)}},[]);const U=lp(({first:O,active:P,delta:[ie,le],movement:[T,J]})=>{O&&g(!0);const Q=wu(T,-N,N),se=wu(J,-F,F);i.current=Math.abs(T)>Math.abs(Q)?Math.sign(T-Q):0,s.current=Math.abs(J)>Math.abs(se)?Math.sign(se-J):0;let L=a[v],D=a[G];P?(i.current||(L+=ie*x*o.current,f({x:Q})),s.current||(D-=R*le*w*o.current,f({y:se})),i.current||s.current?Y():X(),t({[v]:L,[G]:D})):(g(!1),i.current=0,s.current=0,f({x:0,y:0}),X())});return fe.createElement(Zj,ia({ref:p},U()),r&&fe.createElement(kZ,null,fe.createElement(Sj,{ref:y,isOutOfBounds:u},fe.createElement("div",null),fe.createElement("span",{ref:h}))))}const wj=kt("div",{display:"grid",columnGap:"$colGap",variants:{withJoystick:{true:{gridTemplateColumns:"$sizes$rowHeight auto"},false:{gridTemplateColumns:"auto"}}}});function xj(){const{label:a,displayValue:e,onUpdate:t,settings:n}=Ss();return fe.createElement(wl,{input:!0},fe.createElement(vr,null,a),fe.createElement(wj,{withJoystick:!!n.joystick},n.joystick&&fe.createElement(Rj,{value:e,settings:n,onUpdate:t}),fe.createElement(JZ,{value:e,settings:n,onUpdate:t})))}const Wj=["joystick"],$X=wX(["x","y"]),Vj=a=>{let{joystick:e=!0}=a,t=ri(a,Wj);const{value:n,settings:i}=$X.normalize(t);return{value:n,settings:jt(jt({},i),{},{joystick:e})}};var Mj=jt(jt({component:xj},$X),{},{normalize:Vj});const Hj=a=>{if(a!==void 0){if(a instanceof File)try{return URL.createObjectURL(a)}catch{return}if(typeof a=="string"&&a.indexOf("blob:")===0)return a;throw Error("Invalid image format [undefined | blob |File].")}},Xj=(a,e)=>typeof e=="object"&&"image"in e,Nj=({image:a})=>({value:a});var Yj=Object.freeze({__proto__:null,sanitize:Hj,schema:Xj,normalize:Nj});const Kj=kt("div",{position:"relative",display:"grid",gridTemplateColumns:"$sizes$rowHeight auto 20px",columnGap:"$colGap",alignItems:"center"}),Fj=kt("div",{$flexCenter:"",overflow:"hidden",height:"$rowHeight",background:"$elevation3",textAlign:"center",color:"inherit",borderRadius:"$sm",outline:"none",userSelect:"none",cursor:"pointer",$inputStyle:"",$hover:"",$focusWithin:"",$active:"$accent1 $elevation1",variants:{isDragAccept:{true:{$inputStyle:"$accent1",backgroundColor:"$elevation1"}}}}),Ej=kt("div",{boxSizing:"border-box",borderRadius:"$sm",height:"$rowHeight",width:"$rowHeight",$inputStyle:"",backgroundSize:"cover",backgroundPosition:"center",variants:{hasImage:{true:{cursor:"pointer",$hover:"",$active:""}}}}),Tj=kt("div",{$flexCenter:"",width:"$imagePreviewWidth",height:"$imagePreviewHeight",borderRadius:"$sm",boxShadow:"$level2",pointerEvents:"none",$inputStyle:"",backgroundSize:"cover",backgroundPosition:"center"}),zj=kt("div",{fontSize:"0.8em",height:"100%",padding:"$rowGap $md"}),Lj=kt("div",{$flexCenter:"",top:"0",right:"0",marginRight:"$sm",height:"100%",cursor:"pointer",variants:{disabled:{true:{color:"$elevation3",cursor:"default"}}},"&::after,&::before":{content:'""',position:"absolute",height:2,width:10,borderRadius:1,backgroundColor:"currentColor"},"&::after":{transform:"rotate(45deg)"},"&::before":{transform:"rotate(-45deg)"}});function _j(){const{label:a,value:e,onUpdate:t,disabled:n}=Ss(),{popinRef:i,wrapperRef:s,shown:o,show:r,hide:g}=QX(),u=E.useCallback(y=>{y.length&&t(y[0])},[t]),C=E.useCallback(y=>{y.stopPropagation(),t(void 0)},[t]),{getRootProps:h,getInputProps:f,isDragAccept:p}=OX({maxFiles:1,accept:"image/*",onDrop:u,disabled:n});return fe.createElement(wl,{input:!0},fe.createElement(vr,null,a),fe.createElement(Kj,null,fe.createElement(Ej,{ref:i,hasImage:!!e,onPointerDown:()=>!!e&&r(),onPointerUp:g,style:{backgroundImage:e?`url(${e})`:"none"}}),o&&!!e&&fe.createElement(kZ,null,fe.createElement(bX,{onPointerUp:g,style:{cursor:"pointer"}}),fe.createElement(Tj,{ref:s,style:{backgroundImage:`url(${e})`}})),fe.createElement(Fj,h({isDragAccept:p}),fe.createElement("input",f()),fe.createElement(zj,null,p?"drop image":"click or drop")),fe.createElement(Lj,{onClick:C,disabled:!e})))}var Uj=jt({component:_j},Yj);const gW=xo().number(),Dj=(a,e)=>xo().array().length(2).every.number().test(a)&&xo().schema({min:gW,max:gW}).test(e),ny=a=>({min:a[0],max:a[1]}),eN=(a,{bounds:[e,t]},n)=>{const i=Array.isArray(a)?ny(a):a,s={min:n[0],max:n[1]},{min:o,max:r}=jt(jt({},s),i);return[wu(Number(o),e,Math.max(e,r)),wu(Number(r),Math.min(t,o),t)]},kj=({value:a,min:e,max:t})=>{const n={min:e,max:t},i=RX(ny(a),{min:n,max:n}),s=[e,t],o=jt(jt({},i),{},{bounds:s});return{value:eN(ny(a),o,a),settings:o}};var Oj=Object.freeze({__proto__:null,schema:Dj,format:ny,sanitize:eN,normalize:kj});const Jj=["value","bounds","onDrag"],Pj=["bounds"],Qj=kt("div",{display:"grid",columnGap:"$colGap",gridTemplateColumns:"auto calc($sizes$numberInputMinWidth * 2 + $space$rowGap)"});function jj(a){let{value:e,bounds:[t,n],onDrag:i}=a,s=ri(a,Jj);const o=E.useRef(null),r=E.useRef(null),g=E.useRef(null),u=E.useRef(0),C=Ac("sizes","scrubberWidth"),h=lp(({event:y,first:v,xy:[G],movement:[B],memo:R={}})=>{if(v){const{width:w,left:M}=o.current.getBoundingClientRect();u.current=w-parseFloat(C);const H=y?.target===r.current||y?.target===g.current;R.pos=j0((G-M)/w,t,n);const N=Math.abs(R.pos-e.min)-Math.abs(R.pos-e.max);R.key=N<0||N===0&&R.pos<=e.min?"min":"max",H&&(R.pos=e[R.key])}const x=R.pos+j0(B/u.current,0,n-t);return i({[R.key]:EP(x,s[R.key])}),R}),f=`calc(${Q0(e.min,t,n)} * (100% - ${C} - 8px) + 4px)`,p=`calc(${1-Q0(e.max,t,n)} * (100% - ${C} - 8px) + 4px)`;return fe.createElement(vX,ia({ref:o},h()),fe.createElement(BX,null,fe.createElement(ZX,{style:{left:f,right:p}})),fe.createElement(Z2,{position:"left",ref:r,style:{left:f}}),fe.createElement(Z2,{position:"right",ref:g,style:{right:p}}))}function qj(){const{label:a,displayValue:e,onUpdate:t,settings:n}=Ss(),i=ri(n,Pj);return fe.createElement(fe.Fragment,null,fe.createElement(wl,{input:!0},fe.createElement(vr,null,a),fe.createElement(Qj,null,fe.createElement(jj,ia({value:e},n,{onDrag:t})),fe.createElement(JZ,{value:e,settings:i,onUpdate:t,innerLabelTrim:0}))))}var $j=jt({component:qj},Oj);const e7=()=>{const a=new Map;return{on:(e,t)=>{let n=a.get(e);n===void 0&&(n=new Set,a.set(e,n)),n.add(t)},off:(e,t)=>{const n=a.get(e);n!==void 0&&(n.delete(t),n.size===0&&a.delete(e))},emit:(e,...t)=>{const n=a.get(e);if(n!==void 0)for(const i of n)i(...t)}}},t7=["type","value"],n7=["onChange","transient","onEditStart","onEditEnd"],i7=function(){const e=U4(D4(()=>({data:{}}))),t=e7();this.storeId=QJ(),this.useStore=e;const n={},i=new Set;this.getVisiblePaths=()=>{const o=this.getData(),r=Object.keys(o),g=[];Object.entries(n).forEach(([C,h])=>{h.render&&r.some(f=>f.indexOf(C)===0)&&!h.render(this.get)&&g.push(C+".")});const u=[];return i.forEach(C=>{C in o&&o[C].__refCount>0&&g.every(h=>C.indexOf(h)===-1)&&(!o[C].render||o[C].render(this.get))&&u.push(C)}),u},this.setOrderedPaths=o=>{o.forEach(r=>i.add(r))},this.orderPaths=o=>(this.setOrderedPaths(o),o),this.disposePaths=o=>{e.setState(r=>{const g=r.data;return o.forEach(u=>{if(u in g){const C=g[u];C.__refCount--,C.__refCount===0&&C.type in mr&&delete g[u]}}),{data:g}})},this.dispose=()=>{e.setState(()=>({data:{}}))},this.getFolderSettings=o=>n[o]||{},this.getData=()=>e.getState().data,this.addData=(o,r)=>{e.setState(g=>{const u=g.data;return Object.entries(o).forEach(([C,h])=>{let f=u[C];if(f){const{type:p,value:y}=h,v=ri(h,t7);p!==f.type?oc(ki.INPUT_TYPE_OVERRIDE,p):((f.__refCount===0||r)&&Object.assign(f,v),f.__refCount++)}else u[C]=jt(jt({},h),{},{__refCount:1})}),{data:u}})},this.setValueAtPath=(o,r,g)=>{e.setState(u=>{const C=u.data;return yx(C[o],r,o,this,g),{data:C}})},this.setSettingsAtPath=(o,r)=>{e.setState(g=>{const u=g.data;return u[o].settings=jt(jt({},u[o].settings),r),{data:u}})},this.disableInputAtPath=(o,r)=>{e.setState(g=>{const u=g.data;return u[o].disabled=r,{data:u}})},this.set=(o,r)=>{e.setState(g=>{const u=g.data;return Object.entries(o).forEach(([C,h])=>{try{yx(u[C],h,void 0,void 0,r)}catch{}}),{data:u}})},this.getInput=o=>{try{return this.getData()[o]}catch{oc(ki.PATH_DOESNT_EXIST,o)}},this.get=o=>{var r;return(r=this.getInput(o))===null||r===void 0?void 0:r.value},this.emitOnEditStart=o=>{t.emit(`onEditStart:${o}`,this.get(o),o,jt(jt({},this.getInput(o)),{},{get:this.get}))},this.emitOnEditEnd=o=>{t.emit(`onEditEnd:${o}`,this.get(o),o,jt(jt({},this.getInput(o)),{},{get:this.get}))},this.subscribeToEditStart=(o,r)=>{const g=`onEditStart:${o}`;return t.on(g,r),()=>t.off(g,r)},this.subscribeToEditEnd=(o,r)=>{const g=`onEditEnd:${o}`;return t.on(g,r),()=>t.off(g,r)};const s=(o,r,g)=>{const u={};return Object.entries(o).forEach(([C,h])=>{if(C==="")return oc(ki.EMPTY_KEY);let f=tS(r,C);if(h.type===mr.FOLDER){const p=s(h.schema,f,g);Object.assign(u,p),f in n||(n[f]=h.settings)}else if(C in g)oc(ki.DUPLICATE_KEYS,C,f,g[C].path);else{const p=aP(h,C,f,u);if(p){const{type:y,options:v,input:G}=p,{onChange:B,transient:R,onEditStart:x,onEditEnd:w}=v,M=ri(v,n7);u[f]=jt(jt(jt({type:y},M),G),{},{fromPanel:!0}),g[C]={path:f,onChange:B,transient:R,onEditStart:x,onEditEnd:w}}else oc(ki.UNKNOWN_INPUT,f,h)}}),u};this.getDataFromSchema=o=>{const r={};return[s(o,"",r),r]}},tN=new i7,a7={collapsed:!1};function Pb(a,e){return{type:mr.FOLDER,schema:a,settings:jt(jt({},a7),e)}}const cW=a=>"__levaInput"in a,s7=(a,e)=>{const t={},n=e?e.toLowerCase():null;return a.forEach(i=>{const[s,o]=oj(i);(!n||s.toLowerCase().indexOf(n)>-1)&&sj(t,o,{[s]:{__levaInput:!0,path:i}})}),t},o7=["type","label","path","valueKey","value","settings","setValue","disabled"];function l7(a){let{type:e,label:t,path:n,valueKey:i,value:s,settings:o,setValue:r,disabled:g}=a,u=ri(a,o7);const{displayValue:C,onChange:h,onUpdate:f}=yX({type:e,value:s,settings:o,setValue:r}),p=IC[e].component;return p?fe.createElement(uX.Provider,{value:jt({key:i,path:n,id:""+n,label:t,displayValue:C,value:s,onChange:h,onUpdate:f,settings:o,setValue:r,disabled:g},u)},fe.createElement(BP,{disabled:g},fe.createElement(p,null))):(oc(ki.NO_COMPONENT_FOR_TYPE,e,n),null)}const r7=kt("button",{display:"block",$reset:"",fontWeight:"$button",height:"$rowHeight",borderStyle:"none",borderRadius:"$sm",backgroundColor:"$elevation1",color:"$highlight1","&:not(:disabled)":{color:"$highlight3",backgroundColor:"$accent2",cursor:"pointer",$hover:"$accent3",$active:"$accent3 $accent1",$focus:""}});function g7({onClick:a,settings:e,label:t}){const n=op();return fe.createElement(wl,null,fe.createElement(r7,{disabled:e.disabled,onClick:()=>a(n.get)},t))}const c7=kt("div",{$flex:"",justifyContent:"flex-end",gap:"$colGap"}),u7=kt("button",{$reset:"",cursor:"pointer",borderRadius:"$xs","&:hover":{backgroundColor:"$elevation3"}}),I7=({label:a,opts:e})=>{let t=typeof a=="string"&&a.trim()===""?null:a,n=e;return typeof e.opts=="object"&&(n.label!==void 0&&(t=e.label),n=e.opts),{label:t,opts:n}};function C7(a){const{label:e,opts:t}=I7(a),n=op();return fe.createElement(wl,{input:!!e},e&&fe.createElement(vr,null,e),fe.createElement(c7,null,Object.entries(t).map(([i,s])=>fe.createElement(u7,{key:i,onClick:()=>s(n.get)},i))))}const d7=kt("canvas",{height:"$monitorHeight",width:"100%",display:"block",borderRadius:"$sm"}),nN=100;function A7(a,e){a.push(e),a.length>nN&&a.shift()}const h7=E.forwardRef(function({initialValue:a},e){const t=Ac("colors","highlight3"),n=Ac("colors","elevation2"),i=Ac("colors","highlight1"),[s,o]=E.useMemo(()=>[Os(i).alpha(.4).toRgbString(),Os(i).alpha(.1).toRgbString()],[i]),r=E.useRef([a]),g=E.useRef(a),u=E.useRef(a),C=E.useRef(),h=E.useCallback((y,v)=>{if(!y)return;const{width:G,height:B}=y,R=new Path2D,x=G/nN,w=B*.05;for(let N=0;N<r.current.length;N++){const F=Q0(r.current[N],g.current,u.current),Y=x*N,X=B-F*(B-w*2)-w;R.lineTo(Y,X)}v.clearRect(0,0,G,B);const M=new Path2D(R);M.lineTo(x*(r.current.length+1),B),M.lineTo(0,B),M.lineTo(0,0);const H=v.createLinearGradient(0,0,0,B);H.addColorStop(0,s),H.addColorStop(1,o),v.fillStyle=H,v.fill(M),v.strokeStyle=n,v.lineJoin="round",v.lineWidth=14,v.stroke(R),v.strokeStyle=t,v.lineWidth=2,v.stroke(R)},[t,n,s,o]),[f,p]=MP(h);return E.useImperativeHandle(e,()=>({frame:y=>{(g.current===void 0||y<g.current)&&(g.current=y),(u.current===void 0||y>u.current)&&(u.current=y),A7(r.current,y),C.current=requestAnimationFrame(()=>h(f.current,p.current))}}),[f,p,h]),E.useEffect(()=>()=>cancelAnimationFrame(C.current),[]),fe.createElement(d7,{ref:f})}),uW=a=>Number.isFinite(a)?a.toPrecision(2):a.toString(),f7=E.forwardRef(function({initialValue:a},e){const[t,n]=E.useState(uW(a));return E.useImperativeHandle(e,()=>({frame:i=>n(uW(i))}),[]),fe.createElement("div",null,t)});function IW(a){return typeof a=="function"?a():a.current}function p7({label:a,objectOrFn:e,settings:t}){const n=E.useRef(),i=E.useRef(IW(e));return E.useEffect(()=>{const s=window.setInterval(()=>{var o;document.hidden||(o=n.current)===null||o===void 0||o.frame(IW(e))},t.interval);return()=>window.clearInterval(s)},[e,t.interval]),fe.createElement(wl,{input:!0},fe.createElement(vr,{align:"top"},a),t.graph?fe.createElement(h7,{ref:n,initialValue:i.current}):fe.createElement(f7,{ref:n,initialValue:i.current}))}const m7=["type","label","key"],b7={[mr.BUTTON]:g7,[mr.BUTTON_GROUP]:C7,[mr.MONITOR]:p7},y7=fe.memo(({path:a})=>{const[e,{set:t,setSettings:n,disable:i,storeId:s,emitOnEditStart:o,emitOnEditEnd:r}]=XP(a);if(!e)return null;const{type:g,label:u,key:C}=e,h=ri(e,m7);if(g in mr){const f=b7[g];return fe.createElement(f,ia({label:u,path:a},h))}return g in IC?fe.createElement(l7,ia({key:s+a,type:g,label:u,storeId:s,path:a,valueKey:C,setValue:t,setSettings:n,disable:i,emitOnEditStart:o,emitOnEditEnd:r},h)):(LJ(ki.UNSUPPORTED_INPUT,g,a),null)});function G7({toggle:a,toggled:e,name:t}){return fe.createElement(bP,{onClick:()=>a()},fe.createElement(OZ,{toggled:e}),fe.createElement("div",null,t))}const B7=({name:a,path:e,tree:t})=>{const n=op(),i=tS(e,a),{collapsed:s,color:o}=n.getFolderSettings(i),[r,g]=E.useState(!s),u=E.useRef(null),C=Ac("colors","folderWidgetColor"),h=Ac("colors","folderTextColor");return E.useLayoutEffect(()=>{u.current.style.setProperty("--leva-colors-folderWidgetColor",o||C),u.current.style.setProperty("--leva-colors-folderTextColor",o||h)},[o,C,h]),fe.createElement(q0,{ref:u},fe.createElement(G7,{name:a,toggled:r,toggle:()=>g(f=>!f)}),fe.createElement(iN,{parent:i,tree:t,toggled:r}))},iN=fe.memo(({isRoot:a=!1,fill:e=!1,flat:t=!1,parent:n,tree:i,toggled:s})=>{const{wrapperRef:o,contentRef:r}=gj(s),g=op(),u=([h,f])=>{var p;return(cW(f)?(p=g.getInput(f.path))===null||p===void 0?void 0:p.order:g.getFolderSettings(tS(n,h)).order)||0},C=Object.entries(i).sort((h,f)=>u(h)-u(f));return fe.createElement(B2,{ref:o,isRoot:a,fill:e,flat:t},fe.createElement(fX,{ref:r,isRoot:a,toggled:s},C.map(([h,f])=>cW(f)?fe.createElement(y7,{key:f.path,valueKey:f.valueKey,path:f.path}):fe.createElement(B7,{key:h,name:h,path:n,tree:f}))))}),v7=kt("div",{position:"relative",fontFamily:"$mono",fontSize:"$root",color:"$rootText",backgroundColor:"$elevation1",variants:{fill:{false:{position:"fixed",top:"10px",right:"10px",zIndex:1e3,width:"$rootWidth"},true:{position:"relative",width:"100%"}},flat:{false:{borderRadius:"$lg",boxShadow:"$level1"}},oneLineLabels:{true:{[`${mX}`]:{gridTemplateColumns:"auto",gridAutoColumns:"minmax(max-content, 1fr)",gridAutoRows:"minmax($sizes$rowHeight), auto)",rowGap:0,columnGap:0,marginTop:"$rowGap"}}},hideTitleBar:{true:{$$titleBarHeight:"0px"},false:{$$titleBarHeight:"$sizes$titleBarHeight"}}},"&,*,*:after,*:before":{boxSizing:"border-box"},"*::selection":{backgroundColor:"$accent2"}}),aN=40,iy=kt("i",{$flexCenter:"",width:aN,userSelect:"none",cursor:"pointer","> svg":{fill:"$highlight1",transition:"transform 350ms ease, fill 250ms ease"},"&:hover > svg":{fill:"$highlight3"},variants:{active:{true:{"> svg":{fill:"$highlight2"}}}}}),Z7=kt("div",{display:"flex",alignItems:"stretch",justifyContent:"space-between",height:"$titleBarHeight",variants:{mode:{drag:{cursor:"grab"}}}}),S7=kt("div",{$flex:"",position:"relative",width:"100%",overflow:"hidden",transition:"height 250ms ease",color:"$highlight3",paddingLeft:"$md",[`> ${iy}`]:{height:30},variants:{toggled:{true:{height:30},false:{height:0}}}}),R7=kt("input",{$reset:"",flex:1,position:"relative",height:30,width:"100%",backgroundColor:"transparent",fontSize:"10px",borderRadius:"$root","&:focus":{},"&::placeholder":{color:"$highlight2"}}),w7=kt("div",{touchAction:"none",$flexCenter:"",flex:1,"> svg":{fill:"$highlight1"},color:"$highlight1",variants:{drag:{true:{$draggable:"","> svg":{transition:"fill 250ms ease"},"&:hover":{color:"$highlight3"},"&:hover > svg":{fill:"$highlight3"}}},filterEnabled:{false:{paddingRight:aN}}}}),x7=fe.forwardRef(({setFilter:a,toggle:e},t)=>{const[n,i]=E.useState(""),s=E.useMemo(()=>sX(a,250),[a]),o=()=>{a(""),i("")},r=g=>{const u=g.currentTarget.value;e(!0),i(u)};return E.useEffect(()=>{s(n)},[n,s]),fe.createElement(fe.Fragment,null,fe.createElement(R7,{ref:t,value:n,placeholder:"[Open filter with CMD+SHIFT+L]",onPointerDown:g=>g.stopPropagation(),onChange:r}),fe.createElement(iy,{onClick:()=>o(),style:{visibility:n?"visible":"hidden"}},fe.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",height:"14",width:"14",viewBox:"0 0 20 20",fill:"currentColor"},fe.createElement("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z",clipRule:"evenodd"}))))});function W7({setFilter:a,onDrag:e,onDragStart:t,onDragEnd:n,toggle:i,toggled:s,title:o,drag:r,filterEnabled:g,from:u}){const[C,h]=E.useState(!1),f=E.useRef(null);E.useEffect(()=>{var y,v;C?(y=f.current)===null||y===void 0||y.focus():(v=f.current)===null||v===void 0||v.blur()},[C]);const p=lp(({offset:[y,v],first:G,last:B})=>{e({x:y,y:v}),G&&t({x:y,y:v}),B&&n({x:y,y:v})},{filterTaps:!0,from:({offset:[y,v]})=>[u?.x||y,u?.y||v]});return E.useEffect(()=>{const y=v=>{v.key==="L"&&v.shiftKey&&v.metaKey&&h(G=>!G)};return window.addEventListener("keydown",y),()=>window.removeEventListener("keydown",y)},[]),fe.createElement(fe.Fragment,null,fe.createElement(Z7,{mode:r?"drag":void 0},fe.createElement(iy,{active:!s,onClick:()=>i()},fe.createElement(OZ,{toggled:s,width:12,height:8})),fe.createElement(w7,ia({},r?p():{},{drag:r,filterEnabled:g}),o===void 0&&r?fe.createElement("svg",{width:"20",height:"10",viewBox:"0 0 28 14",xmlns:"http://www.w3.org/2000/svg"},fe.createElement("circle",{cx:"2",cy:"2",r:"2"}),fe.createElement("circle",{cx:"14",cy:"2",r:"2"}),fe.createElement("circle",{cx:"26",cy:"2",r:"2"}),fe.createElement("circle",{cx:"2",cy:"12",r:"2"}),fe.createElement("circle",{cx:"14",cy:"12",r:"2"}),fe.createElement("circle",{cx:"26",cy:"12",r:"2"})):o),g&&fe.createElement(iy,{active:C,onClick:()=>h(y=>!y)},fe.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",height:"20",viewBox:"0 0 20 20"},fe.createElement("path",{d:"M9 9a2 2 0 114 0 2 2 0 01-4 0z"}),fe.createElement("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm1-13a4 4 0 00-3.446 6.032l-2.261 2.26a1 1 0 101.414 1.415l2.261-2.261A4 4 0 1011 5z",clipRule:"evenodd"})))),fe.createElement(S7,{toggled:C},fe.createElement(x7,{ref:f,setFilter:a,toggle:i})))}const V7=["store","hidden","theme","collapsed"];function M7(a){let{store:e,hidden:t=!1,theme:n,collapsed:i=!1}=a,s=ri(a,V7);const o=PX(()=>dP(n),[n]),[r,g]=E.useState(!i),u=typeof i=="object"?!i.collapsed:r,C=E.useMemo(()=>typeof i=="object"?h=>{typeof h=="function"?i.onChange(!h(!i.collapsed)):i.onChange(!h)}:g,[i]);return!e||t?null:fe.createElement(UZ.Provider,{value:o},fe.createElement(H7,ia({store:e},s,{toggled:u,setToggle:C,rootClass:o.className})))}const H7=fe.memo(({store:a,rootClass:e,fill:t=!1,flat:n=!1,neverHide:i=!1,oneLineLabels:s=!1,titleBar:o={title:void 0,drag:!0,filter:!0,position:void 0,onDrag:void 0,onDragStart:void 0,onDragEnd:void 0},hideCopyButton:r=!1,toggled:g,setToggle:u})=>{var C,h;const f=cj(a),[p,y]=E.useState(""),v=E.useMemo(()=>s7(f,p),[f,p]),[G,B]=GX(),R=i||f.length>0,x=typeof o=="object"&&o.title||void 0,w=typeof o=="object"&&(C=o.drag)!==null&&C!==void 0?C:!0,M=typeof o=="object"&&(h=o.filter)!==null&&h!==void 0?h:!0,H=typeof o=="object"&&o.position||void 0,N=typeof o=="object"&&o.onDrag||void 0,F=typeof o=="object"&&o.onDragStart||void 0,Y=typeof o=="object"&&o.onDragEnd||void 0;return fe.useEffect(()=>{B({x:H?.x,y:H?.y})},[H,B]),CP(),fe.createElement(CX.Provider,{value:{hideCopyButton:r}},fe.createElement(v7,{ref:G,className:e,fill:t,flat:n,oneLineLabels:s,hideTitleBar:!o,style:{display:R?"block":"none"}},o&&fe.createElement(W7,{onDrag:X=>{B(X),N?.(X)},onDragStart:X=>F?.(X),onDragEnd:X=>Y?.(X),setFilter:y,toggle:X=>u(U=>X??!U),toggled:g,title:x,drag:w,filterEnabled:M,from:H}),R&&fe.createElement(IX.Provider,{value:a},fe.createElement(iN,{isRoot:!0,fill:t,flat:n,tree:v,toggled:g}))))}),X7=["isRoot"];let ay=!1,jI=null;function sN(a){let{isRoot:e=!1}=a,t=ri(a,X7);return E.useEffect(()=>(ay=!0,!e&&jI&&(jI.remove(),jI=null),()=>{e||(ay=!1)}),[e]),fe.createElement(M7,ia({store:tN},t))}function N7(a){E.useEffect(()=>{a&&!ay&&(jI||(jI=document.getElementById("leva__root")||Object.assign(document.createElement("div"),{id:"leva__root"}),document.body&&(document.body.appendChild(jI),E2.createRoot(jI).render(fe.createElement(sN,{isRoot:!0})))),ay=!0)},[a])}function Y7(a,e,t,n,i){let s,o,r,g,u;return typeof a=="string"?(o=a,s=e,Array.isArray(t)&&(u=t)):(s=a,Array.isArray(e)?u=e:(g=e,u=t)),{schema:s,folderName:o,folderSettings:r,hookSettings:g,deps:u||[]}}function Mu(a,e,t,n,i){const{folderName:s,schema:o,folderSettings:r,hookSettings:g,deps:u}=Y7(a,e,t),C=typeof o=="function",h=E.useRef(!1),f=E.useRef(!0),p=PX(()=>{h.current=!0;const U=typeof o=="function"?o():o;return s?{[s]:Pb(U,r)}:U},u),y=!(g!=null&&g.store);N7(y);const[v]=E.useState(()=>g?.store||tN),[G,B]=E.useMemo(()=>v.getDataFromSchema(p),[v,p]),[R,x,w,M,H]=E.useMemo(()=>{const U=[],O=[],P={},ie={},le={};return Object.values(B).forEach(({path:T,onChange:J,onEditStart:Q,onEditEnd:se,transient:L})=>{U.push(T),J?(P[T]=J,L||O.push(T)):O.push(T),Q&&(ie[T]=Q),se&&(le[T]=se)}),[U,O,P,ie,le]},[B]),N=E.useMemo(()=>v.orderPaths(R),[R,v]),F=uj(v,x,G),Y=E.useCallback(U=>{const O=Object.entries(U).reduce((P,[ie,le])=>Object.assign(P,{[B[ie].path]:le}),{});v.set(O,!1)},[v,B]),X=E.useCallback(U=>v.get(B[U].path),[v,B]);return E.useEffect(()=>{const U=!f.current&&h.current;return v.addData(G,U),f.current=!1,h.current=!1,()=>v.disposePaths(N)},[v,N,G]),E.useEffect(()=>{const U=[];return Object.entries(w).forEach(([O,P])=>{P(v.get(O),O,jt({initial:!0,get:v.get},v.getInput(O)));const ie=v.useStore.subscribe(le=>{const T=le.data[O];return[T.disabled?void 0:T.value,T]},([le,T])=>P(le,O,jt({initial:!1,get:v.get},T)),{equalityFn:Jy});U.push(ie)}),()=>U.forEach(O=>O())},[v,w]),E.useEffect(()=>{const U=[];return Object.entries(M).forEach(([O,P])=>U.push(v.subscribeToEditStart(O,P))),Object.entries(H).forEach(([O,P])=>U.push(v.subscribeToEditEnd(O,P))),()=>U.forEach(O=>O())},[M,H,v]),C?[F,Y,X]:F}Gc(yr.SELECT,jP);Gc(yr.IMAGE,Uj);Gc(yr.NUMBER,zP);Gc(yr.COLOR,Gj);Gc(yr.STRING,oQ);Gc(yr.BOOLEAN,CQ);Gc(yr.INTERVAL,$j);Gc(yr.VECTOR3D,vj);Gc(yr.VECTOR2D,Mj);const ta={minPolar:Math.PI/4,maxPolar:Math.PI/2.5,minAzimuth:Math.PI/32,maxAzimuth:Math.PI/1.5,minDistance:10,maxDistance:10,margin:1,rubberBand:.12};function K7({cameraRef:a,controlsRef:e,initialPosition:t=[7.359,3.958,6.926],initialRotation:n=[-.627,.71,.441],initialFov:i=30,initialTarget:s=[0,0,0]}){const o=E.useRef(!1),r=E.useRef(!1),[g,u]=Mu("Camera & Controls",()=>({Position:Pb({posX:{value:t[0],min:-50,max:50,step:.01},posY:{value:t[1],min:-50,max:50,step:.01},posZ:{value:t[2],min:-50,max:50,step:.01}}),Rotation:Pb({rotX:{value:n[0],min:-Math.PI,max:Math.PI,step:.01},rotY:{value:n[1],min:-Math.PI,max:Math.PI,step:.01},rotZ:{value:n[2],min:-Math.PI,max:Math.PI,step:.01}}),fov:{value:i,min:10,max:120,step:.1},Target:Pb({targetX:{value:s[0],min:-20,max:20,step:.01},targetY:{value:s[1],min:-20,max:20,step:.01},targetZ:{value:s[2],min:-20,max:20,step:.01}}),enablePan:{value:!0},enableZoom:{value:!0},enableRotate:{value:!0}}));E.useEffect(()=>{!a.current||!e.current||(r.current=!0,a.current.position.set(g.posX,g.posY,g.posZ),a.current.rotation.set(g.rotX,g.rotY,g.rotZ),a.current.fov=g.fov,a.current.updateProjectionMatrix(),e.current.target.set(g.targetX,g.targetY,g.targetZ),e.current.enablePan=g.enablePan,e.current.enableZoom=g.enableZoom,e.current.enableRotate=g.enableRotate,e.current.update(),r.current=!1)},[a,e,g.posX,g.posY,g.posZ,g.rotX,g.rotY,g.rotZ,g.fov,g.targetX,g.targetY,g.targetZ,g.enablePan,g.enableZoom,g.enableRotate]),E.useEffect(()=>{if(!e.current)return;const C=e.current;function h(){r.current||(o.current=!0,a.current&&u({posX:a.current.position.x,posY:a.current.position.y,posZ:a.current.position.z,rotX:a.current.rotation.x,rotY:a.current.rotation.y,rotZ:a.current.rotation.z,fov:a.current.fov}),u({targetX:C.target.x,targetY:C.target.y,targetZ:C.target.z}),o.current=!1)}return C.addEventListener("change",h),()=>C.removeEventListener("change",h)},[e,a,u])}function F7(){const a=E.useRef(null),e=E.useRef(null);return K7({cameraRef:a,controlsRef:e}),Wo(()=>{const t=e.current;if(!t)return;const n=t.getPolarAngle(),i=ta.minPolar,s=ta.maxPolar;n<i?t.setPolarAngle(OI.lerp(n,i,ta.rubberBand)):n>s&&t.setPolarAngle(OI.lerp(n,s,ta.rubberBand));const o=t.getAzimuthalAngle(),r=ta.minAzimuth,g=ta.maxAzimuth;o<r?t.setAzimuthalAngle(OI.lerp(o,r,ta.rubberBand)):o>g&&t.setAzimuthalAngle(OI.lerp(o,g,ta.rubberBand));const u=t.object.position.distanceTo(t.target),C=ta.minDistance,h=ta.maxDistance;u<C?t.object.position.lerp(t.target.clone().add(t.object.position.clone().sub(t.target).normalize().multiplyScalar(C)),ta.rubberBand):u>h&&t.object.position.lerp(t.target.clone().add(t.object.position.clone().sub(t.target).normalize().multiplyScalar(h)),ta.rubberBand),t.update()}),de.jsxs(de.Fragment,{children:[de.jsx(uk,{ref:a,makeDefault:!0,position:[7.359,3.958,6.926],rotation:[-.627,.71,.441],fov:30}),de.jsx(Ik,{ref:e,enableDamping:!0,dampingFactor:.05,minPolarAngle:ta.minPolar-ta.margin,maxPolarAngle:ta.maxPolar+ta.margin,minAzimuthAngle:ta.minAzimuth-ta.margin,maxAzimuthAngle:ta.maxAzimuth+ta.margin,minDistance:ta.minDistance,maxDistance:ta.maxDistance})]})}function E7(){const{position:a,rotation:e,intensity:t}=Mu("Lights",{position:{value:[2,10,1],step:1},rotation:{value:[0,0,0],step:1},intensity:{value:550,step:1}});return de.jsxs(de.Fragment,{children:[de.jsx("ambientLight",{intensity:Math.PI/2}),de.jsx("spotLight",{castShadow:!0,penumbra:.5,position:a,rotation:e,intensity:t})]})}var nS={exports:{}},Pd=typeof Reflect=="object"?Reflect:null,CW=Pd&&typeof Pd.apply=="function"?Pd.apply:function(e,t,n){return Function.prototype.apply.call(e,t,n)},Qb;Pd&&typeof Pd.ownKeys=="function"?Qb=Pd.ownKeys:Object.getOwnPropertySymbols?Qb=function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:Qb=function(e){return Object.getOwnPropertyNames(e)};function T7(a){console&&console.warn&&console.warn(a)}var oN=Number.isNaN||function(e){return e!==e};function ci(){ci.init.call(this)}nS.exports=ci;nS.exports.once=U7;ci.EventEmitter=ci;ci.prototype._events=void 0;ci.prototype._eventsCount=0;ci.prototype._maxListeners=void 0;var dW=10;function tG(a){if(typeof a!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof a)}Object.defineProperty(ci,"defaultMaxListeners",{enumerable:!0,get:function(){return dW},set:function(a){if(typeof a!="number"||a<0||oN(a))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+a+".");dW=a}});ci.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0};ci.prototype.setMaxListeners=function(e){if(typeof e!="number"||e<0||oN(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this};function lN(a){return a._maxListeners===void 0?ci.defaultMaxListeners:a._maxListeners}ci.prototype.getMaxListeners=function(){return lN(this)};ci.prototype.emit=function(e){for(var t=[],n=1;n<arguments.length;n++)t.push(arguments[n]);var i=e==="error",s=this._events;if(s!==void 0)i=i&&s.error===void 0;else if(!i)return!1;if(i){var o;if(t.length>0&&(o=t[0]),o instanceof Error)throw o;var r=new Error("Unhandled error."+(o?" ("+o.message+")":""));throw r.context=o,r}var g=s[e];if(g===void 0)return!1;if(typeof g=="function")CW(g,this,t);else for(var u=g.length,C=IN(g,u),n=0;n<u;++n)CW(C[n],this,t);return!0};function rN(a,e,t,n){var i,s,o;if(tG(t),s=a._events,s===void 0?(s=a._events=Object.create(null),a._eventsCount=0):(s.newListener!==void 0&&(a.emit("newListener",e,t.listener?t.listener:t),s=a._events),o=s[e]),o===void 0)o=s[e]=t,++a._eventsCount;else if(typeof o=="function"?o=s[e]=n?[t,o]:[o,t]:n?o.unshift(t):o.push(t),i=lN(a),i>0&&o.length>i&&!o.warned){o.warned=!0;var r=new Error("Possible EventEmitter memory leak detected. "+o.length+" "+String(e)+" listeners added. Use emitter.setMaxListeners() to increase limit");r.name="MaxListenersExceededWarning",r.emitter=a,r.type=e,r.count=o.length,T7(r)}return a}ci.prototype.addListener=function(e,t){return rN(this,e,t,!1)};ci.prototype.on=ci.prototype.addListener;ci.prototype.prependListener=function(e,t){return rN(this,e,t,!0)};function z7(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function gN(a,e,t){var n={fired:!1,wrapFn:void 0,target:a,type:e,listener:t},i=z7.bind(n);return i.listener=t,n.wrapFn=i,i}ci.prototype.once=function(e,t){return tG(t),this.on(e,gN(this,e,t)),this};ci.prototype.prependOnceListener=function(e,t){return tG(t),this.prependListener(e,gN(this,e,t)),this};ci.prototype.removeListener=function(e,t){var n,i,s,o,r;if(tG(t),i=this._events,i===void 0)return this;if(n=i[e],n===void 0)return this;if(n===t||n.listener===t)--this._eventsCount===0?this._events=Object.create(null):(delete i[e],i.removeListener&&this.emit("removeListener",e,n.listener||t));else if(typeof n!="function"){for(s=-1,o=n.length-1;o>=0;o--)if(n[o]===t||n[o].listener===t){r=n[o].listener,s=o;break}if(s<0)return this;s===0?n.shift():L7(n,s),n.length===1&&(i[e]=n[0]),i.removeListener!==void 0&&this.emit("removeListener",e,r||t)}return this};ci.prototype.off=ci.prototype.removeListener;ci.prototype.removeAllListeners=function(e){var t,n,i;if(n=this._events,n===void 0)return this;if(n.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):n[e]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete n[e]),this;if(arguments.length===0){var s=Object.keys(n),o;for(i=0;i<s.length;++i)o=s[i],o!=="removeListener"&&this.removeAllListeners(o);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(t=n[e],typeof t=="function")this.removeListener(e,t);else if(t!==void 0)for(i=t.length-1;i>=0;i--)this.removeListener(e,t[i]);return this};function cN(a,e,t){var n=a._events;if(n===void 0)return[];var i=n[e];return i===void 0?[]:typeof i=="function"?t?[i.listener||i]:[i]:t?_7(i):IN(i,i.length)}ci.prototype.listeners=function(e){return cN(this,e,!0)};ci.prototype.rawListeners=function(e){return cN(this,e,!1)};ci.listenerCount=function(a,e){return typeof a.listenerCount=="function"?a.listenerCount(e):uN.call(a,e)};ci.prototype.listenerCount=uN;function uN(a){var e=this._events;if(e!==void 0){var t=e[a];if(typeof t=="function")return 1;if(t!==void 0)return t.length}return 0}ci.prototype.eventNames=function(){return this._eventsCount>0?Qb(this._events):[]};function IN(a,e){for(var t=new Array(e),n=0;n<e;++n)t[n]=a[n];return t}function L7(a,e){for(;e+1<a.length;e++)a[e]=a[e+1];a.pop()}function _7(a){for(var e=new Array(a.length),t=0;t<e.length;++t)e[t]=a[t].listener||a[t];return e}function U7(a,e){return new Promise(function(t,n){function i(o){a.removeListener(e,s),n(o)}function s(){typeof a.removeListener=="function"&&a.removeListener("error",i),t([].slice.call(arguments))}CN(a,e,s,{once:!0}),e!=="error"&&D7(a,i,{once:!0})})}function D7(a,e,t){typeof a.on=="function"&&CN(a,"error",e,t)}function CN(a,e,t,n){if(typeof a.on=="function")n.once?a.once(e,t):a.on(e,t);else if(typeof a.addEventListener=="function")a.addEventListener(e,function i(s){n.once&&a.removeEventListener(e,i),t(s)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof a)}var k7=nS.exports;function O7(a,e){var t=atob(a);if(e){for(var n=new Uint8Array(t.length),i=0,s=t.length;i<s;++i)n[i]=t.charCodeAt(i);return String.fromCharCode.apply(null,new Uint16Array(n.buffer))}return t}function J7(a,e,t){var n=e===void 0?null:e,i=t===void 0?!1:t,s=O7(a,i),o=s.indexOf(`
`,10)+1,r=s.substring(o)+(n?"//# sourceMappingURL="+n:""),g=new Blob([r],{type:"application/javascript"});return URL.createObjectURL(g)}function P7(a,e,t){var n;return function(s){return n=n||J7(a,e,t),new Worker(n,s)}}var Q7=P7("Lyogcm9sbHVwLXBsdWdpbi13ZWItd29ya2VyLWxvYWRlciAqLwooZnVuY3Rpb24gKCkgewogICd1c2Ugc3RyaWN0JzsKCiAgLyoqCiAgICogUmVjb3JkcyB3aGF0IG9iamVjdHMgYXJlIGNvbGxpZGluZyB3aXRoIGVhY2ggb3RoZXIKICAgKi8KCiAgLyoqCiAgICogQSAzeDMgbWF0cml4LgogICAqIEF1dGhvcmVkIGJ5IHtAbGluayBodHRwOi8vZ2l0aHViLmNvbS9zY2h0ZXBwZS8gc2NodGVwcGV9CiAgICovCiAgY2xhc3MgTWF0MyB7CiAgICAvKioKICAgICAqIEEgdmVjdG9yIG9mIGxlbmd0aCA5LCBjb250YWluaW5nIGFsbCBtYXRyaXggZWxlbWVudHMuCiAgICAgKi8KCiAgICAvKioKICAgICAqIEBwYXJhbSBlbGVtZW50cyBBIHZlY3RvciBvZiBsZW5ndGggOSwgY29udGFpbmluZyBhbGwgbWF0cml4IGVsZW1lbnRzLgogICAgICovCiAgICBjb25zdHJ1Y3RvcihlbGVtZW50cykgewogICAgICBpZiAoZWxlbWVudHMgPT09IHZvaWQgMCkgewogICAgICAgIGVsZW1lbnRzID0gWzAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDBdOwogICAgICB9CgogICAgICB0aGlzLmVsZW1lbnRzID0gZWxlbWVudHM7CiAgICB9CiAgICAvKioKICAgICAqIFNldHMgdGhlIG1hdHJpeCB0byBpZGVudGl0eQogICAgICogQHRvZG8gU2hvdWxkIHBlcmhhcHMgYmUgcmVuYW1lZCB0byBgc2V0SWRlbnRpdHkoKWAgdG8gYmUgbW9yZSBjbGVhci4KICAgICAqIEB0b2RvIENyZWF0ZSBhbm90aGVyIGZ1bmN0aW9uIHRoYXQgaW1tZWRpYXRlbHkgY3JlYXRlcyBhbiBpZGVudGl0eSBtYXRyaXggZWcuIGBleWUoKWAKICAgICAqLwoKCiAgICBpZGVudGl0eSgpIHsKICAgICAgY29uc3QgZSA9IHRoaXMuZWxlbWVudHM7CiAgICAgIGVbMF0gPSAxOwogICAgICBlWzFdID0gMDsKICAgICAgZVsyXSA9IDA7CiAgICAgIGVbM10gPSAwOwogICAgICBlWzRdID0gMTsKICAgICAgZVs1XSA9IDA7CiAgICAgIGVbNl0gPSAwOwogICAgICBlWzddID0gMDsKICAgICAgZVs4XSA9IDE7CiAgICB9CiAgICAvKioKICAgICAqIFNldCBhbGwgZWxlbWVudHMgdG8gemVybwogICAgICovCgoKICAgIHNldFplcm8oKSB7CiAgICAgIGNvbnN0IGUgPSB0aGlzLmVsZW1lbnRzOwogICAgICBlWzBdID0gMDsKICAgICAgZVsxXSA9IDA7CiAgICAgIGVbMl0gPSAwOwogICAgICBlWzNdID0gMDsKICAgICAgZVs0XSA9IDA7CiAgICAgIGVbNV0gPSAwOwogICAgICBlWzZdID0gMDsKICAgICAgZVs3XSA9IDA7CiAgICAgIGVbOF0gPSAwOwogICAgfQogICAgLyoqCiAgICAgKiBTZXRzIHRoZSBtYXRyaXggZGlhZ29uYWwgZWxlbWVudHMgZnJvbSBhIFZlYzMKICAgICAqLwoKCiAgICBzZXRUcmFjZSh2ZWN0b3IpIHsKICAgICAgY29uc3QgZSA9IHRoaXMuZWxlbWVudHM7CiAgICAgIGVbMF0gPSB2ZWN0b3IueDsKICAgICAgZVs0XSA9IHZlY3Rvci55OwogICAgICBlWzhdID0gdmVjdG9yLno7CiAgICB9CiAgICAvKioKICAgICAqIEdldHMgdGhlIG1hdHJpeCBkaWFnb25hbCBlbGVtZW50cwogICAgICovCgoKICAgIGdldFRyYWNlKHRhcmdldCkgewogICAgICBpZiAodGFyZ2V0ID09PSB2b2lkIDApIHsKICAgICAgICB0YXJnZXQgPSBuZXcgVmVjMygpOwogICAgICB9CgogICAgICBjb25zdCBlID0gdGhpcy5lbGVtZW50czsKICAgICAgdGFyZ2V0LnggPSBlWzBdOwogICAgICB0YXJnZXQueSA9IGVbNF07CiAgICAgIHRhcmdldC56ID0gZVs4XTsKICAgICAgcmV0dXJuIHRhcmdldDsKICAgIH0KICAgIC8qKgogICAgICogTWF0cml4LVZlY3RvciBtdWx0aXBsaWNhdGlvbgogICAgICogQHBhcmFtIHYgVGhlIHZlY3RvciB0byBtdWx0aXBseSB3aXRoCiAgICAgKiBAcGFyYW0gdGFyZ2V0IE9wdGlvbmFsLCB0YXJnZXQgdG8gc2F2ZSB0aGUgcmVzdWx0IGluLgogICAgICovCgoKICAgIHZtdWx0KHYsIHRhcmdldCkgewogICAgICBpZiAodGFyZ2V0ID09PSB2b2lkIDApIHsKICAgICAgICB0YXJnZXQgPSBuZXcgVmVjMygpOwogICAgICB9CgogICAgICBjb25zdCBlID0gdGhpcy5lbGVtZW50czsKICAgICAgY29uc3QgeCA9IHYueDsKICAgICAgY29uc3QgeSA9IHYueTsKICAgICAgY29uc3QgeiA9IHYuejsKICAgICAgdGFyZ2V0LnggPSBlWzBdICogeCArIGVbMV0gKiB5ICsgZVsyXSAqIHo7CiAgICAgIHRhcmdldC55ID0gZVszXSAqIHggKyBlWzRdICogeSArIGVbNV0gKiB6OwogICAgICB0YXJnZXQueiA9IGVbNl0gKiB4ICsgZVs3XSAqIHkgKyBlWzhdICogejsKICAgICAgcmV0dXJuIHRhcmdldDsKICAgIH0KICAgIC8qKgogICAgICogTWF0cml4LXNjYWxhciBtdWx0aXBsaWNhdGlvbgogICAgICovCgoKICAgIHNtdWx0KHMpIHsKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0aGlzLmVsZW1lbnRzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgdGhpcy5lbGVtZW50c1tpXSAqPSBzOwogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIE1hdHJpeCBtdWx0aXBsaWNhdGlvbgogICAgICogQHBhcmFtIG1hdHJpeCBNYXRyaXggdG8gbXVsdGlwbHkgd2l0aCBmcm9tIGxlZnQgc2lkZS4KICAgICAqLwoKCiAgICBtbXVsdChtYXRyaXgsIHRhcmdldCkgewogICAgICBpZiAodGFyZ2V0ID09PSB2b2lkIDApIHsKICAgICAgICB0YXJnZXQgPSBuZXcgTWF0MygpOwogICAgICB9CgogICAgICBjb25zdCBBID0gdGhpcy5lbGVtZW50czsKICAgICAgY29uc3QgQiA9IG1hdHJpeC5lbGVtZW50czsKICAgICAgY29uc3QgVCA9IHRhcmdldC5lbGVtZW50czsKICAgICAgY29uc3QgYTExID0gQVswXSwKICAgICAgICAgICAgYTEyID0gQVsxXSwKICAgICAgICAgICAgYTEzID0gQVsyXSwKICAgICAgICAgICAgYTIxID0gQVszXSwKICAgICAgICAgICAgYTIyID0gQVs0XSwKICAgICAgICAgICAgYTIzID0gQVs1XSwKICAgICAgICAgICAgYTMxID0gQVs2XSwKICAgICAgICAgICAgYTMyID0gQVs3XSwKICAgICAgICAgICAgYTMzID0gQVs4XTsKICAgICAgY29uc3QgYjExID0gQlswXSwKICAgICAgICAgICAgYjEyID0gQlsxXSwKICAgICAgICAgICAgYjEzID0gQlsyXSwKICAgICAgICAgICAgYjIxID0gQlszXSwKICAgICAgICAgICAgYjIyID0gQls0XSwKICAgICAgICAgICAgYjIzID0gQls1XSwKICAgICAgICAgICAgYjMxID0gQls2XSwKICAgICAgICAgICAgYjMyID0gQls3XSwKICAgICAgICAgICAgYjMzID0gQls4XTsKICAgICAgVFswXSA9IGExMSAqIGIxMSArIGExMiAqIGIyMSArIGExMyAqIGIzMTsKICAgICAgVFsxXSA9IGExMSAqIGIxMiArIGExMiAqIGIyMiArIGExMyAqIGIzMjsKICAgICAgVFsyXSA9IGExMSAqIGIxMyArIGExMiAqIGIyMyArIGExMyAqIGIzMzsKICAgICAgVFszXSA9IGEyMSAqIGIxMSArIGEyMiAqIGIyMSArIGEyMyAqIGIzMTsKICAgICAgVFs0XSA9IGEyMSAqIGIxMiArIGEyMiAqIGIyMiArIGEyMyAqIGIzMjsKICAgICAgVFs1XSA9IGEyMSAqIGIxMyArIGEyMiAqIGIyMyArIGEyMyAqIGIzMzsKICAgICAgVFs2XSA9IGEzMSAqIGIxMSArIGEzMiAqIGIyMSArIGEzMyAqIGIzMTsKICAgICAgVFs3XSA9IGEzMSAqIGIxMiArIGEzMiAqIGIyMiArIGEzMyAqIGIzMjsKICAgICAgVFs4XSA9IGEzMSAqIGIxMyArIGEzMiAqIGIyMyArIGEzMyAqIGIzMzsKICAgICAgcmV0dXJuIHRhcmdldDsKICAgIH0KICAgIC8qKgogICAgICogU2NhbGUgZWFjaCBjb2x1bW4gb2YgdGhlIG1hdHJpeAogICAgICovCgoKICAgIHNjYWxlKHZlY3RvciwgdGFyZ2V0KSB7CiAgICAgIGlmICh0YXJnZXQgPT09IHZvaWQgMCkgewogICAgICAgIHRhcmdldCA9IG5ldyBNYXQzKCk7CiAgICAgIH0KCiAgICAgIGNvbnN0IGUgPSB0aGlzLmVsZW1lbnRzOwogICAgICBjb25zdCB0ID0gdGFyZ2V0LmVsZW1lbnRzOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgIT09IDM7IGkrKykgewogICAgICAgIHRbMyAqIGkgKyAwXSA9IHZlY3Rvci54ICogZVszICogaSArIDBdOwogICAgICAgIHRbMyAqIGkgKyAxXSA9IHZlY3Rvci55ICogZVszICogaSArIDFdOwogICAgICAgIHRbMyAqIGkgKyAyXSA9IHZlY3Rvci56ICogZVszICogaSArIDJdOwogICAgICB9CgogICAgICByZXR1cm4gdGFyZ2V0OwogICAgfQogICAgLyoqCiAgICAgKiBTb2x2ZSBBeD1iCiAgICAgKiBAcGFyYW0gYiBUaGUgcmlnaHQgaGFuZCBzaWRlCiAgICAgKiBAcGFyYW0gdGFyZ2V0IE9wdGlvbmFsLiBUYXJnZXQgdmVjdG9yIHRvIHNhdmUgaW4uCiAgICAgKiBAcmV0dXJuIFRoZSBzb2x1dGlvbiB4CiAgICAgKiBAdG9kbyBzaG91bGQgcmV1c2UgYXJyYXlzCiAgICAgKi8KCgogICAgc29sdmUoYiwgdGFyZ2V0KSB7CiAgICAgIGlmICh0YXJnZXQgPT09IHZvaWQgMCkgewogICAgICAgIHRhcmdldCA9IG5ldyBWZWMzKCk7CiAgICAgIH0KCiAgICAgIC8vIENvbnN0cnVjdCBlcXVhdGlvbnMKICAgICAgY29uc3QgbnIgPSAzOyAvLyBudW0gcm93cwoKICAgICAgY29uc3QgbmMgPSA0OyAvLyBudW0gY29scwoKICAgICAgY29uc3QgZXFucyA9IFtdOwogICAgICBsZXQgaTsKICAgICAgbGV0IGo7CgogICAgICBmb3IgKGkgPSAwOyBpIDwgbnIgKiBuYzsgaSsrKSB7CiAgICAgICAgZXFucy5wdXNoKDApOwogICAgICB9CgogICAgICBmb3IgKGkgPSAwOyBpIDwgMzsgaSsrKSB7CiAgICAgICAgZm9yIChqID0gMDsgaiA8IDM7IGorKykgewogICAgICAgICAgZXFuc1tpICsgbmMgKiBqXSA9IHRoaXMuZWxlbWVudHNbaSArIDMgKiBqXTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIGVxbnNbMyArIDQgKiAwXSA9IGIueDsKICAgICAgZXFuc1szICsgNCAqIDFdID0gYi55OwogICAgICBlcW5zWzMgKyA0ICogMl0gPSBiLno7IC8vIENvbXB1dGUgcmlnaHQgdXBwZXIgdHJpYW5ndWxhciB2ZXJzaW9uIG9mIHRoZSBtYXRyaXggLSBHYXVzcyBlbGltaW5hdGlvbgoKICAgICAgbGV0IG4gPSAzOwogICAgICBjb25zdCBrID0gbjsKICAgICAgbGV0IG5wOwogICAgICBjb25zdCBrcCA9IDQ7IC8vIG51bSByb3dzCgogICAgICBsZXQgcDsKCiAgICAgIGRvIHsKICAgICAgICBpID0gayAtIG47CgogICAgICAgIGlmIChlcW5zW2kgKyBuYyAqIGldID09PSAwKSB7CiAgICAgICAgICAvLyB0aGUgcGl2b3QgaXMgbnVsbCwgc3dhcCBsaW5lcwogICAgICAgICAgZm9yIChqID0gaSArIDE7IGogPCBrOyBqKyspIHsKICAgICAgICAgICAgaWYgKGVxbnNbaSArIG5jICogal0gIT09IDApIHsKICAgICAgICAgICAgICBucCA9IGtwOwoKICAgICAgICAgICAgICBkbyB7CiAgICAgICAgICAgICAgICAvLyBkbyBsaWduZSggaSApID0gbGlnbmUoIGkgKSArIGxpZ25lKCBrICkKICAgICAgICAgICAgICAgIHAgPSBrcCAtIG5wOwogICAgICAgICAgICAgICAgZXFuc1twICsgbmMgKiBpXSArPSBlcW5zW3AgKyBuYyAqIGpdOwogICAgICAgICAgICAgIH0gd2hpbGUgKC0tbnApOwoKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgaWYgKGVxbnNbaSArIG5jICogaV0gIT09IDApIHsKICAgICAgICAgIGZvciAoaiA9IGkgKyAxOyBqIDwgazsgaisrKSB7CiAgICAgICAgICAgIGNvbnN0IG11bHRpcGxpZXIgPSBlcW5zW2kgKyBuYyAqIGpdIC8gZXFuc1tpICsgbmMgKiBpXTsKICAgICAgICAgICAgbnAgPSBrcDsKCiAgICAgICAgICAgIGRvIHsKICAgICAgICAgICAgICAvLyBkbyBsaWduZSggayApID0gbGlnbmUoIGsgKSAtIG11bHRpcGxpZXIgKiBsaWduZSggaSApCiAgICAgICAgICAgICAgcCA9IGtwIC0gbnA7CiAgICAgICAgICAgICAgZXFuc1twICsgbmMgKiBqXSA9IHAgPD0gaSA/IDAgOiBlcW5zW3AgKyBuYyAqIGpdIC0gZXFuc1twICsgbmMgKiBpXSAqIG11bHRpcGxpZXI7CiAgICAgICAgICAgIH0gd2hpbGUgKC0tbnApOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSB3aGlsZSAoLS1uKTsgLy8gR2V0IHRoZSBzb2x1dGlvbgoKCiAgICAgIHRhcmdldC56ID0gZXFuc1syICogbmMgKyAzXSAvIGVxbnNbMiAqIG5jICsgMl07CiAgICAgIHRhcmdldC55ID0gKGVxbnNbMSAqIG5jICsgM10gLSBlcW5zWzEgKiBuYyArIDJdICogdGFyZ2V0LnopIC8gZXFuc1sxICogbmMgKyAxXTsKICAgICAgdGFyZ2V0LnggPSAoZXFuc1swICogbmMgKyAzXSAtIGVxbnNbMCAqIG5jICsgMl0gKiB0YXJnZXQueiAtIGVxbnNbMCAqIG5jICsgMV0gKiB0YXJnZXQueSkgLyBlcW5zWzAgKiBuYyArIDBdOwoKICAgICAgaWYgKGlzTmFOKHRhcmdldC54KSB8fCBpc05hTih0YXJnZXQueSkgfHwgaXNOYU4odGFyZ2V0LnopIHx8IHRhcmdldC54ID09PSBJbmZpbml0eSB8fCB0YXJnZXQueSA9PT0gSW5maW5pdHkgfHwgdGFyZ2V0LnogPT09IEluZmluaXR5KSB7CiAgICAgICAgdGhyb3cgYENvdWxkIG5vdCBzb2x2ZSBlcXVhdGlvbiEgR290IHg9WyR7dGFyZ2V0LnRvU3RyaW5nKCl9XSwgYj1bJHtiLnRvU3RyaW5nKCl9XSwgQT1bJHt0aGlzLnRvU3RyaW5nKCl9XWA7CiAgICAgIH0KCiAgICAgIHJldHVybiB0YXJnZXQ7CiAgICB9CiAgICAvKioKICAgICAqIEdldCBhbiBlbGVtZW50IGluIHRoZSBtYXRyaXggYnkgaW5kZXguIEluZGV4IHN0YXJ0cyBhdCAwLCBub3QgMSEhIQogICAgICogQHBhcmFtIHZhbHVlIElmIHByb3ZpZGVkLCB0aGUgbWF0cml4IGVsZW1lbnQgd2lsbCBiZSBzZXQgdG8gdGhpcyB2YWx1ZS4KICAgICAqLwoKCiAgICBlKHJvdywgY29sdW1uLCB2YWx1ZSkgewogICAgICBpZiAodmFsdWUgPT09IHVuZGVmaW5lZCkgewogICAgICAgIHJldHVybiB0aGlzLmVsZW1lbnRzW2NvbHVtbiArIDMgKiByb3ddOwogICAgICB9IGVsc2UgewogICAgICAgIC8vIFNldCB2YWx1ZQogICAgICAgIHRoaXMuZWxlbWVudHNbY29sdW1uICsgMyAqIHJvd10gPSB2YWx1ZTsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBDb3B5IGFub3RoZXIgbWF0cml4IGludG8gdGhpcyBtYXRyaXggb2JqZWN0LgogICAgICovCgoKICAgIGNvcHkobWF0cml4KSB7CiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbWF0cml4LmVsZW1lbnRzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgdGhpcy5lbGVtZW50c1tpXSA9IG1hdHJpeC5lbGVtZW50c1tpXTsKICAgICAgfQoKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICAvKioKICAgICAqIFJldHVybnMgYSBzdHJpbmcgcmVwcmVzZW50YXRpb24gb2YgdGhlIG1hdHJpeC4KICAgICAqLwoKCiAgICB0b1N0cmluZygpIHsKICAgICAgbGV0IHIgPSAnJzsKICAgICAgY29uc3Qgc2VwID0gJywnOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCA5OyBpKyspIHsKICAgICAgICByICs9IHRoaXMuZWxlbWVudHNbaV0gKyBzZXA7CiAgICAgIH0KCiAgICAgIHJldHVybiByOwogICAgfQogICAgLyoqCiAgICAgKiByZXZlcnNlIHRoZSBtYXRyaXgKICAgICAqIEBwYXJhbSB0YXJnZXQgVGFyZ2V0IG1hdHJpeCB0byBzYXZlIGluLgogICAgICogQHJldHVybiBUaGUgc29sdXRpb24geAogICAgICovCgoKICAgIHJldmVyc2UodGFyZ2V0KSB7CiAgICAgIGlmICh0YXJnZXQgPT09IHZvaWQgMCkgewogICAgICAgIHRhcmdldCA9IG5ldyBNYXQzKCk7CiAgICAgIH0KCiAgICAgIC8vIENvbnN0cnVjdCBlcXVhdGlvbnMKICAgICAgY29uc3QgbnIgPSAzOyAvLyBudW0gcm93cwoKICAgICAgY29uc3QgbmMgPSA2OyAvLyBudW0gY29scwoKICAgICAgY29uc3QgZXFucyA9IHJldmVyc2VfZXFuczsKICAgICAgbGV0IGk7CiAgICAgIGxldCBqOwoKICAgICAgZm9yIChpID0gMDsgaSA8IDM7IGkrKykgewogICAgICAgIGZvciAoaiA9IDA7IGogPCAzOyBqKyspIHsKICAgICAgICAgIGVxbnNbaSArIG5jICogal0gPSB0aGlzLmVsZW1lbnRzW2kgKyAzICogal07CiAgICAgICAgfQogICAgICB9CgogICAgICBlcW5zWzMgKyA2ICogMF0gPSAxOwogICAgICBlcW5zWzMgKyA2ICogMV0gPSAwOwogICAgICBlcW5zWzMgKyA2ICogMl0gPSAwOwogICAgICBlcW5zWzQgKyA2ICogMF0gPSAwOwogICAgICBlcW5zWzQgKyA2ICogMV0gPSAxOwogICAgICBlcW5zWzQgKyA2ICogMl0gPSAwOwogICAgICBlcW5zWzUgKyA2ICogMF0gPSAwOwogICAgICBlcW5zWzUgKyA2ICogMV0gPSAwOwogICAgICBlcW5zWzUgKyA2ICogMl0gPSAxOyAvLyBDb21wdXRlIHJpZ2h0IHVwcGVyIHRyaWFuZ3VsYXIgdmVyc2lvbiBvZiB0aGUgbWF0cml4IC0gR2F1c3MgZWxpbWluYXRpb24KCiAgICAgIGxldCBuID0gMzsKICAgICAgY29uc3QgayA9IG47CiAgICAgIGxldCBucDsKICAgICAgY29uc3Qga3AgPSBuYzsgLy8gbnVtIHJvd3MKCiAgICAgIGxldCBwOwoKICAgICAgZG8gewogICAgICAgIGkgPSBrIC0gbjsKCiAgICAgICAgaWYgKGVxbnNbaSArIG5jICogaV0gPT09IDApIHsKICAgICAgICAgIC8vIHRoZSBwaXZvdCBpcyBudWxsLCBzd2FwIGxpbmVzCiAgICAgICAgICBmb3IgKGogPSBpICsgMTsgaiA8IGs7IGorKykgewogICAgICAgICAgICBpZiAoZXFuc1tpICsgbmMgKiBqXSAhPT0gMCkgewogICAgICAgICAgICAgIG5wID0ga3A7CgogICAgICAgICAgICAgIGRvIHsKICAgICAgICAgICAgICAgIC8vIGRvIGxpbmUoIGkgKSA9IGxpbmUoIGkgKSArIGxpbmUoIGsgKQogICAgICAgICAgICAgICAgcCA9IGtwIC0gbnA7CiAgICAgICAgICAgICAgICBlcW5zW3AgKyBuYyAqIGldICs9IGVxbnNbcCArIG5jICogal07CiAgICAgICAgICAgICAgfSB3aGlsZSAoLS1ucCk7CgogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBpZiAoZXFuc1tpICsgbmMgKiBpXSAhPT0gMCkgewogICAgICAgICAgZm9yIChqID0gaSArIDE7IGogPCBrOyBqKyspIHsKICAgICAgICAgICAgY29uc3QgbXVsdGlwbGllciA9IGVxbnNbaSArIG5jICogal0gLyBlcW5zW2kgKyBuYyAqIGldOwogICAgICAgICAgICBucCA9IGtwOwoKICAgICAgICAgICAgZG8gewogICAgICAgICAgICAgIC8vIGRvIGxpbmUoIGsgKSA9IGxpbmUoIGsgKSAtIG11bHRpcGxpZXIgKiBsaW5lKCBpICkKICAgICAgICAgICAgICBwID0ga3AgLSBucDsKICAgICAgICAgICAgICBlcW5zW3AgKyBuYyAqIGpdID0gcCA8PSBpID8gMCA6IGVxbnNbcCArIG5jICogal0gLSBlcW5zW3AgKyBuYyAqIGldICogbXVsdGlwbGllcjsKICAgICAgICAgICAgfSB3aGlsZSAoLS1ucCk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9IHdoaWxlICgtLW4pOyAvLyBlbGltaW5hdGUgdGhlIHVwcGVyIGxlZnQgdHJpYW5nbGUgb2YgdGhlIG1hdHJpeAoKCiAgICAgIGkgPSAyOwoKICAgICAgZG8gewogICAgICAgIGogPSBpIC0gMTsKCiAgICAgICAgZG8gewogICAgICAgICAgY29uc3QgbXVsdGlwbGllciA9IGVxbnNbaSArIG5jICogal0gLyBlcW5zW2kgKyBuYyAqIGldOwogICAgICAgICAgbnAgPSBuYzsKCiAgICAgICAgICBkbyB7CiAgICAgICAgICAgIHAgPSBuYyAtIG5wOwogICAgICAgICAgICBlcW5zW3AgKyBuYyAqIGpdID0gZXFuc1twICsgbmMgKiBqXSAtIGVxbnNbcCArIG5jICogaV0gKiBtdWx0aXBsaWVyOwogICAgICAgICAgfSB3aGlsZSAoLS1ucCk7CiAgICAgICAgfSB3aGlsZSAoai0tKTsKICAgICAgfSB3aGlsZSAoLS1pKTsgLy8gb3BlcmF0aW9ucyBvbiB0aGUgZGlhZ29uYWwKCgogICAgICBpID0gMjsKCiAgICAgIGRvIHsKICAgICAgICBjb25zdCBtdWx0aXBsaWVyID0gMSAvIGVxbnNbaSArIG5jICogaV07CiAgICAgICAgbnAgPSBuYzsKCiAgICAgICAgZG8gewogICAgICAgICAgcCA9IG5jIC0gbnA7CiAgICAgICAgICBlcW5zW3AgKyBuYyAqIGldID0gZXFuc1twICsgbmMgKiBpXSAqIG11bHRpcGxpZXI7CiAgICAgICAgfSB3aGlsZSAoLS1ucCk7CiAgICAgIH0gd2hpbGUgKGktLSk7CgogICAgICBpID0gMjsKCiAgICAgIGRvIHsKICAgICAgICBqID0gMjsKCiAgICAgICAgZG8gewogICAgICAgICAgcCA9IGVxbnNbbnIgKyBqICsgbmMgKiBpXTsKCiAgICAgICAgICBpZiAoaXNOYU4ocCkgfHwgcCA9PT0gSW5maW5pdHkpIHsKICAgICAgICAgICAgdGhyb3cgYENvdWxkIG5vdCByZXZlcnNlISBBPVske3RoaXMudG9TdHJpbmcoKX1dYDsKICAgICAgICAgIH0KCiAgICAgICAgICB0YXJnZXQuZShpLCBqLCBwKTsKICAgICAgICB9IHdoaWxlIChqLS0pOwogICAgICB9IHdoaWxlIChpLS0pOwoKICAgICAgcmV0dXJuIHRhcmdldDsKICAgIH0KICAgIC8qKgogICAgICogU2V0IHRoZSBtYXRyaXggZnJvbSBhIHF1YXRlcmlvbgogICAgICovCgoKICAgIHNldFJvdGF0aW9uRnJvbVF1YXRlcm5pb24ocSkgewogICAgICBjb25zdCB4ID0gcS54OwogICAgICBjb25zdCB5ID0gcS55OwogICAgICBjb25zdCB6ID0gcS56OwogICAgICBjb25zdCB3ID0gcS53OwogICAgICBjb25zdCB4MiA9IHggKyB4OwogICAgICBjb25zdCB5MiA9IHkgKyB5OwogICAgICBjb25zdCB6MiA9IHogKyB6OwogICAgICBjb25zdCB4eCA9IHggKiB4MjsKICAgICAgY29uc3QgeHkgPSB4ICogeTI7CiAgICAgIGNvbnN0IHh6ID0geCAqIHoyOwogICAgICBjb25zdCB5eSA9IHkgKiB5MjsKICAgICAgY29uc3QgeXogPSB5ICogejI7CiAgICAgIGNvbnN0IHp6ID0geiAqIHoyOwogICAgICBjb25zdCB3eCA9IHcgKiB4MjsKICAgICAgY29uc3Qgd3kgPSB3ICogeTI7CiAgICAgIGNvbnN0IHd6ID0gdyAqIHoyOwogICAgICBjb25zdCBlID0gdGhpcy5lbGVtZW50czsKICAgICAgZVszICogMCArIDBdID0gMSAtICh5eSArIHp6KTsKICAgICAgZVszICogMCArIDFdID0geHkgLSB3ejsKICAgICAgZVszICogMCArIDJdID0geHogKyB3eTsKICAgICAgZVszICogMSArIDBdID0geHkgKyB3ejsKICAgICAgZVszICogMSArIDFdID0gMSAtICh4eCArIHp6KTsKICAgICAgZVszICogMSArIDJdID0geXogLSB3eDsKICAgICAgZVszICogMiArIDBdID0geHogLSB3eTsKICAgICAgZVszICogMiArIDFdID0geXogKyB3eDsKICAgICAgZVszICogMiArIDJdID0gMSAtICh4eCArIHl5KTsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICAvKioKICAgICAqIFRyYW5zcG9zZSB0aGUgbWF0cml4CiAgICAgKiBAcGFyYW0gdGFyZ2V0IE9wdGlvbmFsLiBXaGVyZSB0byBzdG9yZSB0aGUgcmVzdWx0LgogICAgICogQHJldHVybiBUaGUgdGFyZ2V0IE1hdDMsIG9yIGEgbmV3IE1hdDMgaWYgdGFyZ2V0IHdhcyBvbWl0dGVkLgogICAgICovCgoKICAgIHRyYW5zcG9zZSh0YXJnZXQpIHsKICAgICAgaWYgKHRhcmdldCA9PT0gdm9pZCAwKSB7CiAgICAgICAgdGFyZ2V0ID0gbmV3IE1hdDMoKTsKICAgICAgfQoKICAgICAgY29uc3QgTSA9IHRoaXMuZWxlbWVudHM7CiAgICAgIGNvbnN0IFQgPSB0YXJnZXQuZWxlbWVudHM7CiAgICAgIGxldCB0bXA7IC8vU2V0IGRpYWdvbmFscwoKICAgICAgVFswXSA9IE1bMF07CiAgICAgIFRbNF0gPSBNWzRdOwogICAgICBUWzhdID0gTVs4XTsKICAgICAgdG1wID0gTVsxXTsKICAgICAgVFsxXSA9IE1bM107CiAgICAgIFRbM10gPSB0bXA7CiAgICAgIHRtcCA9IE1bMl07CiAgICAgIFRbMl0gPSBNWzZdOwogICAgICBUWzZdID0gdG1wOwogICAgICB0bXAgPSBNWzVdOwogICAgICBUWzVdID0gTVs3XTsKICAgICAgVFs3XSA9IHRtcDsKICAgICAgcmV0dXJuIHRhcmdldDsKICAgIH0KCiAgfQogIGNvbnN0IHJldmVyc2VfZXFucyA9IFswLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwXTsKCiAgLyoqCiAgICogMy1kaW1lbnNpb25hbCB2ZWN0b3IKICAgKiBAZXhhbXBsZQogICAqICAgICBjb25zdCB2ID0gbmV3IFZlYzMoMSwgMiwgMykKICAgKiAgICAgY29uc29sZS5sb2coJ3g9JyArIHYueCkgLy8geD0xCiAgICovCgogIGNsYXNzIFZlYzMgewogICAgY29uc3RydWN0b3IoeCwgeSwgeikgewogICAgICBpZiAoeCA9PT0gdm9pZCAwKSB7CiAgICAgICAgeCA9IDAuMDsKICAgICAgfQoKICAgICAgaWYgKHkgPT09IHZvaWQgMCkgewogICAgICAgIHkgPSAwLjA7CiAgICAgIH0KCiAgICAgIGlmICh6ID09PSB2b2lkIDApIHsKICAgICAgICB6ID0gMC4wOwogICAgICB9CgogICAgICB0aGlzLnggPSB4OwogICAgICB0aGlzLnkgPSB5OwogICAgICB0aGlzLnogPSB6OwogICAgfQogICAgLyoqCiAgICAgKiBWZWN0b3IgY3Jvc3MgcHJvZHVjdAogICAgICogQHBhcmFtIHRhcmdldCBPcHRpb25hbCB0YXJnZXQgdG8gc2F2ZSBpbi4KICAgICAqLwoKCiAgICBjcm9zcyh2ZWN0b3IsIHRhcmdldCkgewogICAgICBpZiAodGFyZ2V0ID09PSB2b2lkIDApIHsKICAgICAgICB0YXJnZXQgPSBuZXcgVmVjMygpOwogICAgICB9CgogICAgICBjb25zdCB2eCA9IHZlY3Rvci54OwogICAgICBjb25zdCB2eSA9IHZlY3Rvci55OwogICAgICBjb25zdCB2eiA9IHZlY3Rvci56OwogICAgICBjb25zdCB4ID0gdGhpcy54OwogICAgICBjb25zdCB5ID0gdGhpcy55OwogICAgICBjb25zdCB6ID0gdGhpcy56OwogICAgICB0YXJnZXQueCA9IHkgKiB2eiAtIHogKiB2eTsKICAgICAgdGFyZ2V0LnkgPSB6ICogdnggLSB4ICogdno7CiAgICAgIHRhcmdldC56ID0geCAqIHZ5IC0geSAqIHZ4OwogICAgICByZXR1cm4gdGFyZ2V0OwogICAgfQogICAgLyoqCiAgICAgKiBTZXQgdGhlIHZlY3RvcnMnIDMgZWxlbWVudHMKICAgICAqLwoKCiAgICBzZXQoeCwgeSwgeikgewogICAgICB0aGlzLnggPSB4OwogICAgICB0aGlzLnkgPSB5OwogICAgICB0aGlzLnogPSB6OwogICAgICByZXR1cm4gdGhpczsKICAgIH0KICAgIC8qKgogICAgICogU2V0IGFsbCBjb21wb25lbnRzIG9mIHRoZSB2ZWN0b3IgdG8gemVyby4KICAgICAqLwoKCiAgICBzZXRaZXJvKCkgewogICAgICB0aGlzLnggPSB0aGlzLnkgPSB0aGlzLnogPSAwOwogICAgfQogICAgLyoqCiAgICAgKiBWZWN0b3IgYWRkaXRpb24KICAgICAqLwoKCiAgICB2YWRkKHZlY3RvciwgdGFyZ2V0KSB7CiAgICAgIGlmICh0YXJnZXQpIHsKICAgICAgICB0YXJnZXQueCA9IHZlY3Rvci54ICsgdGhpcy54OwogICAgICAgIHRhcmdldC55ID0gdmVjdG9yLnkgKyB0aGlzLnk7CiAgICAgICAgdGFyZ2V0LnogPSB2ZWN0b3IueiArIHRoaXMuejsKICAgICAgfSBlbHNlIHsKICAgICAgICByZXR1cm4gbmV3IFZlYzModGhpcy54ICsgdmVjdG9yLngsIHRoaXMueSArIHZlY3Rvci55LCB0aGlzLnogKyB2ZWN0b3Iueik7CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogVmVjdG9yIHN1YnRyYWN0aW9uCiAgICAgKiBAcGFyYW0gdGFyZ2V0IE9wdGlvbmFsIHRhcmdldCB0byBzYXZlIGluLgogICAgICovCgoKICAgIHZzdWIodmVjdG9yLCB0YXJnZXQpIHsKICAgICAgaWYgKHRhcmdldCkgewogICAgICAgIHRhcmdldC54ID0gdGhpcy54IC0gdmVjdG9yLng7CiAgICAgICAgdGFyZ2V0LnkgPSB0aGlzLnkgLSB2ZWN0b3IueTsKICAgICAgICB0YXJnZXQueiA9IHRoaXMueiAtIHZlY3Rvci56OwogICAgICB9IGVsc2UgewogICAgICAgIHJldHVybiBuZXcgVmVjMyh0aGlzLnggLSB2ZWN0b3IueCwgdGhpcy55IC0gdmVjdG9yLnksIHRoaXMueiAtIHZlY3Rvci56KTsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBHZXQgdGhlIGNyb3NzIHByb2R1Y3QgbWF0cml4IGFfY3Jvc3MgZnJvbSBhIHZlY3Rvciwgc3VjaCB0aGF0IGEgeCBiID0gYV9jcm9zcyAqIGIgPSBjCiAgICAgKgogICAgICogU2VlIHtAbGluayBodHRwczovL3d3dzguY3MudW11LnNlL2t1cnNlci9UREJEMjQvVlQwNi9sZWN0dXJlcy9MZWN0dXJlNi5wZGYgVW1lw6UgVW5pdmVyc2l0eSBMZWN0dXJlfQogICAgICovCgoKICAgIGNyb3NzbWF0KCkgewogICAgICByZXR1cm4gbmV3IE1hdDMoWzAsIC10aGlzLnosIHRoaXMueSwgdGhpcy56LCAwLCAtdGhpcy54LCAtdGhpcy55LCB0aGlzLngsIDBdKTsKICAgIH0KICAgIC8qKgogICAgICogTm9ybWFsaXplIHRoZSB2ZWN0b3IuIE5vdGUgdGhhdCB0aGlzIGNoYW5nZXMgdGhlIHZhbHVlcyBpbiB0aGUgdmVjdG9yLgogICAgICAqIEByZXR1cm4gUmV0dXJucyB0aGUgbm9ybSBvZiB0aGUgdmVjdG9yCiAgICAgKi8KCgogICAgbm9ybWFsaXplKCkgewogICAgICBjb25zdCB4ID0gdGhpcy54OwogICAgICBjb25zdCB5ID0gdGhpcy55OwogICAgICBjb25zdCB6ID0gdGhpcy56OwogICAgICBjb25zdCBuID0gTWF0aC5zcXJ0KHggKiB4ICsgeSAqIHkgKyB6ICogeik7CgogICAgICBpZiAobiA+IDAuMCkgewogICAgICAgIGNvbnN0IGludk4gPSAxIC8gbjsKICAgICAgICB0aGlzLnggKj0gaW52TjsKICAgICAgICB0aGlzLnkgKj0gaW52TjsKICAgICAgICB0aGlzLnogKj0gaW52TjsKICAgICAgfSBlbHNlIHsKICAgICAgICAvLyBNYWtlIHNvbWV0aGluZyB1cAogICAgICAgIHRoaXMueCA9IDA7CiAgICAgICAgdGhpcy55ID0gMDsKICAgICAgICB0aGlzLnogPSAwOwogICAgICB9CgogICAgICByZXR1cm4gbjsKICAgIH0KICAgIC8qKgogICAgICogR2V0IHRoZSB2ZXJzaW9uIG9mIHRoaXMgdmVjdG9yIHRoYXQgaXMgb2YgbGVuZ3RoIDEuCiAgICAgKiBAcGFyYW0gdGFyZ2V0IE9wdGlvbmFsIHRhcmdldCB0byBzYXZlIGluCiAgICAgKiBAcmV0dXJuIFJldHVybnMgdGhlIHVuaXQgdmVjdG9yCiAgICAgKi8KCgogICAgdW5pdCh0YXJnZXQpIHsKICAgICAgaWYgKHRhcmdldCA9PT0gdm9pZCAwKSB7CiAgICAgICAgdGFyZ2V0ID0gbmV3IFZlYzMoKTsKICAgICAgfQoKICAgICAgY29uc3QgeCA9IHRoaXMueDsKICAgICAgY29uc3QgeSA9IHRoaXMueTsKICAgICAgY29uc3QgeiA9IHRoaXMuejsKICAgICAgbGV0IG5pbnYgPSBNYXRoLnNxcnQoeCAqIHggKyB5ICogeSArIHogKiB6KTsKCiAgICAgIGlmIChuaW52ID4gMC4wKSB7CiAgICAgICAgbmludiA9IDEuMCAvIG5pbnY7CiAgICAgICAgdGFyZ2V0LnggPSB4ICogbmludjsKICAgICAgICB0YXJnZXQueSA9IHkgKiBuaW52OwogICAgICAgIHRhcmdldC56ID0geiAqIG5pbnY7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGFyZ2V0LnggPSAxOwogICAgICAgIHRhcmdldC55ID0gMDsKICAgICAgICB0YXJnZXQueiA9IDA7CiAgICAgIH0KCiAgICAgIHJldHVybiB0YXJnZXQ7CiAgICB9CiAgICAvKioKICAgICAqIEdldCB0aGUgbGVuZ3RoIG9mIHRoZSB2ZWN0b3IKICAgICAqLwoKCiAgICBsZW5ndGgoKSB7CiAgICAgIGNvbnN0IHggPSB0aGlzLng7CiAgICAgIGNvbnN0IHkgPSB0aGlzLnk7CiAgICAgIGNvbnN0IHogPSB0aGlzLno7CiAgICAgIHJldHVybiBNYXRoLnNxcnQoeCAqIHggKyB5ICogeSArIHogKiB6KTsKICAgIH0KICAgIC8qKgogICAgICogR2V0IHRoZSBzcXVhcmVkIGxlbmd0aCBvZiB0aGUgdmVjdG9yLgogICAgICovCgoKICAgIGxlbmd0aFNxdWFyZWQoKSB7CiAgICAgIHJldHVybiB0aGlzLmRvdCh0aGlzKTsKICAgIH0KICAgIC8qKgogICAgICogR2V0IGRpc3RhbmNlIGZyb20gdGhpcyBwb2ludCB0byBhbm90aGVyIHBvaW50CiAgICAgKi8KCgogICAgZGlzdGFuY2VUbyhwKSB7CiAgICAgIGNvbnN0IHggPSB0aGlzLng7CiAgICAgIGNvbnN0IHkgPSB0aGlzLnk7CiAgICAgIGNvbnN0IHogPSB0aGlzLno7CiAgICAgIGNvbnN0IHB4ID0gcC54OwogICAgICBjb25zdCBweSA9IHAueTsKICAgICAgY29uc3QgcHogPSBwLno7CiAgICAgIHJldHVybiBNYXRoLnNxcnQoKHB4IC0geCkgKiAocHggLSB4KSArIChweSAtIHkpICogKHB5IC0geSkgKyAocHogLSB6KSAqIChweiAtIHopKTsKICAgIH0KICAgIC8qKgogICAgICogR2V0IHNxdWFyZWQgZGlzdGFuY2UgZnJvbSB0aGlzIHBvaW50IHRvIGFub3RoZXIgcG9pbnQKICAgICAqLwoKCiAgICBkaXN0YW5jZVNxdWFyZWQocCkgewogICAgICBjb25zdCB4ID0gdGhpcy54OwogICAgICBjb25zdCB5ID0gdGhpcy55OwogICAgICBjb25zdCB6ID0gdGhpcy56OwogICAgICBjb25zdCBweCA9IHAueDsKICAgICAgY29uc3QgcHkgPSBwLnk7CiAgICAgIGNvbnN0IHB6ID0gcC56OwogICAgICByZXR1cm4gKHB4IC0geCkgKiAocHggLSB4KSArIChweSAtIHkpICogKHB5IC0geSkgKyAocHogLSB6KSAqIChweiAtIHopOwogICAgfQogICAgLyoqCiAgICAgKiBNdWx0aXBseSBhbGwgdGhlIGNvbXBvbmVudHMgb2YgdGhlIHZlY3RvciB3aXRoIGEgc2NhbGFyLgogICAgICogQHBhcmFtIHRhcmdldCBUaGUgdmVjdG9yIHRvIHNhdmUgdGhlIHJlc3VsdCBpbi4KICAgICAqLwoKCiAgICBzY2FsZShzY2FsYXIsIHRhcmdldCkgewogICAgICBpZiAodGFyZ2V0ID09PSB2b2lkIDApIHsKICAgICAgICB0YXJnZXQgPSBuZXcgVmVjMygpOwogICAgICB9CgogICAgICBjb25zdCB4ID0gdGhpcy54OwogICAgICBjb25zdCB5ID0gdGhpcy55OwogICAgICBjb25zdCB6ID0gdGhpcy56OwogICAgICB0YXJnZXQueCA9IHNjYWxhciAqIHg7CiAgICAgIHRhcmdldC55ID0gc2NhbGFyICogeTsKICAgICAgdGFyZ2V0LnogPSBzY2FsYXIgKiB6OwogICAgICByZXR1cm4gdGFyZ2V0OwogICAgfQogICAgLyoqCiAgICAgKiBNdWx0aXBseSB0aGUgdmVjdG9yIHdpdGggYW4gb3RoZXIgdmVjdG9yLCBjb21wb25lbnQtd2lzZS4KICAgICAqIEBwYXJhbSB0YXJnZXQgVGhlIHZlY3RvciB0byBzYXZlIHRoZSByZXN1bHQgaW4uCiAgICAgKi8KCgogICAgdm11bCh2ZWN0b3IsIHRhcmdldCkgewogICAgICBpZiAodGFyZ2V0ID09PSB2b2lkIDApIHsKICAgICAgICB0YXJnZXQgPSBuZXcgVmVjMygpOwogICAgICB9CgogICAgICB0YXJnZXQueCA9IHZlY3Rvci54ICogdGhpcy54OwogICAgICB0YXJnZXQueSA9IHZlY3Rvci55ICogdGhpcy55OwogICAgICB0YXJnZXQueiA9IHZlY3Rvci56ICogdGhpcy56OwogICAgICByZXR1cm4gdGFyZ2V0OwogICAgfQogICAgLyoqCiAgICAgKiBTY2FsZSBhIHZlY3RvciBhbmQgYWRkIGl0IHRvIHRoaXMgdmVjdG9yLiBTYXZlIHRoZSByZXN1bHQgaW4gInRhcmdldCIuICh0YXJnZXQgPSB0aGlzICsgdmVjdG9yICogc2NhbGFyKQogICAgICogQHBhcmFtIHRhcmdldCBUaGUgdmVjdG9yIHRvIHNhdmUgdGhlIHJlc3VsdCBpbi4KICAgICAqLwoKCiAgICBhZGRTY2FsZWRWZWN0b3Ioc2NhbGFyLCB2ZWN0b3IsIHRhcmdldCkgewogICAgICBpZiAodGFyZ2V0ID09PSB2b2lkIDApIHsKICAgICAgICB0YXJnZXQgPSBuZXcgVmVjMygpOwogICAgICB9CgogICAgICB0YXJnZXQueCA9IHRoaXMueCArIHNjYWxhciAqIHZlY3Rvci54OwogICAgICB0YXJnZXQueSA9IHRoaXMueSArIHNjYWxhciAqIHZlY3Rvci55OwogICAgICB0YXJnZXQueiA9IHRoaXMueiArIHNjYWxhciAqIHZlY3Rvci56OwogICAgICByZXR1cm4gdGFyZ2V0OwogICAgfQogICAgLyoqCiAgICAgKiBDYWxjdWxhdGUgZG90IHByb2R1Y3QKICAgICAqIEBwYXJhbSB2ZWN0b3IKICAgICAqLwoKCiAgICBkb3QodmVjdG9yKSB7CiAgICAgIHJldHVybiB0aGlzLnggKiB2ZWN0b3IueCArIHRoaXMueSAqIHZlY3Rvci55ICsgdGhpcy56ICogdmVjdG9yLno7CiAgICB9CgogICAgaXNaZXJvKCkgewogICAgICByZXR1cm4gdGhpcy54ID09PSAwICYmIHRoaXMueSA9PT0gMCAmJiB0aGlzLnogPT09IDA7CiAgICB9CiAgICAvKioKICAgICAqIE1ha2UgdGhlIHZlY3RvciBwb2ludCBpbiB0aGUgb3Bwb3NpdGUgZGlyZWN0aW9uLgogICAgICogQHBhcmFtIHRhcmdldCBPcHRpb25hbCB0YXJnZXQgdG8gc2F2ZSBpbgogICAgICovCgoKICAgIG5lZ2F0ZSh0YXJnZXQpIHsKICAgICAgaWYgKHRhcmdldCA9PT0gdm9pZCAwKSB7CiAgICAgICAgdGFyZ2V0ID0gbmV3IFZlYzMoKTsKICAgICAgfQoKICAgICAgdGFyZ2V0LnggPSAtdGhpcy54OwogICAgICB0YXJnZXQueSA9IC10aGlzLnk7CiAgICAgIHRhcmdldC56ID0gLXRoaXMuejsKICAgICAgcmV0dXJuIHRhcmdldDsKICAgIH0KICAgIC8qKgogICAgICogQ29tcHV0ZSB0d28gYXJ0aWZpY2lhbCB0YW5nZW50cyB0byB0aGUgdmVjdG9yCiAgICAgKiBAcGFyYW0gdDEgVmVjdG9yIG9iamVjdCB0byBzYXZlIHRoZSBmaXJzdCB0YW5nZW50IGluCiAgICAgKiBAcGFyYW0gdDIgVmVjdG9yIG9iamVjdCB0byBzYXZlIHRoZSBzZWNvbmQgdGFuZ2VudCBpbgogICAgICovCgoKICAgIHRhbmdlbnRzKHQxLCB0MikgewogICAgICBjb25zdCBub3JtID0gdGhpcy5sZW5ndGgoKTsKCiAgICAgIGlmIChub3JtID4gMC4wKSB7CiAgICAgICAgY29uc3QgbiA9IFZlYzNfdGFuZ2VudHNfbjsKICAgICAgICBjb25zdCBpbm9ybSA9IDEgLyBub3JtOwogICAgICAgIG4uc2V0KHRoaXMueCAqIGlub3JtLCB0aGlzLnkgKiBpbm9ybSwgdGhpcy56ICogaW5vcm0pOwogICAgICAgIGNvbnN0IHJhbmRWZWMgPSBWZWMzX3RhbmdlbnRzX3JhbmRWZWM7CgogICAgICAgIGlmIChNYXRoLmFicyhuLngpIDwgMC45KSB7CiAgICAgICAgICByYW5kVmVjLnNldCgxLCAwLCAwKTsKICAgICAgICAgIG4uY3Jvc3MocmFuZFZlYywgdDEpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICByYW5kVmVjLnNldCgwLCAxLCAwKTsKICAgICAgICAgIG4uY3Jvc3MocmFuZFZlYywgdDEpOwogICAgICAgIH0KCiAgICAgICAgbi5jcm9zcyh0MSwgdDIpOwogICAgICB9IGVsc2UgewogICAgICAgIC8vIFRoZSBub3JtYWwgbGVuZ3RoIGlzIHplcm8sIG1ha2Ugc29tZXRoaW5nIHVwCiAgICAgICAgdDEuc2V0KDEsIDAsIDApOwogICAgICAgIHQyLnNldCgwLCAxLCAwKTsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBDb252ZXJ0cyB0byBhIG1vcmUgcmVhZGFibGUgZm9ybWF0CiAgICAgKi8KCgogICAgdG9TdHJpbmcoKSB7CiAgICAgIHJldHVybiBgJHt0aGlzLnh9LCR7dGhpcy55fSwke3RoaXMuen1gOwogICAgfQogICAgLyoqCiAgICAgKiBDb252ZXJ0cyB0byBhbiBhcnJheQogICAgICovCgoKICAgIHRvQXJyYXkoKSB7CiAgICAgIHJldHVybiBbdGhpcy54LCB0aGlzLnksIHRoaXMuel07CiAgICB9CiAgICAvKioKICAgICAqIENvcGllcyB2YWx1ZSBvZiBzb3VyY2UgdG8gdGhpcyB2ZWN0b3IuCiAgICAgKi8KCgogICAgY29weSh2ZWN0b3IpIHsKICAgICAgdGhpcy54ID0gdmVjdG9yLng7CiAgICAgIHRoaXMueSA9IHZlY3Rvci55OwogICAgICB0aGlzLnogPSB2ZWN0b3IuejsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICAvKioKICAgICAqIERvIGEgbGluZWFyIGludGVycG9sYXRpb24gYmV0d2VlbiB0d28gdmVjdG9ycwogICAgICogQHBhcmFtIHQgQSBudW1iZXIgYmV0d2VlbiAwIGFuZCAxLiAwIHdpbGwgbWFrZSB0aGlzIGZ1bmN0aW9uIHJldHVybiB1LCBhbmQgMSB3aWxsIG1ha2UgaXQgcmV0dXJuIHYuIE51bWJlcnMgaW4gYmV0d2VlbiB3aWxsIGdlbmVyYXRlIGEgdmVjdG9yIGluIGJldHdlZW4gdGhlbS4KICAgICAqLwoKCiAgICBsZXJwKHZlY3RvciwgdCwgdGFyZ2V0KSB7CiAgICAgIGNvbnN0IHggPSB0aGlzLng7CiAgICAgIGNvbnN0IHkgPSB0aGlzLnk7CiAgICAgIGNvbnN0IHogPSB0aGlzLno7CiAgICAgIHRhcmdldC54ID0geCArICh2ZWN0b3IueCAtIHgpICogdDsKICAgICAgdGFyZ2V0LnkgPSB5ICsgKHZlY3Rvci55IC0geSkgKiB0OwogICAgICB0YXJnZXQueiA9IHogKyAodmVjdG9yLnogLSB6KSAqIHQ7CiAgICB9CiAgICAvKioKICAgICAqIENoZWNrIGlmIGEgdmVjdG9yIGVxdWFscyBpcyBhbG1vc3QgZXF1YWwgdG8gYW5vdGhlciBvbmUuCiAgICAgKi8KCgogICAgYWxtb3N0RXF1YWxzKHZlY3RvciwgcHJlY2lzaW9uKSB7CiAgICAgIGlmIChwcmVjaXNpb24gPT09IHZvaWQgMCkgewogICAgICAgIHByZWNpc2lvbiA9IDFlLTY7CiAgICAgIH0KCiAgICAgIGlmIChNYXRoLmFicyh0aGlzLnggLSB2ZWN0b3IueCkgPiBwcmVjaXNpb24gfHwgTWF0aC5hYnModGhpcy55IC0gdmVjdG9yLnkpID4gcHJlY2lzaW9uIHx8IE1hdGguYWJzKHRoaXMueiAtIHZlY3Rvci56KSA+IHByZWNpc2lvbikgewogICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgfQoKICAgICAgcmV0dXJuIHRydWU7CiAgICB9CiAgICAvKioKICAgICAqIENoZWNrIGlmIGEgdmVjdG9yIGlzIGFsbW9zdCB6ZXJvCiAgICAgKi8KCgogICAgYWxtb3N0WmVybyhwcmVjaXNpb24pIHsKICAgICAgaWYgKHByZWNpc2lvbiA9PT0gdm9pZCAwKSB7CiAgICAgICAgcHJlY2lzaW9uID0gMWUtNjsKICAgICAgfQoKICAgICAgaWYgKE1hdGguYWJzKHRoaXMueCkgPiBwcmVjaXNpb24gfHwgTWF0aC5hYnModGhpcy55KSA+IHByZWNpc2lvbiB8fCBNYXRoLmFicyh0aGlzLnopID4gcHJlY2lzaW9uKSB7CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICB9CgogICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KICAgIC8qKgogICAgICogQ2hlY2sgaWYgdGhlIHZlY3RvciBpcyBhbnRpLXBhcmFsbGVsIHRvIGFub3RoZXIgdmVjdG9yLgogICAgICogQHBhcmFtIHByZWNpc2lvbiBTZXQgdG8gemVybyBmb3IgZXhhY3QgY29tcGFyaXNvbnMKICAgICAqLwoKCiAgICBpc0FudGlwYXJhbGxlbFRvKHZlY3RvciwgcHJlY2lzaW9uKSB7CiAgICAgIHRoaXMubmVnYXRlKGFudGlwX25lZyk7CiAgICAgIHJldHVybiBhbnRpcF9uZWcuYWxtb3N0RXF1YWxzKHZlY3RvciwgcHJlY2lzaW9uKTsKICAgIH0KICAgIC8qKgogICAgICogQ2xvbmUgdGhlIHZlY3RvcgogICAgICovCgoKICAgIGNsb25lKCkgewogICAgICByZXR1cm4gbmV3IFZlYzModGhpcy54LCB0aGlzLnksIHRoaXMueik7CiAgICB9CgogIH0KICBWZWMzLlpFUk8gPSBuZXcgVmVjMygwLCAwLCAwKTsKICBWZWMzLlVOSVRfWCA9IG5ldyBWZWMzKDEsIDAsIDApOwogIFZlYzMuVU5JVF9ZID0gbmV3IFZlYzMoMCwgMSwgMCk7CiAgVmVjMy5VTklUX1ogPSBuZXcgVmVjMygwLCAwLCAxKTsKICBjb25zdCBWZWMzX3RhbmdlbnRzX24gPSBuZXcgVmVjMygpOwogIGNvbnN0IFZlYzNfdGFuZ2VudHNfcmFuZFZlYyA9IG5ldyBWZWMzKCk7CiAgY29uc3QgYW50aXBfbmVnID0gbmV3IFZlYzMoKTsKCiAgLyoqCiAgICogQXhpcyBhbGlnbmVkIGJvdW5kaW5nIGJveCBjbGFzcy4KICAgKi8KICBjbGFzcyBBQUJCIHsKICAgIC8qKgogICAgICogVGhlIGxvd2VyIGJvdW5kIG9mIHRoZSBib3VuZGluZyBib3gKICAgICAqLwoKICAgIC8qKgogICAgICogVGhlIHVwcGVyIGJvdW5kIG9mIHRoZSBib3VuZGluZyBib3gKICAgICAqLwogICAgY29uc3RydWN0b3Iob3B0aW9ucykgewogICAgICBpZiAob3B0aW9ucyA9PT0gdm9pZCAwKSB7CiAgICAgICAgb3B0aW9ucyA9IHt9OwogICAgICB9CgogICAgICB0aGlzLmxvd2VyQm91bmQgPSBuZXcgVmVjMygpOwogICAgICB0aGlzLnVwcGVyQm91bmQgPSBuZXcgVmVjMygpOwoKICAgICAgaWYgKG9wdGlvbnMubG93ZXJCb3VuZCkgewogICAgICAgIHRoaXMubG93ZXJCb3VuZC5jb3B5KG9wdGlvbnMubG93ZXJCb3VuZCk7CiAgICAgIH0KCiAgICAgIGlmIChvcHRpb25zLnVwcGVyQm91bmQpIHsKICAgICAgICB0aGlzLnVwcGVyQm91bmQuY29weShvcHRpb25zLnVwcGVyQm91bmQpOwogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIFNldCB0aGUgQUFCQiBib3VuZHMgZnJvbSBhIHNldCBvZiBwb2ludHMuCiAgICAgKiBAcGFyYW0gcG9pbnRzIEFuIGFycmF5IG9mIFZlYzMncy4KICAgICAqIEByZXR1cm4gVGhlIHNlbGYgb2JqZWN0CiAgICAgKi8KCgogICAgc2V0RnJvbVBvaW50cyhwb2ludHMsIHBvc2l0aW9uLCBxdWF0ZXJuaW9uLCBza2luU2l6ZSkgewogICAgICBjb25zdCBsID0gdGhpcy5sb3dlckJvdW5kOwogICAgICBjb25zdCB1ID0gdGhpcy51cHBlckJvdW5kOwogICAgICBjb25zdCBxID0gcXVhdGVybmlvbjsgLy8gU2V0IHRvIHRoZSBmaXJzdCBwb2ludAoKICAgICAgbC5jb3B5KHBvaW50c1swXSk7CgogICAgICBpZiAocSkgewogICAgICAgIHEudm11bHQobCwgbCk7CiAgICAgIH0KCiAgICAgIHUuY29weShsKTsKCiAgICAgIGZvciAobGV0IGkgPSAxOyBpIDwgcG9pbnRzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgbGV0IHAgPSBwb2ludHNbaV07CgogICAgICAgIGlmIChxKSB7CiAgICAgICAgICBxLnZtdWx0KHAsIHRtcCQxKTsKICAgICAgICAgIHAgPSB0bXAkMTsKICAgICAgICB9CgogICAgICAgIGlmIChwLnggPiB1LngpIHsKICAgICAgICAgIHUueCA9IHAueDsKICAgICAgICB9CgogICAgICAgIGlmIChwLnggPCBsLngpIHsKICAgICAgICAgIGwueCA9IHAueDsKICAgICAgICB9CgogICAgICAgIGlmIChwLnkgPiB1LnkpIHsKICAgICAgICAgIHUueSA9IHAueTsKICAgICAgICB9CgogICAgICAgIGlmIChwLnkgPCBsLnkpIHsKICAgICAgICAgIGwueSA9IHAueTsKICAgICAgICB9CgogICAgICAgIGlmIChwLnogPiB1LnopIHsKICAgICAgICAgIHUueiA9IHAuejsKICAgICAgICB9CgogICAgICAgIGlmIChwLnogPCBsLnopIHsKICAgICAgICAgIGwueiA9IHAuejsKICAgICAgICB9CiAgICAgIH0gLy8gQWRkIG9mZnNldAoKCiAgICAgIGlmIChwb3NpdGlvbikgewogICAgICAgIHBvc2l0aW9uLnZhZGQobCwgbCk7CiAgICAgICAgcG9zaXRpb24udmFkZCh1LCB1KTsKICAgICAgfQoKICAgICAgaWYgKHNraW5TaXplKSB7CiAgICAgICAgbC54IC09IHNraW5TaXplOwogICAgICAgIGwueSAtPSBza2luU2l6ZTsKICAgICAgICBsLnogLT0gc2tpblNpemU7CiAgICAgICAgdS54ICs9IHNraW5TaXplOwogICAgICAgIHUueSArPSBza2luU2l6ZTsKICAgICAgICB1LnogKz0gc2tpblNpemU7CiAgICAgIH0KCiAgICAgIHJldHVybiB0aGlzOwogICAgfQogICAgLyoqCiAgICAgKiBDb3B5IGJvdW5kcyBmcm9tIGFuIEFBQkIgdG8gdGhpcyBBQUJCCiAgICAgKiBAcGFyYW0gYWFiYiBTb3VyY2UgdG8gY29weSBmcm9tCiAgICAgKiBAcmV0dXJuIFRoZSB0aGlzIG9iamVjdCwgZm9yIGNoYWluYWJpbGl0eQogICAgICovCgoKICAgIGNvcHkoYWFiYikgewogICAgICB0aGlzLmxvd2VyQm91bmQuY29weShhYWJiLmxvd2VyQm91bmQpOwogICAgICB0aGlzLnVwcGVyQm91bmQuY29weShhYWJiLnVwcGVyQm91bmQpOwogICAgICByZXR1cm4gdGhpczsKICAgIH0KICAgIC8qKgogICAgICogQ2xvbmUgYW4gQUFCQgogICAgICovCgoKICAgIGNsb25lKCkgewogICAgICByZXR1cm4gbmV3IEFBQkIoKS5jb3B5KHRoaXMpOwogICAgfQogICAgLyoqCiAgICAgKiBFeHRlbmQgdGhpcyBBQUJCIHNvIHRoYXQgaXQgY292ZXJzIHRoZSBnaXZlbiBBQUJCIHRvby4KICAgICAqLwoKCiAgICBleHRlbmQoYWFiYikgewogICAgICB0aGlzLmxvd2VyQm91bmQueCA9IE1hdGgubWluKHRoaXMubG93ZXJCb3VuZC54LCBhYWJiLmxvd2VyQm91bmQueCk7CiAgICAgIHRoaXMudXBwZXJCb3VuZC54ID0gTWF0aC5tYXgodGhpcy51cHBlckJvdW5kLngsIGFhYmIudXBwZXJCb3VuZC54KTsKICAgICAgdGhpcy5sb3dlckJvdW5kLnkgPSBNYXRoLm1pbih0aGlzLmxvd2VyQm91bmQueSwgYWFiYi5sb3dlckJvdW5kLnkpOwogICAgICB0aGlzLnVwcGVyQm91bmQueSA9IE1hdGgubWF4KHRoaXMudXBwZXJCb3VuZC55LCBhYWJiLnVwcGVyQm91bmQueSk7CiAgICAgIHRoaXMubG93ZXJCb3VuZC56ID0gTWF0aC5taW4odGhpcy5sb3dlckJvdW5kLnosIGFhYmIubG93ZXJCb3VuZC56KTsKICAgICAgdGhpcy51cHBlckJvdW5kLnogPSBNYXRoLm1heCh0aGlzLnVwcGVyQm91bmQueiwgYWFiYi51cHBlckJvdW5kLnopOwogICAgfQogICAgLyoqCiAgICAgKiBSZXR1cm5zIHRydWUgaWYgdGhlIGdpdmVuIEFBQkIgb3ZlcmxhcHMgdGhpcyBBQUJCLgogICAgICovCgoKICAgIG92ZXJsYXBzKGFhYmIpIHsKICAgICAgY29uc3QgbDEgPSB0aGlzLmxvd2VyQm91bmQ7CiAgICAgIGNvbnN0IHUxID0gdGhpcy51cHBlckJvdW5kOwogICAgICBjb25zdCBsMiA9IGFhYmIubG93ZXJCb3VuZDsKICAgICAgY29uc3QgdTIgPSBhYWJiLnVwcGVyQm91bmQ7IC8vICAgICAgbDIgICAgICAgIHUyCiAgICAgIC8vICAgICAgfC0tLS0tLS0tLXwKICAgICAgLy8gfC0tLS0tLS0tfAogICAgICAvLyBsMSAgICAgICB1MQoKICAgICAgY29uc3Qgb3ZlcmxhcHNYID0gbDIueCA8PSB1MS54ICYmIHUxLnggPD0gdTIueCB8fCBsMS54IDw9IHUyLnggJiYgdTIueCA8PSB1MS54OwogICAgICBjb25zdCBvdmVybGFwc1kgPSBsMi55IDw9IHUxLnkgJiYgdTEueSA8PSB1Mi55IHx8IGwxLnkgPD0gdTIueSAmJiB1Mi55IDw9IHUxLnk7CiAgICAgIGNvbnN0IG92ZXJsYXBzWiA9IGwyLnogPD0gdTEueiAmJiB1MS56IDw9IHUyLnogfHwgbDEueiA8PSB1Mi56ICYmIHUyLnogPD0gdTEuejsKICAgICAgcmV0dXJuIG92ZXJsYXBzWCAmJiBvdmVybGFwc1kgJiYgb3ZlcmxhcHNaOwogICAgfSAvLyBNb3N0bHkgZm9yIGRlYnVnZ2luZwoKCiAgICB2b2x1bWUoKSB7CiAgICAgIGNvbnN0IGwgPSB0aGlzLmxvd2VyQm91bmQ7CiAgICAgIGNvbnN0IHUgPSB0aGlzLnVwcGVyQm91bmQ7CiAgICAgIHJldHVybiAodS54IC0gbC54KSAqICh1LnkgLSBsLnkpICogKHUueiAtIGwueik7CiAgICB9CiAgICAvKioKICAgICAqIFJldHVybnMgdHJ1ZSBpZiB0aGUgZ2l2ZW4gQUFCQiBpcyBmdWxseSBjb250YWluZWQgaW4gdGhpcyBBQUJCLgogICAgICovCgoKICAgIGNvbnRhaW5zKGFhYmIpIHsKICAgICAgY29uc3QgbDEgPSB0aGlzLmxvd2VyQm91bmQ7CiAgICAgIGNvbnN0IHUxID0gdGhpcy51cHBlckJvdW5kOwogICAgICBjb25zdCBsMiA9IGFhYmIubG93ZXJCb3VuZDsKICAgICAgY29uc3QgdTIgPSBhYWJiLnVwcGVyQm91bmQ7IC8vICAgICAgbDIgICAgICAgIHUyCiAgICAgIC8vICAgICAgfC0tLS0tLS0tLXwKICAgICAgLy8gfC0tLS0tLS0tLS0tLS0tLXwKICAgICAgLy8gbDEgICAgICAgICAgICAgIHUxCgogICAgICByZXR1cm4gbDEueCA8PSBsMi54ICYmIHUxLnggPj0gdTIueCAmJiBsMS55IDw9IGwyLnkgJiYgdTEueSA+PSB1Mi55ICYmIGwxLnogPD0gbDIueiAmJiB1MS56ID49IHUyLno7CiAgICB9CgogICAgZ2V0Q29ybmVycyhhLCBiLCBjLCBkLCBlLCBmLCBnLCBoKSB7CiAgICAgIGNvbnN0IGwgPSB0aGlzLmxvd2VyQm91bmQ7CiAgICAgIGNvbnN0IHUgPSB0aGlzLnVwcGVyQm91bmQ7CiAgICAgIGEuY29weShsKTsKICAgICAgYi5zZXQodS54LCBsLnksIGwueik7CiAgICAgIGMuc2V0KHUueCwgdS55LCBsLnopOwogICAgICBkLnNldChsLngsIHUueSwgdS56KTsKICAgICAgZS5zZXQodS54LCBsLnksIHUueik7CiAgICAgIGYuc2V0KGwueCwgdS55LCBsLnopOwogICAgICBnLnNldChsLngsIGwueSwgdS56KTsKICAgICAgaC5jb3B5KHUpOwogICAgfQogICAgLyoqCiAgICAgKiBHZXQgdGhlIHJlcHJlc2VudGF0aW9uIG9mIGFuIEFBQkIgaW4gYW5vdGhlciBmcmFtZS4KICAgICAqIEByZXR1cm4gVGhlICJ0YXJnZXQiIEFBQkIgb2JqZWN0LgogICAgICovCgoKICAgIHRvTG9jYWxGcmFtZShmcmFtZSwgdGFyZ2V0KSB7CiAgICAgIGNvbnN0IGNvcm5lcnMgPSB0cmFuc2Zvcm1JbnRvRnJhbWVfY29ybmVyczsKICAgICAgY29uc3QgYSA9IGNvcm5lcnNbMF07CiAgICAgIGNvbnN0IGIgPSBjb3JuZXJzWzFdOwogICAgICBjb25zdCBjID0gY29ybmVyc1syXTsKICAgICAgY29uc3QgZCA9IGNvcm5lcnNbM107CiAgICAgIGNvbnN0IGUgPSBjb3JuZXJzWzRdOwogICAgICBjb25zdCBmID0gY29ybmVyc1s1XTsKICAgICAgY29uc3QgZyA9IGNvcm5lcnNbNl07CiAgICAgIGNvbnN0IGggPSBjb3JuZXJzWzddOyAvLyBHZXQgY29ybmVycyBpbiBjdXJyZW50IGZyYW1lCgogICAgICB0aGlzLmdldENvcm5lcnMoYSwgYiwgYywgZCwgZSwgZiwgZywgaCk7IC8vIFRyYW5zZm9ybSB0aGVtIHRvIG5ldyBsb2NhbCBmcmFtZQoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgIT09IDg7IGkrKykgewogICAgICAgIGNvbnN0IGNvcm5lciA9IGNvcm5lcnNbaV07CiAgICAgICAgZnJhbWUucG9pbnRUb0xvY2FsKGNvcm5lciwgY29ybmVyKTsKICAgICAgfQoKICAgICAgcmV0dXJuIHRhcmdldC5zZXRGcm9tUG9pbnRzKGNvcm5lcnMpOwogICAgfQogICAgLyoqCiAgICAgKiBHZXQgdGhlIHJlcHJlc2VudGF0aW9uIG9mIGFuIEFBQkIgaW4gdGhlIGdsb2JhbCBmcmFtZS4KICAgICAqIEByZXR1cm4gVGhlICJ0YXJnZXQiIEFBQkIgb2JqZWN0LgogICAgICovCgoKICAgIHRvV29ybGRGcmFtZShmcmFtZSwgdGFyZ2V0KSB7CiAgICAgIGNvbnN0IGNvcm5lcnMgPSB0cmFuc2Zvcm1JbnRvRnJhbWVfY29ybmVyczsKICAgICAgY29uc3QgYSA9IGNvcm5lcnNbMF07CiAgICAgIGNvbnN0IGIgPSBjb3JuZXJzWzFdOwogICAgICBjb25zdCBjID0gY29ybmVyc1syXTsKICAgICAgY29uc3QgZCA9IGNvcm5lcnNbM107CiAgICAgIGNvbnN0IGUgPSBjb3JuZXJzWzRdOwogICAgICBjb25zdCBmID0gY29ybmVyc1s1XTsKICAgICAgY29uc3QgZyA9IGNvcm5lcnNbNl07CiAgICAgIGNvbnN0IGggPSBjb3JuZXJzWzddOyAvLyBHZXQgY29ybmVycyBpbiBjdXJyZW50IGZyYW1lCgogICAgICB0aGlzLmdldENvcm5lcnMoYSwgYiwgYywgZCwgZSwgZiwgZywgaCk7IC8vIFRyYW5zZm9ybSB0aGVtIHRvIG5ldyBsb2NhbCBmcmFtZQoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgIT09IDg7IGkrKykgewogICAgICAgIGNvbnN0IGNvcm5lciA9IGNvcm5lcnNbaV07CiAgICAgICAgZnJhbWUucG9pbnRUb1dvcmxkKGNvcm5lciwgY29ybmVyKTsKICAgICAgfQoKICAgICAgcmV0dXJuIHRhcmdldC5zZXRGcm9tUG9pbnRzKGNvcm5lcnMpOwogICAgfQogICAgLyoqCiAgICAgKiBDaGVjayBpZiB0aGUgQUFCQiBpcyBoaXQgYnkgYSByYXkuCiAgICAgKi8KCgogICAgb3ZlcmxhcHNSYXkocmF5KSB7CiAgICAgIGNvbnN0IHsKICAgICAgICBkaXJlY3Rpb24sCiAgICAgICAgZnJvbQogICAgICB9ID0gcmF5OyAvLyBjb25zdCB0ID0gMAogICAgICAvLyByYXkuZGlyZWN0aW9uIGlzIHVuaXQgZGlyZWN0aW9uIHZlY3RvciBvZiByYXkKCiAgICAgIGNvbnN0IGRpckZyYWNYID0gMSAvIGRpcmVjdGlvbi54OwogICAgICBjb25zdCBkaXJGcmFjWSA9IDEgLyBkaXJlY3Rpb24ueTsKICAgICAgY29uc3QgZGlyRnJhY1ogPSAxIC8gZGlyZWN0aW9uLno7IC8vIHRoaXMubG93ZXJCb3VuZCBpcyB0aGUgY29ybmVyIG9mIEFBQkIgd2l0aCBtaW5pbWFsIGNvb3JkaW5hdGVzIC0gbGVmdCBib3R0b20sIHJ0IGlzIG1heGltYWwgY29ybmVyCgogICAgICBjb25zdCB0MSA9ICh0aGlzLmxvd2VyQm91bmQueCAtIGZyb20ueCkgKiBkaXJGcmFjWDsKICAgICAgY29uc3QgdDIgPSAodGhpcy51cHBlckJvdW5kLnggLSBmcm9tLngpICogZGlyRnJhY1g7CiAgICAgIGNvbnN0IHQzID0gKHRoaXMubG93ZXJCb3VuZC55IC0gZnJvbS55KSAqIGRpckZyYWNZOwogICAgICBjb25zdCB0NCA9ICh0aGlzLnVwcGVyQm91bmQueSAtIGZyb20ueSkgKiBkaXJGcmFjWTsKICAgICAgY29uc3QgdDUgPSAodGhpcy5sb3dlckJvdW5kLnogLSBmcm9tLnopICogZGlyRnJhY1o7CiAgICAgIGNvbnN0IHQ2ID0gKHRoaXMudXBwZXJCb3VuZC56IC0gZnJvbS56KSAqIGRpckZyYWNaOyAvLyBjb25zdCB0bWluID0gTWF0aC5tYXgoTWF0aC5tYXgoTWF0aC5taW4odDEsIHQyKSwgTWF0aC5taW4odDMsIHQ0KSkpOwogICAgICAvLyBjb25zdCB0bWF4ID0gTWF0aC5taW4oTWF0aC5taW4oTWF0aC5tYXgodDEsIHQyKSwgTWF0aC5tYXgodDMsIHQ0KSkpOwoKICAgICAgY29uc3QgdG1pbiA9IE1hdGgubWF4KE1hdGgubWF4KE1hdGgubWluKHQxLCB0MiksIE1hdGgubWluKHQzLCB0NCkpLCBNYXRoLm1pbih0NSwgdDYpKTsKICAgICAgY29uc3QgdG1heCA9IE1hdGgubWluKE1hdGgubWluKE1hdGgubWF4KHQxLCB0MiksIE1hdGgubWF4KHQzLCB0NCkpLCBNYXRoLm1heCh0NSwgdDYpKTsgLy8gaWYgdG1heCA8IDAsIHJheSAobGluZSkgaXMgaW50ZXJzZWN0aW5nIEFBQkIsIGJ1dCB3aG9sZSBBQUJCIGlzIGJlaGluZyB1cwoKICAgICAgaWYgKHRtYXggPCAwKSB7CiAgICAgICAgLy90ID0gdG1heDsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgIH0gLy8gaWYgdG1pbiA+IHRtYXgsIHJheSBkb2Vzbid0IGludGVyc2VjdCBBQUJCCgoKICAgICAgaWYgKHRtaW4gPiB0bWF4KSB7CiAgICAgICAgLy90ID0gdG1heDsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgIH0KCiAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICB9CiAgY29uc3QgdG1wJDEgPSBuZXcgVmVjMygpOwogIGNvbnN0IHRyYW5zZm9ybUludG9GcmFtZV9jb3JuZXJzID0gW25ldyBWZWMzKCksIG5ldyBWZWMzKCksIG5ldyBWZWMzKCksIG5ldyBWZWMzKCksIG5ldyBWZWMzKCksIG5ldyBWZWMzKCksIG5ldyBWZWMzKCksIG5ldyBWZWMzKCldOwoKICAvKioKICAgKiBDb2xsaXNpb24gIm1hdHJpeCIuCiAgICogSXQncyBhY3R1YWxseSBhIHRyaWFuZ3VsYXItc2hhcGVkIGFycmF5IG9mIHdoZXRoZXIgdHdvIGJvZGllcyBhcmUgdG91Y2hpbmcgdGhpcyBzdGVwLCBmb3IgcmVmZXJlbmNlIG5leHQgc3RlcAogICAqLwogIGNsYXNzIEFycmF5Q29sbGlzaW9uTWF0cml4IHsKICAgIC8qKgogICAgICogVGhlIG1hdHJpeCBzdG9yYWdlLgogICAgICovCiAgICBjb25zdHJ1Y3RvcigpIHsKICAgICAgdGhpcy5tYXRyaXggPSBbXTsKICAgIH0KICAgIC8qKgogICAgICogR2V0IGFuIGVsZW1lbnQKICAgICAqLwoKCiAgICBnZXQoYmksIGJqKSB7CiAgICAgIGxldCB7CiAgICAgICAgaW5kZXg6IGkKICAgICAgfSA9IGJpOwogICAgICBsZXQgewogICAgICAgIGluZGV4OiBqCiAgICAgIH0gPSBiajsKCiAgICAgIGlmIChqID4gaSkgewogICAgICAgIGNvbnN0IHRlbXAgPSBqOwogICAgICAgIGogPSBpOwogICAgICAgIGkgPSB0ZW1wOwogICAgICB9CgogICAgICByZXR1cm4gdGhpcy5tYXRyaXhbKGkgKiAoaSArIDEpID4+IDEpICsgaiAtIDFdOwogICAgfQogICAgLyoqCiAgICAgKiBTZXQgYW4gZWxlbWVudAogICAgICovCgoKICAgIHNldChiaSwgYmosIHZhbHVlKSB7CiAgICAgIGxldCB7CiAgICAgICAgaW5kZXg6IGkKICAgICAgfSA9IGJpOwogICAgICBsZXQgewogICAgICAgIGluZGV4OiBqCiAgICAgIH0gPSBiajsKCiAgICAgIGlmIChqID4gaSkgewogICAgICAgIGNvbnN0IHRlbXAgPSBqOwogICAgICAgIGogPSBpOwogICAgICAgIGkgPSB0ZW1wOwogICAgICB9CgogICAgICB0aGlzLm1hdHJpeFsoaSAqIChpICsgMSkgPj4gMSkgKyBqIC0gMV0gPSB2YWx1ZSA/IDEgOiAwOwogICAgfQogICAgLyoqCiAgICAgKiBTZXRzIGFsbCBlbGVtZW50cyB0byB6ZXJvCiAgICAgKi8KCgogICAgcmVzZXQoKSB7CiAgICAgIGZvciAobGV0IGkgPSAwLCBsID0gdGhpcy5tYXRyaXgubGVuZ3RoOyBpICE9PSBsOyBpKyspIHsKICAgICAgICB0aGlzLm1hdHJpeFtpXSA9IDA7CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogU2V0cyB0aGUgbWF4IG51bWJlciBvZiBvYmplY3RzCiAgICAgKi8KCgogICAgc2V0TnVtT2JqZWN0cyhuKSB7CiAgICAgIHRoaXMubWF0cml4Lmxlbmd0aCA9IG4gKiAobiAtIDEpID4+IDE7CiAgICB9CgogIH0KCiAgLyoqCiAgICogQmFzZSBjbGFzcyBmb3Igb2JqZWN0cyB0aGF0IGRpc3BhdGNoZXMgZXZlbnRzLgogICAqLwogIGNsYXNzIEV2ZW50VGFyZ2V0IHsKICAgIC8qKgogICAgICogQWRkIGFuIGV2ZW50IGxpc3RlbmVyCiAgICAgKiBAcmV0dXJuIFRoZSBzZWxmIG9iamVjdCwgZm9yIGNoYWluYWJpbGl0eS4KICAgICAqLwogICAgYWRkRXZlbnRMaXN0ZW5lcih0eXBlLCBsaXN0ZW5lcikgewogICAgICBpZiAodGhpcy5fbGlzdGVuZXJzID09PSB1bmRlZmluZWQpIHsKICAgICAgICB0aGlzLl9saXN0ZW5lcnMgPSB7fTsKICAgICAgfQoKICAgICAgY29uc3QgbGlzdGVuZXJzID0gdGhpcy5fbGlzdGVuZXJzOwoKICAgICAgaWYgKGxpc3RlbmVyc1t0eXBlXSA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgbGlzdGVuZXJzW3R5cGVdID0gW107CiAgICAgIH0KCiAgICAgIGlmICghbGlzdGVuZXJzW3R5cGVdLmluY2x1ZGVzKGxpc3RlbmVyKSkgewogICAgICAgIGxpc3RlbmVyc1t0eXBlXS5wdXNoKGxpc3RlbmVyKTsKICAgICAgfQoKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICAvKioKICAgICAqIENoZWNrIGlmIGFuIGV2ZW50IGxpc3RlbmVyIGlzIGFkZGVkCiAgICAgKi8KCgogICAgaGFzRXZlbnRMaXN0ZW5lcih0eXBlLCBsaXN0ZW5lcikgewogICAgICBpZiAodGhpcy5fbGlzdGVuZXJzID09PSB1bmRlZmluZWQpIHsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgIH0KCiAgICAgIGNvbnN0IGxpc3RlbmVycyA9IHRoaXMuX2xpc3RlbmVyczsKCiAgICAgIGlmIChsaXN0ZW5lcnNbdHlwZV0gIT09IHVuZGVmaW5lZCAmJiBsaXN0ZW5lcnNbdHlwZV0uaW5jbHVkZXMobGlzdGVuZXIpKSB7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgIH0KCiAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KICAgIC8qKgogICAgICogQ2hlY2sgaWYgYW55IGV2ZW50IGxpc3RlbmVyIG9mIHRoZSBnaXZlbiB0eXBlIGlzIGFkZGVkCiAgICAgKi8KCgogICAgaGFzQW55RXZlbnRMaXN0ZW5lcih0eXBlKSB7CiAgICAgIGlmICh0aGlzLl9saXN0ZW5lcnMgPT09IHVuZGVmaW5lZCkgewogICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgfQoKICAgICAgY29uc3QgbGlzdGVuZXJzID0gdGhpcy5fbGlzdGVuZXJzOwogICAgICByZXR1cm4gbGlzdGVuZXJzW3R5cGVdICE9PSB1bmRlZmluZWQ7CiAgICB9CiAgICAvKioKICAgICAqIFJlbW92ZSBhbiBldmVudCBsaXN0ZW5lcgogICAgICogQHJldHVybiBUaGUgc2VsZiBvYmplY3QsIGZvciBjaGFpbmFiaWxpdHkuCiAgICAgKi8KCgogICAgcmVtb3ZlRXZlbnRMaXN0ZW5lcih0eXBlLCBsaXN0ZW5lcikgewogICAgICBpZiAodGhpcy5fbGlzdGVuZXJzID09PSB1bmRlZmluZWQpIHsKICAgICAgICByZXR1cm4gdGhpczsKICAgICAgfQoKICAgICAgY29uc3QgbGlzdGVuZXJzID0gdGhpcy5fbGlzdGVuZXJzOwoKICAgICAgaWYgKGxpc3RlbmVyc1t0eXBlXSA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgIH0KCiAgICAgIGNvbnN0IGluZGV4ID0gbGlzdGVuZXJzW3R5cGVdLmluZGV4T2YobGlzdGVuZXIpOwoKICAgICAgaWYgKGluZGV4ICE9PSAtMSkgewogICAgICAgIGxpc3RlbmVyc1t0eXBlXS5zcGxpY2UoaW5kZXgsIDEpOwogICAgICB9CgogICAgICByZXR1cm4gdGhpczsKICAgIH0KICAgIC8qKgogICAgICogRW1pdCBhbiBldmVudC4KICAgICAqIEByZXR1cm4gVGhlIHNlbGYgb2JqZWN0LCBmb3IgY2hhaW5hYmlsaXR5LgogICAgICovCgoKICAgIGRpc3BhdGNoRXZlbnQoZXZlbnQpIHsKICAgICAgaWYgKHRoaXMuX2xpc3RlbmVycyA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgIH0KCiAgICAgIGNvbnN0IGxpc3RlbmVycyA9IHRoaXMuX2xpc3RlbmVyczsKICAgICAgY29uc3QgbGlzdGVuZXJBcnJheSA9IGxpc3RlbmVyc1tldmVudC50eXBlXTsKCiAgICAgIGlmIChsaXN0ZW5lckFycmF5ICE9PSB1bmRlZmluZWQpIHsKICAgICAgICBldmVudC50YXJnZXQgPSB0aGlzOwoKICAgICAgICBmb3IgKGxldCBpID0gMCwgbCA9IGxpc3RlbmVyQXJyYXkubGVuZ3RoOyBpIDwgbDsgaSsrKSB7CiAgICAgICAgICBsaXN0ZW5lckFycmF5W2ldLmNhbGwodGhpcywgZXZlbnQpOwogICAgICAgIH0KICAgICAgfQoKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CgogIH0KCiAgLyoqCiAgICogQSBRdWF0ZXJuaW9uIGRlc2NyaWJlcyBhIHJvdGF0aW9uIGluIDNEIHNwYWNlLiBUaGUgUXVhdGVybmlvbiBpcyBtYXRoZW1hdGljYWxseSBkZWZpbmVkIGFzIFEgPSB4KmkgKyB5KmogKyB6KmsgKyB3LCB3aGVyZSAoaSxqLGspIGFyZSBpbWFnaW5hcnkgYmFzaXMgdmVjdG9ycy4gKHgseSx6KSBjYW4gYmUgc2VlbiBhcyBhIHZlY3RvciByZWxhdGVkIHRvIHRoZSBheGlzIG9mIHJvdGF0aW9uLCB3aGlsZSB0aGUgcmVhbCBtdWx0aXBsaWVyLCB3LCBpcyByZWxhdGVkIHRvIHRoZSBhbW91bnQgb2Ygcm90YXRpb24uCiAgICogQHBhcmFtIHggTXVsdGlwbGllciBvZiB0aGUgaW1hZ2luYXJ5IGJhc2lzIHZlY3RvciBpLgogICAqIEBwYXJhbSB5IE11bHRpcGxpZXIgb2YgdGhlIGltYWdpbmFyeSBiYXNpcyB2ZWN0b3Igai4KICAgKiBAcGFyYW0geiBNdWx0aXBsaWVyIG9mIHRoZSBpbWFnaW5hcnkgYmFzaXMgdmVjdG9yIGsuCiAgICogQHBhcmFtIHcgTXVsdGlwbGllciBvZiB0aGUgcmVhbCBwYXJ0LgogICAqIEBzZWUgaHR0cDovL2VuLndpa2lwZWRpYS5vcmcvd2lraS9RdWF0ZXJuaW9uCiAgICovCgogIGNsYXNzIFF1YXRlcm5pb24gewogICAgY29uc3RydWN0b3IoeCwgeSwgeiwgdykgewogICAgICBpZiAoeCA9PT0gdm9pZCAwKSB7CiAgICAgICAgeCA9IDA7CiAgICAgIH0KCiAgICAgIGlmICh5ID09PSB2b2lkIDApIHsKICAgICAgICB5ID0gMDsKICAgICAgfQoKICAgICAgaWYgKHogPT09IHZvaWQgMCkgewogICAgICAgIHogPSAwOwogICAgICB9CgogICAgICBpZiAodyA9PT0gdm9pZCAwKSB7CiAgICAgICAgdyA9IDE7CiAgICAgIH0KCiAgICAgIHRoaXMueCA9IHg7CiAgICAgIHRoaXMueSA9IHk7CiAgICAgIHRoaXMueiA9IHo7CiAgICAgIHRoaXMudyA9IHc7CiAgICB9CiAgICAvKioKICAgICAqIFNldCB0aGUgdmFsdWUgb2YgdGhlIHF1YXRlcm5pb24uCiAgICAgKi8KCgogICAgc2V0KHgsIHksIHosIHcpIHsKICAgICAgdGhpcy54ID0geDsKICAgICAgdGhpcy55ID0geTsKICAgICAgdGhpcy56ID0gejsKICAgICAgdGhpcy53ID0gdzsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICAvKioKICAgICAqIENvbnZlcnQgdG8gYSByZWFkYWJsZSBmb3JtYXQKICAgICAqIEByZXR1cm4gIngseSx6LHciCiAgICAgKi8KCgogICAgdG9TdHJpbmcoKSB7CiAgICAgIHJldHVybiBgJHt0aGlzLnh9LCR7dGhpcy55fSwke3RoaXMuen0sJHt0aGlzLnd9YDsKICAgIH0KICAgIC8qKgogICAgICogQ29udmVydCB0byBhbiBBcnJheQogICAgICogQHJldHVybiBbeCwgeSwgeiwgd10KICAgICAqLwoKCiAgICB0b0FycmF5KCkgewogICAgICByZXR1cm4gW3RoaXMueCwgdGhpcy55LCB0aGlzLnosIHRoaXMud107CiAgICB9CiAgICAvKioKICAgICAqIFNldCB0aGUgcXVhdGVybmlvbiBjb21wb25lbnRzIGdpdmVuIGFuIGF4aXMgYW5kIGFuIGFuZ2xlIGluIHJhZGlhbnMuCiAgICAgKi8KCgogICAgc2V0RnJvbUF4aXNBbmdsZSh2ZWN0b3IsIGFuZ2xlKSB7CiAgICAgIGNvbnN0IHMgPSBNYXRoLnNpbihhbmdsZSAqIDAuNSk7CiAgICAgIHRoaXMueCA9IHZlY3Rvci54ICogczsKICAgICAgdGhpcy55ID0gdmVjdG9yLnkgKiBzOwogICAgICB0aGlzLnogPSB2ZWN0b3IueiAqIHM7CiAgICAgIHRoaXMudyA9IE1hdGguY29zKGFuZ2xlICogMC41KTsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICAvKioKICAgICAqIENvbnZlcnRzIHRoZSBxdWF0ZXJuaW9uIHRvIFsgYXhpcywgYW5nbGUgXSByZXByZXNlbnRhdGlvbi4KICAgICAqIEBwYXJhbSB0YXJnZXRBeGlzIEEgdmVjdG9yIG9iamVjdCB0byByZXVzZSBmb3Igc3RvcmluZyB0aGUgYXhpcy4KICAgICAqIEByZXR1cm4gQW4gYXJyYXksIGZpcnN0IGVsZW1lbnQgaXMgdGhlIGF4aXMgYW5kIHRoZSBzZWNvbmQgaXMgdGhlIGFuZ2xlIGluIHJhZGlhbnMuCiAgICAgKi8KCgogICAgdG9BeGlzQW5nbGUodGFyZ2V0QXhpcykgewogICAgICBpZiAodGFyZ2V0QXhpcyA9PT0gdm9pZCAwKSB7CiAgICAgICAgdGFyZ2V0QXhpcyA9IG5ldyBWZWMzKCk7CiAgICAgIH0KCiAgICAgIHRoaXMubm9ybWFsaXplKCk7IC8vIGlmIHc+MSBhY29zIGFuZCBzcXJ0IHdpbGwgcHJvZHVjZSBlcnJvcnMsIHRoaXMgY2FudCBoYXBwZW4gaWYgcXVhdGVybmlvbiBpcyBub3JtYWxpc2VkCgogICAgICBjb25zdCBhbmdsZSA9IDIgKiBNYXRoLmFjb3ModGhpcy53KTsKICAgICAgY29uc3QgcyA9IE1hdGguc3FydCgxIC0gdGhpcy53ICogdGhpcy53KTsgLy8gYXNzdW1pbmcgcXVhdGVybmlvbiBub3JtYWxpc2VkIHRoZW4gdyBpcyBsZXNzIHRoYW4gMSwgc28gdGVybSBhbHdheXMgcG9zaXRpdmUuCgogICAgICBpZiAocyA8IDAuMDAxKSB7CiAgICAgICAgLy8gdGVzdCB0byBhdm9pZCBkaXZpZGUgYnkgemVybywgcyBpcyBhbHdheXMgcG9zaXRpdmUgZHVlIHRvIHNxcnQKICAgICAgICAvLyBpZiBzIGNsb3NlIHRvIHplcm8gdGhlbiBkaXJlY3Rpb24gb2YgYXhpcyBub3QgaW1wb3J0YW50CiAgICAgICAgdGFyZ2V0QXhpcy54ID0gdGhpcy54OyAvLyBpZiBpdCBpcyBpbXBvcnRhbnQgdGhhdCBheGlzIGlzIG5vcm1hbGlzZWQgdGhlbiByZXBsYWNlIHdpdGggeD0xOyB5PXo9MDsKCiAgICAgICAgdGFyZ2V0QXhpcy55ID0gdGhpcy55OwogICAgICAgIHRhcmdldEF4aXMueiA9IHRoaXMuejsKICAgICAgfSBlbHNlIHsKICAgICAgICB0YXJnZXRBeGlzLnggPSB0aGlzLnggLyBzOyAvLyBub3JtYWxpc2UgYXhpcwoKICAgICAgICB0YXJnZXRBeGlzLnkgPSB0aGlzLnkgLyBzOwogICAgICAgIHRhcmdldEF4aXMueiA9IHRoaXMueiAvIHM7CiAgICAgIH0KCiAgICAgIHJldHVybiBbdGFyZ2V0QXhpcywgYW5nbGVdOwogICAgfQogICAgLyoqCiAgICAgKiBTZXQgdGhlIHF1YXRlcm5pb24gdmFsdWUgZ2l2ZW4gdHdvIHZlY3RvcnMuIFRoZSByZXN1bHRpbmcgcm90YXRpb24gd2lsbCBiZSB0aGUgbmVlZGVkIHJvdGF0aW9uIHRvIHJvdGF0ZSB1IHRvIHYuCiAgICAgKi8KCgogICAgc2V0RnJvbVZlY3RvcnModSwgdikgewogICAgICBpZiAodS5pc0FudGlwYXJhbGxlbFRvKHYpKSB7CiAgICAgICAgY29uc3QgdDEgPSBzZnZfdDE7CiAgICAgICAgY29uc3QgdDIgPSBzZnZfdDI7CiAgICAgICAgdS50YW5nZW50cyh0MSwgdDIpOwogICAgICAgIHRoaXMuc2V0RnJvbUF4aXNBbmdsZSh0MSwgTWF0aC5QSSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgY29uc3QgYSA9IHUuY3Jvc3Modik7CiAgICAgICAgdGhpcy54ID0gYS54OwogICAgICAgIHRoaXMueSA9IGEueTsKICAgICAgICB0aGlzLnogPSBhLno7CiAgICAgICAgdGhpcy53ID0gTWF0aC5zcXJ0KHUubGVuZ3RoKCkgKiogMiAqIHYubGVuZ3RoKCkgKiogMikgKyB1LmRvdCh2KTsKICAgICAgICB0aGlzLm5vcm1hbGl6ZSgpOwogICAgICB9CgogICAgICByZXR1cm4gdGhpczsKICAgIH0KICAgIC8qKgogICAgICogTXVsdGlwbHkgdGhlIHF1YXRlcm5pb24gd2l0aCBhbiBvdGhlciBxdWF0ZXJuaW9uLgogICAgICovCgoKICAgIG11bHQocXVhdCwgdGFyZ2V0KSB7CiAgICAgIGlmICh0YXJnZXQgPT09IHZvaWQgMCkgewogICAgICAgIHRhcmdldCA9IG5ldyBRdWF0ZXJuaW9uKCk7CiAgICAgIH0KCiAgICAgIGNvbnN0IGF4ID0gdGhpcy54OwogICAgICBjb25zdCBheSA9IHRoaXMueTsKICAgICAgY29uc3QgYXogPSB0aGlzLno7CiAgICAgIGNvbnN0IGF3ID0gdGhpcy53OwogICAgICBjb25zdCBieCA9IHF1YXQueDsKICAgICAgY29uc3QgYnkgPSBxdWF0Lnk7CiAgICAgIGNvbnN0IGJ6ID0gcXVhdC56OwogICAgICBjb25zdCBidyA9IHF1YXQudzsKICAgICAgdGFyZ2V0LnggPSBheCAqIGJ3ICsgYXcgKiBieCArIGF5ICogYnogLSBheiAqIGJ5OwogICAgICB0YXJnZXQueSA9IGF5ICogYncgKyBhdyAqIGJ5ICsgYXogKiBieCAtIGF4ICogYno7CiAgICAgIHRhcmdldC56ID0gYXogKiBidyArIGF3ICogYnogKyBheCAqIGJ5IC0gYXkgKiBieDsKICAgICAgdGFyZ2V0LncgPSBhdyAqIGJ3IC0gYXggKiBieCAtIGF5ICogYnkgLSBheiAqIGJ6OwogICAgICByZXR1cm4gdGFyZ2V0OwogICAgfQogICAgLyoqCiAgICAgKiBHZXQgdGhlIGludmVyc2UgcXVhdGVybmlvbiByb3RhdGlvbi4KICAgICAqLwoKCiAgICBpbnZlcnNlKHRhcmdldCkgewogICAgICBpZiAodGFyZ2V0ID09PSB2b2lkIDApIHsKICAgICAgICB0YXJnZXQgPSBuZXcgUXVhdGVybmlvbigpOwogICAgICB9CgogICAgICBjb25zdCB4ID0gdGhpcy54OwogICAgICBjb25zdCB5ID0gdGhpcy55OwogICAgICBjb25zdCB6ID0gdGhpcy56OwogICAgICBjb25zdCB3ID0gdGhpcy53OwogICAgICB0aGlzLmNvbmp1Z2F0ZSh0YXJnZXQpOwogICAgICBjb25zdCBpbm9ybTIgPSAxIC8gKHggKiB4ICsgeSAqIHkgKyB6ICogeiArIHcgKiB3KTsKICAgICAgdGFyZ2V0LnggKj0gaW5vcm0yOwogICAgICB0YXJnZXQueSAqPSBpbm9ybTI7CiAgICAgIHRhcmdldC56ICo9IGlub3JtMjsKICAgICAgdGFyZ2V0LncgKj0gaW5vcm0yOwogICAgICByZXR1cm4gdGFyZ2V0OwogICAgfQogICAgLyoqCiAgICAgKiBHZXQgdGhlIHF1YXRlcm5pb24gY29uanVnYXRlCiAgICAgKi8KCgogICAgY29uanVnYXRlKHRhcmdldCkgewogICAgICBpZiAodGFyZ2V0ID09PSB2b2lkIDApIHsKICAgICAgICB0YXJnZXQgPSBuZXcgUXVhdGVybmlvbigpOwogICAgICB9CgogICAgICB0YXJnZXQueCA9IC10aGlzLng7CiAgICAgIHRhcmdldC55ID0gLXRoaXMueTsKICAgICAgdGFyZ2V0LnogPSAtdGhpcy56OwogICAgICB0YXJnZXQudyA9IHRoaXMudzsKICAgICAgcmV0dXJuIHRhcmdldDsKICAgIH0KICAgIC8qKgogICAgICogTm9ybWFsaXplIHRoZSBxdWF0ZXJuaW9uLiBOb3RlIHRoYXQgdGhpcyBjaGFuZ2VzIHRoZSB2YWx1ZXMgb2YgdGhlIHF1YXRlcm5pb24uCiAgICAgKi8KCgogICAgbm9ybWFsaXplKCkgewogICAgICBsZXQgbCA9IE1hdGguc3FydCh0aGlzLnggKiB0aGlzLnggKyB0aGlzLnkgKiB0aGlzLnkgKyB0aGlzLnogKiB0aGlzLnogKyB0aGlzLncgKiB0aGlzLncpOwoKICAgICAgaWYgKGwgPT09IDApIHsKICAgICAgICB0aGlzLnggPSAwOwogICAgICAgIHRoaXMueSA9IDA7CiAgICAgICAgdGhpcy56ID0gMDsKICAgICAgICB0aGlzLncgPSAwOwogICAgICB9IGVsc2UgewogICAgICAgIGwgPSAxIC8gbDsKICAgICAgICB0aGlzLnggKj0gbDsKICAgICAgICB0aGlzLnkgKj0gbDsKICAgICAgICB0aGlzLnogKj0gbDsKICAgICAgICB0aGlzLncgKj0gbDsKICAgICAgfQoKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICAvKioKICAgICAqIEFwcHJveGltYXRpb24gb2YgcXVhdGVybmlvbiBub3JtYWxpemF0aW9uLiBXb3JrcyBiZXN0IHdoZW4gcXVhdCBpcyBhbHJlYWR5IGFsbW9zdC1ub3JtYWxpemVkLgogICAgICogQGF1dGhvciB1bnBoYXNlZCwgaHR0cHM6Ly9naXRodWIuY29tL3VucGhhc2VkCiAgICAgKi8KCgogICAgbm9ybWFsaXplRmFzdCgpIHsKICAgICAgY29uc3QgZiA9ICgzLjAgLSAodGhpcy54ICogdGhpcy54ICsgdGhpcy55ICogdGhpcy55ICsgdGhpcy56ICogdGhpcy56ICsgdGhpcy53ICogdGhpcy53KSkgLyAyLjA7CgogICAgICBpZiAoZiA9PT0gMCkgewogICAgICAgIHRoaXMueCA9IDA7CiAgICAgICAgdGhpcy55ID0gMDsKICAgICAgICB0aGlzLnogPSAwOwogICAgICAgIHRoaXMudyA9IDA7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhpcy54ICo9IGY7CiAgICAgICAgdGhpcy55ICo9IGY7CiAgICAgICAgdGhpcy56ICo9IGY7CiAgICAgICAgdGhpcy53ICo9IGY7CiAgICAgIH0KCiAgICAgIHJldHVybiB0aGlzOwogICAgfQogICAgLyoqCiAgICAgKiBNdWx0aXBseSB0aGUgcXVhdGVybmlvbiBieSBhIHZlY3RvcgogICAgICovCgoKICAgIHZtdWx0KHYsIHRhcmdldCkgewogICAgICBpZiAodGFyZ2V0ID09PSB2b2lkIDApIHsKICAgICAgICB0YXJnZXQgPSBuZXcgVmVjMygpOwogICAgICB9CgogICAgICBjb25zdCB4ID0gdi54OwogICAgICBjb25zdCB5ID0gdi55OwogICAgICBjb25zdCB6ID0gdi56OwogICAgICBjb25zdCBxeCA9IHRoaXMueDsKICAgICAgY29uc3QgcXkgPSB0aGlzLnk7CiAgICAgIGNvbnN0IHF6ID0gdGhpcy56OwogICAgICBjb25zdCBxdyA9IHRoaXMudzsgLy8gcSp2CgogICAgICBjb25zdCBpeCA9IHF3ICogeCArIHF5ICogeiAtIHF6ICogeTsKICAgICAgY29uc3QgaXkgPSBxdyAqIHkgKyBxeiAqIHggLSBxeCAqIHo7CiAgICAgIGNvbnN0IGl6ID0gcXcgKiB6ICsgcXggKiB5IC0gcXkgKiB4OwogICAgICBjb25zdCBpdyA9IC1xeCAqIHggLSBxeSAqIHkgLSBxeiAqIHo7CiAgICAgIHRhcmdldC54ID0gaXggKiBxdyArIGl3ICogLXF4ICsgaXkgKiAtcXogLSBpeiAqIC1xeTsKICAgICAgdGFyZ2V0LnkgPSBpeSAqIHF3ICsgaXcgKiAtcXkgKyBpeiAqIC1xeCAtIGl4ICogLXF6OwogICAgICB0YXJnZXQueiA9IGl6ICogcXcgKyBpdyAqIC1xeiArIGl4ICogLXF5IC0gaXkgKiAtcXg7CiAgICAgIHJldHVybiB0YXJnZXQ7CiAgICB9CiAgICAvKioKICAgICAqIENvcGllcyB2YWx1ZSBvZiBzb3VyY2UgdG8gdGhpcyBxdWF0ZXJuaW9uLgogICAgICogQHJldHVybiB0aGlzCiAgICAgKi8KCgogICAgY29weShxdWF0KSB7CiAgICAgIHRoaXMueCA9IHF1YXQueDsKICAgICAgdGhpcy55ID0gcXVhdC55OwogICAgICB0aGlzLnogPSBxdWF0Lno7CiAgICAgIHRoaXMudyA9IHF1YXQudzsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICAvKioKICAgICAqIENvbnZlcnQgdGhlIHF1YXRlcm5pb24gdG8gZXVsZXIgYW5nbGUgcmVwcmVzZW50YXRpb24uIE9yZGVyOiBZWlgsIGFzIHRoaXMgcGFnZSBkZXNjcmliZXM6IGh0dHBzOi8vd3d3LmV1Y2xpZGVhbnNwYWNlLmNvbS9tYXRocy9zdGFuZGFyZHMvaW5kZXguaHRtCiAgICAgKiBAcGFyYW0gb3JkZXIgVGhyZWUtY2hhcmFjdGVyIHN0cmluZywgZGVmYXVsdHMgdG8gIllaWCIKICAgICAqLwoKCiAgICB0b0V1bGVyKHRhcmdldCwgb3JkZXIpIHsKICAgICAgaWYgKG9yZGVyID09PSB2b2lkIDApIHsKICAgICAgICBvcmRlciA9ICdZWlgnOwogICAgICB9CgogICAgICBsZXQgaGVhZGluZzsKICAgICAgbGV0IGF0dGl0dWRlOwogICAgICBsZXQgYmFuazsKICAgICAgY29uc3QgeCA9IHRoaXMueDsKICAgICAgY29uc3QgeSA9IHRoaXMueTsKICAgICAgY29uc3QgeiA9IHRoaXMuejsKICAgICAgY29uc3QgdyA9IHRoaXMudzsKCiAgICAgIHN3aXRjaCAob3JkZXIpIHsKICAgICAgICBjYXNlICdZWlgnOgogICAgICAgICAgY29uc3QgdGVzdCA9IHggKiB5ICsgeiAqIHc7CgogICAgICAgICAgaWYgKHRlc3QgPiAwLjQ5OSkgewogICAgICAgICAgICAvLyBzaW5ndWxhcml0eSBhdCBub3J0aCBwb2xlCiAgICAgICAgICAgIGhlYWRpbmcgPSAyICogTWF0aC5hdGFuMih4LCB3KTsKICAgICAgICAgICAgYXR0aXR1ZGUgPSBNYXRoLlBJIC8gMjsKICAgICAgICAgICAgYmFuayA9IDA7CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKHRlc3QgPCAtMC40OTkpIHsKICAgICAgICAgICAgLy8gc2luZ3VsYXJpdHkgYXQgc291dGggcG9sZQogICAgICAgICAgICBoZWFkaW5nID0gLTIgKiBNYXRoLmF0YW4yKHgsIHcpOwogICAgICAgICAgICBhdHRpdHVkZSA9IC1NYXRoLlBJIC8gMjsKICAgICAgICAgICAgYmFuayA9IDA7CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKGhlYWRpbmcgPT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICBjb25zdCBzcXggPSB4ICogeDsKICAgICAgICAgICAgY29uc3Qgc3F5ID0geSAqIHk7CiAgICAgICAgICAgIGNvbnN0IHNxeiA9IHogKiB6OwogICAgICAgICAgICBoZWFkaW5nID0gTWF0aC5hdGFuMigyICogeSAqIHcgLSAyICogeCAqIHosIDEgLSAyICogc3F5IC0gMiAqIHNxeik7IC8vIEhlYWRpbmcKCiAgICAgICAgICAgIGF0dGl0dWRlID0gTWF0aC5hc2luKDIgKiB0ZXN0KTsgLy8gYXR0aXR1ZGUKCiAgICAgICAgICAgIGJhbmsgPSBNYXRoLmF0YW4yKDIgKiB4ICogdyAtIDIgKiB5ICogeiwgMSAtIDIgKiBzcXggLSAyICogc3F6KTsgLy8gYmFuawogICAgICAgICAgfQoKICAgICAgICAgIGJyZWFrOwoKICAgICAgICBkZWZhdWx0OgogICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBFdWxlciBvcmRlciAke29yZGVyfSBub3Qgc3VwcG9ydGVkIHlldC5gKTsKICAgICAgfQoKICAgICAgdGFyZ2V0LnkgPSBoZWFkaW5nOwogICAgICB0YXJnZXQueiA9IGF0dGl0dWRlOwogICAgICB0YXJnZXQueCA9IGJhbms7CiAgICB9CiAgICAvKioKICAgICAqIFNldCB0aGUgcXVhdGVybmlvbiBjb21wb25lbnRzIGdpdmVuIEV1bGVyIGFuZ2xlIHJlcHJlc2VudGF0aW9uLgogICAgICoKICAgICAqIEBwYXJhbSBvcmRlciBUaGUgb3JkZXIgdG8gYXBwbHkgYW5nbGVzOiAnWFlaJyBvciAnWVhaJyBvciBhbnkgb3RoZXIgY29tYmluYXRpb24uCiAgICAgKgogICAgICogU2VlIHtAbGluayBodHRwczovL3d3dy5tYXRod29ya3MuY29tL21hdGxhYmNlbnRyYWwvZmlsZWV4Y2hhbmdlLzIwNjk2LWZ1bmN0aW9uLXRvLWNvbnZlcnQtYmV0d2Vlbi1kY20tZXVsZXItYW5nbGVzLXF1YXRlcm5pb25zLWFuZC1ldWxlci12ZWN0b3JzIE1hdGhXb3Jrc30gcmVmZXJlbmNlCiAgICAgKi8KCgogICAgc2V0RnJvbUV1bGVyKHgsIHksIHosIG9yZGVyKSB7CiAgICAgIGlmIChvcmRlciA9PT0gdm9pZCAwKSB7CiAgICAgICAgb3JkZXIgPSAnWFlaJzsKICAgICAgfQoKICAgICAgY29uc3QgYzEgPSBNYXRoLmNvcyh4IC8gMik7CiAgICAgIGNvbnN0IGMyID0gTWF0aC5jb3MoeSAvIDIpOwogICAgICBjb25zdCBjMyA9IE1hdGguY29zKHogLyAyKTsKICAgICAgY29uc3QgczEgPSBNYXRoLnNpbih4IC8gMik7CiAgICAgIGNvbnN0IHMyID0gTWF0aC5zaW4oeSAvIDIpOwogICAgICBjb25zdCBzMyA9IE1hdGguc2luKHogLyAyKTsKCiAgICAgIGlmIChvcmRlciA9PT0gJ1hZWicpIHsKICAgICAgICB0aGlzLnggPSBzMSAqIGMyICogYzMgKyBjMSAqIHMyICogczM7CiAgICAgICAgdGhpcy55ID0gYzEgKiBzMiAqIGMzIC0gczEgKiBjMiAqIHMzOwogICAgICAgIHRoaXMueiA9IGMxICogYzIgKiBzMyArIHMxICogczIgKiBjMzsKICAgICAgICB0aGlzLncgPSBjMSAqIGMyICogYzMgLSBzMSAqIHMyICogczM7CiAgICAgIH0gZWxzZSBpZiAob3JkZXIgPT09ICdZWFonKSB7CiAgICAgICAgdGhpcy54ID0gczEgKiBjMiAqIGMzICsgYzEgKiBzMiAqIHMzOwogICAgICAgIHRoaXMueSA9IGMxICogczIgKiBjMyAtIHMxICogYzIgKiBzMzsKICAgICAgICB0aGlzLnogPSBjMSAqIGMyICogczMgLSBzMSAqIHMyICogYzM7CiAgICAgICAgdGhpcy53ID0gYzEgKiBjMiAqIGMzICsgczEgKiBzMiAqIHMzOwogICAgICB9IGVsc2UgaWYgKG9yZGVyID09PSAnWlhZJykgewogICAgICAgIHRoaXMueCA9IHMxICogYzIgKiBjMyAtIGMxICogczIgKiBzMzsKICAgICAgICB0aGlzLnkgPSBjMSAqIHMyICogYzMgKyBzMSAqIGMyICogczM7CiAgICAgICAgdGhpcy56ID0gYzEgKiBjMiAqIHMzICsgczEgKiBzMiAqIGMzOwogICAgICAgIHRoaXMudyA9IGMxICogYzIgKiBjMyAtIHMxICogczIgKiBzMzsKICAgICAgfSBlbHNlIGlmIChvcmRlciA9PT0gJ1pZWCcpIHsKICAgICAgICB0aGlzLnggPSBzMSAqIGMyICogYzMgLSBjMSAqIHMyICogczM7CiAgICAgICAgdGhpcy55ID0gYzEgKiBzMiAqIGMzICsgczEgKiBjMiAqIHMzOwogICAgICAgIHRoaXMueiA9IGMxICogYzIgKiBzMyAtIHMxICogczIgKiBjMzsKICAgICAgICB0aGlzLncgPSBjMSAqIGMyICogYzMgKyBzMSAqIHMyICogczM7CiAgICAgIH0gZWxzZSBpZiAob3JkZXIgPT09ICdZWlgnKSB7CiAgICAgICAgdGhpcy54ID0gczEgKiBjMiAqIGMzICsgYzEgKiBzMiAqIHMzOwogICAgICAgIHRoaXMueSA9IGMxICogczIgKiBjMyArIHMxICogYzIgKiBzMzsKICAgICAgICB0aGlzLnogPSBjMSAqIGMyICogczMgLSBzMSAqIHMyICogYzM7CiAgICAgICAgdGhpcy53ID0gYzEgKiBjMiAqIGMzIC0gczEgKiBzMiAqIHMzOwogICAgICB9IGVsc2UgaWYgKG9yZGVyID09PSAnWFpZJykgewogICAgICAgIHRoaXMueCA9IHMxICogYzIgKiBjMyAtIGMxICogczIgKiBzMzsKICAgICAgICB0aGlzLnkgPSBjMSAqIHMyICogYzMgLSBzMSAqIGMyICogczM7CiAgICAgICAgdGhpcy56ID0gYzEgKiBjMiAqIHMzICsgczEgKiBzMiAqIGMzOwogICAgICAgIHRoaXMudyA9IGMxICogYzIgKiBjMyArIHMxICogczIgKiBzMzsKICAgICAgfQoKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CgogICAgY2xvbmUoKSB7CiAgICAgIHJldHVybiBuZXcgUXVhdGVybmlvbih0aGlzLngsIHRoaXMueSwgdGhpcy56LCB0aGlzLncpOwogICAgfQogICAgLyoqCiAgICAgKiBQZXJmb3JtcyBhIHNwaGVyaWNhbCBsaW5lYXIgaW50ZXJwb2xhdGlvbiBiZXR3ZWVuIHR3byBxdWF0CiAgICAgKgogICAgICogQHBhcmFtIHRvUXVhdCBzZWNvbmQgb3BlcmFuZAogICAgICogQHBhcmFtIHQgaW50ZXJwb2xhdGlvbiBhbW91bnQgYmV0d2VlbiB0aGUgc2VsZiBxdWF0ZXJuaW9uIGFuZCB0b1F1YXQKICAgICAqIEBwYXJhbSB0YXJnZXQgQSBxdWF0ZXJuaW9uIHRvIHN0b3JlIHRoZSByZXN1bHQgaW4uIElmIG5vdCBwcm92aWRlZCwgYSBuZXcgb25lIHdpbGwgYmUgY3JlYXRlZC4KICAgICAqIEByZXR1cm5zIHtRdWF0ZXJuaW9ufSBUaGUgInRhcmdldCIgb2JqZWN0CiAgICAgKi8KCgogICAgc2xlcnAodG9RdWF0LCB0LCB0YXJnZXQpIHsKICAgICAgaWYgKHRhcmdldCA9PT0gdm9pZCAwKSB7CiAgICAgICAgdGFyZ2V0ID0gbmV3IFF1YXRlcm5pb24oKTsKICAgICAgfQoKICAgICAgY29uc3QgYXggPSB0aGlzLng7CiAgICAgIGNvbnN0IGF5ID0gdGhpcy55OwogICAgICBjb25zdCBheiA9IHRoaXMuejsKICAgICAgY29uc3QgYXcgPSB0aGlzLnc7CiAgICAgIGxldCBieCA9IHRvUXVhdC54OwogICAgICBsZXQgYnkgPSB0b1F1YXQueTsKICAgICAgbGV0IGJ6ID0gdG9RdWF0Lno7CiAgICAgIGxldCBidyA9IHRvUXVhdC53OwogICAgICBsZXQgb21lZ2E7CiAgICAgIGxldCBjb3NvbTsKICAgICAgbGV0IHNpbm9tOwogICAgICBsZXQgc2NhbGUwOwogICAgICBsZXQgc2NhbGUxOyAvLyBjYWxjIGNvc2luZQoKICAgICAgY29zb20gPSBheCAqIGJ4ICsgYXkgKiBieSArIGF6ICogYnogKyBhdyAqIGJ3OyAvLyBhZGp1c3Qgc2lnbnMgKGlmIG5lY2Vzc2FyeSkKCiAgICAgIGlmIChjb3NvbSA8IDAuMCkgewogICAgICAgIGNvc29tID0gLWNvc29tOwogICAgICAgIGJ4ID0gLWJ4OwogICAgICAgIGJ5ID0gLWJ5OwogICAgICAgIGJ6ID0gLWJ6OwogICAgICAgIGJ3ID0gLWJ3OwogICAgICB9IC8vIGNhbGN1bGF0ZSBjb2VmZmljaWVudHMKCgogICAgICBpZiAoMS4wIC0gY29zb20gPiAwLjAwMDAwMSkgewogICAgICAgIC8vIHN0YW5kYXJkIGNhc2UgKHNsZXJwKQogICAgICAgIG9tZWdhID0gTWF0aC5hY29zKGNvc29tKTsKICAgICAgICBzaW5vbSA9IE1hdGguc2luKG9tZWdhKTsKICAgICAgICBzY2FsZTAgPSBNYXRoLnNpbigoMS4wIC0gdCkgKiBvbWVnYSkgLyBzaW5vbTsKICAgICAgICBzY2FsZTEgPSBNYXRoLnNpbih0ICogb21lZ2EpIC8gc2lub207CiAgICAgIH0gZWxzZSB7CiAgICAgICAgLy8gImZyb20iIGFuZCAidG8iIHF1YXRlcm5pb25zIGFyZSB2ZXJ5IGNsb3NlCiAgICAgICAgLy8gIC4uLiBzbyB3ZSBjYW4gZG8gYSBsaW5lYXIgaW50ZXJwb2xhdGlvbgogICAgICAgIHNjYWxlMCA9IDEuMCAtIHQ7CiAgICAgICAgc2NhbGUxID0gdDsKICAgICAgfSAvLyBjYWxjdWxhdGUgZmluYWwgdmFsdWVzCgoKICAgICAgdGFyZ2V0LnggPSBzY2FsZTAgKiBheCArIHNjYWxlMSAqIGJ4OwogICAgICB0YXJnZXQueSA9IHNjYWxlMCAqIGF5ICsgc2NhbGUxICogYnk7CiAgICAgIHRhcmdldC56ID0gc2NhbGUwICogYXogKyBzY2FsZTEgKiBiejsKICAgICAgdGFyZ2V0LncgPSBzY2FsZTAgKiBhdyArIHNjYWxlMSAqIGJ3OwogICAgICByZXR1cm4gdGFyZ2V0OwogICAgfQogICAgLyoqCiAgICAgKiBSb3RhdGUgYW4gYWJzb2x1dGUgb3JpZW50YXRpb24gcXVhdGVybmlvbiBnaXZlbiBhbiBhbmd1bGFyIHZlbG9jaXR5IGFuZCBhIHRpbWUgc3RlcC4KICAgICAqLwoKCiAgICBpbnRlZ3JhdGUoYW5ndWxhclZlbG9jaXR5LCBkdCwgYW5ndWxhckZhY3RvciwgdGFyZ2V0KSB7CiAgICAgIGlmICh0YXJnZXQgPT09IHZvaWQgMCkgewogICAgICAgIHRhcmdldCA9IG5ldyBRdWF0ZXJuaW9uKCk7CiAgICAgIH0KCiAgICAgIGNvbnN0IGF4ID0gYW5ndWxhclZlbG9jaXR5LnggKiBhbmd1bGFyRmFjdG9yLngsCiAgICAgICAgICAgIGF5ID0gYW5ndWxhclZlbG9jaXR5LnkgKiBhbmd1bGFyRmFjdG9yLnksCiAgICAgICAgICAgIGF6ID0gYW5ndWxhclZlbG9jaXR5LnogKiBhbmd1bGFyRmFjdG9yLnosCiAgICAgICAgICAgIGJ4ID0gdGhpcy54LAogICAgICAgICAgICBieSA9IHRoaXMueSwKICAgICAgICAgICAgYnogPSB0aGlzLnosCiAgICAgICAgICAgIGJ3ID0gdGhpcy53OwogICAgICBjb25zdCBoYWxmX2R0ID0gZHQgKiAwLjU7CiAgICAgIHRhcmdldC54ICs9IGhhbGZfZHQgKiAoYXggKiBidyArIGF5ICogYnogLSBheiAqIGJ5KTsKICAgICAgdGFyZ2V0LnkgKz0gaGFsZl9kdCAqIChheSAqIGJ3ICsgYXogKiBieCAtIGF4ICogYnopOwogICAgICB0YXJnZXQueiArPSBoYWxmX2R0ICogKGF6ICogYncgKyBheCAqIGJ5IC0gYXkgKiBieCk7CiAgICAgIHRhcmdldC53ICs9IGhhbGZfZHQgKiAoLWF4ICogYnggLSBheSAqIGJ5IC0gYXogKiBieik7CiAgICAgIHJldHVybiB0YXJnZXQ7CiAgICB9CgogIH0KICBjb25zdCBzZnZfdDEgPSBuZXcgVmVjMygpOwogIGNvbnN0IHNmdl90MiA9IG5ldyBWZWMzKCk7CgogIC8qKgogICAqIFRoZSBhdmFpbGFibGUgc2hhcGUgdHlwZXMuCiAgICovCiAgY29uc3QgU0hBUEVfVFlQRVMgPSB7CiAgICAvKiogU1BIRVJFICovCiAgICBTUEhFUkU6IDEsCgogICAgLyoqIFBMQU5FICovCiAgICBQTEFORTogMiwKCiAgICAvKiogQk9YICovCiAgICBCT1g6IDQsCgogICAgLyoqIENPTVBPVU5EICovCiAgICBDT01QT1VORDogOCwKCiAgICAvKiogQ09OVkVYUE9MWUhFRFJPTiAqLwogICAgQ09OVkVYUE9MWUhFRFJPTjogMTYsCgogICAgLyoqIEhFSUdIVEZJRUxEICovCiAgICBIRUlHSFRGSUVMRDogMzIsCgogICAgLyoqIFBBUlRJQ0xFICovCiAgICBQQVJUSUNMRTogNjQsCgogICAgLyoqIENZTElOREVSICovCiAgICBDWUxJTkRFUjogMTI4LAoKICAgIC8qKiBUUklNRVNIICovCiAgICBUUklNRVNIOiAyNTYKICB9OwogIC8qKgogICAqIFNoYXBlVHlwZQogICAqLwoKICAvKioKICAgKiBCYXNlIGNsYXNzIGZvciBzaGFwZXMKICAgKi8KICBjbGFzcyBTaGFwZSB7CiAgICAvKioKICAgICAqIElkZW50aWZpZXIgb2YgdGhlIFNoYXBlLgogICAgICovCgogICAgLyoqCiAgICAgKiBUaGUgdHlwZSBvZiB0aGlzIHNoYXBlLiBNdXN0IGJlIHNldCB0byBhbiBpbnQgPiAwIGJ5IHN1YmNsYXNzZXMuCiAgICAgKi8KCiAgICAvKioKICAgICAqIFRoZSBsb2NhbCBib3VuZGluZyBzcGhlcmUgcmFkaXVzIG9mIHRoaXMgc2hhcGUuCiAgICAgKi8KCiAgICAvKioKICAgICAqIFdoZXRoZXIgdG8gcHJvZHVjZSBjb250YWN0IGZvcmNlcyB3aGVuIGluIGNvbnRhY3Qgd2l0aCBvdGhlciBib2RpZXMuIE5vdGUgdGhhdCBjb250YWN0cyB3aWxsIGJlIGdlbmVyYXRlZCwgYnV0IHRoZXkgd2lsbCBiZSBkaXNhYmxlZC4KICAgICAqIEBkZWZhdWx0IHRydWUKICAgICAqLwoKICAgIC8qKgogICAgICogQGRlZmF1bHQgMQogICAgICovCgogICAgLyoqCiAgICAgKiBAZGVmYXVsdCAtMQogICAgICovCgogICAgLyoqCiAgICAgKiBPcHRpb25hbCBtYXRlcmlhbCBvZiB0aGUgc2hhcGUgdGhhdCByZWd1bGF0ZXMgY29udGFjdCBwcm9wZXJ0aWVzLgogICAgICovCgogICAgLyoqCiAgICAgKiBUaGUgYm9keSB0byB3aGljaCB0aGUgc2hhcGUgaXMgYWRkZWQgdG8uCiAgICAgKi8KCiAgICAvKioKICAgICAqIEFsbCB0aGUgU2hhcGUgdHlwZXMuCiAgICAgKi8KICAgIGNvbnN0cnVjdG9yKG9wdGlvbnMpIHsKICAgICAgaWYgKG9wdGlvbnMgPT09IHZvaWQgMCkgewogICAgICAgIG9wdGlvbnMgPSB7fTsKICAgICAgfQoKICAgICAgdGhpcy5pZCA9IFNoYXBlLmlkQ291bnRlcisrOwogICAgICB0aGlzLnR5cGUgPSBvcHRpb25zLnR5cGUgfHwgMDsKICAgICAgdGhpcy5ib3VuZGluZ1NwaGVyZVJhZGl1cyA9IDA7CiAgICAgIHRoaXMuY29sbGlzaW9uUmVzcG9uc2UgPSBvcHRpb25zLmNvbGxpc2lvblJlc3BvbnNlID8gb3B0aW9ucy5jb2xsaXNpb25SZXNwb25zZSA6IHRydWU7CiAgICAgIHRoaXMuY29sbGlzaW9uRmlsdGVyR3JvdXAgPSBvcHRpb25zLmNvbGxpc2lvbkZpbHRlckdyb3VwICE9PSB1bmRlZmluZWQgPyBvcHRpb25zLmNvbGxpc2lvbkZpbHRlckdyb3VwIDogMTsKICAgICAgdGhpcy5jb2xsaXNpb25GaWx0ZXJNYXNrID0gb3B0aW9ucy5jb2xsaXNpb25GaWx0ZXJNYXNrICE9PSB1bmRlZmluZWQgPyBvcHRpb25zLmNvbGxpc2lvbkZpbHRlck1hc2sgOiAtMTsKICAgICAgdGhpcy5tYXRlcmlhbCA9IG9wdGlvbnMubWF0ZXJpYWwgPyBvcHRpb25zLm1hdGVyaWFsIDogbnVsbDsKICAgICAgdGhpcy5ib2R5ID0gbnVsbDsKICAgIH0KICAgIC8qKgogICAgICogQ29tcHV0ZXMgdGhlIGJvdW5kaW5nIHNwaGVyZSByYWRpdXMuCiAgICAgKiBUaGUgcmVzdWx0IGlzIHN0b3JlZCBpbiB0aGUgcHJvcGVydHkgYC5ib3VuZGluZ1NwaGVyZVJhZGl1c2AKICAgICAqLwoKCiAgICB1cGRhdGVCb3VuZGluZ1NwaGVyZVJhZGl1cygpIHsKICAgICAgdGhyb3cgYGNvbXB1dGVCb3VuZGluZ1NwaGVyZVJhZGl1cygpIG5vdCBpbXBsZW1lbnRlZCBmb3Igc2hhcGUgdHlwZSAke3RoaXMudHlwZX1gOwogICAgfQogICAgLyoqCiAgICAgKiBHZXQgdGhlIHZvbHVtZSBvZiB0aGlzIHNoYXBlCiAgICAgKi8KCgogICAgdm9sdW1lKCkgewogICAgICB0aHJvdyBgdm9sdW1lKCkgbm90IGltcGxlbWVudGVkIGZvciBzaGFwZSB0eXBlICR7dGhpcy50eXBlfWA7CiAgICB9CiAgICAvKioKICAgICAqIENhbGN1bGF0ZXMgdGhlIGluZXJ0aWEgaW4gdGhlIGxvY2FsIGZyYW1lIGZvciB0aGlzIHNoYXBlLgogICAgICogQHNlZSBodHRwOi8vZW4ud2lraXBlZGlhLm9yZy93aWtpL0xpc3Rfb2ZfbW9tZW50c19vZl9pbmVydGlhCiAgICAgKi8KCgogICAgY2FsY3VsYXRlTG9jYWxJbmVydGlhKG1hc3MsIHRhcmdldCkgewogICAgICB0aHJvdyBgY2FsY3VsYXRlTG9jYWxJbmVydGlhKCkgbm90IGltcGxlbWVudGVkIGZvciBzaGFwZSB0eXBlICR7dGhpcy50eXBlfWA7CiAgICB9CiAgICAvKioKICAgICAqIEB0b2RvIHVzZSBhYnN0cmFjdCBmb3IgdGhlc2Uga2luZCBvZiBtZXRob2RzCiAgICAgKi8KCgogICAgY2FsY3VsYXRlV29ybGRBQUJCKHBvcywgcXVhdCwgbWluLCBtYXgpIHsKICAgICAgdGhyb3cgYGNhbGN1bGF0ZVdvcmxkQUFCQigpIG5vdCBpbXBsZW1lbnRlZCBmb3Igc2hhcGUgdHlwZSAke3RoaXMudHlwZX1gOwogICAgfQoKICB9CiAgU2hhcGUuaWRDb3VudGVyID0gMDsKICBTaGFwZS50eXBlcyA9IFNIQVBFX1RZUEVTOwoKICAvKioKICAgKiBUcmFuc2Zvcm1hdGlvbiB1dGlsaXRpZXMuCiAgICovCiAgY2xhc3MgVHJhbnNmb3JtIHsKICAgIC8qKgogICAgICogcG9zaXRpb24KICAgICAqLwoKICAgIC8qKgogICAgICogcXVhdGVybmlvbgogICAgICovCiAgICBjb25zdHJ1Y3RvcihvcHRpb25zKSB7CiAgICAgIGlmIChvcHRpb25zID09PSB2b2lkIDApIHsKICAgICAgICBvcHRpb25zID0ge307CiAgICAgIH0KCiAgICAgIHRoaXMucG9zaXRpb24gPSBuZXcgVmVjMygpOwogICAgICB0aGlzLnF1YXRlcm5pb24gPSBuZXcgUXVhdGVybmlvbigpOwoKICAgICAgaWYgKG9wdGlvbnMucG9zaXRpb24pIHsKICAgICAgICB0aGlzLnBvc2l0aW9uLmNvcHkob3B0aW9ucy5wb3NpdGlvbik7CiAgICAgIH0KCiAgICAgIGlmIChvcHRpb25zLnF1YXRlcm5pb24pIHsKICAgICAgICB0aGlzLnF1YXRlcm5pb24uY29weShvcHRpb25zLnF1YXRlcm5pb24pOwogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIEdldCBhIGdsb2JhbCBwb2ludCBpbiBsb2NhbCB0cmFuc2Zvcm0gY29vcmRpbmF0ZXMuCiAgICAgKi8KCgogICAgcG9pbnRUb0xvY2FsKHdvcmxkUG9pbnQsIHJlc3VsdCkgewogICAgICByZXR1cm4gVHJhbnNmb3JtLnBvaW50VG9Mb2NhbEZyYW1lKHRoaXMucG9zaXRpb24sIHRoaXMucXVhdGVybmlvbiwgd29ybGRQb2ludCwgcmVzdWx0KTsKICAgIH0KICAgIC8qKgogICAgICogR2V0IGEgbG9jYWwgcG9pbnQgaW4gZ2xvYmFsIHRyYW5zZm9ybSBjb29yZGluYXRlcy4KICAgICAqLwoKCiAgICBwb2ludFRvV29ybGQobG9jYWxQb2ludCwgcmVzdWx0KSB7CiAgICAgIHJldHVybiBUcmFuc2Zvcm0ucG9pbnRUb1dvcmxkRnJhbWUodGhpcy5wb3NpdGlvbiwgdGhpcy5xdWF0ZXJuaW9uLCBsb2NhbFBvaW50LCByZXN1bHQpOwogICAgfQogICAgLyoqCiAgICAgKiB2ZWN0b3JUb1dvcmxkRnJhbWUKICAgICAqLwoKCiAgICB2ZWN0b3JUb1dvcmxkRnJhbWUobG9jYWxWZWN0b3IsIHJlc3VsdCkgewogICAgICBpZiAocmVzdWx0ID09PSB2b2lkIDApIHsKICAgICAgICByZXN1bHQgPSBuZXcgVmVjMygpOwogICAgICB9CgogICAgICB0aGlzLnF1YXRlcm5pb24udm11bHQobG9jYWxWZWN0b3IsIHJlc3VsdCk7CiAgICAgIHJldHVybiByZXN1bHQ7CiAgICB9CiAgICAvKioKICAgICAqIHBvaW50VG9Mb2NhbEZyYW1lCiAgICAgKi8KCgogICAgc3RhdGljIHBvaW50VG9Mb2NhbEZyYW1lKHBvc2l0aW9uLCBxdWF0ZXJuaW9uLCB3b3JsZFBvaW50LCByZXN1bHQpIHsKICAgICAgaWYgKHJlc3VsdCA9PT0gdm9pZCAwKSB7CiAgICAgICAgcmVzdWx0ID0gbmV3IFZlYzMoKTsKICAgICAgfQoKICAgICAgd29ybGRQb2ludC52c3ViKHBvc2l0aW9uLCByZXN1bHQpOwogICAgICBxdWF0ZXJuaW9uLmNvbmp1Z2F0ZSh0bXBRdWF0JDEpOwogICAgICB0bXBRdWF0JDEudm11bHQocmVzdWx0LCByZXN1bHQpOwogICAgICByZXR1cm4gcmVzdWx0OwogICAgfQogICAgLyoqCiAgICAgKiBwb2ludFRvV29ybGRGcmFtZQogICAgICovCgoKICAgIHN0YXRpYyBwb2ludFRvV29ybGRGcmFtZShwb3NpdGlvbiwgcXVhdGVybmlvbiwgbG9jYWxQb2ludCwgcmVzdWx0KSB7CiAgICAgIGlmIChyZXN1bHQgPT09IHZvaWQgMCkgewogICAgICAgIHJlc3VsdCA9IG5ldyBWZWMzKCk7CiAgICAgIH0KCiAgICAgIHF1YXRlcm5pb24udm11bHQobG9jYWxQb2ludCwgcmVzdWx0KTsKICAgICAgcmVzdWx0LnZhZGQocG9zaXRpb24sIHJlc3VsdCk7CiAgICAgIHJldHVybiByZXN1bHQ7CiAgICB9CiAgICAvKioKICAgICAqIHZlY3RvclRvV29ybGRGcmFtZQogICAgICovCgoKICAgIHN0YXRpYyB2ZWN0b3JUb1dvcmxkRnJhbWUocXVhdGVybmlvbiwgbG9jYWxWZWN0b3IsIHJlc3VsdCkgewogICAgICBpZiAocmVzdWx0ID09PSB2b2lkIDApIHsKICAgICAgICByZXN1bHQgPSBuZXcgVmVjMygpOwogICAgICB9CgogICAgICBxdWF0ZXJuaW9uLnZtdWx0KGxvY2FsVmVjdG9yLCByZXN1bHQpOwogICAgICByZXR1cm4gcmVzdWx0OwogICAgfQogICAgLyoqCiAgICAgKiB2ZWN0b3JUb0xvY2FsRnJhbWUKICAgICAqLwoKCiAgICBzdGF0aWMgdmVjdG9yVG9Mb2NhbEZyYW1lKHBvc2l0aW9uLCBxdWF0ZXJuaW9uLCB3b3JsZFZlY3RvciwgcmVzdWx0KSB7CiAgICAgIGlmIChyZXN1bHQgPT09IHZvaWQgMCkgewogICAgICAgIHJlc3VsdCA9IG5ldyBWZWMzKCk7CiAgICAgIH0KCiAgICAgIHF1YXRlcm5pb24udyAqPSAtMTsKICAgICAgcXVhdGVybmlvbi52bXVsdCh3b3JsZFZlY3RvciwgcmVzdWx0KTsKICAgICAgcXVhdGVybmlvbi53ICo9IC0xOwogICAgICByZXR1cm4gcmVzdWx0OwogICAgfQoKICB9CiAgY29uc3QgdG1wUXVhdCQxID0gbmV3IFF1YXRlcm5pb24oKTsKCiAgLyoqCiAgICogQSBzZXQgb2YgcG9seWdvbnMgZGVzY3JpYmluZyBhIGNvbnZleCBzaGFwZS4KICAgKgogICAqIFRoZSBzaGFwZSBNVVNUIGJlIGNvbnZleCBmb3IgdGhlIGNvZGUgdG8gd29yayBwcm9wZXJseS4gTm8gcG9seWdvbnMgbWF5IGJlIGNvcGxhbmFyIChjb250YWluZWQKICAgKiBpbiB0aGUgc2FtZSAzRCBwbGFuZSksIGluc3RlYWQgdGhlc2Ugc2hvdWxkIGJlIG1lcmdlZCBpbnRvIG9uZSBwb2x5Z29uLgogICAqCiAgICogQGF1dGhvciBxaWFvIC8gaHR0cHM6Ly9naXRodWIuY29tL3FpYW8gKG9yaWdpbmFsIGF1dGhvciwgc2VlIGh0dHBzOi8vZ2l0aHViLmNvbS9xaWFvL3RocmVlLmpzL2NvbW1pdC84NTAyNmYwYzc2OWU0MDAwMTQ4YTY3ZDQ1YTllOWI5YzUxMDg4MzZmKQogICAqIEBhdXRob3Igc2NodGVwcGUgLyBodHRwczovL2dpdGh1Yi5jb20vc2NodGVwcGUKICAgKiBAc2VlIGh0dHBzOi8vd3d3LmFsdGRldmJsb2dhZGF5LmNvbS8yMDExLzA1LzEzL2NvbnRhY3QtZ2VuZXJhdGlvbi1iZXR3ZWVuLTNkLWNvbnZleC1tZXNoZXMvCiAgICoKICAgKiBAdG9kbyBNb3ZlIHRoZSBjbGlwcGluZyBmdW5jdGlvbnMgdG8gQ29udGFjdEdlbmVyYXRvcj8KICAgKiBAdG9kbyBBdXRvbWF0aWNhbGx5IG1lcmdlIGNvcGxhbmFyIHBvbHlnb25zIGluIGNvbnN0cnVjdG9yLgogICAqIEBleGFtcGxlCiAgICogICAgIGNvbnN0IGNvbnZleFNoYXBlID0gbmV3IENBTk5PTi5Db252ZXhQb2x5aGVkcm9uKHsgdmVydGljZXMsIGZhY2VzIH0pCiAgICogICAgIGNvbnN0IGNvbnZleEJvZHkgPSBuZXcgQ0FOTk9OLkJvZHkoeyBtYXNzOiAxLCBzaGFwZTogY29udmV4U2hhcGUgfSkKICAgKiAgICAgd29ybGQuYWRkQm9keShjb252ZXhCb2R5KQogICAqLwogIGNsYXNzIENvbnZleFBvbHloZWRyb24gZXh0ZW5kcyBTaGFwZSB7CiAgICAvKiogdmVydGljZXMgKi8KCiAgICAvKioKICAgICAqIEFycmF5IG9mIGludGVnZXIgYXJyYXlzLCBpbmRpY2F0aW5nIHdoaWNoIHZlcnRpY2VzIGVhY2ggZmFjZSBjb25zaXN0cyBvZgogICAgICovCgogICAgLyoqIGZhY2VOb3JtYWxzICovCgogICAgLyoqIHdvcmxkVmVydGljZXMgKi8KCiAgICAvKiogd29ybGRWZXJ0aWNlc05lZWRzVXBkYXRlICovCgogICAgLyoqIHdvcmxkRmFjZU5vcm1hbHMgKi8KCiAgICAvKiogd29ybGRGYWNlTm9ybWFsc05lZWRzVXBkYXRlICovCgogICAgLyoqCiAgICAgKiBJZiBnaXZlbiwgdGhlc2UgbG9jYWxseSBkZWZpbmVkLCBub3JtYWxpemVkIGF4ZXMgYXJlIHRoZSBvbmx5IG9uZXMgYmVpbmcgY2hlY2tlZCB3aGVuIGRvaW5nIHNlcGFyYXRpbmcgYXhpcyBjaGVjay4KICAgICAqLwoKICAgIC8qKiB1bmlxdWVFZGdlcyAqLwoKICAgIC8qKgogICAgICogQHBhcmFtIHZlcnRpY2VzIEFuIGFycmF5IG9mIFZlYzMncwogICAgICogQHBhcmFtIGZhY2VzIEFycmF5IG9mIGludGVnZXIgYXJyYXlzLCBkZXNjcmliaW5nIHdoaWNoIHZlcnRpY2VzIHRoYXQgaXMgaW5jbHVkZWQgaW4gZWFjaCBmYWNlLgogICAgICovCiAgICBjb25zdHJ1Y3Rvcihwcm9wcykgewogICAgICBpZiAocHJvcHMgPT09IHZvaWQgMCkgewogICAgICAgIHByb3BzID0ge307CiAgICAgIH0KCiAgICAgIGNvbnN0IHsKICAgICAgICB2ZXJ0aWNlcyA9IFtdLAogICAgICAgIGZhY2VzID0gW10sCiAgICAgICAgbm9ybWFscyA9IFtdLAogICAgICAgIGF4ZXMsCiAgICAgICAgYm91bmRpbmdTcGhlcmVSYWRpdXMKICAgICAgfSA9IHByb3BzOwogICAgICBzdXBlcih7CiAgICAgICAgdHlwZTogU2hhcGUudHlwZXMuQ09OVkVYUE9MWUhFRFJPTgogICAgICB9KTsKICAgICAgdGhpcy52ZXJ0aWNlcyA9IHZlcnRpY2VzOwogICAgICB0aGlzLmZhY2VzID0gZmFjZXM7CiAgICAgIHRoaXMuZmFjZU5vcm1hbHMgPSBub3JtYWxzOwoKICAgICAgaWYgKHRoaXMuZmFjZU5vcm1hbHMubGVuZ3RoID09PSAwKSB7CiAgICAgICAgdGhpcy5jb21wdXRlTm9ybWFscygpOwogICAgICB9CgogICAgICBpZiAoIWJvdW5kaW5nU3BoZXJlUmFkaXVzKSB7CiAgICAgICAgdGhpcy51cGRhdGVCb3VuZGluZ1NwaGVyZVJhZGl1cygpOwogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMuYm91bmRpbmdTcGhlcmVSYWRpdXMgPSBib3VuZGluZ1NwaGVyZVJhZGl1czsKICAgICAgfQoKICAgICAgdGhpcy53b3JsZFZlcnRpY2VzID0gW107IC8vIFdvcmxkIHRyYW5zZm9ybWVkIHZlcnNpb24gb2YgLnZlcnRpY2VzCgogICAgICB0aGlzLndvcmxkVmVydGljZXNOZWVkc1VwZGF0ZSA9IHRydWU7CiAgICAgIHRoaXMud29ybGRGYWNlTm9ybWFscyA9IFtdOyAvLyBXb3JsZCB0cmFuc2Zvcm1lZCB2ZXJzaW9uIG9mIC5mYWNlTm9ybWFscwoKICAgICAgdGhpcy53b3JsZEZhY2VOb3JtYWxzTmVlZHNVcGRhdGUgPSB0cnVlOwogICAgICB0aGlzLnVuaXF1ZUF4ZXMgPSBheGVzID8gYXhlcy5zbGljZSgpIDogbnVsbDsKICAgICAgdGhpcy51bmlxdWVFZGdlcyA9IFtdOwogICAgICB0aGlzLmNvbXB1dGVFZGdlcygpOwogICAgfQogICAgLyoqCiAgICAgKiBDb21wdXRlcyB1bmlxdWVFZGdlcwogICAgICovCgoKICAgIGNvbXB1dGVFZGdlcygpIHsKICAgICAgY29uc3QgZmFjZXMgPSB0aGlzLmZhY2VzOwogICAgICBjb25zdCB2ZXJ0aWNlcyA9IHRoaXMudmVydGljZXM7CiAgICAgIGNvbnN0IGVkZ2VzID0gdGhpcy51bmlxdWVFZGdlczsKICAgICAgZWRnZXMubGVuZ3RoID0gMDsKICAgICAgY29uc3QgZWRnZSA9IG5ldyBWZWMzKCk7CgogICAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gZmFjZXMubGVuZ3RoOyBpKyspIHsKICAgICAgICBjb25zdCBmYWNlID0gZmFjZXNbaV07CiAgICAgICAgY29uc3QgbnVtVmVydGljZXMgPSBmYWNlLmxlbmd0aDsKCiAgICAgICAgZm9yIChsZXQgaiA9IDA7IGogIT09IG51bVZlcnRpY2VzOyBqKyspIHsKICAgICAgICAgIGNvbnN0IGsgPSAoaiArIDEpICUgbnVtVmVydGljZXM7CiAgICAgICAgICB2ZXJ0aWNlc1tmYWNlW2pdXS52c3ViKHZlcnRpY2VzW2ZhY2Vba11dLCBlZGdlKTsKICAgICAgICAgIGVkZ2Uubm9ybWFsaXplKCk7CiAgICAgICAgICBsZXQgZm91bmQgPSBmYWxzZTsKCiAgICAgICAgICBmb3IgKGxldCBwID0gMDsgcCAhPT0gZWRnZXMubGVuZ3RoOyBwKyspIHsKICAgICAgICAgICAgaWYgKGVkZ2VzW3BdLmFsbW9zdEVxdWFscyhlZGdlKSB8fCBlZGdlc1twXS5hbG1vc3RFcXVhbHMoZWRnZSkpIHsKICAgICAgICAgICAgICBmb3VuZCA9IHRydWU7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KCiAgICAgICAgICBpZiAoIWZvdW5kKSB7CiAgICAgICAgICAgIGVkZ2VzLnB1c2goZWRnZS5jbG9uZSgpKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogQ29tcHV0ZSB0aGUgbm9ybWFscyBvZiB0aGUgZmFjZXMuCiAgICAgKiBXaWxsIHJldXNlIGV4aXN0aW5nIFZlYzMgb2JqZWN0cyBpbiB0aGUgYGZhY2VOb3JtYWxzYCBhcnJheSBpZiB0aGV5IGV4aXN0LgogICAgICovCgoKICAgIGNvbXB1dGVOb3JtYWxzKCkgewogICAgICB0aGlzLmZhY2VOb3JtYWxzLmxlbmd0aCA9IHRoaXMuZmFjZXMubGVuZ3RoOyAvLyBHZW5lcmF0ZSBub3JtYWxzCgogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMuZmFjZXMubGVuZ3RoOyBpKyspIHsKICAgICAgICAvLyBDaGVjayBzbyBhbGwgdmVydGljZXMgZXhpc3RzIGZvciB0aGlzIGZhY2UKICAgICAgICBmb3IgKGxldCBqID0gMDsgaiA8IHRoaXMuZmFjZXNbaV0ubGVuZ3RoOyBqKyspIHsKICAgICAgICAgIGlmICghdGhpcy52ZXJ0aWNlc1t0aGlzLmZhY2VzW2ldW2pdXSkgewogICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYFZlcnRleCAke3RoaXMuZmFjZXNbaV1bal19IG5vdCBmb3VuZCFgKTsKICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGNvbnN0IG4gPSB0aGlzLmZhY2VOb3JtYWxzW2ldIHx8IG5ldyBWZWMzKCk7CiAgICAgICAgdGhpcy5nZXRGYWNlTm9ybWFsKGksIG4pOwogICAgICAgIG4ubmVnYXRlKG4pOwogICAgICAgIHRoaXMuZmFjZU5vcm1hbHNbaV0gPSBuOwogICAgICAgIGNvbnN0IHZlcnRleCA9IHRoaXMudmVydGljZXNbdGhpcy5mYWNlc1tpXVswXV07CgogICAgICAgIGlmIChuLmRvdCh2ZXJ0ZXgpIDwgMCkgewogICAgICAgICAgY29uc29sZS5lcnJvcihgLmZhY2VOb3JtYWxzWyR7aX1dID0gVmVjMygke24udG9TdHJpbmcoKX0pIGxvb2tzIGxpa2UgaXQgcG9pbnRzIGludG8gdGhlIHNoYXBlPyBUaGUgdmVydGljZXMgZm9sbG93LiBNYWtlIHN1cmUgdGhleSBhcmUgb3JkZXJlZCBDQ1cgYXJvdW5kIHRoZSBub3JtYWwsIHVzaW5nIHRoZSByaWdodCBoYW5kIHJ1bGUuYCk7CgogICAgICAgICAgZm9yIChsZXQgaiA9IDA7IGogPCB0aGlzLmZhY2VzW2ldLmxlbmd0aDsgaisrKSB7CiAgICAgICAgICAgIGNvbnNvbGUud2FybihgLnZlcnRpY2VzWyR7dGhpcy5mYWNlc1tpXVtqXX1dID0gVmVjMygke3RoaXMudmVydGljZXNbdGhpcy5mYWNlc1tpXVtqXV0udG9TdHJpbmcoKX0pYCk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIENvbXB1dGUgdGhlIG5vcm1hbCBvZiBhIGZhY2UgZnJvbSBpdHMgdmVydGljZXMKICAgICAqLwoKCiAgICBnZXRGYWNlTm9ybWFsKGksIHRhcmdldCkgewogICAgICBjb25zdCBmID0gdGhpcy5mYWNlc1tpXTsKICAgICAgY29uc3QgdmEgPSB0aGlzLnZlcnRpY2VzW2ZbMF1dOwogICAgICBjb25zdCB2YiA9IHRoaXMudmVydGljZXNbZlsxXV07CiAgICAgIGNvbnN0IHZjID0gdGhpcy52ZXJ0aWNlc1tmWzJdXTsKICAgICAgQ29udmV4UG9seWhlZHJvbi5jb21wdXRlTm9ybWFsKHZhLCB2YiwgdmMsIHRhcmdldCk7CiAgICB9CiAgICAvKioKICAgICAqIEdldCBmYWNlIG5vcm1hbCBnaXZlbiAzIHZlcnRpY2VzCiAgICAgKi8KCgogICAgc3RhdGljIGNvbXB1dGVOb3JtYWwodmEsIHZiLCB2YywgdGFyZ2V0KSB7CiAgICAgIGNvbnN0IGNiID0gbmV3IFZlYzMoKTsKICAgICAgY29uc3QgYWIgPSBuZXcgVmVjMygpOwogICAgICB2Yi52c3ViKHZhLCBhYik7CiAgICAgIHZjLnZzdWIodmIsIGNiKTsKICAgICAgY2IuY3Jvc3MoYWIsIHRhcmdldCk7CgogICAgICBpZiAoIXRhcmdldC5pc1plcm8oKSkgewogICAgICAgIHRhcmdldC5ub3JtYWxpemUoKTsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBAcGFyYW0gbWluRGlzdCBDbGFtcCBkaXN0YW5jZQogICAgICogQHBhcmFtIHJlc3VsdCBUaGUgYW4gYXJyYXkgb2YgY29udGFjdCBwb2ludCBvYmplY3RzLCBzZWUgY2xpcEZhY2VBZ2FpbnN0SHVsbAogICAgICovCgoKICAgIGNsaXBBZ2FpbnN0SHVsbChwb3NBLCBxdWF0QSwgaHVsbEIsIHBvc0IsIHF1YXRCLCBzZXBhcmF0aW5nTm9ybWFsLCBtaW5EaXN0LCBtYXhEaXN0LCByZXN1bHQpIHsKICAgICAgY29uc3QgV29ybGROb3JtYWwgPSBuZXcgVmVjMygpOwogICAgICBsZXQgY2xvc2VzdEZhY2VCID0gLTE7CiAgICAgIGxldCBkbWF4ID0gLU51bWJlci5NQVhfVkFMVUU7CgogICAgICBmb3IgKGxldCBmYWNlID0gMDsgZmFjZSA8IGh1bGxCLmZhY2VzLmxlbmd0aDsgZmFjZSsrKSB7CiAgICAgICAgV29ybGROb3JtYWwuY29weShodWxsQi5mYWNlTm9ybWFsc1tmYWNlXSk7CiAgICAgICAgcXVhdEIudm11bHQoV29ybGROb3JtYWwsIFdvcmxkTm9ybWFsKTsKICAgICAgICBjb25zdCBkID0gV29ybGROb3JtYWwuZG90KHNlcGFyYXRpbmdOb3JtYWwpOwoKICAgICAgICBpZiAoZCA+IGRtYXgpIHsKICAgICAgICAgIGRtYXggPSBkOwogICAgICAgICAgY2xvc2VzdEZhY2VCID0gZmFjZTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIGNvbnN0IHdvcmxkVmVydHNCMSA9IFtdOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBodWxsQi5mYWNlc1tjbG9zZXN0RmFjZUJdLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgY29uc3QgYiA9IGh1bGxCLnZlcnRpY2VzW2h1bGxCLmZhY2VzW2Nsb3Nlc3RGYWNlQl1baV1dOwogICAgICAgIGNvbnN0IHdvcmxkYiA9IG5ldyBWZWMzKCk7CiAgICAgICAgd29ybGRiLmNvcHkoYik7CiAgICAgICAgcXVhdEIudm11bHQod29ybGRiLCB3b3JsZGIpOwogICAgICAgIHBvc0IudmFkZCh3b3JsZGIsIHdvcmxkYik7CiAgICAgICAgd29ybGRWZXJ0c0IxLnB1c2god29ybGRiKTsKICAgICAgfQoKICAgICAgaWYgKGNsb3Nlc3RGYWNlQiA+PSAwKSB7CiAgICAgICAgdGhpcy5jbGlwRmFjZUFnYWluc3RIdWxsKHNlcGFyYXRpbmdOb3JtYWwsIHBvc0EsIHF1YXRBLCB3b3JsZFZlcnRzQjEsIG1pbkRpc3QsIG1heERpc3QsIHJlc3VsdCk7CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogRmluZCB0aGUgc2VwYXJhdGluZyBheGlzIGJldHdlZW4gdGhpcyBodWxsIGFuZCBhbm90aGVyCiAgICAgKiBAcGFyYW0gdGFyZ2V0IFRoZSB0YXJnZXQgdmVjdG9yIHRvIHNhdmUgdGhlIGF4aXMgaW4KICAgICAqIEByZXR1cm4gUmV0dXJucyBmYWxzZSBpZiBhIHNlcGFyYXRpb24gaXMgZm91bmQsIGVsc2UgdHJ1ZQogICAgICovCgoKICAgIGZpbmRTZXBhcmF0aW5nQXhpcyhodWxsQiwgcG9zQSwgcXVhdEEsIHBvc0IsIHF1YXRCLCB0YXJnZXQsIGZhY2VMaXN0QSwgZmFjZUxpc3RCKSB7CiAgICAgIGNvbnN0IGZhY2VBTm9ybWFsV1MzID0gbmV3IFZlYzMoKTsKICAgICAgY29uc3QgV29ybGRub3JtYWwxID0gbmV3IFZlYzMoKTsKICAgICAgY29uc3QgZGVsdGFDID0gbmV3IFZlYzMoKTsKICAgICAgY29uc3Qgd29ybGRFZGdlMCA9IG5ldyBWZWMzKCk7CiAgICAgIGNvbnN0IHdvcmxkRWRnZTEgPSBuZXcgVmVjMygpOwogICAgICBjb25zdCBDcm9zcyA9IG5ldyBWZWMzKCk7CiAgICAgIGxldCBkbWluID0gTnVtYmVyLk1BWF9WQUxVRTsKICAgICAgY29uc3QgaHVsbEEgPSB0aGlzOwoKICAgICAgaWYgKCFodWxsQS51bmlxdWVBeGVzKSB7CiAgICAgICAgY29uc3QgbnVtRmFjZXNBID0gZmFjZUxpc3RBID8gZmFjZUxpc3RBLmxlbmd0aCA6IGh1bGxBLmZhY2VzLmxlbmd0aDsgLy8gVGVzdCBmYWNlIG5vcm1hbHMgZnJvbSBodWxsQQoKICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IG51bUZhY2VzQTsgaSsrKSB7CiAgICAgICAgICBjb25zdCBmaSA9IGZhY2VMaXN0QSA/IGZhY2VMaXN0QVtpXSA6IGk7IC8vIEdldCB3b3JsZCBmYWNlIG5vcm1hbAoKICAgICAgICAgIGZhY2VBTm9ybWFsV1MzLmNvcHkoaHVsbEEuZmFjZU5vcm1hbHNbZmldKTsKICAgICAgICAgIHF1YXRBLnZtdWx0KGZhY2VBTm9ybWFsV1MzLCBmYWNlQU5vcm1hbFdTMyk7CiAgICAgICAgICBjb25zdCBkID0gaHVsbEEudGVzdFNlcEF4aXMoZmFjZUFOb3JtYWxXUzMsIGh1bGxCLCBwb3NBLCBxdWF0QSwgcG9zQiwgcXVhdEIpOwoKICAgICAgICAgIGlmIChkID09PSBmYWxzZSkgewogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKGQgPCBkbWluKSB7CiAgICAgICAgICAgIGRtaW4gPSBkOwogICAgICAgICAgICB0YXJnZXQuY29weShmYWNlQU5vcm1hbFdTMyk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9IGVsc2UgewogICAgICAgIC8vIFRlc3QgdW5pcXVlIGF4ZXMKICAgICAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gaHVsbEEudW5pcXVlQXhlcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgLy8gR2V0IHdvcmxkIGF4aXMKICAgICAgICAgIHF1YXRBLnZtdWx0KGh1bGxBLnVuaXF1ZUF4ZXNbaV0sIGZhY2VBTm9ybWFsV1MzKTsKICAgICAgICAgIGNvbnN0IGQgPSBodWxsQS50ZXN0U2VwQXhpcyhmYWNlQU5vcm1hbFdTMywgaHVsbEIsIHBvc0EsIHF1YXRBLCBwb3NCLCBxdWF0Qik7CgogICAgICAgICAgaWYgKGQgPT09IGZhbHNlKSB7CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgIH0KCiAgICAgICAgICBpZiAoZCA8IGRtaW4pIHsKICAgICAgICAgICAgZG1pbiA9IGQ7CiAgICAgICAgICAgIHRhcmdldC5jb3B5KGZhY2VBTm9ybWFsV1MzKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KCiAgICAgIGlmICghaHVsbEIudW5pcXVlQXhlcykgewogICAgICAgIC8vIFRlc3QgZmFjZSBub3JtYWxzIGZyb20gaHVsbEIKICAgICAgICBjb25zdCBudW1GYWNlc0IgPSBmYWNlTGlzdEIgPyBmYWNlTGlzdEIubGVuZ3RoIDogaHVsbEIuZmFjZXMubGVuZ3RoOwoKICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IG51bUZhY2VzQjsgaSsrKSB7CiAgICAgICAgICBjb25zdCBmaSA9IGZhY2VMaXN0QiA/IGZhY2VMaXN0QltpXSA6IGk7CiAgICAgICAgICBXb3JsZG5vcm1hbDEuY29weShodWxsQi5mYWNlTm9ybWFsc1tmaV0pOwogICAgICAgICAgcXVhdEIudm11bHQoV29ybGRub3JtYWwxLCBXb3JsZG5vcm1hbDEpOwogICAgICAgICAgY29uc3QgZCA9IGh1bGxBLnRlc3RTZXBBeGlzKFdvcmxkbm9ybWFsMSwgaHVsbEIsIHBvc0EsIHF1YXRBLCBwb3NCLCBxdWF0Qik7CgogICAgICAgICAgaWYgKGQgPT09IGZhbHNlKSB7CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgIH0KCiAgICAgICAgICBpZiAoZCA8IGRtaW4pIHsKICAgICAgICAgICAgZG1pbiA9IGQ7CiAgICAgICAgICAgIHRhcmdldC5jb3B5KFdvcmxkbm9ybWFsMSk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9IGVsc2UgewogICAgICAgIC8vIFRlc3QgdW5pcXVlIGF4ZXMgaW4gQgogICAgICAgIGZvciAobGV0IGkgPSAwOyBpICE9PSBodWxsQi51bmlxdWVBeGVzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICBxdWF0Qi52bXVsdChodWxsQi51bmlxdWVBeGVzW2ldLCBXb3JsZG5vcm1hbDEpOwogICAgICAgICAgY29uc3QgZCA9IGh1bGxBLnRlc3RTZXBBeGlzKFdvcmxkbm9ybWFsMSwgaHVsbEIsIHBvc0EsIHF1YXRBLCBwb3NCLCBxdWF0Qik7CgogICAgICAgICAgaWYgKGQgPT09IGZhbHNlKSB7CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgIH0KCiAgICAgICAgICBpZiAoZCA8IGRtaW4pIHsKICAgICAgICAgICAgZG1pbiA9IGQ7CiAgICAgICAgICAgIHRhcmdldC5jb3B5KFdvcmxkbm9ybWFsMSk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9IC8vIFRlc3QgZWRnZXMKCgogICAgICBmb3IgKGxldCBlMCA9IDA7IGUwICE9PSBodWxsQS51bmlxdWVFZGdlcy5sZW5ndGg7IGUwKyspIHsKICAgICAgICAvLyBHZXQgd29ybGQgZWRnZQogICAgICAgIHF1YXRBLnZtdWx0KGh1bGxBLnVuaXF1ZUVkZ2VzW2UwXSwgd29ybGRFZGdlMCk7CgogICAgICAgIGZvciAobGV0IGUxID0gMDsgZTEgIT09IGh1bGxCLnVuaXF1ZUVkZ2VzLmxlbmd0aDsgZTErKykgewogICAgICAgICAgLy8gR2V0IHdvcmxkIGVkZ2UgMgogICAgICAgICAgcXVhdEIudm11bHQoaHVsbEIudW5pcXVlRWRnZXNbZTFdLCB3b3JsZEVkZ2UxKTsKICAgICAgICAgIHdvcmxkRWRnZTAuY3Jvc3Mod29ybGRFZGdlMSwgQ3Jvc3MpOwoKICAgICAgICAgIGlmICghQ3Jvc3MuYWxtb3N0WmVybygpKSB7CiAgICAgICAgICAgIENyb3NzLm5vcm1hbGl6ZSgpOwogICAgICAgICAgICBjb25zdCBkaXN0ID0gaHVsbEEudGVzdFNlcEF4aXMoQ3Jvc3MsIGh1bGxCLCBwb3NBLCBxdWF0QSwgcG9zQiwgcXVhdEIpOwoKICAgICAgICAgICAgaWYgKGRpc3QgPT09IGZhbHNlKSB7CiAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAoZGlzdCA8IGRtaW4pIHsKICAgICAgICAgICAgICBkbWluID0gZGlzdDsKICAgICAgICAgICAgICB0YXJnZXQuY29weShDcm9zcyk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KCiAgICAgIHBvc0IudnN1Yihwb3NBLCBkZWx0YUMpOwoKICAgICAgaWYgKGRlbHRhQy5kb3QodGFyZ2V0KSA+IDAuMCkgewogICAgICAgIHRhcmdldC5uZWdhdGUodGFyZ2V0KTsKICAgICAgfQoKICAgICAgcmV0dXJuIHRydWU7CiAgICB9CiAgICAvKioKICAgICAqIFRlc3Qgc2VwYXJhdGluZyBheGlzIGFnYWluc3QgdHdvIGh1bGxzLiBCb3RoIGh1bGxzIGFyZSBwcm9qZWN0ZWQgb250byB0aGUgYXhpcyBhbmQgdGhlIG92ZXJsYXAgc2l6ZSBpcyByZXR1cm5lZCBpZiB0aGVyZSBpcyBvbmUuCiAgICAgKiBAcmV0dXJuIFRoZSBvdmVybGFwIGRlcHRoLCBvciBGQUxTRSBpZiBubyBwZW5ldHJhdGlvbi4KICAgICAqLwoKCiAgICB0ZXN0U2VwQXhpcyhheGlzLCBodWxsQiwgcG9zQSwgcXVhdEEsIHBvc0IsIHF1YXRCKSB7CiAgICAgIGNvbnN0IGh1bGxBID0gdGhpczsKICAgICAgQ29udmV4UG9seWhlZHJvbi5wcm9qZWN0KGh1bGxBLCBheGlzLCBwb3NBLCBxdWF0QSwgbWF4bWluQSk7CiAgICAgIENvbnZleFBvbHloZWRyb24ucHJvamVjdChodWxsQiwgYXhpcywgcG9zQiwgcXVhdEIsIG1heG1pbkIpOwogICAgICBjb25zdCBtYXhBID0gbWF4bWluQVswXTsKICAgICAgY29uc3QgbWluQSA9IG1heG1pbkFbMV07CiAgICAgIGNvbnN0IG1heEIgPSBtYXhtaW5CWzBdOwogICAgICBjb25zdCBtaW5CID0gbWF4bWluQlsxXTsKCiAgICAgIGlmIChtYXhBIDwgbWluQiB8fCBtYXhCIDwgbWluQSkgewogICAgICAgIHJldHVybiBmYWxzZTsgLy8gU2VwYXJhdGVkCiAgICAgIH0KCiAgICAgIGNvbnN0IGQwID0gbWF4QSAtIG1pbkI7CiAgICAgIGNvbnN0IGQxID0gbWF4QiAtIG1pbkE7CiAgICAgIGNvbnN0IGRlcHRoID0gZDAgPCBkMSA/IGQwIDogZDE7CiAgICAgIHJldHVybiBkZXB0aDsKICAgIH0KICAgIC8qKgogICAgICogY2FsY3VsYXRlTG9jYWxJbmVydGlhCiAgICAgKi8KCgogICAgY2FsY3VsYXRlTG9jYWxJbmVydGlhKG1hc3MsIHRhcmdldCkgewogICAgICAvLyBBcHByb3hpbWF0ZSB3aXRoIGJveCBpbmVydGlhCiAgICAgIC8vIEV4YWN0IGluZXJ0aWEgY2FsY3VsYXRpb24gaXMgb3ZlcmtpbGwsIGJ1dCBzZWUgaHR0cDovL2dlb21ldHJpY3Rvb2xzLmNvbS9Eb2N1bWVudGF0aW9uL1BvbHloZWRyYWxNYXNzUHJvcGVydGllcy5wZGYgZm9yIHRoZSBjb3JyZWN0IHdheSB0byBkbyBpdAogICAgICBjb25zdCBhYWJibWF4ID0gbmV3IFZlYzMoKTsKICAgICAgY29uc3QgYWFiYm1pbiA9IG5ldyBWZWMzKCk7CiAgICAgIHRoaXMuY29tcHV0ZUxvY2FsQUFCQihhYWJibWluLCBhYWJibWF4KTsKICAgICAgY29uc3QgeCA9IGFhYmJtYXgueCAtIGFhYmJtaW4ueDsKICAgICAgY29uc3QgeSA9IGFhYmJtYXgueSAtIGFhYmJtaW4ueTsKICAgICAgY29uc3QgeiA9IGFhYmJtYXgueiAtIGFhYmJtaW4uejsKICAgICAgdGFyZ2V0LnggPSAxLjAgLyAxMi4wICogbWFzcyAqICgyICogeSAqIDIgKiB5ICsgMiAqIHogKiAyICogeik7CiAgICAgIHRhcmdldC55ID0gMS4wIC8gMTIuMCAqIG1hc3MgKiAoMiAqIHggKiAyICogeCArIDIgKiB6ICogMiAqIHopOwogICAgICB0YXJnZXQueiA9IDEuMCAvIDEyLjAgKiBtYXNzICogKDIgKiB5ICogMiAqIHkgKyAyICogeCAqIDIgKiB4KTsKICAgIH0KICAgIC8qKgogICAgICogQHBhcmFtIGZhY2VfaSBJbmRleCBvZiB0aGUgZmFjZQogICAgICovCgoKICAgIGdldFBsYW5lQ29uc3RhbnRPZkZhY2UoZmFjZV9pKSB7CiAgICAgIGNvbnN0IGYgPSB0aGlzLmZhY2VzW2ZhY2VfaV07CiAgICAgIGNvbnN0IG4gPSB0aGlzLmZhY2VOb3JtYWxzW2ZhY2VfaV07CiAgICAgIGNvbnN0IHYgPSB0aGlzLnZlcnRpY2VzW2ZbMF1dOwogICAgICBjb25zdCBjID0gLW4uZG90KHYpOwogICAgICByZXR1cm4gYzsKICAgIH0KICAgIC8qKgogICAgICogQ2xpcCBhIGZhY2UgYWdhaW5zdCBhIGh1bGwuCiAgICAgKiBAcGFyYW0gd29ybGRWZXJ0c0IxIEFuIGFycmF5IG9mIFZlYzMgd2l0aCB2ZXJ0aWNlcyBpbiB0aGUgd29ybGQgZnJhbWUuCiAgICAgKiBAcGFyYW0gbWluRGlzdCBEaXN0YW5jZSBjbGFtcGluZwogICAgICogQHBhcmFtIEFycmF5IHJlc3VsdCBBcnJheSB0byBzdG9yZSByZXN1bHRpbmcgY29udGFjdCBwb2ludHMgaW4uIFdpbGwgYmUgb2JqZWN0cyB3aXRoIHByb3BlcnRpZXM6IHBvaW50LCBkZXB0aCwgbm9ybWFsLiBUaGVzZSBhcmUgcmVwcmVzZW50ZWQgaW4gd29ybGQgY29vcmRpbmF0ZXMuCiAgICAgKi8KCgogICAgY2xpcEZhY2VBZ2FpbnN0SHVsbChzZXBhcmF0aW5nTm9ybWFsLCBwb3NBLCBxdWF0QSwgd29ybGRWZXJ0c0IxLCBtaW5EaXN0LCBtYXhEaXN0LCByZXN1bHQpIHsKICAgICAgY29uc3QgZmFjZUFOb3JtYWxXUyA9IG5ldyBWZWMzKCk7CiAgICAgIGNvbnN0IGVkZ2UwID0gbmV3IFZlYzMoKTsKICAgICAgY29uc3QgV29ybGRFZGdlMCA9IG5ldyBWZWMzKCk7CiAgICAgIGNvbnN0IHdvcmxkUGxhbmVBbm9ybWFsMSA9IG5ldyBWZWMzKCk7CiAgICAgIGNvbnN0IHBsYW5lTm9ybWFsV1MxID0gbmV3IFZlYzMoKTsKICAgICAgY29uc3Qgd29ybGRBMSA9IG5ldyBWZWMzKCk7CiAgICAgIGNvbnN0IGxvY2FsUGxhbmVOb3JtYWwgPSBuZXcgVmVjMygpOwogICAgICBjb25zdCBwbGFuZU5vcm1hbFdTID0gbmV3IFZlYzMoKTsKICAgICAgY29uc3QgaHVsbEEgPSB0aGlzOwogICAgICBjb25zdCB3b3JsZFZlcnRzQjIgPSBbXTsKICAgICAgY29uc3QgcFZ0eEluID0gd29ybGRWZXJ0c0IxOwogICAgICBjb25zdCBwVnR4T3V0ID0gd29ybGRWZXJ0c0IyOwogICAgICBsZXQgY2xvc2VzdEZhY2VBID0gLTE7CiAgICAgIGxldCBkbWluID0gTnVtYmVyLk1BWF9WQUxVRTsgLy8gRmluZCB0aGUgZmFjZSB3aXRoIG5vcm1hbCBjbG9zZXN0IHRvIHRoZSBzZXBhcmF0aW5nIGF4aXMKCiAgICAgIGZvciAobGV0IGZhY2UgPSAwOyBmYWNlIDwgaHVsbEEuZmFjZXMubGVuZ3RoOyBmYWNlKyspIHsKICAgICAgICBmYWNlQU5vcm1hbFdTLmNvcHkoaHVsbEEuZmFjZU5vcm1hbHNbZmFjZV0pOwogICAgICAgIHF1YXRBLnZtdWx0KGZhY2VBTm9ybWFsV1MsIGZhY2VBTm9ybWFsV1MpOwogICAgICAgIGNvbnN0IGQgPSBmYWNlQU5vcm1hbFdTLmRvdChzZXBhcmF0aW5nTm9ybWFsKTsKCiAgICAgICAgaWYgKGQgPCBkbWluKSB7CiAgICAgICAgICBkbWluID0gZDsKICAgICAgICAgIGNsb3Nlc3RGYWNlQSA9IGZhY2U7CiAgICAgICAgfQogICAgICB9CgogICAgICBpZiAoY2xvc2VzdEZhY2VBIDwgMCkgewogICAgICAgIHJldHVybjsKICAgICAgfSAvLyBHZXQgdGhlIGZhY2UgYW5kIGNvbnN0cnVjdCBjb25uZWN0ZWQgZmFjZXMKCgogICAgICBjb25zdCBwb2x5QSA9IGh1bGxBLmZhY2VzW2Nsb3Nlc3RGYWNlQV07CiAgICAgIHBvbHlBLmNvbm5lY3RlZEZhY2VzID0gW107CgogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGh1bGxBLmZhY2VzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgZm9yIChsZXQgaiA9IDA7IGogPCBodWxsQS5mYWNlc1tpXS5sZW5ndGg7IGorKykgewogICAgICAgICAgaWYgKAogICAgICAgICAgLyogU2hhcmluZyBhIHZlcnRleCovCiAgICAgICAgICBwb2x5QS5pbmRleE9mKGh1bGxBLmZhY2VzW2ldW2pdKSAhPT0gLTEgJiYKICAgICAgICAgIC8qIE5vdCB0aGUgb25lIHdlIGFyZSBsb29raW5nIGZvciBjb25uZWN0aW9ucyBmcm9tICovCiAgICAgICAgICBpICE9PSBjbG9zZXN0RmFjZUEgJiYKICAgICAgICAgIC8qIE5vdCBhbHJlYWR5IGFkZGVkICovCiAgICAgICAgICBwb2x5QS5jb25uZWN0ZWRGYWNlcy5pbmRleE9mKGkpID09PSAtMSkgewogICAgICAgICAgICBwb2x5QS5jb25uZWN0ZWRGYWNlcy5wdXNoKGkpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSAvLyBDbGlwIHRoZSBwb2x5Z29uIHRvIHRoZSBiYWNrIG9mIHRoZSBwbGFuZXMgb2YgYWxsIGZhY2VzIG9mIGh1bGwgQSwKICAgICAgLy8gdGhhdCBhcmUgYWRqYWNlbnQgdG8gdGhlIHdpdG5lc3MgZmFjZQoKCiAgICAgIGNvbnN0IG51bVZlcnRpY2VzQSA9IHBvbHlBLmxlbmd0aDsKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbnVtVmVydGljZXNBOyBpKyspIHsKICAgICAgICBjb25zdCBhID0gaHVsbEEudmVydGljZXNbcG9seUFbaV1dOwogICAgICAgIGNvbnN0IGIgPSBodWxsQS52ZXJ0aWNlc1twb2x5QVsoaSArIDEpICUgbnVtVmVydGljZXNBXV07CiAgICAgICAgYS52c3ViKGIsIGVkZ2UwKTsKICAgICAgICBXb3JsZEVkZ2UwLmNvcHkoZWRnZTApOwogICAgICAgIHF1YXRBLnZtdWx0KFdvcmxkRWRnZTAsIFdvcmxkRWRnZTApOwogICAgICAgIHBvc0EudmFkZChXb3JsZEVkZ2UwLCBXb3JsZEVkZ2UwKTsKICAgICAgICB3b3JsZFBsYW5lQW5vcm1hbDEuY29weSh0aGlzLmZhY2VOb3JtYWxzW2Nsb3Nlc3RGYWNlQV0pOwogICAgICAgIHF1YXRBLnZtdWx0KHdvcmxkUGxhbmVBbm9ybWFsMSwgd29ybGRQbGFuZUFub3JtYWwxKTsKICAgICAgICBwb3NBLnZhZGQod29ybGRQbGFuZUFub3JtYWwxLCB3b3JsZFBsYW5lQW5vcm1hbDEpOwogICAgICAgIFdvcmxkRWRnZTAuY3Jvc3Mod29ybGRQbGFuZUFub3JtYWwxLCBwbGFuZU5vcm1hbFdTMSk7CiAgICAgICAgcGxhbmVOb3JtYWxXUzEubmVnYXRlKHBsYW5lTm9ybWFsV1MxKTsKICAgICAgICB3b3JsZEExLmNvcHkoYSk7CiAgICAgICAgcXVhdEEudm11bHQod29ybGRBMSwgd29ybGRBMSk7CiAgICAgICAgcG9zQS52YWRkKHdvcmxkQTEsIHdvcmxkQTEpOwogICAgICAgIGNvbnN0IG90aGVyRmFjZSA9IHBvbHlBLmNvbm5lY3RlZEZhY2VzW2ldOwogICAgICAgIGxvY2FsUGxhbmVOb3JtYWwuY29weSh0aGlzLmZhY2VOb3JtYWxzW290aGVyRmFjZV0pOwogICAgICAgIGNvbnN0IGxvY2FsUGxhbmVFcSA9IHRoaXMuZ2V0UGxhbmVDb25zdGFudE9mRmFjZShvdGhlckZhY2UpOwogICAgICAgIHBsYW5lTm9ybWFsV1MuY29weShsb2NhbFBsYW5lTm9ybWFsKTsKICAgICAgICBxdWF0QS52bXVsdChwbGFuZU5vcm1hbFdTLCBwbGFuZU5vcm1hbFdTKTsKICAgICAgICBjb25zdCBwbGFuZUVxV1MgPSBsb2NhbFBsYW5lRXEgLSBwbGFuZU5vcm1hbFdTLmRvdChwb3NBKTsgLy8gQ2xpcCBmYWNlIGFnYWluc3Qgb3VyIGNvbnN0cnVjdGVkIHBsYW5lCgogICAgICAgIHRoaXMuY2xpcEZhY2VBZ2FpbnN0UGxhbmUocFZ0eEluLCBwVnR4T3V0LCBwbGFuZU5vcm1hbFdTLCBwbGFuZUVxV1MpOyAvLyBUaHJvdyBhd2F5IGFsbCBjbGlwcGVkIHBvaW50cywgYnV0IHNhdmUgdGhlIHJlbWFpbmluZyB1bnRpbCBuZXh0IGNsaXAKCiAgICAgICAgd2hpbGUgKHBWdHhJbi5sZW5ndGgpIHsKICAgICAgICAgIHBWdHhJbi5zaGlmdCgpOwogICAgICAgIH0KCiAgICAgICAgd2hpbGUgKHBWdHhPdXQubGVuZ3RoKSB7CiAgICAgICAgICBwVnR4SW4ucHVzaChwVnR4T3V0LnNoaWZ0KCkpOwogICAgICAgIH0KICAgICAgfSAvLyBvbmx5IGtlZXAgY29udGFjdCBwb2ludHMgdGhhdCBhcmUgYmVoaW5kIHRoZSB3aXRuZXNzIGZhY2UKCgogICAgICBsb2NhbFBsYW5lTm9ybWFsLmNvcHkodGhpcy5mYWNlTm9ybWFsc1tjbG9zZXN0RmFjZUFdKTsKICAgICAgY29uc3QgbG9jYWxQbGFuZUVxID0gdGhpcy5nZXRQbGFuZUNvbnN0YW50T2ZGYWNlKGNsb3Nlc3RGYWNlQSk7CiAgICAgIHBsYW5lTm9ybWFsV1MuY29weShsb2NhbFBsYW5lTm9ybWFsKTsKICAgICAgcXVhdEEudm11bHQocGxhbmVOb3JtYWxXUywgcGxhbmVOb3JtYWxXUyk7CiAgICAgIGNvbnN0IHBsYW5lRXFXUyA9IGxvY2FsUGxhbmVFcSAtIHBsYW5lTm9ybWFsV1MuZG90KHBvc0EpOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBwVnR4SW4ubGVuZ3RoOyBpKyspIHsKICAgICAgICBsZXQgZGVwdGggPSBwbGFuZU5vcm1hbFdTLmRvdChwVnR4SW5baV0pICsgcGxhbmVFcVdTOyAvLyA/Pz8KCiAgICAgICAgaWYgKGRlcHRoIDw9IG1pbkRpc3QpIHsKICAgICAgICAgIGNvbnNvbGUubG9nKGBjbGFtcGVkOiBkZXB0aD0ke2RlcHRofSB0byBtaW5EaXN0PSR7bWluRGlzdH1gKTsKICAgICAgICAgIGRlcHRoID0gbWluRGlzdDsKICAgICAgICB9CgogICAgICAgIGlmIChkZXB0aCA8PSBtYXhEaXN0KSB7CiAgICAgICAgICBjb25zdCBwb2ludCA9IHBWdHhJbltpXTsKCiAgICAgICAgICBpZiAoZGVwdGggPD0gMWUtNikgewogICAgICAgICAgICBjb25zdCBwID0gewogICAgICAgICAgICAgIHBvaW50LAogICAgICAgICAgICAgIG5vcm1hbDogcGxhbmVOb3JtYWxXUywKICAgICAgICAgICAgICBkZXB0aAogICAgICAgICAgICB9OwogICAgICAgICAgICByZXN1bHQucHVzaChwKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogQ2xpcCBhIGZhY2UgaW4gYSBodWxsIGFnYWluc3QgdGhlIGJhY2sgb2YgYSBwbGFuZS4KICAgICAqIEBwYXJhbSBwbGFuZUNvbnN0YW50IFRoZSBjb25zdGFudCBpbiB0aGUgbWF0aGVtYXRpY2FsIHBsYW5lIGVxdWF0aW9uCiAgICAgKi8KCgogICAgY2xpcEZhY2VBZ2FpbnN0UGxhbmUoaW5WZXJ0aWNlcywgb3V0VmVydGljZXMsIHBsYW5lTm9ybWFsLCBwbGFuZUNvbnN0YW50KSB7CiAgICAgIGxldCBuX2RvdF9maXJzdDsKICAgICAgbGV0IG5fZG90X2xhc3Q7CiAgICAgIGNvbnN0IG51bVZlcnRzID0gaW5WZXJ0aWNlcy5sZW5ndGg7CgogICAgICBpZiAobnVtVmVydHMgPCAyKSB7CiAgICAgICAgcmV0dXJuIG91dFZlcnRpY2VzOwogICAgICB9CgogICAgICBsZXQgZmlyc3RWZXJ0ZXggPSBpblZlcnRpY2VzW2luVmVydGljZXMubGVuZ3RoIC0gMV07CiAgICAgIGxldCBsYXN0VmVydGV4ID0gaW5WZXJ0aWNlc1swXTsKICAgICAgbl9kb3RfZmlyc3QgPSBwbGFuZU5vcm1hbC5kb3QoZmlyc3RWZXJ0ZXgpICsgcGxhbmVDb25zdGFudDsKCiAgICAgIGZvciAobGV0IHZpID0gMDsgdmkgPCBudW1WZXJ0czsgdmkrKykgewogICAgICAgIGxhc3RWZXJ0ZXggPSBpblZlcnRpY2VzW3ZpXTsKICAgICAgICBuX2RvdF9sYXN0ID0gcGxhbmVOb3JtYWwuZG90KGxhc3RWZXJ0ZXgpICsgcGxhbmVDb25zdGFudDsKCiAgICAgICAgaWYgKG5fZG90X2ZpcnN0IDwgMCkgewogICAgICAgICAgaWYgKG5fZG90X2xhc3QgPCAwKSB7CiAgICAgICAgICAgIC8vIFN0YXJ0IDwgMCwgZW5kIDwgMCwgc28gb3V0cHV0IGxhc3RWZXJ0ZXgKICAgICAgICAgICAgY29uc3QgbmV3diA9IG5ldyBWZWMzKCk7CiAgICAgICAgICAgIG5ld3YuY29weShsYXN0VmVydGV4KTsKICAgICAgICAgICAgb3V0VmVydGljZXMucHVzaChuZXd2KTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIC8vIFN0YXJ0IDwgMCwgZW5kID49IDAsIHNvIG91dHB1dCBpbnRlcnNlY3Rpb24KICAgICAgICAgICAgY29uc3QgbmV3diA9IG5ldyBWZWMzKCk7CiAgICAgICAgICAgIGZpcnN0VmVydGV4LmxlcnAobGFzdFZlcnRleCwgbl9kb3RfZmlyc3QgLyAobl9kb3RfZmlyc3QgLSBuX2RvdF9sYXN0KSwgbmV3dik7CiAgICAgICAgICAgIG91dFZlcnRpY2VzLnB1c2gobmV3dik7CiAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGlmIChuX2RvdF9sYXN0IDwgMCkgewogICAgICAgICAgICAvLyBTdGFydCA+PSAwLCBlbmQgPCAwIHNvIG91dHB1dCBpbnRlcnNlY3Rpb24gYW5kIGVuZAogICAgICAgICAgICBjb25zdCBuZXd2ID0gbmV3IFZlYzMoKTsKICAgICAgICAgICAgZmlyc3RWZXJ0ZXgubGVycChsYXN0VmVydGV4LCBuX2RvdF9maXJzdCAvIChuX2RvdF9maXJzdCAtIG5fZG90X2xhc3QpLCBuZXd2KTsKICAgICAgICAgICAgb3V0VmVydGljZXMucHVzaChuZXd2KTsKICAgICAgICAgICAgb3V0VmVydGljZXMucHVzaChsYXN0VmVydGV4KTsKICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGZpcnN0VmVydGV4ID0gbGFzdFZlcnRleDsKICAgICAgICBuX2RvdF9maXJzdCA9IG5fZG90X2xhc3Q7CiAgICAgIH0KCiAgICAgIHJldHVybiBvdXRWZXJ0aWNlczsKICAgIH0KICAgIC8qKgogICAgICogVXBkYXRlcyBgLndvcmxkVmVydGljZXNgIGFuZCBzZXRzIGAud29ybGRWZXJ0aWNlc05lZWRzVXBkYXRlYCB0byBmYWxzZS4KICAgICAqLwoKCiAgICBjb21wdXRlV29ybGRWZXJ0aWNlcyhwb3NpdGlvbiwgcXVhdCkgewogICAgICB3aGlsZSAodGhpcy53b3JsZFZlcnRpY2VzLmxlbmd0aCA8IHRoaXMudmVydGljZXMubGVuZ3RoKSB7CiAgICAgICAgdGhpcy53b3JsZFZlcnRpY2VzLnB1c2gobmV3IFZlYzMoKSk7CiAgICAgIH0KCiAgICAgIGNvbnN0IHZlcnRzID0gdGhpcy52ZXJ0aWNlczsKICAgICAgY29uc3Qgd29ybGRWZXJ0cyA9IHRoaXMud29ybGRWZXJ0aWNlczsKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpICE9PSB0aGlzLnZlcnRpY2VzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgcXVhdC52bXVsdCh2ZXJ0c1tpXSwgd29ybGRWZXJ0c1tpXSk7CiAgICAgICAgcG9zaXRpb24udmFkZCh3b3JsZFZlcnRzW2ldLCB3b3JsZFZlcnRzW2ldKTsKICAgICAgfQoKICAgICAgdGhpcy53b3JsZFZlcnRpY2VzTmVlZHNVcGRhdGUgPSBmYWxzZTsKICAgIH0KCiAgICBjb21wdXRlTG9jYWxBQUJCKGFhYmJtaW4sIGFhYmJtYXgpIHsKICAgICAgY29uc3QgdmVydGljZXMgPSB0aGlzLnZlcnRpY2VzOwogICAgICBhYWJibWluLnNldChOdW1iZXIuTUFYX1ZBTFVFLCBOdW1iZXIuTUFYX1ZBTFVFLCBOdW1iZXIuTUFYX1ZBTFVFKTsKICAgICAgYWFiYm1heC5zZXQoLU51bWJlci5NQVhfVkFMVUUsIC1OdW1iZXIuTUFYX1ZBTFVFLCAtTnVtYmVyLk1BWF9WQUxVRSk7CgogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMudmVydGljZXMubGVuZ3RoOyBpKyspIHsKICAgICAgICBjb25zdCB2ID0gdmVydGljZXNbaV07CgogICAgICAgIGlmICh2LnggPCBhYWJibWluLngpIHsKICAgICAgICAgIGFhYmJtaW4ueCA9IHYueDsKICAgICAgICB9IGVsc2UgaWYgKHYueCA+IGFhYmJtYXgueCkgewogICAgICAgICAgYWFiYm1heC54ID0gdi54OwogICAgICAgIH0KCiAgICAgICAgaWYgKHYueSA8IGFhYmJtaW4ueSkgewogICAgICAgICAgYWFiYm1pbi55ID0gdi55OwogICAgICAgIH0gZWxzZSBpZiAodi55ID4gYWFiYm1heC55KSB7CiAgICAgICAgICBhYWJibWF4LnkgPSB2Lnk7CiAgICAgICAgfQoKICAgICAgICBpZiAodi56IDwgYWFiYm1pbi56KSB7CiAgICAgICAgICBhYWJibWluLnogPSB2Lno7CiAgICAgICAgfSBlbHNlIGlmICh2LnogPiBhYWJibWF4LnopIHsKICAgICAgICAgIGFhYmJtYXgueiA9IHYuejsKICAgICAgICB9CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogVXBkYXRlcyBgd29ybGRWZXJ0aWNlc2AgYW5kIHNldHMgYHdvcmxkVmVydGljZXNOZWVkc1VwZGF0ZWAgdG8gZmFsc2UuCiAgICAgKi8KCgogICAgY29tcHV0ZVdvcmxkRmFjZU5vcm1hbHMocXVhdCkgewogICAgICBjb25zdCBOID0gdGhpcy5mYWNlTm9ybWFscy5sZW5ndGg7CgogICAgICB3aGlsZSAodGhpcy53b3JsZEZhY2VOb3JtYWxzLmxlbmd0aCA8IE4pIHsKICAgICAgICB0aGlzLndvcmxkRmFjZU5vcm1hbHMucHVzaChuZXcgVmVjMygpKTsKICAgICAgfQoKICAgICAgY29uc3Qgbm9ybWFscyA9IHRoaXMuZmFjZU5vcm1hbHM7CiAgICAgIGNvbnN0IHdvcmxkTm9ybWFscyA9IHRoaXMud29ybGRGYWNlTm9ybWFsczsKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpICE9PSBOOyBpKyspIHsKICAgICAgICBxdWF0LnZtdWx0KG5vcm1hbHNbaV0sIHdvcmxkTm9ybWFsc1tpXSk7CiAgICAgIH0KCiAgICAgIHRoaXMud29ybGRGYWNlTm9ybWFsc05lZWRzVXBkYXRlID0gZmFsc2U7CiAgICB9CiAgICAvKioKICAgICAqIHVwZGF0ZUJvdW5kaW5nU3BoZXJlUmFkaXVzCiAgICAgKi8KCgogICAgdXBkYXRlQm91bmRpbmdTcGhlcmVSYWRpdXMoKSB7CiAgICAgIC8vIEFzc3VtZSBwb2ludHMgYXJlIGRpc3RyaWJ1dGVkIHdpdGggbG9jYWwgKDAsMCwwKSBhcyBjZW50ZXIKICAgICAgbGV0IG1heDIgPSAwOwogICAgICBjb25zdCB2ZXJ0cyA9IHRoaXMudmVydGljZXM7CgogICAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gdmVydHMubGVuZ3RoOyBpKyspIHsKICAgICAgICBjb25zdCBub3JtMiA9IHZlcnRzW2ldLmxlbmd0aFNxdWFyZWQoKTsKCiAgICAgICAgaWYgKG5vcm0yID4gbWF4MikgewogICAgICAgICAgbWF4MiA9IG5vcm0yOwogICAgICAgIH0KICAgICAgfQoKICAgICAgdGhpcy5ib3VuZGluZ1NwaGVyZVJhZGl1cyA9IE1hdGguc3FydChtYXgyKTsKICAgIH0KICAgIC8qKgogICAgICogY2FsY3VsYXRlV29ybGRBQUJCCiAgICAgKi8KCgogICAgY2FsY3VsYXRlV29ybGRBQUJCKHBvcywgcXVhdCwgbWluLCBtYXgpIHsKICAgICAgY29uc3QgdmVydHMgPSB0aGlzLnZlcnRpY2VzOwogICAgICBsZXQgbWlueDsKICAgICAgbGV0IG1pbnk7CiAgICAgIGxldCBtaW56OwogICAgICBsZXQgbWF4eDsKICAgICAgbGV0IG1heHk7CiAgICAgIGxldCBtYXh6OwogICAgICBsZXQgdGVtcFdvcmxkVmVydGV4ID0gbmV3IFZlYzMoKTsKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdmVydHMubGVuZ3RoOyBpKyspIHsKICAgICAgICB0ZW1wV29ybGRWZXJ0ZXguY29weSh2ZXJ0c1tpXSk7CiAgICAgICAgcXVhdC52bXVsdCh0ZW1wV29ybGRWZXJ0ZXgsIHRlbXBXb3JsZFZlcnRleCk7CiAgICAgICAgcG9zLnZhZGQodGVtcFdvcmxkVmVydGV4LCB0ZW1wV29ybGRWZXJ0ZXgpOwogICAgICAgIGNvbnN0IHYgPSB0ZW1wV29ybGRWZXJ0ZXg7CgogICAgICAgIGlmIChtaW54ID09PSB1bmRlZmluZWQgfHwgdi54IDwgbWlueCkgewogICAgICAgICAgbWlueCA9IHYueDsKICAgICAgICB9CgogICAgICAgIGlmIChtYXh4ID09PSB1bmRlZmluZWQgfHwgdi54ID4gbWF4eCkgewogICAgICAgICAgbWF4eCA9IHYueDsKICAgICAgICB9CgogICAgICAgIGlmIChtaW55ID09PSB1bmRlZmluZWQgfHwgdi55IDwgbWlueSkgewogICAgICAgICAgbWlueSA9IHYueTsKICAgICAgICB9CgogICAgICAgIGlmIChtYXh5ID09PSB1bmRlZmluZWQgfHwgdi55ID4gbWF4eSkgewogICAgICAgICAgbWF4eSA9IHYueTsKICAgICAgICB9CgogICAgICAgIGlmIChtaW56ID09PSB1bmRlZmluZWQgfHwgdi56IDwgbWlueikgewogICAgICAgICAgbWlueiA9IHYuejsKICAgICAgICB9CgogICAgICAgIGlmIChtYXh6ID09PSB1bmRlZmluZWQgfHwgdi56ID4gbWF4eikgewogICAgICAgICAgbWF4eiA9IHYuejsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIG1pbi5zZXQobWlueCwgbWlueSwgbWlueik7CiAgICAgIG1heC5zZXQobWF4eCwgbWF4eSwgbWF4eik7CiAgICB9CiAgICAvKioKICAgICAqIEdldCBhcHByb3hpbWF0ZSBjb252ZXggdm9sdW1lCiAgICAgKi8KCgogICAgdm9sdW1lKCkgewogICAgICByZXR1cm4gNC4wICogTWF0aC5QSSAqIHRoaXMuYm91bmRpbmdTcGhlcmVSYWRpdXMgLyAzLjA7CiAgICB9CiAgICAvKioKICAgICAqIEdldCBhbiBhdmVyYWdlIG9mIGFsbCB0aGUgdmVydGljZXMgcG9zaXRpb25zCiAgICAgKi8KCgogICAgZ2V0QXZlcmFnZVBvaW50TG9jYWwodGFyZ2V0KSB7CiAgICAgIGlmICh0YXJnZXQgPT09IHZvaWQgMCkgewogICAgICAgIHRhcmdldCA9IG5ldyBWZWMzKCk7CiAgICAgIH0KCiAgICAgIGNvbnN0IHZlcnRzID0gdGhpcy52ZXJ0aWNlczsKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdmVydHMubGVuZ3RoOyBpKyspIHsKICAgICAgICB0YXJnZXQudmFkZCh2ZXJ0c1tpXSwgdGFyZ2V0KTsKICAgICAgfQoKICAgICAgdGFyZ2V0LnNjYWxlKDEgLyB2ZXJ0cy5sZW5ndGgsIHRhcmdldCk7CiAgICAgIHJldHVybiB0YXJnZXQ7CiAgICB9CiAgICAvKioKICAgICAqIFRyYW5zZm9ybSBhbGwgbG9jYWwgcG9pbnRzLiBXaWxsIGNoYW5nZSB0aGUgLnZlcnRpY2VzCiAgICAgKi8KCgogICAgdHJhbnNmb3JtQWxsUG9pbnRzKG9mZnNldCwgcXVhdCkgewogICAgICBjb25zdCBuID0gdGhpcy52ZXJ0aWNlcy5sZW5ndGg7CiAgICAgIGNvbnN0IHZlcnRzID0gdGhpcy52ZXJ0aWNlczsgLy8gQXBwbHkgcm90YXRpb24KCiAgICAgIGlmIChxdWF0KSB7CiAgICAgICAgLy8gUm90YXRlIHZlcnRpY2VzCiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBuOyBpKyspIHsKICAgICAgICAgIGNvbnN0IHYgPSB2ZXJ0c1tpXTsKICAgICAgICAgIHF1YXQudm11bHQodiwgdik7CiAgICAgICAgfSAvLyBSb3RhdGUgZmFjZSBub3JtYWxzCgoKICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMuZmFjZU5vcm1hbHMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgIGNvbnN0IHYgPSB0aGlzLmZhY2VOb3JtYWxzW2ldOwogICAgICAgICAgcXVhdC52bXVsdCh2LCB2KTsKICAgICAgICB9CiAgICAgICAgLyoKICAgICAgICAgICAgICAvLyBSb3RhdGUgZWRnZXMKICAgICAgICAgICAgICBmb3IobGV0IGk9MDsgaTx0aGlzLnVuaXF1ZUVkZ2VzLmxlbmd0aDsgaSsrKXsKICAgICAgICAgICAgICAgICAgY29uc3QgdiA9IHRoaXMudW5pcXVlRWRnZXNbaV07CiAgICAgICAgICAgICAgICAgIHF1YXQudm11bHQodix2KTsKICAgICAgICAgICAgICB9Ki8KCiAgICAgIH0gLy8gQXBwbHkgb2Zmc2V0CgoKICAgICAgaWYgKG9mZnNldCkgewogICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbjsgaSsrKSB7CiAgICAgICAgICBjb25zdCB2ID0gdmVydHNbaV07CiAgICAgICAgICB2LnZhZGQob2Zmc2V0LCB2KTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogQ2hlY2tzIHdoZXRoZXIgcCBpcyBpbnNpZGUgdGhlIHBvbHloZWRyYS4gTXVzdCBiZSBpbiBsb2NhbCBjb29yZHMuCiAgICAgKiBUaGUgcG9pbnQgbGllcyBvdXRzaWRlIG9mIHRoZSBjb252ZXggaHVsbCBvZiB0aGUgb3RoZXIgcG9pbnRzIGlmIGFuZCBvbmx5IGlmIHRoZSBkaXJlY3Rpb24KICAgICAqIG9mIGFsbCB0aGUgdmVjdG9ycyBmcm9tIGl0IHRvIHRob3NlIG90aGVyIHBvaW50cyBhcmUgb24gbGVzcyB0aGFuIG9uZSBoYWxmIG9mIGEgc3BoZXJlIGFyb3VuZCBpdC4KICAgICAqIEBwYXJhbSBwIEEgcG9pbnQgZ2l2ZW4gaW4gbG9jYWwgY29vcmRpbmF0ZXMKICAgICAqLwoKCiAgICBwb2ludElzSW5zaWRlKHApIHsKICAgICAgY29uc3QgdmVydHMgPSB0aGlzLnZlcnRpY2VzOwogICAgICBjb25zdCBmYWNlcyA9IHRoaXMuZmFjZXM7CiAgICAgIGNvbnN0IG5vcm1hbHMgPSB0aGlzLmZhY2VOb3JtYWxzOwogICAgICBjb25zdCBwb3NpdGl2ZVJlc3VsdCA9IG51bGw7CiAgICAgIGNvbnN0IHBvaW50SW5zaWRlID0gbmV3IFZlYzMoKTsKICAgICAgdGhpcy5nZXRBdmVyYWdlUG9pbnRMb2NhbChwb2ludEluc2lkZSk7CgogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMuZmFjZXMubGVuZ3RoOyBpKyspIHsKICAgICAgICBsZXQgbiA9IG5vcm1hbHNbaV07CiAgICAgICAgY29uc3QgdiA9IHZlcnRzW2ZhY2VzW2ldWzBdXTsgLy8gV2Ugb25seSBuZWVkIG9uZSBwb2ludCBpbiB0aGUgZmFjZQogICAgICAgIC8vIFRoaXMgZG90IHByb2R1Y3QgZGV0ZXJtaW5lcyB3aGljaCBzaWRlIG9mIHRoZSBlZGdlIHRoZSBwb2ludCBpcwoKICAgICAgICBjb25zdCB2VG9QID0gbmV3IFZlYzMoKTsKICAgICAgICBwLnZzdWIodiwgdlRvUCk7CiAgICAgICAgY29uc3QgcjEgPSBuLmRvdCh2VG9QKTsKICAgICAgICBjb25zdCB2VG9Qb2ludEluc2lkZSA9IG5ldyBWZWMzKCk7CiAgICAgICAgcG9pbnRJbnNpZGUudnN1Yih2LCB2VG9Qb2ludEluc2lkZSk7CiAgICAgICAgY29uc3QgcjIgPSBuLmRvdCh2VG9Qb2ludEluc2lkZSk7CgogICAgICAgIGlmIChyMSA8IDAgJiYgcjIgPiAwIHx8IHIxID4gMCAmJiByMiA8IDApIHsKICAgICAgICAgIHJldHVybiBmYWxzZTsgLy8gRW5jb3VudGVyZWQgc29tZSBvdGhlciBzaWduLiBFeGl0LgogICAgICAgIH0KICAgICAgfSAvLyBJZiB3ZSBnb3QgaGVyZSwgYWxsIGRvdCBwcm9kdWN0cyB3ZXJlIG9mIHRoZSBzYW1lIHNpZ24uCgoKICAgICAgcmV0dXJuIHBvc2l0aXZlUmVzdWx0ID8gMSA6IC0xOwogICAgfQogICAgLyoqCiAgICAgKiBHZXQgbWF4IGFuZCBtaW4gZG90IHByb2R1Y3Qgb2YgYSBjb252ZXggaHVsbCBhdCBwb3NpdGlvbiAocG9zLHF1YXQpIHByb2plY3RlZCBvbnRvIGFuIGF4aXMuCiAgICAgKiBSZXN1bHRzIGFyZSBzYXZlZCBpbiB0aGUgYXJyYXkgbWF4bWluLgogICAgICogQHBhcmFtIHJlc3VsdCByZXN1bHRbMF0gYW5kIHJlc3VsdFsxXSB3aWxsIGJlIHNldCB0byBtYXhpbXVtIGFuZCBtaW5pbXVtLCByZXNwZWN0aXZlbHkuCiAgICAgKi8KCgogICAgc3RhdGljIHByb2plY3Qoc2hhcGUsIGF4aXMsIHBvcywgcXVhdCwgcmVzdWx0KSB7CiAgICAgIGNvbnN0IG4gPSBzaGFwZS52ZXJ0aWNlcy5sZW5ndGg7CiAgICAgIGNvbnN0IGxvY2FsQXhpcyA9IHByb2plY3RfbG9jYWxBeGlzOwogICAgICBsZXQgbWF4ID0gMDsKICAgICAgbGV0IG1pbiA9IDA7CiAgICAgIGNvbnN0IGxvY2FsT3JpZ2luID0gcHJvamVjdF9sb2NhbE9yaWdpbjsKICAgICAgY29uc3QgdnMgPSBzaGFwZS52ZXJ0aWNlczsKICAgICAgbG9jYWxPcmlnaW4uc2V0WmVybygpOyAvLyBUcmFuc2Zvcm0gdGhlIGF4aXMgdG8gbG9jYWwKCiAgICAgIFRyYW5zZm9ybS52ZWN0b3JUb0xvY2FsRnJhbWUocG9zLCBxdWF0LCBheGlzLCBsb2NhbEF4aXMpOwogICAgICBUcmFuc2Zvcm0ucG9pbnRUb0xvY2FsRnJhbWUocG9zLCBxdWF0LCBsb2NhbE9yaWdpbiwgbG9jYWxPcmlnaW4pOwogICAgICBjb25zdCBhZGQgPSBsb2NhbE9yaWdpbi5kb3QobG9jYWxBeGlzKTsKICAgICAgbWluID0gbWF4ID0gdnNbMF0uZG90KGxvY2FsQXhpcyk7CgogICAgICBmb3IgKGxldCBpID0gMTsgaSA8IG47IGkrKykgewogICAgICAgIGNvbnN0IHZhbCA9IHZzW2ldLmRvdChsb2NhbEF4aXMpOwoKICAgICAgICBpZiAodmFsID4gbWF4KSB7CiAgICAgICAgICBtYXggPSB2YWw7CiAgICAgICAgfQoKICAgICAgICBpZiAodmFsIDwgbWluKSB7CiAgICAgICAgICBtaW4gPSB2YWw7CiAgICAgICAgfQogICAgICB9CgogICAgICBtaW4gLT0gYWRkOwogICAgICBtYXggLT0gYWRkOwoKICAgICAgaWYgKG1pbiA+IG1heCkgewogICAgICAgIC8vIEluY29uc2lzdGVudCAtIHN3YXAKICAgICAgICBjb25zdCB0ZW1wID0gbWluOwogICAgICAgIG1pbiA9IG1heDsKICAgICAgICBtYXggPSB0ZW1wOwogICAgICB9IC8vIE91dHB1dAoKCiAgICAgIHJlc3VsdFswXSA9IG1heDsKICAgICAgcmVzdWx0WzFdID0gbWluOwogICAgfQoKICB9CiAgY29uc3QgbWF4bWluQSA9IFtdOwogIGNvbnN0IG1heG1pbkIgPSBbXTsKICBuZXcgVmVjMygpOwogIGNvbnN0IHByb2plY3RfbG9jYWxBeGlzID0gbmV3IFZlYzMoKTsKICBjb25zdCBwcm9qZWN0X2xvY2FsT3JpZ2luID0gbmV3IFZlYzMoKTsKCiAgLyoqCiAgICogQSAzZCBib3ggc2hhcGUuCiAgICogQGV4YW1wbGUKICAgKiAgICAgY29uc3Qgc2l6ZSA9IDEKICAgKiAgICAgY29uc3QgaGFsZkV4dGVudHMgPSBuZXcgQ0FOTk9OLlZlYzMoc2l6ZSwgc2l6ZSwgc2l6ZSkKICAgKiAgICAgY29uc3QgYm94U2hhcGUgPSBuZXcgQ0FOTk9OLkJveChoYWxmRXh0ZW50cykKICAgKiAgICAgY29uc3QgYm94Qm9keSA9IG5ldyBDQU5OT04uQm9keSh7IG1hc3M6IDEsIHNoYXBlOiBib3hTaGFwZSB9KQogICAqICAgICB3b3JsZC5hZGRCb2R5KGJveEJvZHkpCiAgICovCiAgY2xhc3MgQm94IGV4dGVuZHMgU2hhcGUgewogICAgLyoqCiAgICAgKiBUaGUgaGFsZiBleHRlbnRzIG9mIHRoZSBib3guCiAgICAgKi8KCiAgICAvKioKICAgICAqIFVzZWQgYnkgdGhlIGNvbnRhY3QgZ2VuZXJhdG9yIHRvIG1ha2UgY29udGFjdHMgd2l0aCBvdGhlciBjb252ZXggcG9seWhlZHJhIGZvciBleGFtcGxlLgogICAgICovCiAgICBjb25zdHJ1Y3RvcihoYWxmRXh0ZW50cykgewogICAgICBzdXBlcih7CiAgICAgICAgdHlwZTogU2hhcGUudHlwZXMuQk9YCiAgICAgIH0pOwogICAgICB0aGlzLmhhbGZFeHRlbnRzID0gaGFsZkV4dGVudHM7CiAgICAgIHRoaXMuY29udmV4UG9seWhlZHJvblJlcHJlc2VudGF0aW9uID0gbnVsbDsKICAgICAgdGhpcy51cGRhdGVDb252ZXhQb2x5aGVkcm9uUmVwcmVzZW50YXRpb24oKTsKICAgICAgdGhpcy51cGRhdGVCb3VuZGluZ1NwaGVyZVJhZGl1cygpOwogICAgfQogICAgLyoqCiAgICAgKiBVcGRhdGVzIHRoZSBsb2NhbCBjb252ZXggcG9seWhlZHJvbiByZXByZXNlbnRhdGlvbiB1c2VkIGZvciBzb21lIGNvbGxpc2lvbnMuCiAgICAgKi8KCgogICAgdXBkYXRlQ29udmV4UG9seWhlZHJvblJlcHJlc2VudGF0aW9uKCkgewogICAgICBjb25zdCBzeCA9IHRoaXMuaGFsZkV4dGVudHMueDsKICAgICAgY29uc3Qgc3kgPSB0aGlzLmhhbGZFeHRlbnRzLnk7CiAgICAgIGNvbnN0IHN6ID0gdGhpcy5oYWxmRXh0ZW50cy56OwogICAgICBjb25zdCBWID0gVmVjMzsKICAgICAgY29uc3QgdmVydGljZXMgPSBbbmV3IFYoLXN4LCAtc3ksIC1zeiksIG5ldyBWKHN4LCAtc3ksIC1zeiksIG5ldyBWKHN4LCBzeSwgLXN6KSwgbmV3IFYoLXN4LCBzeSwgLXN6KSwgbmV3IFYoLXN4LCAtc3ksIHN6KSwgbmV3IFYoc3gsIC1zeSwgc3opLCBuZXcgVihzeCwgc3ksIHN6KSwgbmV3IFYoLXN4LCBzeSwgc3opXTsKICAgICAgY29uc3QgZmFjZXMgPSBbWzMsIDIsIDEsIDBdLCAvLyAtegogICAgICBbNCwgNSwgNiwgN10sIC8vICt6CiAgICAgIFs1LCA0LCAwLCAxXSwgLy8gLXkKICAgICAgWzIsIDMsIDcsIDZdLCAvLyAreQogICAgICBbMCwgNCwgNywgM10sIC8vIC14CiAgICAgIFsxLCAyLCA2LCA1XSAvLyAreAogICAgICBdOwogICAgICBjb25zdCBheGVzID0gW25ldyBWKDAsIDAsIDEpLCBuZXcgVigwLCAxLCAwKSwgbmV3IFYoMSwgMCwgMCldOwogICAgICBjb25zdCBoID0gbmV3IENvbnZleFBvbHloZWRyb24oewogICAgICAgIHZlcnRpY2VzLAogICAgICAgIGZhY2VzLAogICAgICAgIGF4ZXMKICAgICAgfSk7CiAgICAgIHRoaXMuY29udmV4UG9seWhlZHJvblJlcHJlc2VudGF0aW9uID0gaDsKICAgICAgaC5tYXRlcmlhbCA9IHRoaXMubWF0ZXJpYWw7CiAgICB9CiAgICAvKioKICAgICAqIENhbGN1bGF0ZSB0aGUgaW5lcnRpYSBvZiB0aGUgYm94LgogICAgICovCgoKICAgIGNhbGN1bGF0ZUxvY2FsSW5lcnRpYShtYXNzLCB0YXJnZXQpIHsKICAgICAgaWYgKHRhcmdldCA9PT0gdm9pZCAwKSB7CiAgICAgICAgdGFyZ2V0ID0gbmV3IFZlYzMoKTsKICAgICAgfQoKICAgICAgQm94LmNhbGN1bGF0ZUluZXJ0aWEodGhpcy5oYWxmRXh0ZW50cywgbWFzcywgdGFyZ2V0KTsKICAgICAgcmV0dXJuIHRhcmdldDsKICAgIH0KCiAgICBzdGF0aWMgY2FsY3VsYXRlSW5lcnRpYShoYWxmRXh0ZW50cywgbWFzcywgdGFyZ2V0KSB7CiAgICAgIGNvbnN0IGUgPSBoYWxmRXh0ZW50czsKICAgICAgdGFyZ2V0LnggPSAxLjAgLyAxMi4wICogbWFzcyAqICgyICogZS55ICogMiAqIGUueSArIDIgKiBlLnogKiAyICogZS56KTsKICAgICAgdGFyZ2V0LnkgPSAxLjAgLyAxMi4wICogbWFzcyAqICgyICogZS54ICogMiAqIGUueCArIDIgKiBlLnogKiAyICogZS56KTsKICAgICAgdGFyZ2V0LnogPSAxLjAgLyAxMi4wICogbWFzcyAqICgyICogZS55ICogMiAqIGUueSArIDIgKiBlLnggKiAyICogZS54KTsKICAgIH0KICAgIC8qKgogICAgICogR2V0IHRoZSBib3ggNiBzaWRlIG5vcm1hbHMKICAgICAqIEBwYXJhbSBzaXhUYXJnZXRWZWN0b3JzIEFuIGFycmF5IG9mIDYgdmVjdG9ycywgdG8gc3RvcmUgdGhlIHJlc3VsdGluZyBzaWRlIG5vcm1hbHMgaW4uCiAgICAgKiBAcGFyYW0gcXVhdCBPcmllbnRhdGlvbiB0byBhcHBseSB0byB0aGUgbm9ybWFsIHZlY3RvcnMuIElmIG5vdCBwcm92aWRlZCwgdGhlIHZlY3RvcnMgd2lsbCBiZSBpbiByZXNwZWN0IHRvIHRoZSBsb2NhbCBmcmFtZS4KICAgICAqLwoKCiAgICBnZXRTaWRlTm9ybWFscyhzaXhUYXJnZXRWZWN0b3JzLCBxdWF0KSB7CiAgICAgIGNvbnN0IHNpZGVzID0gc2l4VGFyZ2V0VmVjdG9yczsKICAgICAgY29uc3QgZXggPSB0aGlzLmhhbGZFeHRlbnRzOwogICAgICBzaWRlc1swXS5zZXQoZXgueCwgMCwgMCk7CiAgICAgIHNpZGVzWzFdLnNldCgwLCBleC55LCAwKTsKICAgICAgc2lkZXNbMl0uc2V0KDAsIDAsIGV4LnopOwogICAgICBzaWRlc1szXS5zZXQoLWV4LngsIDAsIDApOwogICAgICBzaWRlc1s0XS5zZXQoMCwgLWV4LnksIDApOwogICAgICBzaWRlc1s1XS5zZXQoMCwgMCwgLWV4LnopOwoKICAgICAgaWYgKHF1YXQgIT09IHVuZGVmaW5lZCkgewogICAgICAgIGZvciAobGV0IGkgPSAwOyBpICE9PSBzaWRlcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgcXVhdC52bXVsdChzaWRlc1tpXSwgc2lkZXNbaV0pOwogICAgICAgIH0KICAgICAgfQoKICAgICAgcmV0dXJuIHNpZGVzOwogICAgfQogICAgLyoqCiAgICAgKiBSZXR1cm5zIHRoZSB2b2x1bWUgb2YgdGhlIGJveC4KICAgICAqLwoKCiAgICB2b2x1bWUoKSB7CiAgICAgIHJldHVybiA4LjAgKiB0aGlzLmhhbGZFeHRlbnRzLnggKiB0aGlzLmhhbGZFeHRlbnRzLnkgKiB0aGlzLmhhbGZFeHRlbnRzLno7CiAgICB9CiAgICAvKioKICAgICAqIHVwZGF0ZUJvdW5kaW5nU3BoZXJlUmFkaXVzCiAgICAgKi8KCgogICAgdXBkYXRlQm91bmRpbmdTcGhlcmVSYWRpdXMoKSB7CiAgICAgIHRoaXMuYm91bmRpbmdTcGhlcmVSYWRpdXMgPSB0aGlzLmhhbGZFeHRlbnRzLmxlbmd0aCgpOwogICAgfQogICAgLyoqCiAgICAgKiBmb3JFYWNoV29ybGRDb3JuZXIKICAgICAqLwoKCiAgICBmb3JFYWNoV29ybGRDb3JuZXIocG9zLCBxdWF0LCBjYWxsYmFjaykgewogICAgICBjb25zdCBlID0gdGhpcy5oYWxmRXh0ZW50czsKICAgICAgY29uc3QgY29ybmVycyA9IFtbZS54LCBlLnksIGUuel0sIFstZS54LCBlLnksIGUuel0sIFstZS54LCAtZS55LCBlLnpdLCBbLWUueCwgLWUueSwgLWUuel0sIFtlLngsIC1lLnksIC1lLnpdLCBbZS54LCBlLnksIC1lLnpdLCBbLWUueCwgZS55LCAtZS56XSwgW2UueCwgLWUueSwgZS56XV07CgogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGNvcm5lcnMubGVuZ3RoOyBpKyspIHsKICAgICAgICB3b3JsZENvcm5lclRlbXBQb3Muc2V0KGNvcm5lcnNbaV1bMF0sIGNvcm5lcnNbaV1bMV0sIGNvcm5lcnNbaV1bMl0pOwogICAgICAgIHF1YXQudm11bHQod29ybGRDb3JuZXJUZW1wUG9zLCB3b3JsZENvcm5lclRlbXBQb3MpOwogICAgICAgIHBvcy52YWRkKHdvcmxkQ29ybmVyVGVtcFBvcywgd29ybGRDb3JuZXJUZW1wUG9zKTsKICAgICAgICBjYWxsYmFjayh3b3JsZENvcm5lclRlbXBQb3MueCwgd29ybGRDb3JuZXJUZW1wUG9zLnksIHdvcmxkQ29ybmVyVGVtcFBvcy56KTsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBjYWxjdWxhdGVXb3JsZEFBQkIKICAgICAqLwoKCiAgICBjYWxjdWxhdGVXb3JsZEFBQkIocG9zLCBxdWF0LCBtaW4sIG1heCkgewogICAgICBjb25zdCBlID0gdGhpcy5oYWxmRXh0ZW50czsKICAgICAgd29ybGRDb3JuZXJzVGVtcFswXS5zZXQoZS54LCBlLnksIGUueik7CiAgICAgIHdvcmxkQ29ybmVyc1RlbXBbMV0uc2V0KC1lLngsIGUueSwgZS56KTsKICAgICAgd29ybGRDb3JuZXJzVGVtcFsyXS5zZXQoLWUueCwgLWUueSwgZS56KTsKICAgICAgd29ybGRDb3JuZXJzVGVtcFszXS5zZXQoLWUueCwgLWUueSwgLWUueik7CiAgICAgIHdvcmxkQ29ybmVyc1RlbXBbNF0uc2V0KGUueCwgLWUueSwgLWUueik7CiAgICAgIHdvcmxkQ29ybmVyc1RlbXBbNV0uc2V0KGUueCwgZS55LCAtZS56KTsKICAgICAgd29ybGRDb3JuZXJzVGVtcFs2XS5zZXQoLWUueCwgZS55LCAtZS56KTsKICAgICAgd29ybGRDb3JuZXJzVGVtcFs3XS5zZXQoZS54LCAtZS55LCBlLnopOwogICAgICBjb25zdCB3YyA9IHdvcmxkQ29ybmVyc1RlbXBbMF07CiAgICAgIHF1YXQudm11bHQod2MsIHdjKTsKICAgICAgcG9zLnZhZGQod2MsIHdjKTsKICAgICAgbWF4LmNvcHkod2MpOwogICAgICBtaW4uY29weSh3Yyk7CgogICAgICBmb3IgKGxldCBpID0gMTsgaSA8IDg7IGkrKykgewogICAgICAgIGNvbnN0IHdjID0gd29ybGRDb3JuZXJzVGVtcFtpXTsKICAgICAgICBxdWF0LnZtdWx0KHdjLCB3Yyk7CiAgICAgICAgcG9zLnZhZGQod2MsIHdjKTsKICAgICAgICBjb25zdCB4ID0gd2MueDsKICAgICAgICBjb25zdCB5ID0gd2MueTsKICAgICAgICBjb25zdCB6ID0gd2MuejsKCiAgICAgICAgaWYgKHggPiBtYXgueCkgewogICAgICAgICAgbWF4LnggPSB4OwogICAgICAgIH0KCiAgICAgICAgaWYgKHkgPiBtYXgueSkgewogICAgICAgICAgbWF4LnkgPSB5OwogICAgICAgIH0KCiAgICAgICAgaWYgKHogPiBtYXgueikgewogICAgICAgICAgbWF4LnogPSB6OwogICAgICAgIH0KCiAgICAgICAgaWYgKHggPCBtaW4ueCkgewogICAgICAgICAgbWluLnggPSB4OwogICAgICAgIH0KCiAgICAgICAgaWYgKHkgPCBtaW4ueSkgewogICAgICAgICAgbWluLnkgPSB5OwogICAgICAgIH0KCiAgICAgICAgaWYgKHogPCBtaW4ueikgewogICAgICAgICAgbWluLnogPSB6OwogICAgICAgIH0KICAgICAgfSAvLyBHZXQgZWFjaCBheGlzIG1heAogICAgICAvLyBtaW4uc2V0KEluZmluaXR5LEluZmluaXR5LEluZmluaXR5KTsKICAgICAgLy8gbWF4LnNldCgtSW5maW5pdHksLUluZmluaXR5LC1JbmZpbml0eSk7CiAgICAgIC8vIHRoaXMuZm9yRWFjaFdvcmxkQ29ybmVyKHBvcyxxdWF0LGZ1bmN0aW9uKHgseSx6KXsKICAgICAgLy8gICAgIGlmKHggPiBtYXgueCl7CiAgICAgIC8vICAgICAgICAgbWF4LnggPSB4OwogICAgICAvLyAgICAgfQogICAgICAvLyAgICAgaWYoeSA+IG1heC55KXsKICAgICAgLy8gICAgICAgICBtYXgueSA9IHk7CiAgICAgIC8vICAgICB9CiAgICAgIC8vICAgICBpZih6ID4gbWF4LnopewogICAgICAvLyAgICAgICAgIG1heC56ID0gejsKICAgICAgLy8gICAgIH0KICAgICAgLy8gICAgIGlmKHggPCBtaW4ueCl7CiAgICAgIC8vICAgICAgICAgbWluLnggPSB4OwogICAgICAvLyAgICAgfQogICAgICAvLyAgICAgaWYoeSA8IG1pbi55KXsKICAgICAgLy8gICAgICAgICBtaW4ueSA9IHk7CiAgICAgIC8vICAgICB9CiAgICAgIC8vICAgICBpZih6IDwgbWluLnopewogICAgICAvLyAgICAgICAgIG1pbi56ID0gejsKICAgICAgLy8gICAgIH0KICAgICAgLy8gfSk7CgogICAgfQoKICB9CiAgY29uc3Qgd29ybGRDb3JuZXJUZW1wUG9zID0gbmV3IFZlYzMoKTsKICBjb25zdCB3b3JsZENvcm5lcnNUZW1wID0gW25ldyBWZWMzKCksIG5ldyBWZWMzKCksIG5ldyBWZWMzKCksIG5ldyBWZWMzKCksIG5ldyBWZWMzKCksIG5ldyBWZWMzKCksIG5ldyBWZWMzKCksIG5ldyBWZWMzKCldOwoKICAvKioKICAgKiBCT0RZX1RZUEVTCiAgICovCiAgY29uc3QgQk9EWV9UWVBFUyA9IHsKICAgIC8qKiBEWU5BTUlDICovCiAgICBEWU5BTUlDOiAxLAoKICAgIC8qKiBTVEFUSUMgKi8KICAgIFNUQVRJQzogMiwKCiAgICAvKiogS0lORU1BVElDICovCiAgICBLSU5FTUFUSUM6IDQKICB9OwogIC8qKgogICAqIEJvZHlUeXBlCiAgICovCgogIC8qKgogICAqIEJPRFlfU0xFRVBfU1RBVEVTCiAgICovCiAgY29uc3QgQk9EWV9TTEVFUF9TVEFURVMgPSB7CiAgICAvKiogQVdBS0UgKi8KICAgIEFXQUtFOiAwLAoKICAgIC8qKiBTTEVFUFkgKi8KICAgIFNMRUVQWTogMSwKCiAgICAvKiogU0xFRVBJTkcgKi8KICAgIFNMRUVQSU5HOiAyCiAgfTsKICAvKioKICAgKiBCb2R5U2xlZXBTdGF0ZQogICAqLwoKICAvKioKICAgKiBCYXNlIGNsYXNzIGZvciBhbGwgYm9keSB0eXBlcy4KICAgKiBAZXhhbXBsZQogICAqICAgICBjb25zdCBzaGFwZSA9IG5ldyBDQU5OT04uU3BoZXJlKDEpCiAgICogICAgIGNvbnN0IGJvZHkgPSBuZXcgQ0FOTk9OLkJvZHkoewogICAqICAgICAgIG1hc3M6IDEsCiAgICogICAgICAgc2hhcGUsCiAgICogICAgIH0pCiAgICogICAgIHdvcmxkLmFkZEJvZHkoYm9keSkKICAgKi8KICBjbGFzcyBCb2R5IGV4dGVuZHMgRXZlbnRUYXJnZXQgewogICAgLyoqCiAgICAgKiBEaXNwYXRjaGVkIGFmdGVyIHR3byBib2RpZXMgY29sbGlkZS4gVGhpcyBldmVudCBpcyBkaXNwYXRjaGVkIG9uIGVhY2gKICAgICAqIG9mIHRoZSB0d28gYm9kaWVzIGludm9sdmVkIGluIHRoZSBjb2xsaXNpb24uCiAgICAgKiBAZXZlbnQgY29sbGlkZQogICAgICogQHBhcmFtIGJvZHkgVGhlIGJvZHkgdGhhdCB3YXMgaW52b2x2ZWQgaW4gdGhlIGNvbGxpc2lvbi4KICAgICAqIEBwYXJhbSBjb250YWN0IFRoZSBkZXRhaWxzIG9mIHRoZSBjb2xsaXNpb24uCiAgICAgKi8KCiAgICAvKioKICAgICAqIEEgZHluYW1pYyBib2R5IGlzIGZ1bGx5IHNpbXVsYXRlZC4gQ2FuIGJlIG1vdmVkIG1hbnVhbGx5IGJ5IHRoZSB1c2VyLCBidXQgbm9ybWFsbHkgdGhleSBtb3ZlIGFjY29yZGluZyB0byBmb3JjZXMuIEEgZHluYW1pYyBib2R5IGNhbiBjb2xsaWRlIHdpdGggYWxsIGJvZHkgdHlwZXMuIEEgZHluYW1pYyBib2R5IGFsd2F5cyBoYXMgZmluaXRlLCBub24temVybyBtYXNzLgogICAgICovCgogICAgLyoqCiAgICAgKiBBIHN0YXRpYyBib2R5IGRvZXMgbm90IG1vdmUgZHVyaW5nIHNpbXVsYXRpb24gYW5kIGJlaGF2ZXMgYXMgaWYgaXQgaGFzIGluZmluaXRlIG1hc3MuIFN0YXRpYyBib2RpZXMgY2FuIGJlIG1vdmVkIG1hbnVhbGx5IGJ5IHNldHRpbmcgdGhlIHBvc2l0aW9uIG9mIHRoZSBib2R5LiBUaGUgdmVsb2NpdHkgb2YgYSBzdGF0aWMgYm9keSBpcyBhbHdheXMgemVyby4gU3RhdGljIGJvZGllcyBkbyBub3QgY29sbGlkZSB3aXRoIG90aGVyIHN0YXRpYyBvciBraW5lbWF0aWMgYm9kaWVzLgogICAgICovCgogICAgLyoqCiAgICAgKiBBIGtpbmVtYXRpYyBib2R5IG1vdmVzIHVuZGVyIHNpbXVsYXRpb24gYWNjb3JkaW5nIHRvIGl0cyB2ZWxvY2l0eS4gVGhleSBkbyBub3QgcmVzcG9uZCB0byBmb3JjZXMuIFRoZXkgY2FuIGJlIG1vdmVkIG1hbnVhbGx5LCBidXQgbm9ybWFsbHkgYSBraW5lbWF0aWMgYm9keSBpcyBtb3ZlZCBieSBzZXR0aW5nIGl0cyB2ZWxvY2l0eS4gQSBraW5lbWF0aWMgYm9keSBiZWhhdmVzIGFzIGlmIGl0IGhhcyBpbmZpbml0ZSBtYXNzLiBLaW5lbWF0aWMgYm9kaWVzIGRvIG5vdCBjb2xsaWRlIHdpdGggb3RoZXIgc3RhdGljIG9yIGtpbmVtYXRpYyBib2RpZXMuCiAgICAgKi8KCiAgICAvKioKICAgICAqIEFXQUtFCiAgICAgKi8KCiAgICAvKioKICAgICAqIFNMRUVQWQogICAgICovCgogICAgLyoqCiAgICAgKiBTTEVFUElORwogICAgICovCgogICAgLyoqCiAgICAgKiBEaXNwYXRjaGVkIGFmdGVyIGEgc2xlZXBpbmcgYm9keSBoYXMgd29rZW4gdXAuCiAgICAgKiBAZXZlbnQgd2FrZXVwCiAgICAgKi8KCiAgICAvKioKICAgICAqIERpc3BhdGNoZWQgYWZ0ZXIgYSBib2R5IGhhcyBnb25lIGluIHRvIHRoZSBzbGVlcHkgc3RhdGUuCiAgICAgKiBAZXZlbnQgc2xlZXB5CiAgICAgKi8KCiAgICAvKioKICAgICAqIERpc3BhdGNoZWQgYWZ0ZXIgYSBib2R5IGhhcyBmYWxsZW4gYXNsZWVwLgogICAgICogQGV2ZW50IHNsZWVwCiAgICAgKi8KICAgIGNvbnN0cnVjdG9yKG9wdGlvbnMpIHsKICAgICAgaWYgKG9wdGlvbnMgPT09IHZvaWQgMCkgewogICAgICAgIG9wdGlvbnMgPSB7fTsKICAgICAgfQoKICAgICAgc3VwZXIoKTsKICAgICAgdGhpcy5pZCA9IEJvZHkuaWRDb3VudGVyKys7CiAgICAgIHRoaXMuaW5kZXggPSAtMTsKICAgICAgdGhpcy53b3JsZCA9IG51bGw7CiAgICAgIHRoaXMudmxhbWJkYSA9IG5ldyBWZWMzKCk7CiAgICAgIHRoaXMuY29sbGlzaW9uRmlsdGVyR3JvdXAgPSB0eXBlb2Ygb3B0aW9ucy5jb2xsaXNpb25GaWx0ZXJHcm91cCA9PT0gJ251bWJlcicgPyBvcHRpb25zLmNvbGxpc2lvbkZpbHRlckdyb3VwIDogMTsKICAgICAgdGhpcy5jb2xsaXNpb25GaWx0ZXJNYXNrID0gdHlwZW9mIG9wdGlvbnMuY29sbGlzaW9uRmlsdGVyTWFzayA9PT0gJ251bWJlcicgPyBvcHRpb25zLmNvbGxpc2lvbkZpbHRlck1hc2sgOiAtMTsKICAgICAgdGhpcy5jb2xsaXNpb25SZXNwb25zZSA9IHR5cGVvZiBvcHRpb25zLmNvbGxpc2lvblJlc3BvbnNlID09PSAnYm9vbGVhbicgPyBvcHRpb25zLmNvbGxpc2lvblJlc3BvbnNlIDogdHJ1ZTsKICAgICAgdGhpcy5wb3NpdGlvbiA9IG5ldyBWZWMzKCk7CiAgICAgIHRoaXMucHJldmlvdXNQb3NpdGlvbiA9IG5ldyBWZWMzKCk7CiAgICAgIHRoaXMuaW50ZXJwb2xhdGVkUG9zaXRpb24gPSBuZXcgVmVjMygpOwogICAgICB0aGlzLmluaXRQb3NpdGlvbiA9IG5ldyBWZWMzKCk7CgogICAgICBpZiAob3B0aW9ucy5wb3NpdGlvbikgewogICAgICAgIHRoaXMucG9zaXRpb24uY29weShvcHRpb25zLnBvc2l0aW9uKTsKICAgICAgICB0aGlzLnByZXZpb3VzUG9zaXRpb24uY29weShvcHRpb25zLnBvc2l0aW9uKTsKICAgICAgICB0aGlzLmludGVycG9sYXRlZFBvc2l0aW9uLmNvcHkob3B0aW9ucy5wb3NpdGlvbik7CiAgICAgICAgdGhpcy5pbml0UG9zaXRpb24uY29weShvcHRpb25zLnBvc2l0aW9uKTsKICAgICAgfQoKICAgICAgdGhpcy52ZWxvY2l0eSA9IG5ldyBWZWMzKCk7CgogICAgICBpZiAob3B0aW9ucy52ZWxvY2l0eSkgewogICAgICAgIHRoaXMudmVsb2NpdHkuY29weShvcHRpb25zLnZlbG9jaXR5KTsKICAgICAgfQoKICAgICAgdGhpcy5pbml0VmVsb2NpdHkgPSBuZXcgVmVjMygpOwogICAgICB0aGlzLmZvcmNlID0gbmV3IFZlYzMoKTsKICAgICAgY29uc3QgbWFzcyA9IHR5cGVvZiBvcHRpb25zLm1hc3MgPT09ICdudW1iZXInID8gb3B0aW9ucy5tYXNzIDogMDsKICAgICAgdGhpcy5tYXNzID0gbWFzczsKICAgICAgdGhpcy5pbnZNYXNzID0gbWFzcyA+IDAgPyAxLjAgLyBtYXNzIDogMDsKICAgICAgdGhpcy5tYXRlcmlhbCA9IG9wdGlvbnMubWF0ZXJpYWwgfHwgbnVsbDsKICAgICAgdGhpcy5saW5lYXJEYW1waW5nID0gdHlwZW9mIG9wdGlvbnMubGluZWFyRGFtcGluZyA9PT0gJ251bWJlcicgPyBvcHRpb25zLmxpbmVhckRhbXBpbmcgOiAwLjAxOwogICAgICB0aGlzLnR5cGUgPSBtYXNzIDw9IDAuMCA/IEJvZHkuU1RBVElDIDogQm9keS5EWU5BTUlDOwoKICAgICAgaWYgKHR5cGVvZiBvcHRpb25zLnR5cGUgPT09IHR5cGVvZiBCb2R5LlNUQVRJQykgewogICAgICAgIHRoaXMudHlwZSA9IG9wdGlvbnMudHlwZTsKICAgICAgfQoKICAgICAgdGhpcy5hbGxvd1NsZWVwID0gdHlwZW9mIG9wdGlvbnMuYWxsb3dTbGVlcCAhPT0gJ3VuZGVmaW5lZCcgPyBvcHRpb25zLmFsbG93U2xlZXAgOiB0cnVlOwogICAgICB0aGlzLnNsZWVwU3RhdGUgPSBCb2R5LkFXQUtFOwogICAgICB0aGlzLnNsZWVwU3BlZWRMaW1pdCA9IHR5cGVvZiBvcHRpb25zLnNsZWVwU3BlZWRMaW1pdCAhPT0gJ3VuZGVmaW5lZCcgPyBvcHRpb25zLnNsZWVwU3BlZWRMaW1pdCA6IDAuMTsKICAgICAgdGhpcy5zbGVlcFRpbWVMaW1pdCA9IHR5cGVvZiBvcHRpb25zLnNsZWVwVGltZUxpbWl0ICE9PSAndW5kZWZpbmVkJyA/IG9wdGlvbnMuc2xlZXBUaW1lTGltaXQgOiAxOwogICAgICB0aGlzLnRpbWVMYXN0U2xlZXB5ID0gMDsKICAgICAgdGhpcy53YWtlVXBBZnRlck5hcnJvd3BoYXNlID0gZmFsc2U7CiAgICAgIHRoaXMudG9ycXVlID0gbmV3IFZlYzMoKTsKICAgICAgdGhpcy5xdWF0ZXJuaW9uID0gbmV3IFF1YXRlcm5pb24oKTsKICAgICAgdGhpcy5pbml0UXVhdGVybmlvbiA9IG5ldyBRdWF0ZXJuaW9uKCk7CiAgICAgIHRoaXMucHJldmlvdXNRdWF0ZXJuaW9uID0gbmV3IFF1YXRlcm5pb24oKTsKICAgICAgdGhpcy5pbnRlcnBvbGF0ZWRRdWF0ZXJuaW9uID0gbmV3IFF1YXRlcm5pb24oKTsKCiAgICAgIGlmIChvcHRpb25zLnF1YXRlcm5pb24pIHsKICAgICAgICB0aGlzLnF1YXRlcm5pb24uY29weShvcHRpb25zLnF1YXRlcm5pb24pOwogICAgICAgIHRoaXMuaW5pdFF1YXRlcm5pb24uY29weShvcHRpb25zLnF1YXRlcm5pb24pOwogICAgICAgIHRoaXMucHJldmlvdXNRdWF0ZXJuaW9uLmNvcHkob3B0aW9ucy5xdWF0ZXJuaW9uKTsKICAgICAgICB0aGlzLmludGVycG9sYXRlZFF1YXRlcm5pb24uY29weShvcHRpb25zLnF1YXRlcm5pb24pOwogICAgICB9CgogICAgICB0aGlzLmFuZ3VsYXJWZWxvY2l0eSA9IG5ldyBWZWMzKCk7CgogICAgICBpZiAob3B0aW9ucy5hbmd1bGFyVmVsb2NpdHkpIHsKICAgICAgICB0aGlzLmFuZ3VsYXJWZWxvY2l0eS5jb3B5KG9wdGlvbnMuYW5ndWxhclZlbG9jaXR5KTsKICAgICAgfQoKICAgICAgdGhpcy5pbml0QW5ndWxhclZlbG9jaXR5ID0gbmV3IFZlYzMoKTsKICAgICAgdGhpcy5zaGFwZXMgPSBbXTsKICAgICAgdGhpcy5zaGFwZU9mZnNldHMgPSBbXTsKICAgICAgdGhpcy5zaGFwZU9yaWVudGF0aW9ucyA9IFtdOwogICAgICB0aGlzLmluZXJ0aWEgPSBuZXcgVmVjMygpOwogICAgICB0aGlzLmludkluZXJ0aWEgPSBuZXcgVmVjMygpOwogICAgICB0aGlzLmludkluZXJ0aWFXb3JsZCA9IG5ldyBNYXQzKCk7CiAgICAgIHRoaXMuaW52TWFzc1NvbHZlID0gMDsKICAgICAgdGhpcy5pbnZJbmVydGlhU29sdmUgPSBuZXcgVmVjMygpOwogICAgICB0aGlzLmludkluZXJ0aWFXb3JsZFNvbHZlID0gbmV3IE1hdDMoKTsKICAgICAgdGhpcy5maXhlZFJvdGF0aW9uID0gdHlwZW9mIG9wdGlvbnMuZml4ZWRSb3RhdGlvbiAhPT0gJ3VuZGVmaW5lZCcgPyBvcHRpb25zLmZpeGVkUm90YXRpb24gOiBmYWxzZTsKICAgICAgdGhpcy5hbmd1bGFyRGFtcGluZyA9IHR5cGVvZiBvcHRpb25zLmFuZ3VsYXJEYW1waW5nICE9PSAndW5kZWZpbmVkJyA/IG9wdGlvbnMuYW5ndWxhckRhbXBpbmcgOiAwLjAxOwogICAgICB0aGlzLmxpbmVhckZhY3RvciA9IG5ldyBWZWMzKDEsIDEsIDEpOwoKICAgICAgaWYgKG9wdGlvbnMubGluZWFyRmFjdG9yKSB7CiAgICAgICAgdGhpcy5saW5lYXJGYWN0b3IuY29weShvcHRpb25zLmxpbmVhckZhY3Rvcik7CiAgICAgIH0KCiAgICAgIHRoaXMuYW5ndWxhckZhY3RvciA9IG5ldyBWZWMzKDEsIDEsIDEpOwoKICAgICAgaWYgKG9wdGlvbnMuYW5ndWxhckZhY3RvcikgewogICAgICAgIHRoaXMuYW5ndWxhckZhY3Rvci5jb3B5KG9wdGlvbnMuYW5ndWxhckZhY3Rvcik7CiAgICAgIH0KCiAgICAgIHRoaXMuYWFiYiA9IG5ldyBBQUJCKCk7CiAgICAgIHRoaXMuYWFiYk5lZWRzVXBkYXRlID0gdHJ1ZTsKICAgICAgdGhpcy5ib3VuZGluZ1JhZGl1cyA9IDA7CiAgICAgIHRoaXMud2xhbWJkYSA9IG5ldyBWZWMzKCk7CiAgICAgIHRoaXMuaXNUcmlnZ2VyID0gQm9vbGVhbihvcHRpb25zLmlzVHJpZ2dlcik7CgogICAgICBpZiAob3B0aW9ucy5zaGFwZSkgewogICAgICAgIHRoaXMuYWRkU2hhcGUob3B0aW9ucy5zaGFwZSk7CiAgICAgIH0KCiAgICAgIHRoaXMudXBkYXRlTWFzc1Byb3BlcnRpZXMoKTsKICAgIH0KICAgIC8qKgogICAgICogV2FrZSB0aGUgYm9keSB1cC4KICAgICAqLwoKCiAgICB3YWtlVXAoKSB7CiAgICAgIGNvbnN0IHByZXZTdGF0ZSA9IHRoaXMuc2xlZXBTdGF0ZTsKICAgICAgdGhpcy5zbGVlcFN0YXRlID0gQm9keS5BV0FLRTsKICAgICAgdGhpcy53YWtlVXBBZnRlck5hcnJvd3BoYXNlID0gZmFsc2U7CgogICAgICBpZiAocHJldlN0YXRlID09PSBCb2R5LlNMRUVQSU5HKSB7CiAgICAgICAgdGhpcy5kaXNwYXRjaEV2ZW50KEJvZHkud2FrZXVwRXZlbnQpOwogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIEZvcmNlIGJvZHkgc2xlZXAKICAgICAqLwoKCiAgICBzbGVlcCgpIHsKICAgICAgdGhpcy5zbGVlcFN0YXRlID0gQm9keS5TTEVFUElORzsKICAgICAgdGhpcy52ZWxvY2l0eS5zZXQoMCwgMCwgMCk7CiAgICAgIHRoaXMuYW5ndWxhclZlbG9jaXR5LnNldCgwLCAwLCAwKTsKICAgICAgdGhpcy53YWtlVXBBZnRlck5hcnJvd3BoYXNlID0gZmFsc2U7CiAgICB9CiAgICAvKioKICAgICAqIENhbGxlZCBldmVyeSB0aW1lc3RlcCB0byB1cGRhdGUgaW50ZXJuYWwgc2xlZXAgdGltZXIgYW5kIGNoYW5nZSBzbGVlcCBzdGF0ZSBpZiBuZWVkZWQuCiAgICAgKiBAcGFyYW0gdGltZSBUaGUgd29ybGQgdGltZSBpbiBzZWNvbmRzCiAgICAgKi8KCgogICAgc2xlZXBUaWNrKHRpbWUpIHsKICAgICAgaWYgKHRoaXMuYWxsb3dTbGVlcCkgewogICAgICAgIGNvbnN0IHNsZWVwU3RhdGUgPSB0aGlzLnNsZWVwU3RhdGU7CiAgICAgICAgY29uc3Qgc3BlZWRTcXVhcmVkID0gdGhpcy52ZWxvY2l0eS5sZW5ndGhTcXVhcmVkKCkgKyB0aGlzLmFuZ3VsYXJWZWxvY2l0eS5sZW5ndGhTcXVhcmVkKCk7CiAgICAgICAgY29uc3Qgc3BlZWRMaW1pdFNxdWFyZWQgPSB0aGlzLnNsZWVwU3BlZWRMaW1pdCAqKiAyOwoKICAgICAgICBpZiAoc2xlZXBTdGF0ZSA9PT0gQm9keS5BV0FLRSAmJiBzcGVlZFNxdWFyZWQgPCBzcGVlZExpbWl0U3F1YXJlZCkgewogICAgICAgICAgdGhpcy5zbGVlcFN0YXRlID0gQm9keS5TTEVFUFk7IC8vIFNsZWVweQoKICAgICAgICAgIHRoaXMudGltZUxhc3RTbGVlcHkgPSB0aW1lOwogICAgICAgICAgdGhpcy5kaXNwYXRjaEV2ZW50KEJvZHkuc2xlZXB5RXZlbnQpOwogICAgICAgIH0gZWxzZSBpZiAoc2xlZXBTdGF0ZSA9PT0gQm9keS5TTEVFUFkgJiYgc3BlZWRTcXVhcmVkID4gc3BlZWRMaW1pdFNxdWFyZWQpIHsKICAgICAgICAgIHRoaXMud2FrZVVwKCk7IC8vIFdha2UgdXAKICAgICAgICB9IGVsc2UgaWYgKHNsZWVwU3RhdGUgPT09IEJvZHkuU0xFRVBZICYmIHRpbWUgLSB0aGlzLnRpbWVMYXN0U2xlZXB5ID4gdGhpcy5zbGVlcFRpbWVMaW1pdCkgewogICAgICAgICAgdGhpcy5zbGVlcCgpOyAvLyBTbGVlcGluZwoKICAgICAgICAgIHRoaXMuZGlzcGF0Y2hFdmVudChCb2R5LnNsZWVwRXZlbnQpOwogICAgICAgIH0KICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBJZiB0aGUgYm9keSBpcyBzbGVlcGluZywgaXQgc2hvdWxkIGJlIGltbW92YWJsZSAvIGhhdmUgaW5maW5pdGUgbWFzcyBkdXJpbmcgc29sdmUuIFdlIHNvbHZlIGl0IGJ5IGhhdmluZyBhIHNlcGFyYXRlICJzb2x2ZSBtYXNzIi4KICAgICAqLwoKCiAgICB1cGRhdGVTb2x2ZU1hc3NQcm9wZXJ0aWVzKCkgewogICAgICBpZiAodGhpcy5zbGVlcFN0YXRlID09PSBCb2R5LlNMRUVQSU5HIHx8IHRoaXMudHlwZSA9PT0gQm9keS5LSU5FTUFUSUMpIHsKICAgICAgICB0aGlzLmludk1hc3NTb2x2ZSA9IDA7CiAgICAgICAgdGhpcy5pbnZJbmVydGlhU29sdmUuc2V0WmVybygpOwogICAgICAgIHRoaXMuaW52SW5lcnRpYVdvcmxkU29sdmUuc2V0WmVybygpOwogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMuaW52TWFzc1NvbHZlID0gdGhpcy5pbnZNYXNzOwogICAgICAgIHRoaXMuaW52SW5lcnRpYVNvbHZlLmNvcHkodGhpcy5pbnZJbmVydGlhKTsKICAgICAgICB0aGlzLmludkluZXJ0aWFXb3JsZFNvbHZlLmNvcHkodGhpcy5pbnZJbmVydGlhV29ybGQpOwogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIENvbnZlcnQgYSB3b3JsZCBwb2ludCB0byBsb2NhbCBib2R5IGZyYW1lLgogICAgICovCgoKICAgIHBvaW50VG9Mb2NhbEZyYW1lKHdvcmxkUG9pbnQsIHJlc3VsdCkgewogICAgICBpZiAocmVzdWx0ID09PSB2b2lkIDApIHsKICAgICAgICByZXN1bHQgPSBuZXcgVmVjMygpOwogICAgICB9CgogICAgICB3b3JsZFBvaW50LnZzdWIodGhpcy5wb3NpdGlvbiwgcmVzdWx0KTsKICAgICAgdGhpcy5xdWF0ZXJuaW9uLmNvbmp1Z2F0ZSgpLnZtdWx0KHJlc3VsdCwgcmVzdWx0KTsKICAgICAgcmV0dXJuIHJlc3VsdDsKICAgIH0KICAgIC8qKgogICAgICogQ29udmVydCBhIHdvcmxkIHZlY3RvciB0byBsb2NhbCBib2R5IGZyYW1lLgogICAgICovCgoKICAgIHZlY3RvclRvTG9jYWxGcmFtZSh3b3JsZFZlY3RvciwgcmVzdWx0KSB7CiAgICAgIGlmIChyZXN1bHQgPT09IHZvaWQgMCkgewogICAgICAgIHJlc3VsdCA9IG5ldyBWZWMzKCk7CiAgICAgIH0KCiAgICAgIHRoaXMucXVhdGVybmlvbi5jb25qdWdhdGUoKS52bXVsdCh3b3JsZFZlY3RvciwgcmVzdWx0KTsKICAgICAgcmV0dXJuIHJlc3VsdDsKICAgIH0KICAgIC8qKgogICAgICogQ29udmVydCBhIGxvY2FsIGJvZHkgcG9pbnQgdG8gd29ybGQgZnJhbWUuCiAgICAgKi8KCgogICAgcG9pbnRUb1dvcmxkRnJhbWUobG9jYWxQb2ludCwgcmVzdWx0KSB7CiAgICAgIGlmIChyZXN1bHQgPT09IHZvaWQgMCkgewogICAgICAgIHJlc3VsdCA9IG5ldyBWZWMzKCk7CiAgICAgIH0KCiAgICAgIHRoaXMucXVhdGVybmlvbi52bXVsdChsb2NhbFBvaW50LCByZXN1bHQpOwogICAgICByZXN1bHQudmFkZCh0aGlzLnBvc2l0aW9uLCByZXN1bHQpOwogICAgICByZXR1cm4gcmVzdWx0OwogICAgfQogICAgLyoqCiAgICAgKiBDb252ZXJ0IGEgbG9jYWwgYm9keSBwb2ludCB0byB3b3JsZCBmcmFtZS4KICAgICAqLwoKCiAgICB2ZWN0b3JUb1dvcmxkRnJhbWUobG9jYWxWZWN0b3IsIHJlc3VsdCkgewogICAgICBpZiAocmVzdWx0ID09PSB2b2lkIDApIHsKICAgICAgICByZXN1bHQgPSBuZXcgVmVjMygpOwogICAgICB9CgogICAgICB0aGlzLnF1YXRlcm5pb24udm11bHQobG9jYWxWZWN0b3IsIHJlc3VsdCk7CiAgICAgIHJldHVybiByZXN1bHQ7CiAgICB9CiAgICAvKioKICAgICAqIEFkZCBhIHNoYXBlIHRvIHRoZSBib2R5IHdpdGggYSBsb2NhbCBvZmZzZXQgYW5kIG9yaWVudGF0aW9uLgogICAgICogQHJldHVybiBUaGUgYm9keSBvYmplY3QsIGZvciBjaGFpbmFiaWxpdHkuCiAgICAgKi8KCgogICAgYWRkU2hhcGUoc2hhcGUsIF9vZmZzZXQsIF9vcmllbnRhdGlvbikgewogICAgICBjb25zdCBvZmZzZXQgPSBuZXcgVmVjMygpOwogICAgICBjb25zdCBvcmllbnRhdGlvbiA9IG5ldyBRdWF0ZXJuaW9uKCk7CgogICAgICBpZiAoX29mZnNldCkgewogICAgICAgIG9mZnNldC5jb3B5KF9vZmZzZXQpOwogICAgICB9CgogICAgICBpZiAoX29yaWVudGF0aW9uKSB7CiAgICAgICAgb3JpZW50YXRpb24uY29weShfb3JpZW50YXRpb24pOwogICAgICB9CgogICAgICB0aGlzLnNoYXBlcy5wdXNoKHNoYXBlKTsKICAgICAgdGhpcy5zaGFwZU9mZnNldHMucHVzaChvZmZzZXQpOwogICAgICB0aGlzLnNoYXBlT3JpZW50YXRpb25zLnB1c2gob3JpZW50YXRpb24pOwogICAgICB0aGlzLnVwZGF0ZU1hc3NQcm9wZXJ0aWVzKCk7CiAgICAgIHRoaXMudXBkYXRlQm91bmRpbmdSYWRpdXMoKTsKICAgICAgdGhpcy5hYWJiTmVlZHNVcGRhdGUgPSB0cnVlOwogICAgICBzaGFwZS5ib2R5ID0gdGhpczsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICAvKioKICAgICAqIFJlbW92ZSBhIHNoYXBlIGZyb20gdGhlIGJvZHkuCiAgICAgKiBAcmV0dXJuIFRoZSBib2R5IG9iamVjdCwgZm9yIGNoYWluYWJpbGl0eS4KICAgICAqLwoKCiAgICByZW1vdmVTaGFwZShzaGFwZSkgewogICAgICBjb25zdCBpbmRleCA9IHRoaXMuc2hhcGVzLmluZGV4T2Yoc2hhcGUpOwoKICAgICAgaWYgKGluZGV4ID09PSAtMSkgewogICAgICAgIGNvbnNvbGUud2FybignU2hhcGUgZG9lcyBub3QgYmVsb25nIHRvIHRoZSBib2R5Jyk7CiAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgIH0KCiAgICAgIHRoaXMuc2hhcGVzLnNwbGljZShpbmRleCwgMSk7CiAgICAgIHRoaXMuc2hhcGVPZmZzZXRzLnNwbGljZShpbmRleCwgMSk7CiAgICAgIHRoaXMuc2hhcGVPcmllbnRhdGlvbnMuc3BsaWNlKGluZGV4LCAxKTsKICAgICAgdGhpcy51cGRhdGVNYXNzUHJvcGVydGllcygpOwogICAgICB0aGlzLnVwZGF0ZUJvdW5kaW5nUmFkaXVzKCk7CiAgICAgIHRoaXMuYWFiYk5lZWRzVXBkYXRlID0gdHJ1ZTsKICAgICAgc2hhcGUuYm9keSA9IG51bGw7CiAgICAgIHJldHVybiB0aGlzOwogICAgfQogICAgLyoqCiAgICAgKiBVcGRhdGUgdGhlIGJvdW5kaW5nIHJhZGl1cyBvZiB0aGUgYm9keS4gU2hvdWxkIGJlIGRvbmUgaWYgYW55IG9mIHRoZSBzaGFwZXMgYXJlIGNoYW5nZWQuCiAgICAgKi8KCgogICAgdXBkYXRlQm91bmRpbmdSYWRpdXMoKSB7CiAgICAgIGNvbnN0IHNoYXBlcyA9IHRoaXMuc2hhcGVzOwogICAgICBjb25zdCBzaGFwZU9mZnNldHMgPSB0aGlzLnNoYXBlT2Zmc2V0czsKICAgICAgY29uc3QgTiA9IHNoYXBlcy5sZW5ndGg7CiAgICAgIGxldCByYWRpdXMgPSAwOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgIT09IE47IGkrKykgewogICAgICAgIGNvbnN0IHNoYXBlID0gc2hhcGVzW2ldOwogICAgICAgIHNoYXBlLnVwZGF0ZUJvdW5kaW5nU3BoZXJlUmFkaXVzKCk7CiAgICAgICAgY29uc3Qgb2Zmc2V0ID0gc2hhcGVPZmZzZXRzW2ldLmxlbmd0aCgpOwogICAgICAgIGNvbnN0IHIgPSBzaGFwZS5ib3VuZGluZ1NwaGVyZVJhZGl1czsKCiAgICAgICAgaWYgKG9mZnNldCArIHIgPiByYWRpdXMpIHsKICAgICAgICAgIHJhZGl1cyA9IG9mZnNldCArIHI7CiAgICAgICAgfQogICAgICB9CgogICAgICB0aGlzLmJvdW5kaW5nUmFkaXVzID0gcmFkaXVzOwogICAgfQogICAgLyoqCiAgICAgKiBVcGRhdGVzIHRoZSAuYWFiYgogICAgICovCgoKICAgIHVwZGF0ZUFBQkIoKSB7CiAgICAgIGNvbnN0IHNoYXBlcyA9IHRoaXMuc2hhcGVzOwogICAgICBjb25zdCBzaGFwZU9mZnNldHMgPSB0aGlzLnNoYXBlT2Zmc2V0czsKICAgICAgY29uc3Qgc2hhcGVPcmllbnRhdGlvbnMgPSB0aGlzLnNoYXBlT3JpZW50YXRpb25zOwogICAgICBjb25zdCBOID0gc2hhcGVzLmxlbmd0aDsKICAgICAgY29uc3Qgb2Zmc2V0ID0gdG1wVmVjOwogICAgICBjb25zdCBvcmllbnRhdGlvbiA9IHRtcFF1YXQ7CiAgICAgIGNvbnN0IGJvZHlRdWF0ID0gdGhpcy5xdWF0ZXJuaW9uOwogICAgICBjb25zdCBhYWJiID0gdGhpcy5hYWJiOwogICAgICBjb25zdCBzaGFwZUFBQkIgPSB1cGRhdGVBQUJCX3NoYXBlQUFCQjsKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpICE9PSBOOyBpKyspIHsKICAgICAgICBjb25zdCBzaGFwZSA9IHNoYXBlc1tpXTsgLy8gR2V0IHNoYXBlIHdvcmxkIHBvc2l0aW9uCgogICAgICAgIGJvZHlRdWF0LnZtdWx0KHNoYXBlT2Zmc2V0c1tpXSwgb2Zmc2V0KTsKICAgICAgICBvZmZzZXQudmFkZCh0aGlzLnBvc2l0aW9uLCBvZmZzZXQpOyAvLyBHZXQgc2hhcGUgd29ybGQgcXVhdGVybmlvbgoKICAgICAgICBib2R5UXVhdC5tdWx0KHNoYXBlT3JpZW50YXRpb25zW2ldLCBvcmllbnRhdGlvbik7IC8vIEdldCBzaGFwZSBBQUJCCgogICAgICAgIHNoYXBlLmNhbGN1bGF0ZVdvcmxkQUFCQihvZmZzZXQsIG9yaWVudGF0aW9uLCBzaGFwZUFBQkIubG93ZXJCb3VuZCwgc2hhcGVBQUJCLnVwcGVyQm91bmQpOwoKICAgICAgICBpZiAoaSA9PT0gMCkgewogICAgICAgICAgYWFiYi5jb3B5KHNoYXBlQUFCQik7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGFhYmIuZXh0ZW5kKHNoYXBlQUFCQik7CiAgICAgICAgfQogICAgICB9CgogICAgICB0aGlzLmFhYmJOZWVkc1VwZGF0ZSA9IGZhbHNlOwogICAgfQogICAgLyoqCiAgICAgKiBVcGRhdGUgYC5pbmVydGlhV29ybGRgIGFuZCBgLmludkluZXJ0aWFXb3JsZGAKICAgICAqLwoKCiAgICB1cGRhdGVJbmVydGlhV29ybGQoZm9yY2UpIHsKICAgICAgY29uc3QgSSA9IHRoaXMuaW52SW5lcnRpYTsKCiAgICAgIGlmIChJLnggPT09IEkueSAmJiBJLnkgPT09IEkueiAmJiAhZm9yY2UpIDsgZWxzZSB7CiAgICAgICAgY29uc3QgbTEgPSB1aXdfbTE7CiAgICAgICAgY29uc3QgbTIgPSB1aXdfbTI7CiAgICAgICAgbTEuc2V0Um90YXRpb25Gcm9tUXVhdGVybmlvbih0aGlzLnF1YXRlcm5pb24pOwogICAgICAgIG0xLnRyYW5zcG9zZShtMik7CiAgICAgICAgbTEuc2NhbGUoSSwgbTEpOwogICAgICAgIG0xLm1tdWx0KG0yLCB0aGlzLmludkluZXJ0aWFXb3JsZCk7CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogQXBwbHkgZm9yY2UgdG8gYSBwb2ludCBvZiB0aGUgYm9keS4gVGhpcyBjb3VsZCBmb3IgZXhhbXBsZSBiZSBhIHBvaW50IG9uIHRoZSBCb2R5IHN1cmZhY2UuCiAgICAgKiBBcHBseWluZyBmb3JjZSB0aGlzIHdheSB3aWxsIGFkZCB0byBCb2R5LmZvcmNlIGFuZCBCb2R5LnRvcnF1ZS4KICAgICAqIEBwYXJhbSBmb3JjZSBUaGUgYW1vdW50IG9mIGZvcmNlIHRvIGFkZC4KICAgICAqIEBwYXJhbSByZWxhdGl2ZVBvaW50IEEgcG9pbnQgcmVsYXRpdmUgdG8gdGhlIGNlbnRlciBvZiBtYXNzIHRvIGFwcGx5IHRoZSBmb3JjZSBvbi4KICAgICAqLwoKCiAgICBhcHBseUZvcmNlKGZvcmNlLCByZWxhdGl2ZVBvaW50KSB7CiAgICAgIGlmIChyZWxhdGl2ZVBvaW50ID09PSB2b2lkIDApIHsKICAgICAgICByZWxhdGl2ZVBvaW50ID0gbmV3IFZlYzMoKTsKICAgICAgfQoKICAgICAgLy8gTmVlZGVkPwogICAgICBpZiAodGhpcy50eXBlICE9PSBCb2R5LkRZTkFNSUMpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIGlmICh0aGlzLnNsZWVwU3RhdGUgPT09IEJvZHkuU0xFRVBJTkcpIHsKICAgICAgICB0aGlzLndha2VVcCgpOwogICAgICB9IC8vIENvbXB1dGUgcHJvZHVjZWQgcm90YXRpb25hbCBmb3JjZQoKCiAgICAgIGNvbnN0IHJvdEZvcmNlID0gQm9keV9hcHBseUZvcmNlX3JvdEZvcmNlOwogICAgICByZWxhdGl2ZVBvaW50LmNyb3NzKGZvcmNlLCByb3RGb3JjZSk7IC8vIEFkZCBsaW5lYXIgZm9yY2UKCiAgICAgIHRoaXMuZm9yY2UudmFkZChmb3JjZSwgdGhpcy5mb3JjZSk7IC8vIEFkZCByb3RhdGlvbmFsIGZvcmNlCgogICAgICB0aGlzLnRvcnF1ZS52YWRkKHJvdEZvcmNlLCB0aGlzLnRvcnF1ZSk7CiAgICB9CiAgICAvKioKICAgICAqIEFwcGx5IGZvcmNlIHRvIGEgbG9jYWwgcG9pbnQgaW4gdGhlIGJvZHkuCiAgICAgKiBAcGFyYW0gZm9yY2UgVGhlIGZvcmNlIHZlY3RvciB0byBhcHBseSwgZGVmaW5lZCBsb2NhbGx5IGluIHRoZSBib2R5IGZyYW1lLgogICAgICogQHBhcmFtIGxvY2FsUG9pbnQgQSBsb2NhbCBwb2ludCBpbiB0aGUgYm9keSB0byBhcHBseSB0aGUgZm9yY2Ugb24uCiAgICAgKi8KCgogICAgYXBwbHlMb2NhbEZvcmNlKGxvY2FsRm9yY2UsIGxvY2FsUG9pbnQpIHsKICAgICAgaWYgKGxvY2FsUG9pbnQgPT09IHZvaWQgMCkgewogICAgICAgIGxvY2FsUG9pbnQgPSBuZXcgVmVjMygpOwogICAgICB9CgogICAgICBpZiAodGhpcy50eXBlICE9PSBCb2R5LkRZTkFNSUMpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIGNvbnN0IHdvcmxkRm9yY2UgPSBCb2R5X2FwcGx5TG9jYWxGb3JjZV93b3JsZEZvcmNlOwogICAgICBjb25zdCByZWxhdGl2ZVBvaW50V29ybGQgPSBCb2R5X2FwcGx5TG9jYWxGb3JjZV9yZWxhdGl2ZVBvaW50V29ybGQ7IC8vIFRyYW5zZm9ybSB0aGUgZm9yY2UgdmVjdG9yIHRvIHdvcmxkIHNwYWNlCgogICAgICB0aGlzLnZlY3RvclRvV29ybGRGcmFtZShsb2NhbEZvcmNlLCB3b3JsZEZvcmNlKTsKICAgICAgdGhpcy52ZWN0b3JUb1dvcmxkRnJhbWUobG9jYWxQb2ludCwgcmVsYXRpdmVQb2ludFdvcmxkKTsKICAgICAgdGhpcy5hcHBseUZvcmNlKHdvcmxkRm9yY2UsIHJlbGF0aXZlUG9pbnRXb3JsZCk7CiAgICB9CiAgICAvKioKICAgICAqIEFwcGx5IHRvcnF1ZSB0byB0aGUgYm9keS4KICAgICAqIEBwYXJhbSB0b3JxdWUgVGhlIGFtb3VudCBvZiB0b3JxdWUgdG8gYWRkLgogICAgICovCgoKICAgIGFwcGx5VG9ycXVlKHRvcnF1ZSkgewogICAgICBpZiAodGhpcy50eXBlICE9PSBCb2R5LkRZTkFNSUMpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIGlmICh0aGlzLnNsZWVwU3RhdGUgPT09IEJvZHkuU0xFRVBJTkcpIHsKICAgICAgICB0aGlzLndha2VVcCgpOwogICAgICB9IC8vIEFkZCByb3RhdGlvbmFsIGZvcmNlCgoKICAgICAgdGhpcy50b3JxdWUudmFkZCh0b3JxdWUsIHRoaXMudG9ycXVlKTsKICAgIH0KICAgIC8qKgogICAgICogQXBwbHkgaW1wdWxzZSB0byBhIHBvaW50IG9mIHRoZSBib2R5LiBUaGlzIGNvdWxkIGZvciBleGFtcGxlIGJlIGEgcG9pbnQgb24gdGhlIEJvZHkgc3VyZmFjZS4KICAgICAqIEFuIGltcHVsc2UgaXMgYSBmb3JjZSBhZGRlZCB0byBhIGJvZHkgZHVyaW5nIGEgc2hvcnQgcGVyaW9kIG9mIHRpbWUgKGltcHVsc2UgPSBmb3JjZSAqIHRpbWUpLgogICAgICogSW1wdWxzZXMgd2lsbCBiZSBhZGRlZCB0byBCb2R5LnZlbG9jaXR5IGFuZCBCb2R5LmFuZ3VsYXJWZWxvY2l0eS4KICAgICAqIEBwYXJhbSBpbXB1bHNlIFRoZSBhbW91bnQgb2YgaW1wdWxzZSB0byBhZGQuCiAgICAgKiBAcGFyYW0gcmVsYXRpdmVQb2ludCBBIHBvaW50IHJlbGF0aXZlIHRvIHRoZSBjZW50ZXIgb2YgbWFzcyB0byBhcHBseSB0aGUgZm9yY2Ugb24uCiAgICAgKi8KCgogICAgYXBwbHlJbXB1bHNlKGltcHVsc2UsIHJlbGF0aXZlUG9pbnQpIHsKICAgICAgaWYgKHJlbGF0aXZlUG9pbnQgPT09IHZvaWQgMCkgewogICAgICAgIHJlbGF0aXZlUG9pbnQgPSBuZXcgVmVjMygpOwogICAgICB9CgogICAgICBpZiAodGhpcy50eXBlICE9PSBCb2R5LkRZTkFNSUMpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIGlmICh0aGlzLnNsZWVwU3RhdGUgPT09IEJvZHkuU0xFRVBJTkcpIHsKICAgICAgICB0aGlzLndha2VVcCgpOwogICAgICB9IC8vIENvbXB1dGUgcG9pbnQgcG9zaXRpb24gcmVsYXRpdmUgdG8gdGhlIGJvZHkgY2VudGVyCgoKICAgICAgY29uc3QgciA9IHJlbGF0aXZlUG9pbnQ7IC8vIENvbXB1dGUgcHJvZHVjZWQgY2VudHJhbCBpbXB1bHNlIHZlbG9jaXR5CgogICAgICBjb25zdCB2ZWxvID0gQm9keV9hcHBseUltcHVsc2VfdmVsbzsKICAgICAgdmVsby5jb3B5KGltcHVsc2UpOwogICAgICB2ZWxvLnNjYWxlKHRoaXMuaW52TWFzcywgdmVsbyk7IC8vIEFkZCBsaW5lYXIgaW1wdWxzZQoKICAgICAgdGhpcy52ZWxvY2l0eS52YWRkKHZlbG8sIHRoaXMudmVsb2NpdHkpOyAvLyBDb21wdXRlIHByb2R1Y2VkIHJvdGF0aW9uYWwgaW1wdWxzZSB2ZWxvY2l0eQoKICAgICAgY29uc3Qgcm90VmVsbyA9IEJvZHlfYXBwbHlJbXB1bHNlX3JvdFZlbG87CiAgICAgIHIuY3Jvc3MoaW1wdWxzZSwgcm90VmVsbyk7CiAgICAgIC8qCiAgICAgICByb3RWZWxvLnggKj0gdGhpcy5pbnZJbmVydGlhLng7CiAgICAgICByb3RWZWxvLnkgKj0gdGhpcy5pbnZJbmVydGlhLnk7CiAgICAgICByb3RWZWxvLnogKj0gdGhpcy5pbnZJbmVydGlhLno7CiAgICAgICAqLwoKICAgICAgdGhpcy5pbnZJbmVydGlhV29ybGQudm11bHQocm90VmVsbywgcm90VmVsbyk7IC8vIEFkZCByb3RhdGlvbmFsIEltcHVsc2UKCiAgICAgIHRoaXMuYW5ndWxhclZlbG9jaXR5LnZhZGQocm90VmVsbywgdGhpcy5hbmd1bGFyVmVsb2NpdHkpOwogICAgfQogICAgLyoqCiAgICAgKiBBcHBseSBsb2NhbGx5LWRlZmluZWQgaW1wdWxzZSB0byBhIGxvY2FsIHBvaW50IGluIHRoZSBib2R5LgogICAgICogQHBhcmFtIGZvcmNlIFRoZSBmb3JjZSB2ZWN0b3IgdG8gYXBwbHksIGRlZmluZWQgbG9jYWxseSBpbiB0aGUgYm9keSBmcmFtZS4KICAgICAqIEBwYXJhbSBsb2NhbFBvaW50IEEgbG9jYWwgcG9pbnQgaW4gdGhlIGJvZHkgdG8gYXBwbHkgdGhlIGZvcmNlIG9uLgogICAgICovCgoKICAgIGFwcGx5TG9jYWxJbXB1bHNlKGxvY2FsSW1wdWxzZSwgbG9jYWxQb2ludCkgewogICAgICBpZiAobG9jYWxQb2ludCA9PT0gdm9pZCAwKSB7CiAgICAgICAgbG9jYWxQb2ludCA9IG5ldyBWZWMzKCk7CiAgICAgIH0KCiAgICAgIGlmICh0aGlzLnR5cGUgIT09IEJvZHkuRFlOQU1JQykgewogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgY29uc3Qgd29ybGRJbXB1bHNlID0gQm9keV9hcHBseUxvY2FsSW1wdWxzZV93b3JsZEltcHVsc2U7CiAgICAgIGNvbnN0IHJlbGF0aXZlUG9pbnRXb3JsZCA9IEJvZHlfYXBwbHlMb2NhbEltcHVsc2VfcmVsYXRpdmVQb2ludDsgLy8gVHJhbnNmb3JtIHRoZSBmb3JjZSB2ZWN0b3IgdG8gd29ybGQgc3BhY2UKCiAgICAgIHRoaXMudmVjdG9yVG9Xb3JsZEZyYW1lKGxvY2FsSW1wdWxzZSwgd29ybGRJbXB1bHNlKTsKICAgICAgdGhpcy52ZWN0b3JUb1dvcmxkRnJhbWUobG9jYWxQb2ludCwgcmVsYXRpdmVQb2ludFdvcmxkKTsKICAgICAgdGhpcy5hcHBseUltcHVsc2Uod29ybGRJbXB1bHNlLCByZWxhdGl2ZVBvaW50V29ybGQpOwogICAgfQogICAgLyoqCiAgICAgKiBTaG91bGQgYmUgY2FsbGVkIHdoZW5ldmVyIHlvdSBjaGFuZ2UgdGhlIGJvZHkgc2hhcGUgb3IgbWFzcy4KICAgICAqLwoKCiAgICB1cGRhdGVNYXNzUHJvcGVydGllcygpIHsKICAgICAgY29uc3QgaGFsZkV4dGVudHMgPSBCb2R5X3VwZGF0ZU1hc3NQcm9wZXJ0aWVzX2hhbGZFeHRlbnRzOwogICAgICB0aGlzLmludk1hc3MgPSB0aGlzLm1hc3MgPiAwID8gMS4wIC8gdGhpcy5tYXNzIDogMDsKICAgICAgY29uc3QgSSA9IHRoaXMuaW5lcnRpYTsKICAgICAgY29uc3QgZml4ZWQgPSB0aGlzLmZpeGVkUm90YXRpb247IC8vIEFwcHJveGltYXRlIHdpdGggQUFCQiBib3gKCiAgICAgIHRoaXMudXBkYXRlQUFCQigpOwogICAgICBoYWxmRXh0ZW50cy5zZXQoKHRoaXMuYWFiYi51cHBlckJvdW5kLnggLSB0aGlzLmFhYmIubG93ZXJCb3VuZC54KSAvIDIsICh0aGlzLmFhYmIudXBwZXJCb3VuZC55IC0gdGhpcy5hYWJiLmxvd2VyQm91bmQueSkgLyAyLCAodGhpcy5hYWJiLnVwcGVyQm91bmQueiAtIHRoaXMuYWFiYi5sb3dlckJvdW5kLnopIC8gMik7CiAgICAgIEJveC5jYWxjdWxhdGVJbmVydGlhKGhhbGZFeHRlbnRzLCB0aGlzLm1hc3MsIEkpOwogICAgICB0aGlzLmludkluZXJ0aWEuc2V0KEkueCA+IDAgJiYgIWZpeGVkID8gMS4wIC8gSS54IDogMCwgSS55ID4gMCAmJiAhZml4ZWQgPyAxLjAgLyBJLnkgOiAwLCBJLnogPiAwICYmICFmaXhlZCA/IDEuMCAvIEkueiA6IDApOwogICAgICB0aGlzLnVwZGF0ZUluZXJ0aWFXb3JsZCh0cnVlKTsKICAgIH0KICAgIC8qKgogICAgICogR2V0IHdvcmxkIHZlbG9jaXR5IG9mIGEgcG9pbnQgaW4gdGhlIGJvZHkuCiAgICAgKiBAcGFyYW0gd29ybGRQb2ludAogICAgICogQHBhcmFtIHJlc3VsdAogICAgICogQHJldHVybiBUaGUgcmVzdWx0IHZlY3Rvci4KICAgICAqLwoKCiAgICBnZXRWZWxvY2l0eUF0V29ybGRQb2ludCh3b3JsZFBvaW50LCByZXN1bHQpIHsKICAgICAgY29uc3QgciA9IG5ldyBWZWMzKCk7CiAgICAgIHdvcmxkUG9pbnQudnN1Yih0aGlzLnBvc2l0aW9uLCByKTsKICAgICAgdGhpcy5hbmd1bGFyVmVsb2NpdHkuY3Jvc3MociwgcmVzdWx0KTsKICAgICAgdGhpcy52ZWxvY2l0eS52YWRkKHJlc3VsdCwgcmVzdWx0KTsKICAgICAgcmV0dXJuIHJlc3VsdDsKICAgIH0KICAgIC8qKgogICAgICogTW92ZSB0aGUgYm9keSBmb3J3YXJkIGluIHRpbWUuCiAgICAgKiBAcGFyYW0gZHQgVGltZSBzdGVwCiAgICAgKiBAcGFyYW0gcXVhdE5vcm1hbGl6ZSBTZXQgdG8gdHJ1ZSB0byBub3JtYWxpemUgdGhlIGJvZHkgcXVhdGVybmlvbgogICAgICogQHBhcmFtIHF1YXROb3JtYWxpemVGYXN0IElmIHRoZSBxdWF0ZXJuaW9uIHNob3VsZCBiZSBub3JtYWxpemVkIHVzaW5nICJmYXN0IiBxdWF0ZXJuaW9uIG5vcm1hbGl6YXRpb24KICAgICAqLwoKCiAgICBpbnRlZ3JhdGUoZHQsIHF1YXROb3JtYWxpemUsIHF1YXROb3JtYWxpemVGYXN0KSB7CiAgICAgIC8vIFNhdmUgcHJldmlvdXMgcG9zaXRpb24KICAgICAgdGhpcy5wcmV2aW91c1Bvc2l0aW9uLmNvcHkodGhpcy5wb3NpdGlvbik7CiAgICAgIHRoaXMucHJldmlvdXNRdWF0ZXJuaW9uLmNvcHkodGhpcy5xdWF0ZXJuaW9uKTsKCiAgICAgIGlmICghKHRoaXMudHlwZSA9PT0gQm9keS5EWU5BTUlDIHx8IHRoaXMudHlwZSA9PT0gQm9keS5LSU5FTUFUSUMpIHx8IHRoaXMuc2xlZXBTdGF0ZSA9PT0gQm9keS5TTEVFUElORykgewogICAgICAgIC8vIE9ubHkgZm9yIGR5bmFtaWMKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIGNvbnN0IHZlbG8gPSB0aGlzLnZlbG9jaXR5OwogICAgICBjb25zdCBhbmd1bGFyVmVsbyA9IHRoaXMuYW5ndWxhclZlbG9jaXR5OwogICAgICBjb25zdCBwb3MgPSB0aGlzLnBvc2l0aW9uOwogICAgICBjb25zdCBmb3JjZSA9IHRoaXMuZm9yY2U7CiAgICAgIGNvbnN0IHRvcnF1ZSA9IHRoaXMudG9ycXVlOwogICAgICBjb25zdCBxdWF0ID0gdGhpcy5xdWF0ZXJuaW9uOwogICAgICBjb25zdCBpbnZNYXNzID0gdGhpcy5pbnZNYXNzOwogICAgICBjb25zdCBpbnZJbmVydGlhID0gdGhpcy5pbnZJbmVydGlhV29ybGQ7CiAgICAgIGNvbnN0IGxpbmVhckZhY3RvciA9IHRoaXMubGluZWFyRmFjdG9yOwogICAgICBjb25zdCBpTWR0ID0gaW52TWFzcyAqIGR0OwogICAgICB2ZWxvLnggKz0gZm9yY2UueCAqIGlNZHQgKiBsaW5lYXJGYWN0b3IueDsKICAgICAgdmVsby55ICs9IGZvcmNlLnkgKiBpTWR0ICogbGluZWFyRmFjdG9yLnk7CiAgICAgIHZlbG8ueiArPSBmb3JjZS56ICogaU1kdCAqIGxpbmVhckZhY3Rvci56OwogICAgICBjb25zdCBlID0gaW52SW5lcnRpYS5lbGVtZW50czsKICAgICAgY29uc3QgYW5ndWxhckZhY3RvciA9IHRoaXMuYW5ndWxhckZhY3RvcjsKICAgICAgY29uc3QgdHggPSB0b3JxdWUueCAqIGFuZ3VsYXJGYWN0b3IueDsKICAgICAgY29uc3QgdHkgPSB0b3JxdWUueSAqIGFuZ3VsYXJGYWN0b3IueTsKICAgICAgY29uc3QgdHogPSB0b3JxdWUueiAqIGFuZ3VsYXJGYWN0b3IuejsKICAgICAgYW5ndWxhclZlbG8ueCArPSBkdCAqIChlWzBdICogdHggKyBlWzFdICogdHkgKyBlWzJdICogdHopOwogICAgICBhbmd1bGFyVmVsby55ICs9IGR0ICogKGVbM10gKiB0eCArIGVbNF0gKiB0eSArIGVbNV0gKiB0eik7CiAgICAgIGFuZ3VsYXJWZWxvLnogKz0gZHQgKiAoZVs2XSAqIHR4ICsgZVs3XSAqIHR5ICsgZVs4XSAqIHR6KTsgLy8gVXNlIG5ldyB2ZWxvY2l0eSAgLSBsZWFwIGZyb2cKCiAgICAgIHBvcy54ICs9IHZlbG8ueCAqIGR0OwogICAgICBwb3MueSArPSB2ZWxvLnkgKiBkdDsKICAgICAgcG9zLnogKz0gdmVsby56ICogZHQ7CiAgICAgIHF1YXQuaW50ZWdyYXRlKHRoaXMuYW5ndWxhclZlbG9jaXR5LCBkdCwgdGhpcy5hbmd1bGFyRmFjdG9yLCBxdWF0KTsKCiAgICAgIGlmIChxdWF0Tm9ybWFsaXplKSB7CiAgICAgICAgaWYgKHF1YXROb3JtYWxpemVGYXN0KSB7CiAgICAgICAgICBxdWF0Lm5vcm1hbGl6ZUZhc3QoKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgcXVhdC5ub3JtYWxpemUoKTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIHRoaXMuYWFiYk5lZWRzVXBkYXRlID0gdHJ1ZTsgLy8gVXBkYXRlIHdvcmxkIGluZXJ0aWEKCiAgICAgIHRoaXMudXBkYXRlSW5lcnRpYVdvcmxkKCk7CiAgICB9CgogIH0KICBCb2R5LmlkQ291bnRlciA9IDA7CiAgQm9keS5DT0xMSURFX0VWRU5UX05BTUUgPSAnY29sbGlkZSc7CiAgQm9keS5EWU5BTUlDID0gQk9EWV9UWVBFUy5EWU5BTUlDOwogIEJvZHkuU1RBVElDID0gQk9EWV9UWVBFUy5TVEFUSUM7CiAgQm9keS5LSU5FTUFUSUMgPSBCT0RZX1RZUEVTLktJTkVNQVRJQzsKICBCb2R5LkFXQUtFID0gQk9EWV9TTEVFUF9TVEFURVMuQVdBS0U7CiAgQm9keS5TTEVFUFkgPSBCT0RZX1NMRUVQX1NUQVRFUy5TTEVFUFk7CiAgQm9keS5TTEVFUElORyA9IEJPRFlfU0xFRVBfU1RBVEVTLlNMRUVQSU5HOwogIEJvZHkud2FrZXVwRXZlbnQgPSB7CiAgICB0eXBlOiAnd2FrZXVwJwogIH07CiAgQm9keS5zbGVlcHlFdmVudCA9IHsKICAgIHR5cGU6ICdzbGVlcHknCiAgfTsKICBCb2R5LnNsZWVwRXZlbnQgPSB7CiAgICB0eXBlOiAnc2xlZXAnCiAgfTsKICBjb25zdCB0bXBWZWMgPSBuZXcgVmVjMygpOwogIGNvbnN0IHRtcFF1YXQgPSBuZXcgUXVhdGVybmlvbigpOwogIGNvbnN0IHVwZGF0ZUFBQkJfc2hhcGVBQUJCID0gbmV3IEFBQkIoKTsKICBjb25zdCB1aXdfbTEgPSBuZXcgTWF0MygpOwogIGNvbnN0IHVpd19tMiA9IG5ldyBNYXQzKCk7CiAgbmV3IE1hdDMoKTsKICBjb25zdCBCb2R5X2FwcGx5Rm9yY2Vfcm90Rm9yY2UgPSBuZXcgVmVjMygpOwogIGNvbnN0IEJvZHlfYXBwbHlMb2NhbEZvcmNlX3dvcmxkRm9yY2UgPSBuZXcgVmVjMygpOwogIGNvbnN0IEJvZHlfYXBwbHlMb2NhbEZvcmNlX3JlbGF0aXZlUG9pbnRXb3JsZCA9IG5ldyBWZWMzKCk7CiAgY29uc3QgQm9keV9hcHBseUltcHVsc2VfdmVsbyA9IG5ldyBWZWMzKCk7CiAgY29uc3QgQm9keV9hcHBseUltcHVsc2Vfcm90VmVsbyA9IG5ldyBWZWMzKCk7CiAgY29uc3QgQm9keV9hcHBseUxvY2FsSW1wdWxzZV93b3JsZEltcHVsc2UgPSBuZXcgVmVjMygpOwogIGNvbnN0IEJvZHlfYXBwbHlMb2NhbEltcHVsc2VfcmVsYXRpdmVQb2ludCA9IG5ldyBWZWMzKCk7CiAgY29uc3QgQm9keV91cGRhdGVNYXNzUHJvcGVydGllc19oYWxmRXh0ZW50cyA9IG5ldyBWZWMzKCk7CgogIC8qKgogICAqIEJhc2UgY2xhc3MgZm9yIGJyb2FkcGhhc2UgaW1wbGVtZW50YXRpb25zCiAgICogQGF1dGhvciBzY2h0ZXBwZQogICAqLwogIGNsYXNzIEJyb2FkcGhhc2UgewogICAgLyoqCiAgICAgKiBUaGUgd29ybGQgdG8gc2VhcmNoIGZvciBjb2xsaXNpb25zIGluLgogICAgICovCgogICAgLyoqCiAgICAgKiBJZiBzZXQgdG8gdHJ1ZSwgdGhlIGJyb2FkcGhhc2UgdXNlcyBib3VuZGluZyBib3hlcyBmb3IgaW50ZXJzZWN0aW9uIHRlc3RzLCBlbHNlIGl0IHVzZXMgYm91bmRpbmcgc3BoZXJlcy4KICAgICAqLwoKICAgIC8qKgogICAgICogU2V0IHRvIHRydWUgaWYgdGhlIG9iamVjdHMgaW4gdGhlIHdvcmxkIG1vdmVkLgogICAgICovCiAgICBjb25zdHJ1Y3RvcigpIHsKICAgICAgdGhpcy53b3JsZCA9IG51bGw7CiAgICAgIHRoaXMudXNlQm91bmRpbmdCb3hlcyA9IGZhbHNlOwogICAgICB0aGlzLmRpcnR5ID0gdHJ1ZTsKICAgIH0KICAgIC8qKgogICAgICogR2V0IHRoZSBjb2xsaXNpb24gcGFpcnMgZnJvbSB0aGUgd29ybGQKICAgICAqIEBwYXJhbSB3b3JsZCBUaGUgd29ybGQgdG8gc2VhcmNoIGluCiAgICAgKiBAcGFyYW0gcDEgRW1wdHkgYXJyYXkgdG8gYmUgZmlsbGVkIHdpdGggYm9keSBvYmplY3RzCiAgICAgKiBAcGFyYW0gcDIgRW1wdHkgYXJyYXkgdG8gYmUgZmlsbGVkIHdpdGggYm9keSBvYmplY3RzCiAgICAgKi8KCgogICAgY29sbGlzaW9uUGFpcnMod29ybGQsIHAxLCBwMikgewogICAgICB0aHJvdyBuZXcgRXJyb3IoJ2NvbGxpc2lvblBhaXJzIG5vdCBpbXBsZW1lbnRlZCBmb3IgdGhpcyBCcm9hZFBoYXNlIGNsYXNzIScpOwogICAgfQogICAgLyoqCiAgICAgKiBDaGVjayBpZiBhIGJvZHkgcGFpciBuZWVkcyB0byBiZSBpbnRlcnNlY3Rpb24gdGVzdGVkIGF0IGFsbC4KICAgICAqLwoKCiAgICBuZWVkQnJvYWRwaGFzZUNvbGxpc2lvbihib2R5QSwgYm9keUIpIHsKICAgICAgLy8gQ2hlY2sgY29sbGlzaW9uIGZpbHRlciBtYXNrcwogICAgICBpZiAoKGJvZHlBLmNvbGxpc2lvbkZpbHRlckdyb3VwICYgYm9keUIuY29sbGlzaW9uRmlsdGVyTWFzaykgPT09IDAgfHwgKGJvZHlCLmNvbGxpc2lvbkZpbHRlckdyb3VwICYgYm9keUEuY29sbGlzaW9uRmlsdGVyTWFzaykgPT09IDApIHsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgIH0gLy8gQ2hlY2sgdHlwZXMKCgogICAgICBpZiAoKChib2R5QS50eXBlICYgQm9keS5TVEFUSUMpICE9PSAwIHx8IGJvZHlBLnNsZWVwU3RhdGUgPT09IEJvZHkuU0xFRVBJTkcpICYmICgoYm9keUIudHlwZSAmIEJvZHkuU1RBVElDKSAhPT0gMCB8fCBib2R5Qi5zbGVlcFN0YXRlID09PSBCb2R5LlNMRUVQSU5HKSkgewogICAgICAgIC8vIEJvdGggYm9kaWVzIGFyZSBzdGF0aWMgb3Igc2xlZXBpbmcuIFNraXAuCiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICB9CgogICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KICAgIC8qKgogICAgICogQ2hlY2sgaWYgdGhlIGJvdW5kaW5nIHZvbHVtZXMgb2YgdHdvIGJvZGllcyBpbnRlcnNlY3QuCiAgICAgKi8KCgogICAgaW50ZXJzZWN0aW9uVGVzdChib2R5QSwgYm9keUIsIHBhaXJzMSwgcGFpcnMyKSB7CiAgICAgIGlmICh0aGlzLnVzZUJvdW5kaW5nQm94ZXMpIHsKICAgICAgICB0aGlzLmRvQm91bmRpbmdCb3hCcm9hZHBoYXNlKGJvZHlBLCBib2R5QiwgcGFpcnMxLCBwYWlyczIpOwogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMuZG9Cb3VuZGluZ1NwaGVyZUJyb2FkcGhhc2UoYm9keUEsIGJvZHlCLCBwYWlyczEsIHBhaXJzMik7CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogQ2hlY2sgaWYgdGhlIGJvdW5kaW5nIHNwaGVyZXMgb2YgdHdvIGJvZGllcyBhcmUgaW50ZXJzZWN0aW5nLgogICAgICogQHBhcmFtIHBhaXJzMSBib2R5QSBpcyBhcHBlbmRlZCB0byB0aGlzIGFycmF5IGlmIGludGVyc2VjdGlvbgogICAgICogQHBhcmFtIHBhaXJzMiBib2R5QiBpcyBhcHBlbmRlZCB0byB0aGlzIGFycmF5IGlmIGludGVyc2VjdGlvbgogICAgICovCgoKICAgIGRvQm91bmRpbmdTcGhlcmVCcm9hZHBoYXNlKGJvZHlBLCBib2R5QiwgcGFpcnMxLCBwYWlyczIpIHsKICAgICAgY29uc3QgciA9IEJyb2FkcGhhc2VfY29sbGlzaW9uUGFpcnNfcjsKICAgICAgYm9keUIucG9zaXRpb24udnN1Yihib2R5QS5wb3NpdGlvbiwgcik7CiAgICAgIGNvbnN0IGJvdW5kaW5nUmFkaXVzU3VtMiA9IChib2R5QS5ib3VuZGluZ1JhZGl1cyArIGJvZHlCLmJvdW5kaW5nUmFkaXVzKSAqKiAyOwogICAgICBjb25zdCBub3JtMiA9IHIubGVuZ3RoU3F1YXJlZCgpOwoKICAgICAgaWYgKG5vcm0yIDwgYm91bmRpbmdSYWRpdXNTdW0yKSB7CiAgICAgICAgcGFpcnMxLnB1c2goYm9keUEpOwogICAgICAgIHBhaXJzMi5wdXNoKGJvZHlCKTsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBDaGVjayBpZiB0aGUgYm91bmRpbmcgYm94ZXMgb2YgdHdvIGJvZGllcyBhcmUgaW50ZXJzZWN0aW5nLgogICAgICovCgoKICAgIGRvQm91bmRpbmdCb3hCcm9hZHBoYXNlKGJvZHlBLCBib2R5QiwgcGFpcnMxLCBwYWlyczIpIHsKICAgICAgaWYgKGJvZHlBLmFhYmJOZWVkc1VwZGF0ZSkgewogICAgICAgIGJvZHlBLnVwZGF0ZUFBQkIoKTsKICAgICAgfQoKICAgICAgaWYgKGJvZHlCLmFhYmJOZWVkc1VwZGF0ZSkgewogICAgICAgIGJvZHlCLnVwZGF0ZUFBQkIoKTsKICAgICAgfSAvLyBDaGVjayBBQUJCIC8gQUFCQgoKCiAgICAgIGlmIChib2R5QS5hYWJiLm92ZXJsYXBzKGJvZHlCLmFhYmIpKSB7CiAgICAgICAgcGFpcnMxLnB1c2goYm9keUEpOwogICAgICAgIHBhaXJzMi5wdXNoKGJvZHlCKTsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBSZW1vdmVzIGR1cGxpY2F0ZSBwYWlycyBmcm9tIHRoZSBwYWlyIGFycmF5cy4KICAgICAqLwoKCiAgICBtYWtlUGFpcnNVbmlxdWUocGFpcnMxLCBwYWlyczIpIHsKICAgICAgY29uc3QgdCA9IEJyb2FkcGhhc2VfbWFrZVBhaXJzVW5pcXVlX3RlbXA7CiAgICAgIGNvbnN0IHAxID0gQnJvYWRwaGFzZV9tYWtlUGFpcnNVbmlxdWVfcDE7CiAgICAgIGNvbnN0IHAyID0gQnJvYWRwaGFzZV9tYWtlUGFpcnNVbmlxdWVfcDI7CiAgICAgIGNvbnN0IE4gPSBwYWlyczEubGVuZ3RoOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgIT09IE47IGkrKykgewogICAgICAgIHAxW2ldID0gcGFpcnMxW2ldOwogICAgICAgIHAyW2ldID0gcGFpcnMyW2ldOwogICAgICB9CgogICAgICBwYWlyczEubGVuZ3RoID0gMDsKICAgICAgcGFpcnMyLmxlbmd0aCA9IDA7CgogICAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gTjsgaSsrKSB7CiAgICAgICAgY29uc3QgaWQxID0gcDFbaV0uaWQ7CiAgICAgICAgY29uc3QgaWQyID0gcDJbaV0uaWQ7CiAgICAgICAgY29uc3Qga2V5ID0gaWQxIDwgaWQyID8gYCR7aWQxfSwke2lkMn1gIDogYCR7aWQyfSwke2lkMX1gOwogICAgICAgIHRba2V5XSA9IGk7CiAgICAgICAgdC5rZXlzLnB1c2goa2V5KTsKICAgICAgfQoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgIT09IHQua2V5cy5sZW5ndGg7IGkrKykgewogICAgICAgIGNvbnN0IGtleSA9IHQua2V5cy5wb3AoKTsKICAgICAgICBjb25zdCBwYWlySW5kZXggPSB0W2tleV07CiAgICAgICAgcGFpcnMxLnB1c2gocDFbcGFpckluZGV4XSk7CiAgICAgICAgcGFpcnMyLnB1c2gocDJbcGFpckluZGV4XSk7CiAgICAgICAgZGVsZXRlIHRba2V5XTsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBUbyBiZSBpbXBsZW1lbnRlZCBieSBzdWJjYXNzZXMKICAgICAqLwoKCiAgICBzZXRXb3JsZCh3b3JsZCkge30KICAgIC8qKgogICAgICogQ2hlY2sgaWYgdGhlIGJvdW5kaW5nIHNwaGVyZXMgb2YgdHdvIGJvZGllcyBvdmVybGFwLgogICAgICovCgoKICAgIHN0YXRpYyBib3VuZGluZ1NwaGVyZUNoZWNrKGJvZHlBLCBib2R5QikgewogICAgICBjb25zdCBkaXN0ID0gbmV3IFZlYzMoKTsgLy8gYnNjX2Rpc3Q7CgogICAgICBib2R5QS5wb3NpdGlvbi52c3ViKGJvZHlCLnBvc2l0aW9uLCBkaXN0KTsKICAgICAgY29uc3Qgc2EgPSBib2R5QS5zaGFwZXNbMF07CiAgICAgIGNvbnN0IHNiID0gYm9keUIuc2hhcGVzWzBdOwogICAgICByZXR1cm4gTWF0aC5wb3coc2EuYm91bmRpbmdTcGhlcmVSYWRpdXMgKyBzYi5ib3VuZGluZ1NwaGVyZVJhZGl1cywgMikgPiBkaXN0Lmxlbmd0aFNxdWFyZWQoKTsKICAgIH0KICAgIC8qKgogICAgICogUmV0dXJucyBhbGwgdGhlIGJvZGllcyB3aXRoaW4gdGhlIEFBQkIuCiAgICAgKi8KCgogICAgYWFiYlF1ZXJ5KHdvcmxkLCBhYWJiLCByZXN1bHQpIHsKICAgICAgY29uc29sZS53YXJuKCcuYWFiYlF1ZXJ5IGlzIG5vdCBpbXBsZW1lbnRlZCBpbiB0aGlzIEJyb2FkcGhhc2Ugc3ViY2xhc3MuJyk7CiAgICAgIHJldHVybiBbXTsKICAgIH0KCiAgfSAvLyBUZW1wIG9iamVjdHMKCiAgY29uc3QgQnJvYWRwaGFzZV9jb2xsaXNpb25QYWlyc19yID0gbmV3IFZlYzMoKTsKICBuZXcgVmVjMygpOwogIG5ldyBRdWF0ZXJuaW9uKCk7CiAgbmV3IFZlYzMoKTsKICBjb25zdCBCcm9hZHBoYXNlX21ha2VQYWlyc1VuaXF1ZV90ZW1wID0gewogICAga2V5czogW10KICB9OwogIGNvbnN0IEJyb2FkcGhhc2VfbWFrZVBhaXJzVW5pcXVlX3AxID0gW107CiAgY29uc3QgQnJvYWRwaGFzZV9tYWtlUGFpcnNVbmlxdWVfcDIgPSBbXTsKICBuZXcgVmVjMygpOwogIG5ldyBWZWMzKCk7CiAgbmV3IFZlYzMoKTsKCiAgLyoqCiAgICogTmFpdmUgYnJvYWRwaGFzZSBpbXBsZW1lbnRhdGlvbiwgdXNlZCBpbiBsYWNrIG9mIGJldHRlciBvbmVzLgogICAqCiAgICogVGhlIG5haXZlIGJyb2FkcGhhc2UgbG9va3MgYXQgYWxsIHBvc3NpYmxlIHBhaXJzIHdpdGhvdXQgcmVzdHJpY3Rpb24sIHRoZXJlZm9yZSBpdCBoYXMgY29tcGxleGl0eSBOXjIgXyh3aGljaCBpcyBiYWQpXwogICAqLwogIGNsYXNzIE5haXZlQnJvYWRwaGFzZSBleHRlbmRzIEJyb2FkcGhhc2UgewogICAgLyoqCiAgICAgKiBAdG9kbyBSZW1vdmUgdXNlbGVzcyBjb25zdHJ1Y3RvcgogICAgICovCiAgICBjb25zdHJ1Y3RvcigpIHsKICAgICAgc3VwZXIoKTsKICAgIH0KICAgIC8qKgogICAgICogR2V0IGFsbCB0aGUgY29sbGlzaW9uIHBhaXJzIGluIHRoZSBwaHlzaWNzIHdvcmxkCiAgICAgKi8KCgogICAgY29sbGlzaW9uUGFpcnMod29ybGQsIHBhaXJzMSwgcGFpcnMyKSB7CiAgICAgIGNvbnN0IGJvZGllcyA9IHdvcmxkLmJvZGllczsKICAgICAgY29uc3QgbiA9IGJvZGllcy5sZW5ndGg7CiAgICAgIGxldCBiaTsKICAgICAgbGV0IGJqOyAvLyBOYWl2ZSBOXjIgZnR3IQoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgIT09IG47IGkrKykgewogICAgICAgIGZvciAobGV0IGogPSAwOyBqICE9PSBpOyBqKyspIHsKICAgICAgICAgIGJpID0gYm9kaWVzW2ldOwogICAgICAgICAgYmogPSBib2RpZXNbal07CgogICAgICAgICAgaWYgKCF0aGlzLm5lZWRCcm9hZHBoYXNlQ29sbGlzaW9uKGJpLCBiaikpIHsKICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICB9CgogICAgICAgICAgdGhpcy5pbnRlcnNlY3Rpb25UZXN0KGJpLCBiaiwgcGFpcnMxLCBwYWlyczIpOwogICAgICAgIH0KICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBSZXR1cm5zIGFsbCB0aGUgYm9kaWVzIHdpdGhpbiBhbiBBQUJCLgogICAgICogQHBhcmFtIHJlc3VsdCBBbiBhcnJheSB0byBzdG9yZSByZXN1bHRpbmcgYm9kaWVzIGluLgogICAgICovCgoKICAgIGFhYmJRdWVyeSh3b3JsZCwgYWFiYiwgcmVzdWx0KSB7CiAgICAgIGlmIChyZXN1bHQgPT09IHZvaWQgMCkgewogICAgICAgIHJlc3VsdCA9IFtdOwogICAgICB9CgogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHdvcmxkLmJvZGllcy5sZW5ndGg7IGkrKykgewogICAgICAgIGNvbnN0IGIgPSB3b3JsZC5ib2RpZXNbaV07CgogICAgICAgIGlmIChiLmFhYmJOZWVkc1VwZGF0ZSkgewogICAgICAgICAgYi51cGRhdGVBQUJCKCk7CiAgICAgICAgfSAvLyBVZ2x5IGhhY2sgdW50aWwgQm9keSBnZXRzIGFhYmIKCgogICAgICAgIGlmIChiLmFhYmIub3ZlcmxhcHMoYWFiYikpIHsKICAgICAgICAgIHJlc3VsdC5wdXNoKGIpOwogICAgICAgIH0KICAgICAgfQoKICAgICAgcmV0dXJuIHJlc3VsdDsKICAgIH0KCiAgfQoKICAvKioKICAgKiBTdG9yYWdlIGZvciBSYXkgY2FzdGluZyBkYXRhCiAgICovCiAgY2xhc3MgUmF5Y2FzdFJlc3VsdCB7CiAgICAvKioKICAgICAqIHJheUZyb21Xb3JsZAogICAgICovCgogICAgLyoqCiAgICAgKiByYXlUb1dvcmxkCiAgICAgKi8KCiAgICAvKioKICAgICAqIGhpdE5vcm1hbFdvcmxkCiAgICAgKi8KCiAgICAvKioKICAgICAqIGhpdFBvaW50V29ybGQKICAgICAqLwoKICAgIC8qKgogICAgICogaGFzSGl0CiAgICAgKi8KCiAgICAvKioKICAgICAqIHNoYXBlCiAgICAgKi8KCiAgICAvKioKICAgICAqIGJvZHkKICAgICAqLwoKICAgIC8qKgogICAgICogVGhlIGluZGV4IG9mIHRoZSBoaXQgdHJpYW5nbGUsIGlmIHRoZSBoaXQgc2hhcGUgd2FzIGEgdHJpbWVzaAogICAgICovCgogICAgLyoqCiAgICAgKiBEaXN0YW5jZSB0byB0aGUgaGl0LiBXaWxsIGJlIHNldCB0byAtMSBpZiB0aGVyZSB3YXMgbm8gaGl0CiAgICAgKi8KCiAgICAvKioKICAgICAqIElmIHRoZSByYXkgc2hvdWxkIHN0b3AgdHJhdmVyc2luZyB0aGUgYm9kaWVzCiAgICAgKi8KICAgIGNvbnN0cnVjdG9yKCkgewogICAgICB0aGlzLnJheUZyb21Xb3JsZCA9IG5ldyBWZWMzKCk7CiAgICAgIHRoaXMucmF5VG9Xb3JsZCA9IG5ldyBWZWMzKCk7CiAgICAgIHRoaXMuaGl0Tm9ybWFsV29ybGQgPSBuZXcgVmVjMygpOwogICAgICB0aGlzLmhpdFBvaW50V29ybGQgPSBuZXcgVmVjMygpOwogICAgICB0aGlzLmhhc0hpdCA9IGZhbHNlOwogICAgICB0aGlzLnNoYXBlID0gbnVsbDsKICAgICAgdGhpcy5ib2R5ID0gbnVsbDsKICAgICAgdGhpcy5oaXRGYWNlSW5kZXggPSAtMTsKICAgICAgdGhpcy5kaXN0YW5jZSA9IC0xOwogICAgICB0aGlzLnNob3VsZFN0b3AgPSBmYWxzZTsKICAgIH0KICAgIC8qKgogICAgICogUmVzZXQgYWxsIHJlc3VsdCBkYXRhLgogICAgICovCgoKICAgIHJlc2V0KCkgewogICAgICB0aGlzLnJheUZyb21Xb3JsZC5zZXRaZXJvKCk7CiAgICAgIHRoaXMucmF5VG9Xb3JsZC5zZXRaZXJvKCk7CiAgICAgIHRoaXMuaGl0Tm9ybWFsV29ybGQuc2V0WmVybygpOwogICAgICB0aGlzLmhpdFBvaW50V29ybGQuc2V0WmVybygpOwogICAgICB0aGlzLmhhc0hpdCA9IGZhbHNlOwogICAgICB0aGlzLnNoYXBlID0gbnVsbDsKICAgICAgdGhpcy5ib2R5ID0gbnVsbDsKICAgICAgdGhpcy5oaXRGYWNlSW5kZXggPSAtMTsKICAgICAgdGhpcy5kaXN0YW5jZSA9IC0xOwogICAgICB0aGlzLnNob3VsZFN0b3AgPSBmYWxzZTsKICAgIH0KICAgIC8qKgogICAgICogYWJvcnQKICAgICAqLwoKCiAgICBhYm9ydCgpIHsKICAgICAgdGhpcy5zaG91bGRTdG9wID0gdHJ1ZTsKICAgIH0KICAgIC8qKgogICAgICogU2V0IHJlc3VsdCBkYXRhLgogICAgICovCgoKICAgIHNldChyYXlGcm9tV29ybGQsIHJheVRvV29ybGQsIGhpdE5vcm1hbFdvcmxkLCBoaXRQb2ludFdvcmxkLCBzaGFwZSwgYm9keSwgZGlzdGFuY2UpIHsKICAgICAgdGhpcy5yYXlGcm9tV29ybGQuY29weShyYXlGcm9tV29ybGQpOwogICAgICB0aGlzLnJheVRvV29ybGQuY29weShyYXlUb1dvcmxkKTsKICAgICAgdGhpcy5oaXROb3JtYWxXb3JsZC5jb3B5KGhpdE5vcm1hbFdvcmxkKTsKICAgICAgdGhpcy5oaXRQb2ludFdvcmxkLmNvcHkoaGl0UG9pbnRXb3JsZCk7CiAgICAgIHRoaXMuc2hhcGUgPSBzaGFwZTsKICAgICAgdGhpcy5ib2R5ID0gYm9keTsKICAgICAgdGhpcy5kaXN0YW5jZSA9IGRpc3RhbmNlOwogICAgfQoKICB9CgogIGxldCBfU2hhcGUkdHlwZXMkU1BIRVJFLCBfU2hhcGUkdHlwZXMkUExBTkUsIF9TaGFwZSR0eXBlcyRCT1gsIF9TaGFwZSR0eXBlcyRDWUxJTkRFUiwgX1NoYXBlJHR5cGVzJENPTlZFWFBPLCBfU2hhcGUkdHlwZXMkSEVJR0hURkksIF9TaGFwZSR0eXBlcyRUUklNRVNIOwoKICAvKioKICAgKiBSQVlfTU9ERVMKICAgKi8KICBjb25zdCBSQVlfTU9ERVMgPSB7CiAgICAvKiogQ0xPU0VTVCAqLwogICAgQ0xPU0VTVDogMSwKCiAgICAvKiogQU5ZICovCiAgICBBTlk6IDIsCgogICAgLyoqIEFMTCAqLwogICAgQUxMOiA0CiAgfTsKICAvKioKICAgKiBSYXlNb2RlCiAgICovCgogIF9TaGFwZSR0eXBlcyRTUEhFUkUgPSBTaGFwZS50eXBlcy5TUEhFUkU7CiAgX1NoYXBlJHR5cGVzJFBMQU5FID0gU2hhcGUudHlwZXMuUExBTkU7CiAgX1NoYXBlJHR5cGVzJEJPWCA9IFNoYXBlLnR5cGVzLkJPWDsKICBfU2hhcGUkdHlwZXMkQ1lMSU5ERVIgPSBTaGFwZS50eXBlcy5DWUxJTkRFUjsKICBfU2hhcGUkdHlwZXMkQ09OVkVYUE8gPSBTaGFwZS50eXBlcy5DT05WRVhQT0xZSEVEUk9OOwogIF9TaGFwZSR0eXBlcyRIRUlHSFRGSSA9IFNoYXBlLnR5cGVzLkhFSUdIVEZJRUxEOwogIF9TaGFwZSR0eXBlcyRUUklNRVNIID0gU2hhcGUudHlwZXMuVFJJTUVTSDsKCiAgLyoqCiAgICogQSBsaW5lIGluIDNEIHNwYWNlIHRoYXQgaW50ZXJzZWN0cyBib2RpZXMgYW5kIHJldHVybiBwb2ludHMuCiAgICovCiAgY2xhc3MgUmF5IHsKICAgIC8qKgogICAgICogZnJvbQogICAgICovCgogICAgLyoqCiAgICAgKiB0bwogICAgICovCgogICAgLyoqCiAgICAgKiBkaXJlY3Rpb24KICAgICAqLwoKICAgIC8qKgogICAgICogVGhlIHByZWNpc2lvbiBvZiB0aGUgcmF5LiBVc2VkIHdoZW4gY2hlY2tpbmcgcGFyYWxsZWxpdHkgZXRjLgogICAgICogQGRlZmF1bHQgMC4wMDAxCiAgICAgKi8KCiAgICAvKioKICAgICAqIFNldCB0byBgZmFsc2VgIGlmIHlvdSBkb24ndCB3YW50IHRoZSBSYXkgdG8gdGFrZSBgY29sbGlzaW9uUmVzcG9uc2VgIGZsYWdzIGludG8gYWNjb3VudCBvbiBib2RpZXMgYW5kIHNoYXBlcy4KICAgICAqIEBkZWZhdWx0IHRydWUKICAgICAqLwoKICAgIC8qKgogICAgICogSWYgc2V0IHRvIGB0cnVlYCwgdGhlIHJheSBza2lwcyBhbnkgaGl0cyB3aXRoIG5vcm1hbC5kb3QocmF5RGlyZWN0aW9uKSA8IDAuCiAgICAgKiBAZGVmYXVsdCBmYWxzZQogICAgICovCgogICAgLyoqCiAgICAgKiBjb2xsaXNpb25GaWx0ZXJNYXNrCiAgICAgKiBAZGVmYXVsdCAtMQogICAgICovCgogICAgLyoqCiAgICAgKiBjb2xsaXNpb25GaWx0ZXJHcm91cAogICAgICogQGRlZmF1bHQgLTEKICAgICAqLwoKICAgIC8qKgogICAgICogVGhlIGludGVyc2VjdGlvbiBtb2RlLiBTaG91bGQgYmUgUmF5LkFOWSwgUmF5LkFMTCBvciBSYXkuQ0xPU0VTVC4KICAgICAqIEBkZWZhdWx0IFJBWS5BTlkKICAgICAqLwoKICAgIC8qKgogICAgICogQ3VycmVudCByZXN1bHQgb2JqZWN0LgogICAgICovCgogICAgLyoqCiAgICAgKiBXaWxsIGJlIHNldCB0byBgdHJ1ZWAgZHVyaW5nIGludGVyc2VjdFdvcmxkKCkgaWYgdGhlIHJheSBoaXQgYW55dGhpbmcuCiAgICAgKi8KCiAgICAvKioKICAgICAqIFVzZXItcHJvdmlkZWQgcmVzdWx0IGNhbGxiYWNrLiBXaWxsIGJlIHVzZWQgaWYgbW9kZSBpcyBSYXkuQUxMLgogICAgICovCgogICAgLyoqCiAgICAgKiBDTE9TRVNUCiAgICAgKi8KCiAgICAvKioKICAgICAqIEFOWQogICAgICovCgogICAgLyoqCiAgICAgKiBBTEwKICAgICAqLwogICAgZ2V0IFtfU2hhcGUkdHlwZXMkU1BIRVJFXSgpIHsKICAgICAgcmV0dXJuIHRoaXMuX2ludGVyc2VjdFNwaGVyZTsKICAgIH0KCiAgICBnZXQgW19TaGFwZSR0eXBlcyRQTEFORV0oKSB7CiAgICAgIHJldHVybiB0aGlzLl9pbnRlcnNlY3RQbGFuZTsKICAgIH0KCiAgICBnZXQgW19TaGFwZSR0eXBlcyRCT1hdKCkgewogICAgICByZXR1cm4gdGhpcy5faW50ZXJzZWN0Qm94OwogICAgfQoKICAgIGdldCBbX1NoYXBlJHR5cGVzJENZTElOREVSXSgpIHsKICAgICAgcmV0dXJuIHRoaXMuX2ludGVyc2VjdENvbnZleDsKICAgIH0KCiAgICBnZXQgW19TaGFwZSR0eXBlcyRDT05WRVhQT10oKSB7CiAgICAgIHJldHVybiB0aGlzLl9pbnRlcnNlY3RDb252ZXg7CiAgICB9CgogICAgZ2V0IFtfU2hhcGUkdHlwZXMkSEVJR0hURkldKCkgewogICAgICByZXR1cm4gdGhpcy5faW50ZXJzZWN0SGVpZ2h0ZmllbGQ7CiAgICB9CgogICAgZ2V0IFtfU2hhcGUkdHlwZXMkVFJJTUVTSF0oKSB7CiAgICAgIHJldHVybiB0aGlzLl9pbnRlcnNlY3RUcmltZXNoOwogICAgfQoKICAgIGNvbnN0cnVjdG9yKGZyb20sIHRvKSB7CiAgICAgIGlmIChmcm9tID09PSB2b2lkIDApIHsKICAgICAgICBmcm9tID0gbmV3IFZlYzMoKTsKICAgICAgfQoKICAgICAgaWYgKHRvID09PSB2b2lkIDApIHsKICAgICAgICB0byA9IG5ldyBWZWMzKCk7CiAgICAgIH0KCiAgICAgIHRoaXMuZnJvbSA9IGZyb20uY2xvbmUoKTsKICAgICAgdGhpcy50byA9IHRvLmNsb25lKCk7CiAgICAgIHRoaXMuZGlyZWN0aW9uID0gbmV3IFZlYzMoKTsKICAgICAgdGhpcy5wcmVjaXNpb24gPSAwLjAwMDE7CiAgICAgIHRoaXMuY2hlY2tDb2xsaXNpb25SZXNwb25zZSA9IHRydWU7CiAgICAgIHRoaXMuc2tpcEJhY2tmYWNlcyA9IGZhbHNlOwogICAgICB0aGlzLmNvbGxpc2lvbkZpbHRlck1hc2sgPSAtMTsKICAgICAgdGhpcy5jb2xsaXNpb25GaWx0ZXJHcm91cCA9IC0xOwogICAgICB0aGlzLm1vZGUgPSBSYXkuQU5ZOwogICAgICB0aGlzLnJlc3VsdCA9IG5ldyBSYXljYXN0UmVzdWx0KCk7CiAgICAgIHRoaXMuaGFzSGl0ID0gZmFsc2U7CgogICAgICB0aGlzLmNhbGxiYWNrID0gcmVzdWx0ID0+IHt9OwogICAgfQogICAgLyoqCiAgICAgKiBEbyBpdGVyc2VjdGlvbiBhZ2FpbnN0IGFsbCBib2RpZXMgaW4gdGhlIGdpdmVuIFdvcmxkLgogICAgICogQHJldHVybiBUcnVlIGlmIHRoZSByYXkgaGl0IGFueXRoaW5nLCBvdGhlcndpc2UgZmFsc2UuCiAgICAgKi8KCgogICAgaW50ZXJzZWN0V29ybGQod29ybGQsIG9wdGlvbnMpIHsKICAgICAgdGhpcy5tb2RlID0gb3B0aW9ucy5tb2RlIHx8IFJheS5BTlk7CiAgICAgIHRoaXMucmVzdWx0ID0gb3B0aW9ucy5yZXN1bHQgfHwgbmV3IFJheWNhc3RSZXN1bHQoKTsKICAgICAgdGhpcy5za2lwQmFja2ZhY2VzID0gISFvcHRpb25zLnNraXBCYWNrZmFjZXM7CiAgICAgIHRoaXMuY29sbGlzaW9uRmlsdGVyTWFzayA9IHR5cGVvZiBvcHRpb25zLmNvbGxpc2lvbkZpbHRlck1hc2sgIT09ICd1bmRlZmluZWQnID8gb3B0aW9ucy5jb2xsaXNpb25GaWx0ZXJNYXNrIDogLTE7CiAgICAgIHRoaXMuY29sbGlzaW9uRmlsdGVyR3JvdXAgPSB0eXBlb2Ygb3B0aW9ucy5jb2xsaXNpb25GaWx0ZXJHcm91cCAhPT0gJ3VuZGVmaW5lZCcgPyBvcHRpb25zLmNvbGxpc2lvbkZpbHRlckdyb3VwIDogLTE7CiAgICAgIHRoaXMuY2hlY2tDb2xsaXNpb25SZXNwb25zZSA9IHR5cGVvZiBvcHRpb25zLmNoZWNrQ29sbGlzaW9uUmVzcG9uc2UgIT09ICd1bmRlZmluZWQnID8gb3B0aW9ucy5jaGVja0NvbGxpc2lvblJlc3BvbnNlIDogdHJ1ZTsKCiAgICAgIGlmIChvcHRpb25zLmZyb20pIHsKICAgICAgICB0aGlzLmZyb20uY29weShvcHRpb25zLmZyb20pOwogICAgICB9CgogICAgICBpZiAob3B0aW9ucy50bykgewogICAgICAgIHRoaXMudG8uY29weShvcHRpb25zLnRvKTsKICAgICAgfQoKICAgICAgdGhpcy5jYWxsYmFjayA9IG9wdGlvbnMuY2FsbGJhY2sgfHwgKCgpID0+IHt9KTsKCiAgICAgIHRoaXMuaGFzSGl0ID0gZmFsc2U7CiAgICAgIHRoaXMucmVzdWx0LnJlc2V0KCk7CiAgICAgIHRoaXMudXBkYXRlRGlyZWN0aW9uKCk7CiAgICAgIHRoaXMuZ2V0QUFCQih0bXBBQUJCJDEpOwogICAgICB0bXBBcnJheS5sZW5ndGggPSAwOwogICAgICB3b3JsZC5icm9hZHBoYXNlLmFhYmJRdWVyeSh3b3JsZCwgdG1wQUFCQiQxLCB0bXBBcnJheSk7CiAgICAgIHRoaXMuaW50ZXJzZWN0Qm9kaWVzKHRtcEFycmF5KTsKICAgICAgcmV0dXJuIHRoaXMuaGFzSGl0OwogICAgfQogICAgLyoqCiAgICAgKiBTaG9vdCBhIHJheSBhdCBhIGJvZHksIGdldCBiYWNrIGluZm9ybWF0aW9uIGFib3V0IHRoZSBoaXQuCiAgICAgKiBAZGVwcmVjYXRlZCBAcGFyYW0gcmVzdWx0IHNldCB0aGUgcmVzdWx0IHByb3BlcnR5IG9mIHRoZSBSYXkgaW5zdGVhZC4KICAgICAqLwoKCiAgICBpbnRlcnNlY3RCb2R5KGJvZHksIHJlc3VsdCkgewogICAgICBpZiAocmVzdWx0KSB7CiAgICAgICAgdGhpcy5yZXN1bHQgPSByZXN1bHQ7CiAgICAgICAgdGhpcy51cGRhdGVEaXJlY3Rpb24oKTsKICAgICAgfQoKICAgICAgY29uc3QgY2hlY2tDb2xsaXNpb25SZXNwb25zZSA9IHRoaXMuY2hlY2tDb2xsaXNpb25SZXNwb25zZTsKCiAgICAgIGlmIChjaGVja0NvbGxpc2lvblJlc3BvbnNlICYmICFib2R5LmNvbGxpc2lvblJlc3BvbnNlKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICBpZiAoKHRoaXMuY29sbGlzaW9uRmlsdGVyR3JvdXAgJiBib2R5LmNvbGxpc2lvbkZpbHRlck1hc2spID09PSAwIHx8IChib2R5LmNvbGxpc2lvbkZpbHRlckdyb3VwICYgdGhpcy5jb2xsaXNpb25GaWx0ZXJNYXNrKSA9PT0gMCkgewogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgY29uc3QgeGkgPSBpbnRlcnNlY3RCb2R5X3hpOwogICAgICBjb25zdCBxaSA9IGludGVyc2VjdEJvZHlfcWk7CgogICAgICBmb3IgKGxldCBpID0gMCwgTiA9IGJvZHkuc2hhcGVzLmxlbmd0aDsgaSA8IE47IGkrKykgewogICAgICAgIGNvbnN0IHNoYXBlID0gYm9keS5zaGFwZXNbaV07CgogICAgICAgIGlmIChjaGVja0NvbGxpc2lvblJlc3BvbnNlICYmICFzaGFwZS5jb2xsaXNpb25SZXNwb25zZSkgewogICAgICAgICAgY29udGludWU7IC8vIFNraXAKICAgICAgICB9CgogICAgICAgIGJvZHkucXVhdGVybmlvbi5tdWx0KGJvZHkuc2hhcGVPcmllbnRhdGlvbnNbaV0sIHFpKTsKICAgICAgICBib2R5LnF1YXRlcm5pb24udm11bHQoYm9keS5zaGFwZU9mZnNldHNbaV0sIHhpKTsKICAgICAgICB4aS52YWRkKGJvZHkucG9zaXRpb24sIHhpKTsKICAgICAgICB0aGlzLmludGVyc2VjdFNoYXBlKHNoYXBlLCBxaSwgeGksIGJvZHkpOwoKICAgICAgICBpZiAodGhpcy5yZXN1bHQuc2hvdWxkU3RvcCkgewogICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIFNob290IGEgcmF5IGF0IGFuIGFycmF5IGJvZGllcywgZ2V0IGJhY2sgaW5mb3JtYXRpb24gYWJvdXQgdGhlIGhpdC4KICAgICAqIEBwYXJhbSBib2RpZXMgQW4gYXJyYXkgb2YgQm9keSBvYmplY3RzLgogICAgICogQGRlcHJlY2F0ZWQgQHBhcmFtIHJlc3VsdCBzZXQgdGhlIHJlc3VsdCBwcm9wZXJ0eSBvZiB0aGUgUmF5IGluc3RlYWQuCiAgICAgKgogICAgICovCgoKICAgIGludGVyc2VjdEJvZGllcyhib2RpZXMsIHJlc3VsdCkgewogICAgICBpZiAocmVzdWx0KSB7CiAgICAgICAgdGhpcy5yZXN1bHQgPSByZXN1bHQ7CiAgICAgICAgdGhpcy51cGRhdGVEaXJlY3Rpb24oKTsKICAgICAgfQoKICAgICAgZm9yIChsZXQgaSA9IDAsIGwgPSBib2RpZXMubGVuZ3RoOyAhdGhpcy5yZXN1bHQuc2hvdWxkU3RvcCAmJiBpIDwgbDsgaSsrKSB7CiAgICAgICAgdGhpcy5pbnRlcnNlY3RCb2R5KGJvZGllc1tpXSk7CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogVXBkYXRlcyB0aGUgZGlyZWN0aW9uIHZlY3Rvci4KICAgICAqLwoKCiAgICB1cGRhdGVEaXJlY3Rpb24oKSB7CiAgICAgIHRoaXMudG8udnN1Yih0aGlzLmZyb20sIHRoaXMuZGlyZWN0aW9uKTsKICAgICAgdGhpcy5kaXJlY3Rpb24ubm9ybWFsaXplKCk7CiAgICB9CgogICAgaW50ZXJzZWN0U2hhcGUoc2hhcGUsIHF1YXQsIHBvc2l0aW9uLCBib2R5KSB7CiAgICAgIGNvbnN0IGZyb20gPSB0aGlzLmZyb207IC8vIENoZWNraW5nIGJvdW5kaW5nU3BoZXJlCgogICAgICBjb25zdCBkaXN0YW5jZSA9IGRpc3RhbmNlRnJvbUludGVyc2VjdGlvbihmcm9tLCB0aGlzLmRpcmVjdGlvbiwgcG9zaXRpb24pOwoKICAgICAgaWYgKGRpc3RhbmNlID4gc2hhcGUuYm91bmRpbmdTcGhlcmVSYWRpdXMpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIGNvbnN0IGludGVyc2VjdE1ldGhvZCA9IHRoaXNbc2hhcGUudHlwZV07CgogICAgICBpZiAoaW50ZXJzZWN0TWV0aG9kKSB7CiAgICAgICAgaW50ZXJzZWN0TWV0aG9kLmNhbGwodGhpcywgc2hhcGUsIHF1YXQsIHBvc2l0aW9uLCBib2R5LCBzaGFwZSk7CiAgICAgIH0KICAgIH0KCiAgICBfaW50ZXJzZWN0Qm94KGJveCwgcXVhdCwgcG9zaXRpb24sIGJvZHksIHJlcG9ydGVkU2hhcGUpIHsKICAgICAgcmV0dXJuIHRoaXMuX2ludGVyc2VjdENvbnZleChib3guY29udmV4UG9seWhlZHJvblJlcHJlc2VudGF0aW9uLCBxdWF0LCBwb3NpdGlvbiwgYm9keSwgcmVwb3J0ZWRTaGFwZSk7CiAgICB9CgogICAgX2ludGVyc2VjdFBsYW5lKHNoYXBlLCBxdWF0LCBwb3NpdGlvbiwgYm9keSwgcmVwb3J0ZWRTaGFwZSkgewogICAgICBjb25zdCBmcm9tID0gdGhpcy5mcm9tOwogICAgICBjb25zdCB0byA9IHRoaXMudG87CiAgICAgIGNvbnN0IGRpcmVjdGlvbiA9IHRoaXMuZGlyZWN0aW9uOyAvLyBHZXQgcGxhbmUgbm9ybWFsCgogICAgICBjb25zdCB3b3JsZE5vcm1hbCA9IG5ldyBWZWMzKDAsIDAsIDEpOwogICAgICBxdWF0LnZtdWx0KHdvcmxkTm9ybWFsLCB3b3JsZE5vcm1hbCk7CiAgICAgIGNvbnN0IGxlbiA9IG5ldyBWZWMzKCk7CiAgICAgIGZyb20udnN1Yihwb3NpdGlvbiwgbGVuKTsKICAgICAgY29uc3QgcGxhbmVUb0Zyb20gPSBsZW4uZG90KHdvcmxkTm9ybWFsKTsKICAgICAgdG8udnN1Yihwb3NpdGlvbiwgbGVuKTsKICAgICAgY29uc3QgcGxhbmVUb1RvID0gbGVuLmRvdCh3b3JsZE5vcm1hbCk7CgogICAgICBpZiAocGxhbmVUb0Zyb20gKiBwbGFuZVRvVG8gPiAwKSB7CiAgICAgICAgLy8gImZyb20iIGFuZCAidG8iIGFyZSBvbiB0aGUgc2FtZSBzaWRlIG9mIHRoZSBwbGFuZS4uLiBiYWlsIG91dAogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgaWYgKGZyb20uZGlzdGFuY2VUbyh0bykgPCBwbGFuZVRvRnJvbSkgewogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgY29uc3Qgbl9kb3RfZGlyID0gd29ybGROb3JtYWwuZG90KGRpcmVjdGlvbik7CgogICAgICBpZiAoTWF0aC5hYnMobl9kb3RfZGlyKSA8IHRoaXMucHJlY2lzaW9uKSB7CiAgICAgICAgLy8gTm8gaW50ZXJzZWN0aW9uCiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICBjb25zdCBwbGFuZVBvaW50VG9Gcm9tID0gbmV3IFZlYzMoKTsKICAgICAgY29uc3QgZGlyX3NjYWxlZF93aXRoX3QgPSBuZXcgVmVjMygpOwogICAgICBjb25zdCBoaXRQb2ludFdvcmxkID0gbmV3IFZlYzMoKTsKICAgICAgZnJvbS52c3ViKHBvc2l0aW9uLCBwbGFuZVBvaW50VG9Gcm9tKTsKICAgICAgY29uc3QgdCA9IC13b3JsZE5vcm1hbC5kb3QocGxhbmVQb2ludFRvRnJvbSkgLyBuX2RvdF9kaXI7CiAgICAgIGRpcmVjdGlvbi5zY2FsZSh0LCBkaXJfc2NhbGVkX3dpdGhfdCk7CiAgICAgIGZyb20udmFkZChkaXJfc2NhbGVkX3dpdGhfdCwgaGl0UG9pbnRXb3JsZCk7CiAgICAgIHRoaXMucmVwb3J0SW50ZXJzZWN0aW9uKHdvcmxkTm9ybWFsLCBoaXRQb2ludFdvcmxkLCByZXBvcnRlZFNoYXBlLCBib2R5LCAtMSk7CiAgICB9CiAgICAvKioKICAgICAqIEdldCB0aGUgd29ybGQgQUFCQiBvZiB0aGUgcmF5LgogICAgICovCgoKICAgIGdldEFBQkIoYWFiYikgewogICAgICBjb25zdCB7CiAgICAgICAgbG93ZXJCb3VuZCwKICAgICAgICB1cHBlckJvdW5kCiAgICAgIH0gPSBhYWJiOwogICAgICBjb25zdCB0byA9IHRoaXMudG87CiAgICAgIGNvbnN0IGZyb20gPSB0aGlzLmZyb207CiAgICAgIGxvd2VyQm91bmQueCA9IE1hdGgubWluKHRvLngsIGZyb20ueCk7CiAgICAgIGxvd2VyQm91bmQueSA9IE1hdGgubWluKHRvLnksIGZyb20ueSk7CiAgICAgIGxvd2VyQm91bmQueiA9IE1hdGgubWluKHRvLnosIGZyb20ueik7CiAgICAgIHVwcGVyQm91bmQueCA9IE1hdGgubWF4KHRvLngsIGZyb20ueCk7CiAgICAgIHVwcGVyQm91bmQueSA9IE1hdGgubWF4KHRvLnksIGZyb20ueSk7CiAgICAgIHVwcGVyQm91bmQueiA9IE1hdGgubWF4KHRvLnosIGZyb20ueik7CiAgICB9CgogICAgX2ludGVyc2VjdEhlaWdodGZpZWxkKHNoYXBlLCBxdWF0LCBwb3NpdGlvbiwgYm9keSwgcmVwb3J0ZWRTaGFwZSkgewogICAgICBzaGFwZS5kYXRhOwogICAgICBzaGFwZS5lbGVtZW50U2l6ZTsgLy8gQ29udmVydCB0aGUgcmF5IHRvIGxvY2FsIGhlaWdodGZpZWxkIGNvb3JkaW5hdGVzCgogICAgICBjb25zdCBsb2NhbFJheSA9IGludGVyc2VjdEhlaWdodGZpZWxkX2xvY2FsUmF5OyAvL25ldyBSYXkodGhpcy5mcm9tLCB0aGlzLnRvKTsKCiAgICAgIGxvY2FsUmF5LmZyb20uY29weSh0aGlzLmZyb20pOwogICAgICBsb2NhbFJheS50by5jb3B5KHRoaXMudG8pOwogICAgICBUcmFuc2Zvcm0ucG9pbnRUb0xvY2FsRnJhbWUocG9zaXRpb24sIHF1YXQsIGxvY2FsUmF5LmZyb20sIGxvY2FsUmF5LmZyb20pOwogICAgICBUcmFuc2Zvcm0ucG9pbnRUb0xvY2FsRnJhbWUocG9zaXRpb24sIHF1YXQsIGxvY2FsUmF5LnRvLCBsb2NhbFJheS50byk7CiAgICAgIGxvY2FsUmF5LnVwZGF0ZURpcmVjdGlvbigpOyAvLyBHZXQgdGhlIGluZGV4IG9mIHRoZSBkYXRhIHBvaW50cyB0byB0ZXN0IGFnYWluc3QKCiAgICAgIGNvbnN0IGluZGV4ID0gaW50ZXJzZWN0SGVpZ2h0ZmllbGRfaW5kZXg7CiAgICAgIGxldCBpTWluWDsKICAgICAgbGV0IGlNaW5ZOwogICAgICBsZXQgaU1heFg7CiAgICAgIGxldCBpTWF4WTsgLy8gU2V0IHRvIG1heAoKICAgICAgaU1pblggPSBpTWluWSA9IDA7CiAgICAgIGlNYXhYID0gaU1heFkgPSBzaGFwZS5kYXRhLmxlbmd0aCAtIDE7CiAgICAgIGNvbnN0IGFhYmIgPSBuZXcgQUFCQigpOwogICAgICBsb2NhbFJheS5nZXRBQUJCKGFhYmIpOwogICAgICBzaGFwZS5nZXRJbmRleE9mUG9zaXRpb24oYWFiYi5sb3dlckJvdW5kLngsIGFhYmIubG93ZXJCb3VuZC55LCBpbmRleCwgdHJ1ZSk7CiAgICAgIGlNaW5YID0gTWF0aC5tYXgoaU1pblgsIGluZGV4WzBdKTsKICAgICAgaU1pblkgPSBNYXRoLm1heChpTWluWSwgaW5kZXhbMV0pOwogICAgICBzaGFwZS5nZXRJbmRleE9mUG9zaXRpb24oYWFiYi51cHBlckJvdW5kLngsIGFhYmIudXBwZXJCb3VuZC55LCBpbmRleCwgdHJ1ZSk7CiAgICAgIGlNYXhYID0gTWF0aC5taW4oaU1heFgsIGluZGV4WzBdICsgMSk7CiAgICAgIGlNYXhZID0gTWF0aC5taW4oaU1heFksIGluZGV4WzFdICsgMSk7CgogICAgICBmb3IgKGxldCBpID0gaU1pblg7IGkgPCBpTWF4WDsgaSsrKSB7CiAgICAgICAgZm9yIChsZXQgaiA9IGlNaW5ZOyBqIDwgaU1heFk7IGorKykgewogICAgICAgICAgaWYgKHRoaXMucmVzdWx0LnNob3VsZFN0b3ApIHsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgfQoKICAgICAgICAgIHNoYXBlLmdldEFhYmJBdEluZGV4KGksIGosIGFhYmIpOwoKICAgICAgICAgIGlmICghYWFiYi5vdmVybGFwc1JheShsb2NhbFJheSkpIHsKICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICB9IC8vIExvd2VyIHRyaWFuZ2xlCgoKICAgICAgICAgIHNoYXBlLmdldENvbnZleFRyaWFuZ2xlUGlsbGFyKGksIGosIGZhbHNlKTsKICAgICAgICAgIFRyYW5zZm9ybS5wb2ludFRvV29ybGRGcmFtZShwb3NpdGlvbiwgcXVhdCwgc2hhcGUucGlsbGFyT2Zmc2V0LCB3b3JsZFBpbGxhck9mZnNldCk7CgogICAgICAgICAgdGhpcy5faW50ZXJzZWN0Q29udmV4KHNoYXBlLnBpbGxhckNvbnZleCwgcXVhdCwgd29ybGRQaWxsYXJPZmZzZXQsIGJvZHksIHJlcG9ydGVkU2hhcGUsIGludGVyc2VjdENvbnZleE9wdGlvbnMpOwoKICAgICAgICAgIGlmICh0aGlzLnJlc3VsdC5zaG91bGRTdG9wKSB7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgIH0gLy8gVXBwZXIgdHJpYW5nbGUKCgogICAgICAgICAgc2hhcGUuZ2V0Q29udmV4VHJpYW5nbGVQaWxsYXIoaSwgaiwgdHJ1ZSk7CiAgICAgICAgICBUcmFuc2Zvcm0ucG9pbnRUb1dvcmxkRnJhbWUocG9zaXRpb24sIHF1YXQsIHNoYXBlLnBpbGxhck9mZnNldCwgd29ybGRQaWxsYXJPZmZzZXQpOwoKICAgICAgICAgIHRoaXMuX2ludGVyc2VjdENvbnZleChzaGFwZS5waWxsYXJDb252ZXgsIHF1YXQsIHdvcmxkUGlsbGFyT2Zmc2V0LCBib2R5LCByZXBvcnRlZFNoYXBlLCBpbnRlcnNlY3RDb252ZXhPcHRpb25zKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KCiAgICBfaW50ZXJzZWN0U3BoZXJlKHNwaGVyZSwgcXVhdCwgcG9zaXRpb24sIGJvZHksIHJlcG9ydGVkU2hhcGUpIHsKICAgICAgY29uc3QgZnJvbSA9IHRoaXMuZnJvbTsKICAgICAgY29uc3QgdG8gPSB0aGlzLnRvOwogICAgICBjb25zdCByID0gc3BoZXJlLnJhZGl1czsKICAgICAgY29uc3QgYSA9ICh0by54IC0gZnJvbS54KSAqKiAyICsgKHRvLnkgLSBmcm9tLnkpICoqIDIgKyAodG8ueiAtIGZyb20ueikgKiogMjsKICAgICAgY29uc3QgYiA9IDIgKiAoKHRvLnggLSBmcm9tLngpICogKGZyb20ueCAtIHBvc2l0aW9uLngpICsgKHRvLnkgLSBmcm9tLnkpICogKGZyb20ueSAtIHBvc2l0aW9uLnkpICsgKHRvLnogLSBmcm9tLnopICogKGZyb20ueiAtIHBvc2l0aW9uLnopKTsKICAgICAgY29uc3QgYyA9IChmcm9tLnggLSBwb3NpdGlvbi54KSAqKiAyICsgKGZyb20ueSAtIHBvc2l0aW9uLnkpICoqIDIgKyAoZnJvbS56IC0gcG9zaXRpb24ueikgKiogMiAtIHIgKiogMjsKICAgICAgY29uc3QgZGVsdGEgPSBiICoqIDIgLSA0ICogYSAqIGM7CiAgICAgIGNvbnN0IGludGVyc2VjdGlvblBvaW50ID0gUmF5X2ludGVyc2VjdFNwaGVyZV9pbnRlcnNlY3Rpb25Qb2ludDsKICAgICAgY29uc3Qgbm9ybWFsID0gUmF5X2ludGVyc2VjdFNwaGVyZV9ub3JtYWw7CgogICAgICBpZiAoZGVsdGEgPCAwKSB7CiAgICAgICAgLy8gTm8gaW50ZXJzZWN0aW9uCiAgICAgICAgcmV0dXJuOwogICAgICB9IGVsc2UgaWYgKGRlbHRhID09PSAwKSB7CiAgICAgICAgLy8gc2luZ2xlIGludGVyc2VjdGlvbiBwb2ludAogICAgICAgIGZyb20ubGVycCh0bywgZGVsdGEsIGludGVyc2VjdGlvblBvaW50KTsKICAgICAgICBpbnRlcnNlY3Rpb25Qb2ludC52c3ViKHBvc2l0aW9uLCBub3JtYWwpOwogICAgICAgIG5vcm1hbC5ub3JtYWxpemUoKTsKICAgICAgICB0aGlzLnJlcG9ydEludGVyc2VjdGlvbihub3JtYWwsIGludGVyc2VjdGlvblBvaW50LCByZXBvcnRlZFNoYXBlLCBib2R5LCAtMSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgY29uc3QgZDEgPSAoLWIgLSBNYXRoLnNxcnQoZGVsdGEpKSAvICgyICogYSk7CiAgICAgICAgY29uc3QgZDIgPSAoLWIgKyBNYXRoLnNxcnQoZGVsdGEpKSAvICgyICogYSk7CgogICAgICAgIGlmIChkMSA+PSAwICYmIGQxIDw9IDEpIHsKICAgICAgICAgIGZyb20ubGVycCh0bywgZDEsIGludGVyc2VjdGlvblBvaW50KTsKICAgICAgICAgIGludGVyc2VjdGlvblBvaW50LnZzdWIocG9zaXRpb24sIG5vcm1hbCk7CiAgICAgICAgICBub3JtYWwubm9ybWFsaXplKCk7CiAgICAgICAgICB0aGlzLnJlcG9ydEludGVyc2VjdGlvbihub3JtYWwsIGludGVyc2VjdGlvblBvaW50LCByZXBvcnRlZFNoYXBlLCBib2R5LCAtMSk7CiAgICAgICAgfQoKICAgICAgICBpZiAodGhpcy5yZXN1bHQuc2hvdWxkU3RvcCkgewogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgaWYgKGQyID49IDAgJiYgZDIgPD0gMSkgewogICAgICAgICAgZnJvbS5sZXJwKHRvLCBkMiwgaW50ZXJzZWN0aW9uUG9pbnQpOwogICAgICAgICAgaW50ZXJzZWN0aW9uUG9pbnQudnN1Yihwb3NpdGlvbiwgbm9ybWFsKTsKICAgICAgICAgIG5vcm1hbC5ub3JtYWxpemUoKTsKICAgICAgICAgIHRoaXMucmVwb3J0SW50ZXJzZWN0aW9uKG5vcm1hbCwgaW50ZXJzZWN0aW9uUG9pbnQsIHJlcG9ydGVkU2hhcGUsIGJvZHksIC0xKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KCiAgICBfaW50ZXJzZWN0Q29udmV4KHNoYXBlLCBxdWF0LCBwb3NpdGlvbiwgYm9keSwgcmVwb3J0ZWRTaGFwZSwgb3B0aW9ucykgewogICAgICBjb25zdCBub3JtYWwgPSBpbnRlcnNlY3RDb252ZXhfbm9ybWFsOwogICAgICBjb25zdCB2ZWN0b3IgPSBpbnRlcnNlY3RDb252ZXhfdmVjdG9yOwogICAgICBjb25zdCBmYWNlTGlzdCA9IG9wdGlvbnMgJiYgb3B0aW9ucy5mYWNlTGlzdCB8fCBudWxsOyAvLyBDaGVja2luZyBmYWNlcwoKICAgICAgY29uc3QgZmFjZXMgPSBzaGFwZS5mYWNlczsKICAgICAgY29uc3QgdmVydGljZXMgPSBzaGFwZS52ZXJ0aWNlczsKICAgICAgY29uc3Qgbm9ybWFscyA9IHNoYXBlLmZhY2VOb3JtYWxzOwogICAgICBjb25zdCBkaXJlY3Rpb24gPSB0aGlzLmRpcmVjdGlvbjsKICAgICAgY29uc3QgZnJvbSA9IHRoaXMuZnJvbTsKICAgICAgY29uc3QgdG8gPSB0aGlzLnRvOwogICAgICBjb25zdCBmcm9tVG9EaXN0YW5jZSA9IGZyb20uZGlzdGFuY2VUbyh0byk7CiAgICAgIGNvbnN0IE5mYWNlcyA9IGZhY2VMaXN0ID8gZmFjZUxpc3QubGVuZ3RoIDogZmFjZXMubGVuZ3RoOwogICAgICBjb25zdCByZXN1bHQgPSB0aGlzLnJlc3VsdDsKCiAgICAgIGZvciAobGV0IGogPSAwOyAhcmVzdWx0LnNob3VsZFN0b3AgJiYgaiA8IE5mYWNlczsgaisrKSB7CiAgICAgICAgY29uc3QgZmkgPSBmYWNlTGlzdCA/IGZhY2VMaXN0W2pdIDogajsKICAgICAgICBjb25zdCBmYWNlID0gZmFjZXNbZmldOwogICAgICAgIGNvbnN0IGZhY2VOb3JtYWwgPSBub3JtYWxzW2ZpXTsKICAgICAgICBjb25zdCBxID0gcXVhdDsKICAgICAgICBjb25zdCB4ID0gcG9zaXRpb247IC8vIGRldGVybWluZSBpZiByYXkgaW50ZXJzZWN0cyB0aGUgcGxhbmUgb2YgdGhlIGZhY2UKICAgICAgICAvLyBub3RlOiB0aGlzIHdvcmtzIHJlZ2FyZGxlc3Mgb2YgdGhlIGRpcmVjdGlvbiBvZiB0aGUgZmFjZSBub3JtYWwKICAgICAgICAvLyBHZXQgcGxhbmUgcG9pbnQgaW4gd29ybGQgY29vcmRpbmF0ZXMuLi4KCiAgICAgICAgdmVjdG9yLmNvcHkodmVydGljZXNbZmFjZVswXV0pOwogICAgICAgIHEudm11bHQodmVjdG9yLCB2ZWN0b3IpOwogICAgICAgIHZlY3Rvci52YWRkKHgsIHZlY3Rvcik7IC8vIC4uLmJ1dCBtYWtlIGl0IHJlbGF0aXZlIHRvIHRoZSByYXkgZnJvbS4gV2UnbGwgZml4IHRoaXMgbGF0ZXIuCgogICAgICAgIHZlY3Rvci52c3ViKGZyb20sIHZlY3Rvcik7IC8vIEdldCBwbGFuZSBub3JtYWwKCiAgICAgICAgcS52bXVsdChmYWNlTm9ybWFsLCBub3JtYWwpOyAvLyBJZiB0aGlzIGRvdCBwcm9kdWN0IGlzIG5lZ2F0aXZlLCB3ZSBoYXZlIHNvbWV0aGluZyBpbnRlcmVzdGluZwoKICAgICAgICBjb25zdCBkb3QgPSBkaXJlY3Rpb24uZG90KG5vcm1hbCk7IC8vIEJhaWwgb3V0IGlmIHJheSBhbmQgcGxhbmUgYXJlIHBhcmFsbGVsCgogICAgICAgIGlmIChNYXRoLmFicyhkb3QpIDwgdGhpcy5wcmVjaXNpb24pIHsKICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgIH0gLy8gY2FsYyBkaXN0YW5jZSB0byBwbGFuZQoKCiAgICAgICAgY29uc3Qgc2NhbGFyID0gbm9ybWFsLmRvdCh2ZWN0b3IpIC8gZG90OyAvLyBpZiBuZWdhdGl2ZSBkaXN0YW5jZSwgdGhlbiBwbGFuZSBpcyBiZWhpbmQgcmF5CgogICAgICAgIGlmIChzY2FsYXIgPCAwKSB7CiAgICAgICAgICBjb250aW51ZTsKICAgICAgICB9IC8vIGlmIChkb3QgPCAwKSB7CiAgICAgICAgLy8gSW50ZXJzZWN0aW9uIHBvaW50IGlzIGZyb20gKyBkaXJlY3Rpb24gKiBzY2FsYXIKCgogICAgICAgIGRpcmVjdGlvbi5zY2FsZShzY2FsYXIsIGludGVyc2VjdFBvaW50KTsKICAgICAgICBpbnRlcnNlY3RQb2ludC52YWRkKGZyb20sIGludGVyc2VjdFBvaW50KTsgLy8gYSBpcyB0aGUgcG9pbnQgd2UgY29tcGFyZSBwb2ludHMgYiBhbmQgYyB3aXRoLgoKICAgICAgICBhLmNvcHkodmVydGljZXNbZmFjZVswXV0pOwogICAgICAgIHEudm11bHQoYSwgYSk7CiAgICAgICAgeC52YWRkKGEsIGEpOwoKICAgICAgICBmb3IgKGxldCBpID0gMTsgIXJlc3VsdC5zaG91bGRTdG9wICYmIGkgPCBmYWNlLmxlbmd0aCAtIDE7IGkrKykgewogICAgICAgICAgLy8gVHJhbnNmb3JtIDMgdmVydGljZXMgdG8gd29ybGQgY29vcmRzCiAgICAgICAgICBiLmNvcHkodmVydGljZXNbZmFjZVtpXV0pOwogICAgICAgICAgYy5jb3B5KHZlcnRpY2VzW2ZhY2VbaSArIDFdXSk7CiAgICAgICAgICBxLnZtdWx0KGIsIGIpOwogICAgICAgICAgcS52bXVsdChjLCBjKTsKICAgICAgICAgIHgudmFkZChiLCBiKTsKICAgICAgICAgIHgudmFkZChjLCBjKTsKICAgICAgICAgIGNvbnN0IGRpc3RhbmNlID0gaW50ZXJzZWN0UG9pbnQuZGlzdGFuY2VUbyhmcm9tKTsKCiAgICAgICAgICBpZiAoIShSYXkucG9pbnRJblRyaWFuZ2xlKGludGVyc2VjdFBvaW50LCBhLCBiLCBjKSB8fCBSYXkucG9pbnRJblRyaWFuZ2xlKGludGVyc2VjdFBvaW50LCBiLCBhLCBjKSkgfHwgZGlzdGFuY2UgPiBmcm9tVG9EaXN0YW5jZSkgewogICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgIH0KCiAgICAgICAgICB0aGlzLnJlcG9ydEludGVyc2VjdGlvbihub3JtYWwsIGludGVyc2VjdFBvaW50LCByZXBvcnRlZFNoYXBlLCBib2R5LCBmaSk7CiAgICAgICAgfSAvLyB9CgogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIEB0b2RvIE9wdGltaXplIGJ5IHRyYW5zZm9ybWluZyB0aGUgd29ybGQgdG8gbG9jYWwgc3BhY2UgZmlyc3QuCiAgICAgKiBAdG9kbyBVc2UgT2N0cmVlIGxvb2t1cAogICAgICovCgoKICAgIF9pbnRlcnNlY3RUcmltZXNoKG1lc2gsIHF1YXQsIHBvc2l0aW9uLCBib2R5LCByZXBvcnRlZFNoYXBlLCBvcHRpb25zKSB7CiAgICAgIGNvbnN0IG5vcm1hbCA9IGludGVyc2VjdFRyaW1lc2hfbm9ybWFsOwogICAgICBjb25zdCB0cmlhbmdsZXMgPSBpbnRlcnNlY3RUcmltZXNoX3RyaWFuZ2xlczsKICAgICAgY29uc3QgdHJlZVRyYW5zZm9ybSA9IGludGVyc2VjdFRyaW1lc2hfdHJlZVRyYW5zZm9ybTsKICAgICAgY29uc3QgdmVjdG9yID0gaW50ZXJzZWN0Q29udmV4X3ZlY3RvcjsKICAgICAgY29uc3QgbG9jYWxEaXJlY3Rpb24gPSBpbnRlcnNlY3RUcmltZXNoX2xvY2FsRGlyZWN0aW9uOwogICAgICBjb25zdCBsb2NhbEZyb20gPSBpbnRlcnNlY3RUcmltZXNoX2xvY2FsRnJvbTsKICAgICAgY29uc3QgbG9jYWxUbyA9IGludGVyc2VjdFRyaW1lc2hfbG9jYWxUbzsKICAgICAgY29uc3Qgd29ybGRJbnRlcnNlY3RQb2ludCA9IGludGVyc2VjdFRyaW1lc2hfd29ybGRJbnRlcnNlY3RQb2ludDsKICAgICAgY29uc3Qgd29ybGROb3JtYWwgPSBpbnRlcnNlY3RUcmltZXNoX3dvcmxkTm9ybWFsOyAvLyBDaGVja2luZyBmYWNlcwoKICAgICAgY29uc3QgaW5kaWNlcyA9IG1lc2guaW5kaWNlczsKICAgICAgbWVzaC52ZXJ0aWNlczsgLy8gY29uc3Qgbm9ybWFscyA9IG1lc2guZmFjZU5vcm1hbHMKCiAgICAgIGNvbnN0IGZyb20gPSB0aGlzLmZyb207CiAgICAgIGNvbnN0IHRvID0gdGhpcy50bzsKICAgICAgY29uc3QgZGlyZWN0aW9uID0gdGhpcy5kaXJlY3Rpb247CiAgICAgIHRyZWVUcmFuc2Zvcm0ucG9zaXRpb24uY29weShwb3NpdGlvbik7CiAgICAgIHRyZWVUcmFuc2Zvcm0ucXVhdGVybmlvbi5jb3B5KHF1YXQpOyAvLyBUcmFuc2Zvcm0gcmF5IHRvIGxvY2FsIHNwYWNlIQoKICAgICAgVHJhbnNmb3JtLnZlY3RvclRvTG9jYWxGcmFtZShwb3NpdGlvbiwgcXVhdCwgZGlyZWN0aW9uLCBsb2NhbERpcmVjdGlvbik7CiAgICAgIFRyYW5zZm9ybS5wb2ludFRvTG9jYWxGcmFtZShwb3NpdGlvbiwgcXVhdCwgZnJvbSwgbG9jYWxGcm9tKTsKICAgICAgVHJhbnNmb3JtLnBvaW50VG9Mb2NhbEZyYW1lKHBvc2l0aW9uLCBxdWF0LCB0bywgbG9jYWxUbyk7CiAgICAgIGxvY2FsVG8ueCAqPSBtZXNoLnNjYWxlLng7CiAgICAgIGxvY2FsVG8ueSAqPSBtZXNoLnNjYWxlLnk7CiAgICAgIGxvY2FsVG8ueiAqPSBtZXNoLnNjYWxlLno7CiAgICAgIGxvY2FsRnJvbS54ICo9IG1lc2guc2NhbGUueDsKICAgICAgbG9jYWxGcm9tLnkgKj0gbWVzaC5zY2FsZS55OwogICAgICBsb2NhbEZyb20ueiAqPSBtZXNoLnNjYWxlLno7CiAgICAgIGxvY2FsVG8udnN1Yihsb2NhbEZyb20sIGxvY2FsRGlyZWN0aW9uKTsKICAgICAgbG9jYWxEaXJlY3Rpb24ubm9ybWFsaXplKCk7CiAgICAgIGNvbnN0IGZyb21Ub0Rpc3RhbmNlU3F1YXJlZCA9IGxvY2FsRnJvbS5kaXN0YW5jZVNxdWFyZWQobG9jYWxUbyk7CiAgICAgIG1lc2gudHJlZS5yYXlRdWVyeSh0aGlzLCB0cmVlVHJhbnNmb3JtLCB0cmlhbmdsZXMpOwoKICAgICAgZm9yIChsZXQgaSA9IDAsIE4gPSB0cmlhbmdsZXMubGVuZ3RoOyAhdGhpcy5yZXN1bHQuc2hvdWxkU3RvcCAmJiBpICE9PSBOOyBpKyspIHsKICAgICAgICBjb25zdCB0cmlhbmdsZXNJbmRleCA9IHRyaWFuZ2xlc1tpXTsKICAgICAgICBtZXNoLmdldE5vcm1hbCh0cmlhbmdsZXNJbmRleCwgbm9ybWFsKTsgLy8gZGV0ZXJtaW5lIGlmIHJheSBpbnRlcnNlY3RzIHRoZSBwbGFuZSBvZiB0aGUgZmFjZQogICAgICAgIC8vIG5vdGU6IHRoaXMgd29ya3MgcmVnYXJkbGVzcyBvZiB0aGUgZGlyZWN0aW9uIG9mIHRoZSBmYWNlIG5vcm1hbAogICAgICAgIC8vIEdldCBwbGFuZSBwb2ludCBpbiB3b3JsZCBjb29yZGluYXRlcy4uLgoKICAgICAgICBtZXNoLmdldFZlcnRleChpbmRpY2VzW3RyaWFuZ2xlc0luZGV4ICogM10sIGEpOyAvLyAuLi5idXQgbWFrZSBpdCByZWxhdGl2ZSB0byB0aGUgcmF5IGZyb20uIFdlJ2xsIGZpeCB0aGlzIGxhdGVyLgoKICAgICAgICBhLnZzdWIobG9jYWxGcm9tLCB2ZWN0b3IpOyAvLyBJZiB0aGlzIGRvdCBwcm9kdWN0IGlzIG5lZ2F0aXZlLCB3ZSBoYXZlIHNvbWV0aGluZyBpbnRlcmVzdGluZwoKICAgICAgICBjb25zdCBkb3QgPSBsb2NhbERpcmVjdGlvbi5kb3Qobm9ybWFsKTsgLy8gQmFpbCBvdXQgaWYgcmF5IGFuZCBwbGFuZSBhcmUgcGFyYWxsZWwKICAgICAgICAvLyBpZiAoTWF0aC5hYnMoIGRvdCApIDwgdGhpcy5wcmVjaXNpb24pewogICAgICAgIC8vICAgICBjb250aW51ZTsKICAgICAgICAvLyB9CiAgICAgICAgLy8gY2FsYyBkaXN0YW5jZSB0byBwbGFuZQoKICAgICAgICBjb25zdCBzY2FsYXIgPSBub3JtYWwuZG90KHZlY3RvcikgLyBkb3Q7IC8vIGlmIG5lZ2F0aXZlIGRpc3RhbmNlLCB0aGVuIHBsYW5lIGlzIGJlaGluZCByYXkKCiAgICAgICAgaWYgKHNjYWxhciA8IDApIHsKICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgIH0gLy8gSW50ZXJzZWN0aW9uIHBvaW50IGlzIGZyb20gKyBkaXJlY3Rpb24gKiBzY2FsYXIKCgogICAgICAgIGxvY2FsRGlyZWN0aW9uLnNjYWxlKHNjYWxhciwgaW50ZXJzZWN0UG9pbnQpOwogICAgICAgIGludGVyc2VjdFBvaW50LnZhZGQobG9jYWxGcm9tLCBpbnRlcnNlY3RQb2ludCk7IC8vIEdldCB0cmlhbmdsZSB2ZXJ0aWNlcwoKICAgICAgICBtZXNoLmdldFZlcnRleChpbmRpY2VzW3RyaWFuZ2xlc0luZGV4ICogMyArIDFdLCBiKTsKICAgICAgICBtZXNoLmdldFZlcnRleChpbmRpY2VzW3RyaWFuZ2xlc0luZGV4ICogMyArIDJdLCBjKTsKICAgICAgICBjb25zdCBzcXVhcmVkRGlzdGFuY2UgPSBpbnRlcnNlY3RQb2ludC5kaXN0YW5jZVNxdWFyZWQobG9jYWxGcm9tKTsKCiAgICAgICAgaWYgKCEoUmF5LnBvaW50SW5UcmlhbmdsZShpbnRlcnNlY3RQb2ludCwgYiwgYSwgYykgfHwgUmF5LnBvaW50SW5UcmlhbmdsZShpbnRlcnNlY3RQb2ludCwgYSwgYiwgYykpIHx8IHNxdWFyZWREaXN0YW5jZSA+IGZyb21Ub0Rpc3RhbmNlU3F1YXJlZCkgewogICAgICAgICAgY29udGludWU7CiAgICAgICAgfSAvLyB0cmFuc2Zvcm0gaW50ZXJzZWN0cG9pbnQgYW5kIG5vcm1hbCB0byB3b3JsZAoKCiAgICAgICAgVHJhbnNmb3JtLnZlY3RvclRvV29ybGRGcmFtZShxdWF0LCBub3JtYWwsIHdvcmxkTm9ybWFsKTsKICAgICAgICBUcmFuc2Zvcm0ucG9pbnRUb1dvcmxkRnJhbWUocG9zaXRpb24sIHF1YXQsIGludGVyc2VjdFBvaW50LCB3b3JsZEludGVyc2VjdFBvaW50KTsKICAgICAgICB0aGlzLnJlcG9ydEludGVyc2VjdGlvbih3b3JsZE5vcm1hbCwgd29ybGRJbnRlcnNlY3RQb2ludCwgcmVwb3J0ZWRTaGFwZSwgYm9keSwgdHJpYW5nbGVzSW5kZXgpOwogICAgICB9CgogICAgICB0cmlhbmdsZXMubGVuZ3RoID0gMDsKICAgIH0KICAgIC8qKgogICAgICogQHJldHVybiBUcnVlIGlmIHRoZSBpbnRlcnNlY3Rpb25zIHNob3VsZCBjb250aW51ZQogICAgICovCgoKICAgIHJlcG9ydEludGVyc2VjdGlvbihub3JtYWwsIGhpdFBvaW50V29ybGQsIHNoYXBlLCBib2R5LCBoaXRGYWNlSW5kZXgpIHsKICAgICAgY29uc3QgZnJvbSA9IHRoaXMuZnJvbTsKICAgICAgY29uc3QgdG8gPSB0aGlzLnRvOwogICAgICBjb25zdCBkaXN0YW5jZSA9IGZyb20uZGlzdGFuY2VUbyhoaXRQb2ludFdvcmxkKTsKICAgICAgY29uc3QgcmVzdWx0ID0gdGhpcy5yZXN1bHQ7IC8vIFNraXAgYmFjayBmYWNlcz8KCiAgICAgIGlmICh0aGlzLnNraXBCYWNrZmFjZXMgJiYgbm9ybWFsLmRvdCh0aGlzLmRpcmVjdGlvbikgPiAwKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICByZXN1bHQuaGl0RmFjZUluZGV4ID0gdHlwZW9mIGhpdEZhY2VJbmRleCAhPT0gJ3VuZGVmaW5lZCcgPyBoaXRGYWNlSW5kZXggOiAtMTsKCiAgICAgIHN3aXRjaCAodGhpcy5tb2RlKSB7CiAgICAgICAgY2FzZSBSYXkuQUxMOgogICAgICAgICAgdGhpcy5oYXNIaXQgPSB0cnVlOwogICAgICAgICAgcmVzdWx0LnNldChmcm9tLCB0bywgbm9ybWFsLCBoaXRQb2ludFdvcmxkLCBzaGFwZSwgYm9keSwgZGlzdGFuY2UpOwogICAgICAgICAgcmVzdWx0Lmhhc0hpdCA9IHRydWU7CiAgICAgICAgICB0aGlzLmNhbGxiYWNrKHJlc3VsdCk7CiAgICAgICAgICBicmVhazsKCiAgICAgICAgY2FzZSBSYXkuQ0xPU0VTVDoKICAgICAgICAgIC8vIFN0b3JlIGlmIGNsb3NlciB0aGFuIGN1cnJlbnQgY2xvc2VzdAogICAgICAgICAgaWYgKGRpc3RhbmNlIDwgcmVzdWx0LmRpc3RhbmNlIHx8ICFyZXN1bHQuaGFzSGl0KSB7CiAgICAgICAgICAgIHRoaXMuaGFzSGl0ID0gdHJ1ZTsKICAgICAgICAgICAgcmVzdWx0Lmhhc0hpdCA9IHRydWU7CiAgICAgICAgICAgIHJlc3VsdC5zZXQoZnJvbSwgdG8sIG5vcm1hbCwgaGl0UG9pbnRXb3JsZCwgc2hhcGUsIGJvZHksIGRpc3RhbmNlKTsKICAgICAgICAgIH0KCiAgICAgICAgICBicmVhazsKCiAgICAgICAgY2FzZSBSYXkuQU5ZOgogICAgICAgICAgLy8gUmVwb3J0IGFuZCBzdG9wLgogICAgICAgICAgdGhpcy5oYXNIaXQgPSB0cnVlOwogICAgICAgICAgcmVzdWx0Lmhhc0hpdCA9IHRydWU7CiAgICAgICAgICByZXN1bHQuc2V0KGZyb20sIHRvLCBub3JtYWwsIGhpdFBvaW50V29ybGQsIHNoYXBlLCBib2R5LCBkaXN0YW5jZSk7CiAgICAgICAgICByZXN1bHQuc2hvdWxkU3RvcCA9IHRydWU7CiAgICAgICAgICBicmVhazsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBBcyBwZXIgIkJhcnljZW50cmljIFRlY2huaXF1ZSIgYXMgbmFtZWQKICAgICAqIHtAbGluayBodHRwczovL3d3dy5ibGFja3Bhd24uY29tL3RleHRzL3BvaW50aW5wb2x5L2RlZmF1bHQuaHRtbCBoZXJlfSBidXQgd2l0aG91dCB0aGUgZGl2aXNpb24KICAgICAqLwoKCiAgICBzdGF0aWMgcG9pbnRJblRyaWFuZ2xlKHAsIGEsIGIsIGMpIHsKICAgICAgYy52c3ViKGEsIHYwKTsKICAgICAgYi52c3ViKGEsIHYxKTsKICAgICAgcC52c3ViKGEsIHYyKTsKICAgICAgY29uc3QgZG90MDAgPSB2MC5kb3QodjApOwogICAgICBjb25zdCBkb3QwMSA9IHYwLmRvdCh2MSk7CiAgICAgIGNvbnN0IGRvdDAyID0gdjAuZG90KHYyKTsKICAgICAgY29uc3QgZG90MTEgPSB2MS5kb3QodjEpOwogICAgICBjb25zdCBkb3QxMiA9IHYxLmRvdCh2Mik7CiAgICAgIGxldCB1OwogICAgICBsZXQgdjsKICAgICAgcmV0dXJuICh1ID0gZG90MTEgKiBkb3QwMiAtIGRvdDAxICogZG90MTIpID49IDAgJiYgKHYgPSBkb3QwMCAqIGRvdDEyIC0gZG90MDEgKiBkb3QwMikgPj0gMCAmJiB1ICsgdiA8IGRvdDAwICogZG90MTEgLSBkb3QwMSAqIGRvdDAxOwogICAgfQoKICB9CiAgUmF5LkNMT1NFU1QgPSBSQVlfTU9ERVMuQ0xPU0VTVDsKICBSYXkuQU5ZID0gUkFZX01PREVTLkFOWTsKICBSYXkuQUxMID0gUkFZX01PREVTLkFMTDsKICBjb25zdCB0bXBBQUJCJDEgPSBuZXcgQUFCQigpOwogIGNvbnN0IHRtcEFycmF5ID0gW107CiAgY29uc3QgdjEgPSBuZXcgVmVjMygpOwogIGNvbnN0IHYyID0gbmV3IFZlYzMoKTsKICBjb25zdCBpbnRlcnNlY3RCb2R5X3hpID0gbmV3IFZlYzMoKTsKICBjb25zdCBpbnRlcnNlY3RCb2R5X3FpID0gbmV3IFF1YXRlcm5pb24oKTsKICBjb25zdCBpbnRlcnNlY3RQb2ludCA9IG5ldyBWZWMzKCk7CiAgY29uc3QgYSA9IG5ldyBWZWMzKCk7CiAgY29uc3QgYiA9IG5ldyBWZWMzKCk7CiAgY29uc3QgYyA9IG5ldyBWZWMzKCk7CiAgbmV3IFZlYzMoKTsKICBuZXcgUmF5Y2FzdFJlc3VsdCgpOwogIGNvbnN0IGludGVyc2VjdENvbnZleE9wdGlvbnMgPSB7CiAgICBmYWNlTGlzdDogWzBdCiAgfTsKICBjb25zdCB3b3JsZFBpbGxhck9mZnNldCA9IG5ldyBWZWMzKCk7CiAgY29uc3QgaW50ZXJzZWN0SGVpZ2h0ZmllbGRfbG9jYWxSYXkgPSBuZXcgUmF5KCk7CiAgY29uc3QgaW50ZXJzZWN0SGVpZ2h0ZmllbGRfaW5kZXggPSBbXTsKICBjb25zdCBSYXlfaW50ZXJzZWN0U3BoZXJlX2ludGVyc2VjdGlvblBvaW50ID0gbmV3IFZlYzMoKTsKICBjb25zdCBSYXlfaW50ZXJzZWN0U3BoZXJlX25vcm1hbCA9IG5ldyBWZWMzKCk7CiAgY29uc3QgaW50ZXJzZWN0Q29udmV4X25vcm1hbCA9IG5ldyBWZWMzKCk7CiAgbmV3IFZlYzMoKTsKICBuZXcgVmVjMygpOwogIGNvbnN0IGludGVyc2VjdENvbnZleF92ZWN0b3IgPSBuZXcgVmVjMygpOwogIGNvbnN0IGludGVyc2VjdFRyaW1lc2hfbm9ybWFsID0gbmV3IFZlYzMoKTsKICBjb25zdCBpbnRlcnNlY3RUcmltZXNoX2xvY2FsRGlyZWN0aW9uID0gbmV3IFZlYzMoKTsKICBjb25zdCBpbnRlcnNlY3RUcmltZXNoX2xvY2FsRnJvbSA9IG5ldyBWZWMzKCk7CiAgY29uc3QgaW50ZXJzZWN0VHJpbWVzaF9sb2NhbFRvID0gbmV3IFZlYzMoKTsKICBjb25zdCBpbnRlcnNlY3RUcmltZXNoX3dvcmxkTm9ybWFsID0gbmV3IFZlYzMoKTsKICBjb25zdCBpbnRlcnNlY3RUcmltZXNoX3dvcmxkSW50ZXJzZWN0UG9pbnQgPSBuZXcgVmVjMygpOwogIG5ldyBBQUJCKCk7CiAgY29uc3QgaW50ZXJzZWN0VHJpbWVzaF90cmlhbmdsZXMgPSBbXTsKICBjb25zdCBpbnRlcnNlY3RUcmltZXNoX3RyZWVUcmFuc2Zvcm0gPSBuZXcgVHJhbnNmb3JtKCk7CiAgY29uc3QgdjAgPSBuZXcgVmVjMygpOwogIGNvbnN0IGludGVyc2VjdCA9IG5ldyBWZWMzKCk7CgogIGZ1bmN0aW9uIGRpc3RhbmNlRnJvbUludGVyc2VjdGlvbihmcm9tLCBkaXJlY3Rpb24sIHBvc2l0aW9uKSB7CiAgICAvLyB2MCBpcyB2ZWN0b3IgZnJvbSBmcm9tIHRvIHBvc2l0aW9uCiAgICBwb3NpdGlvbi52c3ViKGZyb20sIHYwKTsKICAgIGNvbnN0IGRvdCA9IHYwLmRvdChkaXJlY3Rpb24pOyAvLyBpbnRlcnNlY3QgPSBkaXJlY3Rpb24qZG90ICsgZnJvbQoKICAgIGRpcmVjdGlvbi5zY2FsZShkb3QsIGludGVyc2VjdCk7CiAgICBpbnRlcnNlY3QudmFkZChmcm9tLCBpbnRlcnNlY3QpOwogICAgY29uc3QgZGlzdGFuY2UgPSBwb3NpdGlvbi5kaXN0YW5jZVRvKGludGVyc2VjdCk7CiAgICByZXR1cm4gZGlzdGFuY2U7CiAgfQoKICAvKioKICAgKiBTd2VlcCBhbmQgcHJ1bmUgYnJvYWRwaGFzZSBhbG9uZyBvbmUgYXhpcy4KICAgKi8KICBjbGFzcyBTQVBCcm9hZHBoYXNlIGV4dGVuZHMgQnJvYWRwaGFzZSB7CiAgICAvKioKICAgICAqIExpc3Qgb2YgYm9kaWVzIGN1cnJlbnRseSBpbiB0aGUgYnJvYWRwaGFzZS4KICAgICAqLwoKICAgIC8qKgogICAgICogVGhlIHdvcmxkIHRvIHNlYXJjaCBpbi4KICAgICAqLwoKICAgIC8qKgogICAgICogQXhpcyB0byBzb3J0IHRoZSBib2RpZXMgYWxvbmcuCiAgICAgKiBTZXQgdG8gMCBmb3IgeCBheGlzLCBhbmQgMSBmb3IgeSBheGlzLgogICAgICogRm9yIGJlc3QgcGVyZm9ybWFuY2UsIHBpY2sgdGhlIGF4aXMgd2hlcmUgYm9kaWVzIGFyZSBtb3N0IGRpc3RyaWJ1dGVkLgogICAgICovCgogICAgLyoqCiAgICAgKiBDaGVjayBpZiB0aGUgYm91bmRzIG9mIHR3byBib2RpZXMgb3ZlcmxhcCwgYWxvbmcgdGhlIGdpdmVuIFNBUCBheGlzLgogICAgICovCiAgICBzdGF0aWMgY2hlY2tCb3VuZHMoYmksIGJqLCBheGlzSW5kZXgpIHsKICAgICAgbGV0IGJpUG9zOwogICAgICBsZXQgYmpQb3M7CgogICAgICBpZiAoYXhpc0luZGV4ID09PSAwKSB7CiAgICAgICAgYmlQb3MgPSBiaS5wb3NpdGlvbi54OwogICAgICAgIGJqUG9zID0gYmoucG9zaXRpb24ueDsKICAgICAgfSBlbHNlIGlmIChheGlzSW5kZXggPT09IDEpIHsKICAgICAgICBiaVBvcyA9IGJpLnBvc2l0aW9uLnk7CiAgICAgICAgYmpQb3MgPSBiai5wb3NpdGlvbi55OwogICAgICB9IGVsc2UgaWYgKGF4aXNJbmRleCA9PT0gMikgewogICAgICAgIGJpUG9zID0gYmkucG9zaXRpb24uejsKICAgICAgICBialBvcyA9IGJqLnBvc2l0aW9uLno7CiAgICAgIH0KCiAgICAgIGNvbnN0IHJpID0gYmkuYm91bmRpbmdSYWRpdXMsCiAgICAgICAgICAgIHJqID0gYmouYm91bmRpbmdSYWRpdXMsCiAgICAgICAgICAgIGJvdW5kQTIgPSBiaVBvcyArIHJpLAogICAgICAgICAgICBib3VuZEIxID0gYmpQb3MgLSByajsKICAgICAgcmV0dXJuIGJvdW5kQjEgPCBib3VuZEEyOwogICAgfSAvLyBOb3RlOiB0aGVzZSBhcmUgaWRlbnRpY2FsLCBzYXZlIGZvciB4L3kveiBsb3dlcmJvdW5kCgogICAgLyoqCiAgICAgKiBpbnNlcnRpb25Tb3J0WAogICAgICovCgoKICAgIHN0YXRpYyBpbnNlcnRpb25Tb3J0WChhKSB7CiAgICAgIGZvciAobGV0IGkgPSAxLCBsID0gYS5sZW5ndGg7IGkgPCBsOyBpKyspIHsKICAgICAgICBjb25zdCB2ID0gYVtpXTsKICAgICAgICBsZXQgajsKCiAgICAgICAgZm9yIChqID0gaSAtIDE7IGogPj0gMDsgai0tKSB7CiAgICAgICAgICBpZiAoYVtqXS5hYWJiLmxvd2VyQm91bmQueCA8PSB2LmFhYmIubG93ZXJCb3VuZC54KSB7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgfQoKICAgICAgICAgIGFbaiArIDFdID0gYVtqXTsKICAgICAgICB9CgogICAgICAgIGFbaiArIDFdID0gdjsKICAgICAgfQoKICAgICAgcmV0dXJuIGE7CiAgICB9CiAgICAvKioKICAgICAqIGluc2VydGlvblNvcnRZCiAgICAgKi8KCgogICAgc3RhdGljIGluc2VydGlvblNvcnRZKGEpIHsKICAgICAgZm9yIChsZXQgaSA9IDEsIGwgPSBhLmxlbmd0aDsgaSA8IGw7IGkrKykgewogICAgICAgIGNvbnN0IHYgPSBhW2ldOwogICAgICAgIGxldCBqOwoKICAgICAgICBmb3IgKGogPSBpIC0gMTsgaiA+PSAwOyBqLS0pIHsKICAgICAgICAgIGlmIChhW2pdLmFhYmIubG93ZXJCb3VuZC55IDw9IHYuYWFiYi5sb3dlckJvdW5kLnkpIHsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICB9CgogICAgICAgICAgYVtqICsgMV0gPSBhW2pdOwogICAgICAgIH0KCiAgICAgICAgYVtqICsgMV0gPSB2OwogICAgICB9CgogICAgICByZXR1cm4gYTsKICAgIH0KICAgIC8qKgogICAgICogaW5zZXJ0aW9uU29ydFoKICAgICAqLwoKCiAgICBzdGF0aWMgaW5zZXJ0aW9uU29ydFooYSkgewogICAgICBmb3IgKGxldCBpID0gMSwgbCA9IGEubGVuZ3RoOyBpIDwgbDsgaSsrKSB7CiAgICAgICAgY29uc3QgdiA9IGFbaV07CiAgICAgICAgbGV0IGo7CgogICAgICAgIGZvciAoaiA9IGkgLSAxOyBqID49IDA7IGotLSkgewogICAgICAgICAgaWYgKGFbal0uYWFiYi5sb3dlckJvdW5kLnogPD0gdi5hYWJiLmxvd2VyQm91bmQueikgewogICAgICAgICAgICBicmVhazsKICAgICAgICAgIH0KCiAgICAgICAgICBhW2ogKyAxXSA9IGFbal07CiAgICAgICAgfQoKICAgICAgICBhW2ogKyAxXSA9IHY7CiAgICAgIH0KCiAgICAgIHJldHVybiBhOwogICAgfQoKICAgIGNvbnN0cnVjdG9yKHdvcmxkKSB7CiAgICAgIHN1cGVyKCk7CiAgICAgIHRoaXMuYXhpc0xpc3QgPSBbXTsKICAgICAgdGhpcy53b3JsZCA9IG51bGw7CiAgICAgIHRoaXMuYXhpc0luZGV4ID0gMDsKICAgICAgY29uc3QgYXhpc0xpc3QgPSB0aGlzLmF4aXNMaXN0OwoKICAgICAgdGhpcy5fYWRkQm9keUhhbmRsZXIgPSBldmVudCA9PiB7CiAgICAgICAgYXhpc0xpc3QucHVzaChldmVudC5ib2R5KTsKICAgICAgfTsKCiAgICAgIHRoaXMuX3JlbW92ZUJvZHlIYW5kbGVyID0gZXZlbnQgPT4gewogICAgICAgIGNvbnN0IGlkeCA9IGF4aXNMaXN0LmluZGV4T2YoZXZlbnQuYm9keSk7CgogICAgICAgIGlmIChpZHggIT09IC0xKSB7CiAgICAgICAgICBheGlzTGlzdC5zcGxpY2UoaWR4LCAxKTsKICAgICAgICB9CiAgICAgIH07CgogICAgICBpZiAod29ybGQpIHsKICAgICAgICB0aGlzLnNldFdvcmxkKHdvcmxkKTsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBDaGFuZ2UgdGhlIHdvcmxkCiAgICAgKi8KCgogICAgc2V0V29ybGQod29ybGQpIHsKICAgICAgLy8gQ2xlYXIgdGhlIG9sZCBheGlzIGFycmF5CiAgICAgIHRoaXMuYXhpc0xpc3QubGVuZ3RoID0gMDsgLy8gQWRkIGFsbCBib2RpZXMgZnJvbSB0aGUgbmV3IHdvcmxkCgogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHdvcmxkLmJvZGllcy5sZW5ndGg7IGkrKykgewogICAgICAgIHRoaXMuYXhpc0xpc3QucHVzaCh3b3JsZC5ib2RpZXNbaV0pOwogICAgICB9IC8vIFJlbW92ZSBvbGQgaGFuZGxlcnMsIGlmIGFueQoKCiAgICAgIHdvcmxkLnJlbW92ZUV2ZW50TGlzdGVuZXIoJ2FkZEJvZHknLCB0aGlzLl9hZGRCb2R5SGFuZGxlcik7CiAgICAgIHdvcmxkLnJlbW92ZUV2ZW50TGlzdGVuZXIoJ3JlbW92ZUJvZHknLCB0aGlzLl9yZW1vdmVCb2R5SGFuZGxlcik7IC8vIEFkZCBoYW5kbGVycyB0byB1cGRhdGUgdGhlIGxpc3Qgb2YgYm9kaWVzLgoKICAgICAgd29ybGQuYWRkRXZlbnRMaXN0ZW5lcignYWRkQm9keScsIHRoaXMuX2FkZEJvZHlIYW5kbGVyKTsKICAgICAgd29ybGQuYWRkRXZlbnRMaXN0ZW5lcigncmVtb3ZlQm9keScsIHRoaXMuX3JlbW92ZUJvZHlIYW5kbGVyKTsKICAgICAgdGhpcy53b3JsZCA9IHdvcmxkOwogICAgICB0aGlzLmRpcnR5ID0gdHJ1ZTsKICAgIH0KICAgIC8qKgogICAgICogQ29sbGVjdCBhbGwgY29sbGlzaW9uIHBhaXJzCiAgICAgKi8KCgogICAgY29sbGlzaW9uUGFpcnMod29ybGQsIHAxLCBwMikgewogICAgICBjb25zdCBib2RpZXMgPSB0aGlzLmF4aXNMaXN0OwogICAgICBjb25zdCBOID0gYm9kaWVzLmxlbmd0aDsKICAgICAgY29uc3QgYXhpc0luZGV4ID0gdGhpcy5heGlzSW5kZXg7CiAgICAgIGxldCBpOwogICAgICBsZXQgajsKCiAgICAgIGlmICh0aGlzLmRpcnR5KSB7CiAgICAgICAgdGhpcy5zb3J0TGlzdCgpOwogICAgICAgIHRoaXMuZGlydHkgPSBmYWxzZTsKICAgICAgfSAvLyBMb29rIHRocm91Z2ggdGhlIGxpc3QKCgogICAgICBmb3IgKGkgPSAwOyBpICE9PSBOOyBpKyspIHsKICAgICAgICBjb25zdCBiaSA9IGJvZGllc1tpXTsKCiAgICAgICAgZm9yIChqID0gaSArIDE7IGogPCBOOyBqKyspIHsKICAgICAgICAgIGNvbnN0IGJqID0gYm9kaWVzW2pdOwoKICAgICAgICAgIGlmICghdGhpcy5uZWVkQnJvYWRwaGFzZUNvbGxpc2lvbihiaSwgYmopKSB7CiAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgfQoKICAgICAgICAgIGlmICghU0FQQnJvYWRwaGFzZS5jaGVja0JvdW5kcyhiaSwgYmosIGF4aXNJbmRleCkpIHsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICB9CgogICAgICAgICAgdGhpcy5pbnRlcnNlY3Rpb25UZXN0KGJpLCBiaiwgcDEsIHAyKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KCiAgICBzb3J0TGlzdCgpIHsKICAgICAgY29uc3QgYXhpc0xpc3QgPSB0aGlzLmF4aXNMaXN0OwogICAgICBjb25zdCBheGlzSW5kZXggPSB0aGlzLmF4aXNJbmRleDsKICAgICAgY29uc3QgTiA9IGF4aXNMaXN0Lmxlbmd0aDsgLy8gVXBkYXRlIEFBQkJzCgogICAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gTjsgaSsrKSB7CiAgICAgICAgY29uc3QgYmkgPSBheGlzTGlzdFtpXTsKCiAgICAgICAgaWYgKGJpLmFhYmJOZWVkc1VwZGF0ZSkgewogICAgICAgICAgYmkudXBkYXRlQUFCQigpOwogICAgICAgIH0KICAgICAgfSAvLyBTb3J0IHRoZSBsaXN0CgoKICAgICAgaWYgKGF4aXNJbmRleCA9PT0gMCkgewogICAgICAgIFNBUEJyb2FkcGhhc2UuaW5zZXJ0aW9uU29ydFgoYXhpc0xpc3QpOwogICAgICB9IGVsc2UgaWYgKGF4aXNJbmRleCA9PT0gMSkgewogICAgICAgIFNBUEJyb2FkcGhhc2UuaW5zZXJ0aW9uU29ydFkoYXhpc0xpc3QpOwogICAgICB9IGVsc2UgaWYgKGF4aXNJbmRleCA9PT0gMikgewogICAgICAgIFNBUEJyb2FkcGhhc2UuaW5zZXJ0aW9uU29ydFooYXhpc0xpc3QpOwogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIENvbXB1dGVzIHRoZSB2YXJpYW5jZSBvZiB0aGUgYm9keSBwb3NpdGlvbnMgYW5kIGVzdGltYXRlcyB0aGUgYmVzdCBheGlzIHRvIHVzZS4KICAgICAqIFdpbGwgYXV0b21hdGljYWxseSBzZXQgcHJvcGVydHkgYGF4aXNJbmRleGAuCiAgICAgKi8KCgogICAgYXV0b0RldGVjdEF4aXMoKSB7CiAgICAgIGxldCBzdW1YID0gMDsKICAgICAgbGV0IHN1bVgyID0gMDsKICAgICAgbGV0IHN1bVkgPSAwOwogICAgICBsZXQgc3VtWTIgPSAwOwogICAgICBsZXQgc3VtWiA9IDA7CiAgICAgIGxldCBzdW1aMiA9IDA7CiAgICAgIGNvbnN0IGJvZGllcyA9IHRoaXMuYXhpc0xpc3Q7CiAgICAgIGNvbnN0IE4gPSBib2RpZXMubGVuZ3RoOwogICAgICBjb25zdCBpbnZOID0gMSAvIE47CgogICAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gTjsgaSsrKSB7CiAgICAgICAgY29uc3QgYiA9IGJvZGllc1tpXTsKICAgICAgICBjb25zdCBjZW50ZXJYID0gYi5wb3NpdGlvbi54OwogICAgICAgIHN1bVggKz0gY2VudGVyWDsKICAgICAgICBzdW1YMiArPSBjZW50ZXJYICogY2VudGVyWDsKICAgICAgICBjb25zdCBjZW50ZXJZID0gYi5wb3NpdGlvbi55OwogICAgICAgIHN1bVkgKz0gY2VudGVyWTsKICAgICAgICBzdW1ZMiArPSBjZW50ZXJZICogY2VudGVyWTsKICAgICAgICBjb25zdCBjZW50ZXJaID0gYi5wb3NpdGlvbi56OwogICAgICAgIHN1bVogKz0gY2VudGVyWjsKICAgICAgICBzdW1aMiArPSBjZW50ZXJaICogY2VudGVyWjsKICAgICAgfQoKICAgICAgY29uc3QgdmFyaWFuY2VYID0gc3VtWDIgLSBzdW1YICogc3VtWCAqIGludk47CiAgICAgIGNvbnN0IHZhcmlhbmNlWSA9IHN1bVkyIC0gc3VtWSAqIHN1bVkgKiBpbnZOOwogICAgICBjb25zdCB2YXJpYW5jZVogPSBzdW1aMiAtIHN1bVogKiBzdW1aICogaW52TjsKCiAgICAgIGlmICh2YXJpYW5jZVggPiB2YXJpYW5jZVkpIHsKICAgICAgICBpZiAodmFyaWFuY2VYID4gdmFyaWFuY2VaKSB7CiAgICAgICAgICB0aGlzLmF4aXNJbmRleCA9IDA7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHRoaXMuYXhpc0luZGV4ID0gMjsKICAgICAgICB9CiAgICAgIH0gZWxzZSBpZiAodmFyaWFuY2VZID4gdmFyaWFuY2VaKSB7CiAgICAgICAgdGhpcy5heGlzSW5kZXggPSAxOwogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMuYXhpc0luZGV4ID0gMjsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBSZXR1cm5zIGFsbCB0aGUgYm9kaWVzIHdpdGhpbiBhbiBBQUJCLgogICAgICogQHBhcmFtIHJlc3VsdCBBbiBhcnJheSB0byBzdG9yZSByZXN1bHRpbmcgYm9kaWVzIGluLgogICAgICovCgoKICAgIGFhYmJRdWVyeSh3b3JsZCwgYWFiYiwgcmVzdWx0KSB7CiAgICAgIGlmIChyZXN1bHQgPT09IHZvaWQgMCkgewogICAgICAgIHJlc3VsdCA9IFtdOwogICAgICB9CgogICAgICBpZiAodGhpcy5kaXJ0eSkgewogICAgICAgIHRoaXMuc29ydExpc3QoKTsKICAgICAgICB0aGlzLmRpcnR5ID0gZmFsc2U7CiAgICAgIH0KCiAgICAgIGNvbnN0IGF4aXNJbmRleCA9IHRoaXMuYXhpc0luZGV4OwogICAgICBsZXQgYXhpcyA9ICd4JzsKCiAgICAgIGlmIChheGlzSW5kZXggPT09IDEpIHsKICAgICAgICBheGlzID0gJ3knOwogICAgICB9CgogICAgICBpZiAoYXhpc0luZGV4ID09PSAyKSB7CiAgICAgICAgYXhpcyA9ICd6JzsKICAgICAgfQoKICAgICAgY29uc3QgYXhpc0xpc3QgPSB0aGlzLmF4aXNMaXN0OwogICAgICBhYWJiLmxvd2VyQm91bmRbYXhpc107CiAgICAgIGFhYmIudXBwZXJCb3VuZFtheGlzXTsKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgYXhpc0xpc3QubGVuZ3RoOyBpKyspIHsKICAgICAgICBjb25zdCBiID0gYXhpc0xpc3RbaV07CgogICAgICAgIGlmIChiLmFhYmJOZWVkc1VwZGF0ZSkgewogICAgICAgICAgYi51cGRhdGVBQUJCKCk7CiAgICAgICAgfQoKICAgICAgICBpZiAoYi5hYWJiLm92ZXJsYXBzKGFhYmIpKSB7CiAgICAgICAgICByZXN1bHQucHVzaChiKTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIHJldHVybiByZXN1bHQ7CiAgICB9CgogIH0KCiAgY2xhc3MgVXRpbHMgewogICAgLyoqCiAgICAgKiBFeHRlbmQgYW4gb3B0aW9ucyBvYmplY3Qgd2l0aCBkZWZhdWx0IHZhbHVlcy4KICAgICAqIEBwYXJhbSBvcHRpb25zIFRoZSBvcHRpb25zIG9iamVjdC4gTWF5IGJlIGZhbHN5OiBpbiB0aGlzIGNhc2UsIGEgbmV3IG9iamVjdCBpcyBjcmVhdGVkIGFuZCByZXR1cm5lZC4KICAgICAqIEBwYXJhbSBkZWZhdWx0cyBBbiBvYmplY3QgY29udGFpbmluZyBkZWZhdWx0IHZhbHVlcy4KICAgICAqIEByZXR1cm4gVGhlIG1vZGlmaWVkIG9wdGlvbnMgb2JqZWN0LgogICAgICovCiAgICBzdGF0aWMgZGVmYXVsdHMob3B0aW9ucywgZGVmYXVsdHMpIHsKICAgICAgaWYgKG9wdGlvbnMgPT09IHZvaWQgMCkgewogICAgICAgIG9wdGlvbnMgPSB7fTsKICAgICAgfQoKICAgICAgZm9yIChsZXQga2V5IGluIGRlZmF1bHRzKSB7CiAgICAgICAgaWYgKCEoa2V5IGluIG9wdGlvbnMpKSB7CiAgICAgICAgICBvcHRpb25zW2tleV0gPSBkZWZhdWx0c1trZXldOwogICAgICAgIH0KICAgICAgfQoKICAgICAgcmV0dXJuIG9wdGlvbnM7CiAgICB9CgogIH0KCiAgLyoqCiAgICogQ29uc3RyYWludCBiYXNlIGNsYXNzCiAgICovCiAgY2xhc3MgQ29uc3RyYWludCB7CiAgICAvKioKICAgICAqIEVxdWF0aW9ucyB0byBiZSBzb2x2ZWQgaW4gdGhpcyBjb25zdHJhaW50LgogICAgICovCgogICAgLyoqCiAgICAgKiBCb2R5IEEuCiAgICAgKi8KCiAgICAvKioKICAgICAqIEJvZHkgQi4KICAgICAqLwoKICAgIC8qKgogICAgICogU2V0IHRvIGZhbHNlIGlmIHlvdSBkb24ndCB3YW50IHRoZSBib2RpZXMgdG8gY29sbGlkZSB3aGVuIHRoZXkgYXJlIGNvbm5lY3RlZC4KICAgICAqLwogICAgY29uc3RydWN0b3IoYm9keUEsIGJvZHlCLCBvcHRpb25zKSB7CiAgICAgIGlmIChvcHRpb25zID09PSB2b2lkIDApIHsKICAgICAgICBvcHRpb25zID0ge307CiAgICAgIH0KCiAgICAgIG9wdGlvbnMgPSBVdGlscy5kZWZhdWx0cyhvcHRpb25zLCB7CiAgICAgICAgY29sbGlkZUNvbm5lY3RlZDogdHJ1ZSwKICAgICAgICB3YWtlVXBCb2RpZXM6IHRydWUKICAgICAgfSk7CiAgICAgIHRoaXMuZXF1YXRpb25zID0gW107CiAgICAgIHRoaXMuYm9keUEgPSBib2R5QTsKICAgICAgdGhpcy5ib2R5QiA9IGJvZHlCOwogICAgICB0aGlzLmlkID0gQ29uc3RyYWludC5pZENvdW50ZXIrKzsKICAgICAgdGhpcy5jb2xsaWRlQ29ubmVjdGVkID0gb3B0aW9ucy5jb2xsaWRlQ29ubmVjdGVkOwoKICAgICAgaWYgKG9wdGlvbnMud2FrZVVwQm9kaWVzKSB7CiAgICAgICAgaWYgKGJvZHlBKSB7CiAgICAgICAgICBib2R5QS53YWtlVXAoKTsKICAgICAgICB9CgogICAgICAgIGlmIChib2R5QikgewogICAgICAgICAgYm9keUIud2FrZVVwKCk7CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIFVwZGF0ZSBhbGwgdGhlIGVxdWF0aW9ucyB3aXRoIGRhdGEuCiAgICAgKi8KCgogICAgdXBkYXRlKCkgewogICAgICB0aHJvdyBuZXcgRXJyb3IoJ21ldGhvZCB1cGRhdGUoKSBub3QgaW1wbG1lbWVudGVkIGluIHRoaXMgQ29uc3RyYWludCBzdWJjbGFzcyEnKTsKICAgIH0KICAgIC8qKgogICAgICogRW5hYmxlcyBhbGwgZXF1YXRpb25zIGluIHRoZSBjb25zdHJhaW50LgogICAgICovCgoKICAgIGVuYWJsZSgpIHsKICAgICAgY29uc3QgZXFzID0gdGhpcy5lcXVhdGlvbnM7CgogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGVxcy5sZW5ndGg7IGkrKykgewogICAgICAgIGVxc1tpXS5lbmFibGVkID0gdHJ1ZTsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBEaXNhYmxlcyBhbGwgZXF1YXRpb25zIGluIHRoZSBjb25zdHJhaW50LgogICAgICovCgoKICAgIGRpc2FibGUoKSB7CiAgICAgIGNvbnN0IGVxcyA9IHRoaXMuZXF1YXRpb25zOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBlcXMubGVuZ3RoOyBpKyspIHsKICAgICAgICBlcXNbaV0uZW5hYmxlZCA9IGZhbHNlOwogICAgICB9CiAgICB9CgogIH0KICBDb25zdHJhaW50LmlkQ291bnRlciA9IDA7CgogIC8qKgogICAqIEFuIGVsZW1lbnQgY29udGFpbmluZyA2IGVudHJpZXMsIDMgc3BhdGlhbCBhbmQgMyByb3RhdGlvbmFsIGRlZ3JlZXMgb2YgZnJlZWRvbS4KICAgKi8KCiAgY2xhc3MgSmFjb2JpYW5FbGVtZW50IHsKICAgIC8qKgogICAgICogc3BhdGlhbAogICAgICovCgogICAgLyoqCiAgICAgKiByb3RhdGlvbmFsCiAgICAgKi8KICAgIGNvbnN0cnVjdG9yKCkgewogICAgICB0aGlzLnNwYXRpYWwgPSBuZXcgVmVjMygpOwogICAgICB0aGlzLnJvdGF0aW9uYWwgPSBuZXcgVmVjMygpOwogICAgfQogICAgLyoqCiAgICAgKiBNdWx0aXBseSB3aXRoIG90aGVyIEphY29iaWFuRWxlbWVudAogICAgICovCgoKICAgIG11bHRpcGx5RWxlbWVudChlbGVtZW50KSB7CiAgICAgIHJldHVybiBlbGVtZW50LnNwYXRpYWwuZG90KHRoaXMuc3BhdGlhbCkgKyBlbGVtZW50LnJvdGF0aW9uYWwuZG90KHRoaXMucm90YXRpb25hbCk7CiAgICB9CiAgICAvKioKICAgICAqIE11bHRpcGx5IHdpdGggdHdvIHZlY3RvcnMKICAgICAqLwoKCiAgICBtdWx0aXBseVZlY3RvcnMoc3BhdGlhbCwgcm90YXRpb25hbCkgewogICAgICByZXR1cm4gc3BhdGlhbC5kb3QodGhpcy5zcGF0aWFsKSArIHJvdGF0aW9uYWwuZG90KHRoaXMucm90YXRpb25hbCk7CiAgICB9CgogIH0KCiAgLyoqCiAgICogRXF1YXRpb24gYmFzZSBjbGFzcy4KICAgKgogICAqIGBhYCwgYGJgIGFuZCBgZXBzYCBhcmUge0BsaW5rIGh0dHBzOi8vd3d3OC5jcy51bXUuc2Uva3Vyc2VyLzVEVjA1OC9WVDE1L2xlY3R1cmVzL1NQT09LbGFibm90ZXMucGRmIFNQT09LfSBwYXJhbWV0ZXJzIHRoYXQgZGVmYXVsdCB0byBgMC4wYC4gU2VlIHtAbGluayBodHRwczovL2dpdGh1Yi5jb20vc2NodGVwcGUvY2Fubm9uLmpzL2lzc3Vlcy8yMzgjaXNzdWVjb21tZW50LTE0NzE3MjMyNyB0aGlzIGV4Y2hhbmdlfSBmb3IgbW9yZSBkZXRhaWxzIG9uIENhbm5vbidzIHBoeXNpY3MgaW1wbGVtZW50YXRpb24uCiAgICovCiAgY2xhc3MgRXF1YXRpb24gewogICAgLyoqCiAgICAgKiBNaW5pbXVtIChyZWFkOiBuZWdhdGl2ZSBtYXgpIGZvcmNlIHRvIGJlIGFwcGxpZWQgYnkgdGhlIGNvbnN0cmFpbnQuCiAgICAgKi8KCiAgICAvKioKICAgICAqIE1heGltdW0gKHJlYWQ6IHBvc2l0aXZlIG1heCkgZm9yY2UgdG8gYmUgYXBwbGllZCBieSB0aGUgY29uc3RyYWludC4KICAgICAqLwoKICAgIC8qKgogICAgICogU1BPT0sgcGFyYW1ldGVyCiAgICAgKi8KCiAgICAvKioKICAgICAqIFNQT09LIHBhcmFtZXRlcgogICAgICovCgogICAgLyoqCiAgICAgKiBTUE9PSyBwYXJhbWV0ZXIKICAgICAqLwoKICAgIC8qKgogICAgICogQSBudW1iZXIsIHByb3BvcnRpb25hbCB0byB0aGUgZm9yY2UgYWRkZWQgdG8gdGhlIGJvZGllcy4KICAgICAqLwogICAgY29uc3RydWN0b3IoYmksIGJqLCBtaW5Gb3JjZSwgbWF4Rm9yY2UpIHsKICAgICAgaWYgKG1pbkZvcmNlID09PSB2b2lkIDApIHsKICAgICAgICBtaW5Gb3JjZSA9IC0xZTY7CiAgICAgIH0KCiAgICAgIGlmIChtYXhGb3JjZSA9PT0gdm9pZCAwKSB7CiAgICAgICAgbWF4Rm9yY2UgPSAxZTY7CiAgICAgIH0KCiAgICAgIHRoaXMuaWQgPSBFcXVhdGlvbi5pZENvdW50ZXIrKzsKICAgICAgdGhpcy5taW5Gb3JjZSA9IG1pbkZvcmNlOwogICAgICB0aGlzLm1heEZvcmNlID0gbWF4Rm9yY2U7CiAgICAgIHRoaXMuYmkgPSBiaTsKICAgICAgdGhpcy5iaiA9IGJqOwogICAgICB0aGlzLmEgPSAwLjA7IC8vIFNQT09LIHBhcmFtZXRlcgoKICAgICAgdGhpcy5iID0gMC4wOyAvLyBTUE9PSyBwYXJhbWV0ZXIKCiAgICAgIHRoaXMuZXBzID0gMC4wOyAvLyBTUE9PSyBwYXJhbWV0ZXIKCiAgICAgIHRoaXMuamFjb2JpYW5FbGVtZW50QSA9IG5ldyBKYWNvYmlhbkVsZW1lbnQoKTsKICAgICAgdGhpcy5qYWNvYmlhbkVsZW1lbnRCID0gbmV3IEphY29iaWFuRWxlbWVudCgpOwogICAgICB0aGlzLmVuYWJsZWQgPSB0cnVlOwogICAgICB0aGlzLm11bHRpcGxpZXIgPSAwOwogICAgICB0aGlzLnNldFNwb29rUGFyYW1zKDFlNywgNCwgMSAvIDYwKTsgLy8gU2V0IHR5cGljYWwgc3Bvb2sgcGFyYW1zCiAgICB9CiAgICAvKioKICAgICAqIFJlY2FsY3VsYXRlcyBhLCBiLCBhbmQgZXBzLgogICAgICoKICAgICAqIFRoZSBFcXVhdGlvbiBjb25zdHJ1Y3RvciBzZXRzIHR5cGljYWwgU1BPT0sgcGFyYW1ldGVycyBhcyBzdWNoOgogICAgICogKiBgc3RpZmZuZXNzYCA9IDFlNwogICAgICogKiBgcmVsYXhhdGlvbmAgPSA0CiAgICAgKiAqIGB0aW1lU3RlcGA9IDEgLyA2MCwgX25vdGUgdGhlIGhhcmRjb2RlZCByZWZyZXNoIHJhdGUuXwogICAgICovCgoKICAgIHNldFNwb29rUGFyYW1zKHN0aWZmbmVzcywgcmVsYXhhdGlvbiwgdGltZVN0ZXApIHsKICAgICAgY29uc3QgZCA9IHJlbGF4YXRpb247CiAgICAgIGNvbnN0IGsgPSBzdGlmZm5lc3M7CiAgICAgIGNvbnN0IGggPSB0aW1lU3RlcDsKICAgICAgdGhpcy5hID0gNC4wIC8gKGggKiAoMSArIDQgKiBkKSk7CiAgICAgIHRoaXMuYiA9IDQuMCAqIGQgLyAoMSArIDQgKiBkKTsKICAgICAgdGhpcy5lcHMgPSA0LjAgLyAoaCAqIGggKiBrICogKDEgKyA0ICogZCkpOwogICAgfQogICAgLyoqCiAgICAgKiBDb21wdXRlcyB0aGUgcmlnaHQgaGFuZCBzaWRlIG9mIHRoZSBTUE9PSyBlcXVhdGlvbgogICAgICovCgoKICAgIGNvbXB1dGVCKGEsIGIsIGgpIHsKICAgICAgY29uc3QgR1cgPSB0aGlzLmNvbXB1dGVHVygpOwogICAgICBjb25zdCBHcSA9IHRoaXMuY29tcHV0ZUdxKCk7CiAgICAgIGNvbnN0IEdpTWYgPSB0aGlzLmNvbXB1dGVHaU1mKCk7CiAgICAgIHJldHVybiAtR3EgKiBhIC0gR1cgKiBiIC0gR2lNZiAqIGg7CiAgICB9CiAgICAvKioKICAgICAqIENvbXB1dGVzIEcqcSwgd2hlcmUgcSBhcmUgdGhlIGdlbmVyYWxpemVkIGJvZHkgY29vcmRpbmF0ZXMKICAgICAqLwoKCiAgICBjb21wdXRlR3EoKSB7CiAgICAgIGNvbnN0IEdBID0gdGhpcy5qYWNvYmlhbkVsZW1lbnRBOwogICAgICBjb25zdCBHQiA9IHRoaXMuamFjb2JpYW5FbGVtZW50QjsKICAgICAgY29uc3QgYmkgPSB0aGlzLmJpOwogICAgICBjb25zdCBiaiA9IHRoaXMuYmo7CiAgICAgIGNvbnN0IHhpID0gYmkucG9zaXRpb247CiAgICAgIGNvbnN0IHhqID0gYmoucG9zaXRpb247CiAgICAgIHJldHVybiBHQS5zcGF0aWFsLmRvdCh4aSkgKyBHQi5zcGF0aWFsLmRvdCh4aik7CiAgICB9CiAgICAvKioKICAgICAqIENvbXB1dGVzIEcqVywgd2hlcmUgVyBhcmUgdGhlIGJvZHkgdmVsb2NpdGllcwogICAgICovCgoKICAgIGNvbXB1dGVHVygpIHsKICAgICAgY29uc3QgR0EgPSB0aGlzLmphY29iaWFuRWxlbWVudEE7CiAgICAgIGNvbnN0IEdCID0gdGhpcy5qYWNvYmlhbkVsZW1lbnRCOwogICAgICBjb25zdCBiaSA9IHRoaXMuYmk7CiAgICAgIGNvbnN0IGJqID0gdGhpcy5iajsKICAgICAgY29uc3QgdmkgPSBiaS52ZWxvY2l0eTsKICAgICAgY29uc3QgdmogPSBiai52ZWxvY2l0eTsKICAgICAgY29uc3Qgd2kgPSBiaS5hbmd1bGFyVmVsb2NpdHk7CiAgICAgIGNvbnN0IHdqID0gYmouYW5ndWxhclZlbG9jaXR5OwogICAgICByZXR1cm4gR0EubXVsdGlwbHlWZWN0b3JzKHZpLCB3aSkgKyBHQi5tdWx0aXBseVZlY3RvcnModmosIHdqKTsKICAgIH0KICAgIC8qKgogICAgICogQ29tcHV0ZXMgRypXbGFtYmRhLCB3aGVyZSBXIGFyZSB0aGUgYm9keSB2ZWxvY2l0aWVzCiAgICAgKi8KCgogICAgY29tcHV0ZUdXbGFtYmRhKCkgewogICAgICBjb25zdCBHQSA9IHRoaXMuamFjb2JpYW5FbGVtZW50QTsKICAgICAgY29uc3QgR0IgPSB0aGlzLmphY29iaWFuRWxlbWVudEI7CiAgICAgIGNvbnN0IGJpID0gdGhpcy5iaTsKICAgICAgY29uc3QgYmogPSB0aGlzLmJqOwogICAgICBjb25zdCB2aSA9IGJpLnZsYW1iZGE7CiAgICAgIGNvbnN0IHZqID0gYmoudmxhbWJkYTsKICAgICAgY29uc3Qgd2kgPSBiaS53bGFtYmRhOwogICAgICBjb25zdCB3aiA9IGJqLndsYW1iZGE7CiAgICAgIHJldHVybiBHQS5tdWx0aXBseVZlY3RvcnModmksIHdpKSArIEdCLm11bHRpcGx5VmVjdG9ycyh2aiwgd2opOwogICAgfQogICAgLyoqCiAgICAgKiBDb21wdXRlcyBHKmludihNKSpmLCB3aGVyZSBNIGlzIHRoZSBtYXNzIG1hdHJpeCB3aXRoIGRpYWdvbmFsIGJsb2NrcyBmb3IgZWFjaCBib2R5LCBhbmQgZiBhcmUgdGhlIGZvcmNlcyBvbiB0aGUgYm9kaWVzLgogICAgICovCgoKICAgIGNvbXB1dGVHaU1mKCkgewogICAgICBjb25zdCBHQSA9IHRoaXMuamFjb2JpYW5FbGVtZW50QTsKICAgICAgY29uc3QgR0IgPSB0aGlzLmphY29iaWFuRWxlbWVudEI7CiAgICAgIGNvbnN0IGJpID0gdGhpcy5iaTsKICAgICAgY29uc3QgYmogPSB0aGlzLmJqOwogICAgICBjb25zdCBmaSA9IGJpLmZvcmNlOwogICAgICBjb25zdCB0aSA9IGJpLnRvcnF1ZTsKICAgICAgY29uc3QgZmogPSBiai5mb3JjZTsKICAgICAgY29uc3QgdGogPSBiai50b3JxdWU7CiAgICAgIGNvbnN0IGludk1hc3NpID0gYmkuaW52TWFzc1NvbHZlOwogICAgICBjb25zdCBpbnZNYXNzaiA9IGJqLmludk1hc3NTb2x2ZTsKICAgICAgZmkuc2NhbGUoaW52TWFzc2ksIGlNZmkpOwogICAgICBmai5zY2FsZShpbnZNYXNzaiwgaU1maik7CiAgICAgIGJpLmludkluZXJ0aWFXb3JsZFNvbHZlLnZtdWx0KHRpLCBpbnZJaV92bXVsdF90YXVpKTsKICAgICAgYmouaW52SW5lcnRpYVdvcmxkU29sdmUudm11bHQodGosIGludklqX3ZtdWx0X3RhdWopOwogICAgICByZXR1cm4gR0EubXVsdGlwbHlWZWN0b3JzKGlNZmksIGludklpX3ZtdWx0X3RhdWkpICsgR0IubXVsdGlwbHlWZWN0b3JzKGlNZmosIGludklqX3ZtdWx0X3RhdWopOwogICAgfQogICAgLyoqCiAgICAgKiBDb21wdXRlcyBHKmludihNKSpHJwogICAgICovCgoKICAgIGNvbXB1dGVHaU1HdCgpIHsKICAgICAgY29uc3QgR0EgPSB0aGlzLmphY29iaWFuRWxlbWVudEE7CiAgICAgIGNvbnN0IEdCID0gdGhpcy5qYWNvYmlhbkVsZW1lbnRCOwogICAgICBjb25zdCBiaSA9IHRoaXMuYmk7CiAgICAgIGNvbnN0IGJqID0gdGhpcy5iajsKICAgICAgY29uc3QgaW52TWFzc2kgPSBiaS5pbnZNYXNzU29sdmU7CiAgICAgIGNvbnN0IGludk1hc3NqID0gYmouaW52TWFzc1NvbHZlOwogICAgICBjb25zdCBpbnZJaSA9IGJpLmludkluZXJ0aWFXb3JsZFNvbHZlOwogICAgICBjb25zdCBpbnZJaiA9IGJqLmludkluZXJ0aWFXb3JsZFNvbHZlOwogICAgICBsZXQgcmVzdWx0ID0gaW52TWFzc2kgKyBpbnZNYXNzajsKICAgICAgaW52SWkudm11bHQoR0Eucm90YXRpb25hbCwgdG1wKTsKICAgICAgcmVzdWx0ICs9IHRtcC5kb3QoR0Eucm90YXRpb25hbCk7CiAgICAgIGludklqLnZtdWx0KEdCLnJvdGF0aW9uYWwsIHRtcCk7CiAgICAgIHJlc3VsdCArPSB0bXAuZG90KEdCLnJvdGF0aW9uYWwpOwogICAgICByZXR1cm4gcmVzdWx0OwogICAgfQogICAgLyoqCiAgICAgKiBBZGQgY29uc3RyYWludCB2ZWxvY2l0eSB0byB0aGUgYm9kaWVzLgogICAgICovCgoKICAgIGFkZFRvV2xhbWJkYShkZWx0YWxhbWJkYSkgewogICAgICBjb25zdCBHQSA9IHRoaXMuamFjb2JpYW5FbGVtZW50QTsKICAgICAgY29uc3QgR0IgPSB0aGlzLmphY29iaWFuRWxlbWVudEI7CiAgICAgIGNvbnN0IGJpID0gdGhpcy5iaTsKICAgICAgY29uc3QgYmogPSB0aGlzLmJqOwogICAgICBjb25zdCB0ZW1wID0gYWRkVG9XbGFtYmRhX3RlbXA7IC8vIEFkZCB0byBsaW5lYXIgdmVsb2NpdHkKICAgICAgLy8gdl9sYW1iZGEgKz0gaW52KE0pICogZGVsdGFfbGFtYmEgKiBHCgogICAgICBiaS52bGFtYmRhLmFkZFNjYWxlZFZlY3RvcihiaS5pbnZNYXNzU29sdmUgKiBkZWx0YWxhbWJkYSwgR0Euc3BhdGlhbCwgYmkudmxhbWJkYSk7CiAgICAgIGJqLnZsYW1iZGEuYWRkU2NhbGVkVmVjdG9yKGJqLmludk1hc3NTb2x2ZSAqIGRlbHRhbGFtYmRhLCBHQi5zcGF0aWFsLCBiai52bGFtYmRhKTsgLy8gQWRkIHRvIGFuZ3VsYXIgdmVsb2NpdHkKCiAgICAgIGJpLmludkluZXJ0aWFXb3JsZFNvbHZlLnZtdWx0KEdBLnJvdGF0aW9uYWwsIHRlbXApOwogICAgICBiaS53bGFtYmRhLmFkZFNjYWxlZFZlY3RvcihkZWx0YWxhbWJkYSwgdGVtcCwgYmkud2xhbWJkYSk7CiAgICAgIGJqLmludkluZXJ0aWFXb3JsZFNvbHZlLnZtdWx0KEdCLnJvdGF0aW9uYWwsIHRlbXApOwogICAgICBiai53bGFtYmRhLmFkZFNjYWxlZFZlY3RvcihkZWx0YWxhbWJkYSwgdGVtcCwgYmoud2xhbWJkYSk7CiAgICB9CiAgICAvKioKICAgICAqIENvbXB1dGUgdGhlIGRlbm9taW5hdG9yIHBhcnQgb2YgdGhlIFNQT09LIGVxdWF0aW9uOiBDID0gRyppbnYoTSkqRycgKyBlcHMKICAgICAqLwoKCiAgICBjb21wdXRlQygpIHsKICAgICAgcmV0dXJuIHRoaXMuY29tcHV0ZUdpTUd0KCkgKyB0aGlzLmVwczsKICAgIH0KCiAgfQogIEVxdWF0aW9uLmlkQ291bnRlciA9IDA7CiAgY29uc3QgaU1maSA9IG5ldyBWZWMzKCk7CiAgY29uc3QgaU1maiA9IG5ldyBWZWMzKCk7CiAgY29uc3QgaW52SWlfdm11bHRfdGF1aSA9IG5ldyBWZWMzKCk7CiAgY29uc3QgaW52SWpfdm11bHRfdGF1aiA9IG5ldyBWZWMzKCk7CiAgY29uc3QgdG1wID0gbmV3IFZlYzMoKTsKICBjb25zdCBhZGRUb1dsYW1iZGFfdGVtcCA9IG5ldyBWZWMzKCk7CgogIC8qKgogICAqIENvbnRhY3Qvbm9uLXBlbmV0cmF0aW9uIGNvbnN0cmFpbnQgZXF1YXRpb24KICAgKi8KICBjbGFzcyBDb250YWN0RXF1YXRpb24gZXh0ZW5kcyBFcXVhdGlvbiB7CiAgICAvKioKICAgICAqICJib3VuY2luZXNzIjogdTEgPSAtZSp1MAogICAgICovCgogICAgLyoqCiAgICAgKiBXb3JsZC1vcmllbnRlZCB2ZWN0b3IgdGhhdCBnb2VzIGZyb20gdGhlIGNlbnRlciBvZiBiaSB0byB0aGUgY29udGFjdCBwb2ludC4KICAgICAqLwoKICAgIC8qKgogICAgICogV29ybGQtb3JpZW50ZWQgdmVjdG9yIHRoYXQgc3RhcnRzIGluIGJvZHkgaiBwb3NpdGlvbiBhbmQgZ29lcyB0byB0aGUgY29udGFjdCBwb2ludC4KICAgICAqLwoKICAgIC8qKgogICAgICogQ29udGFjdCBub3JtYWwsIHBvaW50aW5nIG91dCBvZiBib2R5IGkuCiAgICAgKi8KICAgIGNvbnN0cnVjdG9yKGJvZHlBLCBib2R5QiwgbWF4Rm9yY2UpIHsKICAgICAgaWYgKG1heEZvcmNlID09PSB2b2lkIDApIHsKICAgICAgICBtYXhGb3JjZSA9IDFlNjsKICAgICAgfQoKICAgICAgc3VwZXIoYm9keUEsIGJvZHlCLCAwLCBtYXhGb3JjZSk7CiAgICAgIHRoaXMucmVzdGl0dXRpb24gPSAwLjA7CiAgICAgIHRoaXMucmkgPSBuZXcgVmVjMygpOwogICAgICB0aGlzLnJqID0gbmV3IFZlYzMoKTsKICAgICAgdGhpcy5uaSA9IG5ldyBWZWMzKCk7CiAgICB9CgogICAgY29tcHV0ZUIoaCkgewogICAgICBjb25zdCBhID0gdGhpcy5hOwogICAgICBjb25zdCBiID0gdGhpcy5iOwogICAgICBjb25zdCBiaSA9IHRoaXMuYmk7CiAgICAgIGNvbnN0IGJqID0gdGhpcy5iajsKICAgICAgY29uc3QgcmkgPSB0aGlzLnJpOwogICAgICBjb25zdCByaiA9IHRoaXMucmo7CiAgICAgIGNvbnN0IHJpeG4gPSBDb250YWN0RXF1YXRpb25fY29tcHV0ZUJfdGVtcDE7CiAgICAgIGNvbnN0IHJqeG4gPSBDb250YWN0RXF1YXRpb25fY29tcHV0ZUJfdGVtcDI7CiAgICAgIGNvbnN0IHZpID0gYmkudmVsb2NpdHk7CiAgICAgIGNvbnN0IHdpID0gYmkuYW5ndWxhclZlbG9jaXR5OwogICAgICBiaS5mb3JjZTsKICAgICAgYmkudG9ycXVlOwogICAgICBjb25zdCB2aiA9IGJqLnZlbG9jaXR5OwogICAgICBjb25zdCB3aiA9IGJqLmFuZ3VsYXJWZWxvY2l0eTsKICAgICAgYmouZm9yY2U7CiAgICAgIGJqLnRvcnF1ZTsKICAgICAgY29uc3QgcGVuZXRyYXRpb25WZWMgPSBDb250YWN0RXF1YXRpb25fY29tcHV0ZUJfdGVtcDM7CiAgICAgIGNvbnN0IEdBID0gdGhpcy5qYWNvYmlhbkVsZW1lbnRBOwogICAgICBjb25zdCBHQiA9IHRoaXMuamFjb2JpYW5FbGVtZW50QjsKICAgICAgY29uc3QgbiA9IHRoaXMubmk7IC8vIENhbHVjbGF0ZSBjcm9zcyBwcm9kdWN0cwoKICAgICAgcmkuY3Jvc3Mobiwgcml4bik7CiAgICAgIHJqLmNyb3NzKG4sIHJqeG4pOyAvLyBnID0geGorcmogLSh4aStyaSkKICAgICAgLy8gRyA9IFsgLW5pICAtcml4biAgbmkgIHJqeG4gXQoKICAgICAgbi5uZWdhdGUoR0Euc3BhdGlhbCk7CiAgICAgIHJpeG4ubmVnYXRlKEdBLnJvdGF0aW9uYWwpOwogICAgICBHQi5zcGF0aWFsLmNvcHkobik7CiAgICAgIEdCLnJvdGF0aW9uYWwuY29weShyanhuKTsgLy8gQ2FsY3VsYXRlIHRoZSBwZW5ldHJhdGlvbiB2ZWN0b3IKCiAgICAgIHBlbmV0cmF0aW9uVmVjLmNvcHkoYmoucG9zaXRpb24pOwogICAgICBwZW5ldHJhdGlvblZlYy52YWRkKHJqLCBwZW5ldHJhdGlvblZlYyk7CiAgICAgIHBlbmV0cmF0aW9uVmVjLnZzdWIoYmkucG9zaXRpb24sIHBlbmV0cmF0aW9uVmVjKTsKICAgICAgcGVuZXRyYXRpb25WZWMudnN1YihyaSwgcGVuZXRyYXRpb25WZWMpOwogICAgICBjb25zdCBnID0gbi5kb3QocGVuZXRyYXRpb25WZWMpOyAvLyBDb21wdXRlIGl0ZXJhdGlvbgoKICAgICAgY29uc3QgZVBsdXNPbmUgPSB0aGlzLnJlc3RpdHV0aW9uICsgMTsKICAgICAgY29uc3QgR1cgPSBlUGx1c09uZSAqIHZqLmRvdChuKSAtIGVQbHVzT25lICogdmkuZG90KG4pICsgd2ouZG90KHJqeG4pIC0gd2kuZG90KHJpeG4pOwogICAgICBjb25zdCBHaU1mID0gdGhpcy5jb21wdXRlR2lNZigpOwogICAgICBjb25zdCBCID0gLWcgKiBhIC0gR1cgKiBiIC0gaCAqIEdpTWY7CiAgICAgIHJldHVybiBCOwogICAgfQogICAgLyoqCiAgICAgKiBHZXQgdGhlIGN1cnJlbnQgcmVsYXRpdmUgdmVsb2NpdHkgaW4gdGhlIGNvbnRhY3QgcG9pbnQuCiAgICAgKi8KCgogICAgZ2V0SW1wYWN0VmVsb2NpdHlBbG9uZ05vcm1hbCgpIHsKICAgICAgY29uc3QgdmkgPSBDb250YWN0RXF1YXRpb25fZ2V0SW1wYWN0VmVsb2NpdHlBbG9uZ05vcm1hbF92aTsKICAgICAgY29uc3QgdmogPSBDb250YWN0RXF1YXRpb25fZ2V0SW1wYWN0VmVsb2NpdHlBbG9uZ05vcm1hbF92ajsKICAgICAgY29uc3QgeGkgPSBDb250YWN0RXF1YXRpb25fZ2V0SW1wYWN0VmVsb2NpdHlBbG9uZ05vcm1hbF94aTsKICAgICAgY29uc3QgeGogPSBDb250YWN0RXF1YXRpb25fZ2V0SW1wYWN0VmVsb2NpdHlBbG9uZ05vcm1hbF94ajsKICAgICAgY29uc3QgcmVsVmVsID0gQ29udGFjdEVxdWF0aW9uX2dldEltcGFjdFZlbG9jaXR5QWxvbmdOb3JtYWxfcmVsVmVsOwogICAgICB0aGlzLmJpLnBvc2l0aW9uLnZhZGQodGhpcy5yaSwgeGkpOwogICAgICB0aGlzLmJqLnBvc2l0aW9uLnZhZGQodGhpcy5yaiwgeGopOwogICAgICB0aGlzLmJpLmdldFZlbG9jaXR5QXRXb3JsZFBvaW50KHhpLCB2aSk7CiAgICAgIHRoaXMuYmouZ2V0VmVsb2NpdHlBdFdvcmxkUG9pbnQoeGosIHZqKTsKICAgICAgdmkudnN1Yih2aiwgcmVsVmVsKTsKICAgICAgcmV0dXJuIHRoaXMubmkuZG90KHJlbFZlbCk7CiAgICB9CgogIH0KICBjb25zdCBDb250YWN0RXF1YXRpb25fY29tcHV0ZUJfdGVtcDEgPSBuZXcgVmVjMygpOyAvLyBUZW1wIHZlY3RvcnMKCiAgY29uc3QgQ29udGFjdEVxdWF0aW9uX2NvbXB1dGVCX3RlbXAyID0gbmV3IFZlYzMoKTsKICBjb25zdCBDb250YWN0RXF1YXRpb25fY29tcHV0ZUJfdGVtcDMgPSBuZXcgVmVjMygpOwogIGNvbnN0IENvbnRhY3RFcXVhdGlvbl9nZXRJbXBhY3RWZWxvY2l0eUFsb25nTm9ybWFsX3ZpID0gbmV3IFZlYzMoKTsKICBjb25zdCBDb250YWN0RXF1YXRpb25fZ2V0SW1wYWN0VmVsb2NpdHlBbG9uZ05vcm1hbF92aiA9IG5ldyBWZWMzKCk7CiAgY29uc3QgQ29udGFjdEVxdWF0aW9uX2dldEltcGFjdFZlbG9jaXR5QWxvbmdOb3JtYWxfeGkgPSBuZXcgVmVjMygpOwogIGNvbnN0IENvbnRhY3RFcXVhdGlvbl9nZXRJbXBhY3RWZWxvY2l0eUFsb25nTm9ybWFsX3hqID0gbmV3IFZlYzMoKTsKICBjb25zdCBDb250YWN0RXF1YXRpb25fZ2V0SW1wYWN0VmVsb2NpdHlBbG9uZ05vcm1hbF9yZWxWZWwgPSBuZXcgVmVjMygpOwoKICAvKioKICAgKiBDb25uZWN0cyB0d28gYm9kaWVzIGF0IGdpdmVuIG9mZnNldCBwb2ludHMuCiAgICogQGV4YW1wbGUKICAgKiAgICAgY29uc3QgYm9keUEgPSBuZXcgQm9keSh7IG1hc3M6IDEgfSkKICAgKiAgICAgY29uc3QgYm9keUIgPSBuZXcgQm9keSh7IG1hc3M6IDEgfSkKICAgKiAgICAgYm9keUEucG9zaXRpb24uc2V0KC0xLCAwLCAwKQogICAqICAgICBib2R5Qi5wb3NpdGlvbi5zZXQoMSwgMCwgMCkKICAgKiAgICAgYm9keUEuYWRkU2hhcGUoc2hhcGVBKQogICAqICAgICBib2R5Qi5hZGRTaGFwZShzaGFwZUIpCiAgICogICAgIHdvcmxkLmFkZEJvZHkoYm9keUEpCiAgICogICAgIHdvcmxkLmFkZEJvZHkoYm9keUIpCiAgICogICAgIGNvbnN0IGxvY2FsUGl2b3RBID0gbmV3IFZlYzMoMSwgMCwgMCkKICAgKiAgICAgY29uc3QgbG9jYWxQaXZvdEIgPSBuZXcgVmVjMygtMSwgMCwgMCkKICAgKiAgICAgY29uc3QgY29uc3RyYWludCA9IG5ldyBQb2ludFRvUG9pbnRDb25zdHJhaW50KGJvZHlBLCBsb2NhbFBpdm90QSwgYm9keUIsIGxvY2FsUGl2b3RCKQogICAqICAgICB3b3JsZC5hZGRDb25zdHJhaW50KGNvbnN0cmFpbnQpCiAgICovCiAgY2xhc3MgUG9pbnRUb1BvaW50Q29uc3RyYWludCBleHRlbmRzIENvbnN0cmFpbnQgewogICAgLyoqCiAgICAgKiBQaXZvdCwgZGVmaW5lZCBsb2NhbGx5IGluIGJvZHlBLgogICAgICovCgogICAgLyoqCiAgICAgKiBQaXZvdCwgZGVmaW5lZCBsb2NhbGx5IGluIGJvZHlCLgogICAgICovCgogICAgLyoqCiAgICAgKiBAcGFyYW0gcGl2b3RBIFRoZSBwb2ludCByZWxhdGl2ZSB0byB0aGUgY2VudGVyIG9mIG1hc3Mgb2YgYm9keUEgd2hpY2ggYm9keUEgaXMgY29uc3RyYWluZWQgdG8uCiAgICAgKiBAcGFyYW0gYm9keUIgQm9keSB0aGF0IHdpbGwgYmUgY29uc3RyYWluZWQgaW4gYSBzaW1pbGFyIHdheSB0byB0aGUgc2FtZSBwb2ludCBhcyBib2R5QS4gV2Ugd2lsbCB0aGVyZWZvcmUgZ2V0IGEgbGluayBiZXR3ZWVuIGJvZHlBIGFuZCBib2R5Qi4gSWYgbm90IHNwZWNpZmllZCwgYm9keUEgd2lsbCBiZSBjb25zdHJhaW5lZCB0byBhIHN0YXRpYyBwb2ludC4KICAgICAqIEBwYXJhbSBwaXZvdEIgVGhlIHBvaW50IHJlbGF0aXZlIHRvIHRoZSBjZW50ZXIgb2YgbWFzcyBvZiBib2R5QiB3aGljaCBib2R5QiBpcyBjb25zdHJhaW5lZCB0by4KICAgICAqIEBwYXJhbSBtYXhGb3JjZSBUaGUgbWF4aW11bSBmb3JjZSB0aGF0IHNob3VsZCBiZSBhcHBsaWVkIHRvIGNvbnN0cmFpbiB0aGUgYm9kaWVzLgogICAgICovCiAgICBjb25zdHJ1Y3Rvcihib2R5QSwgcGl2b3RBLCBib2R5QiwgcGl2b3RCLCBtYXhGb3JjZSkgewogICAgICBpZiAocGl2b3RBID09PSB2b2lkIDApIHsKICAgICAgICBwaXZvdEEgPSBuZXcgVmVjMygpOwogICAgICB9CgogICAgICBpZiAocGl2b3RCID09PSB2b2lkIDApIHsKICAgICAgICBwaXZvdEIgPSBuZXcgVmVjMygpOwogICAgICB9CgogICAgICBpZiAobWF4Rm9yY2UgPT09IHZvaWQgMCkgewogICAgICAgIG1heEZvcmNlID0gMWU2OwogICAgICB9CgogICAgICBzdXBlcihib2R5QSwgYm9keUIpOwogICAgICB0aGlzLnBpdm90QSA9IHBpdm90QS5jbG9uZSgpOwogICAgICB0aGlzLnBpdm90QiA9IHBpdm90Qi5jbG9uZSgpOwogICAgICBjb25zdCB4ID0gdGhpcy5lcXVhdGlvblggPSBuZXcgQ29udGFjdEVxdWF0aW9uKGJvZHlBLCBib2R5Qik7CiAgICAgIGNvbnN0IHkgPSB0aGlzLmVxdWF0aW9uWSA9IG5ldyBDb250YWN0RXF1YXRpb24oYm9keUEsIGJvZHlCKTsKICAgICAgY29uc3QgeiA9IHRoaXMuZXF1YXRpb25aID0gbmV3IENvbnRhY3RFcXVhdGlvbihib2R5QSwgYm9keUIpOyAvLyBFcXVhdGlvbnMgdG8gYmUgZmVkIHRvIHRoZSBzb2x2ZXIKCiAgICAgIHRoaXMuZXF1YXRpb25zLnB1c2goeCwgeSwgeik7IC8vIE1ha2UgdGhlIGVxdWF0aW9ucyBiaWRpcmVjdGlvbmFsCgogICAgICB4Lm1pbkZvcmNlID0geS5taW5Gb3JjZSA9IHoubWluRm9yY2UgPSAtbWF4Rm9yY2U7CiAgICAgIHgubWF4Rm9yY2UgPSB5Lm1heEZvcmNlID0gei5tYXhGb3JjZSA9IG1heEZvcmNlOwogICAgICB4Lm5pLnNldCgxLCAwLCAwKTsKICAgICAgeS5uaS5zZXQoMCwgMSwgMCk7CiAgICAgIHoubmkuc2V0KDAsIDAsIDEpOwogICAgfQoKICAgIHVwZGF0ZSgpIHsKICAgICAgY29uc3QgYm9keUEgPSB0aGlzLmJvZHlBOwogICAgICBjb25zdCBib2R5QiA9IHRoaXMuYm9keUI7CiAgICAgIGNvbnN0IHggPSB0aGlzLmVxdWF0aW9uWDsKICAgICAgY29uc3QgeSA9IHRoaXMuZXF1YXRpb25ZOwogICAgICBjb25zdCB6ID0gdGhpcy5lcXVhdGlvblo7IC8vIFJvdGF0ZSB0aGUgcGl2b3RzIHRvIHdvcmxkIHNwYWNlCgogICAgICBib2R5QS5xdWF0ZXJuaW9uLnZtdWx0KHRoaXMucGl2b3RBLCB4LnJpKTsKICAgICAgYm9keUIucXVhdGVybmlvbi52bXVsdCh0aGlzLnBpdm90QiwgeC5yaik7CiAgICAgIHkucmkuY29weSh4LnJpKTsKICAgICAgeS5yai5jb3B5KHgucmopOwogICAgICB6LnJpLmNvcHkoeC5yaSk7CiAgICAgIHoucmouY29weSh4LnJqKTsKICAgIH0KCiAgfQoKICAvKioKICAgKiBDb25lIGVxdWF0aW9uLiBXb3JrcyB0byBrZWVwIHRoZSBnaXZlbiBib2R5IHdvcmxkIHZlY3RvcnMgYWxpZ25lZCwgb3IgdGlsdGVkIHdpdGhpbiBhIGdpdmVuIGFuZ2xlIGZyb20gZWFjaCBvdGhlci4KICAgKi8KICBjbGFzcyBDb25lRXF1YXRpb24gZXh0ZW5kcyBFcXVhdGlvbiB7CiAgICAvKioKICAgICAqIExvY2FsIGF4aXMgaW4gQQogICAgICovCgogICAgLyoqCiAgICAgKiBMb2NhbCBheGlzIGluIEIKICAgICAqLwoKICAgIC8qKgogICAgICogVGhlICJjb25lIGFuZ2xlIiB0byBrZWVwCiAgICAgKi8KICAgIGNvbnN0cnVjdG9yKGJvZHlBLCBib2R5Qiwgb3B0aW9ucykgewogICAgICBpZiAob3B0aW9ucyA9PT0gdm9pZCAwKSB7CiAgICAgICAgb3B0aW9ucyA9IHt9OwogICAgICB9CgogICAgICBjb25zdCBtYXhGb3JjZSA9IHR5cGVvZiBvcHRpb25zLm1heEZvcmNlICE9PSAndW5kZWZpbmVkJyA/IG9wdGlvbnMubWF4Rm9yY2UgOiAxZTY7CiAgICAgIHN1cGVyKGJvZHlBLCBib2R5QiwgLW1heEZvcmNlLCBtYXhGb3JjZSk7CiAgICAgIHRoaXMuYXhpc0EgPSBvcHRpb25zLmF4aXNBID8gb3B0aW9ucy5heGlzQS5jbG9uZSgpIDogbmV3IFZlYzMoMSwgMCwgMCk7CiAgICAgIHRoaXMuYXhpc0IgPSBvcHRpb25zLmF4aXNCID8gb3B0aW9ucy5heGlzQi5jbG9uZSgpIDogbmV3IFZlYzMoMCwgMSwgMCk7CiAgICAgIHRoaXMuYW5nbGUgPSB0eXBlb2Ygb3B0aW9ucy5hbmdsZSAhPT0gJ3VuZGVmaW5lZCcgPyBvcHRpb25zLmFuZ2xlIDogMDsKICAgIH0KCiAgICBjb21wdXRlQihoKSB7CiAgICAgIGNvbnN0IGEgPSB0aGlzLmE7CiAgICAgIGNvbnN0IGIgPSB0aGlzLmI7CiAgICAgIGNvbnN0IG5pID0gdGhpcy5heGlzQTsKICAgICAgY29uc3QgbmogPSB0aGlzLmF4aXNCOwogICAgICBjb25zdCBuaXhuaiA9IHRtcFZlYzEkMjsKICAgICAgY29uc3Qgbmp4bmkgPSB0bXBWZWMyJDI7CiAgICAgIGNvbnN0IEdBID0gdGhpcy5qYWNvYmlhbkVsZW1lbnRBOwogICAgICBjb25zdCBHQiA9IHRoaXMuamFjb2JpYW5FbGVtZW50QjsgLy8gQ2FsdWNsYXRlIGNyb3NzIHByb2R1Y3RzCgogICAgICBuaS5jcm9zcyhuaiwgbml4bmopOwogICAgICBuai5jcm9zcyhuaSwgbmp4bmkpOyAvLyBUaGUgYW5nbGUgYmV0d2VlbiB0d28gdmVjdG9yIGlzOgogICAgICAvLyBjb3ModGhldGEpID0gYSAqIGIgLyAobGVuZ3RoKGEpICogbGVuZ3RoKGIpID0geyBsZW4oYSkgPSBsZW4oYikgPSAxIH0gPSBhICogYgogICAgICAvLyBnID0gYSAqIGIKICAgICAgLy8gZ2RvdCA9IChiIHggYSkgKiB3aSArIChhIHggYikgKiB3agogICAgICAvLyBHID0gWzAgYnhhIDAgYXhiXQogICAgICAvLyBXID0gW3ZpIHdpIHZqIHdqXQoKICAgICAgR0Eucm90YXRpb25hbC5jb3B5KG5qeG5pKTsKICAgICAgR0Iucm90YXRpb25hbC5jb3B5KG5peG5qKTsKICAgICAgY29uc3QgZyA9IE1hdGguY29zKHRoaXMuYW5nbGUpIC0gbmkuZG90KG5qKTsKICAgICAgY29uc3QgR1cgPSB0aGlzLmNvbXB1dGVHVygpOwogICAgICBjb25zdCBHaU1mID0gdGhpcy5jb21wdXRlR2lNZigpOwogICAgICBjb25zdCBCID0gLWcgKiBhIC0gR1cgKiBiIC0gaCAqIEdpTWY7CiAgICAgIHJldHVybiBCOwogICAgfQoKICB9CiAgY29uc3QgdG1wVmVjMSQyID0gbmV3IFZlYzMoKTsKICBjb25zdCB0bXBWZWMyJDIgPSBuZXcgVmVjMygpOwoKICAvKioKICAgKiBSb3RhdGlvbmFsIGNvbnN0cmFpbnQuIFdvcmtzIHRvIGtlZXAgdGhlIGxvY2FsIHZlY3RvcnMgb3J0aG9nb25hbCB0byBlYWNoIG90aGVyIGluIHdvcmxkIHNwYWNlLgogICAqLwogIGNsYXNzIFJvdGF0aW9uYWxFcXVhdGlvbiBleHRlbmRzIEVxdWF0aW9uIHsKICAgIC8qKgogICAgICogV29ybGQgb3JpZW50ZWQgcm90YXRpb25hbCBheGlzLgogICAgICovCgogICAgLyoqCiAgICAgKiBXb3JsZCBvcmllbnRlZCByb3RhdGlvbmFsIGF4aXMuCiAgICAgKi8KCiAgICAvKioKICAgICAqIG1heEFuZ2xlCiAgICAgKi8KICAgIGNvbnN0cnVjdG9yKGJvZHlBLCBib2R5Qiwgb3B0aW9ucykgewogICAgICBpZiAob3B0aW9ucyA9PT0gdm9pZCAwKSB7CiAgICAgICAgb3B0aW9ucyA9IHt9OwogICAgICB9CgogICAgICBjb25zdCBtYXhGb3JjZSA9IHR5cGVvZiBvcHRpb25zLm1heEZvcmNlICE9PSAndW5kZWZpbmVkJyA/IG9wdGlvbnMubWF4Rm9yY2UgOiAxZTY7CiAgICAgIHN1cGVyKGJvZHlBLCBib2R5QiwgLW1heEZvcmNlLCBtYXhGb3JjZSk7CiAgICAgIHRoaXMuYXhpc0EgPSBvcHRpb25zLmF4aXNBID8gb3B0aW9ucy5heGlzQS5jbG9uZSgpIDogbmV3IFZlYzMoMSwgMCwgMCk7CiAgICAgIHRoaXMuYXhpc0IgPSBvcHRpb25zLmF4aXNCID8gb3B0aW9ucy5heGlzQi5jbG9uZSgpIDogbmV3IFZlYzMoMCwgMSwgMCk7CiAgICAgIHRoaXMubWF4QW5nbGUgPSBNYXRoLlBJIC8gMjsKICAgIH0KCiAgICBjb21wdXRlQihoKSB7CiAgICAgIGNvbnN0IGEgPSB0aGlzLmE7CiAgICAgIGNvbnN0IGIgPSB0aGlzLmI7CiAgICAgIGNvbnN0IG5pID0gdGhpcy5heGlzQTsKICAgICAgY29uc3QgbmogPSB0aGlzLmF4aXNCOwogICAgICBjb25zdCBuaXhuaiA9IHRtcFZlYzEkMTsKICAgICAgY29uc3Qgbmp4bmkgPSB0bXBWZWMyJDE7CiAgICAgIGNvbnN0IEdBID0gdGhpcy5qYWNvYmlhbkVsZW1lbnRBOwogICAgICBjb25zdCBHQiA9IHRoaXMuamFjb2JpYW5FbGVtZW50QjsgLy8gQ2FsdWNsYXRlIGNyb3NzIHByb2R1Y3RzCgogICAgICBuaS5jcm9zcyhuaiwgbml4bmopOwogICAgICBuai5jcm9zcyhuaSwgbmp4bmkpOyAvLyBnID0gbmkgKiBuagogICAgICAvLyBnZG90ID0gKG5qIHggbmkpICogd2kgKyAobmkgeCBuaikgKiB3agogICAgICAvLyBHID0gWzAgbmp4bmkgMCBuaXhual0KICAgICAgLy8gVyA9IFt2aSB3aSB2aiB3al0KCiAgICAgIEdBLnJvdGF0aW9uYWwuY29weShuanhuaSk7CiAgICAgIEdCLnJvdGF0aW9uYWwuY29weShuaXhuaik7CiAgICAgIGNvbnN0IGcgPSBNYXRoLmNvcyh0aGlzLm1heEFuZ2xlKSAtIG5pLmRvdChuaik7CiAgICAgIGNvbnN0IEdXID0gdGhpcy5jb21wdXRlR1coKTsKICAgICAgY29uc3QgR2lNZiA9IHRoaXMuY29tcHV0ZUdpTWYoKTsKICAgICAgY29uc3QgQiA9IC1nICogYSAtIEdXICogYiAtIGggKiBHaU1mOwogICAgICByZXR1cm4gQjsKICAgIH0KCiAgfQogIGNvbnN0IHRtcFZlYzEkMSA9IG5ldyBWZWMzKCk7CiAgY29uc3QgdG1wVmVjMiQxID0gbmV3IFZlYzMoKTsKCiAgLyoqCiAgICogQSBDb25lIFR3aXN0IGNvbnN0cmFpbnQsIHVzZWZ1bCBmb3IgcmFnZG9sbHMuCiAgICovCiAgY2xhc3MgQ29uZVR3aXN0Q29uc3RyYWludCBleHRlbmRzIFBvaW50VG9Qb2ludENvbnN0cmFpbnQgewogICAgLyoqCiAgICAgKiBUaGUgYXhpcyBkaXJlY3Rpb24gZm9yIHRoZSBjb25zdHJhaW50IG9mIHRoZSBib2R5IEEuCiAgICAgKi8KCiAgICAvKioKICAgICAqIFRoZSBheGlzIGRpcmVjdGlvbiBmb3IgdGhlIGNvbnN0cmFpbnQgb2YgdGhlIGJvZHkgQi4KICAgICAqLwoKICAgIC8qKgogICAgICogVGhlIGFwZXJ0dXJlIGFuZ2xlIG9mIHRoZSBjb25lLgogICAgICovCgogICAgLyoqCiAgICAgKiBUaGUgdHdpc3QgYW5nbGUgb2YgdGhlIGpvaW50LgogICAgICovCiAgICBjb25zdHJ1Y3Rvcihib2R5QSwgYm9keUIsIG9wdGlvbnMpIHsKICAgICAgaWYgKG9wdGlvbnMgPT09IHZvaWQgMCkgewogICAgICAgIG9wdGlvbnMgPSB7fTsKICAgICAgfQoKICAgICAgY29uc3QgbWF4Rm9yY2UgPSB0eXBlb2Ygb3B0aW9ucy5tYXhGb3JjZSAhPT0gJ3VuZGVmaW5lZCcgPyBvcHRpb25zLm1heEZvcmNlIDogMWU2OyAvLyBTZXQgcGl2b3QgcG9pbnQgaW4gYmV0d2VlbgoKICAgICAgY29uc3QgcGl2b3RBID0gb3B0aW9ucy5waXZvdEEgPyBvcHRpb25zLnBpdm90QS5jbG9uZSgpIDogbmV3IFZlYzMoKTsKICAgICAgY29uc3QgcGl2b3RCID0gb3B0aW9ucy5waXZvdEIgPyBvcHRpb25zLnBpdm90Qi5jbG9uZSgpIDogbmV3IFZlYzMoKTsKICAgICAgc3VwZXIoYm9keUEsIHBpdm90QSwgYm9keUIsIHBpdm90QiwgbWF4Rm9yY2UpOwogICAgICB0aGlzLmF4aXNBID0gb3B0aW9ucy5heGlzQSA/IG9wdGlvbnMuYXhpc0EuY2xvbmUoKSA6IG5ldyBWZWMzKCk7CiAgICAgIHRoaXMuYXhpc0IgPSBvcHRpb25zLmF4aXNCID8gb3B0aW9ucy5heGlzQi5jbG9uZSgpIDogbmV3IFZlYzMoKTsKICAgICAgdGhpcy5jb2xsaWRlQ29ubmVjdGVkID0gISFvcHRpb25zLmNvbGxpZGVDb25uZWN0ZWQ7CiAgICAgIHRoaXMuYW5nbGUgPSB0eXBlb2Ygb3B0aW9ucy5hbmdsZSAhPT0gJ3VuZGVmaW5lZCcgPyBvcHRpb25zLmFuZ2xlIDogMDsKICAgICAgY29uc3QgYyA9IHRoaXMuY29uZUVxdWF0aW9uID0gbmV3IENvbmVFcXVhdGlvbihib2R5QSwgYm9keUIsIG9wdGlvbnMpOwogICAgICBjb25zdCB0ID0gdGhpcy50d2lzdEVxdWF0aW9uID0gbmV3IFJvdGF0aW9uYWxFcXVhdGlvbihib2R5QSwgYm9keUIsIG9wdGlvbnMpOwogICAgICB0aGlzLnR3aXN0QW5nbGUgPSB0eXBlb2Ygb3B0aW9ucy50d2lzdEFuZ2xlICE9PSAndW5kZWZpbmVkJyA/IG9wdGlvbnMudHdpc3RBbmdsZSA6IDA7IC8vIE1ha2UgdGhlIGNvbmUgZXF1YXRpb24gcHVzaCB0aGUgYm9kaWVzIHRvd2FyZCB0aGUgY29uZSBheGlzLCBub3Qgb3V0d2FyZAoKICAgICAgYy5tYXhGb3JjZSA9IDA7CiAgICAgIGMubWluRm9yY2UgPSAtbWF4Rm9yY2U7IC8vIE1ha2UgdGhlIHR3aXN0IGVxdWF0aW9uIGFkZCB0b3JxdWUgdG93YXJkIHRoZSBpbml0aWFsIHBvc2l0aW9uCgogICAgICB0Lm1heEZvcmNlID0gMDsKICAgICAgdC5taW5Gb3JjZSA9IC1tYXhGb3JjZTsKICAgICAgdGhpcy5lcXVhdGlvbnMucHVzaChjLCB0KTsKICAgIH0KCiAgICB1cGRhdGUoKSB7CiAgICAgIGNvbnN0IGJvZHlBID0gdGhpcy5ib2R5QTsKICAgICAgY29uc3QgYm9keUIgPSB0aGlzLmJvZHlCOwogICAgICBjb25zdCBjb25lID0gdGhpcy5jb25lRXF1YXRpb247CiAgICAgIGNvbnN0IHR3aXN0ID0gdGhpcy50d2lzdEVxdWF0aW9uOwogICAgICBzdXBlci51cGRhdGUoKTsgLy8gVXBkYXRlIHRoZSBheGVzIHRvIHRoZSBjb25lIGNvbnN0cmFpbnQKCiAgICAgIGJvZHlBLnZlY3RvclRvV29ybGRGcmFtZSh0aGlzLmF4aXNBLCBjb25lLmF4aXNBKTsKICAgICAgYm9keUIudmVjdG9yVG9Xb3JsZEZyYW1lKHRoaXMuYXhpc0IsIGNvbmUuYXhpc0IpOyAvLyBVcGRhdGUgdGhlIHdvcmxkIGF4ZXMgaW4gdGhlIHR3aXN0IGNvbnN0cmFpbnQKCiAgICAgIHRoaXMuYXhpc0EudGFuZ2VudHModHdpc3QuYXhpc0EsIHR3aXN0LmF4aXNBKTsKICAgICAgYm9keUEudmVjdG9yVG9Xb3JsZEZyYW1lKHR3aXN0LmF4aXNBLCB0d2lzdC5heGlzQSk7CiAgICAgIHRoaXMuYXhpc0IudGFuZ2VudHModHdpc3QuYXhpc0IsIHR3aXN0LmF4aXNCKTsKICAgICAgYm9keUIudmVjdG9yVG9Xb3JsZEZyYW1lKHR3aXN0LmF4aXNCLCB0d2lzdC5heGlzQik7CiAgICAgIGNvbmUuYW5nbGUgPSB0aGlzLmFuZ2xlOwogICAgICB0d2lzdC5tYXhBbmdsZSA9IHRoaXMudHdpc3RBbmdsZTsKICAgIH0KCiAgfQogIG5ldyBWZWMzKCk7CiAgbmV3IFZlYzMoKTsKCiAgLyoqCiAgICogQ29uc3RyYWlucyB0d28gYm9kaWVzIHRvIGJlIGF0IGEgY29uc3RhbnQgZGlzdGFuY2UgZnJvbSBlYWNoIG90aGVycyBjZW50ZXIgb2YgbWFzcy4KICAgKi8KICBjbGFzcyBEaXN0YW5jZUNvbnN0cmFpbnQgZXh0ZW5kcyBDb25zdHJhaW50IHsKICAgIC8qKgogICAgICogVGhlIGRpc3RhbmNlIHRvIGtlZXAuIElmIHVuZGVmaW5lZCwgaXQgd2lsbCBiZSBzZXQgdG8gdGhlIGN1cnJlbnQgZGlzdGFuY2UgYmV0d2VlbiBib2R5QSBhbmQgYm9keUIKICAgICAqLwoKICAgIC8qKgogICAgICogQHBhcmFtIGRpc3RhbmNlIFRoZSBkaXN0YW5jZSB0byBrZWVwLiBJZiB1bmRlZmluZWQsIGl0IHdpbGwgYmUgc2V0IHRvIHRoZSBjdXJyZW50IGRpc3RhbmNlIGJldHdlZW4gYm9keUEgYW5kIGJvZHlCLgogICAgICogQHBhcmFtIG1heEZvcmNlIFRoZSBtYXhpbXVtIGZvcmNlIHRoYXQgc2hvdWxkIGJlIGFwcGxpZWQgdG8gY29uc3RyYWluIHRoZSBib2RpZXMuCiAgICAgKi8KICAgIGNvbnN0cnVjdG9yKGJvZHlBLCBib2R5QiwgZGlzdGFuY2UsIG1heEZvcmNlKSB7CiAgICAgIGlmIChtYXhGb3JjZSA9PT0gdm9pZCAwKSB7CiAgICAgICAgbWF4Rm9yY2UgPSAxZTY7CiAgICAgIH0KCiAgICAgIHN1cGVyKGJvZHlBLCBib2R5Qik7CgogICAgICBpZiAodHlwZW9mIGRpc3RhbmNlID09PSAndW5kZWZpbmVkJykgewogICAgICAgIGRpc3RhbmNlID0gYm9keUEucG9zaXRpb24uZGlzdGFuY2VUbyhib2R5Qi5wb3NpdGlvbik7CiAgICAgIH0KCiAgICAgIHRoaXMuZGlzdGFuY2UgPSBkaXN0YW5jZTsKICAgICAgY29uc3QgZXEgPSB0aGlzLmRpc3RhbmNlRXF1YXRpb24gPSBuZXcgQ29udGFjdEVxdWF0aW9uKGJvZHlBLCBib2R5Qik7CiAgICAgIHRoaXMuZXF1YXRpb25zLnB1c2goZXEpOyAvLyBNYWtlIGl0IGJpZGlyZWN0aW9uYWwKCiAgICAgIGVxLm1pbkZvcmNlID0gLW1heEZvcmNlOwogICAgICBlcS5tYXhGb3JjZSA9IG1heEZvcmNlOwogICAgfQogICAgLyoqCiAgICAgKiB1cGRhdGUKICAgICAqLwoKCiAgICB1cGRhdGUoKSB7CiAgICAgIGNvbnN0IGJvZHlBID0gdGhpcy5ib2R5QTsKICAgICAgY29uc3QgYm9keUIgPSB0aGlzLmJvZHlCOwogICAgICBjb25zdCBlcSA9IHRoaXMuZGlzdGFuY2VFcXVhdGlvbjsKICAgICAgY29uc3QgaGFsZkRpc3QgPSB0aGlzLmRpc3RhbmNlICogMC41OwogICAgICBjb25zdCBub3JtYWwgPSBlcS5uaTsKICAgICAgYm9keUIucG9zaXRpb24udnN1Yihib2R5QS5wb3NpdGlvbiwgbm9ybWFsKTsKICAgICAgbm9ybWFsLm5vcm1hbGl6ZSgpOwogICAgICBub3JtYWwuc2NhbGUoaGFsZkRpc3QsIGVxLnJpKTsKICAgICAgbm9ybWFsLnNjYWxlKC1oYWxmRGlzdCwgZXEucmopOwogICAgfQoKICB9CgogIC8qKgogICAqIExvY2sgY29uc3RyYWludC4gV2lsbCByZW1vdmUgYWxsIGRlZ3JlZXMgb2YgZnJlZWRvbSBiZXR3ZWVuIHRoZSBib2RpZXMuCiAgICovCiAgY2xhc3MgTG9ja0NvbnN0cmFpbnQgZXh0ZW5kcyBQb2ludFRvUG9pbnRDb25zdHJhaW50IHsKICAgIGNvbnN0cnVjdG9yKGJvZHlBLCBib2R5Qiwgb3B0aW9ucykgewogICAgICBpZiAob3B0aW9ucyA9PT0gdm9pZCAwKSB7CiAgICAgICAgb3B0aW9ucyA9IHt9OwogICAgICB9CgogICAgICBjb25zdCBtYXhGb3JjZSA9IHR5cGVvZiBvcHRpb25zLm1heEZvcmNlICE9PSAndW5kZWZpbmVkJyA/IG9wdGlvbnMubWF4Rm9yY2UgOiAxZTY7IC8vIFNldCBwaXZvdCBwb2ludCBpbiBiZXR3ZWVuCgogICAgICBjb25zdCBwaXZvdEEgPSBuZXcgVmVjMygpOwogICAgICBjb25zdCBwaXZvdEIgPSBuZXcgVmVjMygpOwogICAgICBjb25zdCBoYWxmV2F5ID0gbmV3IFZlYzMoKTsKICAgICAgYm9keUEucG9zaXRpb24udmFkZChib2R5Qi5wb3NpdGlvbiwgaGFsZldheSk7CiAgICAgIGhhbGZXYXkuc2NhbGUoMC41LCBoYWxmV2F5KTsKICAgICAgYm9keUIucG9pbnRUb0xvY2FsRnJhbWUoaGFsZldheSwgcGl2b3RCKTsKICAgICAgYm9keUEucG9pbnRUb0xvY2FsRnJhbWUoaGFsZldheSwgcGl2b3RBKTsgLy8gVGhlIHBvaW50LXRvLXBvaW50IGNvbnN0cmFpbnQgd2lsbCBrZWVwIGEgcG9pbnQgc2hhcmVkIGJldHdlZW4gdGhlIGJvZGllcwoKICAgICAgc3VwZXIoYm9keUEsIHBpdm90QSwgYm9keUIsIHBpdm90QiwgbWF4Rm9yY2UpOyAvLyBTdG9yZSBpbml0aWFsIHJvdGF0aW9uIG9mIHRoZSBib2RpZXMgYXMgdW5pdCB2ZWN0b3JzIGluIHRoZSBsb2NhbCBib2R5IHNwYWNlcwoKICAgICAgdGhpcy54QSA9IGJvZHlBLnZlY3RvclRvTG9jYWxGcmFtZShWZWMzLlVOSVRfWCk7CiAgICAgIHRoaXMueEIgPSBib2R5Qi52ZWN0b3JUb0xvY2FsRnJhbWUoVmVjMy5VTklUX1gpOwogICAgICB0aGlzLnlBID0gYm9keUEudmVjdG9yVG9Mb2NhbEZyYW1lKFZlYzMuVU5JVF9ZKTsKICAgICAgdGhpcy55QiA9IGJvZHlCLnZlY3RvclRvTG9jYWxGcmFtZShWZWMzLlVOSVRfWSk7CiAgICAgIHRoaXMuekEgPSBib2R5QS52ZWN0b3JUb0xvY2FsRnJhbWUoVmVjMy5VTklUX1opOwogICAgICB0aGlzLnpCID0gYm9keUIudmVjdG9yVG9Mb2NhbEZyYW1lKFZlYzMuVU5JVF9aKTsgLy8gLi4uYW5kIHRoZSBmb2xsb3dpbmcgcm90YXRpb25hbCBlcXVhdGlvbnMgd2lsbCBrZWVwIGFsbCByb3RhdGlvbmFsIERPRidzIGluIHBsYWNlCgogICAgICBjb25zdCByMSA9IHRoaXMucm90YXRpb25hbEVxdWF0aW9uMSA9IG5ldyBSb3RhdGlvbmFsRXF1YXRpb24oYm9keUEsIGJvZHlCLCBvcHRpb25zKTsKICAgICAgY29uc3QgcjIgPSB0aGlzLnJvdGF0aW9uYWxFcXVhdGlvbjIgPSBuZXcgUm90YXRpb25hbEVxdWF0aW9uKGJvZHlBLCBib2R5Qiwgb3B0aW9ucyk7CiAgICAgIGNvbnN0IHIzID0gdGhpcy5yb3RhdGlvbmFsRXF1YXRpb24zID0gbmV3IFJvdGF0aW9uYWxFcXVhdGlvbihib2R5QSwgYm9keUIsIG9wdGlvbnMpOwogICAgICB0aGlzLmVxdWF0aW9ucy5wdXNoKHIxLCByMiwgcjMpOwogICAgfQogICAgLyoqCiAgICAgKiB1cGRhdGUKICAgICAqLwoKCiAgICB1cGRhdGUoKSB7CiAgICAgIGNvbnN0IGJvZHlBID0gdGhpcy5ib2R5QTsKICAgICAgY29uc3QgYm9keUIgPSB0aGlzLmJvZHlCOwogICAgICB0aGlzLm1vdG9yRXF1YXRpb247CiAgICAgIGNvbnN0IHIxID0gdGhpcy5yb3RhdGlvbmFsRXF1YXRpb24xOwogICAgICBjb25zdCByMiA9IHRoaXMucm90YXRpb25hbEVxdWF0aW9uMjsKICAgICAgY29uc3QgcjMgPSB0aGlzLnJvdGF0aW9uYWxFcXVhdGlvbjM7CiAgICAgIHN1cGVyLnVwZGF0ZSgpOyAvLyBUaGVzZSB2ZWN0b3IgcGFpcnMgbXVzdCBiZSBvcnRob2dvbmFsCgogICAgICBib2R5QS52ZWN0b3JUb1dvcmxkRnJhbWUodGhpcy54QSwgcjEuYXhpc0EpOwogICAgICBib2R5Qi52ZWN0b3JUb1dvcmxkRnJhbWUodGhpcy55QiwgcjEuYXhpc0IpOwogICAgICBib2R5QS52ZWN0b3JUb1dvcmxkRnJhbWUodGhpcy55QSwgcjIuYXhpc0EpOwogICAgICBib2R5Qi52ZWN0b3JUb1dvcmxkRnJhbWUodGhpcy56QiwgcjIuYXhpc0IpOwogICAgICBib2R5QS52ZWN0b3JUb1dvcmxkRnJhbWUodGhpcy56QSwgcjMuYXhpc0EpOwogICAgICBib2R5Qi52ZWN0b3JUb1dvcmxkRnJhbWUodGhpcy54QiwgcjMuYXhpc0IpOwogICAgfQoKICB9CiAgbmV3IFZlYzMoKTsKICBuZXcgVmVjMygpOwoKICAvKioKICAgKiBSb3RhdGlvbmFsIG1vdG9yIGNvbnN0cmFpbnQuIFRyaWVzIHRvIGtlZXAgdGhlIHJlbGF0aXZlIGFuZ3VsYXIgdmVsb2NpdHkgb2YgdGhlIGJvZGllcyB0byBhIGdpdmVuIHZhbHVlLgogICAqLwogIGNsYXNzIFJvdGF0aW9uYWxNb3RvckVxdWF0aW9uIGV4dGVuZHMgRXF1YXRpb24gewogICAgLyoqCiAgICAgKiBXb3JsZCBvcmllbnRlZCByb3RhdGlvbmFsIGF4aXMuCiAgICAgKi8KCiAgICAvKioKICAgICAqIFdvcmxkIG9yaWVudGVkIHJvdGF0aW9uYWwgYXhpcy4KICAgICAqLwoKICAgIC8qKgogICAgICogTW90b3IgdmVsb2NpdHkuCiAgICAgKi8KICAgIGNvbnN0cnVjdG9yKGJvZHlBLCBib2R5QiwgbWF4Rm9yY2UpIHsKICAgICAgaWYgKG1heEZvcmNlID09PSB2b2lkIDApIHsKICAgICAgICBtYXhGb3JjZSA9IDFlNjsKICAgICAgfQoKICAgICAgc3VwZXIoYm9keUEsIGJvZHlCLCAtbWF4Rm9yY2UsIG1heEZvcmNlKTsKICAgICAgdGhpcy5heGlzQSA9IG5ldyBWZWMzKCk7CiAgICAgIHRoaXMuYXhpc0IgPSBuZXcgVmVjMygpOwogICAgICB0aGlzLnRhcmdldFZlbG9jaXR5ID0gMDsKICAgIH0KCiAgICBjb21wdXRlQihoKSB7CiAgICAgIHRoaXMuYTsKICAgICAgY29uc3QgYiA9IHRoaXMuYjsKICAgICAgdGhpcy5iaTsKICAgICAgdGhpcy5iajsKICAgICAgY29uc3QgYXhpc0EgPSB0aGlzLmF4aXNBOwogICAgICBjb25zdCBheGlzQiA9IHRoaXMuYXhpc0I7CiAgICAgIGNvbnN0IEdBID0gdGhpcy5qYWNvYmlhbkVsZW1lbnRBOwogICAgICBjb25zdCBHQiA9IHRoaXMuamFjb2JpYW5FbGVtZW50QjsgLy8gZyA9IDAKICAgICAgLy8gZ2RvdCA9IGF4aXNBICogd2kgLSBheGlzQiAqIHdqCiAgICAgIC8vIGdkb3QgPSBHICogVyA9IEcgKiBbdmkgd2kgdmogd2pdCiAgICAgIC8vID0+CiAgICAgIC8vIEcgPSBbMCBheGlzQSAwIC1heGlzQl0KCiAgICAgIEdBLnJvdGF0aW9uYWwuY29weShheGlzQSk7CiAgICAgIGF4aXNCLm5lZ2F0ZShHQi5yb3RhdGlvbmFsKTsKICAgICAgY29uc3QgR1cgPSB0aGlzLmNvbXB1dGVHVygpIC0gdGhpcy50YXJnZXRWZWxvY2l0eTsKICAgICAgY29uc3QgR2lNZiA9IHRoaXMuY29tcHV0ZUdpTWYoKTsKICAgICAgY29uc3QgQiA9IC1HVyAqIGIgLSBoICogR2lNZjsKICAgICAgcmV0dXJuIEI7CiAgICB9CgogIH0KCiAgLyoqCiAgICogSGluZ2UgY29uc3RyYWludC4gVGhpbmsgb2YgaXQgYXMgYSBkb29yIGhpbmdlLiBJdCB0cmllcyB0byBrZWVwIHRoZSBkb29yIGluIHRoZSBjb3JyZWN0IHBsYWNlIGFuZCB3aXRoIHRoZSBjb3JyZWN0IG9yaWVudGF0aW9uLgogICAqLwogIGNsYXNzIEhpbmdlQ29uc3RyYWludCBleHRlbmRzIFBvaW50VG9Qb2ludENvbnN0cmFpbnQgewogICAgLyoqCiAgICAgKiBSb3RhdGlvbiBheGlzLCBkZWZpbmVkIGxvY2FsbHkgaW4gYm9keUEuCiAgICAgKi8KCiAgICAvKioKICAgICAqIFJvdGF0aW9uIGF4aXMsIGRlZmluZWQgbG9jYWxseSBpbiBib2R5Qi4KICAgICAqLwogICAgY29uc3RydWN0b3IoYm9keUEsIGJvZHlCLCBvcHRpb25zKSB7CiAgICAgIGlmIChvcHRpb25zID09PSB2b2lkIDApIHsKICAgICAgICBvcHRpb25zID0ge307CiAgICAgIH0KCiAgICAgIGNvbnN0IG1heEZvcmNlID0gdHlwZW9mIG9wdGlvbnMubWF4Rm9yY2UgIT09ICd1bmRlZmluZWQnID8gb3B0aW9ucy5tYXhGb3JjZSA6IDFlNjsKICAgICAgY29uc3QgcGl2b3RBID0gb3B0aW9ucy5waXZvdEEgPyBvcHRpb25zLnBpdm90QS5jbG9uZSgpIDogbmV3IFZlYzMoKTsKICAgICAgY29uc3QgcGl2b3RCID0gb3B0aW9ucy5waXZvdEIgPyBvcHRpb25zLnBpdm90Qi5jbG9uZSgpIDogbmV3IFZlYzMoKTsKICAgICAgc3VwZXIoYm9keUEsIHBpdm90QSwgYm9keUIsIHBpdm90QiwgbWF4Rm9yY2UpOwogICAgICBjb25zdCBheGlzQSA9IHRoaXMuYXhpc0EgPSBvcHRpb25zLmF4aXNBID8gb3B0aW9ucy5heGlzQS5jbG9uZSgpIDogbmV3IFZlYzMoMSwgMCwgMCk7CiAgICAgIGF4aXNBLm5vcm1hbGl6ZSgpOwogICAgICBjb25zdCBheGlzQiA9IHRoaXMuYXhpc0IgPSBvcHRpb25zLmF4aXNCID8gb3B0aW9ucy5heGlzQi5jbG9uZSgpIDogbmV3IFZlYzMoMSwgMCwgMCk7CiAgICAgIGF4aXNCLm5vcm1hbGl6ZSgpOwogICAgICB0aGlzLmNvbGxpZGVDb25uZWN0ZWQgPSAhIW9wdGlvbnMuY29sbGlkZUNvbm5lY3RlZDsKICAgICAgY29uc3Qgcm90YXRpb25hbDEgPSB0aGlzLnJvdGF0aW9uYWxFcXVhdGlvbjEgPSBuZXcgUm90YXRpb25hbEVxdWF0aW9uKGJvZHlBLCBib2R5Qiwgb3B0aW9ucyk7CiAgICAgIGNvbnN0IHJvdGF0aW9uYWwyID0gdGhpcy5yb3RhdGlvbmFsRXF1YXRpb24yID0gbmV3IFJvdGF0aW9uYWxFcXVhdGlvbihib2R5QSwgYm9keUIsIG9wdGlvbnMpOwogICAgICBjb25zdCBtb3RvciA9IHRoaXMubW90b3JFcXVhdGlvbiA9IG5ldyBSb3RhdGlvbmFsTW90b3JFcXVhdGlvbihib2R5QSwgYm9keUIsIG1heEZvcmNlKTsKICAgICAgbW90b3IuZW5hYmxlZCA9IGZhbHNlOyAvLyBOb3QgZW5hYmxlZCBieSBkZWZhdWx0CiAgICAgIC8vIEVxdWF0aW9ucyB0byBiZSBmZWQgdG8gdGhlIHNvbHZlcgoKICAgICAgdGhpcy5lcXVhdGlvbnMucHVzaChyb3RhdGlvbmFsMSwgcm90YXRpb25hbDIsIG1vdG9yKTsKICAgIH0KICAgIC8qKgogICAgICogZW5hYmxlTW90b3IKICAgICAqLwoKCiAgICBlbmFibGVNb3RvcigpIHsKICAgICAgdGhpcy5tb3RvckVxdWF0aW9uLmVuYWJsZWQgPSB0cnVlOwogICAgfQogICAgLyoqCiAgICAgKiBkaXNhYmxlTW90b3IKICAgICAqLwoKCiAgICBkaXNhYmxlTW90b3IoKSB7CiAgICAgIHRoaXMubW90b3JFcXVhdGlvbi5lbmFibGVkID0gZmFsc2U7CiAgICB9CiAgICAvKioKICAgICAqIHNldE1vdG9yU3BlZWQKICAgICAqLwoKCiAgICBzZXRNb3RvclNwZWVkKHNwZWVkKSB7CiAgICAgIHRoaXMubW90b3JFcXVhdGlvbi50YXJnZXRWZWxvY2l0eSA9IHNwZWVkOwogICAgfQogICAgLyoqCiAgICAgKiBzZXRNb3Rvck1heEZvcmNlCiAgICAgKi8KCgogICAgc2V0TW90b3JNYXhGb3JjZShtYXhGb3JjZSkgewogICAgICB0aGlzLm1vdG9yRXF1YXRpb24ubWF4Rm9yY2UgPSBtYXhGb3JjZTsKICAgICAgdGhpcy5tb3RvckVxdWF0aW9uLm1pbkZvcmNlID0gLW1heEZvcmNlOwogICAgfQogICAgLyoqCiAgICAgKiB1cGRhdGUKICAgICAqLwoKCiAgICB1cGRhdGUoKSB7CiAgICAgIGNvbnN0IGJvZHlBID0gdGhpcy5ib2R5QTsKICAgICAgY29uc3QgYm9keUIgPSB0aGlzLmJvZHlCOwogICAgICBjb25zdCBtb3RvciA9IHRoaXMubW90b3JFcXVhdGlvbjsKICAgICAgY29uc3QgcjEgPSB0aGlzLnJvdGF0aW9uYWxFcXVhdGlvbjE7CiAgICAgIGNvbnN0IHIyID0gdGhpcy5yb3RhdGlvbmFsRXF1YXRpb24yOwogICAgICBjb25zdCB3b3JsZEF4aXNBID0gSGluZ2VDb25zdHJhaW50X3VwZGF0ZV90bXBWZWMxOwogICAgICBjb25zdCB3b3JsZEF4aXNCID0gSGluZ2VDb25zdHJhaW50X3VwZGF0ZV90bXBWZWMyOwogICAgICBjb25zdCBheGlzQSA9IHRoaXMuYXhpc0E7CiAgICAgIGNvbnN0IGF4aXNCID0gdGhpcy5heGlzQjsKICAgICAgc3VwZXIudXBkYXRlKCk7IC8vIEdldCB3b3JsZCBheGVzCgogICAgICBib2R5QS5xdWF0ZXJuaW9uLnZtdWx0KGF4aXNBLCB3b3JsZEF4aXNBKTsKICAgICAgYm9keUIucXVhdGVybmlvbi52bXVsdChheGlzQiwgd29ybGRBeGlzQik7CiAgICAgIHdvcmxkQXhpc0EudGFuZ2VudHMocjEuYXhpc0EsIHIyLmF4aXNBKTsKICAgICAgcjEuYXhpc0IuY29weSh3b3JsZEF4aXNCKTsKICAgICAgcjIuYXhpc0IuY29weSh3b3JsZEF4aXNCKTsKCiAgICAgIGlmICh0aGlzLm1vdG9yRXF1YXRpb24uZW5hYmxlZCkgewogICAgICAgIGJvZHlBLnF1YXRlcm5pb24udm11bHQodGhpcy5heGlzQSwgbW90b3IuYXhpc0EpOwogICAgICAgIGJvZHlCLnF1YXRlcm5pb24udm11bHQodGhpcy5heGlzQiwgbW90b3IuYXhpc0IpOwogICAgICB9CiAgICB9CgogIH0KICBjb25zdCBIaW5nZUNvbnN0cmFpbnRfdXBkYXRlX3RtcFZlYzEgPSBuZXcgVmVjMygpOwogIGNvbnN0IEhpbmdlQ29uc3RyYWludF91cGRhdGVfdG1wVmVjMiA9IG5ldyBWZWMzKCk7CgogIC8qKgogICAqIENvbnN0cmFpbnMgdGhlIHNsaXBwaW5nIGluIGEgY29udGFjdCBhbG9uZyBhIHRhbmdlbnQKICAgKi8KICBjbGFzcyBGcmljdGlvbkVxdWF0aW9uIGV4dGVuZHMgRXF1YXRpb24gewogICAgLy8gVGFuZ2VudAoKICAgIC8qKgogICAgICogQHBhcmFtIHNsaXBGb3JjZSBzaG91bGQgYmUgKy1GX2ZyaWN0aW9uID0gKy1tdSAqIEZfbm9ybWFsID0gKy1tdSAqIG0gKiBnCiAgICAgKi8KICAgIGNvbnN0cnVjdG9yKGJvZHlBLCBib2R5Qiwgc2xpcEZvcmNlKSB7CiAgICAgIHN1cGVyKGJvZHlBLCBib2R5QiwgLXNsaXBGb3JjZSwgc2xpcEZvcmNlKTsKICAgICAgdGhpcy5yaSA9IG5ldyBWZWMzKCk7CiAgICAgIHRoaXMucmogPSBuZXcgVmVjMygpOwogICAgICB0aGlzLnQgPSBuZXcgVmVjMygpOwogICAgfQoKICAgIGNvbXB1dGVCKGgpIHsKICAgICAgdGhpcy5hOwogICAgICBjb25zdCBiID0gdGhpcy5iOwogICAgICB0aGlzLmJpOwogICAgICB0aGlzLmJqOwogICAgICBjb25zdCByaSA9IHRoaXMucmk7CiAgICAgIGNvbnN0IHJqID0gdGhpcy5yajsKICAgICAgY29uc3Qgcml4dCA9IEZyaWN0aW9uRXF1YXRpb25fY29tcHV0ZUJfdGVtcDE7CiAgICAgIGNvbnN0IHJqeHQgPSBGcmljdGlvbkVxdWF0aW9uX2NvbXB1dGVCX3RlbXAyOwogICAgICBjb25zdCB0ID0gdGhpcy50OyAvLyBDYWx1Y2xhdGUgY3Jvc3MgcHJvZHVjdHMKCiAgICAgIHJpLmNyb3NzKHQsIHJpeHQpOwogICAgICByai5jcm9zcyh0LCByanh0KTsgLy8gRyA9IFstdCAtcml4dCB0IHJqeHRdCiAgICAgIC8vIEFuZCByZW1lbWJlciwgdGhpcyBpcyBhIHB1cmUgdmVsb2NpdHkgY29uc3RyYWludCwgZyBpcyBhbHdheXMgemVybyEKCiAgICAgIGNvbnN0IEdBID0gdGhpcy5qYWNvYmlhbkVsZW1lbnRBOwogICAgICBjb25zdCBHQiA9IHRoaXMuamFjb2JpYW5FbGVtZW50QjsKICAgICAgdC5uZWdhdGUoR0Euc3BhdGlhbCk7CiAgICAgIHJpeHQubmVnYXRlKEdBLnJvdGF0aW9uYWwpOwogICAgICBHQi5zcGF0aWFsLmNvcHkodCk7CiAgICAgIEdCLnJvdGF0aW9uYWwuY29weShyanh0KTsKICAgICAgY29uc3QgR1cgPSB0aGlzLmNvbXB1dGVHVygpOwogICAgICBjb25zdCBHaU1mID0gdGhpcy5jb21wdXRlR2lNZigpOwogICAgICBjb25zdCBCID0gLUdXICogYiAtIGggKiBHaU1mOwogICAgICByZXR1cm4gQjsKICAgIH0KCiAgfQogIGNvbnN0IEZyaWN0aW9uRXF1YXRpb25fY29tcHV0ZUJfdGVtcDEgPSBuZXcgVmVjMygpOwogIGNvbnN0IEZyaWN0aW9uRXF1YXRpb25fY29tcHV0ZUJfdGVtcDIgPSBuZXcgVmVjMygpOwoKICAvKioKICAgKiBEZWZpbmVzIHdoYXQgaGFwcGVucyB3aGVuIHR3byBtYXRlcmlhbHMgbWVldC4KICAgKiBAdG9kbyBSZWZhY3RvciBtYXRlcmlhbHMgdG8gbWF0ZXJpYWxBIGFuZCBtYXRlcmlhbEIKICAgKi8KICBjbGFzcyBDb250YWN0TWF0ZXJpYWwgewogICAgLyoqCiAgICAgKiBJZGVudGlmaWVyIG9mIHRoaXMgbWF0ZXJpYWwuCiAgICAgKi8KCiAgICAvKioKICAgICAqIFBhcnRpY2lwYXRpbmcgbWF0ZXJpYWxzLgogICAgICovCgogICAgLyoqCiAgICAgKiBGcmljdGlvbiBjb2VmZmljaWVudC4KICAgICAqIEBkZWZhdWx0IDAuMwogICAgICovCgogICAgLyoqCiAgICAgKiBSZXN0aXR1dGlvbiBjb2VmZmljaWVudC4KICAgICAqIEBkZWZhdWx0IDAuMwogICAgICovCgogICAgLyoqCiAgICAgKiBTdGlmZm5lc3Mgb2YgdGhlIHByb2R1Y2VkIGNvbnRhY3QgZXF1YXRpb25zLgogICAgICogQGRlZmF1bHQgMWU3CiAgICAgKi8KCiAgICAvKioKICAgICAqIFJlbGF4YXRpb24gdGltZSBvZiB0aGUgcHJvZHVjZWQgY29udGFjdCBlcXVhdGlvbnMuCiAgICAgKiBAZGVmYXVsdCAzCiAgICAgKi8KCiAgICAvKioKICAgICAqIFN0aWZmbmVzcyBvZiB0aGUgcHJvZHVjZWQgZnJpY3Rpb24gZXF1YXRpb25zLgogICAgICogQGRlZmF1bHQgMWU3CiAgICAgKi8KCiAgICAvKioKICAgICAqIFJlbGF4YXRpb24gdGltZSBvZiB0aGUgcHJvZHVjZWQgZnJpY3Rpb24gZXF1YXRpb25zCiAgICAgKiBAZGVmYXVsdCAzCiAgICAgKi8KICAgIGNvbnN0cnVjdG9yKG0xLCBtMiwgb3B0aW9ucykgewogICAgICBvcHRpb25zID0gVXRpbHMuZGVmYXVsdHMob3B0aW9ucywgewogICAgICAgIGZyaWN0aW9uOiAwLjMsCiAgICAgICAgcmVzdGl0dXRpb246IDAuMywKICAgICAgICBjb250YWN0RXF1YXRpb25TdGlmZm5lc3M6IDFlNywKICAgICAgICBjb250YWN0RXF1YXRpb25SZWxheGF0aW9uOiAzLAogICAgICAgIGZyaWN0aW9uRXF1YXRpb25TdGlmZm5lc3M6IDFlNywKICAgICAgICBmcmljdGlvbkVxdWF0aW9uUmVsYXhhdGlvbjogMwogICAgICB9KTsKICAgICAgdGhpcy5pZCA9IENvbnRhY3RNYXRlcmlhbC5pZENvdW50ZXIrKzsKICAgICAgdGhpcy5tYXRlcmlhbHMgPSBbbTEsIG0yXTsKICAgICAgdGhpcy5mcmljdGlvbiA9IG9wdGlvbnMuZnJpY3Rpb247CiAgICAgIHRoaXMucmVzdGl0dXRpb24gPSBvcHRpb25zLnJlc3RpdHV0aW9uOwogICAgICB0aGlzLmNvbnRhY3RFcXVhdGlvblN0aWZmbmVzcyA9IG9wdGlvbnMuY29udGFjdEVxdWF0aW9uU3RpZmZuZXNzOwogICAgICB0aGlzLmNvbnRhY3RFcXVhdGlvblJlbGF4YXRpb24gPSBvcHRpb25zLmNvbnRhY3RFcXVhdGlvblJlbGF4YXRpb247CiAgICAgIHRoaXMuZnJpY3Rpb25FcXVhdGlvblN0aWZmbmVzcyA9IG9wdGlvbnMuZnJpY3Rpb25FcXVhdGlvblN0aWZmbmVzczsKICAgICAgdGhpcy5mcmljdGlvbkVxdWF0aW9uUmVsYXhhdGlvbiA9IG9wdGlvbnMuZnJpY3Rpb25FcXVhdGlvblJlbGF4YXRpb247CiAgICB9CgogIH0KICBDb250YWN0TWF0ZXJpYWwuaWRDb3VudGVyID0gMDsKCiAgLyoqCiAgICogRGVmaW5lcyBhIHBoeXNpY3MgbWF0ZXJpYWwuCiAgICovCiAgY2xhc3MgTWF0ZXJpYWwgewogICAgLyoqCiAgICAgKiBNYXRlcmlhbCBuYW1lLgogICAgICogSWYgb3B0aW9ucyBpcyBhIHN0cmluZywgbmFtZSB3aWxsIGJlIHNldCB0byB0aGF0IHN0cmluZy4KICAgICAqIEB0b2RvIERlcHJlY2F0ZSB0aGlzCiAgICAgKi8KCiAgICAvKiogTWF0ZXJpYWwgaWQuICovCgogICAgLyoqCiAgICAgKiBGcmljdGlvbiBmb3IgdGhpcyBtYXRlcmlhbC4KICAgICAqIElmIG5vbi1uZWdhdGl2ZSwgaXQgd2lsbCBiZSB1c2VkIGluc3RlYWQgb2YgdGhlIGZyaWN0aW9uIGdpdmVuIGJ5IENvbnRhY3RNYXRlcmlhbHMuIElmIHRoZXJlJ3Mgbm8gbWF0Y2hpbmcgQ29udGFjdE1hdGVyaWFsLCB0aGUgdmFsdWUgZnJvbSBgZGVmYXVsdENvbnRhY3RNYXRlcmlhbGAgaW4gdGhlIFdvcmxkIHdpbGwgYmUgdXNlZC4KICAgICAqLwoKICAgIC8qKgogICAgICogUmVzdGl0dXRpb24gZm9yIHRoaXMgbWF0ZXJpYWwuCiAgICAgKiBJZiBub24tbmVnYXRpdmUsIGl0IHdpbGwgYmUgdXNlZCBpbnN0ZWFkIG9mIHRoZSByZXN0aXR1dGlvbiBnaXZlbiBieSBDb250YWN0TWF0ZXJpYWxzLiBJZiB0aGVyZSdzIG5vIG1hdGNoaW5nIENvbnRhY3RNYXRlcmlhbCwgdGhlIHZhbHVlIGZyb20gYGRlZmF1bHRDb250YWN0TWF0ZXJpYWxgIGluIHRoZSBXb3JsZCB3aWxsIGJlIHVzZWQuCiAgICAgKi8KICAgIGNvbnN0cnVjdG9yKG9wdGlvbnMpIHsKICAgICAgaWYgKG9wdGlvbnMgPT09IHZvaWQgMCkgewogICAgICAgIG9wdGlvbnMgPSB7fTsKICAgICAgfQoKICAgICAgbGV0IG5hbWUgPSAnJzsgLy8gQmFja3dhcmRzIGNvbXBhdGliaWxpdHkgZml4CgogICAgICBpZiAodHlwZW9mIG9wdGlvbnMgPT09ICdzdHJpbmcnKSB7CiAgICAgICAgLy9jb25zb2xlLndhcm4oYFBhc3NpbmcgYSBzdHJpbmcgdG8gTWF0ZXJpYWxPcHRpb25zIGlzIGRlcHJlY2F0ZWQsIGFuZCBoYXMgbm8gZWZmZWN0YCkKICAgICAgICBuYW1lID0gb3B0aW9uczsKICAgICAgICBvcHRpb25zID0ge307CiAgICAgIH0KCiAgICAgIHRoaXMubmFtZSA9IG5hbWU7CiAgICAgIHRoaXMuaWQgPSBNYXRlcmlhbC5pZENvdW50ZXIrKzsKICAgICAgdGhpcy5mcmljdGlvbiA9IHR5cGVvZiBvcHRpb25zLmZyaWN0aW9uICE9PSAndW5kZWZpbmVkJyA/IG9wdGlvbnMuZnJpY3Rpb24gOiAtMTsKICAgICAgdGhpcy5yZXN0aXR1dGlvbiA9IHR5cGVvZiBvcHRpb25zLnJlc3RpdHV0aW9uICE9PSAndW5kZWZpbmVkJyA/IG9wdGlvbnMucmVzdGl0dXRpb24gOiAtMTsKICAgIH0KCiAgfQogIE1hdGVyaWFsLmlkQ291bnRlciA9IDA7CgogIC8qKgogICAqIEEgc3ByaW5nLCBjb25uZWN0aW5nIHR3byBib2RpZXMuCiAgICogQGV4YW1wbGUKICAgKiAgICAgY29uc3Qgc3ByaW5nID0gbmV3IFNwcmluZyhib3hCb2R5LCBzcGhlcmVCb2R5LCB7CiAgICogICAgICAgcmVzdExlbmd0aDogMCwKICAgKiAgICAgICBzdGlmZm5lc3M6IDUwLAogICAqICAgICAgIGRhbXBpbmc6IDEsCiAgICogICAgIH0pCiAgICoKICAgKiAgICAgLy8gQ29tcHV0ZSB0aGUgZm9yY2UgYWZ0ZXIgZWFjaCBzdGVwCiAgICogICAgIHdvcmxkLmFkZEV2ZW50TGlzdGVuZXIoJ3Bvc3RTdGVwJywgKGV2ZW50KSA9PiB7CiAgICogICAgICAgc3ByaW5nLmFwcGx5Rm9yY2UoKQogICAqICAgICB9KQogICAqLwogIGNsYXNzIFNwcmluZyB7CiAgICAvKioKICAgICAqIFJlc3QgbGVuZ3RoIG9mIHRoZSBzcHJpbmcuIEEgbnVtYmVyID4gMC4KICAgICAqIEBkZWZhdWx0IDEKICAgICAqLwoKICAgIC8qKgogICAgICogU3RpZmZuZXNzIG9mIHRoZSBzcHJpbmcuIEEgbnVtYmVyID49IDAuCiAgICAgKiBAZGVmYXVsdCAxMDAKICAgICAqLwoKICAgIC8qKgogICAgICogRGFtcGluZyBvZiB0aGUgc3ByaW5nLiBBIG51bWJlciA+PSAwLgogICAgICogQGRlZmF1bHQgMQogICAgICovCgogICAgLyoqCiAgICAgKiBGaXJzdCBjb25uZWN0ZWQgYm9keS4KICAgICAqLwoKICAgIC8qKgogICAgICogU2Vjb25kIGNvbm5lY3RlZCBib2R5LgogICAgICovCgogICAgLyoqCiAgICAgKiBBbmNob3IgZm9yIGJvZHlBIGluIGxvY2FsIGJvZHlBIGNvb3JkaW5hdGVzLgogICAgICogV2hlcmUgdG8gaG9vayB0aGUgc3ByaW5nIHRvIGJvZHkgQSwgaW4gbG9jYWwgYm9keSBjb29yZGluYXRlcy4KICAgICAqIEBkZWZhdWx0IG5ldyBWZWMzKCkKICAgICAqLwoKICAgIC8qKgogICAgICogQW5jaG9yIGZvciBib2R5QiBpbiBsb2NhbCBib2R5QiBjb29yZGluYXRlcy4KICAgICAqIFdoZXJlIHRvIGhvb2sgdGhlIHNwcmluZyB0byBib2R5IEIsIGluIGxvY2FsIGJvZHkgY29vcmRpbmF0ZXMuCiAgICAgKiBAZGVmYXVsdCBuZXcgVmVjMygpCiAgICAgKi8KICAgIGNvbnN0cnVjdG9yKGJvZHlBLCBib2R5Qiwgb3B0aW9ucykgewogICAgICBpZiAob3B0aW9ucyA9PT0gdm9pZCAwKSB7CiAgICAgICAgb3B0aW9ucyA9IHt9OwogICAgICB9CgogICAgICB0aGlzLnJlc3RMZW5ndGggPSB0eXBlb2Ygb3B0aW9ucy5yZXN0TGVuZ3RoID09PSAnbnVtYmVyJyA/IG9wdGlvbnMucmVzdExlbmd0aCA6IDE7CiAgICAgIHRoaXMuc3RpZmZuZXNzID0gb3B0aW9ucy5zdGlmZm5lc3MgfHwgMTAwOwogICAgICB0aGlzLmRhbXBpbmcgPSBvcHRpb25zLmRhbXBpbmcgfHwgMTsKICAgICAgdGhpcy5ib2R5QSA9IGJvZHlBOwogICAgICB0aGlzLmJvZHlCID0gYm9keUI7CiAgICAgIHRoaXMubG9jYWxBbmNob3JBID0gbmV3IFZlYzMoKTsKICAgICAgdGhpcy5sb2NhbEFuY2hvckIgPSBuZXcgVmVjMygpOwoKICAgICAgaWYgKG9wdGlvbnMubG9jYWxBbmNob3JBKSB7CiAgICAgICAgdGhpcy5sb2NhbEFuY2hvckEuY29weShvcHRpb25zLmxvY2FsQW5jaG9yQSk7CiAgICAgIH0KCiAgICAgIGlmIChvcHRpb25zLmxvY2FsQW5jaG9yQikgewogICAgICAgIHRoaXMubG9jYWxBbmNob3JCLmNvcHkob3B0aW9ucy5sb2NhbEFuY2hvckIpOwogICAgICB9CgogICAgICBpZiAob3B0aW9ucy53b3JsZEFuY2hvckEpIHsKICAgICAgICB0aGlzLnNldFdvcmxkQW5jaG9yQShvcHRpb25zLndvcmxkQW5jaG9yQSk7CiAgICAgIH0KCiAgICAgIGlmIChvcHRpb25zLndvcmxkQW5jaG9yQikgewogICAgICAgIHRoaXMuc2V0V29ybGRBbmNob3JCKG9wdGlvbnMud29ybGRBbmNob3JCKTsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBTZXQgdGhlIGFuY2hvciBwb2ludCBvbiBib2R5IEEsIHVzaW5nIHdvcmxkIGNvb3JkaW5hdGVzLgogICAgICovCgoKICAgIHNldFdvcmxkQW5jaG9yQSh3b3JsZEFuY2hvckEpIHsKICAgICAgdGhpcy5ib2R5QS5wb2ludFRvTG9jYWxGcmFtZSh3b3JsZEFuY2hvckEsIHRoaXMubG9jYWxBbmNob3JBKTsKICAgIH0KICAgIC8qKgogICAgICogU2V0IHRoZSBhbmNob3IgcG9pbnQgb24gYm9keSBCLCB1c2luZyB3b3JsZCBjb29yZGluYXRlcy4KICAgICAqLwoKCiAgICBzZXRXb3JsZEFuY2hvckIod29ybGRBbmNob3JCKSB7CiAgICAgIHRoaXMuYm9keUIucG9pbnRUb0xvY2FsRnJhbWUod29ybGRBbmNob3JCLCB0aGlzLmxvY2FsQW5jaG9yQik7CiAgICB9CiAgICAvKioKICAgICAqIEdldCB0aGUgYW5jaG9yIHBvaW50IG9uIGJvZHkgQSwgaW4gd29ybGQgY29vcmRpbmF0ZXMuCiAgICAgKiBAcGFyYW0gcmVzdWx0IFRoZSB2ZWN0b3IgdG8gc3RvcmUgdGhlIHJlc3VsdCBpbi4KICAgICAqLwoKCiAgICBnZXRXb3JsZEFuY2hvckEocmVzdWx0KSB7CiAgICAgIHRoaXMuYm9keUEucG9pbnRUb1dvcmxkRnJhbWUodGhpcy5sb2NhbEFuY2hvckEsIHJlc3VsdCk7CiAgICB9CiAgICAvKioKICAgICAqIEdldCB0aGUgYW5jaG9yIHBvaW50IG9uIGJvZHkgQiwgaW4gd29ybGQgY29vcmRpbmF0ZXMuCiAgICAgKiBAcGFyYW0gcmVzdWx0IFRoZSB2ZWN0b3IgdG8gc3RvcmUgdGhlIHJlc3VsdCBpbi4KICAgICAqLwoKCiAgICBnZXRXb3JsZEFuY2hvckIocmVzdWx0KSB7CiAgICAgIHRoaXMuYm9keUIucG9pbnRUb1dvcmxkRnJhbWUodGhpcy5sb2NhbEFuY2hvckIsIHJlc3VsdCk7CiAgICB9CiAgICAvKioKICAgICAqIEFwcGx5IHRoZSBzcHJpbmcgZm9yY2UgdG8gdGhlIGNvbm5lY3RlZCBib2RpZXMuCiAgICAgKi8KCgogICAgYXBwbHlGb3JjZSgpIHsKICAgICAgY29uc3QgayA9IHRoaXMuc3RpZmZuZXNzOwogICAgICBjb25zdCBkID0gdGhpcy5kYW1waW5nOwogICAgICBjb25zdCBsID0gdGhpcy5yZXN0TGVuZ3RoOwogICAgICBjb25zdCBib2R5QSA9IHRoaXMuYm9keUE7CiAgICAgIGNvbnN0IGJvZHlCID0gdGhpcy5ib2R5QjsKICAgICAgY29uc3QgciA9IGFwcGx5Rm9yY2VfcjsKICAgICAgY29uc3Qgcl91bml0ID0gYXBwbHlGb3JjZV9yX3VuaXQ7CiAgICAgIGNvbnN0IHUgPSBhcHBseUZvcmNlX3U7CiAgICAgIGNvbnN0IGYgPSBhcHBseUZvcmNlX2Y7CiAgICAgIGNvbnN0IHRtcCA9IGFwcGx5Rm9yY2VfdG1wOwogICAgICBjb25zdCB3b3JsZEFuY2hvckEgPSBhcHBseUZvcmNlX3dvcmxkQW5jaG9yQTsKICAgICAgY29uc3Qgd29ybGRBbmNob3JCID0gYXBwbHlGb3JjZV93b3JsZEFuY2hvckI7CiAgICAgIGNvbnN0IHJpID0gYXBwbHlGb3JjZV9yaTsKICAgICAgY29uc3QgcmogPSBhcHBseUZvcmNlX3JqOwogICAgICBjb25zdCByaV94X2YgPSBhcHBseUZvcmNlX3JpX3hfZjsKICAgICAgY29uc3QgcmpfeF9mID0gYXBwbHlGb3JjZV9yal94X2Y7IC8vIEdldCB3b3JsZCBhbmNob3JzCgogICAgICB0aGlzLmdldFdvcmxkQW5jaG9yQSh3b3JsZEFuY2hvckEpOwogICAgICB0aGlzLmdldFdvcmxkQW5jaG9yQih3b3JsZEFuY2hvckIpOyAvLyBHZXQgb2Zmc2V0IHBvaW50cwoKICAgICAgd29ybGRBbmNob3JBLnZzdWIoYm9keUEucG9zaXRpb24sIHJpKTsKICAgICAgd29ybGRBbmNob3JCLnZzdWIoYm9keUIucG9zaXRpb24sIHJqKTsgLy8gQ29tcHV0ZSBkaXN0YW5jZSB2ZWN0b3IgYmV0d2VlbiB3b3JsZCBhbmNob3IgcG9pbnRzCgogICAgICB3b3JsZEFuY2hvckIudnN1Yih3b3JsZEFuY2hvckEsIHIpOwogICAgICBjb25zdCBybGVuID0gci5sZW5ndGgoKTsKICAgICAgcl91bml0LmNvcHkocik7CiAgICAgIHJfdW5pdC5ub3JtYWxpemUoKTsgLy8gQ29tcHV0ZSByZWxhdGl2ZSB2ZWxvY2l0eSBvZiB0aGUgYW5jaG9yIHBvaW50cywgdQoKICAgICAgYm9keUIudmVsb2NpdHkudnN1Yihib2R5QS52ZWxvY2l0eSwgdSk7IC8vIEFkZCByb3RhdGlvbmFsIHZlbG9jaXR5CgogICAgICBib2R5Qi5hbmd1bGFyVmVsb2NpdHkuY3Jvc3MocmosIHRtcCk7CiAgICAgIHUudmFkZCh0bXAsIHUpOwogICAgICBib2R5QS5hbmd1bGFyVmVsb2NpdHkuY3Jvc3MocmksIHRtcCk7CiAgICAgIHUudnN1Yih0bXAsIHUpOyAvLyBGID0gLSBrICogKCB4IC0gTCApIC0gRCAqICggdSApCgogICAgICByX3VuaXQuc2NhbGUoLWsgKiAocmxlbiAtIGwpIC0gZCAqIHUuZG90KHJfdW5pdCksIGYpOyAvLyBBZGQgZm9yY2VzIHRvIGJvZGllcwoKICAgICAgYm9keUEuZm9yY2UudnN1YihmLCBib2R5QS5mb3JjZSk7CiAgICAgIGJvZHlCLmZvcmNlLnZhZGQoZiwgYm9keUIuZm9yY2UpOyAvLyBBbmd1bGFyIGZvcmNlCgogICAgICByaS5jcm9zcyhmLCByaV94X2YpOwogICAgICByai5jcm9zcyhmLCByal94X2YpOwogICAgICBib2R5QS50b3JxdWUudnN1YihyaV94X2YsIGJvZHlBLnRvcnF1ZSk7CiAgICAgIGJvZHlCLnRvcnF1ZS52YWRkKHJqX3hfZiwgYm9keUIudG9ycXVlKTsKICAgIH0KCiAgfQogIGNvbnN0IGFwcGx5Rm9yY2VfciA9IG5ldyBWZWMzKCk7CiAgY29uc3QgYXBwbHlGb3JjZV9yX3VuaXQgPSBuZXcgVmVjMygpOwogIGNvbnN0IGFwcGx5Rm9yY2VfdSA9IG5ldyBWZWMzKCk7CiAgY29uc3QgYXBwbHlGb3JjZV9mID0gbmV3IFZlYzMoKTsKICBjb25zdCBhcHBseUZvcmNlX3dvcmxkQW5jaG9yQSA9IG5ldyBWZWMzKCk7CiAgY29uc3QgYXBwbHlGb3JjZV93b3JsZEFuY2hvckIgPSBuZXcgVmVjMygpOwogIGNvbnN0IGFwcGx5Rm9yY2VfcmkgPSBuZXcgVmVjMygpOwogIGNvbnN0IGFwcGx5Rm9yY2VfcmogPSBuZXcgVmVjMygpOwogIGNvbnN0IGFwcGx5Rm9yY2VfcmlfeF9mID0gbmV3IFZlYzMoKTsKICBjb25zdCBhcHBseUZvcmNlX3JqX3hfZiA9IG5ldyBWZWMzKCk7CiAgY29uc3QgYXBwbHlGb3JjZV90bXAgPSBuZXcgVmVjMygpOwoKICAvKioKICAgKiBXaGVlbEluZm8KICAgKi8KICBjbGFzcyBXaGVlbEluZm8gewogICAgLyoqCiAgICAgKiBNYXggdHJhdmVsIGRpc3RhbmNlIG9mIHRoZSBzdXNwZW5zaW9uLCBpbiBtZXRlcnMuCiAgICAgKiBAZGVmYXVsdCAxCiAgICAgKi8KCiAgICAvKioKICAgICAqIFNwZWVkIHRvIGFwcGx5IHRvIHRoZSB3aGVlbCByb3RhdGlvbiB3aGVuIHRoZSB3aGVlbCBpcyBzbGlkaW5nLgogICAgICogQGRlZmF1bHQgLTAuMQogICAgICovCgogICAgLyoqCiAgICAgKiBJZiB0aGUgY3VzdG9tU2xpZGluZ1JvdGF0aW9uYWxTcGVlZCBzaG91bGQgYmUgdXNlZC4KICAgICAqIEBkZWZhdWx0IGZhbHNlCiAgICAgKi8KCiAgICAvKioKICAgICAqIHNsaWRpbmcKICAgICAqLwoKICAgIC8qKgogICAgICogQ29ubmVjdGlvbiBwb2ludCwgZGVmaW5lZCBsb2NhbGx5IGluIHRoZSBjaGFzc2lzIGJvZHkgZnJhbWUuCiAgICAgKi8KCiAgICAvKioKICAgICAqIGNoYXNzaXNDb25uZWN0aW9uUG9pbnRXb3JsZAogICAgICovCgogICAgLyoqCiAgICAgKiBkaXJlY3Rpb25Mb2NhbAogICAgICovCgogICAgLyoqCiAgICAgKiBkaXJlY3Rpb25Xb3JsZAogICAgICovCgogICAgLyoqCiAgICAgKiBheGxlTG9jYWwKICAgICAqLwoKICAgIC8qKgogICAgICogYXhsZVdvcmxkCiAgICAgKi8KCiAgICAvKioKICAgICAqIHN1c3BlbnNpb25SZXN0TGVuZ3RoCiAgICAgKiBAZGVmYXVsdCAxCiAgICAgKi8KCiAgICAvKioKICAgICAqIHN1c3BlbnNpb25NYXhMZW5ndGgKICAgICAqIEBkZWZhdWx0IDIKICAgICAqLwoKICAgIC8qKgogICAgICogcmFkaXVzCiAgICAgKiBAZGVmYXVsdCAxCiAgICAgKi8KCiAgICAvKioKICAgICAqIHN1c3BlbnNpb25TdGlmZm5lc3MKICAgICAqIEBkZWZhdWx0IDEwMAogICAgICovCgogICAgLyoqCiAgICAgKiBkYW1waW5nQ29tcHJlc3Npb24KICAgICAqIEBkZWZhdWx0IDEwCiAgICAgKi8KCiAgICAvKioKICAgICAqIGRhbXBpbmdSZWxheGF0aW9uCiAgICAgKiBAZGVmYXVsdCAxMAogICAgICovCgogICAgLyoqCiAgICAgKiBmcmljdGlvblNsaXAKICAgICAqIEBkZWZhdWx0IDEwLjUKICAgICAqLwoKICAgIC8qKiBmb3J3YXJkQWNjZWxlcmF0aW9uICovCgogICAgLyoqIHNpZGVBY2NlbGVyYXRpb24gKi8KCiAgICAvKioKICAgICAqIHN0ZWVyaW5nCiAgICAgKiBAZGVmYXVsdCAwCiAgICAgKi8KCiAgICAvKioKICAgICAqIFJvdGF0aW9uIHZhbHVlLCBpbiByYWRpYW5zLgogICAgICogQGRlZmF1bHQgMAogICAgICovCgogICAgLyoqCiAgICAgKiBkZWx0YVJvdGF0aW9uCiAgICAgKiBAZGVmYXVsdCAwCiAgICAgKi8KCiAgICAvKioKICAgICAqIHJvbGxJbmZsdWVuY2UKICAgICAqIEBkZWZhdWx0IDAuMDEKICAgICAqLwoKICAgIC8qKgogICAgICogbWF4U3VzcGVuc2lvbkZvcmNlCiAgICAgKi8KCiAgICAvKioKICAgICAqIGVuZ2luZUZvcmNlCiAgICAgKi8KCiAgICAvKioKICAgICAqIGJyYWtlCiAgICAgKi8KCiAgICAvKioKICAgICAqIGlzRnJvbnRXaGVlbAogICAgICogQGRlZmF1bHQgdHJ1ZQogICAgICovCgogICAgLyoqCiAgICAgKiBjbGlwcGVkSW52Q29udGFjdERvdFN1c3BlbnNpb24KICAgICAqIEBkZWZhdWx0IDEKICAgICAqLwoKICAgIC8qKgogICAgICogc3VzcGVuc2lvblJlbGF0aXZlVmVsb2NpdHkKICAgICAqIEBkZWZhdWx0IDAKICAgICAqLwoKICAgIC8qKgogICAgICogc3VzcGVuc2lvbkZvcmNlCiAgICAgKiBAZGVmYXVsdCAwCiAgICAgKi8KCiAgICAvKioKICAgICAqIHNsaXBJbmZvCiAgICAgKi8KCiAgICAvKioKICAgICAqIHNraWRJbmZvCiAgICAgKiBAZGVmYXVsdCAwCiAgICAgKi8KCiAgICAvKioKICAgICAqIHN1c3BlbnNpb25MZW5ndGgKICAgICAqIEBkZWZhdWx0IDAKICAgICAqLwoKICAgIC8qKgogICAgICogc2lkZUltcHVsc2UKICAgICAqLwoKICAgIC8qKgogICAgICogZm9yd2FyZEltcHVsc2UKICAgICAqLwoKICAgIC8qKgogICAgICogVGhlIHJlc3VsdCBmcm9tIHJheWNhc3RpbmcuCiAgICAgKi8KCiAgICAvKioKICAgICAqIFdoZWVsIHdvcmxkIHRyYW5zZm9ybS4KICAgICAqLwoKICAgIC8qKgogICAgICogaXNJbkNvbnRhY3QKICAgICAqLwogICAgY29uc3RydWN0b3Iob3B0aW9ucykgewogICAgICBpZiAob3B0aW9ucyA9PT0gdm9pZCAwKSB7CiAgICAgICAgb3B0aW9ucyA9IHt9OwogICAgICB9CgogICAgICBvcHRpb25zID0gVXRpbHMuZGVmYXVsdHMob3B0aW9ucywgewogICAgICAgIGNoYXNzaXNDb25uZWN0aW9uUG9pbnRMb2NhbDogbmV3IFZlYzMoKSwKICAgICAgICBjaGFzc2lzQ29ubmVjdGlvblBvaW50V29ybGQ6IG5ldyBWZWMzKCksCiAgICAgICAgZGlyZWN0aW9uTG9jYWw6IG5ldyBWZWMzKCksCiAgICAgICAgZGlyZWN0aW9uV29ybGQ6IG5ldyBWZWMzKCksCiAgICAgICAgYXhsZUxvY2FsOiBuZXcgVmVjMygpLAogICAgICAgIGF4bGVXb3JsZDogbmV3IFZlYzMoKSwKICAgICAgICBzdXNwZW5zaW9uUmVzdExlbmd0aDogMSwKICAgICAgICBzdXNwZW5zaW9uTWF4TGVuZ3RoOiAyLAogICAgICAgIHJhZGl1czogMSwKICAgICAgICBzdXNwZW5zaW9uU3RpZmZuZXNzOiAxMDAsCiAgICAgICAgZGFtcGluZ0NvbXByZXNzaW9uOiAxMCwKICAgICAgICBkYW1waW5nUmVsYXhhdGlvbjogMTAsCiAgICAgICAgZnJpY3Rpb25TbGlwOiAxMC41LAogICAgICAgIGZvcndhcmRBY2NlbGVyYXRpb246IDEsCiAgICAgICAgc2lkZUFjY2VsZXJhdGlvbjogMSwKICAgICAgICBzdGVlcmluZzogMCwKICAgICAgICByb3RhdGlvbjogMCwKICAgICAgICBkZWx0YVJvdGF0aW9uOiAwLAogICAgICAgIHJvbGxJbmZsdWVuY2U6IDAuMDEsCiAgICAgICAgbWF4U3VzcGVuc2lvbkZvcmNlOiBOdW1iZXIuTUFYX1ZBTFVFLAogICAgICAgIGlzRnJvbnRXaGVlbDogdHJ1ZSwKICAgICAgICBjbGlwcGVkSW52Q29udGFjdERvdFN1c3BlbnNpb246IDEsCiAgICAgICAgc3VzcGVuc2lvblJlbGF0aXZlVmVsb2NpdHk6IDAsCiAgICAgICAgc3VzcGVuc2lvbkZvcmNlOiAwLAogICAgICAgIHNsaXBJbmZvOiAwLAogICAgICAgIHNraWRJbmZvOiAwLAogICAgICAgIHN1c3BlbnNpb25MZW5ndGg6IDAsCiAgICAgICAgbWF4U3VzcGVuc2lvblRyYXZlbDogMSwKICAgICAgICB1c2VDdXN0b21TbGlkaW5nUm90YXRpb25hbFNwZWVkOiBmYWxzZSwKICAgICAgICBjdXN0b21TbGlkaW5nUm90YXRpb25hbFNwZWVkOiAtMC4xCiAgICAgIH0pOwogICAgICB0aGlzLm1heFN1c3BlbnNpb25UcmF2ZWwgPSBvcHRpb25zLm1heFN1c3BlbnNpb25UcmF2ZWw7CiAgICAgIHRoaXMuY3VzdG9tU2xpZGluZ1JvdGF0aW9uYWxTcGVlZCA9IG9wdGlvbnMuY3VzdG9tU2xpZGluZ1JvdGF0aW9uYWxTcGVlZDsKICAgICAgdGhpcy51c2VDdXN0b21TbGlkaW5nUm90YXRpb25hbFNwZWVkID0gb3B0aW9ucy51c2VDdXN0b21TbGlkaW5nUm90YXRpb25hbFNwZWVkOwogICAgICB0aGlzLnNsaWRpbmcgPSBmYWxzZTsKICAgICAgdGhpcy5jaGFzc2lzQ29ubmVjdGlvblBvaW50TG9jYWwgPSBvcHRpb25zLmNoYXNzaXNDb25uZWN0aW9uUG9pbnRMb2NhbC5jbG9uZSgpOwogICAgICB0aGlzLmNoYXNzaXNDb25uZWN0aW9uUG9pbnRXb3JsZCA9IG9wdGlvbnMuY2hhc3Npc0Nvbm5lY3Rpb25Qb2ludFdvcmxkLmNsb25lKCk7CiAgICAgIHRoaXMuZGlyZWN0aW9uTG9jYWwgPSBvcHRpb25zLmRpcmVjdGlvbkxvY2FsLmNsb25lKCk7CiAgICAgIHRoaXMuZGlyZWN0aW9uV29ybGQgPSBvcHRpb25zLmRpcmVjdGlvbldvcmxkLmNsb25lKCk7CiAgICAgIHRoaXMuYXhsZUxvY2FsID0gb3B0aW9ucy5heGxlTG9jYWwuY2xvbmUoKTsKICAgICAgdGhpcy5heGxlV29ybGQgPSBvcHRpb25zLmF4bGVXb3JsZC5jbG9uZSgpOwogICAgICB0aGlzLnN1c3BlbnNpb25SZXN0TGVuZ3RoID0gb3B0aW9ucy5zdXNwZW5zaW9uUmVzdExlbmd0aDsKICAgICAgdGhpcy5zdXNwZW5zaW9uTWF4TGVuZ3RoID0gb3B0aW9ucy5zdXNwZW5zaW9uTWF4TGVuZ3RoOwogICAgICB0aGlzLnJhZGl1cyA9IG9wdGlvbnMucmFkaXVzOwogICAgICB0aGlzLnN1c3BlbnNpb25TdGlmZm5lc3MgPSBvcHRpb25zLnN1c3BlbnNpb25TdGlmZm5lc3M7CiAgICAgIHRoaXMuZGFtcGluZ0NvbXByZXNzaW9uID0gb3B0aW9ucy5kYW1waW5nQ29tcHJlc3Npb247CiAgICAgIHRoaXMuZGFtcGluZ1JlbGF4YXRpb24gPSBvcHRpb25zLmRhbXBpbmdSZWxheGF0aW9uOwogICAgICB0aGlzLmZyaWN0aW9uU2xpcCA9IG9wdGlvbnMuZnJpY3Rpb25TbGlwOwogICAgICB0aGlzLmZvcndhcmRBY2NlbGVyYXRpb24gPSBvcHRpb25zLmZvcndhcmRBY2NlbGVyYXRpb247CiAgICAgIHRoaXMuc2lkZUFjY2VsZXJhdGlvbiA9IG9wdGlvbnMuc2lkZUFjY2VsZXJhdGlvbjsKICAgICAgdGhpcy5zdGVlcmluZyA9IDA7CiAgICAgIHRoaXMucm90YXRpb24gPSAwOwogICAgICB0aGlzLmRlbHRhUm90YXRpb24gPSAwOwogICAgICB0aGlzLnJvbGxJbmZsdWVuY2UgPSBvcHRpb25zLnJvbGxJbmZsdWVuY2U7CiAgICAgIHRoaXMubWF4U3VzcGVuc2lvbkZvcmNlID0gb3B0aW9ucy5tYXhTdXNwZW5zaW9uRm9yY2U7CiAgICAgIHRoaXMuZW5naW5lRm9yY2UgPSAwOwogICAgICB0aGlzLmJyYWtlID0gMDsKICAgICAgdGhpcy5pc0Zyb250V2hlZWwgPSBvcHRpb25zLmlzRnJvbnRXaGVlbDsKICAgICAgdGhpcy5jbGlwcGVkSW52Q29udGFjdERvdFN1c3BlbnNpb24gPSAxOwogICAgICB0aGlzLnN1c3BlbnNpb25SZWxhdGl2ZVZlbG9jaXR5ID0gMDsKICAgICAgdGhpcy5zdXNwZW5zaW9uRm9yY2UgPSAwOwogICAgICB0aGlzLnNsaXBJbmZvID0gMDsKICAgICAgdGhpcy5za2lkSW5mbyA9IDA7CiAgICAgIHRoaXMuc3VzcGVuc2lvbkxlbmd0aCA9IDA7CiAgICAgIHRoaXMuc2lkZUltcHVsc2UgPSAwOwogICAgICB0aGlzLmZvcndhcmRJbXB1bHNlID0gMDsKICAgICAgdGhpcy5yYXljYXN0UmVzdWx0ID0gbmV3IFJheWNhc3RSZXN1bHQoKTsKICAgICAgdGhpcy53b3JsZFRyYW5zZm9ybSA9IG5ldyBUcmFuc2Zvcm0oKTsKICAgICAgdGhpcy5pc0luQ29udGFjdCA9IGZhbHNlOwogICAgfQoKICAgIHVwZGF0ZVdoZWVsKGNoYXNzaXMpIHsKICAgICAgY29uc3QgcmF5Y2FzdFJlc3VsdCA9IHRoaXMucmF5Y2FzdFJlc3VsdDsKCiAgICAgIGlmICh0aGlzLmlzSW5Db250YWN0KSB7CiAgICAgICAgY29uc3QgcHJvamVjdCA9IHJheWNhc3RSZXN1bHQuaGl0Tm9ybWFsV29ybGQuZG90KHJheWNhc3RSZXN1bHQuZGlyZWN0aW9uV29ybGQpOwogICAgICAgIHJheWNhc3RSZXN1bHQuaGl0UG9pbnRXb3JsZC52c3ViKGNoYXNzaXMucG9zaXRpb24sIHJlbHBvcyk7CiAgICAgICAgY2hhc3Npcy5nZXRWZWxvY2l0eUF0V29ybGRQb2ludChyZWxwb3MsIGNoYXNzaXNfdmVsb2NpdHlfYXRfY29udGFjdFBvaW50KTsKICAgICAgICBjb25zdCBwcm9qVmVsID0gcmF5Y2FzdFJlc3VsdC5oaXROb3JtYWxXb3JsZC5kb3QoY2hhc3Npc192ZWxvY2l0eV9hdF9jb250YWN0UG9pbnQpOwoKICAgICAgICBpZiAocHJvamVjdCA+PSAtMC4xKSB7CiAgICAgICAgICB0aGlzLnN1c3BlbnNpb25SZWxhdGl2ZVZlbG9jaXR5ID0gMC4wOwogICAgICAgICAgdGhpcy5jbGlwcGVkSW52Q29udGFjdERvdFN1c3BlbnNpb24gPSAxLjAgLyAwLjE7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGNvbnN0IGludiA9IC0xIC8gcHJvamVjdDsKICAgICAgICAgIHRoaXMuc3VzcGVuc2lvblJlbGF0aXZlVmVsb2NpdHkgPSBwcm9qVmVsICogaW52OwogICAgICAgICAgdGhpcy5jbGlwcGVkSW52Q29udGFjdERvdFN1c3BlbnNpb24gPSBpbnY7CiAgICAgICAgfQogICAgICB9IGVsc2UgewogICAgICAgIC8vIE5vdCBpbiBjb250YWN0IDogcG9zaXRpb24gd2hlZWwgaW4gYSBuaWNlIChyZXN0IGxlbmd0aCkgcG9zaXRpb24KICAgICAgICByYXljYXN0UmVzdWx0LnN1c3BlbnNpb25MZW5ndGggPSB0aGlzLnN1c3BlbnNpb25SZXN0TGVuZ3RoOwogICAgICAgIHRoaXMuc3VzcGVuc2lvblJlbGF0aXZlVmVsb2NpdHkgPSAwLjA7CiAgICAgICAgcmF5Y2FzdFJlc3VsdC5kaXJlY3Rpb25Xb3JsZC5zY2FsZSgtMSwgcmF5Y2FzdFJlc3VsdC5oaXROb3JtYWxXb3JsZCk7CiAgICAgICAgdGhpcy5jbGlwcGVkSW52Q29udGFjdERvdFN1c3BlbnNpb24gPSAxLjA7CiAgICAgIH0KICAgIH0KCiAgfQogIGNvbnN0IGNoYXNzaXNfdmVsb2NpdHlfYXRfY29udGFjdFBvaW50ID0gbmV3IFZlYzMoKTsKICBjb25zdCByZWxwb3MgPSBuZXcgVmVjMygpOwoKICAvKioKICAgKiBWZWhpY2xlIGhlbHBlciBjbGFzcyB0aGF0IGNhc3RzIHJheXMgZnJvbSB0aGUgd2hlZWwgcG9zaXRpb25zIHRvd2FyZHMgdGhlIGdyb3VuZCBhbmQgYXBwbGllcyBmb3JjZXMuCiAgICovCiAgY2xhc3MgUmF5Y2FzdFZlaGljbGUgewogICAgLyoqIFRoZSBjYXIgY2hhc3NpcyBib2R5LiAqLwoKICAgIC8qKiBUaGUgd2hlZWxzLiAqLwoKICAgIC8qKiBXaWxsIGJlIHNldCB0byB0cnVlIGlmIHRoZSBjYXIgaXMgc2xpZGluZy4gKi8KCiAgICAvKiogSW5kZXggb2YgdGhlIHJpZ2h0IGF4aXMuIHg9MCwgeT0xLCB6PTIgKi8KCiAgICAvKiogSW5kZXggb2YgdGhlIGZvcndhcmQgYXhpcy4geD0wLCB5PTEsIHo9MiAqLwoKICAgIC8qKiBJbmRleCBvZiB0aGUgdXAgYXhpcy4geD0wLCB5PTEsIHo9MiAqLwoKICAgIC8qKiBUaGUgY29uc3RyYWludHMuICovCgogICAgLyoqIE9wdGlvbmFsIHByZS1zdGVwIGNhbGxiYWNrLiAqLwoKICAgIC8qKiBOdW1iZXIgb2Ygd2hlZWxzIG9uIHRoZSBncm91bmQuICovCiAgICBjb25zdHJ1Y3RvcihvcHRpb25zKSB7CiAgICAgIHRoaXMuY2hhc3Npc0JvZHkgPSBvcHRpb25zLmNoYXNzaXNCb2R5OwogICAgICB0aGlzLndoZWVsSW5mb3MgPSBbXTsKICAgICAgdGhpcy5zbGlkaW5nID0gZmFsc2U7CiAgICAgIHRoaXMud29ybGQgPSBudWxsOwogICAgICB0aGlzLmluZGV4UmlnaHRBeGlzID0gdHlwZW9mIG9wdGlvbnMuaW5kZXhSaWdodEF4aXMgIT09ICd1bmRlZmluZWQnID8gb3B0aW9ucy5pbmRleFJpZ2h0QXhpcyA6IDI7CiAgICAgIHRoaXMuaW5kZXhGb3J3YXJkQXhpcyA9IHR5cGVvZiBvcHRpb25zLmluZGV4Rm9yd2FyZEF4aXMgIT09ICd1bmRlZmluZWQnID8gb3B0aW9ucy5pbmRleEZvcndhcmRBeGlzIDogMDsKICAgICAgdGhpcy5pbmRleFVwQXhpcyA9IHR5cGVvZiBvcHRpb25zLmluZGV4VXBBeGlzICE9PSAndW5kZWZpbmVkJyA/IG9wdGlvbnMuaW5kZXhVcEF4aXMgOiAxOwogICAgICB0aGlzLmNvbnN0cmFpbnRzID0gW107CgogICAgICB0aGlzLnByZVN0ZXBDYWxsYmFjayA9ICgpID0+IHt9OwoKICAgICAgdGhpcy5jdXJyZW50VmVoaWNsZVNwZWVkS21Ib3VyID0gMDsKICAgICAgdGhpcy5udW1XaGVlbHNPbkdyb3VuZCA9IDA7CiAgICB9CiAgICAvKioKICAgICAqIEFkZCBhIHdoZWVsLiBGb3IgaW5mb3JtYXRpb24gYWJvdXQgdGhlIG9wdGlvbnMsIHNlZSBgV2hlZWxJbmZvYC4KICAgICAqLwoKCiAgICBhZGRXaGVlbChvcHRpb25zKSB7CiAgICAgIGlmIChvcHRpb25zID09PSB2b2lkIDApIHsKICAgICAgICBvcHRpb25zID0ge307CiAgICAgIH0KCiAgICAgIGNvbnN0IGluZm8gPSBuZXcgV2hlZWxJbmZvKG9wdGlvbnMpOwogICAgICBjb25zdCBpbmRleCA9IHRoaXMud2hlZWxJbmZvcy5sZW5ndGg7CiAgICAgIHRoaXMud2hlZWxJbmZvcy5wdXNoKGluZm8pOwogICAgICByZXR1cm4gaW5kZXg7CiAgICB9CiAgICAvKioKICAgICAqIFNldCB0aGUgc3RlZXJpbmcgdmFsdWUgb2YgYSB3aGVlbC4KICAgICAqLwoKCiAgICBzZXRTdGVlcmluZ1ZhbHVlKHZhbHVlLCB3aGVlbEluZGV4KSB7CiAgICAgIGNvbnN0IHdoZWVsID0gdGhpcy53aGVlbEluZm9zW3doZWVsSW5kZXhdOwogICAgICB3aGVlbC5zdGVlcmluZyA9IHZhbHVlOwogICAgfQogICAgLyoqCiAgICAgKiBTZXQgdGhlIHdoZWVsIGZvcmNlIHRvIGFwcGx5IG9uIG9uZSBvZiB0aGUgd2hlZWxzIGVhY2ggdGltZSBzdGVwCiAgICAgKi8KCgogICAgYXBwbHlFbmdpbmVGb3JjZSh2YWx1ZSwgd2hlZWxJbmRleCkgewogICAgICB0aGlzLndoZWVsSW5mb3Nbd2hlZWxJbmRleF0uZW5naW5lRm9yY2UgPSB2YWx1ZTsKICAgIH0KICAgIC8qKgogICAgICogU2V0IHRoZSBicmFraW5nIGZvcmNlIG9mIGEgd2hlZWwKICAgICAqLwoKCiAgICBzZXRCcmFrZShicmFrZSwgd2hlZWxJbmRleCkgewogICAgICB0aGlzLndoZWVsSW5mb3Nbd2hlZWxJbmRleF0uYnJha2UgPSBicmFrZTsKICAgIH0KICAgIC8qKgogICAgICogQWRkIHRoZSB2ZWhpY2xlIGluY2x1ZGluZyBpdHMgY29uc3RyYWludHMgdG8gdGhlIHdvcmxkLgogICAgICovCgoKICAgIGFkZFRvV29ybGQod29ybGQpIHsKICAgICAgd29ybGQuYWRkQm9keSh0aGlzLmNoYXNzaXNCb2R5KTsKICAgICAgY29uc3QgdGhhdCA9IHRoaXM7CgogICAgICB0aGlzLnByZVN0ZXBDYWxsYmFjayA9ICgpID0+IHsKICAgICAgICB0aGF0LnVwZGF0ZVZlaGljbGUod29ybGQuZHQpOwogICAgICB9OwoKICAgICAgd29ybGQuYWRkRXZlbnRMaXN0ZW5lcigncHJlU3RlcCcsIHRoaXMucHJlU3RlcENhbGxiYWNrKTsKICAgICAgdGhpcy53b3JsZCA9IHdvcmxkOwogICAgfQogICAgLyoqCiAgICAgKiBHZXQgb25lIG9mIHRoZSB3aGVlbCBheGxlcywgd29ybGQtb3JpZW50ZWQuCiAgICAgKi8KCgogICAgZ2V0VmVoaWNsZUF4aXNXb3JsZChheGlzSW5kZXgsIHJlc3VsdCkgewogICAgICByZXN1bHQuc2V0KGF4aXNJbmRleCA9PT0gMCA/IDEgOiAwLCBheGlzSW5kZXggPT09IDEgPyAxIDogMCwgYXhpc0luZGV4ID09PSAyID8gMSA6IDApOwogICAgICB0aGlzLmNoYXNzaXNCb2R5LnZlY3RvclRvV29ybGRGcmFtZShyZXN1bHQsIHJlc3VsdCk7CiAgICB9CgogICAgdXBkYXRlVmVoaWNsZSh0aW1lU3RlcCkgewogICAgICBjb25zdCB3aGVlbEluZm9zID0gdGhpcy53aGVlbEluZm9zOwogICAgICBjb25zdCBudW1XaGVlbHMgPSB3aGVlbEluZm9zLmxlbmd0aDsKICAgICAgY29uc3QgY2hhc3Npc0JvZHkgPSB0aGlzLmNoYXNzaXNCb2R5OwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBudW1XaGVlbHM7IGkrKykgewogICAgICAgIHRoaXMudXBkYXRlV2hlZWxUcmFuc2Zvcm0oaSk7CiAgICAgIH0KCiAgICAgIHRoaXMuY3VycmVudFZlaGljbGVTcGVlZEttSG91ciA9IDMuNiAqIGNoYXNzaXNCb2R5LnZlbG9jaXR5Lmxlbmd0aCgpOwogICAgICBjb25zdCBmb3J3YXJkV29ybGQgPSBuZXcgVmVjMygpOwogICAgICB0aGlzLmdldFZlaGljbGVBeGlzV29ybGQodGhpcy5pbmRleEZvcndhcmRBeGlzLCBmb3J3YXJkV29ybGQpOwoKICAgICAgaWYgKGZvcndhcmRXb3JsZC5kb3QoY2hhc3Npc0JvZHkudmVsb2NpdHkpIDwgMCkgewogICAgICAgIHRoaXMuY3VycmVudFZlaGljbGVTcGVlZEttSG91ciAqPSAtMTsKICAgICAgfSAvLyBzaW11bGF0ZSBzdXNwZW5zaW9uCgoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBudW1XaGVlbHM7IGkrKykgewogICAgICAgIHRoaXMuY2FzdFJheSh3aGVlbEluZm9zW2ldKTsKICAgICAgfQoKICAgICAgdGhpcy51cGRhdGVTdXNwZW5zaW9uKHRpbWVTdGVwKTsKICAgICAgY29uc3QgaW1wdWxzZSA9IG5ldyBWZWMzKCk7CiAgICAgIGNvbnN0IHJlbHBvcyA9IG5ldyBWZWMzKCk7CgogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IG51bVdoZWVsczsgaSsrKSB7CiAgICAgICAgLy9hcHBseSBzdXNwZW5zaW9uIGZvcmNlCiAgICAgICAgY29uc3Qgd2hlZWwgPSB3aGVlbEluZm9zW2ldOwogICAgICAgIGxldCBzdXNwZW5zaW9uRm9yY2UgPSB3aGVlbC5zdXNwZW5zaW9uRm9yY2U7CgogICAgICAgIGlmIChzdXNwZW5zaW9uRm9yY2UgPiB3aGVlbC5tYXhTdXNwZW5zaW9uRm9yY2UpIHsKICAgICAgICAgIHN1c3BlbnNpb25Gb3JjZSA9IHdoZWVsLm1heFN1c3BlbnNpb25Gb3JjZTsKICAgICAgICB9CgogICAgICAgIHdoZWVsLnJheWNhc3RSZXN1bHQuaGl0Tm9ybWFsV29ybGQuc2NhbGUoc3VzcGVuc2lvbkZvcmNlICogdGltZVN0ZXAsIGltcHVsc2UpOwogICAgICAgIHdoZWVsLnJheWNhc3RSZXN1bHQuaGl0UG9pbnRXb3JsZC52c3ViKGNoYXNzaXNCb2R5LnBvc2l0aW9uLCByZWxwb3MpOwogICAgICAgIGNoYXNzaXNCb2R5LmFwcGx5SW1wdWxzZShpbXB1bHNlLCByZWxwb3MpOwogICAgICB9CgogICAgICB0aGlzLnVwZGF0ZUZyaWN0aW9uKHRpbWVTdGVwKTsKICAgICAgY29uc3QgaGl0Tm9ybWFsV29ybGRTY2FsZWRXaXRoUHJvaiA9IG5ldyBWZWMzKCk7CiAgICAgIGNvbnN0IGZ3ZCA9IG5ldyBWZWMzKCk7CiAgICAgIGNvbnN0IHZlbCA9IG5ldyBWZWMzKCk7CgogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IG51bVdoZWVsczsgaSsrKSB7CiAgICAgICAgY29uc3Qgd2hlZWwgPSB3aGVlbEluZm9zW2ldOyAvL2NvbnN0IHJlbHBvcyA9IG5ldyBWZWMzKCk7CiAgICAgICAgLy93aGVlbC5jaGFzc2lzQ29ubmVjdGlvblBvaW50V29ybGQudnN1YihjaGFzc2lzQm9keS5wb3NpdGlvbiwgcmVscG9zKTsKCiAgICAgICAgY2hhc3Npc0JvZHkuZ2V0VmVsb2NpdHlBdFdvcmxkUG9pbnQod2hlZWwuY2hhc3Npc0Nvbm5lY3Rpb25Qb2ludFdvcmxkLCB2ZWwpOyAvLyBIYWNrIHRvIGdldCB0aGUgcm90YXRpb24gaW4gdGhlIGNvcnJlY3QgZGlyZWN0aW9uCgogICAgICAgIGxldCBtID0gMTsKCiAgICAgICAgc3dpdGNoICh0aGlzLmluZGV4VXBBeGlzKSB7CiAgICAgICAgICBjYXNlIDE6CiAgICAgICAgICAgIG0gPSAtMTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgfQoKICAgICAgICBpZiAod2hlZWwuaXNJbkNvbnRhY3QpIHsKICAgICAgICAgIHRoaXMuZ2V0VmVoaWNsZUF4aXNXb3JsZCh0aGlzLmluZGV4Rm9yd2FyZEF4aXMsIGZ3ZCk7CiAgICAgICAgICBjb25zdCBwcm9qID0gZndkLmRvdCh3aGVlbC5yYXljYXN0UmVzdWx0LmhpdE5vcm1hbFdvcmxkKTsKICAgICAgICAgIHdoZWVsLnJheWNhc3RSZXN1bHQuaGl0Tm9ybWFsV29ybGQuc2NhbGUocHJvaiwgaGl0Tm9ybWFsV29ybGRTY2FsZWRXaXRoUHJvaik7CiAgICAgICAgICBmd2QudnN1YihoaXROb3JtYWxXb3JsZFNjYWxlZFdpdGhQcm9qLCBmd2QpOwogICAgICAgICAgY29uc3QgcHJvajIgPSBmd2QuZG90KHZlbCk7CiAgICAgICAgICB3aGVlbC5kZWx0YVJvdGF0aW9uID0gbSAqIHByb2oyICogdGltZVN0ZXAgLyB3aGVlbC5yYWRpdXM7CiAgICAgICAgfQoKICAgICAgICBpZiAoKHdoZWVsLnNsaWRpbmcgfHwgIXdoZWVsLmlzSW5Db250YWN0KSAmJiB3aGVlbC5lbmdpbmVGb3JjZSAhPT0gMCAmJiB3aGVlbC51c2VDdXN0b21TbGlkaW5nUm90YXRpb25hbFNwZWVkKSB7CiAgICAgICAgICAvLyBBcHBseSBjdXN0b20gcm90YXRpb24gd2hlbiBhY2NlbGVyYXRpbmcgYW5kIHNsaWRpbmcKICAgICAgICAgIHdoZWVsLmRlbHRhUm90YXRpb24gPSAod2hlZWwuZW5naW5lRm9yY2UgPiAwID8gMSA6IC0xKSAqIHdoZWVsLmN1c3RvbVNsaWRpbmdSb3RhdGlvbmFsU3BlZWQgKiB0aW1lU3RlcDsKICAgICAgICB9IC8vIExvY2sgd2hlZWxzCgoKICAgICAgICBpZiAoTWF0aC5hYnMod2hlZWwuYnJha2UpID4gTWF0aC5hYnMod2hlZWwuZW5naW5lRm9yY2UpKSB7CiAgICAgICAgICB3aGVlbC5kZWx0YVJvdGF0aW9uID0gMDsKICAgICAgICB9CgogICAgICAgIHdoZWVsLnJvdGF0aW9uICs9IHdoZWVsLmRlbHRhUm90YXRpb247IC8vIFVzZSB0aGUgb2xkIHZhbHVlCgogICAgICAgIHdoZWVsLmRlbHRhUm90YXRpb24gKj0gMC45OTsgLy8gZGFtcGluZyBvZiByb3RhdGlvbiB3aGVuIG5vdCBpbiBjb250YWN0CiAgICAgIH0KICAgIH0KCiAgICB1cGRhdGVTdXNwZW5zaW9uKGRlbHRhVGltZSkgewogICAgICBjb25zdCBjaGFzc2lzQm9keSA9IHRoaXMuY2hhc3Npc0JvZHk7CiAgICAgIGNvbnN0IGNoYXNzaXNNYXNzID0gY2hhc3Npc0JvZHkubWFzczsKICAgICAgY29uc3Qgd2hlZWxJbmZvcyA9IHRoaXMud2hlZWxJbmZvczsKICAgICAgY29uc3QgbnVtV2hlZWxzID0gd2hlZWxJbmZvcy5sZW5ndGg7CgogICAgICBmb3IgKGxldCB3X2l0ID0gMDsgd19pdCA8IG51bVdoZWVsczsgd19pdCsrKSB7CiAgICAgICAgY29uc3Qgd2hlZWwgPSB3aGVlbEluZm9zW3dfaXRdOwoKICAgICAgICBpZiAod2hlZWwuaXNJbkNvbnRhY3QpIHsKICAgICAgICAgIGxldCBmb3JjZTsgLy8gU3ByaW5nCgogICAgICAgICAgY29uc3Qgc3VzcF9sZW5ndGggPSB3aGVlbC5zdXNwZW5zaW9uUmVzdExlbmd0aDsKICAgICAgICAgIGNvbnN0IGN1cnJlbnRfbGVuZ3RoID0gd2hlZWwuc3VzcGVuc2lvbkxlbmd0aDsKICAgICAgICAgIGNvbnN0IGxlbmd0aF9kaWZmID0gc3VzcF9sZW5ndGggLSBjdXJyZW50X2xlbmd0aDsKICAgICAgICAgIGZvcmNlID0gd2hlZWwuc3VzcGVuc2lvblN0aWZmbmVzcyAqIGxlbmd0aF9kaWZmICogd2hlZWwuY2xpcHBlZEludkNvbnRhY3REb3RTdXNwZW5zaW9uOyAvLyBEYW1wZXIKCiAgICAgICAgICBjb25zdCBwcm9qZWN0ZWRfcmVsX3ZlbCA9IHdoZWVsLnN1c3BlbnNpb25SZWxhdGl2ZVZlbG9jaXR5OwogICAgICAgICAgbGV0IHN1c3BfZGFtcGluZzsKCiAgICAgICAgICBpZiAocHJvamVjdGVkX3JlbF92ZWwgPCAwKSB7CiAgICAgICAgICAgIHN1c3BfZGFtcGluZyA9IHdoZWVsLmRhbXBpbmdDb21wcmVzc2lvbjsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHN1c3BfZGFtcGluZyA9IHdoZWVsLmRhbXBpbmdSZWxheGF0aW9uOwogICAgICAgICAgfQoKICAgICAgICAgIGZvcmNlIC09IHN1c3BfZGFtcGluZyAqIHByb2plY3RlZF9yZWxfdmVsOwogICAgICAgICAgd2hlZWwuc3VzcGVuc2lvbkZvcmNlID0gZm9yY2UgKiBjaGFzc2lzTWFzczsKCiAgICAgICAgICBpZiAod2hlZWwuc3VzcGVuc2lvbkZvcmNlIDwgMCkgewogICAgICAgICAgICB3aGVlbC5zdXNwZW5zaW9uRm9yY2UgPSAwOwogICAgICAgICAgfQogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICB3aGVlbC5zdXNwZW5zaW9uRm9yY2UgPSAwOwogICAgICAgIH0KICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBSZW1vdmUgdGhlIHZlaGljbGUgaW5jbHVkaW5nIGl0cyBjb25zdHJhaW50cyBmcm9tIHRoZSB3b3JsZC4KICAgICAqLwoKCiAgICByZW1vdmVGcm9tV29ybGQod29ybGQpIHsKICAgICAgdGhpcy5jb25zdHJhaW50czsKICAgICAgd29ybGQucmVtb3ZlQm9keSh0aGlzLmNoYXNzaXNCb2R5KTsKICAgICAgd29ybGQucmVtb3ZlRXZlbnRMaXN0ZW5lcigncHJlU3RlcCcsIHRoaXMucHJlU3RlcENhbGxiYWNrKTsKICAgICAgdGhpcy53b3JsZCA9IG51bGw7CiAgICB9CgogICAgY2FzdFJheSh3aGVlbCkgewogICAgICBjb25zdCByYXl2ZWN0b3IgPSBjYXN0UmF5X3JheXZlY3RvcjsKICAgICAgY29uc3QgdGFyZ2V0ID0gY2FzdFJheV90YXJnZXQ7CiAgICAgIHRoaXMudXBkYXRlV2hlZWxUcmFuc2Zvcm1Xb3JsZCh3aGVlbCk7CiAgICAgIGNvbnN0IGNoYXNzaXNCb2R5ID0gdGhpcy5jaGFzc2lzQm9keTsKICAgICAgbGV0IGRlcHRoID0gLTE7CiAgICAgIGNvbnN0IHJheWxlbiA9IHdoZWVsLnN1c3BlbnNpb25SZXN0TGVuZ3RoICsgd2hlZWwucmFkaXVzOwogICAgICB3aGVlbC5kaXJlY3Rpb25Xb3JsZC5zY2FsZShyYXlsZW4sIHJheXZlY3Rvcik7CiAgICAgIGNvbnN0IHNvdXJjZSA9IHdoZWVsLmNoYXNzaXNDb25uZWN0aW9uUG9pbnRXb3JsZDsKICAgICAgc291cmNlLnZhZGQocmF5dmVjdG9yLCB0YXJnZXQpOwogICAgICBjb25zdCByYXljYXN0UmVzdWx0ID0gd2hlZWwucmF5Y2FzdFJlc3VsdDsKICAgICAgcmF5Y2FzdFJlc3VsdC5yZXNldCgpOyAvLyBUdXJuIG9mZiByYXkgY29sbGlzaW9uIHdpdGggdGhlIGNoYXNzaXMgdGVtcG9yYXJpbHkKCiAgICAgIGNvbnN0IG9sZFN0YXRlID0gY2hhc3Npc0JvZHkuY29sbGlzaW9uUmVzcG9uc2U7CiAgICAgIGNoYXNzaXNCb2R5LmNvbGxpc2lvblJlc3BvbnNlID0gZmFsc2U7IC8vIENhc3QgcmF5IGFnYWluc3Qgd29ybGQKCiAgICAgIHRoaXMud29ybGQucmF5VGVzdChzb3VyY2UsIHRhcmdldCwgcmF5Y2FzdFJlc3VsdCk7CiAgICAgIGNoYXNzaXNCb2R5LmNvbGxpc2lvblJlc3BvbnNlID0gb2xkU3RhdGU7CiAgICAgIGNvbnN0IG9iamVjdCA9IHJheWNhc3RSZXN1bHQuYm9keTsKICAgICAgd2hlZWwucmF5Y2FzdFJlc3VsdC5ncm91bmRPYmplY3QgPSAwOwoKICAgICAgaWYgKG9iamVjdCkgewogICAgICAgIGRlcHRoID0gcmF5Y2FzdFJlc3VsdC5kaXN0YW5jZTsKICAgICAgICB3aGVlbC5yYXljYXN0UmVzdWx0LmhpdE5vcm1hbFdvcmxkID0gcmF5Y2FzdFJlc3VsdC5oaXROb3JtYWxXb3JsZDsKICAgICAgICB3aGVlbC5pc0luQ29udGFjdCA9IHRydWU7CiAgICAgICAgY29uc3QgaGl0RGlzdGFuY2UgPSByYXljYXN0UmVzdWx0LmRpc3RhbmNlOwogICAgICAgIHdoZWVsLnN1c3BlbnNpb25MZW5ndGggPSBoaXREaXN0YW5jZSAtIHdoZWVsLnJhZGl1czsgLy8gY2xhbXAgb24gbWF4IHN1c3BlbnNpb24gdHJhdmVsCgogICAgICAgIGNvbnN0IG1pblN1c3BlbnNpb25MZW5ndGggPSB3aGVlbC5zdXNwZW5zaW9uUmVzdExlbmd0aCAtIHdoZWVsLm1heFN1c3BlbnNpb25UcmF2ZWw7CiAgICAgICAgY29uc3QgbWF4U3VzcGVuc2lvbkxlbmd0aCA9IHdoZWVsLnN1c3BlbnNpb25SZXN0TGVuZ3RoICsgd2hlZWwubWF4U3VzcGVuc2lvblRyYXZlbDsKCiAgICAgICAgaWYgKHdoZWVsLnN1c3BlbnNpb25MZW5ndGggPCBtaW5TdXNwZW5zaW9uTGVuZ3RoKSB7CiAgICAgICAgICB3aGVlbC5zdXNwZW5zaW9uTGVuZ3RoID0gbWluU3VzcGVuc2lvbkxlbmd0aDsKICAgICAgICB9CgogICAgICAgIGlmICh3aGVlbC5zdXNwZW5zaW9uTGVuZ3RoID4gbWF4U3VzcGVuc2lvbkxlbmd0aCkgewogICAgICAgICAgd2hlZWwuc3VzcGVuc2lvbkxlbmd0aCA9IG1heFN1c3BlbnNpb25MZW5ndGg7CiAgICAgICAgICB3aGVlbC5yYXljYXN0UmVzdWx0LnJlc2V0KCk7CiAgICAgICAgfQoKICAgICAgICBjb25zdCBkZW5vbWluYXRvciA9IHdoZWVsLnJheWNhc3RSZXN1bHQuaGl0Tm9ybWFsV29ybGQuZG90KHdoZWVsLmRpcmVjdGlvbldvcmxkKTsKICAgICAgICBjb25zdCBjaGFzc2lzX3ZlbG9jaXR5X2F0X2NvbnRhY3RQb2ludCA9IG5ldyBWZWMzKCk7CiAgICAgICAgY2hhc3Npc0JvZHkuZ2V0VmVsb2NpdHlBdFdvcmxkUG9pbnQod2hlZWwucmF5Y2FzdFJlc3VsdC5oaXRQb2ludFdvcmxkLCBjaGFzc2lzX3ZlbG9jaXR5X2F0X2NvbnRhY3RQb2ludCk7CiAgICAgICAgY29uc3QgcHJvalZlbCA9IHdoZWVsLnJheWNhc3RSZXN1bHQuaGl0Tm9ybWFsV29ybGQuZG90KGNoYXNzaXNfdmVsb2NpdHlfYXRfY29udGFjdFBvaW50KTsKCiAgICAgICAgaWYgKGRlbm9taW5hdG9yID49IC0wLjEpIHsKICAgICAgICAgIHdoZWVsLnN1c3BlbnNpb25SZWxhdGl2ZVZlbG9jaXR5ID0gMDsKICAgICAgICAgIHdoZWVsLmNsaXBwZWRJbnZDb250YWN0RG90U3VzcGVuc2lvbiA9IDEgLyAwLjE7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGNvbnN0IGludiA9IC0xIC8gZGVub21pbmF0b3I7CiAgICAgICAgICB3aGVlbC5zdXNwZW5zaW9uUmVsYXRpdmVWZWxvY2l0eSA9IHByb2pWZWwgKiBpbnY7CiAgICAgICAgICB3aGVlbC5jbGlwcGVkSW52Q29udGFjdERvdFN1c3BlbnNpb24gPSBpbnY7CiAgICAgICAgfQogICAgICB9IGVsc2UgewogICAgICAgIC8vcHV0IHdoZWVsIGluZm8gYXMgaW4gcmVzdCBwb3NpdGlvbgogICAgICAgIHdoZWVsLnN1c3BlbnNpb25MZW5ndGggPSB3aGVlbC5zdXNwZW5zaW9uUmVzdExlbmd0aCArIDAgKiB3aGVlbC5tYXhTdXNwZW5zaW9uVHJhdmVsOwogICAgICAgIHdoZWVsLnN1c3BlbnNpb25SZWxhdGl2ZVZlbG9jaXR5ID0gMC4wOwogICAgICAgIHdoZWVsLmRpcmVjdGlvbldvcmxkLnNjYWxlKC0xLCB3aGVlbC5yYXljYXN0UmVzdWx0LmhpdE5vcm1hbFdvcmxkKTsKICAgICAgICB3aGVlbC5jbGlwcGVkSW52Q29udGFjdERvdFN1c3BlbnNpb24gPSAxLjA7CiAgICAgIH0KCiAgICAgIHJldHVybiBkZXB0aDsKICAgIH0KCiAgICB1cGRhdGVXaGVlbFRyYW5zZm9ybVdvcmxkKHdoZWVsKSB7CiAgICAgIHdoZWVsLmlzSW5Db250YWN0ID0gZmFsc2U7CiAgICAgIGNvbnN0IGNoYXNzaXNCb2R5ID0gdGhpcy5jaGFzc2lzQm9keTsKICAgICAgY2hhc3Npc0JvZHkucG9pbnRUb1dvcmxkRnJhbWUod2hlZWwuY2hhc3Npc0Nvbm5lY3Rpb25Qb2ludExvY2FsLCB3aGVlbC5jaGFzc2lzQ29ubmVjdGlvblBvaW50V29ybGQpOwogICAgICBjaGFzc2lzQm9keS52ZWN0b3JUb1dvcmxkRnJhbWUod2hlZWwuZGlyZWN0aW9uTG9jYWwsIHdoZWVsLmRpcmVjdGlvbldvcmxkKTsKICAgICAgY2hhc3Npc0JvZHkudmVjdG9yVG9Xb3JsZEZyYW1lKHdoZWVsLmF4bGVMb2NhbCwgd2hlZWwuYXhsZVdvcmxkKTsKICAgIH0KICAgIC8qKgogICAgICogVXBkYXRlIG9uZSBvZiB0aGUgd2hlZWwgdHJhbnNmb3JtLgogICAgICogTm90ZSB3aGVuIHJlbmRlcmluZyB3aGVlbHM6IGR1cmluZyBlYWNoIHN0ZXAsIHdoZWVsIHRyYW5zZm9ybXMgYXJlIHVwZGF0ZWQgQkVGT1JFIHRoZSBjaGFzc2lzOyBpZS4gdGhlaXIgcG9zaXRpb24gYmVjb21lcyBpbnZhbGlkIGFmdGVyIHRoZSBzdGVwLiBUaHVzIHdoZW4geW91IHJlbmRlciB3aGVlbHMsIHlvdSBtdXN0IHVwZGF0ZSB3aGVlbCB0cmFuc2Zvcm1zIGJlZm9yZSByZW5kZXJpbmcgdGhlbS4gU2VlIHJheWNhc3RWZWhpY2xlIGRlbW8gZm9yIGFuIGV4YW1wbGUuCiAgICAgKiBAcGFyYW0gd2hlZWxJbmRleCBUaGUgd2hlZWwgaW5kZXggdG8gdXBkYXRlLgogICAgICovCgoKICAgIHVwZGF0ZVdoZWVsVHJhbnNmb3JtKHdoZWVsSW5kZXgpIHsKICAgICAgY29uc3QgdXAgPSB0bXBWZWM0OwogICAgICBjb25zdCByaWdodCA9IHRtcFZlYzU7CiAgICAgIGNvbnN0IGZ3ZCA9IHRtcFZlYzY7CiAgICAgIGNvbnN0IHdoZWVsID0gdGhpcy53aGVlbEluZm9zW3doZWVsSW5kZXhdOwogICAgICB0aGlzLnVwZGF0ZVdoZWVsVHJhbnNmb3JtV29ybGQod2hlZWwpOwogICAgICB3aGVlbC5kaXJlY3Rpb25Mb2NhbC5zY2FsZSgtMSwgdXApOwogICAgICByaWdodC5jb3B5KHdoZWVsLmF4bGVMb2NhbCk7CiAgICAgIHVwLmNyb3NzKHJpZ2h0LCBmd2QpOwogICAgICBmd2Qubm9ybWFsaXplKCk7CiAgICAgIHJpZ2h0Lm5vcm1hbGl6ZSgpOyAvLyBSb3RhdGUgYXJvdW5kIHN0ZWVyaW5nIG92ZXIgdGhlIHdoZWVsQXhsZQoKICAgICAgY29uc3Qgc3RlZXJpbmcgPSB3aGVlbC5zdGVlcmluZzsKICAgICAgY29uc3Qgc3RlZXJpbmdPcm4gPSBuZXcgUXVhdGVybmlvbigpOwogICAgICBzdGVlcmluZ09ybi5zZXRGcm9tQXhpc0FuZ2xlKHVwLCBzdGVlcmluZyk7CiAgICAgIGNvbnN0IHJvdGF0aW5nT3JuID0gbmV3IFF1YXRlcm5pb24oKTsKICAgICAgcm90YXRpbmdPcm4uc2V0RnJvbUF4aXNBbmdsZShyaWdodCwgd2hlZWwucm90YXRpb24pOyAvLyBXb3JsZCByb3RhdGlvbiBvZiB0aGUgd2hlZWwKCiAgICAgIGNvbnN0IHEgPSB3aGVlbC53b3JsZFRyYW5zZm9ybS5xdWF0ZXJuaW9uOwogICAgICB0aGlzLmNoYXNzaXNCb2R5LnF1YXRlcm5pb24ubXVsdChzdGVlcmluZ09ybiwgcSk7CiAgICAgIHEubXVsdChyb3RhdGluZ09ybiwgcSk7CiAgICAgIHEubm9ybWFsaXplKCk7IC8vIHdvcmxkIHBvc2l0aW9uIG9mIHRoZSB3aGVlbAoKICAgICAgY29uc3QgcCA9IHdoZWVsLndvcmxkVHJhbnNmb3JtLnBvc2l0aW9uOwogICAgICBwLmNvcHkod2hlZWwuZGlyZWN0aW9uV29ybGQpOwogICAgICBwLnNjYWxlKHdoZWVsLnN1c3BlbnNpb25MZW5ndGgsIHApOwogICAgICBwLnZhZGQod2hlZWwuY2hhc3Npc0Nvbm5lY3Rpb25Qb2ludFdvcmxkLCBwKTsKICAgIH0KICAgIC8qKgogICAgICogR2V0IHRoZSB3b3JsZCB0cmFuc2Zvcm0gb2Ygb25lIG9mIHRoZSB3aGVlbHMKICAgICAqLwoKCiAgICBnZXRXaGVlbFRyYW5zZm9ybVdvcmxkKHdoZWVsSW5kZXgpIHsKICAgICAgcmV0dXJuIHRoaXMud2hlZWxJbmZvc1t3aGVlbEluZGV4XS53b3JsZFRyYW5zZm9ybTsKICAgIH0KCiAgICB1cGRhdGVGcmljdGlvbih0aW1lU3RlcCkgewogICAgICBjb25zdCBzdXJmTm9ybWFsV1Nfc2NhbGVkX3Byb2ogPSB1cGRhdGVGcmljdGlvbl9zdXJmTm9ybWFsV1Nfc2NhbGVkX3Byb2o7IC8vY2FsY3VsYXRlIHRoZSBpbXB1bHNlLCBzbyB0aGF0IHRoZSB3aGVlbHMgZG9uJ3QgbW92ZSBzaWRld2FyZHMKCiAgICAgIGNvbnN0IHdoZWVsSW5mb3MgPSB0aGlzLndoZWVsSW5mb3M7CiAgICAgIGNvbnN0IG51bVdoZWVscyA9IHdoZWVsSW5mb3MubGVuZ3RoOwogICAgICBjb25zdCBjaGFzc2lzQm9keSA9IHRoaXMuY2hhc3Npc0JvZHk7CiAgICAgIGNvbnN0IGZvcndhcmRXUyA9IHVwZGF0ZUZyaWN0aW9uX2ZvcndhcmRXUzsKICAgICAgY29uc3QgYXhsZSA9IHVwZGF0ZUZyaWN0aW9uX2F4bGU7CiAgICAgIHRoaXMubnVtV2hlZWxzT25Hcm91bmQgPSAwOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBudW1XaGVlbHM7IGkrKykgewogICAgICAgIGNvbnN0IHdoZWVsID0gd2hlZWxJbmZvc1tpXTsKICAgICAgICBjb25zdCBncm91bmRPYmplY3QgPSB3aGVlbC5yYXljYXN0UmVzdWx0LmJvZHk7CgogICAgICAgIGlmIChncm91bmRPYmplY3QpIHsKICAgICAgICAgIHRoaXMubnVtV2hlZWxzT25Hcm91bmQrKzsKICAgICAgICB9CgogICAgICAgIHdoZWVsLnNpZGVJbXB1bHNlID0gMDsKICAgICAgICB3aGVlbC5mb3J3YXJkSW1wdWxzZSA9IDA7CgogICAgICAgIGlmICghZm9yd2FyZFdTW2ldKSB7CiAgICAgICAgICBmb3J3YXJkV1NbaV0gPSBuZXcgVmVjMygpOwogICAgICAgIH0KCiAgICAgICAgaWYgKCFheGxlW2ldKSB7CiAgICAgICAgICBheGxlW2ldID0gbmV3IFZlYzMoKTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbnVtV2hlZWxzOyBpKyspIHsKICAgICAgICBjb25zdCB3aGVlbCA9IHdoZWVsSW5mb3NbaV07CiAgICAgICAgY29uc3QgZ3JvdW5kT2JqZWN0ID0gd2hlZWwucmF5Y2FzdFJlc3VsdC5ib2R5OwoKICAgICAgICBpZiAoZ3JvdW5kT2JqZWN0KSB7CiAgICAgICAgICBjb25zdCBheGxlaSA9IGF4bGVbaV07CiAgICAgICAgICBjb25zdCB3aGVlbFRyYW5zID0gdGhpcy5nZXRXaGVlbFRyYW5zZm9ybVdvcmxkKGkpOyAvLyBHZXQgd29ybGQgYXhsZQoKICAgICAgICAgIHdoZWVsVHJhbnMudmVjdG9yVG9Xb3JsZEZyYW1lKGRpcmVjdGlvbnNbdGhpcy5pbmRleFJpZ2h0QXhpc10sIGF4bGVpKTsKICAgICAgICAgIGNvbnN0IHN1cmZOb3JtYWxXUyA9IHdoZWVsLnJheWNhc3RSZXN1bHQuaGl0Tm9ybWFsV29ybGQ7CiAgICAgICAgICBjb25zdCBwcm9qID0gYXhsZWkuZG90KHN1cmZOb3JtYWxXUyk7CiAgICAgICAgICBzdXJmTm9ybWFsV1Muc2NhbGUocHJvaiwgc3VyZk5vcm1hbFdTX3NjYWxlZF9wcm9qKTsKICAgICAgICAgIGF4bGVpLnZzdWIoc3VyZk5vcm1hbFdTX3NjYWxlZF9wcm9qLCBheGxlaSk7CiAgICAgICAgICBheGxlaS5ub3JtYWxpemUoKTsKICAgICAgICAgIHN1cmZOb3JtYWxXUy5jcm9zcyhheGxlaSwgZm9yd2FyZFdTW2ldKTsKICAgICAgICAgIGZvcndhcmRXU1tpXS5ub3JtYWxpemUoKTsKICAgICAgICAgIHdoZWVsLnNpZGVJbXB1bHNlID0gcmVzb2x2ZVNpbmdsZUJpbGF0ZXJhbChjaGFzc2lzQm9keSwgd2hlZWwucmF5Y2FzdFJlc3VsdC5oaXRQb2ludFdvcmxkLCBncm91bmRPYmplY3QsIHdoZWVsLnJheWNhc3RSZXN1bHQuaGl0UG9pbnRXb3JsZCwgYXhsZWkpOwogICAgICAgICAgd2hlZWwuc2lkZUltcHVsc2UgKj0gc2lkZUZyaWN0aW9uU3RpZmZuZXNzMjsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIGNvbnN0IHNpZGVGYWN0b3IgPSAxOwogICAgICBjb25zdCBmd2RGYWN0b3IgPSAwLjU7CiAgICAgIHRoaXMuc2xpZGluZyA9IGZhbHNlOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBudW1XaGVlbHM7IGkrKykgewogICAgICAgIGNvbnN0IHdoZWVsID0gd2hlZWxJbmZvc1tpXTsKICAgICAgICBjb25zdCBncm91bmRPYmplY3QgPSB3aGVlbC5yYXljYXN0UmVzdWx0LmJvZHk7CiAgICAgICAgbGV0IHJvbGxpbmdGcmljdGlvbiA9IDA7CiAgICAgICAgd2hlZWwuc2xpcEluZm8gPSAxOwoKICAgICAgICBpZiAoZ3JvdW5kT2JqZWN0KSB7CiAgICAgICAgICBjb25zdCBkZWZhdWx0Um9sbGluZ0ZyaWN0aW9uSW1wdWxzZSA9IDA7CiAgICAgICAgICBjb25zdCBtYXhJbXB1bHNlID0gd2hlZWwuYnJha2UgPyB3aGVlbC5icmFrZSA6IGRlZmF1bHRSb2xsaW5nRnJpY3Rpb25JbXB1bHNlOyAvLyBidFdoZWVsQ29udGFjdFBvaW50IGNvbnRhY3RQdChjaGFzc2lzQm9keSxncm91bmRPYmplY3Qsd2hlZWxJbmZyYXljYXN0SW5mby5oaXRQb2ludFdvcmxkLGZvcndhcmRXU1t3aGVlbF0sbWF4SW1wdWxzZSk7CiAgICAgICAgICAvLyByb2xsaW5nRnJpY3Rpb24gPSBjYWxjUm9sbGluZ0ZyaWN0aW9uKGNvbnRhY3RQdCk7CgogICAgICAgICAgcm9sbGluZ0ZyaWN0aW9uID0gY2FsY1JvbGxpbmdGcmljdGlvbihjaGFzc2lzQm9keSwgZ3JvdW5kT2JqZWN0LCB3aGVlbC5yYXljYXN0UmVzdWx0LmhpdFBvaW50V29ybGQsIGZvcndhcmRXU1tpXSwgbWF4SW1wdWxzZSk7CiAgICAgICAgICByb2xsaW5nRnJpY3Rpb24gKz0gd2hlZWwuZW5naW5lRm9yY2UgKiB0aW1lU3RlcDsgLy8gcm9sbGluZ0ZyaWN0aW9uID0gMDsKCiAgICAgICAgICBjb25zdCBmYWN0b3IgPSBtYXhJbXB1bHNlIC8gcm9sbGluZ0ZyaWN0aW9uOwogICAgICAgICAgd2hlZWwuc2xpcEluZm8gKj0gZmFjdG9yOwogICAgICAgIH0gLy9zd2l0Y2ggYmV0d2VlbiBhY3RpdmUgcm9sbGluZyAodGhyb3R0bGUpLCBicmFraW5nIGFuZCBub24tYWN0aXZlIHJvbGxpbmcgZnJpY3Rpb24gKG50aHJvdHRsZS9icmVhaykKCgogICAgICAgIHdoZWVsLmZvcndhcmRJbXB1bHNlID0gMDsKICAgICAgICB3aGVlbC5za2lkSW5mbyA9IDE7CgogICAgICAgIGlmIChncm91bmRPYmplY3QpIHsKICAgICAgICAgIHdoZWVsLnNraWRJbmZvID0gMTsKICAgICAgICAgIGNvbnN0IG1heGltcCA9IHdoZWVsLnN1c3BlbnNpb25Gb3JjZSAqIHRpbWVTdGVwICogd2hlZWwuZnJpY3Rpb25TbGlwOwogICAgICAgICAgY29uc3QgbWF4aW1wU2lkZSA9IG1heGltcDsKICAgICAgICAgIGNvbnN0IG1heGltcFNxdWFyZWQgPSBtYXhpbXAgKiBtYXhpbXBTaWRlOwogICAgICAgICAgd2hlZWwuZm9yd2FyZEltcHVsc2UgPSByb2xsaW5nRnJpY3Rpb247IC8vd2hlZWxJbmZvLmVuZ2luZUZvcmNlKiB0aW1lU3RlcDsKCiAgICAgICAgICBjb25zdCB4ID0gd2hlZWwuZm9yd2FyZEltcHVsc2UgKiBmd2RGYWN0b3IgLyB3aGVlbC5mb3J3YXJkQWNjZWxlcmF0aW9uOwogICAgICAgICAgY29uc3QgeSA9IHdoZWVsLnNpZGVJbXB1bHNlICogc2lkZUZhY3RvciAvIHdoZWVsLnNpZGVBY2NlbGVyYXRpb247CiAgICAgICAgICBjb25zdCBpbXB1bHNlU3F1YXJlZCA9IHggKiB4ICsgeSAqIHk7CiAgICAgICAgICB3aGVlbC5zbGlkaW5nID0gZmFsc2U7CgogICAgICAgICAgaWYgKGltcHVsc2VTcXVhcmVkID4gbWF4aW1wU3F1YXJlZCkgewogICAgICAgICAgICB0aGlzLnNsaWRpbmcgPSB0cnVlOwogICAgICAgICAgICB3aGVlbC5zbGlkaW5nID0gdHJ1ZTsKICAgICAgICAgICAgY29uc3QgZmFjdG9yID0gbWF4aW1wIC8gTWF0aC5zcXJ0KGltcHVsc2VTcXVhcmVkKTsKICAgICAgICAgICAgd2hlZWwuc2tpZEluZm8gKj0gZmFjdG9yOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQoKICAgICAgaWYgKHRoaXMuc2xpZGluZykgewogICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbnVtV2hlZWxzOyBpKyspIHsKICAgICAgICAgIGNvbnN0IHdoZWVsID0gd2hlZWxJbmZvc1tpXTsKCiAgICAgICAgICBpZiAod2hlZWwuc2lkZUltcHVsc2UgIT09IDApIHsKICAgICAgICAgICAgaWYgKHdoZWVsLnNraWRJbmZvIDwgMSkgewogICAgICAgICAgICAgIHdoZWVsLmZvcndhcmRJbXB1bHNlICo9IHdoZWVsLnNraWRJbmZvOwogICAgICAgICAgICAgIHdoZWVsLnNpZGVJbXB1bHNlICo9IHdoZWVsLnNraWRJbmZvOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9IC8vIGFwcGx5IHRoZSBpbXB1bHNlcwoKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbnVtV2hlZWxzOyBpKyspIHsKICAgICAgICBjb25zdCB3aGVlbCA9IHdoZWVsSW5mb3NbaV07CiAgICAgICAgY29uc3QgcmVsX3BvcyA9IG5ldyBWZWMzKCk7CiAgICAgICAgd2hlZWwucmF5Y2FzdFJlc3VsdC5oaXRQb2ludFdvcmxkLnZzdWIoY2hhc3Npc0JvZHkucG9zaXRpb24sIHJlbF9wb3MpOyAvLyBjYW5ub25zIGFwcGx5aW1wdWxzZSBpcyB1c2luZyB3b3JsZCBjb29yZCBmb3IgdGhlIHBvc2l0aW9uCiAgICAgICAgLy9yZWxfcG9zLmNvcHkod2hlZWwucmF5Y2FzdFJlc3VsdC5oaXRQb2ludFdvcmxkKTsKCiAgICAgICAgaWYgKHdoZWVsLmZvcndhcmRJbXB1bHNlICE9PSAwKSB7CiAgICAgICAgICBjb25zdCBpbXB1bHNlID0gbmV3IFZlYzMoKTsKICAgICAgICAgIGZvcndhcmRXU1tpXS5zY2FsZSh3aGVlbC5mb3J3YXJkSW1wdWxzZSwgaW1wdWxzZSk7CiAgICAgICAgICBjaGFzc2lzQm9keS5hcHBseUltcHVsc2UoaW1wdWxzZSwgcmVsX3Bvcyk7CiAgICAgICAgfQoKICAgICAgICBpZiAod2hlZWwuc2lkZUltcHVsc2UgIT09IDApIHsKICAgICAgICAgIGNvbnN0IGdyb3VuZE9iamVjdCA9IHdoZWVsLnJheWNhc3RSZXN1bHQuYm9keTsKICAgICAgICAgIGNvbnN0IHJlbF9wb3MyID0gbmV3IFZlYzMoKTsKICAgICAgICAgIHdoZWVsLnJheWNhc3RSZXN1bHQuaGl0UG9pbnRXb3JsZC52c3ViKGdyb3VuZE9iamVjdC5wb3NpdGlvbiwgcmVsX3BvczIpOyAvL3JlbF9wb3MyLmNvcHkod2hlZWwucmF5Y2FzdFJlc3VsdC5oaXRQb2ludFdvcmxkKTsKCiAgICAgICAgICBjb25zdCBzaWRlSW1wID0gbmV3IFZlYzMoKTsKICAgICAgICAgIGF4bGVbaV0uc2NhbGUod2hlZWwuc2lkZUltcHVsc2UsIHNpZGVJbXApOyAvLyBTY2FsZSB0aGUgcmVsYXRpdmUgcG9zaXRpb24gaW4gdGhlIHVwIGRpcmVjdGlvbiB3aXRoIHJvbGxJbmZsdWVuY2UuCiAgICAgICAgICAvLyBJZiByb2xsSW5mbHVlbmNlIGlzIDEsIHRoZSBpbXB1bHNlIHdpbGwgYmUgYXBwbGllZCBvbiB0aGUgaGl0UG9pbnQgKGVhc3kgdG8gcm9sbCBvdmVyKSwgaWYgaXQgaXMgemVybyBpdCB3aWxsIGJlIGFwcGxpZWQgaW4gdGhlIHNhbWUgcGxhbmUgYXMgdGhlIGNlbnRlciBvZiBtYXNzIChub3QgZWFzeSB0byByb2xsIG92ZXIpLgoKICAgICAgICAgIGNoYXNzaXNCb2R5LnZlY3RvclRvTG9jYWxGcmFtZShyZWxfcG9zLCByZWxfcG9zKTsKICAgICAgICAgIHJlbF9wb3NbJ3h5eidbdGhpcy5pbmRleFVwQXhpc11dICo9IHdoZWVsLnJvbGxJbmZsdWVuY2U7CiAgICAgICAgICBjaGFzc2lzQm9keS52ZWN0b3JUb1dvcmxkRnJhbWUocmVsX3BvcywgcmVsX3Bvcyk7CiAgICAgICAgICBjaGFzc2lzQm9keS5hcHBseUltcHVsc2Uoc2lkZUltcCwgcmVsX3Bvcyk7IC8vYXBwbHkgZnJpY3Rpb24gaW1wdWxzZSBvbiB0aGUgZ3JvdW5kCgogICAgICAgICAgc2lkZUltcC5zY2FsZSgtMSwgc2lkZUltcCk7CiAgICAgICAgICBncm91bmRPYmplY3QuYXBwbHlJbXB1bHNlKHNpZGVJbXAsIHJlbF9wb3MyKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KCiAgfQogIG5ldyBWZWMzKCk7CiAgbmV3IFZlYzMoKTsKICBuZXcgVmVjMygpOwogIGNvbnN0IHRtcFZlYzQgPSBuZXcgVmVjMygpOwogIGNvbnN0IHRtcFZlYzUgPSBuZXcgVmVjMygpOwogIGNvbnN0IHRtcFZlYzYgPSBuZXcgVmVjMygpOwogIG5ldyBSYXkoKTsKICBuZXcgVmVjMygpOwogIGNvbnN0IGNhc3RSYXlfcmF5dmVjdG9yID0gbmV3IFZlYzMoKTsKICBjb25zdCBjYXN0UmF5X3RhcmdldCA9IG5ldyBWZWMzKCk7CiAgY29uc3QgZGlyZWN0aW9ucyA9IFtuZXcgVmVjMygxLCAwLCAwKSwgbmV3IFZlYzMoMCwgMSwgMCksIG5ldyBWZWMzKDAsIDAsIDEpXTsKICBjb25zdCB1cGRhdGVGcmljdGlvbl9zdXJmTm9ybWFsV1Nfc2NhbGVkX3Byb2ogPSBuZXcgVmVjMygpOwogIGNvbnN0IHVwZGF0ZUZyaWN0aW9uX2F4bGUgPSBbXTsKICBjb25zdCB1cGRhdGVGcmljdGlvbl9mb3J3YXJkV1MgPSBbXTsKICBjb25zdCBzaWRlRnJpY3Rpb25TdGlmZm5lc3MyID0gMTsKICBjb25zdCBjYWxjUm9sbGluZ0ZyaWN0aW9uX3ZlbDEgPSBuZXcgVmVjMygpOwogIGNvbnN0IGNhbGNSb2xsaW5nRnJpY3Rpb25fdmVsMiA9IG5ldyBWZWMzKCk7CiAgY29uc3QgY2FsY1JvbGxpbmdGcmljdGlvbl92ZWwgPSBuZXcgVmVjMygpOwoKICBmdW5jdGlvbiBjYWxjUm9sbGluZ0ZyaWN0aW9uKGJvZHkwLCBib2R5MSwgZnJpY3Rpb25Qb3NXb3JsZCwgZnJpY3Rpb25EaXJlY3Rpb25Xb3JsZCwgbWF4SW1wdWxzZSkgewogICAgbGV0IGoxID0gMDsKICAgIGNvbnN0IGNvbnRhY3RQb3NXb3JsZCA9IGZyaWN0aW9uUG9zV29ybGQ7IC8vIGNvbnN0IHJlbF9wb3MxID0gbmV3IFZlYzMoKTsKICAgIC8vIGNvbnN0IHJlbF9wb3MyID0gbmV3IFZlYzMoKTsKCiAgICBjb25zdCB2ZWwxID0gY2FsY1JvbGxpbmdGcmljdGlvbl92ZWwxOwogICAgY29uc3QgdmVsMiA9IGNhbGNSb2xsaW5nRnJpY3Rpb25fdmVsMjsKICAgIGNvbnN0IHZlbCA9IGNhbGNSb2xsaW5nRnJpY3Rpb25fdmVsOyAvLyBjb250YWN0UG9zV29ybGQudnN1Yihib2R5MC5wb3NpdGlvbiwgcmVsX3BvczEpOwogICAgLy8gY29udGFjdFBvc1dvcmxkLnZzdWIoYm9keTEucG9zaXRpb24sIHJlbF9wb3MyKTsKCiAgICBib2R5MC5nZXRWZWxvY2l0eUF0V29ybGRQb2ludChjb250YWN0UG9zV29ybGQsIHZlbDEpOwogICAgYm9keTEuZ2V0VmVsb2NpdHlBdFdvcmxkUG9pbnQoY29udGFjdFBvc1dvcmxkLCB2ZWwyKTsKICAgIHZlbDEudnN1Yih2ZWwyLCB2ZWwpOwogICAgY29uc3QgdnJlbCA9IGZyaWN0aW9uRGlyZWN0aW9uV29ybGQuZG90KHZlbCk7CiAgICBjb25zdCBkZW5vbTAgPSBjb21wdXRlSW1wdWxzZURlbm9taW5hdG9yKGJvZHkwLCBmcmljdGlvblBvc1dvcmxkLCBmcmljdGlvbkRpcmVjdGlvbldvcmxkKTsKICAgIGNvbnN0IGRlbm9tMSA9IGNvbXB1dGVJbXB1bHNlRGVub21pbmF0b3IoYm9keTEsIGZyaWN0aW9uUG9zV29ybGQsIGZyaWN0aW9uRGlyZWN0aW9uV29ybGQpOwogICAgY29uc3QgcmVsYXhhdGlvbiA9IDE7CiAgICBjb25zdCBqYWNEaWFnQUJJbnYgPSByZWxheGF0aW9uIC8gKGRlbm9tMCArIGRlbm9tMSk7IC8vIGNhbGN1bGF0ZSBqIHRoYXQgbW92ZXMgdXMgdG8gemVybyByZWxhdGl2ZSB2ZWxvY2l0eQoKICAgIGoxID0gLXZyZWwgKiBqYWNEaWFnQUJJbnY7CgogICAgaWYgKG1heEltcHVsc2UgPCBqMSkgewogICAgICBqMSA9IG1heEltcHVsc2U7CiAgICB9CgogICAgaWYgKGoxIDwgLW1heEltcHVsc2UpIHsKICAgICAgajEgPSAtbWF4SW1wdWxzZTsKICAgIH0KCiAgICByZXR1cm4gajE7CiAgfQoKICBjb25zdCBjb21wdXRlSW1wdWxzZURlbm9taW5hdG9yX3IwID0gbmV3IFZlYzMoKTsKICBjb25zdCBjb21wdXRlSW1wdWxzZURlbm9taW5hdG9yX2MwID0gbmV3IFZlYzMoKTsKICBjb25zdCBjb21wdXRlSW1wdWxzZURlbm9taW5hdG9yX3ZlYyA9IG5ldyBWZWMzKCk7CiAgY29uc3QgY29tcHV0ZUltcHVsc2VEZW5vbWluYXRvcl9tID0gbmV3IFZlYzMoKTsKCiAgZnVuY3Rpb24gY29tcHV0ZUltcHVsc2VEZW5vbWluYXRvcihib2R5LCBwb3MsIG5vcm1hbCkgewogICAgY29uc3QgcjAgPSBjb21wdXRlSW1wdWxzZURlbm9taW5hdG9yX3IwOwogICAgY29uc3QgYzAgPSBjb21wdXRlSW1wdWxzZURlbm9taW5hdG9yX2MwOwogICAgY29uc3QgdmVjID0gY29tcHV0ZUltcHVsc2VEZW5vbWluYXRvcl92ZWM7CiAgICBjb25zdCBtID0gY29tcHV0ZUltcHVsc2VEZW5vbWluYXRvcl9tOwogICAgcG9zLnZzdWIoYm9keS5wb3NpdGlvbiwgcjApOwogICAgcjAuY3Jvc3Mobm9ybWFsLCBjMCk7CiAgICBib2R5LmludkluZXJ0aWFXb3JsZC52bXVsdChjMCwgbSk7CiAgICBtLmNyb3NzKHIwLCB2ZWMpOwogICAgcmV0dXJuIGJvZHkuaW52TWFzcyArIG5vcm1hbC5kb3QodmVjKTsKICB9CgogIGNvbnN0IHJlc29sdmVTaW5nbGVCaWxhdGVyYWxfdmVsMSA9IG5ldyBWZWMzKCk7CiAgY29uc3QgcmVzb2x2ZVNpbmdsZUJpbGF0ZXJhbF92ZWwyID0gbmV3IFZlYzMoKTsKICBjb25zdCByZXNvbHZlU2luZ2xlQmlsYXRlcmFsX3ZlbCA9IG5ldyBWZWMzKCk7IC8vIGJpbGF0ZXJhbCBjb25zdHJhaW50IGJldHdlZW4gdHdvIGR5bmFtaWMgb2JqZWN0cwoKICBmdW5jdGlvbiByZXNvbHZlU2luZ2xlQmlsYXRlcmFsKGJvZHkxLCBwb3MxLCBib2R5MiwgcG9zMiwgbm9ybWFsKSB7CiAgICBjb25zdCBub3JtYWxMZW5TcXIgPSBub3JtYWwubGVuZ3RoU3F1YXJlZCgpOwoKICAgIGlmIChub3JtYWxMZW5TcXIgPiAxLjEpIHsKICAgICAgcmV0dXJuIDA7IC8vIG5vIGltcHVsc2UKICAgIH0gLy8gY29uc3QgcmVsX3BvczEgPSBuZXcgVmVjMygpOwogICAgLy8gY29uc3QgcmVsX3BvczIgPSBuZXcgVmVjMygpOwogICAgLy8gcG9zMS52c3ViKGJvZHkxLnBvc2l0aW9uLCByZWxfcG9zMSk7CiAgICAvLyBwb3MyLnZzdWIoYm9keTIucG9zaXRpb24sIHJlbF9wb3MyKTsKCgogICAgY29uc3QgdmVsMSA9IHJlc29sdmVTaW5nbGVCaWxhdGVyYWxfdmVsMTsKICAgIGNvbnN0IHZlbDIgPSByZXNvbHZlU2luZ2xlQmlsYXRlcmFsX3ZlbDI7CiAgICBjb25zdCB2ZWwgPSByZXNvbHZlU2luZ2xlQmlsYXRlcmFsX3ZlbDsKICAgIGJvZHkxLmdldFZlbG9jaXR5QXRXb3JsZFBvaW50KHBvczEsIHZlbDEpOwogICAgYm9keTIuZ2V0VmVsb2NpdHlBdFdvcmxkUG9pbnQocG9zMiwgdmVsMik7CiAgICB2ZWwxLnZzdWIodmVsMiwgdmVsKTsKICAgIGNvbnN0IHJlbF92ZWwgPSBub3JtYWwuZG90KHZlbCk7CiAgICBjb25zdCBjb250YWN0RGFtcGluZyA9IDAuMjsKICAgIGNvbnN0IG1hc3NUZXJtID0gMSAvIChib2R5MS5pbnZNYXNzICsgYm9keTIuaW52TWFzcyk7CiAgICBjb25zdCBpbXB1bHNlID0gLWNvbnRhY3REYW1waW5nICogcmVsX3ZlbCAqIG1hc3NUZXJtOwogICAgcmV0dXJuIGltcHVsc2U7CiAgfQoKICAvKioKICAgKiBTcGhlcmljYWwgc2hhcGUKICAgKiBAZXhhbXBsZQogICAqICAgICBjb25zdCByYWRpdXMgPSAxCiAgICogICAgIGNvbnN0IHNwaGVyZVNoYXBlID0gbmV3IENBTk5PTi5TcGhlcmUocmFkaXVzKQogICAqICAgICBjb25zdCBzcGhlcmVCb2R5ID0gbmV3IENBTk5PTi5Cb2R5KHsgbWFzczogMSwgc2hhcGU6IHNwaGVyZVNoYXBlIH0pCiAgICogICAgIHdvcmxkLmFkZEJvZHkoc3BoZXJlQm9keSkKICAgKi8KICBjbGFzcyBTcGhlcmUgZXh0ZW5kcyBTaGFwZSB7CiAgICAvKioKICAgICAqIFRoZSByYWRpdXMgb2YgdGhlIHNwaGVyZS4KICAgICAqLwoKICAgIC8qKgogICAgICoKICAgICAqIEBwYXJhbSByYWRpdXMgVGhlIHJhZGl1cyBvZiB0aGUgc3BoZXJlLCBhIG5vbi1uZWdhdGl2ZSBudW1iZXIuCiAgICAgKi8KICAgIGNvbnN0cnVjdG9yKHJhZGl1cykgewogICAgICBzdXBlcih7CiAgICAgICAgdHlwZTogU2hhcGUudHlwZXMuU1BIRVJFCiAgICAgIH0pOwogICAgICB0aGlzLnJhZGl1cyA9IHJhZGl1cyAhPT0gdW5kZWZpbmVkID8gcmFkaXVzIDogMS4wOwoKICAgICAgaWYgKHRoaXMucmFkaXVzIDwgMCkgewogICAgICAgIHRocm93IG5ldyBFcnJvcignVGhlIHNwaGVyZSByYWRpdXMgY2Fubm90IGJlIG5lZ2F0aXZlLicpOwogICAgICB9CgogICAgICB0aGlzLnVwZGF0ZUJvdW5kaW5nU3BoZXJlUmFkaXVzKCk7CiAgICB9CiAgICAvKiogY2FsY3VsYXRlTG9jYWxJbmVydGlhICovCgoKICAgIGNhbGN1bGF0ZUxvY2FsSW5lcnRpYShtYXNzLCB0YXJnZXQpIHsKICAgICAgaWYgKHRhcmdldCA9PT0gdm9pZCAwKSB7CiAgICAgICAgdGFyZ2V0ID0gbmV3IFZlYzMoKTsKICAgICAgfQoKICAgICAgY29uc3QgSSA9IDIuMCAqIG1hc3MgKiB0aGlzLnJhZGl1cyAqIHRoaXMucmFkaXVzIC8gNS4wOwogICAgICB0YXJnZXQueCA9IEk7CiAgICAgIHRhcmdldC55ID0gSTsKICAgICAgdGFyZ2V0LnogPSBJOwogICAgICByZXR1cm4gdGFyZ2V0OwogICAgfQogICAgLyoqIHZvbHVtZSAqLwoKCiAgICB2b2x1bWUoKSB7CiAgICAgIHJldHVybiA0LjAgKiBNYXRoLlBJICogTWF0aC5wb3codGhpcy5yYWRpdXMsIDMpIC8gMy4wOwogICAgfQoKICAgIHVwZGF0ZUJvdW5kaW5nU3BoZXJlUmFkaXVzKCkgewogICAgICB0aGlzLmJvdW5kaW5nU3BoZXJlUmFkaXVzID0gdGhpcy5yYWRpdXM7CiAgICB9CgogICAgY2FsY3VsYXRlV29ybGRBQUJCKHBvcywgcXVhdCwgbWluLCBtYXgpIHsKICAgICAgY29uc3QgciA9IHRoaXMucmFkaXVzOwogICAgICBjb25zdCBheGVzID0gWyd4JywgJ3knLCAneiddOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBheGVzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgY29uc3QgYXggPSBheGVzW2ldOwogICAgICAgIG1pbltheF0gPSBwb3NbYXhdIC0gcjsKICAgICAgICBtYXhbYXhdID0gcG9zW2F4XSArIHI7CiAgICAgIH0KICAgIH0KCiAgfQogIG5ldyBWZWMzKCk7CiAgbmV3IFZlYzMoKTsKICBuZXcgVmVjMygpOyAvLyBUZW1wIHZlY3RvcnMgZm9yIGNhbGN1bGF0aW9uCgogIG5ldyBWZWMzKCk7IC8vIFJlbGF0aXZlIHZlbG9jaXR5CgogIG5ldyBWZWMzKCk7CiAgbmV3IFZlYzMoKTsKICBuZXcgVmVjMygpOwogIG5ldyBWZWMzKCk7CiAgbmV3IFZlYzMoKTsKCiAgLyoqCiAgICogQ3lsaW5kZXIgY2xhc3MuCiAgICogQGV4YW1wbGUKICAgKiAgICAgY29uc3QgcmFkaXVzVG9wID0gMC41CiAgICogICAgIGNvbnN0IHJhZGl1c0JvdHRvbSA9IDAuNQogICAqICAgICBjb25zdCBoZWlnaHQgPSAyCiAgICogICAgIGNvbnN0IG51bVNlZ21lbnRzID0gMTIKICAgKiAgICAgY29uc3QgY3lsaW5kZXJTaGFwZSA9IG5ldyBDQU5OT04uQ3lsaW5kZXIocmFkaXVzVG9wLCByYWRpdXNCb3R0b20sIGhlaWdodCwgbnVtU2VnbWVudHMpCiAgICogICAgIGNvbnN0IGN5bGluZGVyQm9keSA9IG5ldyBDQU5OT04uQm9keSh7IG1hc3M6IDEsIHNoYXBlOiBjeWxpbmRlclNoYXBlIH0pCiAgICogICAgIHdvcmxkLmFkZEJvZHkoY3lsaW5kZXJCb2R5KQogICAqLwoKICBjbGFzcyBDeWxpbmRlciBleHRlbmRzIENvbnZleFBvbHloZWRyb24gewogICAgLyoqIFRoZSByYWRpdXMgb2YgdGhlIHRvcCBvZiB0aGUgQ3lsaW5kZXIuICovCgogICAgLyoqIFRoZSByYWRpdXMgb2YgdGhlIGJvdHRvbSBvZiB0aGUgQ3lsaW5kZXIuICovCgogICAgLyoqIFRoZSBoZWlnaHQgb2YgdGhlIEN5bGluZGVyLiAqLwoKICAgIC8qKiBUaGUgbnVtYmVyIG9mIHNlZ21lbnRzIHRvIGJ1aWxkIHRoZSBjeWxpbmRlciBvdXQgb2YuICovCgogICAgLyoqCiAgICAgKiBAcGFyYW0gcmFkaXVzVG9wIFRoZSByYWRpdXMgb2YgdGhlIHRvcCBvZiB0aGUgQ3lsaW5kZXIuCiAgICAgKiBAcGFyYW0gcmFkaXVzQm90dG9tIFRoZSByYWRpdXMgb2YgdGhlIGJvdHRvbSBvZiB0aGUgQ3lsaW5kZXIuCiAgICAgKiBAcGFyYW0gaGVpZ2h0IFRoZSBoZWlnaHQgb2YgdGhlIEN5bGluZGVyLgogICAgICogQHBhcmFtIG51bVNlZ21lbnRzIFRoZSBudW1iZXIgb2Ygc2VnbWVudHMgdG8gYnVpbGQgdGhlIGN5bGluZGVyIG91dCBvZi4KICAgICAqLwogICAgY29uc3RydWN0b3IocmFkaXVzVG9wLCByYWRpdXNCb3R0b20sIGhlaWdodCwgbnVtU2VnbWVudHMpIHsKICAgICAgaWYgKHJhZGl1c1RvcCA9PT0gdm9pZCAwKSB7CiAgICAgICAgcmFkaXVzVG9wID0gMTsKICAgICAgfQoKICAgICAgaWYgKHJhZGl1c0JvdHRvbSA9PT0gdm9pZCAwKSB7CiAgICAgICAgcmFkaXVzQm90dG9tID0gMTsKICAgICAgfQoKICAgICAgaWYgKGhlaWdodCA9PT0gdm9pZCAwKSB7CiAgICAgICAgaGVpZ2h0ID0gMTsKICAgICAgfQoKICAgICAgaWYgKG51bVNlZ21lbnRzID09PSB2b2lkIDApIHsKICAgICAgICBudW1TZWdtZW50cyA9IDg7CiAgICAgIH0KCiAgICAgIGlmIChyYWRpdXNUb3AgPCAwKSB7CiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdUaGUgY3lsaW5kZXIgcmFkaXVzVG9wIGNhbm5vdCBiZSBuZWdhdGl2ZS4nKTsKICAgICAgfQoKICAgICAgaWYgKHJhZGl1c0JvdHRvbSA8IDApIHsKICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ1RoZSBjeWxpbmRlciByYWRpdXNCb3R0b20gY2Fubm90IGJlIG5lZ2F0aXZlLicpOwogICAgICB9CgogICAgICBjb25zdCBOID0gbnVtU2VnbWVudHM7CiAgICAgIGNvbnN0IHZlcnRpY2VzID0gW107CiAgICAgIGNvbnN0IGF4ZXMgPSBbXTsKICAgICAgY29uc3QgZmFjZXMgPSBbXTsKICAgICAgY29uc3QgYm90dG9tZmFjZSA9IFtdOwogICAgICBjb25zdCB0b3BmYWNlID0gW107CiAgICAgIGNvbnN0IGNvcyA9IE1hdGguY29zOwogICAgICBjb25zdCBzaW4gPSBNYXRoLnNpbjsgLy8gRmlyc3QgYm90dG9tIHBvaW50CgogICAgICB2ZXJ0aWNlcy5wdXNoKG5ldyBWZWMzKC1yYWRpdXNCb3R0b20gKiBzaW4oMCksIC1oZWlnaHQgKiAwLjUsIHJhZGl1c0JvdHRvbSAqIGNvcygwKSkpOwogICAgICBib3R0b21mYWNlLnB1c2goMCk7IC8vIEZpcnN0IHRvcCBwb2ludAoKICAgICAgdmVydGljZXMucHVzaChuZXcgVmVjMygtcmFkaXVzVG9wICogc2luKDApLCBoZWlnaHQgKiAwLjUsIHJhZGl1c1RvcCAqIGNvcygwKSkpOwogICAgICB0b3BmYWNlLnB1c2goMSk7CgogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IE47IGkrKykgewogICAgICAgIGNvbnN0IHRoZXRhID0gMiAqIE1hdGguUEkgLyBOICogKGkgKyAxKTsKICAgICAgICBjb25zdCB0aGV0YU4gPSAyICogTWF0aC5QSSAvIE4gKiAoaSArIDAuNSk7CgogICAgICAgIGlmIChpIDwgTiAtIDEpIHsKICAgICAgICAgIC8vIEJvdHRvbQogICAgICAgICAgdmVydGljZXMucHVzaChuZXcgVmVjMygtcmFkaXVzQm90dG9tICogc2luKHRoZXRhKSwgLWhlaWdodCAqIDAuNSwgcmFkaXVzQm90dG9tICogY29zKHRoZXRhKSkpOwogICAgICAgICAgYm90dG9tZmFjZS5wdXNoKDIgKiBpICsgMik7IC8vIFRvcAoKICAgICAgICAgIHZlcnRpY2VzLnB1c2gobmV3IFZlYzMoLXJhZGl1c1RvcCAqIHNpbih0aGV0YSksIGhlaWdodCAqIDAuNSwgcmFkaXVzVG9wICogY29zKHRoZXRhKSkpOwogICAgICAgICAgdG9wZmFjZS5wdXNoKDIgKiBpICsgMyk7IC8vIEZhY2UKCiAgICAgICAgICBmYWNlcy5wdXNoKFsyICogaSwgMiAqIGkgKyAxLCAyICogaSArIDMsIDIgKiBpICsgMl0pOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBmYWNlcy5wdXNoKFsyICogaSwgMiAqIGkgKyAxLCAxLCAwXSk7IC8vIENvbm5lY3QKICAgICAgICB9IC8vIEF4aXM6IHdlIGNhbiBjdXQgb2ZmIGhhbGYgb2YgdGhlbSBpZiB3ZSBoYXZlIGV2ZW4gbnVtYmVyIG9mIHNlZ21lbnRzCgoKICAgICAgICBpZiAoTiAlIDIgPT09IDEgfHwgaSA8IE4gLyAyKSB7CiAgICAgICAgICBheGVzLnB1c2gobmV3IFZlYzMoLXNpbih0aGV0YU4pLCAwLCBjb3ModGhldGFOKSkpOwogICAgICAgIH0KICAgICAgfQoKICAgICAgZmFjZXMucHVzaChib3R0b21mYWNlKTsKICAgICAgYXhlcy5wdXNoKG5ldyBWZWMzKDAsIDEsIDApKTsgLy8gUmVvcmRlciB0b3AgZmFjZQoKICAgICAgY29uc3QgdGVtcCA9IFtdOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0b3BmYWNlLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgdGVtcC5wdXNoKHRvcGZhY2VbdG9wZmFjZS5sZW5ndGggLSBpIC0gMV0pOwogICAgICB9CgogICAgICBmYWNlcy5wdXNoKHRlbXApOwogICAgICBzdXBlcih7CiAgICAgICAgdmVydGljZXMsCiAgICAgICAgZmFjZXMsCiAgICAgICAgYXhlcwogICAgICB9KTsKICAgICAgdGhpcy50eXBlID0gU2hhcGUudHlwZXMuQ1lMSU5ERVI7CiAgICAgIHRoaXMucmFkaXVzVG9wID0gcmFkaXVzVG9wOwogICAgICB0aGlzLnJhZGl1c0JvdHRvbSA9IHJhZGl1c0JvdHRvbTsKICAgICAgdGhpcy5oZWlnaHQgPSBoZWlnaHQ7CiAgICAgIHRoaXMubnVtU2VnbWVudHMgPSBudW1TZWdtZW50czsKICAgIH0KCiAgfQoKICAvKioKICAgKiBQYXJ0aWNsZSBzaGFwZS4KICAgKiBAZXhhbXBsZQogICAqICAgICBjb25zdCBwYXJ0aWNsZVNoYXBlID0gbmV3IENBTk5PTi5QYXJ0aWNsZSgpCiAgICogICAgIGNvbnN0IHBhcnRpY2xlQm9keSA9IG5ldyBDQU5OT04uQm9keSh7IG1hc3M6IDEsIHNoYXBlOiBwYXJ0aWNsZVNoYXBlIH0pCiAgICogICAgIHdvcmxkLmFkZEJvZHkocGFydGljbGVCb2R5KQogICAqLwogIGNsYXNzIFBhcnRpY2xlIGV4dGVuZHMgU2hhcGUgewogICAgY29uc3RydWN0b3IoKSB7CiAgICAgIHN1cGVyKHsKICAgICAgICB0eXBlOiBTaGFwZS50eXBlcy5QQVJUSUNMRQogICAgICB9KTsKICAgIH0KICAgIC8qKgogICAgICogY2FsY3VsYXRlTG9jYWxJbmVydGlhCiAgICAgKi8KCgogICAgY2FsY3VsYXRlTG9jYWxJbmVydGlhKG1hc3MsIHRhcmdldCkgewogICAgICBpZiAodGFyZ2V0ID09PSB2b2lkIDApIHsKICAgICAgICB0YXJnZXQgPSBuZXcgVmVjMygpOwogICAgICB9CgogICAgICB0YXJnZXQuc2V0KDAsIDAsIDApOwogICAgICByZXR1cm4gdGFyZ2V0OwogICAgfQoKICAgIHZvbHVtZSgpIHsKICAgICAgcmV0dXJuIDA7CiAgICB9CgogICAgdXBkYXRlQm91bmRpbmdTcGhlcmVSYWRpdXMoKSB7CiAgICAgIHRoaXMuYm91bmRpbmdTcGhlcmVSYWRpdXMgPSAwOwogICAgfQoKICAgIGNhbGN1bGF0ZVdvcmxkQUFCQihwb3MsIHF1YXQsIG1pbiwgbWF4KSB7CiAgICAgIC8vIEdldCBlYWNoIGF4aXMgbWF4CiAgICAgIG1pbi5jb3B5KHBvcyk7CiAgICAgIG1heC5jb3B5KHBvcyk7CiAgICB9CgogIH0KCiAgLyoqCiAgICogQSBwbGFuZSwgZmFjaW5nIGluIHRoZSBaIGRpcmVjdGlvbi4gVGhlIHBsYW5lIGhhcyBpdHMgc3VyZmFjZSBhdCB6PTAgYW5kIGV2ZXJ5dGhpbmcgYmVsb3cgej0wIGlzIGFzc3VtZWQgdG8gYmUgc29saWQgcGxhbmUuIFRvIG1ha2UgdGhlIHBsYW5lIGZhY2UgaW4gc29tZSBvdGhlciBkaXJlY3Rpb24gdGhhbiB6LCB5b3UgbXVzdCBwdXQgaXQgaW5zaWRlIGEgQm9keSBhbmQgcm90YXRlIHRoYXQgYm9keS4gU2VlIHRoZSBkZW1vcy4KICAgKiBAZXhhbXBsZQogICAqICAgICBjb25zdCBwbGFuZVNoYXBlID0gbmV3IENBTk5PTi5QbGFuZSgpCiAgICogICAgIGNvbnN0IHBsYW5lQm9keSA9IG5ldyBDQU5OT04uQm9keSh7IG1hc3M6IDAsIHNoYXBlOiAgcGxhbmVTaGFwZSB9KQogICAqICAgICBwbGFuZUJvZHkucXVhdGVybmlvbi5zZXRGcm9tRXVsZXIoLU1hdGguUEkgLyAyLCAwLCAwKSAvLyBtYWtlIGl0IGZhY2UgdXAKICAgKiAgICAgd29ybGQuYWRkQm9keShwbGFuZUJvZHkpCiAgICovCiAgY2xhc3MgUGxhbmUgZXh0ZW5kcyBTaGFwZSB7CiAgICAvKiogd29ybGROb3JtYWwgKi8KCiAgICAvKiogd29ybGROb3JtYWxOZWVkc1VwZGF0ZSAqLwogICAgY29uc3RydWN0b3IoKSB7CiAgICAgIHN1cGVyKHsKICAgICAgICB0eXBlOiBTaGFwZS50eXBlcy5QTEFORQogICAgICB9KTsgLy8gV29ybGQgb3JpZW50ZWQgbm9ybWFsCgogICAgICB0aGlzLndvcmxkTm9ybWFsID0gbmV3IFZlYzMoKTsKICAgICAgdGhpcy53b3JsZE5vcm1hbE5lZWRzVXBkYXRlID0gdHJ1ZTsKICAgICAgdGhpcy5ib3VuZGluZ1NwaGVyZVJhZGl1cyA9IE51bWJlci5NQVhfVkFMVUU7CiAgICB9CiAgICAvKiogY29tcHV0ZVdvcmxkTm9ybWFsICovCgoKICAgIGNvbXB1dGVXb3JsZE5vcm1hbChxdWF0KSB7CiAgICAgIGNvbnN0IG4gPSB0aGlzLndvcmxkTm9ybWFsOwogICAgICBuLnNldCgwLCAwLCAxKTsKICAgICAgcXVhdC52bXVsdChuLCBuKTsKICAgICAgdGhpcy53b3JsZE5vcm1hbE5lZWRzVXBkYXRlID0gZmFsc2U7CiAgICB9CgogICAgY2FsY3VsYXRlTG9jYWxJbmVydGlhKG1hc3MsIHRhcmdldCkgewogICAgICBpZiAodGFyZ2V0ID09PSB2b2lkIDApIHsKICAgICAgICB0YXJnZXQgPSBuZXcgVmVjMygpOwogICAgICB9CgogICAgICByZXR1cm4gdGFyZ2V0OwogICAgfQoKICAgIHZvbHVtZSgpIHsKICAgICAgcmV0dXJuICgvLyBUaGUgcGxhbmUgaXMgaW5maW5pdGUuLi4KICAgICAgICBOdW1iZXIuTUFYX1ZBTFVFCiAgICAgICk7CiAgICB9CgogICAgY2FsY3VsYXRlV29ybGRBQUJCKHBvcywgcXVhdCwgbWluLCBtYXgpIHsKICAgICAgLy8gVGhlIHBsYW5lIEFBQkIgaXMgaW5maW5pdGUsIGV4Y2VwdCBpZiB0aGUgbm9ybWFsIGlzIHBvaW50aW5nIGFsb25nIGFueSBheGlzCiAgICAgIHRlbXBOb3JtYWwuc2V0KDAsIDAsIDEpOyAvLyBEZWZhdWx0IHBsYW5lIG5vcm1hbCBpcyB6CgogICAgICBxdWF0LnZtdWx0KHRlbXBOb3JtYWwsIHRlbXBOb3JtYWwpOwogICAgICBjb25zdCBtYXhWYWwgPSBOdW1iZXIuTUFYX1ZBTFVFOwogICAgICBtaW4uc2V0KC1tYXhWYWwsIC1tYXhWYWwsIC1tYXhWYWwpOwogICAgICBtYXguc2V0KG1heFZhbCwgbWF4VmFsLCBtYXhWYWwpOwoKICAgICAgaWYgKHRlbXBOb3JtYWwueCA9PT0gMSkgewogICAgICAgIG1heC54ID0gcG9zLng7CiAgICAgIH0gZWxzZSBpZiAodGVtcE5vcm1hbC54ID09PSAtMSkgewogICAgICAgIG1pbi54ID0gcG9zLng7CiAgICAgIH0KCiAgICAgIGlmICh0ZW1wTm9ybWFsLnkgPT09IDEpIHsKICAgICAgICBtYXgueSA9IHBvcy55OwogICAgICB9IGVsc2UgaWYgKHRlbXBOb3JtYWwueSA9PT0gLTEpIHsKICAgICAgICBtaW4ueSA9IHBvcy55OwogICAgICB9CgogICAgICBpZiAodGVtcE5vcm1hbC56ID09PSAxKSB7CiAgICAgICAgbWF4LnogPSBwb3MuejsKICAgICAgfSBlbHNlIGlmICh0ZW1wTm9ybWFsLnogPT09IC0xKSB7CiAgICAgICAgbWluLnogPSBwb3MuejsKICAgICAgfQogICAgfQoKICAgIHVwZGF0ZUJvdW5kaW5nU3BoZXJlUmFkaXVzKCkgewogICAgICB0aGlzLmJvdW5kaW5nU3BoZXJlUmFkaXVzID0gTnVtYmVyLk1BWF9WQUxVRTsKICAgIH0KCiAgfQogIGNvbnN0IHRlbXBOb3JtYWwgPSBuZXcgVmVjMygpOwoKICAvKioKICAgKiBIZWlnaHRmaWVsZCBzaGFwZSBjbGFzcy4gSGVpZ2h0IGRhdGEgaXMgZ2l2ZW4gYXMgYW4gYXJyYXkuIFRoZXNlIGRhdGEgcG9pbnRzIGFyZSBzcHJlYWQgb3V0IGV2ZW5seSB3aXRoIGEgZ2l2ZW4gZGlzdGFuY2UuCiAgICogQHRvZG8gU2hvdWxkIGJlIHBvc3NpYmxlIHRvIHVzZSBhbG9uZyBhbGwgYXhlcywgbm90IGp1c3QgeQogICAqIEB0b2RvIHNob3VsZCBiZSBwb3NzaWJsZSB0byBzY2FsZSBhbG9uZyBhbGwgYXhlcwogICAqIEB0b2RvIFJlZmFjdG9yIGVsZW1lbnRTaXplIHRvIGVsZW1lbnRTaXplWCBhbmQgZWxlbWVudFNpemVZCiAgICoKICAgKiBAZXhhbXBsZQogICAqICAgICAvLyBHZW5lcmF0ZSBzb21lIGhlaWdodCBkYXRhICh5LXZhbHVlcykuCiAgICogICAgIGNvbnN0IGRhdGEgPSBbXQogICAqICAgICBmb3IgKGxldCBpID0gMDsgaSA8IDEwMDA7IGkrKykgewogICAqICAgICAgICAgY29uc3QgeSA9IDAuNSAqIE1hdGguY29zKDAuMiAqIGkpCiAgICogICAgICAgICBkYXRhLnB1c2goeSkKICAgKiAgICAgfQogICAqCiAgICogICAgIC8vIENyZWF0ZSB0aGUgaGVpZ2h0ZmllbGQgc2hhcGUKICAgKiAgICAgY29uc3QgaGVpZ2h0ZmllbGRTaGFwZSA9IG5ldyBDQU5OT04uSGVpZ2h0ZmllbGQoZGF0YSwgewogICAqICAgICAgICAgZWxlbWVudFNpemU6IDEgLy8gRGlzdGFuY2UgYmV0d2VlbiB0aGUgZGF0YSBwb2ludHMgaW4gWCBhbmQgWSBkaXJlY3Rpb25zCiAgICogICAgIH0pCiAgICogICAgIGNvbnN0IGhlaWdodGZpZWxkQm9keSA9IG5ldyBDQU5OT04uQm9keSh7IHNoYXBlOiBoZWlnaHRmaWVsZFNoYXBlIH0pCiAgICogICAgIHdvcmxkLmFkZEJvZHkoaGVpZ2h0ZmllbGRCb2R5KQogICAqLwogIGNsYXNzIEhlaWdodGZpZWxkIGV4dGVuZHMgU2hhcGUgewogICAgLyoqCiAgICAgKiBBbiBhcnJheSBvZiBudW1iZXJzLCBvciBoZWlnaHQgdmFsdWVzLCB0aGF0IGFyZSBzcHJlYWQgb3V0IGFsb25nIHRoZSB4IGF4aXMuCiAgICAgKi8KCiAgICAvKioKICAgICAqIE1heCB2YWx1ZSBvZiB0aGUgZGF0YSBwb2ludHMgaW4gdGhlIGRhdGEgYXJyYXkuCiAgICAgKi8KCiAgICAvKioKICAgICAqIE1pbmltdW0gdmFsdWUgb2YgdGhlIGRhdGEgcG9pbnRzIGluIHRoZSBkYXRhIGFycmF5LgogICAgICovCgogICAgLyoqCiAgICAgKiBXb3JsZCBzcGFjaW5nIGJldHdlZW4gdGhlIGRhdGEgcG9pbnRzIGluIFggYW5kIFkgZGlyZWN0aW9uLgogICAgICogQHRvZG8gZWxlbWVudFNpemVYIGFuZCBZCiAgICAgKiBAZGVmYXVsdCAxCiAgICAgKi8KCiAgICAvKioKICAgICAqIEBkZWZhdWx0IHRydWUKICAgICAqLwoKICAgIC8qKgogICAgICogQHBhcmFtIGRhdGEgQW4gYXJyYXkgb2YgbnVtYmVycywgb3IgaGVpZ2h0IHZhbHVlcywgdGhhdCBhcmUgc3ByZWFkIG91dCBhbG9uZyB0aGUgeCBheGlzLgogICAgICovCiAgICBjb25zdHJ1Y3RvcihkYXRhLCBvcHRpb25zKSB7CiAgICAgIGlmIChvcHRpb25zID09PSB2b2lkIDApIHsKICAgICAgICBvcHRpb25zID0ge307CiAgICAgIH0KCiAgICAgIG9wdGlvbnMgPSBVdGlscy5kZWZhdWx0cyhvcHRpb25zLCB7CiAgICAgICAgbWF4VmFsdWU6IG51bGwsCiAgICAgICAgbWluVmFsdWU6IG51bGwsCiAgICAgICAgZWxlbWVudFNpemU6IDEKICAgICAgfSk7CiAgICAgIHN1cGVyKHsKICAgICAgICB0eXBlOiBTaGFwZS50eXBlcy5IRUlHSFRGSUVMRAogICAgICB9KTsKICAgICAgdGhpcy5kYXRhID0gZGF0YTsKICAgICAgdGhpcy5tYXhWYWx1ZSA9IG9wdGlvbnMubWF4VmFsdWU7CiAgICAgIHRoaXMubWluVmFsdWUgPSBvcHRpb25zLm1pblZhbHVlOwogICAgICB0aGlzLmVsZW1lbnRTaXplID0gb3B0aW9ucy5lbGVtZW50U2l6ZTsKCiAgICAgIGlmIChvcHRpb25zLm1pblZhbHVlID09PSBudWxsKSB7CiAgICAgICAgdGhpcy51cGRhdGVNaW5WYWx1ZSgpOwogICAgICB9CgogICAgICBpZiAob3B0aW9ucy5tYXhWYWx1ZSA9PT0gbnVsbCkgewogICAgICAgIHRoaXMudXBkYXRlTWF4VmFsdWUoKTsKICAgICAgfQoKICAgICAgdGhpcy5jYWNoZUVuYWJsZWQgPSB0cnVlOwogICAgICB0aGlzLnBpbGxhckNvbnZleCA9IG5ldyBDb252ZXhQb2x5aGVkcm9uKCk7CiAgICAgIHRoaXMucGlsbGFyT2Zmc2V0ID0gbmV3IFZlYzMoKTsKICAgICAgdGhpcy51cGRhdGVCb3VuZGluZ1NwaGVyZVJhZGl1cygpOyAvLyAiaV9qX2lzVXBwZXIiID0+IHsgY29udmV4OiAuLi4sIG9mZnNldDogLi4uIH0KICAgICAgLy8gZm9yIGV4YW1wbGU6CiAgICAgIC8vIF9jYWNoZWRQaWxsYXJzWyIwXzJfMSJdCgogICAgICB0aGlzLl9jYWNoZWRQaWxsYXJzID0ge307CiAgICB9CiAgICAvKioKICAgICAqIENhbGwgd2hlbmV2ZXIgeW91IGNoYW5nZSB0aGUgZGF0YSBhcnJheS4KICAgICAqLwoKCiAgICB1cGRhdGUoKSB7CiAgICAgIHRoaXMuX2NhY2hlZFBpbGxhcnMgPSB7fTsKICAgIH0KICAgIC8qKgogICAgICogVXBkYXRlIHRoZSBgbWluVmFsdWVgIHByb3BlcnR5CiAgICAgKi8KCgogICAgdXBkYXRlTWluVmFsdWUoKSB7CiAgICAgIGNvbnN0IGRhdGEgPSB0aGlzLmRhdGE7CiAgICAgIGxldCBtaW5WYWx1ZSA9IGRhdGFbMF1bMF07CgogICAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gZGF0YS5sZW5ndGg7IGkrKykgewogICAgICAgIGZvciAobGV0IGogPSAwOyBqICE9PSBkYXRhW2ldLmxlbmd0aDsgaisrKSB7CiAgICAgICAgICBjb25zdCB2ID0gZGF0YVtpXVtqXTsKCiAgICAgICAgICBpZiAodiA8IG1pblZhbHVlKSB7CiAgICAgICAgICAgIG1pblZhbHVlID0gdjsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KCiAgICAgIHRoaXMubWluVmFsdWUgPSBtaW5WYWx1ZTsKICAgIH0KICAgIC8qKgogICAgICogVXBkYXRlIHRoZSBgbWF4VmFsdWVgIHByb3BlcnR5CiAgICAgKi8KCgogICAgdXBkYXRlTWF4VmFsdWUoKSB7CiAgICAgIGNvbnN0IGRhdGEgPSB0aGlzLmRhdGE7CiAgICAgIGxldCBtYXhWYWx1ZSA9IGRhdGFbMF1bMF07CgogICAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gZGF0YS5sZW5ndGg7IGkrKykgewogICAgICAgIGZvciAobGV0IGogPSAwOyBqICE9PSBkYXRhW2ldLmxlbmd0aDsgaisrKSB7CiAgICAgICAgICBjb25zdCB2ID0gZGF0YVtpXVtqXTsKCiAgICAgICAgICBpZiAodiA+IG1heFZhbHVlKSB7CiAgICAgICAgICAgIG1heFZhbHVlID0gdjsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KCiAgICAgIHRoaXMubWF4VmFsdWUgPSBtYXhWYWx1ZTsKICAgIH0KICAgIC8qKgogICAgICogU2V0IHRoZSBoZWlnaHQgdmFsdWUgYXQgYW4gaW5kZXguIERvbid0IGZvcmdldCB0byB1cGRhdGUgbWF4VmFsdWUgYW5kIG1pblZhbHVlIGFmdGVyIHlvdSdyZSBkb25lLgogICAgICovCgoKICAgIHNldEhlaWdodFZhbHVlQXRJbmRleCh4aSwgeWksIHZhbHVlKSB7CiAgICAgIGNvbnN0IGRhdGEgPSB0aGlzLmRhdGE7CiAgICAgIGRhdGFbeGldW3lpXSA9IHZhbHVlOyAvLyBJbnZhbGlkYXRlIGNhY2hlCgogICAgICB0aGlzLmNsZWFyQ2FjaGVkQ29udmV4VHJpYW5nbGVQaWxsYXIoeGksIHlpLCBmYWxzZSk7CgogICAgICBpZiAoeGkgPiAwKSB7CiAgICAgICAgdGhpcy5jbGVhckNhY2hlZENvbnZleFRyaWFuZ2xlUGlsbGFyKHhpIC0gMSwgeWksIHRydWUpOwogICAgICAgIHRoaXMuY2xlYXJDYWNoZWRDb252ZXhUcmlhbmdsZVBpbGxhcih4aSAtIDEsIHlpLCBmYWxzZSk7CiAgICAgIH0KCiAgICAgIGlmICh5aSA+IDApIHsKICAgICAgICB0aGlzLmNsZWFyQ2FjaGVkQ29udmV4VHJpYW5nbGVQaWxsYXIoeGksIHlpIC0gMSwgdHJ1ZSk7CiAgICAgICAgdGhpcy5jbGVhckNhY2hlZENvbnZleFRyaWFuZ2xlUGlsbGFyKHhpLCB5aSAtIDEsIGZhbHNlKTsKICAgICAgfQoKICAgICAgaWYgKHlpID4gMCAmJiB4aSA+IDApIHsKICAgICAgICB0aGlzLmNsZWFyQ2FjaGVkQ29udmV4VHJpYW5nbGVQaWxsYXIoeGkgLSAxLCB5aSAtIDEsIHRydWUpOwogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIEdldCBtYXgvbWluIGluIGEgcmVjdGFuZ2xlIGluIHRoZSBtYXRyaXggZGF0YQogICAgICogQHBhcmFtIHJlc3VsdCBBbiBhcnJheSB0byBzdG9yZSB0aGUgcmVzdWx0cyBpbi4KICAgICAqIEByZXR1cm4gVGhlIHJlc3VsdCBhcnJheSwgaWYgaXQgd2FzIHBhc3NlZCBpbi4gTWluaW11bSB3aWxsIGJlIGF0IHBvc2l0aW9uIDAgYW5kIG1heCBhdCAxLgogICAgICovCgoKICAgIGdldFJlY3RNaW5NYXgoaU1pblgsIGlNaW5ZLCBpTWF4WCwgaU1heFksIHJlc3VsdCkgewogICAgICBpZiAocmVzdWx0ID09PSB2b2lkIDApIHsKICAgICAgICByZXN1bHQgPSBbXTsKICAgICAgfQoKICAgICAgLy8gR2V0IG1heCBhbmQgbWluIG9mIHRoZSBkYXRhCiAgICAgIGNvbnN0IGRhdGEgPSB0aGlzLmRhdGE7IC8vIFNldCBmaXJzdCB2YWx1ZQoKICAgICAgbGV0IG1heCA9IHRoaXMubWluVmFsdWU7CgogICAgICBmb3IgKGxldCBpID0gaU1pblg7IGkgPD0gaU1heFg7IGkrKykgewogICAgICAgIGZvciAobGV0IGogPSBpTWluWTsgaiA8PSBpTWF4WTsgaisrKSB7CiAgICAgICAgICBjb25zdCBoZWlnaHQgPSBkYXRhW2ldW2pdOwoKICAgICAgICAgIGlmIChoZWlnaHQgPiBtYXgpIHsKICAgICAgICAgICAgbWF4ID0gaGVpZ2h0OwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQoKICAgICAgcmVzdWx0WzBdID0gdGhpcy5taW5WYWx1ZTsKICAgICAgcmVzdWx0WzFdID0gbWF4OwogICAgfQogICAgLyoqCiAgICAgKiBHZXQgdGhlIGluZGV4IG9mIGEgbG9jYWwgcG9zaXRpb24gb24gdGhlIGhlaWdodGZpZWxkLiBUaGUgaW5kZXhlcyBpbmRpY2F0ZSB0aGUgcmVjdGFuZ2xlcywgc28gaWYgeW91ciB0ZXJyYWluIGlzIG1hZGUgb2YgTiB4IE4gaGVpZ2h0IGRhdGEgcG9pbnRzLCB5b3Ugd2lsbCBoYXZlIHJlY3RhbmdsZSBpbmRleGVzIHJhbmdpbmcgZnJvbSAwIHRvIE4tMS4KICAgICAqIEBwYXJhbSByZXN1bHQgVHdvLWVsZW1lbnQgYXJyYXkKICAgICAqIEBwYXJhbSBjbGFtcCBJZiB0aGUgcG9zaXRpb24gc2hvdWxkIGJlIGNsYW1wZWQgdG8gdGhlIGhlaWdodGZpZWxkIGVkZ2UuCiAgICAgKi8KCgogICAgZ2V0SW5kZXhPZlBvc2l0aW9uKHgsIHksIHJlc3VsdCwgY2xhbXApIHsKICAgICAgLy8gR2V0IHRoZSBpbmRleCBvZiB0aGUgZGF0YSBwb2ludHMgdG8gdGVzdCBhZ2FpbnN0CiAgICAgIGNvbnN0IHcgPSB0aGlzLmVsZW1lbnRTaXplOwogICAgICBjb25zdCBkYXRhID0gdGhpcy5kYXRhOwogICAgICBsZXQgeGkgPSBNYXRoLmZsb29yKHggLyB3KTsKICAgICAgbGV0IHlpID0gTWF0aC5mbG9vcih5IC8gdyk7CiAgICAgIHJlc3VsdFswXSA9IHhpOwogICAgICByZXN1bHRbMV0gPSB5aTsKCiAgICAgIGlmIChjbGFtcCkgewogICAgICAgIC8vIENsYW1wIGluZGV4IHRvIGVkZ2VzCiAgICAgICAgaWYgKHhpIDwgMCkgewogICAgICAgICAgeGkgPSAwOwogICAgICAgIH0KCiAgICAgICAgaWYgKHlpIDwgMCkgewogICAgICAgICAgeWkgPSAwOwogICAgICAgIH0KCiAgICAgICAgaWYgKHhpID49IGRhdGEubGVuZ3RoIC0gMSkgewogICAgICAgICAgeGkgPSBkYXRhLmxlbmd0aCAtIDE7CiAgICAgICAgfQoKICAgICAgICBpZiAoeWkgPj0gZGF0YVswXS5sZW5ndGggLSAxKSB7CiAgICAgICAgICB5aSA9IGRhdGFbMF0ubGVuZ3RoIC0gMTsKICAgICAgICB9CiAgICAgIH0gLy8gQmFpbCBvdXQgaWYgd2UgYXJlIG91dCBvZiB0aGUgdGVycmFpbgoKCiAgICAgIGlmICh4aSA8IDAgfHwgeWkgPCAwIHx8IHhpID49IGRhdGEubGVuZ3RoIC0gMSB8fCB5aSA+PSBkYXRhWzBdLmxlbmd0aCAtIDEpIHsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgIH0KCiAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIGdldFRyaWFuZ2xlQXQoeCwgeSwgZWRnZUNsYW1wLCBhLCBiLCBjKSB7CiAgICAgIGNvbnN0IGlkeCA9IGdldEhlaWdodEF0X2lkeDsKICAgICAgdGhpcy5nZXRJbmRleE9mUG9zaXRpb24oeCwgeSwgaWR4LCBlZGdlQ2xhbXApOwogICAgICBsZXQgeGkgPSBpZHhbMF07CiAgICAgIGxldCB5aSA9IGlkeFsxXTsKICAgICAgY29uc3QgZGF0YSA9IHRoaXMuZGF0YTsKCiAgICAgIGlmIChlZGdlQ2xhbXApIHsKICAgICAgICB4aSA9IE1hdGgubWluKGRhdGEubGVuZ3RoIC0gMiwgTWF0aC5tYXgoMCwgeGkpKTsKICAgICAgICB5aSA9IE1hdGgubWluKGRhdGFbMF0ubGVuZ3RoIC0gMiwgTWF0aC5tYXgoMCwgeWkpKTsKICAgICAgfQoKICAgICAgY29uc3QgZWxlbWVudFNpemUgPSB0aGlzLmVsZW1lbnRTaXplOwogICAgICBjb25zdCBsb3dlckRpc3QyID0gKHggLyBlbGVtZW50U2l6ZSAtIHhpKSAqKiAyICsgKHkgLyBlbGVtZW50U2l6ZSAtIHlpKSAqKiAyOwogICAgICBjb25zdCB1cHBlckRpc3QyID0gKHggLyBlbGVtZW50U2l6ZSAtICh4aSArIDEpKSAqKiAyICsgKHkgLyBlbGVtZW50U2l6ZSAtICh5aSArIDEpKSAqKiAyOwogICAgICBjb25zdCB1cHBlciA9IGxvd2VyRGlzdDIgPiB1cHBlckRpc3QyOwogICAgICB0aGlzLmdldFRyaWFuZ2xlKHhpLCB5aSwgdXBwZXIsIGEsIGIsIGMpOwogICAgICByZXR1cm4gdXBwZXI7CiAgICB9CgogICAgZ2V0Tm9ybWFsQXQoeCwgeSwgZWRnZUNsYW1wLCByZXN1bHQpIHsKICAgICAgY29uc3QgYSA9IGdldE5vcm1hbEF0X2E7CiAgICAgIGNvbnN0IGIgPSBnZXROb3JtYWxBdF9iOwogICAgICBjb25zdCBjID0gZ2V0Tm9ybWFsQXRfYzsKICAgICAgY29uc3QgZTAgPSBnZXROb3JtYWxBdF9lMDsKICAgICAgY29uc3QgZTEgPSBnZXROb3JtYWxBdF9lMTsKICAgICAgdGhpcy5nZXRUcmlhbmdsZUF0KHgsIHksIGVkZ2VDbGFtcCwgYSwgYiwgYyk7CiAgICAgIGIudnN1YihhLCBlMCk7CiAgICAgIGMudnN1YihhLCBlMSk7CiAgICAgIGUwLmNyb3NzKGUxLCByZXN1bHQpOwogICAgICByZXN1bHQubm9ybWFsaXplKCk7CiAgICB9CiAgICAvKioKICAgICAqIEdldCBhbiBBQUJCIG9mIGEgc3F1YXJlIGluIHRoZSBoZWlnaHRmaWVsZAogICAgICogQHBhcmFtIHhpCiAgICAgKiBAcGFyYW0geWkKICAgICAqIEBwYXJhbSByZXN1bHQKICAgICAqLwoKCiAgICBnZXRBYWJiQXRJbmRleCh4aSwgeWksIF9yZWYpIHsKICAgICAgbGV0IHsKICAgICAgICBsb3dlckJvdW5kLAogICAgICAgIHVwcGVyQm91bmQKICAgICAgfSA9IF9yZWY7CiAgICAgIGNvbnN0IGRhdGEgPSB0aGlzLmRhdGE7CiAgICAgIGNvbnN0IGVsZW1lbnRTaXplID0gdGhpcy5lbGVtZW50U2l6ZTsKICAgICAgbG93ZXJCb3VuZC5zZXQoeGkgKiBlbGVtZW50U2l6ZSwgeWkgKiBlbGVtZW50U2l6ZSwgZGF0YVt4aV1beWldKTsKICAgICAgdXBwZXJCb3VuZC5zZXQoKHhpICsgMSkgKiBlbGVtZW50U2l6ZSwgKHlpICsgMSkgKiBlbGVtZW50U2l6ZSwgZGF0YVt4aSArIDFdW3lpICsgMV0pOwogICAgfQogICAgLyoqCiAgICAgKiBHZXQgdGhlIGhlaWdodCBpbiB0aGUgaGVpZ2h0ZmllbGQgYXQgYSBnaXZlbiBwb3NpdGlvbgogICAgICovCgoKICAgIGdldEhlaWdodEF0KHgsIHksIGVkZ2VDbGFtcCkgewogICAgICBjb25zdCBkYXRhID0gdGhpcy5kYXRhOwogICAgICBjb25zdCBhID0gZ2V0SGVpZ2h0QXRfYTsKICAgICAgY29uc3QgYiA9IGdldEhlaWdodEF0X2I7CiAgICAgIGNvbnN0IGMgPSBnZXRIZWlnaHRBdF9jOwogICAgICBjb25zdCBpZHggPSBnZXRIZWlnaHRBdF9pZHg7CiAgICAgIHRoaXMuZ2V0SW5kZXhPZlBvc2l0aW9uKHgsIHksIGlkeCwgZWRnZUNsYW1wKTsKICAgICAgbGV0IHhpID0gaWR4WzBdOwogICAgICBsZXQgeWkgPSBpZHhbMV07CgogICAgICBpZiAoZWRnZUNsYW1wKSB7CiAgICAgICAgeGkgPSBNYXRoLm1pbihkYXRhLmxlbmd0aCAtIDIsIE1hdGgubWF4KDAsIHhpKSk7CiAgICAgICAgeWkgPSBNYXRoLm1pbihkYXRhWzBdLmxlbmd0aCAtIDIsIE1hdGgubWF4KDAsIHlpKSk7CiAgICAgIH0KCiAgICAgIGNvbnN0IHVwcGVyID0gdGhpcy5nZXRUcmlhbmdsZUF0KHgsIHksIGVkZ2VDbGFtcCwgYSwgYiwgYyk7CiAgICAgIGJhcnljZW50cmljV2VpZ2h0cyh4LCB5LCBhLngsIGEueSwgYi54LCBiLnksIGMueCwgYy55LCBnZXRIZWlnaHRBdF93ZWlnaHRzKTsKICAgICAgY29uc3QgdyA9IGdldEhlaWdodEF0X3dlaWdodHM7CgogICAgICBpZiAodXBwZXIpIHsKICAgICAgICAvLyBUb3AgdHJpYW5nbGUgdmVydHMKICAgICAgICByZXR1cm4gZGF0YVt4aSArIDFdW3lpICsgMV0gKiB3LnggKyBkYXRhW3hpXVt5aSArIDFdICogdy55ICsgZGF0YVt4aSArIDFdW3lpXSAqIHcuejsKICAgICAgfSBlbHNlIHsKICAgICAgICAvLyBUb3AgdHJpYW5nbGUgdmVydHMKICAgICAgICByZXR1cm4gZGF0YVt4aV1beWldICogdy54ICsgZGF0YVt4aSArIDFdW3lpXSAqIHcueSArIGRhdGFbeGldW3lpICsgMV0gKiB3Lno7CiAgICAgIH0KICAgIH0KCiAgICBnZXRDYWNoZUNvbnZleFRyaWFuZ2xlUGlsbGFyS2V5KHhpLCB5aSwgZ2V0VXBwZXJUcmlhbmdsZSkgewogICAgICByZXR1cm4gYCR7eGl9XyR7eWl9XyR7Z2V0VXBwZXJUcmlhbmdsZSA/IDEgOiAwfWA7CiAgICB9CgogICAgZ2V0Q2FjaGVkQ29udmV4VHJpYW5nbGVQaWxsYXIoeGksIHlpLCBnZXRVcHBlclRyaWFuZ2xlKSB7CiAgICAgIHJldHVybiB0aGlzLl9jYWNoZWRQaWxsYXJzW3RoaXMuZ2V0Q2FjaGVDb252ZXhUcmlhbmdsZVBpbGxhcktleSh4aSwgeWksIGdldFVwcGVyVHJpYW5nbGUpXTsKICAgIH0KCiAgICBzZXRDYWNoZWRDb252ZXhUcmlhbmdsZVBpbGxhcih4aSwgeWksIGdldFVwcGVyVHJpYW5nbGUsIGNvbnZleCwgb2Zmc2V0KSB7CiAgICAgIHRoaXMuX2NhY2hlZFBpbGxhcnNbdGhpcy5nZXRDYWNoZUNvbnZleFRyaWFuZ2xlUGlsbGFyS2V5KHhpLCB5aSwgZ2V0VXBwZXJUcmlhbmdsZSldID0gewogICAgICAgIGNvbnZleCwKICAgICAgICBvZmZzZXQKICAgICAgfTsKICAgIH0KCiAgICBjbGVhckNhY2hlZENvbnZleFRyaWFuZ2xlUGlsbGFyKHhpLCB5aSwgZ2V0VXBwZXJUcmlhbmdsZSkgewogICAgICBkZWxldGUgdGhpcy5fY2FjaGVkUGlsbGFyc1t0aGlzLmdldENhY2hlQ29udmV4VHJpYW5nbGVQaWxsYXJLZXkoeGksIHlpLCBnZXRVcHBlclRyaWFuZ2xlKV07CiAgICB9CiAgICAvKioKICAgICAqIEdldCBhIHRyaWFuZ2xlIGZyb20gdGhlIGhlaWdodGZpZWxkCiAgICAgKi8KCgogICAgZ2V0VHJpYW5nbGUoeGksIHlpLCB1cHBlciwgYSwgYiwgYykgewogICAgICBjb25zdCBkYXRhID0gdGhpcy5kYXRhOwogICAgICBjb25zdCBlbGVtZW50U2l6ZSA9IHRoaXMuZWxlbWVudFNpemU7CgogICAgICBpZiAodXBwZXIpIHsKICAgICAgICAvLyBUb3AgdHJpYW5nbGUgdmVydHMKICAgICAgICBhLnNldCgoeGkgKyAxKSAqIGVsZW1lbnRTaXplLCAoeWkgKyAxKSAqIGVsZW1lbnRTaXplLCBkYXRhW3hpICsgMV1beWkgKyAxXSk7CiAgICAgICAgYi5zZXQoeGkgKiBlbGVtZW50U2l6ZSwgKHlpICsgMSkgKiBlbGVtZW50U2l6ZSwgZGF0YVt4aV1beWkgKyAxXSk7CiAgICAgICAgYy5zZXQoKHhpICsgMSkgKiBlbGVtZW50U2l6ZSwgeWkgKiBlbGVtZW50U2l6ZSwgZGF0YVt4aSArIDFdW3lpXSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgLy8gVG9wIHRyaWFuZ2xlIHZlcnRzCiAgICAgICAgYS5zZXQoeGkgKiBlbGVtZW50U2l6ZSwgeWkgKiBlbGVtZW50U2l6ZSwgZGF0YVt4aV1beWldKTsKICAgICAgICBiLnNldCgoeGkgKyAxKSAqIGVsZW1lbnRTaXplLCB5aSAqIGVsZW1lbnRTaXplLCBkYXRhW3hpICsgMV1beWldKTsKICAgICAgICBjLnNldCh4aSAqIGVsZW1lbnRTaXplLCAoeWkgKyAxKSAqIGVsZW1lbnRTaXplLCBkYXRhW3hpXVt5aSArIDFdKTsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBHZXQgYSB0cmlhbmdsZSBpbiB0aGUgdGVycmFpbiBpbiB0aGUgZm9ybSBvZiBhIHRyaWFuZ3VsYXIgY29udmV4IHNoYXBlLgogICAgICovCgoKICAgIGdldENvbnZleFRyaWFuZ2xlUGlsbGFyKHhpLCB5aSwgZ2V0VXBwZXJUcmlhbmdsZSkgewogICAgICBsZXQgcmVzdWx0ID0gdGhpcy5waWxsYXJDb252ZXg7CiAgICAgIGxldCBvZmZzZXRSZXN1bHQgPSB0aGlzLnBpbGxhck9mZnNldDsKCiAgICAgIGlmICh0aGlzLmNhY2hlRW5hYmxlZCkgewogICAgICAgIGNvbnN0IGRhdGEgPSB0aGlzLmdldENhY2hlZENvbnZleFRyaWFuZ2xlUGlsbGFyKHhpLCB5aSwgZ2V0VXBwZXJUcmlhbmdsZSk7CgogICAgICAgIGlmIChkYXRhKSB7CiAgICAgICAgICB0aGlzLnBpbGxhckNvbnZleCA9IGRhdGEuY29udmV4OwogICAgICAgICAgdGhpcy5waWxsYXJPZmZzZXQgPSBkYXRhLm9mZnNldDsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIHJlc3VsdCA9IG5ldyBDb252ZXhQb2x5aGVkcm9uKCk7CiAgICAgICAgb2Zmc2V0UmVzdWx0ID0gbmV3IFZlYzMoKTsKICAgICAgICB0aGlzLnBpbGxhckNvbnZleCA9IHJlc3VsdDsKICAgICAgICB0aGlzLnBpbGxhck9mZnNldCA9IG9mZnNldFJlc3VsdDsKICAgICAgfQoKICAgICAgY29uc3QgZGF0YSA9IHRoaXMuZGF0YTsKICAgICAgY29uc3QgZWxlbWVudFNpemUgPSB0aGlzLmVsZW1lbnRTaXplOwogICAgICBjb25zdCBmYWNlcyA9IHJlc3VsdC5mYWNlczsgLy8gUmV1c2UgdmVydHMgaWYgcG9zc2libGUKCiAgICAgIHJlc3VsdC52ZXJ0aWNlcy5sZW5ndGggPSA2OwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCA2OyBpKyspIHsKICAgICAgICBpZiAoIXJlc3VsdC52ZXJ0aWNlc1tpXSkgewogICAgICAgICAgcmVzdWx0LnZlcnRpY2VzW2ldID0gbmV3IFZlYzMoKTsKICAgICAgICB9CiAgICAgIH0gLy8gUmV1c2UgZmFjZXMgaWYgcG9zc2libGUKCgogICAgICBmYWNlcy5sZW5ndGggPSA1OwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCA1OyBpKyspIHsKICAgICAgICBpZiAoIWZhY2VzW2ldKSB7CiAgICAgICAgICBmYWNlc1tpXSA9IFtdOwogICAgICAgIH0KICAgICAgfQoKICAgICAgY29uc3QgdmVydHMgPSByZXN1bHQudmVydGljZXM7CiAgICAgIGNvbnN0IGggPSAoTWF0aC5taW4oZGF0YVt4aV1beWldLCBkYXRhW3hpICsgMV1beWldLCBkYXRhW3hpXVt5aSArIDFdLCBkYXRhW3hpICsgMV1beWkgKyAxXSkgLSB0aGlzLm1pblZhbHVlKSAvIDIgKyB0aGlzLm1pblZhbHVlOwoKICAgICAgaWYgKCFnZXRVcHBlclRyaWFuZ2xlKSB7CiAgICAgICAgLy8gQ2VudGVyIG9mIHRoZSB0cmlhbmdsZSBwaWxsYXIgLSBhbGwgcG9seWdvbnMgYXJlIGdpdmVuIHJlbGF0aXZlIHRvIHRoaXMgb25lCiAgICAgICAgb2Zmc2V0UmVzdWx0LnNldCgoeGkgKyAwLjI1KSAqIGVsZW1lbnRTaXplLCAvLyBzb3J0IG9mIGNlbnRlciBvZiBhIHRyaWFuZ2xlCiAgICAgICAgKHlpICsgMC4yNSkgKiBlbGVtZW50U2l6ZSwgaCAvLyB2ZXJ0aWNhbCBjZW50ZXIKICAgICAgICApOyAvLyBUb3AgdHJpYW5nbGUgdmVydHMKCiAgICAgICAgdmVydHNbMF0uc2V0KC0wLjI1ICogZWxlbWVudFNpemUsIC0wLjI1ICogZWxlbWVudFNpemUsIGRhdGFbeGldW3lpXSAtIGgpOwogICAgICAgIHZlcnRzWzFdLnNldCgwLjc1ICogZWxlbWVudFNpemUsIC0wLjI1ICogZWxlbWVudFNpemUsIGRhdGFbeGkgKyAxXVt5aV0gLSBoKTsKICAgICAgICB2ZXJ0c1syXS5zZXQoLTAuMjUgKiBlbGVtZW50U2l6ZSwgMC43NSAqIGVsZW1lbnRTaXplLCBkYXRhW3hpXVt5aSArIDFdIC0gaCk7IC8vIGJvdHRvbSB0cmlhbmdsZSB2ZXJ0cwoKICAgICAgICB2ZXJ0c1szXS5zZXQoLTAuMjUgKiBlbGVtZW50U2l6ZSwgLTAuMjUgKiBlbGVtZW50U2l6ZSwgLU1hdGguYWJzKGgpIC0gMSk7CiAgICAgICAgdmVydHNbNF0uc2V0KDAuNzUgKiBlbGVtZW50U2l6ZSwgLTAuMjUgKiBlbGVtZW50U2l6ZSwgLU1hdGguYWJzKGgpIC0gMSk7CiAgICAgICAgdmVydHNbNV0uc2V0KC0wLjI1ICogZWxlbWVudFNpemUsIDAuNzUgKiBlbGVtZW50U2l6ZSwgLU1hdGguYWJzKGgpIC0gMSk7IC8vIHRvcCB0cmlhbmdsZQoKICAgICAgICBmYWNlc1swXVswXSA9IDA7CiAgICAgICAgZmFjZXNbMF1bMV0gPSAxOwogICAgICAgIGZhY2VzWzBdWzJdID0gMjsgLy8gYm90dG9tIHRyaWFuZ2xlCgogICAgICAgIGZhY2VzWzFdWzBdID0gNTsKICAgICAgICBmYWNlc1sxXVsxXSA9IDQ7CiAgICAgICAgZmFjZXNbMV1bMl0gPSAzOyAvLyAteCBmYWNpbmcgcXVhZAoKICAgICAgICBmYWNlc1syXVswXSA9IDA7CiAgICAgICAgZmFjZXNbMl1bMV0gPSAyOwogICAgICAgIGZhY2VzWzJdWzJdID0gNTsKICAgICAgICBmYWNlc1syXVszXSA9IDM7IC8vIC15IGZhY2luZyBxdWFkCgogICAgICAgIGZhY2VzWzNdWzBdID0gMTsKICAgICAgICBmYWNlc1szXVsxXSA9IDA7CiAgICAgICAgZmFjZXNbM11bMl0gPSAzOwogICAgICAgIGZhY2VzWzNdWzNdID0gNDsgLy8gK3h5IGZhY2luZyBxdWFkCgogICAgICAgIGZhY2VzWzRdWzBdID0gNDsKICAgICAgICBmYWNlc1s0XVsxXSA9IDU7CiAgICAgICAgZmFjZXNbNF1bMl0gPSAyOwogICAgICAgIGZhY2VzWzRdWzNdID0gMTsKICAgICAgfSBlbHNlIHsKICAgICAgICAvLyBDZW50ZXIgb2YgdGhlIHRyaWFuZ2xlIHBpbGxhciAtIGFsbCBwb2x5Z29ucyBhcmUgZ2l2ZW4gcmVsYXRpdmUgdG8gdGhpcyBvbmUKICAgICAgICBvZmZzZXRSZXN1bHQuc2V0KCh4aSArIDAuNzUpICogZWxlbWVudFNpemUsIC8vIHNvcnQgb2YgY2VudGVyIG9mIGEgdHJpYW5nbGUKICAgICAgICAoeWkgKyAwLjc1KSAqIGVsZW1lbnRTaXplLCBoIC8vIHZlcnRpY2FsIGNlbnRlcgogICAgICAgICk7IC8vIFRvcCB0cmlhbmdsZSB2ZXJ0cwoKICAgICAgICB2ZXJ0c1swXS5zZXQoMC4yNSAqIGVsZW1lbnRTaXplLCAwLjI1ICogZWxlbWVudFNpemUsIGRhdGFbeGkgKyAxXVt5aSArIDFdIC0gaCk7CiAgICAgICAgdmVydHNbMV0uc2V0KC0wLjc1ICogZWxlbWVudFNpemUsIDAuMjUgKiBlbGVtZW50U2l6ZSwgZGF0YVt4aV1beWkgKyAxXSAtIGgpOwogICAgICAgIHZlcnRzWzJdLnNldCgwLjI1ICogZWxlbWVudFNpemUsIC0wLjc1ICogZWxlbWVudFNpemUsIGRhdGFbeGkgKyAxXVt5aV0gLSBoKTsgLy8gYm90dG9tIHRyaWFuZ2xlIHZlcnRzCgogICAgICAgIHZlcnRzWzNdLnNldCgwLjI1ICogZWxlbWVudFNpemUsIDAuMjUgKiBlbGVtZW50U2l6ZSwgLU1hdGguYWJzKGgpIC0gMSk7CiAgICAgICAgdmVydHNbNF0uc2V0KC0wLjc1ICogZWxlbWVudFNpemUsIDAuMjUgKiBlbGVtZW50U2l6ZSwgLU1hdGguYWJzKGgpIC0gMSk7CiAgICAgICAgdmVydHNbNV0uc2V0KDAuMjUgKiBlbGVtZW50U2l6ZSwgLTAuNzUgKiBlbGVtZW50U2l6ZSwgLU1hdGguYWJzKGgpIC0gMSk7IC8vIFRvcCB0cmlhbmdsZQoKICAgICAgICBmYWNlc1swXVswXSA9IDA7CiAgICAgICAgZmFjZXNbMF1bMV0gPSAxOwogICAgICAgIGZhY2VzWzBdWzJdID0gMjsgLy8gYm90dG9tIHRyaWFuZ2xlCgogICAgICAgIGZhY2VzWzFdWzBdID0gNTsKICAgICAgICBmYWNlc1sxXVsxXSA9IDQ7CiAgICAgICAgZmFjZXNbMV1bMl0gPSAzOyAvLyAreCBmYWNpbmcgcXVhZAoKICAgICAgICBmYWNlc1syXVswXSA9IDI7CiAgICAgICAgZmFjZXNbMl1bMV0gPSA1OwogICAgICAgIGZhY2VzWzJdWzJdID0gMzsKICAgICAgICBmYWNlc1syXVszXSA9IDA7IC8vICt5IGZhY2luZyBxdWFkCgogICAgICAgIGZhY2VzWzNdWzBdID0gMzsKICAgICAgICBmYWNlc1szXVsxXSA9IDQ7CiAgICAgICAgZmFjZXNbM11bMl0gPSAxOwogICAgICAgIGZhY2VzWzNdWzNdID0gMDsgLy8gLXh5IGZhY2luZyBxdWFkCgogICAgICAgIGZhY2VzWzRdWzBdID0gMTsKICAgICAgICBmYWNlc1s0XVsxXSA9IDQ7CiAgICAgICAgZmFjZXNbNF1bMl0gPSA1OwogICAgICAgIGZhY2VzWzRdWzNdID0gMjsKICAgICAgfQoKICAgICAgcmVzdWx0LmNvbXB1dGVOb3JtYWxzKCk7CiAgICAgIHJlc3VsdC5jb21wdXRlRWRnZXMoKTsKICAgICAgcmVzdWx0LnVwZGF0ZUJvdW5kaW5nU3BoZXJlUmFkaXVzKCk7CiAgICAgIHRoaXMuc2V0Q2FjaGVkQ29udmV4VHJpYW5nbGVQaWxsYXIoeGksIHlpLCBnZXRVcHBlclRyaWFuZ2xlLCByZXN1bHQsIG9mZnNldFJlc3VsdCk7CiAgICB9CgogICAgY2FsY3VsYXRlTG9jYWxJbmVydGlhKG1hc3MsIHRhcmdldCkgewogICAgICBpZiAodGFyZ2V0ID09PSB2b2lkIDApIHsKICAgICAgICB0YXJnZXQgPSBuZXcgVmVjMygpOwogICAgICB9CgogICAgICB0YXJnZXQuc2V0KDAsIDAsIDApOwogICAgICByZXR1cm4gdGFyZ2V0OwogICAgfQoKICAgIHZvbHVtZSgpIHsKICAgICAgcmV0dXJuICgvLyBUaGUgdGVycmFpbiBpcyBpbmZpbml0ZQogICAgICAgIE51bWJlci5NQVhfVkFMVUUKICAgICAgKTsKICAgIH0KCiAgICBjYWxjdWxhdGVXb3JsZEFBQkIocG9zLCBxdWF0LCBtaW4sIG1heCkgewogICAgICAvKiogQFRPRE8gZG8gaXQgcHJvcGVybHkgKi8KICAgICAgbWluLnNldCgtTnVtYmVyLk1BWF9WQUxVRSwgLU51bWJlci5NQVhfVkFMVUUsIC1OdW1iZXIuTUFYX1ZBTFVFKTsKICAgICAgbWF4LnNldChOdW1iZXIuTUFYX1ZBTFVFLCBOdW1iZXIuTUFYX1ZBTFVFLCBOdW1iZXIuTUFYX1ZBTFVFKTsKICAgIH0KCiAgICB1cGRhdGVCb3VuZGluZ1NwaGVyZVJhZGl1cygpIHsKICAgICAgLy8gVXNlIHRoZSBib3VuZGluZyBib3ggb2YgdGhlIG1pbi9tYXggdmFsdWVzCiAgICAgIGNvbnN0IGRhdGEgPSB0aGlzLmRhdGE7CiAgICAgIGNvbnN0IHMgPSB0aGlzLmVsZW1lbnRTaXplOwogICAgICB0aGlzLmJvdW5kaW5nU3BoZXJlUmFkaXVzID0gbmV3IFZlYzMoZGF0YS5sZW5ndGggKiBzLCBkYXRhWzBdLmxlbmd0aCAqIHMsIE1hdGgubWF4KE1hdGguYWJzKHRoaXMubWF4VmFsdWUpLCBNYXRoLmFicyh0aGlzLm1pblZhbHVlKSkpLmxlbmd0aCgpOwogICAgfQogICAgLyoqCiAgICAgKiBTZXRzIHRoZSBoZWlnaHQgdmFsdWVzIGZyb20gYW4gaW1hZ2UuIEN1cnJlbnRseSBvbmx5IHN1cHBvcnRlZCBpbiBicm93c2VyLgogICAgICovCgoKICAgIHNldEhlaWdodHNGcm9tSW1hZ2UoaW1hZ2UsIHNjYWxlKSB7CiAgICAgIGNvbnN0IHsKICAgICAgICB4LAogICAgICAgIHosCiAgICAgICAgeQogICAgICB9ID0gc2NhbGU7CiAgICAgIGNvbnN0IGNhbnZhcyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2NhbnZhcycpOwogICAgICBjYW52YXMud2lkdGggPSBpbWFnZS53aWR0aDsKICAgICAgY2FudmFzLmhlaWdodCA9IGltYWdlLmhlaWdodDsKICAgICAgY29uc3QgY29udGV4dCA9IGNhbnZhcy5nZXRDb250ZXh0KCcyZCcpOwogICAgICBjb250ZXh0LmRyYXdJbWFnZShpbWFnZSwgMCwgMCk7CiAgICAgIGNvbnN0IGltYWdlRGF0YSA9IGNvbnRleHQuZ2V0SW1hZ2VEYXRhKDAsIDAsIGltYWdlLndpZHRoLCBpbWFnZS5oZWlnaHQpOwogICAgICBjb25zdCBtYXRyaXggPSB0aGlzLmRhdGE7CiAgICAgIG1hdHJpeC5sZW5ndGggPSAwOwogICAgICB0aGlzLmVsZW1lbnRTaXplID0gTWF0aC5hYnMoeCkgLyBpbWFnZURhdGEud2lkdGg7CgogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGltYWdlRGF0YS5oZWlnaHQ7IGkrKykgewogICAgICAgIGNvbnN0IHJvdyA9IFtdOwoKICAgICAgICBmb3IgKGxldCBqID0gMDsgaiA8IGltYWdlRGF0YS53aWR0aDsgaisrKSB7CiAgICAgICAgICBjb25zdCBhID0gaW1hZ2VEYXRhLmRhdGFbKGkgKiBpbWFnZURhdGEuaGVpZ2h0ICsgaikgKiA0XTsKICAgICAgICAgIGNvbnN0IGIgPSBpbWFnZURhdGEuZGF0YVsoaSAqIGltYWdlRGF0YS5oZWlnaHQgKyBqKSAqIDQgKyAxXTsKICAgICAgICAgIGNvbnN0IGMgPSBpbWFnZURhdGEuZGF0YVsoaSAqIGltYWdlRGF0YS5oZWlnaHQgKyBqKSAqIDQgKyAyXTsKICAgICAgICAgIGNvbnN0IGhlaWdodCA9IChhICsgYiArIGMpIC8gNCAvIDI1NSAqIHo7CgogICAgICAgICAgaWYgKHggPCAwKSB7CiAgICAgICAgICAgIHJvdy5wdXNoKGhlaWdodCk7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICByb3cudW5zaGlmdChoZWlnaHQpOwogICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgaWYgKHkgPCAwKSB7CiAgICAgICAgICBtYXRyaXgudW5zaGlmdChyb3cpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBtYXRyaXgucHVzaChyb3cpOwogICAgICAgIH0KICAgICAgfQoKICAgICAgdGhpcy51cGRhdGVNYXhWYWx1ZSgpOwogICAgICB0aGlzLnVwZGF0ZU1pblZhbHVlKCk7CiAgICAgIHRoaXMudXBkYXRlKCk7CiAgICB9CgogIH0KICBjb25zdCBnZXRIZWlnaHRBdF9pZHggPSBbXTsKICBjb25zdCBnZXRIZWlnaHRBdF93ZWlnaHRzID0gbmV3IFZlYzMoKTsKICBjb25zdCBnZXRIZWlnaHRBdF9hID0gbmV3IFZlYzMoKTsKICBjb25zdCBnZXRIZWlnaHRBdF9iID0gbmV3IFZlYzMoKTsKICBjb25zdCBnZXRIZWlnaHRBdF9jID0gbmV3IFZlYzMoKTsKICBjb25zdCBnZXROb3JtYWxBdF9hID0gbmV3IFZlYzMoKTsKICBjb25zdCBnZXROb3JtYWxBdF9iID0gbmV3IFZlYzMoKTsKICBjb25zdCBnZXROb3JtYWxBdF9jID0gbmV3IFZlYzMoKTsKICBjb25zdCBnZXROb3JtYWxBdF9lMCA9IG5ldyBWZWMzKCk7CiAgY29uc3QgZ2V0Tm9ybWFsQXRfZTEgPSBuZXcgVmVjMygpOyAvLyBmcm9tIGh0dHBzOi8vZW4ud2lraXBlZGlhLm9yZy93aWtpL0JhcnljZW50cmljX2Nvb3JkaW5hdGVfc3lzdGVtCgogIGZ1bmN0aW9uIGJhcnljZW50cmljV2VpZ2h0cyh4LCB5LCBheCwgYXksIGJ4LCBieSwgY3gsIGN5LCByZXN1bHQpIHsKICAgIHJlc3VsdC54ID0gKChieSAtIGN5KSAqICh4IC0gY3gpICsgKGN4IC0gYngpICogKHkgLSBjeSkpIC8gKChieSAtIGN5KSAqIChheCAtIGN4KSArIChjeCAtIGJ4KSAqIChheSAtIGN5KSk7CiAgICByZXN1bHQueSA9ICgoY3kgLSBheSkgKiAoeCAtIGN4KSArIChheCAtIGN4KSAqICh5IC0gY3kpKSAvICgoYnkgLSBjeSkgKiAoYXggLSBjeCkgKyAoY3ggLSBieCkgKiAoYXkgLSBjeSkpOwogICAgcmVzdWx0LnogPSAxIC0gcmVzdWx0LnggLSByZXN1bHQueTsKICB9CgogIC8qKgogICAqIE9jdHJlZU5vZGUKICAgKi8KICBjbGFzcyBPY3RyZWVOb2RlIHsKICAgIC8qKiBUaGUgcm9vdCBub2RlICovCgogICAgLyoqIEJvdW5kYXJ5IG9mIHRoaXMgbm9kZSAqLwoKICAgIC8qKiBDb250YWluZWQgZGF0YSBhdCB0aGUgY3VycmVudCBub2RlIGxldmVsICovCgogICAgLyoqIENoaWxkcmVuIHRvIHRoaXMgbm9kZSAqLwogICAgY29uc3RydWN0b3Iob3B0aW9ucykgewogICAgICBpZiAob3B0aW9ucyA9PT0gdm9pZCAwKSB7CiAgICAgICAgb3B0aW9ucyA9IHt9OwogICAgICB9CgogICAgICB0aGlzLnJvb3QgPSBvcHRpb25zLnJvb3QgfHwgbnVsbDsKICAgICAgdGhpcy5hYWJiID0gb3B0aW9ucy5hYWJiID8gb3B0aW9ucy5hYWJiLmNsb25lKCkgOiBuZXcgQUFCQigpOwogICAgICB0aGlzLmRhdGEgPSBbXTsKICAgICAgdGhpcy5jaGlsZHJlbiA9IFtdOwogICAgfQogICAgLyoqCiAgICAgKiByZXNldAogICAgICovCgoKICAgIHJlc2V0KCkgewogICAgICB0aGlzLmNoaWxkcmVuLmxlbmd0aCA9IHRoaXMuZGF0YS5sZW5ndGggPSAwOwogICAgfQogICAgLyoqCiAgICAgKiBJbnNlcnQgZGF0YSBpbnRvIHRoaXMgbm9kZQogICAgICogQHJldHVybiBUcnVlIGlmIHN1Y2Nlc3NmdWwsIG90aGVyd2lzZSBmYWxzZQogICAgICovCgoKICAgIGluc2VydChhYWJiLCBlbGVtZW50RGF0YSwgbGV2ZWwpIHsKICAgICAgaWYgKGxldmVsID09PSB2b2lkIDApIHsKICAgICAgICBsZXZlbCA9IDA7CiAgICAgIH0KCiAgICAgIGNvbnN0IG5vZGVEYXRhID0gdGhpcy5kYXRhOyAvLyBJZ25vcmUgb2JqZWN0cyB0aGF0IGRvIG5vdCBiZWxvbmcgaW4gdGhpcyBub2RlCgogICAgICBpZiAoIXRoaXMuYWFiYi5jb250YWlucyhhYWJiKSkgewogICAgICAgIHJldHVybiBmYWxzZTsgLy8gb2JqZWN0IGNhbm5vdCBiZSBhZGRlZAogICAgICB9CgogICAgICBjb25zdCBjaGlsZHJlbiA9IHRoaXMuY2hpbGRyZW47CiAgICAgIGNvbnN0IG1heERlcHRoID0gdGhpcy5tYXhEZXB0aCB8fCB0aGlzLnJvb3QubWF4RGVwdGg7CgogICAgICBpZiAobGV2ZWwgPCBtYXhEZXB0aCkgewogICAgICAgIC8vIFN1YmRpdmlkZSBpZiB0aGVyZSBhcmUgbm8gY2hpbGRyZW4geWV0CiAgICAgICAgbGV0IHN1YmRpdmlkZWQgPSBmYWxzZTsKCiAgICAgICAgaWYgKCFjaGlsZHJlbi5sZW5ndGgpIHsKICAgICAgICAgIHRoaXMuc3ViZGl2aWRlKCk7CiAgICAgICAgICBzdWJkaXZpZGVkID0gdHJ1ZTsKICAgICAgICB9IC8vIGFkZCB0byB3aGljaGV2ZXIgbm9kZSB3aWxsIGFjY2VwdCBpdAoKCiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgIT09IDg7IGkrKykgewogICAgICAgICAgaWYgKGNoaWxkcmVuW2ldLmluc2VydChhYWJiLCBlbGVtZW50RGF0YSwgbGV2ZWwgKyAxKSkgewogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGlmIChzdWJkaXZpZGVkKSB7CiAgICAgICAgICAvLyBObyBjaGlsZHJlbiBhY2NlcHRlZCEgTWlnaHQgYXMgd2VsbCBqdXN0IHJlbW92ZSBlbSBzaW5jZSB0aGV5IGNvbnRhaW4gbm9uZQogICAgICAgICAgY2hpbGRyZW4ubGVuZ3RoID0gMDsKICAgICAgICB9CiAgICAgIH0gLy8gVG9vIGRlZXAsIG9yIGNoaWxkcmVuIGRpZG50IHdhbnQgaXQuIGFkZCBpdCBpbiBjdXJyZW50IG5vZGUKCgogICAgICBub2RlRGF0YS5wdXNoKGVsZW1lbnREYXRhKTsKICAgICAgcmV0dXJuIHRydWU7CiAgICB9CiAgICAvKioKICAgICAqIENyZWF0ZSA4IGVxdWFsbHkgc2l6ZWQgY2hpbGRyZW4gbm9kZXMgYW5kIHB1dCB0aGVtIGluIHRoZSBgY2hpbGRyZW5gIGFycmF5LgogICAgICovCgoKICAgIHN1YmRpdmlkZSgpIHsKICAgICAgY29uc3QgYWFiYiA9IHRoaXMuYWFiYjsKICAgICAgY29uc3QgbCA9IGFhYmIubG93ZXJCb3VuZDsKICAgICAgY29uc3QgdSA9IGFhYmIudXBwZXJCb3VuZDsKICAgICAgY29uc3QgY2hpbGRyZW4gPSB0aGlzLmNoaWxkcmVuOwogICAgICBjaGlsZHJlbi5wdXNoKG5ldyBPY3RyZWVOb2RlKHsKICAgICAgICBhYWJiOiBuZXcgQUFCQih7CiAgICAgICAgICBsb3dlckJvdW5kOiBuZXcgVmVjMygwLCAwLCAwKQogICAgICAgIH0pCiAgICAgIH0pLCBuZXcgT2N0cmVlTm9kZSh7CiAgICAgICAgYWFiYjogbmV3IEFBQkIoewogICAgICAgICAgbG93ZXJCb3VuZDogbmV3IFZlYzMoMSwgMCwgMCkKICAgICAgICB9KQogICAgICB9KSwgbmV3IE9jdHJlZU5vZGUoewogICAgICAgIGFhYmI6IG5ldyBBQUJCKHsKICAgICAgICAgIGxvd2VyQm91bmQ6IG5ldyBWZWMzKDEsIDEsIDApCiAgICAgICAgfSkKICAgICAgfSksIG5ldyBPY3RyZWVOb2RlKHsKICAgICAgICBhYWJiOiBuZXcgQUFCQih7CiAgICAgICAgICBsb3dlckJvdW5kOiBuZXcgVmVjMygxLCAxLCAxKQogICAgICAgIH0pCiAgICAgIH0pLCBuZXcgT2N0cmVlTm9kZSh7CiAgICAgICAgYWFiYjogbmV3IEFBQkIoewogICAgICAgICAgbG93ZXJCb3VuZDogbmV3IFZlYzMoMCwgMSwgMSkKICAgICAgICB9KQogICAgICB9KSwgbmV3IE9jdHJlZU5vZGUoewogICAgICAgIGFhYmI6IG5ldyBBQUJCKHsKICAgICAgICAgIGxvd2VyQm91bmQ6IG5ldyBWZWMzKDAsIDAsIDEpCiAgICAgICAgfSkKICAgICAgfSksIG5ldyBPY3RyZWVOb2RlKHsKICAgICAgICBhYWJiOiBuZXcgQUFCQih7CiAgICAgICAgICBsb3dlckJvdW5kOiBuZXcgVmVjMygxLCAwLCAxKQogICAgICAgIH0pCiAgICAgIH0pLCBuZXcgT2N0cmVlTm9kZSh7CiAgICAgICAgYWFiYjogbmV3IEFBQkIoewogICAgICAgICAgbG93ZXJCb3VuZDogbmV3IFZlYzMoMCwgMSwgMCkKICAgICAgICB9KQogICAgICB9KSk7CiAgICAgIHUudnN1YihsLCBoYWxmRGlhZ29uYWwpOwogICAgICBoYWxmRGlhZ29uYWwuc2NhbGUoMC41LCBoYWxmRGlhZ29uYWwpOwogICAgICBjb25zdCByb290ID0gdGhpcy5yb290IHx8IHRoaXM7CgogICAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gODsgaSsrKSB7CiAgICAgICAgY29uc3QgY2hpbGQgPSBjaGlsZHJlbltpXTsgLy8gU2V0IGN1cnJlbnQgbm9kZSBhcyByb290CgogICAgICAgIGNoaWxkLnJvb3QgPSByb290OyAvLyBDb21wdXRlIGJvdW5kcwoKICAgICAgICBjb25zdCBsb3dlckJvdW5kID0gY2hpbGQuYWFiYi5sb3dlckJvdW5kOwogICAgICAgIGxvd2VyQm91bmQueCAqPSBoYWxmRGlhZ29uYWwueDsKICAgICAgICBsb3dlckJvdW5kLnkgKj0gaGFsZkRpYWdvbmFsLnk7CiAgICAgICAgbG93ZXJCb3VuZC56ICo9IGhhbGZEaWFnb25hbC56OwogICAgICAgIGxvd2VyQm91bmQudmFkZChsLCBsb3dlckJvdW5kKTsgLy8gVXBwZXIgYm91bmQgaXMgYWx3YXlzIGxvd2VyIGJvdW5kICsgaGFsZkRpYWdvbmFsCgogICAgICAgIGxvd2VyQm91bmQudmFkZChoYWxmRGlhZ29uYWwsIGNoaWxkLmFhYmIudXBwZXJCb3VuZCk7CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogR2V0IGFsbCBkYXRhLCBwb3RlbnRpYWxseSB3aXRoaW4gYW4gQUFCQgogICAgICogQHJldHVybiBUaGUgInJlc3VsdCIgb2JqZWN0CiAgICAgKi8KCgogICAgYWFiYlF1ZXJ5KGFhYmIsIHJlc3VsdCkgewogICAgICB0aGlzLmRhdGE7IC8vIGFib3J0IGlmIHRoZSByYW5nZSBkb2VzIG5vdCBpbnRlcnNlY3QgdGhpcyBub2RlCiAgICAgIC8vIGlmICghdGhpcy5hYWJiLm92ZXJsYXBzKGFhYmIpKXsKICAgICAgLy8gICAgIHJldHVybiByZXN1bHQ7CiAgICAgIC8vIH0KICAgICAgLy8gQWRkIG9iamVjdHMgYXQgdGhpcyBsZXZlbAogICAgICAvLyBBcnJheS5wcm90b3R5cGUucHVzaC5hcHBseShyZXN1bHQsIG5vZGVEYXRhKTsKICAgICAgLy8gQWRkIGNoaWxkIGRhdGEKICAgICAgLy8gQHRvZG8gdW53cmFwIHJlY3Vyc2lvbiBpbnRvIGEgcXVldWUgLyBsb29wLCB0aGF0J3MgZmFzdGVyIGluIEpTCgogICAgICB0aGlzLmNoaWxkcmVuOyAvLyBmb3IgKGxldCBpID0gMCwgTiA9IHRoaXMuY2hpbGRyZW4ubGVuZ3RoOyBpICE9PSBOOyBpKyspIHsKICAgICAgLy8gICAgIGNoaWxkcmVuW2ldLmFhYmJRdWVyeShhYWJiLCByZXN1bHQpOwogICAgICAvLyB9CgogICAgICBjb25zdCBxdWV1ZSA9IFt0aGlzXTsKCiAgICAgIHdoaWxlIChxdWV1ZS5sZW5ndGgpIHsKICAgICAgICBjb25zdCBub2RlID0gcXVldWUucG9wKCk7CgogICAgICAgIGlmIChub2RlLmFhYmIub3ZlcmxhcHMoYWFiYikpIHsKICAgICAgICAgIEFycmF5LnByb3RvdHlwZS5wdXNoLmFwcGx5KHJlc3VsdCwgbm9kZS5kYXRhKTsKICAgICAgICB9CgogICAgICAgIEFycmF5LnByb3RvdHlwZS5wdXNoLmFwcGx5KHF1ZXVlLCBub2RlLmNoaWxkcmVuKTsKICAgICAgfQoKICAgICAgcmV0dXJuIHJlc3VsdDsKICAgIH0KICAgIC8qKgogICAgICogR2V0IGFsbCBkYXRhLCBwb3RlbnRpYWxseSBpbnRlcnNlY3RlZCBieSBhIHJheS4KICAgICAqIEByZXR1cm4gVGhlICJyZXN1bHQiIG9iamVjdAogICAgICovCgoKICAgIHJheVF1ZXJ5KHJheSwgdHJlZVRyYW5zZm9ybSwgcmVzdWx0KSB7CiAgICAgIC8vIFVzZSBhYWJiIHF1ZXJ5IGZvciBub3cuCgogICAgICAvKiogQHRvZG8gaW1wbGVtZW50IHJlYWwgcmF5IHF1ZXJ5IHdoaWNoIG5lZWRzIGxlc3MgbG9va3VwcyAqLwogICAgICByYXkuZ2V0QUFCQih0bXBBQUJCKTsKICAgICAgdG1wQUFCQi50b0xvY2FsRnJhbWUodHJlZVRyYW5zZm9ybSwgdG1wQUFCQik7CiAgICAgIHRoaXMuYWFiYlF1ZXJ5KHRtcEFBQkIsIHJlc3VsdCk7CiAgICAgIHJldHVybiByZXN1bHQ7CiAgICB9CiAgICAvKioKICAgICAqIHJlbW92ZUVtcHR5Tm9kZXMKICAgICAqLwoKCiAgICByZW1vdmVFbXB0eU5vZGVzKCkgewogICAgICBmb3IgKGxldCBpID0gdGhpcy5jaGlsZHJlbi5sZW5ndGggLSAxOyBpID49IDA7IGktLSkgewogICAgICAgIHRoaXMuY2hpbGRyZW5baV0ucmVtb3ZlRW1wdHlOb2RlcygpOwoKICAgICAgICBpZiAoIXRoaXMuY2hpbGRyZW5baV0uY2hpbGRyZW4ubGVuZ3RoICYmICF0aGlzLmNoaWxkcmVuW2ldLmRhdGEubGVuZ3RoKSB7CiAgICAgICAgICB0aGlzLmNoaWxkcmVuLnNwbGljZShpLCAxKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KCiAgfQogIC8qKgogICAqIE9jdHJlZQogICAqLwoKCiAgY2xhc3MgT2N0cmVlIGV4dGVuZHMgT2N0cmVlTm9kZSB7CiAgICAvKioKICAgICAqIE1heGltdW0gc3ViZGl2aXNpb24gZGVwdGgKICAgICAqIEBkZWZhdWx0IDgKICAgICAqLwoKICAgIC8qKgogICAgICogQHBhcmFtIGFhYmIgVGhlIHRvdGFsIEFBQkIgb2YgdGhlIHRyZWUKICAgICAqLwogICAgY29uc3RydWN0b3IoYWFiYiwgb3B0aW9ucykgewogICAgICBpZiAob3B0aW9ucyA9PT0gdm9pZCAwKSB7CiAgICAgICAgb3B0aW9ucyA9IHt9OwogICAgICB9CgogICAgICBzdXBlcih7CiAgICAgICAgcm9vdDogbnVsbCwKICAgICAgICBhYWJiCiAgICAgIH0pOwogICAgICB0aGlzLm1heERlcHRoID0gdHlwZW9mIG9wdGlvbnMubWF4RGVwdGggIT09ICd1bmRlZmluZWQnID8gb3B0aW9ucy5tYXhEZXB0aCA6IDg7CiAgICB9CgogIH0KICBjb25zdCBoYWxmRGlhZ29uYWwgPSBuZXcgVmVjMygpOwogIGNvbnN0IHRtcEFBQkIgPSBuZXcgQUFCQigpOwoKICAvKioKICAgKiBUcmltZXNoLgogICAqIEBleGFtcGxlCiAgICogICAgIC8vIEhvdyB0byBtYWtlIGEgbWVzaCB3aXRoIGEgc2luZ2xlIHRyaWFuZ2xlCiAgICogICAgIGNvbnN0IHZlcnRpY2VzID0gWwogICAqICAgICAgICAgMCwgMCwgMCwgLy8gdmVydGV4IDAKICAgKiAgICAgICAgIDEsIDAsIDAsIC8vIHZlcnRleCAxCiAgICogICAgICAgICAwLCAxLCAwICAvLyB2ZXJ0ZXggMgogICAqICAgICBdCiAgICogICAgIGNvbnN0IGluZGljZXMgPSBbCiAgICogICAgICAgICAwLCAxLCAyICAvLyB0cmlhbmdsZSAwCiAgICogICAgIF0KICAgKiAgICAgY29uc3QgdHJpbWVzaFNoYXBlID0gbmV3IENBTk5PTi5UcmltZXNoKHZlcnRpY2VzLCBpbmRpY2VzKQogICAqLwogIGNsYXNzIFRyaW1lc2ggZXh0ZW5kcyBTaGFwZSB7CiAgICAvKioKICAgICAqIHZlcnRpY2VzCiAgICAgKi8KCiAgICAvKioKICAgICAqIEFycmF5IG9mIGludGVnZXJzLCBpbmRpY2F0aW5nIHdoaWNoIHZlcnRpY2VzIGVhY2ggdHJpYW5nbGUgY29uc2lzdHMgb2YuIFRoZSBsZW5ndGggb2YgdGhpcyBhcnJheSBpcyB0aHVzIDMgdGltZXMgdGhlIG51bWJlciBvZiB0cmlhbmdsZXMuCiAgICAgKi8KCiAgICAvKioKICAgICAqIFRoZSBub3JtYWxzIGRhdGEuCiAgICAgKi8KCiAgICAvKioKICAgICAqIFRoZSBsb2NhbCBBQUJCIG9mIHRoZSBtZXNoLgogICAgICovCgogICAgLyoqCiAgICAgKiBSZWZlcmVuY2VzIHRvIHZlcnRleCBwYWlycywgbWFraW5nIHVwIGFsbCB1bmlxdWUgZWRnZXMgaW4gdGhlIHRyaW1lc2guCiAgICAgKi8KCiAgICAvKioKICAgICAqIExvY2FsIHNjYWxpbmcgb2YgdGhlIG1lc2guIFVzZSAuc2V0U2NhbGUoKSB0byBzZXQgaXQuCiAgICAgKi8KCiAgICAvKioKICAgICAqIFRoZSBpbmRleGVkIHRyaWFuZ2xlcy4gVXNlIC51cGRhdGVUcmVlKCkgdG8gdXBkYXRlIGl0LgogICAgICovCiAgICBjb25zdHJ1Y3Rvcih2ZXJ0aWNlcywgaW5kaWNlcykgewogICAgICBzdXBlcih7CiAgICAgICAgdHlwZTogU2hhcGUudHlwZXMuVFJJTUVTSAogICAgICB9KTsKICAgICAgdGhpcy52ZXJ0aWNlcyA9IG5ldyBGbG9hdDMyQXJyYXkodmVydGljZXMpOwogICAgICB0aGlzLmluZGljZXMgPSBuZXcgSW50MTZBcnJheShpbmRpY2VzKTsKICAgICAgdGhpcy5ub3JtYWxzID0gbmV3IEZsb2F0MzJBcnJheShpbmRpY2VzLmxlbmd0aCk7CiAgICAgIHRoaXMuYWFiYiA9IG5ldyBBQUJCKCk7CiAgICAgIHRoaXMuZWRnZXMgPSBudWxsOwogICAgICB0aGlzLnNjYWxlID0gbmV3IFZlYzMoMSwgMSwgMSk7CiAgICAgIHRoaXMudHJlZSA9IG5ldyBPY3RyZWUoKTsKICAgICAgdGhpcy51cGRhdGVFZGdlcygpOwogICAgICB0aGlzLnVwZGF0ZU5vcm1hbHMoKTsKICAgICAgdGhpcy51cGRhdGVBQUJCKCk7CiAgICAgIHRoaXMudXBkYXRlQm91bmRpbmdTcGhlcmVSYWRpdXMoKTsKICAgICAgdGhpcy51cGRhdGVUcmVlKCk7CiAgICB9CiAgICAvKioKICAgICAqIHVwZGF0ZVRyZWUKICAgICAqLwoKCiAgICB1cGRhdGVUcmVlKCkgewogICAgICBjb25zdCB0cmVlID0gdGhpcy50cmVlOwogICAgICB0cmVlLnJlc2V0KCk7CiAgICAgIHRyZWUuYWFiYi5jb3B5KHRoaXMuYWFiYik7CiAgICAgIGNvbnN0IHNjYWxlID0gdGhpcy5zY2FsZTsgLy8gVGhlIGxvY2FsIG1lc2ggQUFCQiBpcyBzY2FsZWQsIGJ1dCB0aGUgb2N0cmVlIEFBQkIgc2hvdWxkIGJlIHVuc2NhbGVkCgogICAgICB0cmVlLmFhYmIubG93ZXJCb3VuZC54ICo9IDEgLyBzY2FsZS54OwogICAgICB0cmVlLmFhYmIubG93ZXJCb3VuZC55ICo9IDEgLyBzY2FsZS55OwogICAgICB0cmVlLmFhYmIubG93ZXJCb3VuZC56ICo9IDEgLyBzY2FsZS56OwogICAgICB0cmVlLmFhYmIudXBwZXJCb3VuZC54ICo9IDEgLyBzY2FsZS54OwogICAgICB0cmVlLmFhYmIudXBwZXJCb3VuZC55ICo9IDEgLyBzY2FsZS55OwogICAgICB0cmVlLmFhYmIudXBwZXJCb3VuZC56ICo9IDEgLyBzY2FsZS56OyAvLyBJbnNlcnQgYWxsIHRyaWFuZ2xlcwoKICAgICAgY29uc3QgdHJpYW5nbGVBQUJCID0gbmV3IEFBQkIoKTsKICAgICAgY29uc3QgYSA9IG5ldyBWZWMzKCk7CiAgICAgIGNvbnN0IGIgPSBuZXcgVmVjMygpOwogICAgICBjb25zdCBjID0gbmV3IFZlYzMoKTsKICAgICAgY29uc3QgcG9pbnRzID0gW2EsIGIsIGNdOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0aGlzLmluZGljZXMubGVuZ3RoIC8gMzsgaSsrKSB7CiAgICAgICAgLy90aGlzLmdldFRyaWFuZ2xlVmVydGljZXMoaSwgYSwgYiwgYyk7CiAgICAgICAgLy8gR2V0IHVuc2NhbGVkIHRyaWFuZ2xlIHZlcnRzCiAgICAgICAgY29uc3QgaTMgPSBpICogMzsKCiAgICAgICAgdGhpcy5fZ2V0VW5zY2FsZWRWZXJ0ZXgodGhpcy5pbmRpY2VzW2kzXSwgYSk7CgogICAgICAgIHRoaXMuX2dldFVuc2NhbGVkVmVydGV4KHRoaXMuaW5kaWNlc1tpMyArIDFdLCBiKTsKCiAgICAgICAgdGhpcy5fZ2V0VW5zY2FsZWRWZXJ0ZXgodGhpcy5pbmRpY2VzW2kzICsgMl0sIGMpOwoKICAgICAgICB0cmlhbmdsZUFBQkIuc2V0RnJvbVBvaW50cyhwb2ludHMpOwogICAgICAgIHRyZWUuaW5zZXJ0KHRyaWFuZ2xlQUFCQiwgaSk7CiAgICAgIH0KCiAgICAgIHRyZWUucmVtb3ZlRW1wdHlOb2RlcygpOwogICAgfQogICAgLyoqCiAgICAgKiBHZXQgdHJpYW5nbGVzIGluIGEgbG9jYWwgQUFCQiBmcm9tIHRoZSB0cmltZXNoLgogICAgICogQHBhcmFtIHJlc3VsdCBBbiBhcnJheSBvZiBpbnRlZ2VycywgcmVmZXJlbmNpbmcgdGhlIHF1ZXJpZWQgdHJpYW5nbGVzLgogICAgICovCgoKICAgIGdldFRyaWFuZ2xlc0luQUFCQihhYWJiLCByZXN1bHQpIHsKICAgICAgdW5zY2FsZWRBQUJCLmNvcHkoYWFiYik7IC8vIFNjYWxlIGl0IHRvIGxvY2FsCgogICAgICBjb25zdCBzY2FsZSA9IHRoaXMuc2NhbGU7CiAgICAgIGNvbnN0IGlzeCA9IHNjYWxlLng7CiAgICAgIGNvbnN0IGlzeSA9IHNjYWxlLnk7CiAgICAgIGNvbnN0IGlzeiA9IHNjYWxlLno7CiAgICAgIGNvbnN0IGwgPSB1bnNjYWxlZEFBQkIubG93ZXJCb3VuZDsKICAgICAgY29uc3QgdSA9IHVuc2NhbGVkQUFCQi51cHBlckJvdW5kOwogICAgICBsLnggLz0gaXN4OwogICAgICBsLnkgLz0gaXN5OwogICAgICBsLnogLz0gaXN6OwogICAgICB1LnggLz0gaXN4OwogICAgICB1LnkgLz0gaXN5OwogICAgICB1LnogLz0gaXN6OwogICAgICByZXR1cm4gdGhpcy50cmVlLmFhYmJRdWVyeSh1bnNjYWxlZEFBQkIsIHJlc3VsdCk7CiAgICB9CiAgICAvKioKICAgICAqIHNldFNjYWxlCiAgICAgKi8KCgogICAgc2V0U2NhbGUoc2NhbGUpIHsKICAgICAgY29uc3Qgd2FzVW5pZm9ybSA9IHRoaXMuc2NhbGUueCA9PT0gdGhpcy5zY2FsZS55ICYmIHRoaXMuc2NhbGUueSA9PT0gdGhpcy5zY2FsZS56OwogICAgICBjb25zdCBpc1VuaWZvcm0gPSBzY2FsZS54ID09PSBzY2FsZS55ICYmIHNjYWxlLnkgPT09IHNjYWxlLno7CgogICAgICBpZiAoISh3YXNVbmlmb3JtICYmIGlzVW5pZm9ybSkpIHsKICAgICAgICAvLyBOb24tdW5pZm9ybSBzY2FsaW5nLiBOZWVkIHRvIHVwZGF0ZSBub3JtYWxzLgogICAgICAgIHRoaXMudXBkYXRlTm9ybWFscygpOwogICAgICB9CgogICAgICB0aGlzLnNjYWxlLmNvcHkoc2NhbGUpOwogICAgICB0aGlzLnVwZGF0ZUFBQkIoKTsKICAgICAgdGhpcy51cGRhdGVCb3VuZGluZ1NwaGVyZVJhZGl1cygpOwogICAgfQogICAgLyoqCiAgICAgKiBDb21wdXRlIHRoZSBub3JtYWxzIG9mIHRoZSBmYWNlcy4gV2lsbCBzYXZlIGluIHRoZSBgLm5vcm1hbHNgIGFycmF5LgogICAgICovCgoKICAgIHVwZGF0ZU5vcm1hbHMoKSB7CiAgICAgIGNvbnN0IG4gPSBjb21wdXRlTm9ybWFsc19uOyAvLyBHZW5lcmF0ZSBub3JtYWxzCgogICAgICBjb25zdCBub3JtYWxzID0gdGhpcy5ub3JtYWxzOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0aGlzLmluZGljZXMubGVuZ3RoIC8gMzsgaSsrKSB7CiAgICAgICAgY29uc3QgaTMgPSBpICogMzsKICAgICAgICBjb25zdCBhID0gdGhpcy5pbmRpY2VzW2kzXTsKICAgICAgICBjb25zdCBiID0gdGhpcy5pbmRpY2VzW2kzICsgMV07CiAgICAgICAgY29uc3QgYyA9IHRoaXMuaW5kaWNlc1tpMyArIDJdOwogICAgICAgIHRoaXMuZ2V0VmVydGV4KGEsIHZhKTsKICAgICAgICB0aGlzLmdldFZlcnRleChiLCB2Yik7CiAgICAgICAgdGhpcy5nZXRWZXJ0ZXgoYywgdmMpOwogICAgICAgIFRyaW1lc2guY29tcHV0ZU5vcm1hbCh2YiwgdmEsIHZjLCBuKTsKICAgICAgICBub3JtYWxzW2kzXSA9IG4ueDsKICAgICAgICBub3JtYWxzW2kzICsgMV0gPSBuLnk7CiAgICAgICAgbm9ybWFsc1tpMyArIDJdID0gbi56OwogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIFVwZGF0ZSB0aGUgYC5lZGdlc2AgcHJvcGVydHkKICAgICAqLwoKCiAgICB1cGRhdGVFZGdlcygpIHsKICAgICAgY29uc3QgZWRnZXMgPSB7fTsKCiAgICAgIGNvbnN0IGFkZCA9IChhLCBiKSA9PiB7CiAgICAgICAgY29uc3Qga2V5ID0gYSA8IGIgPyBgJHthfV8ke2J9YCA6IGAke2J9XyR7YX1gOwogICAgICAgIGVkZ2VzW2tleV0gPSB0cnVlOwogICAgICB9OwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0aGlzLmluZGljZXMubGVuZ3RoIC8gMzsgaSsrKSB7CiAgICAgICAgY29uc3QgaTMgPSBpICogMzsKICAgICAgICBjb25zdCBhID0gdGhpcy5pbmRpY2VzW2kzXTsKICAgICAgICBjb25zdCBiID0gdGhpcy5pbmRpY2VzW2kzICsgMV07CiAgICAgICAgY29uc3QgYyA9IHRoaXMuaW5kaWNlc1tpMyArIDJdOwogICAgICAgIGFkZChhLCBiKTsKICAgICAgICBhZGQoYiwgYyk7CiAgICAgICAgYWRkKGMsIGEpOwogICAgICB9CgogICAgICBjb25zdCBrZXlzID0gT2JqZWN0LmtleXMoZWRnZXMpOwogICAgICB0aGlzLmVkZ2VzID0gbmV3IEludDE2QXJyYXkoa2V5cy5sZW5ndGggKiAyKTsKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwga2V5cy5sZW5ndGg7IGkrKykgewogICAgICAgIGNvbnN0IGluZGljZXMgPSBrZXlzW2ldLnNwbGl0KCdfJyk7CiAgICAgICAgdGhpcy5lZGdlc1syICogaV0gPSBwYXJzZUludChpbmRpY2VzWzBdLCAxMCk7CiAgICAgICAgdGhpcy5lZGdlc1syICogaSArIDFdID0gcGFyc2VJbnQoaW5kaWNlc1sxXSwgMTApOwogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIEdldCBhbiBlZGdlIHZlcnRleAogICAgICogQHBhcmFtIGZpcnN0T3JTZWNvbmQgMCBvciAxLCBkZXBlbmRpbmcgb24gd2hpY2ggb25lIG9mIHRoZSB2ZXJ0aWNlcyB5b3UgbmVlZC4KICAgICAqIEBwYXJhbSB2ZXJ0ZXhTdG9yZSBXaGVyZSB0byBzdG9yZSB0aGUgcmVzdWx0CiAgICAgKi8KCgogICAgZ2V0RWRnZVZlcnRleChlZGdlSW5kZXgsIGZpcnN0T3JTZWNvbmQsIHZlcnRleFN0b3JlKSB7CiAgICAgIGNvbnN0IHZlcnRleEluZGV4ID0gdGhpcy5lZGdlc1tlZGdlSW5kZXggKiAyICsgKGZpcnN0T3JTZWNvbmQgPyAxIDogMCldOwogICAgICB0aGlzLmdldFZlcnRleCh2ZXJ0ZXhJbmRleCwgdmVydGV4U3RvcmUpOwogICAgfQogICAgLyoqCiAgICAgKiBHZXQgYSB2ZWN0b3IgYWxvbmcgYW4gZWRnZS4KICAgICAqLwoKCiAgICBnZXRFZGdlVmVjdG9yKGVkZ2VJbmRleCwgdmVjdG9yU3RvcmUpIHsKICAgICAgY29uc3QgdmEgPSBnZXRFZGdlVmVjdG9yX3ZhOwogICAgICBjb25zdCB2YiA9IGdldEVkZ2VWZWN0b3JfdmI7CiAgICAgIHRoaXMuZ2V0RWRnZVZlcnRleChlZGdlSW5kZXgsIDAsIHZhKTsKICAgICAgdGhpcy5nZXRFZGdlVmVydGV4KGVkZ2VJbmRleCwgMSwgdmIpOwogICAgICB2Yi52c3ViKHZhLCB2ZWN0b3JTdG9yZSk7CiAgICB9CiAgICAvKioKICAgICAqIEdldCBmYWNlIG5vcm1hbCBnaXZlbiAzIHZlcnRpY2VzCiAgICAgKi8KCgogICAgc3RhdGljIGNvbXB1dGVOb3JtYWwodmEsIHZiLCB2YywgdGFyZ2V0KSB7CiAgICAgIHZiLnZzdWIodmEsIGFiKTsKICAgICAgdmMudnN1Yih2YiwgY2IpOwogICAgICBjYi5jcm9zcyhhYiwgdGFyZ2V0KTsKCiAgICAgIGlmICghdGFyZ2V0LmlzWmVybygpKSB7CiAgICAgICAgdGFyZ2V0Lm5vcm1hbGl6ZSgpOwogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIEdldCB2ZXJ0ZXggaS4KICAgICAqIEByZXR1cm4gVGhlICJvdXQiIHZlY3RvciBvYmplY3QKICAgICAqLwoKCiAgICBnZXRWZXJ0ZXgoaSwgb3V0KSB7CiAgICAgIGNvbnN0IHNjYWxlID0gdGhpcy5zY2FsZTsKCiAgICAgIHRoaXMuX2dldFVuc2NhbGVkVmVydGV4KGksIG91dCk7CgogICAgICBvdXQueCAqPSBzY2FsZS54OwogICAgICBvdXQueSAqPSBzY2FsZS55OwogICAgICBvdXQueiAqPSBzY2FsZS56OwogICAgICByZXR1cm4gb3V0OwogICAgfQogICAgLyoqCiAgICAgKiBHZXQgcmF3IHZlcnRleCBpCiAgICAgKiBAcmV0dXJuIFRoZSAib3V0IiB2ZWN0b3Igb2JqZWN0CiAgICAgKi8KCgogICAgX2dldFVuc2NhbGVkVmVydGV4KGksIG91dCkgewogICAgICBjb25zdCBpMyA9IGkgKiAzOwogICAgICBjb25zdCB2ZXJ0aWNlcyA9IHRoaXMudmVydGljZXM7CiAgICAgIHJldHVybiBvdXQuc2V0KHZlcnRpY2VzW2kzXSwgdmVydGljZXNbaTMgKyAxXSwgdmVydGljZXNbaTMgKyAyXSk7CiAgICB9CiAgICAvKioKICAgICAqIEdldCBhIHZlcnRleCBmcm9tIHRoZSB0cmltZXNoLHRyYW5zZm9ybWVkIGJ5IHRoZSBnaXZlbiBwb3NpdGlvbiBhbmQgcXVhdGVybmlvbi4KICAgICAqIEByZXR1cm4gVGhlICJvdXQiIHZlY3RvciBvYmplY3QKICAgICAqLwoKCiAgICBnZXRXb3JsZFZlcnRleChpLCBwb3MsIHF1YXQsIG91dCkgewogICAgICB0aGlzLmdldFZlcnRleChpLCBvdXQpOwogICAgICBUcmFuc2Zvcm0ucG9pbnRUb1dvcmxkRnJhbWUocG9zLCBxdWF0LCBvdXQsIG91dCk7CiAgICAgIHJldHVybiBvdXQ7CiAgICB9CiAgICAvKioKICAgICAqIEdldCB0aGUgdGhyZWUgdmVydGljZXMgZm9yIHRyaWFuZ2xlIGkuCiAgICAgKi8KCgogICAgZ2V0VHJpYW5nbGVWZXJ0aWNlcyhpLCBhLCBiLCBjKSB7CiAgICAgIGNvbnN0IGkzID0gaSAqIDM7CiAgICAgIHRoaXMuZ2V0VmVydGV4KHRoaXMuaW5kaWNlc1tpM10sIGEpOwogICAgICB0aGlzLmdldFZlcnRleCh0aGlzLmluZGljZXNbaTMgKyAxXSwgYik7CiAgICAgIHRoaXMuZ2V0VmVydGV4KHRoaXMuaW5kaWNlc1tpMyArIDJdLCBjKTsKICAgIH0KICAgIC8qKgogICAgICogQ29tcHV0ZSB0aGUgbm9ybWFsIG9mIHRyaWFuZ2xlIGkuCiAgICAgKiBAcmV0dXJuIFRoZSAidGFyZ2V0IiB2ZWN0b3Igb2JqZWN0CiAgICAgKi8KCgogICAgZ2V0Tm9ybWFsKGksIHRhcmdldCkgewogICAgICBjb25zdCBpMyA9IGkgKiAzOwogICAgICByZXR1cm4gdGFyZ2V0LnNldCh0aGlzLm5vcm1hbHNbaTNdLCB0aGlzLm5vcm1hbHNbaTMgKyAxXSwgdGhpcy5ub3JtYWxzW2kzICsgMl0pOwogICAgfQogICAgLyoqCiAgICAgKiBAcmV0dXJuIFRoZSAidGFyZ2V0IiB2ZWN0b3Igb2JqZWN0CiAgICAgKi8KCgogICAgY2FsY3VsYXRlTG9jYWxJbmVydGlhKG1hc3MsIHRhcmdldCkgewogICAgICAvLyBBcHByb3hpbWF0ZSB3aXRoIGJveCBpbmVydGlhCiAgICAgIC8vIEV4YWN0IGluZXJ0aWEgY2FsY3VsYXRpb24gaXMgb3ZlcmtpbGwsIGJ1dCBzZWUgaHR0cDovL2dlb21ldHJpY3Rvb2xzLmNvbS9Eb2N1bWVudGF0aW9uL1BvbHloZWRyYWxNYXNzUHJvcGVydGllcy5wZGYgZm9yIHRoZSBjb3JyZWN0IHdheSB0byBkbyBpdAogICAgICB0aGlzLmNvbXB1dGVMb2NhbEFBQkIoY2xpX2FhYmIpOwogICAgICBjb25zdCB4ID0gY2xpX2FhYmIudXBwZXJCb3VuZC54IC0gY2xpX2FhYmIubG93ZXJCb3VuZC54OwogICAgICBjb25zdCB5ID0gY2xpX2FhYmIudXBwZXJCb3VuZC55IC0gY2xpX2FhYmIubG93ZXJCb3VuZC55OwogICAgICBjb25zdCB6ID0gY2xpX2FhYmIudXBwZXJCb3VuZC56IC0gY2xpX2FhYmIubG93ZXJCb3VuZC56OwogICAgICByZXR1cm4gdGFyZ2V0LnNldCgxLjAgLyAxMi4wICogbWFzcyAqICgyICogeSAqIDIgKiB5ICsgMiAqIHogKiAyICogeiksIDEuMCAvIDEyLjAgKiBtYXNzICogKDIgKiB4ICogMiAqIHggKyAyICogeiAqIDIgKiB6KSwgMS4wIC8gMTIuMCAqIG1hc3MgKiAoMiAqIHkgKiAyICogeSArIDIgKiB4ICogMiAqIHgpKTsKICAgIH0KICAgIC8qKgogICAgICogQ29tcHV0ZSB0aGUgbG9jYWwgQUFCQiBmb3IgdGhlIHRyaW1lc2gKICAgICAqLwoKCiAgICBjb21wdXRlTG9jYWxBQUJCKGFhYmIpIHsKICAgICAgY29uc3QgbCA9IGFhYmIubG93ZXJCb3VuZDsKICAgICAgY29uc3QgdSA9IGFhYmIudXBwZXJCb3VuZDsKICAgICAgY29uc3QgbiA9IHRoaXMudmVydGljZXMubGVuZ3RoOwogICAgICB0aGlzLnZlcnRpY2VzOwogICAgICBjb25zdCB2ID0gY29tcHV0ZUxvY2FsQUFCQl93b3JsZFZlcnQ7CiAgICAgIHRoaXMuZ2V0VmVydGV4KDAsIHYpOwogICAgICBsLmNvcHkodik7CiAgICAgIHUuY29weSh2KTsKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpICE9PSBuOyBpKyspIHsKICAgICAgICB0aGlzLmdldFZlcnRleChpLCB2KTsKCiAgICAgICAgaWYgKHYueCA8IGwueCkgewogICAgICAgICAgbC54ID0gdi54OwogICAgICAgIH0gZWxzZSBpZiAodi54ID4gdS54KSB7CiAgICAgICAgICB1LnggPSB2Lng7CiAgICAgICAgfQoKICAgICAgICBpZiAodi55IDwgbC55KSB7CiAgICAgICAgICBsLnkgPSB2Lnk7CiAgICAgICAgfSBlbHNlIGlmICh2LnkgPiB1LnkpIHsKICAgICAgICAgIHUueSA9IHYueTsKICAgICAgICB9CgogICAgICAgIGlmICh2LnogPCBsLnopIHsKICAgICAgICAgIGwueiA9IHYuejsKICAgICAgICB9IGVsc2UgaWYgKHYueiA+IHUueikgewogICAgICAgICAgdS56ID0gdi56OwogICAgICAgIH0KICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBVcGRhdGUgdGhlIGAuYWFiYmAgcHJvcGVydHkKICAgICAqLwoKCiAgICB1cGRhdGVBQUJCKCkgewogICAgICB0aGlzLmNvbXB1dGVMb2NhbEFBQkIodGhpcy5hYWJiKTsKICAgIH0KICAgIC8qKgogICAgICogV2lsbCB1cGRhdGUgdGhlIGAuYm91bmRpbmdTcGhlcmVSYWRpdXNgIHByb3BlcnR5CiAgICAgKi8KCgogICAgdXBkYXRlQm91bmRpbmdTcGhlcmVSYWRpdXMoKSB7CiAgICAgIC8vIEFzc3VtZSBwb2ludHMgYXJlIGRpc3RyaWJ1dGVkIHdpdGggbG9jYWwgKDAsMCwwKSBhcyBjZW50ZXIKICAgICAgbGV0IG1heDIgPSAwOwogICAgICBjb25zdCB2ZXJ0aWNlcyA9IHRoaXMudmVydGljZXM7CiAgICAgIGNvbnN0IHYgPSBuZXcgVmVjMygpOwoKICAgICAgZm9yIChsZXQgaSA9IDAsIE4gPSB2ZXJ0aWNlcy5sZW5ndGggLyAzOyBpICE9PSBOOyBpKyspIHsKICAgICAgICB0aGlzLmdldFZlcnRleChpLCB2KTsKICAgICAgICBjb25zdCBub3JtMiA9IHYubGVuZ3RoU3F1YXJlZCgpOwoKICAgICAgICBpZiAobm9ybTIgPiBtYXgyKSB7CiAgICAgICAgICBtYXgyID0gbm9ybTI7CiAgICAgICAgfQogICAgICB9CgogICAgICB0aGlzLmJvdW5kaW5nU3BoZXJlUmFkaXVzID0gTWF0aC5zcXJ0KG1heDIpOwogICAgfQogICAgLyoqCiAgICAgKiBjYWxjdWxhdGVXb3JsZEFBQkIKICAgICAqLwoKCiAgICBjYWxjdWxhdGVXb3JsZEFBQkIocG9zLCBxdWF0LCBtaW4sIG1heCkgewogICAgICAvKgogICAgICAgICAgY29uc3QgbiA9IHRoaXMudmVydGljZXMubGVuZ3RoIC8gMywKICAgICAgICAgICAgICB2ZXJ0cyA9IHRoaXMudmVydGljZXM7CiAgICAgICAgICBjb25zdCBtaW54LG1pbnksbWlueixtYXh4LG1heHksbWF4ejsKICAgICAgICAgICBjb25zdCB2ID0gdGVtcFdvcmxkVmVydGV4OwogICAgICAgICAgZm9yKGxldCBpPTA7IGk8bjsgaSsrKXsKICAgICAgICAgICAgICB0aGlzLmdldFZlcnRleChpLCB2KTsKICAgICAgICAgICAgICBxdWF0LnZtdWx0KHYsIHYpOwogICAgICAgICAgICAgIHBvcy52YWRkKHYsIHYpOwogICAgICAgICAgICAgIGlmICh2LnggPCBtaW54IHx8IG1pbng9PT11bmRlZmluZWQpewogICAgICAgICAgICAgICAgICBtaW54ID0gdi54OwogICAgICAgICAgICAgIH0gZWxzZSBpZih2LnggPiBtYXh4IHx8IG1heHg9PT11bmRlZmluZWQpewogICAgICAgICAgICAgICAgICBtYXh4ID0gdi54OwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgaWYgKHYueSA8IG1pbnkgfHwgbWlueT09PXVuZGVmaW5lZCl7CiAgICAgICAgICAgICAgICAgIG1pbnkgPSB2Lnk7CiAgICAgICAgICAgICAgfSBlbHNlIGlmKHYueSA+IG1heHkgfHwgbWF4eT09PXVuZGVmaW5lZCl7CiAgICAgICAgICAgICAgICAgIG1heHkgPSB2Lnk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICBpZiAodi56IDwgbWlueiB8fCBtaW56PT09dW5kZWZpbmVkKXsKICAgICAgICAgICAgICAgICAgbWlueiA9IHYuejsKICAgICAgICAgICAgICB9IGVsc2UgaWYodi56ID4gbWF4eiB8fCBtYXh6PT09dW5kZWZpbmVkKXsKICAgICAgICAgICAgICAgICAgbWF4eiA9IHYuejsKICAgICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgICBtaW4uc2V0KG1pbngsbWlueSxtaW56KTsKICAgICAgICAgIG1heC5zZXQobWF4eCxtYXh5LG1heHopOwogICAgICAgICAgKi8KICAgICAgLy8gRmFzdGVyIGFwcHJveGltYXRpb24gdXNpbmcgbG9jYWwgQUFCQgogICAgICBjb25zdCBmcmFtZSA9IGNhbGN1bGF0ZVdvcmxkQUFCQl9mcmFtZTsKICAgICAgY29uc3QgcmVzdWx0ID0gY2FsY3VsYXRlV29ybGRBQUJCX2FhYmI7CiAgICAgIGZyYW1lLnBvc2l0aW9uID0gcG9zOwogICAgICBmcmFtZS5xdWF0ZXJuaW9uID0gcXVhdDsKICAgICAgdGhpcy5hYWJiLnRvV29ybGRGcmFtZShmcmFtZSwgcmVzdWx0KTsKICAgICAgbWluLmNvcHkocmVzdWx0Lmxvd2VyQm91bmQpOwogICAgICBtYXguY29weShyZXN1bHQudXBwZXJCb3VuZCk7CiAgICB9CiAgICAvKioKICAgICAqIEdldCBhcHByb3hpbWF0ZSB2b2x1bWUKICAgICAqLwoKCiAgICB2b2x1bWUoKSB7CiAgICAgIHJldHVybiA0LjAgKiBNYXRoLlBJICogdGhpcy5ib3VuZGluZ1NwaGVyZVJhZGl1cyAvIDMuMDsKICAgIH0KICAgIC8qKgogICAgICogQ3JlYXRlIGEgVHJpbWVzaCBpbnN0YW5jZSwgc2hhcGVkIGFzIGEgdG9ydXMuCiAgICAgKi8KCgogICAgc3RhdGljIGNyZWF0ZVRvcnVzKHJhZGl1cywgdHViZSwgcmFkaWFsU2VnbWVudHMsIHR1YnVsYXJTZWdtZW50cywgYXJjKSB7CiAgICAgIGlmIChyYWRpdXMgPT09IHZvaWQgMCkgewogICAgICAgIHJhZGl1cyA9IDE7CiAgICAgIH0KCiAgICAgIGlmICh0dWJlID09PSB2b2lkIDApIHsKICAgICAgICB0dWJlID0gMC41OwogICAgICB9CgogICAgICBpZiAocmFkaWFsU2VnbWVudHMgPT09IHZvaWQgMCkgewogICAgICAgIHJhZGlhbFNlZ21lbnRzID0gODsKICAgICAgfQoKICAgICAgaWYgKHR1YnVsYXJTZWdtZW50cyA9PT0gdm9pZCAwKSB7CiAgICAgICAgdHVidWxhclNlZ21lbnRzID0gNjsKICAgICAgfQoKICAgICAgaWYgKGFyYyA9PT0gdm9pZCAwKSB7CiAgICAgICAgYXJjID0gTWF0aC5QSSAqIDI7CiAgICAgIH0KCiAgICAgIGNvbnN0IHZlcnRpY2VzID0gW107CiAgICAgIGNvbnN0IGluZGljZXMgPSBbXTsKCiAgICAgIGZvciAobGV0IGogPSAwOyBqIDw9IHJhZGlhbFNlZ21lbnRzOyBqKyspIHsKICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8PSB0dWJ1bGFyU2VnbWVudHM7IGkrKykgewogICAgICAgICAgY29uc3QgdSA9IGkgLyB0dWJ1bGFyU2VnbWVudHMgKiBhcmM7CiAgICAgICAgICBjb25zdCB2ID0gaiAvIHJhZGlhbFNlZ21lbnRzICogTWF0aC5QSSAqIDI7CiAgICAgICAgICBjb25zdCB4ID0gKHJhZGl1cyArIHR1YmUgKiBNYXRoLmNvcyh2KSkgKiBNYXRoLmNvcyh1KTsKICAgICAgICAgIGNvbnN0IHkgPSAocmFkaXVzICsgdHViZSAqIE1hdGguY29zKHYpKSAqIE1hdGguc2luKHUpOwogICAgICAgICAgY29uc3QgeiA9IHR1YmUgKiBNYXRoLnNpbih2KTsKICAgICAgICAgIHZlcnRpY2VzLnB1c2goeCwgeSwgeik7CiAgICAgICAgfQogICAgICB9CgogICAgICBmb3IgKGxldCBqID0gMTsgaiA8PSByYWRpYWxTZWdtZW50czsgaisrKSB7CiAgICAgICAgZm9yIChsZXQgaSA9IDE7IGkgPD0gdHVidWxhclNlZ21lbnRzOyBpKyspIHsKICAgICAgICAgIGNvbnN0IGEgPSAodHVidWxhclNlZ21lbnRzICsgMSkgKiBqICsgaSAtIDE7CiAgICAgICAgICBjb25zdCBiID0gKHR1YnVsYXJTZWdtZW50cyArIDEpICogKGogLSAxKSArIGkgLSAxOwogICAgICAgICAgY29uc3QgYyA9ICh0dWJ1bGFyU2VnbWVudHMgKyAxKSAqIChqIC0gMSkgKyBpOwogICAgICAgICAgY29uc3QgZCA9ICh0dWJ1bGFyU2VnbWVudHMgKyAxKSAqIGogKyBpOwogICAgICAgICAgaW5kaWNlcy5wdXNoKGEsIGIsIGQpOwogICAgICAgICAgaW5kaWNlcy5wdXNoKGIsIGMsIGQpOwogICAgICAgIH0KICAgICAgfQoKICAgICAgcmV0dXJuIG5ldyBUcmltZXNoKHZlcnRpY2VzLCBpbmRpY2VzKTsKICAgIH0KCiAgfQogIGNvbnN0IGNvbXB1dGVOb3JtYWxzX24gPSBuZXcgVmVjMygpOwogIGNvbnN0IHVuc2NhbGVkQUFCQiA9IG5ldyBBQUJCKCk7CiAgY29uc3QgZ2V0RWRnZVZlY3Rvcl92YSA9IG5ldyBWZWMzKCk7CiAgY29uc3QgZ2V0RWRnZVZlY3Rvcl92YiA9IG5ldyBWZWMzKCk7CiAgY29uc3QgY2IgPSBuZXcgVmVjMygpOwogIGNvbnN0IGFiID0gbmV3IFZlYzMoKTsKICBjb25zdCB2YSA9IG5ldyBWZWMzKCk7CiAgY29uc3QgdmIgPSBuZXcgVmVjMygpOwogIGNvbnN0IHZjID0gbmV3IFZlYzMoKTsKICBjb25zdCBjbGlfYWFiYiA9IG5ldyBBQUJCKCk7CiAgY29uc3QgY29tcHV0ZUxvY2FsQUFCQl93b3JsZFZlcnQgPSBuZXcgVmVjMygpOwogIGNvbnN0IGNhbGN1bGF0ZVdvcmxkQUFCQl9mcmFtZSA9IG5ldyBUcmFuc2Zvcm0oKTsKICBjb25zdCBjYWxjdWxhdGVXb3JsZEFBQkJfYWFiYiA9IG5ldyBBQUJCKCk7CgogIC8qKgogICAqIENvbnN0cmFpbnQgZXF1YXRpb24gc29sdmVyIGJhc2UgY2xhc3MuCiAgICovCiAgY2xhc3MgU29sdmVyIHsKICAgIC8qKgogICAgICogQWxsIGVxdWF0aW9ucyB0byBiZSBzb2x2ZWQKICAgICAqLwoKICAgIC8qKgogICAgICogQHRvZG8gcmVtb3ZlIHVzZWxlc3MgY29uc3RydWN0b3IKICAgICAqLwogICAgY29uc3RydWN0b3IoKSB7CiAgICAgIHRoaXMuZXF1YXRpb25zID0gW107CiAgICB9CiAgICAvKioKICAgICAqIFNob3VsZCBiZSBpbXBsZW1lbnRlZCBpbiBzdWJjbGFzc2VzIQogICAgICogQHRvZG8gdXNlIGFic3RyYWN0CiAgICAgKiBAcmV0dXJuIG51bWJlciBvZiBpdGVyYXRpb25zIHBlcmZvcm1lZAogICAgICovCgoKICAgIHNvbHZlKGR0LCB3b3JsZCkgewogICAgICByZXR1cm4gKC8vIFNob3VsZCByZXR1cm4gdGhlIG51bWJlciBvZiBpdGVyYXRpb25zIGRvbmUhCiAgICAgICAgMAogICAgICApOwogICAgfQogICAgLyoqCiAgICAgKiBBZGQgYW4gZXF1YXRpb24KICAgICAqLwoKCiAgICBhZGRFcXVhdGlvbihlcSkgewogICAgICBpZiAoZXEuZW5hYmxlZCAmJiAhZXEuYmkuaXNUcmlnZ2VyICYmICFlcS5iai5pc1RyaWdnZXIpIHsKICAgICAgICB0aGlzLmVxdWF0aW9ucy5wdXNoKGVxKTsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBSZW1vdmUgYW4gZXF1YXRpb24KICAgICAqLwoKCiAgICByZW1vdmVFcXVhdGlvbihlcSkgewogICAgICBjb25zdCBlcXMgPSB0aGlzLmVxdWF0aW9uczsKICAgICAgY29uc3QgaSA9IGVxcy5pbmRleE9mKGVxKTsKCiAgICAgIGlmIChpICE9PSAtMSkgewogICAgICAgIGVxcy5zcGxpY2UoaSwgMSk7CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogQWRkIGFsbCBlcXVhdGlvbnMKICAgICAqLwoKCiAgICByZW1vdmVBbGxFcXVhdGlvbnMoKSB7CiAgICAgIHRoaXMuZXF1YXRpb25zLmxlbmd0aCA9IDA7CiAgICB9CgogIH0KCiAgLyoqCiAgICogQ29uc3RyYWludCBlcXVhdGlvbiBHYXVzcy1TZWlkZWwgc29sdmVyLgogICAqIEB0b2RvIFRoZSBzcG9vayBwYXJhbWV0ZXJzIHNob3VsZCBiZSBzcGVjaWZpZWQgZm9yIGVhY2ggY29uc3RyYWludCwgbm90IGdsb2JhbGx5LgogICAqIEBzZWUgaHR0cHM6Ly93d3c4LmNzLnVtdS5zZS9rdXJzZXIvNURWMDU4L1ZUMDkvbGVjdHVyZXMvc3Bvb2tub3Rlcy5wZGYKICAgKi8KICBjbGFzcyBHU1NvbHZlciBleHRlbmRzIFNvbHZlciB7CiAgICAvKioKICAgICAqIFRoZSBudW1iZXIgb2Ygc29sdmVyIGl0ZXJhdGlvbnMgZGV0ZXJtaW5lcyBxdWFsaXR5IG9mIHRoZSBjb25zdHJhaW50cyBpbiB0aGUgd29ybGQuCiAgICAgKiBUaGUgbW9yZSBpdGVyYXRpb25zLCB0aGUgbW9yZSBjb3JyZWN0IHNpbXVsYXRpb24uIE1vcmUgaXRlcmF0aW9ucyBuZWVkIG1vcmUgY29tcHV0YXRpb25zIHRob3VnaC4gSWYgeW91IGhhdmUgYSBsYXJnZSBncmF2aXR5IGZvcmNlIGluIHlvdXIgd29ybGQsIHlvdSB3aWxsIG5lZWQgbW9yZSBpdGVyYXRpb25zLgogICAgICovCgogICAgLyoqCiAgICAgKiBXaGVuIHRvbGVyYW5jZSBpcyByZWFjaGVkLCB0aGUgc3lzdGVtIGlzIGFzc3VtZWQgdG8gYmUgY29udmVyZ2VkLgogICAgICovCgogICAgLyoqCiAgICAgKiBAdG9kbyByZW1vdmUgdXNlbGVzcyBjb25zdHJ1Y3RvcgogICAgICovCiAgICBjb25zdHJ1Y3RvcigpIHsKICAgICAgc3VwZXIoKTsKICAgICAgdGhpcy5pdGVyYXRpb25zID0gMTA7CiAgICAgIHRoaXMudG9sZXJhbmNlID0gMWUtNzsKICAgIH0KICAgIC8qKgogICAgICogU29sdmUKICAgICAqIEByZXR1cm4gbnVtYmVyIG9mIGl0ZXJhdGlvbnMgcGVyZm9ybWVkCiAgICAgKi8KCgogICAgc29sdmUoZHQsIHdvcmxkKSB7CiAgICAgIGxldCBpdGVyID0gMDsKICAgICAgY29uc3QgbWF4SXRlciA9IHRoaXMuaXRlcmF0aW9uczsKICAgICAgY29uc3QgdG9sU3F1YXJlZCA9IHRoaXMudG9sZXJhbmNlICogdGhpcy50b2xlcmFuY2U7CiAgICAgIGNvbnN0IGVxdWF0aW9ucyA9IHRoaXMuZXF1YXRpb25zOwogICAgICBjb25zdCBOZXEgPSBlcXVhdGlvbnMubGVuZ3RoOwogICAgICBjb25zdCBib2RpZXMgPSB3b3JsZC5ib2RpZXM7CiAgICAgIGNvbnN0IE5ib2RpZXMgPSBib2RpZXMubGVuZ3RoOwogICAgICBjb25zdCBoID0gZHQ7CiAgICAgIGxldCBCOwogICAgICBsZXQgaW52QzsKICAgICAgbGV0IGRlbHRhbGFtYmRhOwogICAgICBsZXQgZGVsdGFsYW1iZGFUb3Q7CiAgICAgIGxldCBHV2xhbWJkYTsKICAgICAgbGV0IGxhbWJkYWo7IC8vIFVwZGF0ZSBzb2x2ZSBtYXNzCgogICAgICBpZiAoTmVxICE9PSAwKSB7CiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgIT09IE5ib2RpZXM7IGkrKykgewogICAgICAgICAgYm9kaWVzW2ldLnVwZGF0ZVNvbHZlTWFzc1Byb3BlcnRpZXMoKTsKICAgICAgICB9CiAgICAgIH0gLy8gVGhpbmdzIHRoYXQgZG8gbm90IGNoYW5nZSBkdXJpbmcgaXRlcmF0aW9uIGNhbiBiZSBjb21wdXRlZCBvbmNlCgoKICAgICAgY29uc3QgaW52Q3MgPSBHU1NvbHZlcl9zb2x2ZV9pbnZDczsKICAgICAgY29uc3QgQnMgPSBHU1NvbHZlcl9zb2x2ZV9CczsKICAgICAgY29uc3QgbGFtYmRhID0gR1NTb2x2ZXJfc29sdmVfbGFtYmRhOwogICAgICBpbnZDcy5sZW5ndGggPSBOZXE7CiAgICAgIEJzLmxlbmd0aCA9IE5lcTsKICAgICAgbGFtYmRhLmxlbmd0aCA9IE5lcTsKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpICE9PSBOZXE7IGkrKykgewogICAgICAgIGNvbnN0IGMgPSBlcXVhdGlvbnNbaV07CiAgICAgICAgbGFtYmRhW2ldID0gMC4wOwogICAgICAgIEJzW2ldID0gYy5jb21wdXRlQihoKTsKICAgICAgICBpbnZDc1tpXSA9IDEuMCAvIGMuY29tcHV0ZUMoKTsKICAgICAgfQoKICAgICAgaWYgKE5lcSAhPT0gMCkgewogICAgICAgIC8vIFJlc2V0IHZsYW1iZGEKICAgICAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gTmJvZGllczsgaSsrKSB7CiAgICAgICAgICBjb25zdCBiID0gYm9kaWVzW2ldOwogICAgICAgICAgY29uc3QgdmxhbWJkYSA9IGIudmxhbWJkYTsKICAgICAgICAgIGNvbnN0IHdsYW1iZGEgPSBiLndsYW1iZGE7CiAgICAgICAgICB2bGFtYmRhLnNldCgwLCAwLCAwKTsKICAgICAgICAgIHdsYW1iZGEuc2V0KDAsIDAsIDApOwogICAgICAgIH0gLy8gSXRlcmF0ZSBvdmVyIGVxdWF0aW9ucwoKCiAgICAgICAgZm9yIChpdGVyID0gMDsgaXRlciAhPT0gbWF4SXRlcjsgaXRlcisrKSB7CiAgICAgICAgICAvLyBBY2N1bXVsYXRlIHRoZSB0b3RhbCBlcnJvciBmb3IgZWFjaCBpdGVyYXRpb24uCiAgICAgICAgICBkZWx0YWxhbWJkYVRvdCA9IDAuMDsKCiAgICAgICAgICBmb3IgKGxldCBqID0gMDsgaiAhPT0gTmVxOyBqKyspIHsKICAgICAgICAgICAgY29uc3QgYyA9IGVxdWF0aW9uc1tqXTsgLy8gQ29tcHV0ZSBpdGVyYXRpb24KCiAgICAgICAgICAgIEIgPSBCc1tqXTsKICAgICAgICAgICAgaW52QyA9IGludkNzW2pdOwogICAgICAgICAgICBsYW1iZGFqID0gbGFtYmRhW2pdOwogICAgICAgICAgICBHV2xhbWJkYSA9IGMuY29tcHV0ZUdXbGFtYmRhKCk7CiAgICAgICAgICAgIGRlbHRhbGFtYmRhID0gaW52QyAqIChCIC0gR1dsYW1iZGEgLSBjLmVwcyAqIGxhbWJkYWopOyAvLyBDbGFtcCBpZiB3ZSBhcmUgbm90IHdpdGhpbiB0aGUgbWluL21heCBpbnRlcnZhbAoKICAgICAgICAgICAgaWYgKGxhbWJkYWogKyBkZWx0YWxhbWJkYSA8IGMubWluRm9yY2UpIHsKICAgICAgICAgICAgICBkZWx0YWxhbWJkYSA9IGMubWluRm9yY2UgLSBsYW1iZGFqOwogICAgICAgICAgICB9IGVsc2UgaWYgKGxhbWJkYWogKyBkZWx0YWxhbWJkYSA+IGMubWF4Rm9yY2UpIHsKICAgICAgICAgICAgICBkZWx0YWxhbWJkYSA9IGMubWF4Rm9yY2UgLSBsYW1iZGFqOwogICAgICAgICAgICB9CgogICAgICAgICAgICBsYW1iZGFbal0gKz0gZGVsdGFsYW1iZGE7CiAgICAgICAgICAgIGRlbHRhbGFtYmRhVG90ICs9IGRlbHRhbGFtYmRhID4gMC4wID8gZGVsdGFsYW1iZGEgOiAtZGVsdGFsYW1iZGE7IC8vIGFicyhkZWx0YWxhbWJkYSkKCiAgICAgICAgICAgIGMuYWRkVG9XbGFtYmRhKGRlbHRhbGFtYmRhKTsKICAgICAgICAgIH0gLy8gSWYgdGhlIHRvdGFsIGVycm9yIGlzIHNtYWxsIGVub3VnaCAtIHN0b3AgaXRlcmF0ZQoKCiAgICAgICAgICBpZiAoZGVsdGFsYW1iZGFUb3QgKiBkZWx0YWxhbWJkYVRvdCA8IHRvbFNxdWFyZWQpIHsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICB9CiAgICAgICAgfSAvLyBBZGQgcmVzdWx0IHRvIHZlbG9jaXR5CgoKICAgICAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gTmJvZGllczsgaSsrKSB7CiAgICAgICAgICBjb25zdCBiID0gYm9kaWVzW2ldOwogICAgICAgICAgY29uc3QgdiA9IGIudmVsb2NpdHk7CiAgICAgICAgICBjb25zdCB3ID0gYi5hbmd1bGFyVmVsb2NpdHk7CiAgICAgICAgICBiLnZsYW1iZGEudm11bChiLmxpbmVhckZhY3RvciwgYi52bGFtYmRhKTsKICAgICAgICAgIHYudmFkZChiLnZsYW1iZGEsIHYpOwogICAgICAgICAgYi53bGFtYmRhLnZtdWwoYi5hbmd1bGFyRmFjdG9yLCBiLndsYW1iZGEpOwogICAgICAgICAgdy52YWRkKGIud2xhbWJkYSwgdyk7CiAgICAgICAgfSAvLyBTZXQgdGhlIGAubXVsdGlwbGllcmAgcHJvcGVydHkgb2YgZWFjaCBlcXVhdGlvbgoKCiAgICAgICAgbGV0IGwgPSBlcXVhdGlvbnMubGVuZ3RoOwogICAgICAgIGNvbnN0IGludkR0ID0gMSAvIGg7CgogICAgICAgIHdoaWxlIChsLS0pIHsKICAgICAgICAgIGVxdWF0aW9uc1tsXS5tdWx0aXBsaWVyID0gbGFtYmRhW2xdICogaW52RHQ7CiAgICAgICAgfQogICAgICB9CgogICAgICByZXR1cm4gaXRlcjsKICAgIH0KCiAgfSAvLyBKdXN0IHRlbXBvcmFyeSBudW1iZXIgaG9sZGVycyB0aGF0IHdlIHdhbnQgdG8gcmV1c2UgZWFjaCBpdGVyYXRpb24uCgogIGNvbnN0IEdTU29sdmVyX3NvbHZlX2xhbWJkYSA9IFtdOwogIGNvbnN0IEdTU29sdmVyX3NvbHZlX2ludkNzID0gW107CiAgY29uc3QgR1NTb2x2ZXJfc29sdmVfQnMgPSBbXTsKCiAgLyoqCiAgICogU3BsaXRzIHRoZSBlcXVhdGlvbnMgaW50byBpc2xhbmRzIGFuZCBzb2x2ZXMgdGhlbSBpbmRlcGVuZGVudGx5LiBDYW4gaW1wcm92ZSBwZXJmb3JtYW5jZS4KICAgKi8KICBjbGFzcyBTcGxpdFNvbHZlciBleHRlbmRzIFNvbHZlciB7CiAgICAvKioKICAgICAqIFRoZSBudW1iZXIgb2Ygc29sdmVyIGl0ZXJhdGlvbnMgZGV0ZXJtaW5lcyBxdWFsaXR5IG9mIHRoZSBjb25zdHJhaW50cyBpbiB0aGUgd29ybGQuIFRoZSBtb3JlIGl0ZXJhdGlvbnMsIHRoZSBtb3JlIGNvcnJlY3Qgc2ltdWxhdGlvbi4gTW9yZSBpdGVyYXRpb25zIG5lZWQgbW9yZSBjb21wdXRhdGlvbnMgdGhvdWdoLiBJZiB5b3UgaGF2ZSBhIGxhcmdlIGdyYXZpdHkgZm9yY2UgaW4geW91ciB3b3JsZCwgeW91IHdpbGwgbmVlZCBtb3JlIGl0ZXJhdGlvbnMuCiAgICAgKi8KCiAgICAvKioKICAgICAqIFdoZW4gdG9sZXJhbmNlIGlzIHJlYWNoZWQsIHRoZSBzeXN0ZW0gaXMgYXNzdW1lZCB0byBiZSBjb252ZXJnZWQuCiAgICAgKi8KCiAgICAvKiogc3Vic29sdmVyICovCiAgICBjb25zdHJ1Y3RvcihzdWJzb2x2ZXIpIHsKICAgICAgc3VwZXIoKTsKICAgICAgdGhpcy5pdGVyYXRpb25zID0gMTA7CiAgICAgIHRoaXMudG9sZXJhbmNlID0gMWUtNzsKICAgICAgdGhpcy5zdWJzb2x2ZXIgPSBzdWJzb2x2ZXI7CiAgICAgIHRoaXMubm9kZXMgPSBbXTsKICAgICAgdGhpcy5ub2RlUG9vbCA9IFtdOyAvLyBDcmVhdGUgbmVlZGVkIG5vZGVzLCByZXVzZSBpZiBwb3NzaWJsZQoKICAgICAgd2hpbGUgKHRoaXMubm9kZVBvb2wubGVuZ3RoIDwgMTI4KSB7CiAgICAgICAgdGhpcy5ub2RlUG9vbC5wdXNoKHRoaXMuY3JlYXRlTm9kZSgpKTsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBjcmVhdGVOb2RlCiAgICAgKi8KCgogICAgY3JlYXRlTm9kZSgpIHsKICAgICAgcmV0dXJuIHsKICAgICAgICBib2R5OiBudWxsLAogICAgICAgIGNoaWxkcmVuOiBbXSwKICAgICAgICBlcXM6IFtdLAogICAgICAgIHZpc2l0ZWQ6IGZhbHNlCiAgICAgIH07CiAgICB9CiAgICAvKioKICAgICAqIFNvbHZlIHRoZSBzdWJzeXN0ZW1zCiAgICAgKiBAcmV0dXJuIG51bWJlciBvZiBpdGVyYXRpb25zIHBlcmZvcm1lZAogICAgICovCgoKICAgIHNvbHZlKGR0LCB3b3JsZCkgewogICAgICBjb25zdCBub2RlcyA9IFNwbGl0U29sdmVyX3NvbHZlX25vZGVzOwogICAgICBjb25zdCBub2RlUG9vbCA9IHRoaXMubm9kZVBvb2w7CiAgICAgIGNvbnN0IGJvZGllcyA9IHdvcmxkLmJvZGllczsKICAgICAgY29uc3QgZXF1YXRpb25zID0gdGhpcy5lcXVhdGlvbnM7CiAgICAgIGNvbnN0IE5lcSA9IGVxdWF0aW9ucy5sZW5ndGg7CiAgICAgIGNvbnN0IE5ib2RpZXMgPSBib2RpZXMubGVuZ3RoOwogICAgICBjb25zdCBzdWJzb2x2ZXIgPSB0aGlzLnN1YnNvbHZlcjsgLy8gQ3JlYXRlIG5lZWRlZCBub2RlcywgcmV1c2UgaWYgcG9zc2libGUKCiAgICAgIHdoaWxlIChub2RlUG9vbC5sZW5ndGggPCBOYm9kaWVzKSB7CiAgICAgICAgbm9kZVBvb2wucHVzaCh0aGlzLmNyZWF0ZU5vZGUoKSk7CiAgICAgIH0KCiAgICAgIG5vZGVzLmxlbmd0aCA9IE5ib2RpZXM7CgogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IE5ib2RpZXM7IGkrKykgewogICAgICAgIG5vZGVzW2ldID0gbm9kZVBvb2xbaV07CiAgICAgIH0gLy8gUmVzZXQgbm9kZSB2YWx1ZXMKCgogICAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gTmJvZGllczsgaSsrKSB7CiAgICAgICAgY29uc3Qgbm9kZSA9IG5vZGVzW2ldOwogICAgICAgIG5vZGUuYm9keSA9IGJvZGllc1tpXTsKICAgICAgICBub2RlLmNoaWxkcmVuLmxlbmd0aCA9IDA7CiAgICAgICAgbm9kZS5lcXMubGVuZ3RoID0gMDsKICAgICAgICBub2RlLnZpc2l0ZWQgPSBmYWxzZTsKICAgICAgfQoKICAgICAgZm9yIChsZXQgayA9IDA7IGsgIT09IE5lcTsgaysrKSB7CiAgICAgICAgY29uc3QgZXEgPSBlcXVhdGlvbnNba107CiAgICAgICAgY29uc3QgaSA9IGJvZGllcy5pbmRleE9mKGVxLmJpKTsKICAgICAgICBjb25zdCBqID0gYm9kaWVzLmluZGV4T2YoZXEuYmopOwogICAgICAgIGNvbnN0IG5pID0gbm9kZXNbaV07CiAgICAgICAgY29uc3QgbmogPSBub2Rlc1tqXTsKICAgICAgICBuaS5jaGlsZHJlbi5wdXNoKG5qKTsKICAgICAgICBuaS5lcXMucHVzaChlcSk7CiAgICAgICAgbmouY2hpbGRyZW4ucHVzaChuaSk7CiAgICAgICAgbmouZXFzLnB1c2goZXEpOwogICAgICB9CgogICAgICBsZXQgY2hpbGQ7CiAgICAgIGxldCBuID0gMDsKICAgICAgbGV0IGVxcyA9IFNwbGl0U29sdmVyX3NvbHZlX2VxczsKICAgICAgc3Vic29sdmVyLnRvbGVyYW5jZSA9IHRoaXMudG9sZXJhbmNlOwogICAgICBzdWJzb2x2ZXIuaXRlcmF0aW9ucyA9IHRoaXMuaXRlcmF0aW9uczsKICAgICAgY29uc3QgZHVtbXlXb3JsZCA9IFNwbGl0U29sdmVyX3NvbHZlX2R1bW15V29ybGQ7CgogICAgICB3aGlsZSAoY2hpbGQgPSBnZXRVbnZpc2l0ZWROb2RlKG5vZGVzKSkgewogICAgICAgIGVxcy5sZW5ndGggPSAwOwogICAgICAgIGR1bW15V29ybGQuYm9kaWVzLmxlbmd0aCA9IDA7CiAgICAgICAgYmZzKGNoaWxkLCB2aXNpdEZ1bmMsIGR1bW15V29ybGQuYm9kaWVzLCBlcXMpOwogICAgICAgIGNvbnN0IE5lcXMgPSBlcXMubGVuZ3RoOwogICAgICAgIGVxcyA9IGVxcy5zb3J0KHNvcnRCeUlkKTsKCiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgIT09IE5lcXM7IGkrKykgewogICAgICAgICAgc3Vic29sdmVyLmFkZEVxdWF0aW9uKGVxc1tpXSk7CiAgICAgICAgfQoKICAgICAgICBzdWJzb2x2ZXIuc29sdmUoZHQsIGR1bW15V29ybGQpOwogICAgICAgIHN1YnNvbHZlci5yZW1vdmVBbGxFcXVhdGlvbnMoKTsKICAgICAgICBuKys7CiAgICAgIH0KCiAgICAgIHJldHVybiBuOwogICAgfQoKICB9IC8vIFJldHVybnMgdGhlIG51bWJlciBvZiBzdWJzeXN0ZW1zCgogIGNvbnN0IFNwbGl0U29sdmVyX3NvbHZlX25vZGVzID0gW107IC8vIEFsbCBhbGxvY2F0ZWQgbm9kZSBvYmplY3RzCgogIGNvbnN0IFNwbGl0U29sdmVyX3NvbHZlX2VxcyA9IFtdOyAvLyBUZW1wIGFycmF5CgogIGNvbnN0IFNwbGl0U29sdmVyX3NvbHZlX2R1bW15V29ybGQgPSB7CiAgICBib2RpZXM6IFtdCiAgfTsgLy8gVGVtcCBvYmplY3QKCiAgY29uc3QgU1RBVElDID0gQm9keS5TVEFUSUM7CgogIGZ1bmN0aW9uIGdldFVudmlzaXRlZE5vZGUobm9kZXMpIHsKICAgIGNvbnN0IE5ub2RlcyA9IG5vZGVzLmxlbmd0aDsKCiAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gTm5vZGVzOyBpKyspIHsKICAgICAgY29uc3Qgbm9kZSA9IG5vZGVzW2ldOwoKICAgICAgaWYgKCFub2RlLnZpc2l0ZWQgJiYgIShub2RlLmJvZHkudHlwZSAmIFNUQVRJQykpIHsKICAgICAgICByZXR1cm4gbm9kZTsKICAgICAgfQogICAgfQoKICAgIHJldHVybiBmYWxzZTsKICB9CgogIGNvbnN0IHF1ZXVlID0gW107CgogIGZ1bmN0aW9uIGJmcyhyb290LCB2aXNpdEZ1bmMsIGJkcywgZXFzKSB7CiAgICBxdWV1ZS5wdXNoKHJvb3QpOwogICAgcm9vdC52aXNpdGVkID0gdHJ1ZTsKICAgIHZpc2l0RnVuYyhyb290LCBiZHMsIGVxcyk7CgogICAgd2hpbGUgKHF1ZXVlLmxlbmd0aCkgewogICAgICBjb25zdCBub2RlID0gcXVldWUucG9wKCk7IC8vIExvb3Agb3ZlciB1bnZpc2l0ZWQgY2hpbGQgbm9kZXMKCiAgICAgIGxldCBjaGlsZDsKCiAgICAgIHdoaWxlIChjaGlsZCA9IGdldFVudmlzaXRlZE5vZGUobm9kZS5jaGlsZHJlbikpIHsKICAgICAgICBjaGlsZC52aXNpdGVkID0gdHJ1ZTsKICAgICAgICB2aXNpdEZ1bmMoY2hpbGQsIGJkcywgZXFzKTsKICAgICAgICBxdWV1ZS5wdXNoKGNoaWxkKTsKICAgICAgfQogICAgfQogIH0KCiAgZnVuY3Rpb24gdmlzaXRGdW5jKG5vZGUsIGJkcywgZXFzKSB7CiAgICBiZHMucHVzaChub2RlLmJvZHkpOwogICAgY29uc3QgTmVxcyA9IG5vZGUuZXFzLmxlbmd0aDsKCiAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gTmVxczsgaSsrKSB7CiAgICAgIGNvbnN0IGVxID0gbm9kZS5lcXNbaV07CgogICAgICBpZiAoIWVxcy5pbmNsdWRlcyhlcSkpIHsKICAgICAgICBlcXMucHVzaChlcSk7CiAgICAgIH0KICAgIH0KICB9CgogIGZ1bmN0aW9uIHNvcnRCeUlkKGEsIGIpIHsKICAgIHJldHVybiBiLmlkIC0gYS5pZDsKICB9CgogIC8qKgogICAqIEZvciBwb29saW5nIG9iamVjdHMgdGhhdCBjYW4gYmUgcmV1c2VkLgogICAqLwogIGNsYXNzIFBvb2wgewogICAgY29uc3RydWN0b3IoKSB7CiAgICAgIHRoaXMub2JqZWN0cyA9IFtdOwogICAgICB0aGlzLnR5cGUgPSBPYmplY3Q7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZWxlYXNlIGFuIG9iamVjdCBhZnRlciB1c2UKICAgICAqLwogICAgcmVsZWFzZSgpIHsKICAgICAgY29uc3QgTmFyZ3MgPSBhcmd1bWVudHMubGVuZ3RoOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgIT09IE5hcmdzOyBpKyspIHsKICAgICAgICB0aGlzLm9iamVjdHMucHVzaChpIDwgMCB8fCBhcmd1bWVudHMubGVuZ3RoIDw9IGkgPyB1bmRlZmluZWQgOiBhcmd1bWVudHNbaV0pOwogICAgICB9CgogICAgICByZXR1cm4gdGhpczsKICAgIH0KICAgIC8qKgogICAgICogR2V0IGFuIG9iamVjdAogICAgICovCgoKICAgIGdldCgpIHsKICAgICAgaWYgKHRoaXMub2JqZWN0cy5sZW5ndGggPT09IDApIHsKICAgICAgICByZXR1cm4gdGhpcy5jb25zdHJ1Y3RPYmplY3QoKTsKICAgICAgfSBlbHNlIHsKICAgICAgICByZXR1cm4gdGhpcy5vYmplY3RzLnBvcCgpOwogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIENvbnN0cnVjdCBhbiBvYmplY3QuIFNob3VsZCBiZSBpbXBsZW1lbnRlZCBpbiBlYWNoIHN1YmNsYXNzLgogICAgICovCgoKICAgIGNvbnN0cnVjdE9iamVjdCgpIHsKICAgICAgdGhyb3cgbmV3IEVycm9yKCdjb25zdHJ1Y3RPYmplY3QoKSBub3QgaW1wbGVtZW50ZWQgaW4gdGhpcyBQb29sIHN1YmNsYXNzIHlldCEnKTsKICAgIH0KICAgIC8qKgogICAgICogQHJldHVybiBTZWxmLCBmb3IgY2hhaW5pbmcKICAgICAqLwoKCiAgICByZXNpemUoc2l6ZSkgewogICAgICBjb25zdCBvYmplY3RzID0gdGhpcy5vYmplY3RzOwoKICAgICAgd2hpbGUgKG9iamVjdHMubGVuZ3RoID4gc2l6ZSkgewogICAgICAgIG9iamVjdHMucG9wKCk7CiAgICAgIH0KCiAgICAgIHdoaWxlIChvYmplY3RzLmxlbmd0aCA8IHNpemUpIHsKICAgICAgICBvYmplY3RzLnB1c2godGhpcy5jb25zdHJ1Y3RPYmplY3QoKSk7CiAgICAgIH0KCiAgICAgIHJldHVybiB0aGlzOwogICAgfQoKICB9CgogIC8qKgogICAqIFZlYzNQb29sCiAgICovCgogIGNsYXNzIFZlYzNQb29sIGV4dGVuZHMgUG9vbCB7CiAgICBjb25zdHJ1Y3RvcigpIHsKICAgICAgc3VwZXIoLi4uYXJndW1lbnRzKTsKICAgICAgdGhpcy50eXBlID0gVmVjMzsKICAgIH0KCiAgICAvKioKICAgICAqIENvbnN0cnVjdCBhIHZlY3RvcgogICAgICovCiAgICBjb25zdHJ1Y3RPYmplY3QoKSB7CiAgICAgIHJldHVybiBuZXcgVmVjMygpOwogICAgfQoKICB9CgogIC8vIE5hbWluZyBydWxlOiBiYXNlZCBvZiB0aGUgb3JkZXIgaW4gU0hBUEVfVFlQRVMsCiAgLy8gdGhlIGZpcnN0IHBhcnQgb2YgdGhlIG1ldGhvZCBpcyBmb3JtZWQgYnkgdGhlCiAgLy8gc2hhcGUgdHlwZSB0aGF0IGNvbWVzIGJlZm9yZSwgaW4gdGhlIHNlY29uZCBwYXJ0CiAgLy8gdGhlcmUgaXMgdGhlIHNoYXBlIHR5cGUgdGhhdCBjb21lcyBhZnRlciBpbiB0aGUgU0hBUEVfVFlQRVMgbGlzdAogIGNvbnN0IENPTExJU0lPTl9UWVBFUyA9IHsKICAgIHNwaGVyZVNwaGVyZTogU2hhcGUudHlwZXMuU1BIRVJFLAogICAgc3BoZXJlUGxhbmU6IFNoYXBlLnR5cGVzLlNQSEVSRSB8IFNoYXBlLnR5cGVzLlBMQU5FLAogICAgYm94Qm94OiBTaGFwZS50eXBlcy5CT1ggfCBTaGFwZS50eXBlcy5CT1gsCiAgICBzcGhlcmVCb3g6IFNoYXBlLnR5cGVzLlNQSEVSRSB8IFNoYXBlLnR5cGVzLkJPWCwKICAgIHBsYW5lQm94OiBTaGFwZS50eXBlcy5QTEFORSB8IFNoYXBlLnR5cGVzLkJPWCwKICAgIGNvbnZleENvbnZleDogU2hhcGUudHlwZXMuQ09OVkVYUE9MWUhFRFJPTiwKICAgIHNwaGVyZUNvbnZleDogU2hhcGUudHlwZXMuU1BIRVJFIHwgU2hhcGUudHlwZXMuQ09OVkVYUE9MWUhFRFJPTiwKICAgIHBsYW5lQ29udmV4OiBTaGFwZS50eXBlcy5QTEFORSB8IFNoYXBlLnR5cGVzLkNPTlZFWFBPTFlIRURST04sCiAgICBib3hDb252ZXg6IFNoYXBlLnR5cGVzLkJPWCB8IFNoYXBlLnR5cGVzLkNPTlZFWFBPTFlIRURST04sCiAgICBzcGhlcmVIZWlnaHRmaWVsZDogU2hhcGUudHlwZXMuU1BIRVJFIHwgU2hhcGUudHlwZXMuSEVJR0hURklFTEQsCiAgICBib3hIZWlnaHRmaWVsZDogU2hhcGUudHlwZXMuQk9YIHwgU2hhcGUudHlwZXMuSEVJR0hURklFTEQsCiAgICBjb252ZXhIZWlnaHRmaWVsZDogU2hhcGUudHlwZXMuQ09OVkVYUE9MWUhFRFJPTiB8IFNoYXBlLnR5cGVzLkhFSUdIVEZJRUxELAogICAgc3BoZXJlUGFydGljbGU6IFNoYXBlLnR5cGVzLlBBUlRJQ0xFIHwgU2hhcGUudHlwZXMuU1BIRVJFLAogICAgcGxhbmVQYXJ0aWNsZTogU2hhcGUudHlwZXMuUExBTkUgfCBTaGFwZS50eXBlcy5QQVJUSUNMRSwKICAgIGJveFBhcnRpY2xlOiBTaGFwZS50eXBlcy5CT1ggfCBTaGFwZS50eXBlcy5QQVJUSUNMRSwKICAgIGNvbnZleFBhcnRpY2xlOiBTaGFwZS50eXBlcy5QQVJUSUNMRSB8IFNoYXBlLnR5cGVzLkNPTlZFWFBPTFlIRURST04sCiAgICBjeWxpbmRlckN5bGluZGVyOiBTaGFwZS50eXBlcy5DWUxJTkRFUiwKICAgIHNwaGVyZUN5bGluZGVyOiBTaGFwZS50eXBlcy5TUEhFUkUgfCBTaGFwZS50eXBlcy5DWUxJTkRFUiwKICAgIHBsYW5lQ3lsaW5kZXI6IFNoYXBlLnR5cGVzLlBMQU5FIHwgU2hhcGUudHlwZXMuQ1lMSU5ERVIsCiAgICBib3hDeWxpbmRlcjogU2hhcGUudHlwZXMuQk9YIHwgU2hhcGUudHlwZXMuQ1lMSU5ERVIsCiAgICBjb252ZXhDeWxpbmRlcjogU2hhcGUudHlwZXMuQ09OVkVYUE9MWUhFRFJPTiB8IFNoYXBlLnR5cGVzLkNZTElOREVSLAogICAgaGVpZ2h0ZmllbGRDeWxpbmRlcjogU2hhcGUudHlwZXMuSEVJR0hURklFTEQgfCBTaGFwZS50eXBlcy5DWUxJTkRFUiwKICAgIHBhcnRpY2xlQ3lsaW5kZXI6IFNoYXBlLnR5cGVzLlBBUlRJQ0xFIHwgU2hhcGUudHlwZXMuQ1lMSU5ERVIsCiAgICBzcGhlcmVUcmltZXNoOiBTaGFwZS50eXBlcy5TUEhFUkUgfCBTaGFwZS50eXBlcy5UUklNRVNILAogICAgcGxhbmVUcmltZXNoOiBTaGFwZS50eXBlcy5QTEFORSB8IFNoYXBlLnR5cGVzLlRSSU1FU0gKICB9OwoKICAvKioKICAgKiBIZWxwZXIgY2xhc3MgZm9yIHRoZSBXb3JsZC4gR2VuZXJhdGVzIENvbnRhY3RFcXVhdGlvbnMuCiAgICogQHRvZG8gU3BoZXJlLUNvbnZleFBvbHloZWRyb24gY29udGFjdHMKICAgKiBAdG9kbyBDb250YWN0IHJlZHVjdGlvbgogICAqIEB0b2RvIHNob3VsZCBtb3ZlIG1ldGhvZHMgdG8gcHJvdG90eXBlCiAgICovCiAgY2xhc3MgTmFycm93cGhhc2UgewogICAgLyoqCiAgICAgKiBJbnRlcm5hbCBzdG9yYWdlIG9mIHBvb2xlZCBjb250YWN0IHBvaW50cy4KICAgICAqLwoKICAgIC8qKgogICAgICogUG9vbGVkIHZlY3RvcnMuCiAgICAgKi8KICAgIGdldCBbQ09MTElTSU9OX1RZUEVTLnNwaGVyZVNwaGVyZV0oKSB7CiAgICAgIHJldHVybiB0aGlzLnNwaGVyZVNwaGVyZTsKICAgIH0KCiAgICBnZXQgW0NPTExJU0lPTl9UWVBFUy5zcGhlcmVQbGFuZV0oKSB7CiAgICAgIHJldHVybiB0aGlzLnNwaGVyZVBsYW5lOwogICAgfQoKICAgIGdldCBbQ09MTElTSU9OX1RZUEVTLmJveEJveF0oKSB7CiAgICAgIHJldHVybiB0aGlzLmJveEJveDsKICAgIH0KCiAgICBnZXQgW0NPTExJU0lPTl9UWVBFUy5zcGhlcmVCb3hdKCkgewogICAgICByZXR1cm4gdGhpcy5zcGhlcmVCb3g7CiAgICB9CgogICAgZ2V0IFtDT0xMSVNJT05fVFlQRVMucGxhbmVCb3hdKCkgewogICAgICByZXR1cm4gdGhpcy5wbGFuZUJveDsKICAgIH0KCiAgICBnZXQgW0NPTExJU0lPTl9UWVBFUy5jb252ZXhDb252ZXhdKCkgewogICAgICByZXR1cm4gdGhpcy5jb252ZXhDb252ZXg7CiAgICB9CgogICAgZ2V0IFtDT0xMSVNJT05fVFlQRVMuc3BoZXJlQ29udmV4XSgpIHsKICAgICAgcmV0dXJuIHRoaXMuc3BoZXJlQ29udmV4OwogICAgfQoKICAgIGdldCBbQ09MTElTSU9OX1RZUEVTLnBsYW5lQ29udmV4XSgpIHsKICAgICAgcmV0dXJuIHRoaXMucGxhbmVDb252ZXg7CiAgICB9CgogICAgZ2V0IFtDT0xMSVNJT05fVFlQRVMuYm94Q29udmV4XSgpIHsKICAgICAgcmV0dXJuIHRoaXMuYm94Q29udmV4OwogICAgfQoKICAgIGdldCBbQ09MTElTSU9OX1RZUEVTLnNwaGVyZUhlaWdodGZpZWxkXSgpIHsKICAgICAgcmV0dXJuIHRoaXMuc3BoZXJlSGVpZ2h0ZmllbGQ7CiAgICB9CgogICAgZ2V0IFtDT0xMSVNJT05fVFlQRVMuYm94SGVpZ2h0ZmllbGRdKCkgewogICAgICByZXR1cm4gdGhpcy5ib3hIZWlnaHRmaWVsZDsKICAgIH0KCiAgICBnZXQgW0NPTExJU0lPTl9UWVBFUy5jb252ZXhIZWlnaHRmaWVsZF0oKSB7CiAgICAgIHJldHVybiB0aGlzLmNvbnZleEhlaWdodGZpZWxkOwogICAgfQoKICAgIGdldCBbQ09MTElTSU9OX1RZUEVTLnNwaGVyZVBhcnRpY2xlXSgpIHsKICAgICAgcmV0dXJuIHRoaXMuc3BoZXJlUGFydGljbGU7CiAgICB9CgogICAgZ2V0IFtDT0xMSVNJT05fVFlQRVMucGxhbmVQYXJ0aWNsZV0oKSB7CiAgICAgIHJldHVybiB0aGlzLnBsYW5lUGFydGljbGU7CiAgICB9CgogICAgZ2V0IFtDT0xMSVNJT05fVFlQRVMuYm94UGFydGljbGVdKCkgewogICAgICByZXR1cm4gdGhpcy5ib3hQYXJ0aWNsZTsKICAgIH0KCiAgICBnZXQgW0NPTExJU0lPTl9UWVBFUy5jb252ZXhQYXJ0aWNsZV0oKSB7CiAgICAgIHJldHVybiB0aGlzLmNvbnZleFBhcnRpY2xlOwogICAgfQoKICAgIGdldCBbQ09MTElTSU9OX1RZUEVTLmN5bGluZGVyQ3lsaW5kZXJdKCkgewogICAgICByZXR1cm4gdGhpcy5jb252ZXhDb252ZXg7CiAgICB9CgogICAgZ2V0IFtDT0xMSVNJT05fVFlQRVMuc3BoZXJlQ3lsaW5kZXJdKCkgewogICAgICByZXR1cm4gdGhpcy5zcGhlcmVDb252ZXg7CiAgICB9CgogICAgZ2V0IFtDT0xMSVNJT05fVFlQRVMucGxhbmVDeWxpbmRlcl0oKSB7CiAgICAgIHJldHVybiB0aGlzLnBsYW5lQ29udmV4OwogICAgfQoKICAgIGdldCBbQ09MTElTSU9OX1RZUEVTLmJveEN5bGluZGVyXSgpIHsKICAgICAgcmV0dXJuIHRoaXMuYm94Q29udmV4OwogICAgfQoKICAgIGdldCBbQ09MTElTSU9OX1RZUEVTLmNvbnZleEN5bGluZGVyXSgpIHsKICAgICAgcmV0dXJuIHRoaXMuY29udmV4Q29udmV4OwogICAgfQoKICAgIGdldCBbQ09MTElTSU9OX1RZUEVTLmhlaWdodGZpZWxkQ3lsaW5kZXJdKCkgewogICAgICByZXR1cm4gdGhpcy5oZWlnaHRmaWVsZEN5bGluZGVyOwogICAgfQoKICAgIGdldCBbQ09MTElTSU9OX1RZUEVTLnBhcnRpY2xlQ3lsaW5kZXJdKCkgewogICAgICByZXR1cm4gdGhpcy5wYXJ0aWNsZUN5bGluZGVyOwogICAgfQoKICAgIGdldCBbQ09MTElTSU9OX1RZUEVTLnNwaGVyZVRyaW1lc2hdKCkgewogICAgICByZXR1cm4gdGhpcy5zcGhlcmVUcmltZXNoOwogICAgfQoKICAgIGdldCBbQ09MTElTSU9OX1RZUEVTLnBsYW5lVHJpbWVzaF0oKSB7CiAgICAgIHJldHVybiB0aGlzLnBsYW5lVHJpbWVzaDsKICAgIH0gLy8gZ2V0IFtDT0xMSVNJT05fVFlQRVMuY29udmV4VHJpbWVzaF0oKSB7CiAgICAvLyAgIHJldHVybiB0aGlzLmNvbnZleFRyaW1lc2gKICAgIC8vIH0KCgogICAgY29uc3RydWN0b3Iod29ybGQpIHsKICAgICAgdGhpcy5jb250YWN0UG9pbnRQb29sID0gW107CiAgICAgIHRoaXMuZnJpY3Rpb25FcXVhdGlvblBvb2wgPSBbXTsKICAgICAgdGhpcy5yZXN1bHQgPSBbXTsKICAgICAgdGhpcy5mcmljdGlvblJlc3VsdCA9IFtdOwogICAgICB0aGlzLnYzcG9vbCA9IG5ldyBWZWMzUG9vbCgpOwogICAgICB0aGlzLndvcmxkID0gd29ybGQ7CiAgICAgIHRoaXMuY3VycmVudENvbnRhY3RNYXRlcmlhbCA9IHdvcmxkLmRlZmF1bHRDb250YWN0TWF0ZXJpYWw7CiAgICAgIHRoaXMuZW5hYmxlRnJpY3Rpb25SZWR1Y3Rpb24gPSBmYWxzZTsKICAgIH0KICAgIC8qKgogICAgICogTWFrZSBhIGNvbnRhY3Qgb2JqZWN0LCBieSB1c2luZyB0aGUgaW50ZXJuYWwgcG9vbCBvciBjcmVhdGluZyBhIG5ldyBvbmUuCiAgICAgKi8KCgogICAgY3JlYXRlQ29udGFjdEVxdWF0aW9uKGJpLCBiaiwgc2ksIHNqLCBvdmVycmlkZVNoYXBlQSwgb3ZlcnJpZGVTaGFwZUIpIHsKICAgICAgbGV0IGM7CgogICAgICBpZiAodGhpcy5jb250YWN0UG9pbnRQb29sLmxlbmd0aCkgewogICAgICAgIGMgPSB0aGlzLmNvbnRhY3RQb2ludFBvb2wucG9wKCk7CiAgICAgICAgYy5iaSA9IGJpOwogICAgICAgIGMuYmogPSBiajsKICAgICAgfSBlbHNlIHsKICAgICAgICBjID0gbmV3IENvbnRhY3RFcXVhdGlvbihiaSwgYmopOwogICAgICB9CgogICAgICBjLmVuYWJsZWQgPSBiaS5jb2xsaXNpb25SZXNwb25zZSAmJiBiai5jb2xsaXNpb25SZXNwb25zZSAmJiBzaS5jb2xsaXNpb25SZXNwb25zZSAmJiBzai5jb2xsaXNpb25SZXNwb25zZTsKICAgICAgY29uc3QgY20gPSB0aGlzLmN1cnJlbnRDb250YWN0TWF0ZXJpYWw7CiAgICAgIGMucmVzdGl0dXRpb24gPSBjbS5yZXN0aXR1dGlvbjsKICAgICAgYy5zZXRTcG9va1BhcmFtcyhjbS5jb250YWN0RXF1YXRpb25TdGlmZm5lc3MsIGNtLmNvbnRhY3RFcXVhdGlvblJlbGF4YXRpb24sIHRoaXMud29ybGQuZHQpOwogICAgICBjb25zdCBtYXRBID0gc2kubWF0ZXJpYWwgfHwgYmkubWF0ZXJpYWw7CiAgICAgIGNvbnN0IG1hdEIgPSBzai5tYXRlcmlhbCB8fCBiai5tYXRlcmlhbDsKCiAgICAgIGlmIChtYXRBICYmIG1hdEIgJiYgbWF0QS5yZXN0aXR1dGlvbiA+PSAwICYmIG1hdEIucmVzdGl0dXRpb24gPj0gMCkgewogICAgICAgIGMucmVzdGl0dXRpb24gPSBtYXRBLnJlc3RpdHV0aW9uICogbWF0Qi5yZXN0aXR1dGlvbjsKICAgICAgfQoKICAgICAgYy5zaSA9IG92ZXJyaWRlU2hhcGVBIHx8IHNpOwogICAgICBjLnNqID0gb3ZlcnJpZGVTaGFwZUIgfHwgc2o7CiAgICAgIHJldHVybiBjOwogICAgfQoKICAgIGNyZWF0ZUZyaWN0aW9uRXF1YXRpb25zRnJvbUNvbnRhY3QoY29udGFjdEVxdWF0aW9uLCBvdXRBcnJheSkgewogICAgICBjb25zdCBib2R5QSA9IGNvbnRhY3RFcXVhdGlvbi5iaTsKICAgICAgY29uc3QgYm9keUIgPSBjb250YWN0RXF1YXRpb24uYmo7CiAgICAgIGNvbnN0IHNoYXBlQSA9IGNvbnRhY3RFcXVhdGlvbi5zaTsKICAgICAgY29uc3Qgc2hhcGVCID0gY29udGFjdEVxdWF0aW9uLnNqOwogICAgICBjb25zdCB3b3JsZCA9IHRoaXMud29ybGQ7CiAgICAgIGNvbnN0IGNtID0gdGhpcy5jdXJyZW50Q29udGFjdE1hdGVyaWFsOyAvLyBJZiBmcmljdGlvbiBvciByZXN0aXR1dGlvbiB3ZXJlIHNwZWNpZmllZCBpbiB0aGUgbWF0ZXJpYWwsIHVzZSB0aGVtCgogICAgICBsZXQgZnJpY3Rpb24gPSBjbS5mcmljdGlvbjsKICAgICAgY29uc3QgbWF0QSA9IHNoYXBlQS5tYXRlcmlhbCB8fCBib2R5QS5tYXRlcmlhbDsKICAgICAgY29uc3QgbWF0QiA9IHNoYXBlQi5tYXRlcmlhbCB8fCBib2R5Qi5tYXRlcmlhbDsKCiAgICAgIGlmIChtYXRBICYmIG1hdEIgJiYgbWF0QS5mcmljdGlvbiA+PSAwICYmIG1hdEIuZnJpY3Rpb24gPj0gMCkgewogICAgICAgIGZyaWN0aW9uID0gbWF0QS5mcmljdGlvbiAqIG1hdEIuZnJpY3Rpb247CiAgICAgIH0KCiAgICAgIGlmIChmcmljdGlvbiA+IDApIHsKICAgICAgICAvLyBDcmVhdGUgMiB0YW5nZW50IGVxdWF0aW9ucwogICAgICAgIC8vIFVzZXJzIG1heSBwcm92aWRlIGEgZm9yY2UgZGlmZmVyZW50IGZyb20gZ2xvYmFsIGdyYXZpdHkgdG8gdXNlIHdoZW4gY29tcHV0aW5nIGNvbnRhY3QgZnJpY3Rpb24uCiAgICAgICAgY29uc3QgbXVnID0gZnJpY3Rpb24gKiAod29ybGQuZnJpY3Rpb25HcmF2aXR5IHx8IHdvcmxkLmdyYXZpdHkpLmxlbmd0aCgpOwogICAgICAgIGxldCByZWR1Y2VkTWFzcyA9IGJvZHlBLmludk1hc3MgKyBib2R5Qi5pbnZNYXNzOwoKICAgICAgICBpZiAocmVkdWNlZE1hc3MgPiAwKSB7CiAgICAgICAgICByZWR1Y2VkTWFzcyA9IDEgLyByZWR1Y2VkTWFzczsKICAgICAgICB9CgogICAgICAgIGNvbnN0IHBvb2wgPSB0aGlzLmZyaWN0aW9uRXF1YXRpb25Qb29sOwogICAgICAgIGNvbnN0IGMxID0gcG9vbC5sZW5ndGggPyBwb29sLnBvcCgpIDogbmV3IEZyaWN0aW9uRXF1YXRpb24oYm9keUEsIGJvZHlCLCBtdWcgKiByZWR1Y2VkTWFzcyk7CiAgICAgICAgY29uc3QgYzIgPSBwb29sLmxlbmd0aCA/IHBvb2wucG9wKCkgOiBuZXcgRnJpY3Rpb25FcXVhdGlvbihib2R5QSwgYm9keUIsIG11ZyAqIHJlZHVjZWRNYXNzKTsKICAgICAgICBjMS5iaSA9IGMyLmJpID0gYm9keUE7CiAgICAgICAgYzEuYmogPSBjMi5iaiA9IGJvZHlCOwogICAgICAgIGMxLm1pbkZvcmNlID0gYzIubWluRm9yY2UgPSAtbXVnICogcmVkdWNlZE1hc3M7CiAgICAgICAgYzEubWF4Rm9yY2UgPSBjMi5tYXhGb3JjZSA9IG11ZyAqIHJlZHVjZWRNYXNzOyAvLyBDb3B5IG92ZXIgdGhlIHJlbGF0aXZlIHZlY3RvcnMKCiAgICAgICAgYzEucmkuY29weShjb250YWN0RXF1YXRpb24ucmkpOwogICAgICAgIGMxLnJqLmNvcHkoY29udGFjdEVxdWF0aW9uLnJqKTsKICAgICAgICBjMi5yaS5jb3B5KGNvbnRhY3RFcXVhdGlvbi5yaSk7CiAgICAgICAgYzIucmouY29weShjb250YWN0RXF1YXRpb24ucmopOyAvLyBDb25zdHJ1Y3QgdGFuZ2VudHMKCiAgICAgICAgY29udGFjdEVxdWF0aW9uLm5pLnRhbmdlbnRzKGMxLnQsIGMyLnQpOyAvLyBTZXQgc3Bvb2sgcGFyYW1zCgogICAgICAgIGMxLnNldFNwb29rUGFyYW1zKGNtLmZyaWN0aW9uRXF1YXRpb25TdGlmZm5lc3MsIGNtLmZyaWN0aW9uRXF1YXRpb25SZWxheGF0aW9uLCB3b3JsZC5kdCk7CiAgICAgICAgYzIuc2V0U3Bvb2tQYXJhbXMoY20uZnJpY3Rpb25FcXVhdGlvblN0aWZmbmVzcywgY20uZnJpY3Rpb25FcXVhdGlvblJlbGF4YXRpb24sIHdvcmxkLmR0KTsKICAgICAgICBjMS5lbmFibGVkID0gYzIuZW5hYmxlZCA9IGNvbnRhY3RFcXVhdGlvbi5lbmFibGVkOwogICAgICAgIG91dEFycmF5LnB1c2goYzEsIGMyKTsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgfQoKICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQogICAgLyoqCiAgICAgKiBUYWtlIHRoZSBhdmVyYWdlIE4gbGF0ZXN0IGNvbnRhY3QgcG9pbnQgb24gdGhlIHBsYW5lLgogICAgICovCgoKICAgIGNyZWF0ZUZyaWN0aW9uRnJvbUF2ZXJhZ2UobnVtQ29udGFjdHMpIHsKICAgICAgLy8gVGhlIGxhc3QgY29udGFjdEVxdWF0aW9uCiAgICAgIGxldCBjID0gdGhpcy5yZXN1bHRbdGhpcy5yZXN1bHQubGVuZ3RoIC0gMV07IC8vIENyZWF0ZSB0aGUgcmVzdWx0OiB0d28gImF2ZXJhZ2UiIGZyaWN0aW9uIGVxdWF0aW9ucwoKICAgICAgaWYgKCF0aGlzLmNyZWF0ZUZyaWN0aW9uRXF1YXRpb25zRnJvbUNvbnRhY3QoYywgdGhpcy5mcmljdGlvblJlc3VsdCkgfHwgbnVtQ29udGFjdHMgPT09IDEpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIGNvbnN0IGYxID0gdGhpcy5mcmljdGlvblJlc3VsdFt0aGlzLmZyaWN0aW9uUmVzdWx0Lmxlbmd0aCAtIDJdOwogICAgICBjb25zdCBmMiA9IHRoaXMuZnJpY3Rpb25SZXN1bHRbdGhpcy5mcmljdGlvblJlc3VsdC5sZW5ndGggLSAxXTsKICAgICAgYXZlcmFnZU5vcm1hbC5zZXRaZXJvKCk7CiAgICAgIGF2ZXJhZ2VDb250YWN0UG9pbnRBLnNldFplcm8oKTsKICAgICAgYXZlcmFnZUNvbnRhY3RQb2ludEIuc2V0WmVybygpOwogICAgICBjb25zdCBib2R5QSA9IGMuYmk7CiAgICAgIGMuYmo7CgogICAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gbnVtQ29udGFjdHM7IGkrKykgewogICAgICAgIGMgPSB0aGlzLnJlc3VsdFt0aGlzLnJlc3VsdC5sZW5ndGggLSAxIC0gaV07CgogICAgICAgIGlmIChjLmJpICE9PSBib2R5QSkgewogICAgICAgICAgYXZlcmFnZU5vcm1hbC52YWRkKGMubmksIGF2ZXJhZ2VOb3JtYWwpOwogICAgICAgICAgYXZlcmFnZUNvbnRhY3RQb2ludEEudmFkZChjLnJpLCBhdmVyYWdlQ29udGFjdFBvaW50QSk7CiAgICAgICAgICBhdmVyYWdlQ29udGFjdFBvaW50Qi52YWRkKGMucmosIGF2ZXJhZ2VDb250YWN0UG9pbnRCKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgYXZlcmFnZU5vcm1hbC52c3ViKGMubmksIGF2ZXJhZ2VOb3JtYWwpOwogICAgICAgICAgYXZlcmFnZUNvbnRhY3RQb2ludEEudmFkZChjLnJqLCBhdmVyYWdlQ29udGFjdFBvaW50QSk7CiAgICAgICAgICBhdmVyYWdlQ29udGFjdFBvaW50Qi52YWRkKGMucmksIGF2ZXJhZ2VDb250YWN0UG9pbnRCKTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIGNvbnN0IGludk51bUNvbnRhY3RzID0gMSAvIG51bUNvbnRhY3RzOwogICAgICBhdmVyYWdlQ29udGFjdFBvaW50QS5zY2FsZShpbnZOdW1Db250YWN0cywgZjEucmkpOwogICAgICBhdmVyYWdlQ29udGFjdFBvaW50Qi5zY2FsZShpbnZOdW1Db250YWN0cywgZjEucmopOwogICAgICBmMi5yaS5jb3B5KGYxLnJpKTsgLy8gU2hvdWxkIGJlIHRoZSBzYW1lCgogICAgICBmMi5yai5jb3B5KGYxLnJqKTsKICAgICAgYXZlcmFnZU5vcm1hbC5ub3JtYWxpemUoKTsKICAgICAgYXZlcmFnZU5vcm1hbC50YW5nZW50cyhmMS50LCBmMi50KTsgLy8gcmV0dXJuIGVxOwogICAgfQogICAgLyoqCiAgICAgKiBHZW5lcmF0ZSBhbGwgY29udGFjdHMgYmV0d2VlbiBhIGxpc3Qgb2YgYm9keSBwYWlycwogICAgICogQHBhcmFtIHAxIEFycmF5IG9mIGJvZHkgaW5kaWNlcwogICAgICogQHBhcmFtIHAyIEFycmF5IG9mIGJvZHkgaW5kaWNlcwogICAgICogQHBhcmFtIHJlc3VsdCBBcnJheSB0byBzdG9yZSBnZW5lcmF0ZWQgY29udGFjdHMKICAgICAqIEBwYXJhbSBvbGRjb250YWN0cyBPcHRpb25hbC4gQXJyYXkgb2YgcmV1c2FibGUgY29udGFjdCBvYmplY3RzCiAgICAgKi8KCgogICAgZ2V0Q29udGFjdHMocDEsIHAyLCB3b3JsZCwgcmVzdWx0LCBvbGRjb250YWN0cywgZnJpY3Rpb25SZXN1bHQsIGZyaWN0aW9uUG9vbCkgewogICAgICAvLyBTYXZlIG9sZCBjb250YWN0IG9iamVjdHMKICAgICAgdGhpcy5jb250YWN0UG9pbnRQb29sID0gb2xkY29udGFjdHM7CiAgICAgIHRoaXMuZnJpY3Rpb25FcXVhdGlvblBvb2wgPSBmcmljdGlvblBvb2w7CiAgICAgIHRoaXMucmVzdWx0ID0gcmVzdWx0OwogICAgICB0aGlzLmZyaWN0aW9uUmVzdWx0ID0gZnJpY3Rpb25SZXN1bHQ7CiAgICAgIGNvbnN0IHFpID0gdG1wUXVhdDE7CiAgICAgIGNvbnN0IHFqID0gdG1wUXVhdDI7CiAgICAgIGNvbnN0IHhpID0gdG1wVmVjMTsKICAgICAgY29uc3QgeGogPSB0bXBWZWMyOwoKICAgICAgZm9yIChsZXQgayA9IDAsIE4gPSBwMS5sZW5ndGg7IGsgIT09IE47IGsrKykgewogICAgICAgIC8vIEdldCBjdXJyZW50IGNvbGxpc2lvbiBib2RpZXMKICAgICAgICBjb25zdCBiaSA9IHAxW2tdOwogICAgICAgIGNvbnN0IGJqID0gcDJba107IC8vIEdldCBjb250YWN0IG1hdGVyaWFsCgogICAgICAgIGxldCBib2R5Q29udGFjdE1hdGVyaWFsID0gbnVsbDsKCiAgICAgICAgaWYgKGJpLm1hdGVyaWFsICYmIGJqLm1hdGVyaWFsKSB7CiAgICAgICAgICBib2R5Q29udGFjdE1hdGVyaWFsID0gd29ybGQuZ2V0Q29udGFjdE1hdGVyaWFsKGJpLm1hdGVyaWFsLCBiai5tYXRlcmlhbCkgfHwgbnVsbDsKICAgICAgICB9CgogICAgICAgIGNvbnN0IGp1c3RUZXN0ID0gYmkudHlwZSAmIEJvZHkuS0lORU1BVElDICYmIGJqLnR5cGUgJiBCb2R5LlNUQVRJQyB8fCBiaS50eXBlICYgQm9keS5TVEFUSUMgJiYgYmoudHlwZSAmIEJvZHkuS0lORU1BVElDIHx8IGJpLnR5cGUgJiBCb2R5LktJTkVNQVRJQyAmJiBiai50eXBlICYgQm9keS5LSU5FTUFUSUM7CgogICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgYmkuc2hhcGVzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICBiaS5xdWF0ZXJuaW9uLm11bHQoYmkuc2hhcGVPcmllbnRhdGlvbnNbaV0sIHFpKTsKICAgICAgICAgIGJpLnF1YXRlcm5pb24udm11bHQoYmkuc2hhcGVPZmZzZXRzW2ldLCB4aSk7CiAgICAgICAgICB4aS52YWRkKGJpLnBvc2l0aW9uLCB4aSk7CiAgICAgICAgICBjb25zdCBzaSA9IGJpLnNoYXBlc1tpXTsKCiAgICAgICAgICBmb3IgKGxldCBqID0gMDsgaiA8IGJqLnNoYXBlcy5sZW5ndGg7IGorKykgewogICAgICAgICAgICAvLyBDb21wdXRlIHdvcmxkIHRyYW5zZm9ybSBvZiBzaGFwZXMKICAgICAgICAgICAgYmoucXVhdGVybmlvbi5tdWx0KGJqLnNoYXBlT3JpZW50YXRpb25zW2pdLCBxaik7CiAgICAgICAgICAgIGJqLnF1YXRlcm5pb24udm11bHQoYmouc2hhcGVPZmZzZXRzW2pdLCB4aik7CiAgICAgICAgICAgIHhqLnZhZGQoYmoucG9zaXRpb24sIHhqKTsKICAgICAgICAgICAgY29uc3Qgc2ogPSBiai5zaGFwZXNbal07CgogICAgICAgICAgICBpZiAoIShzaS5jb2xsaXNpb25GaWx0ZXJNYXNrICYgc2ouY29sbGlzaW9uRmlsdGVyR3JvdXAgJiYgc2ouY29sbGlzaW9uRmlsdGVyTWFzayAmIHNpLmNvbGxpc2lvbkZpbHRlckdyb3VwKSkgewogICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAoeGkuZGlzdGFuY2VUbyh4aikgPiBzaS5ib3VuZGluZ1NwaGVyZVJhZGl1cyArIHNqLmJvdW5kaW5nU3BoZXJlUmFkaXVzKSB7CiAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgIH0gLy8gR2V0IGNvbGxpc2lvbiBtYXRlcmlhbAoKCiAgICAgICAgICAgIGxldCBzaGFwZUNvbnRhY3RNYXRlcmlhbCA9IG51bGw7CgogICAgICAgICAgICBpZiAoc2kubWF0ZXJpYWwgJiYgc2oubWF0ZXJpYWwpIHsKICAgICAgICAgICAgICBzaGFwZUNvbnRhY3RNYXRlcmlhbCA9IHdvcmxkLmdldENvbnRhY3RNYXRlcmlhbChzaS5tYXRlcmlhbCwgc2oubWF0ZXJpYWwpIHx8IG51bGw7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHRoaXMuY3VycmVudENvbnRhY3RNYXRlcmlhbCA9IHNoYXBlQ29udGFjdE1hdGVyaWFsIHx8IGJvZHlDb250YWN0TWF0ZXJpYWwgfHwgd29ybGQuZGVmYXVsdENvbnRhY3RNYXRlcmlhbDsgLy8gR2V0IGNvbnRhY3RzCgogICAgICAgICAgICBjb25zdCByZXNvbHZlckluZGV4ID0gc2kudHlwZSB8IHNqLnR5cGU7CiAgICAgICAgICAgIGNvbnN0IHJlc29sdmVyID0gdGhpc1tyZXNvbHZlckluZGV4XTsKCiAgICAgICAgICAgIGlmIChyZXNvbHZlcikgewogICAgICAgICAgICAgIGxldCByZXR2YWwgPSBmYWxzZTsgLy8gVE8gRE86IGludmVzdGlnYXRlIHdoeSBzcGhlcmVQYXJ0aWNsZSBhbmQgY29udmV4UGFydGljbGUKICAgICAgICAgICAgICAvLyByZXNvbHZlcnMgZXhwZWN0IHNpIGFuZCBzaiBzaGFwZXMgdG8gYmUgaW4gcmV2ZXJzZSBvcmRlcgogICAgICAgICAgICAgIC8vIChpLmUuIGxhcmdlciBpbnRlZ2VyIHZhbHVlIHR5cGUgZmlyc3QgaW5zdGVhZCBvZiBzbWFsbGVyIGZpcnN0KQoKICAgICAgICAgICAgICBpZiAoc2kudHlwZSA8IHNqLnR5cGUpIHsKICAgICAgICAgICAgICAgIHJldHZhbCA9IHJlc29sdmVyLmNhbGwodGhpcywgc2ksIHNqLCB4aSwgeGosIHFpLCBxaiwgYmksIGJqLCBzaSwgc2osIGp1c3RUZXN0KTsKICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgcmV0dmFsID0gcmVzb2x2ZXIuY2FsbCh0aGlzLCBzaiwgc2ksIHhqLCB4aSwgcWosIHFpLCBiaiwgYmksIHNpLCBzaiwganVzdFRlc3QpOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgaWYgKHJldHZhbCAmJiBqdXN0VGVzdCkgewogICAgICAgICAgICAgICAgLy8gUmVnaXN0ZXIgb3ZlcmxhcAogICAgICAgICAgICAgICAgd29ybGQuc2hhcGVPdmVybGFwS2VlcGVyLnNldChzaS5pZCwgc2ouaWQpOwogICAgICAgICAgICAgICAgd29ybGQuYm9keU92ZXJsYXBLZWVwZXIuc2V0KGJpLmlkLCBiai5pZCk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CiAgICB9CgogICAgc3BoZXJlU3BoZXJlKHNpLCBzaiwgeGksIHhqLCBxaSwgcWosIGJpLCBiaiwgcnNpLCByc2osIGp1c3RUZXN0KSB7CiAgICAgIGlmIChqdXN0VGVzdCkgewogICAgICAgIHJldHVybiB4aS5kaXN0YW5jZVNxdWFyZWQoeGopIDwgKHNpLnJhZGl1cyArIHNqLnJhZGl1cykgKiogMjsKICAgICAgfSAvLyBXZSB3aWxsIGhhdmUgb25seSBvbmUgY29udGFjdCBpbiB0aGlzIGNhc2UKCgogICAgICBjb25zdCBjb250YWN0RXEgPSB0aGlzLmNyZWF0ZUNvbnRhY3RFcXVhdGlvbihiaSwgYmosIHNpLCBzaiwgcnNpLCByc2opOyAvLyBDb250YWN0IG5vcm1hbAoKICAgICAgeGoudnN1Yih4aSwgY29udGFjdEVxLm5pKTsKICAgICAgY29udGFjdEVxLm5pLm5vcm1hbGl6ZSgpOyAvLyBDb250YWN0IHBvaW50IGxvY2F0aW9ucwoKICAgICAgY29udGFjdEVxLnJpLmNvcHkoY29udGFjdEVxLm5pKTsKICAgICAgY29udGFjdEVxLnJqLmNvcHkoY29udGFjdEVxLm5pKTsKICAgICAgY29udGFjdEVxLnJpLnNjYWxlKHNpLnJhZGl1cywgY29udGFjdEVxLnJpKTsKICAgICAgY29udGFjdEVxLnJqLnNjYWxlKC1zai5yYWRpdXMsIGNvbnRhY3RFcS5yaik7CiAgICAgIGNvbnRhY3RFcS5yaS52YWRkKHhpLCBjb250YWN0RXEucmkpOwogICAgICBjb250YWN0RXEucmkudnN1YihiaS5wb3NpdGlvbiwgY29udGFjdEVxLnJpKTsKICAgICAgY29udGFjdEVxLnJqLnZhZGQoeGosIGNvbnRhY3RFcS5yaik7CiAgICAgIGNvbnRhY3RFcS5yai52c3ViKGJqLnBvc2l0aW9uLCBjb250YWN0RXEucmopOwogICAgICB0aGlzLnJlc3VsdC5wdXNoKGNvbnRhY3RFcSk7CiAgICAgIHRoaXMuY3JlYXRlRnJpY3Rpb25FcXVhdGlvbnNGcm9tQ29udGFjdChjb250YWN0RXEsIHRoaXMuZnJpY3Rpb25SZXN1bHQpOwogICAgfQoKICAgIHNwaGVyZVBsYW5lKHNpLCBzaiwgeGksIHhqLCBxaSwgcWosIGJpLCBiaiwgcnNpLCByc2osIGp1c3RUZXN0KSB7CiAgICAgIC8vIFdlIHdpbGwgaGF2ZSBvbmUgY29udGFjdCBpbiB0aGlzIGNhc2UKICAgICAgY29uc3QgciA9IHRoaXMuY3JlYXRlQ29udGFjdEVxdWF0aW9uKGJpLCBiaiwgc2ksIHNqLCByc2ksIHJzaik7IC8vIENvbnRhY3Qgbm9ybWFsCgogICAgICByLm5pLnNldCgwLCAwLCAxKTsKICAgICAgcWoudm11bHQoci5uaSwgci5uaSk7CiAgICAgIHIubmkubmVnYXRlKHIubmkpOyAvLyBib2R5IGkgaXMgdGhlIHNwaGVyZSwgZmxpcCBub3JtYWwKCiAgICAgIHIubmkubm9ybWFsaXplKCk7IC8vIE5lZWRlZD8KICAgICAgLy8gVmVjdG9yIGZyb20gc3BoZXJlIGNlbnRlciB0byBjb250YWN0IHBvaW50CgogICAgICByLm5pLnNjYWxlKHNpLnJhZGl1cywgci5yaSk7IC8vIFByb2plY3QgZG93biBzcGhlcmUgb24gcGxhbmUKCiAgICAgIHhpLnZzdWIoeGosIHBvaW50X29uX3BsYW5lX3RvX3NwaGVyZSk7CiAgICAgIHIubmkuc2NhbGUoci5uaS5kb3QocG9pbnRfb25fcGxhbmVfdG9fc3BoZXJlKSwgcGxhbmVfdG9fc3BoZXJlX29ydGhvKTsKICAgICAgcG9pbnRfb25fcGxhbmVfdG9fc3BoZXJlLnZzdWIocGxhbmVfdG9fc3BoZXJlX29ydGhvLCByLnJqKTsgLy8gVGhlIHNwaGVyZSBwb3NpdGlvbiBwcm9qZWN0ZWQgdG8gcGxhbmUKCiAgICAgIGlmICgtcG9pbnRfb25fcGxhbmVfdG9fc3BoZXJlLmRvdChyLm5pKSA8PSBzaS5yYWRpdXMpIHsKICAgICAgICBpZiAoanVzdFRlc3QpIHsKICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0gLy8gTWFrZSBpdCByZWxhdGl2ZSB0byB0aGUgYm9keQoKCiAgICAgICAgY29uc3QgcmkgPSByLnJpOwogICAgICAgIGNvbnN0IHJqID0gci5yajsKICAgICAgICByaS52YWRkKHhpLCByaSk7CiAgICAgICAgcmkudnN1YihiaS5wb3NpdGlvbiwgcmkpOwogICAgICAgIHJqLnZhZGQoeGosIHJqKTsKICAgICAgICByai52c3ViKGJqLnBvc2l0aW9uLCByaik7CiAgICAgICAgdGhpcy5yZXN1bHQucHVzaChyKTsKICAgICAgICB0aGlzLmNyZWF0ZUZyaWN0aW9uRXF1YXRpb25zRnJvbUNvbnRhY3QociwgdGhpcy5mcmljdGlvblJlc3VsdCk7CiAgICAgIH0KICAgIH0KCiAgICBib3hCb3goc2ksIHNqLCB4aSwgeGosIHFpLCBxaiwgYmksIGJqLCByc2ksIHJzaiwganVzdFRlc3QpIHsKICAgICAgc2kuY29udmV4UG9seWhlZHJvblJlcHJlc2VudGF0aW9uLm1hdGVyaWFsID0gc2kubWF0ZXJpYWw7CiAgICAgIHNqLmNvbnZleFBvbHloZWRyb25SZXByZXNlbnRhdGlvbi5tYXRlcmlhbCA9IHNqLm1hdGVyaWFsOwogICAgICBzaS5jb252ZXhQb2x5aGVkcm9uUmVwcmVzZW50YXRpb24uY29sbGlzaW9uUmVzcG9uc2UgPSBzaS5jb2xsaXNpb25SZXNwb25zZTsKICAgICAgc2ouY29udmV4UG9seWhlZHJvblJlcHJlc2VudGF0aW9uLmNvbGxpc2lvblJlc3BvbnNlID0gc2ouY29sbGlzaW9uUmVzcG9uc2U7CiAgICAgIHJldHVybiB0aGlzLmNvbnZleENvbnZleChzaS5jb252ZXhQb2x5aGVkcm9uUmVwcmVzZW50YXRpb24sIHNqLmNvbnZleFBvbHloZWRyb25SZXByZXNlbnRhdGlvbiwgeGksIHhqLCBxaSwgcWosIGJpLCBiaiwgc2ksIHNqLCBqdXN0VGVzdCk7CiAgICB9CgogICAgc3BoZXJlQm94KHNpLCBzaiwgeGksIHhqLCBxaSwgcWosIGJpLCBiaiwgcnNpLCByc2osIGp1c3RUZXN0KSB7CiAgICAgIGNvbnN0IHYzcG9vbCA9IHRoaXMudjNwb29sOyAvLyB3ZSByZWZlciB0byB0aGUgYm94IGFzIGJvZHkgagoKICAgICAgY29uc3Qgc2lkZXMgPSBzcGhlcmVCb3hfc2lkZXM7CiAgICAgIHhpLnZzdWIoeGosIGJveF90b19zcGhlcmUpOwogICAgICBzai5nZXRTaWRlTm9ybWFscyhzaWRlcywgcWopOwogICAgICBjb25zdCBSID0gc2kucmFkaXVzOwoKICAgICAgbGV0IGZvdW5kID0gZmFsc2U7IC8vIFN0b3JlIHRoZSByZXN1bHRpbmcgc2lkZSBwZW5ldHJhdGlvbiBpbmZvCgogICAgICBjb25zdCBzaWRlX25zID0gc3BoZXJlQm94X3NpZGVfbnM7CiAgICAgIGNvbnN0IHNpZGVfbnMxID0gc3BoZXJlQm94X3NpZGVfbnMxOwogICAgICBjb25zdCBzaWRlX25zMiA9IHNwaGVyZUJveF9zaWRlX25zMjsKICAgICAgbGV0IHNpZGVfaCA9IG51bGw7CiAgICAgIGxldCBzaWRlX3BlbmV0cmF0aW9ucyA9IDA7CiAgICAgIGxldCBzaWRlX2RvdDEgPSAwOwogICAgICBsZXQgc2lkZV9kb3QyID0gMDsKICAgICAgbGV0IHNpZGVfZGlzdGFuY2UgPSBudWxsOwoKICAgICAgZm9yIChsZXQgaWR4ID0gMCwgbnNpZGVzID0gc2lkZXMubGVuZ3RoOyBpZHggIT09IG5zaWRlcyAmJiBmb3VuZCA9PT0gZmFsc2U7IGlkeCsrKSB7CiAgICAgICAgLy8gR2V0IHRoZSBwbGFuZSBzaWRlIG5vcm1hbCAobnMpCiAgICAgICAgY29uc3QgbnMgPSBzcGhlcmVCb3hfbnM7CiAgICAgICAgbnMuY29weShzaWRlc1tpZHhdKTsKICAgICAgICBjb25zdCBoID0gbnMubGVuZ3RoKCk7CiAgICAgICAgbnMubm9ybWFsaXplKCk7IC8vIFRoZSBub3JtYWwvZGlzdGFuY2UgZG90IHByb2R1Y3QgdGVsbHMgd2hpY2ggc2lkZSBvZiB0aGUgcGxhbmUgd2UgYXJlCgogICAgICAgIGNvbnN0IGRvdCA9IGJveF90b19zcGhlcmUuZG90KG5zKTsKCiAgICAgICAgaWYgKGRvdCA8IGggKyBSICYmIGRvdCA+IDApIHsKICAgICAgICAgIC8vIEludGVyc2VjdHMgcGxhbmUuIE5vdyBjaGVjayB0aGUgb3RoZXIgdHdvIGRpbWVuc2lvbnMKICAgICAgICAgIGNvbnN0IG5zMSA9IHNwaGVyZUJveF9uczE7CiAgICAgICAgICBjb25zdCBuczIgPSBzcGhlcmVCb3hfbnMyOwogICAgICAgICAgbnMxLmNvcHkoc2lkZXNbKGlkeCArIDEpICUgM10pOwogICAgICAgICAgbnMyLmNvcHkoc2lkZXNbKGlkeCArIDIpICUgM10pOwogICAgICAgICAgY29uc3QgaDEgPSBuczEubGVuZ3RoKCk7CiAgICAgICAgICBjb25zdCBoMiA9IG5zMi5sZW5ndGgoKTsKICAgICAgICAgIG5zMS5ub3JtYWxpemUoKTsKICAgICAgICAgIG5zMi5ub3JtYWxpemUoKTsKICAgICAgICAgIGNvbnN0IGRvdDEgPSBib3hfdG9fc3BoZXJlLmRvdChuczEpOwogICAgICAgICAgY29uc3QgZG90MiA9IGJveF90b19zcGhlcmUuZG90KG5zMik7CgogICAgICAgICAgaWYgKGRvdDEgPCBoMSAmJiBkb3QxID4gLWgxICYmIGRvdDIgPCBoMiAmJiBkb3QyID4gLWgyKSB7CiAgICAgICAgICAgIGNvbnN0IGRpc3QgPSBNYXRoLmFicyhkb3QgLSBoIC0gUik7CgogICAgICAgICAgICBpZiAoc2lkZV9kaXN0YW5jZSA9PT0gbnVsbCB8fCBkaXN0IDwgc2lkZV9kaXN0YW5jZSkgewogICAgICAgICAgICAgIHNpZGVfZGlzdGFuY2UgPSBkaXN0OwogICAgICAgICAgICAgIHNpZGVfZG90MSA9IGRvdDE7CiAgICAgICAgICAgICAgc2lkZV9kb3QyID0gZG90MjsKICAgICAgICAgICAgICBzaWRlX2ggPSBoOwogICAgICAgICAgICAgIHNpZGVfbnMuY29weShucyk7CiAgICAgICAgICAgICAgc2lkZV9uczEuY29weShuczEpOwogICAgICAgICAgICAgIHNpZGVfbnMyLmNvcHkobnMyKTsKICAgICAgICAgICAgICBzaWRlX3BlbmV0cmF0aW9ucysrOwoKICAgICAgICAgICAgICBpZiAoanVzdFRlc3QpIHsKICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQoKICAgICAgaWYgKHNpZGVfcGVuZXRyYXRpb25zKSB7CiAgICAgICAgZm91bmQgPSB0cnVlOwogICAgICAgIGNvbnN0IHIgPSB0aGlzLmNyZWF0ZUNvbnRhY3RFcXVhdGlvbihiaSwgYmosIHNpLCBzaiwgcnNpLCByc2opOwogICAgICAgIHNpZGVfbnMuc2NhbGUoLVIsIHIucmkpOyAvLyBTcGhlcmUgcgoKICAgICAgICByLm5pLmNvcHkoc2lkZV9ucyk7CiAgICAgICAgci5uaS5uZWdhdGUoci5uaSk7IC8vIE5vcm1hbCBzaG91bGQgYmUgb3V0IG9mIHNwaGVyZQoKICAgICAgICBzaWRlX25zLnNjYWxlKHNpZGVfaCwgc2lkZV9ucyk7CiAgICAgICAgc2lkZV9uczEuc2NhbGUoc2lkZV9kb3QxLCBzaWRlX25zMSk7CiAgICAgICAgc2lkZV9ucy52YWRkKHNpZGVfbnMxLCBzaWRlX25zKTsKICAgICAgICBzaWRlX25zMi5zY2FsZShzaWRlX2RvdDIsIHNpZGVfbnMyKTsKICAgICAgICBzaWRlX25zLnZhZGQoc2lkZV9uczIsIHIucmopOyAvLyBNYWtlIHJlbGF0aXZlIHRvIGJvZGllcwoKICAgICAgICByLnJpLnZhZGQoeGksIHIucmkpOwogICAgICAgIHIucmkudnN1YihiaS5wb3NpdGlvbiwgci5yaSk7CiAgICAgICAgci5yai52YWRkKHhqLCByLnJqKTsKICAgICAgICByLnJqLnZzdWIoYmoucG9zaXRpb24sIHIucmopOwogICAgICAgIHRoaXMucmVzdWx0LnB1c2gocik7CiAgICAgICAgdGhpcy5jcmVhdGVGcmljdGlvbkVxdWF0aW9uc0Zyb21Db250YWN0KHIsIHRoaXMuZnJpY3Rpb25SZXN1bHQpOwogICAgICB9IC8vIENoZWNrIGNvcm5lcnMKCgogICAgICBsZXQgcmogPSB2M3Bvb2wuZ2V0KCk7CiAgICAgIGNvbnN0IHNwaGVyZV90b19jb3JuZXIgPSBzcGhlcmVCb3hfc3BoZXJlX3RvX2Nvcm5lcjsKCiAgICAgIGZvciAobGV0IGogPSAwOyBqICE9PSAyICYmICFmb3VuZDsgaisrKSB7CiAgICAgICAgZm9yIChsZXQgayA9IDA7IGsgIT09IDIgJiYgIWZvdW5kOyBrKyspIHsKICAgICAgICAgIGZvciAobGV0IGwgPSAwOyBsICE9PSAyICYmICFmb3VuZDsgbCsrKSB7CiAgICAgICAgICAgIHJqLnNldCgwLCAwLCAwKTsKCiAgICAgICAgICAgIGlmIChqKSB7CiAgICAgICAgICAgICAgcmoudmFkZChzaWRlc1swXSwgcmopOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIHJqLnZzdWIoc2lkZXNbMF0sIHJqKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKGspIHsKICAgICAgICAgICAgICByai52YWRkKHNpZGVzWzFdLCByaik7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgcmoudnN1YihzaWRlc1sxXSwgcmopOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAobCkgewogICAgICAgICAgICAgIHJqLnZhZGQoc2lkZXNbMl0sIHJqKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICByai52c3ViKHNpZGVzWzJdLCByaik7CiAgICAgICAgICAgIH0gLy8gV29ybGQgcG9zaXRpb24gb2YgY29ybmVyCgoKICAgICAgICAgICAgeGoudmFkZChyaiwgc3BoZXJlX3RvX2Nvcm5lcik7CiAgICAgICAgICAgIHNwaGVyZV90b19jb3JuZXIudnN1Yih4aSwgc3BoZXJlX3RvX2Nvcm5lcik7CgogICAgICAgICAgICBpZiAoc3BoZXJlX3RvX2Nvcm5lci5sZW5ndGhTcXVhcmVkKCkgPCBSICogUikgewogICAgICAgICAgICAgIGlmIChqdXN0VGVzdCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICBmb3VuZCA9IHRydWU7CiAgICAgICAgICAgICAgY29uc3QgciA9IHRoaXMuY3JlYXRlQ29udGFjdEVxdWF0aW9uKGJpLCBiaiwgc2ksIHNqLCByc2ksIHJzaik7CiAgICAgICAgICAgICAgci5yaS5jb3B5KHNwaGVyZV90b19jb3JuZXIpOwogICAgICAgICAgICAgIHIucmkubm9ybWFsaXplKCk7CiAgICAgICAgICAgICAgci5uaS5jb3B5KHIucmkpOwogICAgICAgICAgICAgIHIucmkuc2NhbGUoUiwgci5yaSk7CiAgICAgICAgICAgICAgci5yai5jb3B5KHJqKTsgLy8gTWFrZSByZWxhdGl2ZSB0byBib2RpZXMKCiAgICAgICAgICAgICAgci5yaS52YWRkKHhpLCByLnJpKTsKICAgICAgICAgICAgICByLnJpLnZzdWIoYmkucG9zaXRpb24sIHIucmkpOwogICAgICAgICAgICAgIHIucmoudmFkZCh4aiwgci5yaik7CiAgICAgICAgICAgICAgci5yai52c3ViKGJqLnBvc2l0aW9uLCByLnJqKTsKICAgICAgICAgICAgICB0aGlzLnJlc3VsdC5wdXNoKHIpOwogICAgICAgICAgICAgIHRoaXMuY3JlYXRlRnJpY3Rpb25FcXVhdGlvbnNGcm9tQ29udGFjdChyLCB0aGlzLmZyaWN0aW9uUmVzdWx0KTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQoKICAgICAgdjNwb29sLnJlbGVhc2UocmopOwogICAgICByaiA9IG51bGw7IC8vIENoZWNrIGVkZ2VzCgogICAgICBjb25zdCBlZGdlVGFuZ2VudCA9IHYzcG9vbC5nZXQoKTsKICAgICAgY29uc3QgZWRnZUNlbnRlciA9IHYzcG9vbC5nZXQoKTsKICAgICAgY29uc3QgciA9IHYzcG9vbC5nZXQoKTsgLy8gciA9IGVkZ2UgY2VudGVyIHRvIHNwaGVyZSBjZW50ZXIKCiAgICAgIGNvbnN0IG9ydGhvZ29uYWwgPSB2M3Bvb2wuZ2V0KCk7CiAgICAgIGNvbnN0IGRpc3QgPSB2M3Bvb2wuZ2V0KCk7CiAgICAgIGNvbnN0IE5zaWRlcyA9IHNpZGVzLmxlbmd0aDsKCiAgICAgIGZvciAobGV0IGogPSAwOyBqICE9PSBOc2lkZXMgJiYgIWZvdW5kOyBqKyspIHsKICAgICAgICBmb3IgKGxldCBrID0gMDsgayAhPT0gTnNpZGVzICYmICFmb3VuZDsgaysrKSB7CiAgICAgICAgICBpZiAoaiAlIDMgIT09IGsgJSAzKSB7CiAgICAgICAgICAgIC8vIEdldCBlZGdlIHRhbmdlbnQKICAgICAgICAgICAgc2lkZXNba10uY3Jvc3Moc2lkZXNbal0sIGVkZ2VUYW5nZW50KTsKICAgICAgICAgICAgZWRnZVRhbmdlbnQubm9ybWFsaXplKCk7CiAgICAgICAgICAgIHNpZGVzW2pdLnZhZGQoc2lkZXNba10sIGVkZ2VDZW50ZXIpOwogICAgICAgICAgICByLmNvcHkoeGkpOwogICAgICAgICAgICByLnZzdWIoZWRnZUNlbnRlciwgcik7CiAgICAgICAgICAgIHIudnN1Yih4aiwgcik7CiAgICAgICAgICAgIGNvbnN0IG9ydGhvbm9ybSA9IHIuZG90KGVkZ2VUYW5nZW50KTsgLy8gZGlzdGFuY2UgZnJvbSBlZGdlIGNlbnRlciB0byBzcGhlcmUgY2VudGVyIGluIHRoZSB0YW5nZW50IGRpcmVjdGlvbgoKICAgICAgICAgICAgZWRnZVRhbmdlbnQuc2NhbGUob3J0aG9ub3JtLCBvcnRob2dvbmFsKTsgLy8gVmVjdG9yIGZyb20gZWRnZSBjZW50ZXIgdG8gc3BoZXJlIGNlbnRlciBpbiB0aGUgdGFuZ2VudCBkaXJlY3Rpb24KICAgICAgICAgICAgLy8gRmluZCB0aGUgdGhpcmQgc2lkZSBvcnRob2dvbmFsIHRvIHRoaXMgb25lCgogICAgICAgICAgICBsZXQgbCA9IDA7CgogICAgICAgICAgICB3aGlsZSAobCA9PT0gaiAlIDMgfHwgbCA9PT0gayAlIDMpIHsKICAgICAgICAgICAgICBsKys7CiAgICAgICAgICAgIH0gLy8gdmVjIGZyb20gZWRnZSBjZW50ZXIgdG8gc3BoZXJlIHByb2plY3RlZCB0byB0aGUgcGxhbmUgb3J0aG9nb25hbCB0byB0aGUgZWRnZSB0YW5nZW50CgoKICAgICAgICAgICAgZGlzdC5jb3B5KHhpKTsKICAgICAgICAgICAgZGlzdC52c3ViKG9ydGhvZ29uYWwsIGRpc3QpOwogICAgICAgICAgICBkaXN0LnZzdWIoZWRnZUNlbnRlciwgZGlzdCk7CiAgICAgICAgICAgIGRpc3QudnN1Yih4aiwgZGlzdCk7IC8vIERpc3RhbmNlcyBpbiB0YW5nZW50IGRpcmVjdGlvbiBhbmQgZGlzdGFuY2UgaW4gdGhlIHBsYW5lIG9ydGhvZ29uYWwgdG8gaXQKCiAgICAgICAgICAgIGNvbnN0IHRkaXN0ID0gTWF0aC5hYnMob3J0aG9ub3JtKTsKICAgICAgICAgICAgY29uc3QgbmRpc3QgPSBkaXN0Lmxlbmd0aCgpOwoKICAgICAgICAgICAgaWYgKHRkaXN0IDwgc2lkZXNbbF0ubGVuZ3RoKCkgJiYgbmRpc3QgPCBSKSB7CiAgICAgICAgICAgICAgaWYgKGp1c3RUZXN0KSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIGZvdW5kID0gdHJ1ZTsKICAgICAgICAgICAgICBjb25zdCByZXMgPSB0aGlzLmNyZWF0ZUNvbnRhY3RFcXVhdGlvbihiaSwgYmosIHNpLCBzaiwgcnNpLCByc2opOwogICAgICAgICAgICAgIGVkZ2VDZW50ZXIudmFkZChvcnRob2dvbmFsLCByZXMucmopOyAvLyBib3ggcmoKCiAgICAgICAgICAgICAgcmVzLnJqLmNvcHkocmVzLnJqKTsKICAgICAgICAgICAgICBkaXN0Lm5lZ2F0ZShyZXMubmkpOwogICAgICAgICAgICAgIHJlcy5uaS5ub3JtYWxpemUoKTsKICAgICAgICAgICAgICByZXMucmkuY29weShyZXMucmopOwogICAgICAgICAgICAgIHJlcy5yaS52YWRkKHhqLCByZXMucmkpOwogICAgICAgICAgICAgIHJlcy5yaS52c3ViKHhpLCByZXMucmkpOwogICAgICAgICAgICAgIHJlcy5yaS5ub3JtYWxpemUoKTsKICAgICAgICAgICAgICByZXMucmkuc2NhbGUoUiwgcmVzLnJpKTsgLy8gTWFrZSByZWxhdGl2ZSB0byBib2RpZXMKCiAgICAgICAgICAgICAgcmVzLnJpLnZhZGQoeGksIHJlcy5yaSk7CiAgICAgICAgICAgICAgcmVzLnJpLnZzdWIoYmkucG9zaXRpb24sIHJlcy5yaSk7CiAgICAgICAgICAgICAgcmVzLnJqLnZhZGQoeGosIHJlcy5yaik7CiAgICAgICAgICAgICAgcmVzLnJqLnZzdWIoYmoucG9zaXRpb24sIHJlcy5yaik7CiAgICAgICAgICAgICAgdGhpcy5yZXN1bHQucHVzaChyZXMpOwogICAgICAgICAgICAgIHRoaXMuY3JlYXRlRnJpY3Rpb25FcXVhdGlvbnNGcm9tQ29udGFjdChyZXMsIHRoaXMuZnJpY3Rpb25SZXN1bHQpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CgogICAgICB2M3Bvb2wucmVsZWFzZShlZGdlVGFuZ2VudCwgZWRnZUNlbnRlciwgciwgb3J0aG9nb25hbCwgZGlzdCk7CiAgICB9CgogICAgcGxhbmVCb3goc2ksIHNqLCB4aSwgeGosIHFpLCBxaiwgYmksIGJqLCByc2ksIHJzaiwganVzdFRlc3QpIHsKICAgICAgc2ouY29udmV4UG9seWhlZHJvblJlcHJlc2VudGF0aW9uLm1hdGVyaWFsID0gc2oubWF0ZXJpYWw7CiAgICAgIHNqLmNvbnZleFBvbHloZWRyb25SZXByZXNlbnRhdGlvbi5jb2xsaXNpb25SZXNwb25zZSA9IHNqLmNvbGxpc2lvblJlc3BvbnNlOwogICAgICBzai5jb252ZXhQb2x5aGVkcm9uUmVwcmVzZW50YXRpb24uaWQgPSBzai5pZDsKICAgICAgcmV0dXJuIHRoaXMucGxhbmVDb252ZXgoc2ksIHNqLmNvbnZleFBvbHloZWRyb25SZXByZXNlbnRhdGlvbiwgeGksIHhqLCBxaSwgcWosIGJpLCBiaiwgc2ksIHNqLCBqdXN0VGVzdCk7CiAgICB9CgogICAgY29udmV4Q29udmV4KHNpLCBzaiwgeGksIHhqLCBxaSwgcWosIGJpLCBiaiwgcnNpLCByc2osIGp1c3RUZXN0LCBmYWNlTGlzdEEsIGZhY2VMaXN0QikgewogICAgICBjb25zdCBzZXBBeGlzID0gY29udmV4Q29udmV4X3NlcEF4aXM7CgogICAgICBpZiAoeGkuZGlzdGFuY2VUbyh4aikgPiBzaS5ib3VuZGluZ1NwaGVyZVJhZGl1cyArIHNqLmJvdW5kaW5nU3BoZXJlUmFkaXVzKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICBpZiAoc2kuZmluZFNlcGFyYXRpbmdBeGlzKHNqLCB4aSwgcWksIHhqLCBxaiwgc2VwQXhpcywgZmFjZUxpc3RBLCBmYWNlTGlzdEIpKSB7CiAgICAgICAgY29uc3QgcmVzID0gW107CiAgICAgICAgY29uc3QgcSA9IGNvbnZleENvbnZleF9xOwogICAgICAgIHNpLmNsaXBBZ2FpbnN0SHVsbCh4aSwgcWksIHNqLCB4aiwgcWosIHNlcEF4aXMsIC0xMDAsIDEwMCwgcmVzKTsKICAgICAgICBsZXQgbnVtQ29udGFjdHMgPSAwOwoKICAgICAgICBmb3IgKGxldCBqID0gMDsgaiAhPT0gcmVzLmxlbmd0aDsgaisrKSB7CiAgICAgICAgICBpZiAoanVzdFRlc3QpIHsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICB9CgogICAgICAgICAgY29uc3QgciA9IHRoaXMuY3JlYXRlQ29udGFjdEVxdWF0aW9uKGJpLCBiaiwgc2ksIHNqLCByc2ksIHJzaik7CiAgICAgICAgICBjb25zdCByaSA9IHIucmk7CiAgICAgICAgICBjb25zdCByaiA9IHIucmo7CiAgICAgICAgICBzZXBBeGlzLm5lZ2F0ZShyLm5pKTsKICAgICAgICAgIHJlc1tqXS5ub3JtYWwubmVnYXRlKHEpOwogICAgICAgICAgcS5zY2FsZShyZXNbal0uZGVwdGgsIHEpOwogICAgICAgICAgcmVzW2pdLnBvaW50LnZhZGQocSwgcmkpOwogICAgICAgICAgcmouY29weShyZXNbal0ucG9pbnQpOyAvLyBDb250YWN0IHBvaW50cyBhcmUgaW4gd29ybGQgY29vcmRpbmF0ZXMuIFRyYW5zZm9ybSBiYWNrIHRvIHJlbGF0aXZlCgogICAgICAgICAgcmkudnN1Yih4aSwgcmkpOwogICAgICAgICAgcmoudnN1Yih4aiwgcmopOyAvLyBNYWtlIHJlbGF0aXZlIHRvIGJvZGllcwoKICAgICAgICAgIHJpLnZhZGQoeGksIHJpKTsKICAgICAgICAgIHJpLnZzdWIoYmkucG9zaXRpb24sIHJpKTsKICAgICAgICAgIHJqLnZhZGQoeGosIHJqKTsKICAgICAgICAgIHJqLnZzdWIoYmoucG9zaXRpb24sIHJqKTsKICAgICAgICAgIHRoaXMucmVzdWx0LnB1c2gocik7CiAgICAgICAgICBudW1Db250YWN0cysrOwoKICAgICAgICAgIGlmICghdGhpcy5lbmFibGVGcmljdGlvblJlZHVjdGlvbikgewogICAgICAgICAgICB0aGlzLmNyZWF0ZUZyaWN0aW9uRXF1YXRpb25zRnJvbUNvbnRhY3QociwgdGhpcy5mcmljdGlvblJlc3VsdCk7CiAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBpZiAodGhpcy5lbmFibGVGcmljdGlvblJlZHVjdGlvbiAmJiBudW1Db250YWN0cykgewogICAgICAgICAgdGhpcy5jcmVhdGVGcmljdGlvbkZyb21BdmVyYWdlKG51bUNvbnRhY3RzKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KCiAgICBzcGhlcmVDb252ZXgoc2ksIHNqLCB4aSwgeGosIHFpLCBxaiwgYmksIGJqLCByc2ksIHJzaiwganVzdFRlc3QpIHsKICAgICAgY29uc3QgdjNwb29sID0gdGhpcy52M3Bvb2w7CiAgICAgIHhpLnZzdWIoeGosIGNvbnZleF90b19zcGhlcmUpOwogICAgICBjb25zdCBub3JtYWxzID0gc2ouZmFjZU5vcm1hbHM7CiAgICAgIGNvbnN0IGZhY2VzID0gc2ouZmFjZXM7CiAgICAgIGNvbnN0IHZlcnRzID0gc2oudmVydGljZXM7CiAgICAgIGNvbnN0IFIgPSBzaS5yYWRpdXM7CiAgICAgIC8vICAgICByZXR1cm47CiAgICAgIC8vIH0KCiAgICAgIGxldCBmb3VuZCA9IGZhbHNlOyAvLyBDaGVjayBjb3JuZXJzCgogICAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gdmVydHMubGVuZ3RoOyBpKyspIHsKICAgICAgICBjb25zdCB2ID0gdmVydHNbaV07IC8vIFdvcmxkIHBvc2l0aW9uIG9mIGNvcm5lcgoKICAgICAgICBjb25zdCB3b3JsZENvcm5lciA9IHNwaGVyZUNvbnZleF93b3JsZENvcm5lcjsKICAgICAgICBxai52bXVsdCh2LCB3b3JsZENvcm5lcik7CiAgICAgICAgeGoudmFkZCh3b3JsZENvcm5lciwgd29ybGRDb3JuZXIpOwogICAgICAgIGNvbnN0IHNwaGVyZV90b19jb3JuZXIgPSBzcGhlcmVDb252ZXhfc3BoZXJlVG9Db3JuZXI7CiAgICAgICAgd29ybGRDb3JuZXIudnN1Yih4aSwgc3BoZXJlX3RvX2Nvcm5lcik7CgogICAgICAgIGlmIChzcGhlcmVfdG9fY29ybmVyLmxlbmd0aFNxdWFyZWQoKSA8IFIgKiBSKSB7CiAgICAgICAgICBpZiAoanVzdFRlc3QpIHsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICB9CgogICAgICAgICAgZm91bmQgPSB0cnVlOwogICAgICAgICAgY29uc3QgciA9IHRoaXMuY3JlYXRlQ29udGFjdEVxdWF0aW9uKGJpLCBiaiwgc2ksIHNqLCByc2ksIHJzaik7CiAgICAgICAgICByLnJpLmNvcHkoc3BoZXJlX3RvX2Nvcm5lcik7CiAgICAgICAgICByLnJpLm5vcm1hbGl6ZSgpOwogICAgICAgICAgci5uaS5jb3B5KHIucmkpOwogICAgICAgICAgci5yaS5zY2FsZShSLCByLnJpKTsKICAgICAgICAgIHdvcmxkQ29ybmVyLnZzdWIoeGosIHIucmopOyAvLyBTaG91bGQgYmUgcmVsYXRpdmUgdG8gdGhlIGJvZHkuCgogICAgICAgICAgci5yaS52YWRkKHhpLCByLnJpKTsKICAgICAgICAgIHIucmkudnN1YihiaS5wb3NpdGlvbiwgci5yaSk7IC8vIFNob3VsZCBiZSByZWxhdGl2ZSB0byB0aGUgYm9keS4KCiAgICAgICAgICByLnJqLnZhZGQoeGosIHIucmopOwogICAgICAgICAgci5yai52c3ViKGJqLnBvc2l0aW9uLCByLnJqKTsKICAgICAgICAgIHRoaXMucmVzdWx0LnB1c2gocik7CiAgICAgICAgICB0aGlzLmNyZWF0ZUZyaWN0aW9uRXF1YXRpb25zRnJvbUNvbnRhY3QociwgdGhpcy5mcmljdGlvblJlc3VsdCk7CiAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICB9IC8vIENoZWNrIHNpZGUgKHBsYW5lKSBpbnRlcnNlY3Rpb25zCgoKICAgICAgZm9yIChsZXQgaSA9IDAsIG5mYWNlcyA9IGZhY2VzLmxlbmd0aDsgaSAhPT0gbmZhY2VzICYmIGZvdW5kID09PSBmYWxzZTsgaSsrKSB7CiAgICAgICAgY29uc3Qgbm9ybWFsID0gbm9ybWFsc1tpXTsKICAgICAgICBjb25zdCBmYWNlID0gZmFjZXNbaV07IC8vIEdldCB3b3JsZC10cmFuc2Zvcm1lZCBub3JtYWwgb2YgdGhlIGZhY2UKCiAgICAgICAgY29uc3Qgd29ybGROb3JtYWwgPSBzcGhlcmVDb252ZXhfd29ybGROb3JtYWw7CiAgICAgICAgcWoudm11bHQobm9ybWFsLCB3b3JsZE5vcm1hbCk7IC8vIEdldCBhIHdvcmxkIHZlcnRleCBmcm9tIHRoZSBmYWNlCgogICAgICAgIGNvbnN0IHdvcmxkUG9pbnQgPSBzcGhlcmVDb252ZXhfd29ybGRQb2ludDsKICAgICAgICBxai52bXVsdCh2ZXJ0c1tmYWNlWzBdXSwgd29ybGRQb2ludCk7CiAgICAgICAgd29ybGRQb2ludC52YWRkKHhqLCB3b3JsZFBvaW50KTsgLy8gR2V0IGEgcG9pbnQgb24gdGhlIHNwaGVyZSwgY2xvc2VzdCB0byB0aGUgZmFjZSBub3JtYWwKCiAgICAgICAgY29uc3Qgd29ybGRTcGhlcmVQb2ludENsb3Nlc3RUb1BsYW5lID0gc3BoZXJlQ29udmV4X3dvcmxkU3BoZXJlUG9pbnRDbG9zZXN0VG9QbGFuZTsKICAgICAgICB3b3JsZE5vcm1hbC5zY2FsZSgtUiwgd29ybGRTcGhlcmVQb2ludENsb3Nlc3RUb1BsYW5lKTsKICAgICAgICB4aS52YWRkKHdvcmxkU3BoZXJlUG9pbnRDbG9zZXN0VG9QbGFuZSwgd29ybGRTcGhlcmVQb2ludENsb3Nlc3RUb1BsYW5lKTsgLy8gVmVjdG9yIGZyb20gYSBmYWNlIHBvaW50IHRvIHRoZSBjbG9zZXN0IHBvaW50IG9uIHRoZSBzcGhlcmUKCiAgICAgICAgY29uc3QgcGVuZXRyYXRpb25WZWMgPSBzcGhlcmVDb252ZXhfcGVuZXRyYXRpb25WZWM7CiAgICAgICAgd29ybGRTcGhlcmVQb2ludENsb3Nlc3RUb1BsYW5lLnZzdWIod29ybGRQb2ludCwgcGVuZXRyYXRpb25WZWMpOyAvLyBUaGUgcGVuZXRyYXRpb24uIE5lZ2F0aXZlIHZhbHVlIG1lYW5zIG92ZXJsYXAuCgogICAgICAgIGNvbnN0IHBlbmV0cmF0aW9uID0gcGVuZXRyYXRpb25WZWMuZG90KHdvcmxkTm9ybWFsKTsKICAgICAgICBjb25zdCB3b3JsZFBvaW50VG9TcGhlcmUgPSBzcGhlcmVDb252ZXhfc3BoZXJlVG9Xb3JsZFBvaW50OwogICAgICAgIHhpLnZzdWIod29ybGRQb2ludCwgd29ybGRQb2ludFRvU3BoZXJlKTsKCiAgICAgICAgaWYgKHBlbmV0cmF0aW9uIDwgMCAmJiB3b3JsZFBvaW50VG9TcGhlcmUuZG90KHdvcmxkTm9ybWFsKSA+IDApIHsKICAgICAgICAgIC8vIEludGVyc2VjdHMgcGxhbmUuIE5vdyBjaGVjayBpZiB0aGUgc3BoZXJlIGlzIGluc2lkZSB0aGUgZmFjZSBwb2x5Z29uCiAgICAgICAgICBjb25zdCBmYWNlVmVydHMgPSBbXTsgLy8gRmFjZSB2ZXJ0aWNlcywgaW4gd29ybGQgY29vcmRzCgogICAgICAgICAgZm9yIChsZXQgaiA9IDAsIE52ZXJ0cyA9IGZhY2UubGVuZ3RoOyBqICE9PSBOdmVydHM7IGorKykgewogICAgICAgICAgICBjb25zdCB3b3JsZFZlcnRleCA9IHYzcG9vbC5nZXQoKTsKICAgICAgICAgICAgcWoudm11bHQodmVydHNbZmFjZVtqXV0sIHdvcmxkVmVydGV4KTsKICAgICAgICAgICAgeGoudmFkZCh3b3JsZFZlcnRleCwgd29ybGRWZXJ0ZXgpOwogICAgICAgICAgICBmYWNlVmVydHMucHVzaCh3b3JsZFZlcnRleCk7CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKHBvaW50SW5Qb2x5Z29uKGZhY2VWZXJ0cywgd29ybGROb3JtYWwsIHhpKSkgewogICAgICAgICAgICAvLyBJcyB0aGUgc3BoZXJlIGNlbnRlciBpbiB0aGUgZmFjZSBwb2x5Z29uPwogICAgICAgICAgICBpZiAoanVzdFRlc3QpIHsKICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgZm91bmQgPSB0cnVlOwogICAgICAgICAgICBjb25zdCByID0gdGhpcy5jcmVhdGVDb250YWN0RXF1YXRpb24oYmksIGJqLCBzaSwgc2osIHJzaSwgcnNqKTsKICAgICAgICAgICAgd29ybGROb3JtYWwuc2NhbGUoLVIsIHIucmkpOyAvLyBDb250YWN0IG9mZnNldCwgZnJvbSBzcGhlcmUgY2VudGVyIHRvIGNvbnRhY3QKCiAgICAgICAgICAgIHdvcmxkTm9ybWFsLm5lZ2F0ZShyLm5pKTsgLy8gTm9ybWFsIHBvaW50aW5nIG91dCBvZiBzcGhlcmUKCiAgICAgICAgICAgIGNvbnN0IHBlbmV0cmF0aW9uVmVjMiA9IHYzcG9vbC5nZXQoKTsKICAgICAgICAgICAgd29ybGROb3JtYWwuc2NhbGUoLXBlbmV0cmF0aW9uLCBwZW5ldHJhdGlvblZlYzIpOwogICAgICAgICAgICBjb25zdCBwZW5ldHJhdGlvblNwaGVyZVBvaW50ID0gdjNwb29sLmdldCgpOwogICAgICAgICAgICB3b3JsZE5vcm1hbC5zY2FsZSgtUiwgcGVuZXRyYXRpb25TcGhlcmVQb2ludCk7IC8veGkudnN1Yih4aikudmFkZChwZW5ldHJhdGlvblNwaGVyZVBvaW50KS52YWRkKHBlbmV0cmF0aW9uVmVjMiAsIHIucmopOwoKICAgICAgICAgICAgeGkudnN1Yih4aiwgci5yaik7CiAgICAgICAgICAgIHIucmoudmFkZChwZW5ldHJhdGlvblNwaGVyZVBvaW50LCByLnJqKTsKICAgICAgICAgICAgci5yai52YWRkKHBlbmV0cmF0aW9uVmVjMiwgci5yaik7IC8vIFNob3VsZCBiZSByZWxhdGl2ZSB0byB0aGUgYm9keS4KCiAgICAgICAgICAgIHIucmoudmFkZCh4aiwgci5yaik7CiAgICAgICAgICAgIHIucmoudnN1Yihiai5wb3NpdGlvbiwgci5yaik7IC8vIFNob3VsZCBiZSByZWxhdGl2ZSB0byB0aGUgYm9keS4KCiAgICAgICAgICAgIHIucmkudmFkZCh4aSwgci5yaSk7CiAgICAgICAgICAgIHIucmkudnN1YihiaS5wb3NpdGlvbiwgci5yaSk7CiAgICAgICAgICAgIHYzcG9vbC5yZWxlYXNlKHBlbmV0cmF0aW9uVmVjMik7CiAgICAgICAgICAgIHYzcG9vbC5yZWxlYXNlKHBlbmV0cmF0aW9uU3BoZXJlUG9pbnQpOwogICAgICAgICAgICB0aGlzLnJlc3VsdC5wdXNoKHIpOwogICAgICAgICAgICB0aGlzLmNyZWF0ZUZyaWN0aW9uRXF1YXRpb25zRnJvbUNvbnRhY3QociwgdGhpcy5mcmljdGlvblJlc3VsdCk7IC8vIFJlbGVhc2Ugd29ybGQgdmVydGljZXMKCiAgICAgICAgICAgIGZvciAobGV0IGogPSAwLCBOZmFjZXZlcnRzID0gZmFjZVZlcnRzLmxlbmd0aDsgaiAhPT0gTmZhY2V2ZXJ0czsgaisrKSB7CiAgICAgICAgICAgICAgdjNwb29sLnJlbGVhc2UoZmFjZVZlcnRzW2pdKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgcmV0dXJuOyAvLyBXZSBvbmx5IGV4cGVjdCAqb25lKiBmYWNlIGNvbnRhY3QKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIC8vIEVkZ2U/CiAgICAgICAgICAgIGZvciAobGV0IGogPSAwOyBqICE9PSBmYWNlLmxlbmd0aDsgaisrKSB7CiAgICAgICAgICAgICAgLy8gR2V0IHR3byB3b3JsZCB0cmFuc2Zvcm1lZCB2ZXJ0aWNlcwogICAgICAgICAgICAgIGNvbnN0IHYxID0gdjNwb29sLmdldCgpOwogICAgICAgICAgICAgIGNvbnN0IHYyID0gdjNwb29sLmdldCgpOwogICAgICAgICAgICAgIHFqLnZtdWx0KHZlcnRzW2ZhY2VbKGogKyAxKSAlIGZhY2UubGVuZ3RoXV0sIHYxKTsKICAgICAgICAgICAgICBxai52bXVsdCh2ZXJ0c1tmYWNlWyhqICsgMikgJSBmYWNlLmxlbmd0aF1dLCB2Mik7CiAgICAgICAgICAgICAgeGoudmFkZCh2MSwgdjEpOwogICAgICAgICAgICAgIHhqLnZhZGQodjIsIHYyKTsgLy8gQ29uc3RydWN0IGVkZ2UgdmVjdG9yCgogICAgICAgICAgICAgIGNvbnN0IGVkZ2UgPSBzcGhlcmVDb252ZXhfZWRnZTsKICAgICAgICAgICAgICB2Mi52c3ViKHYxLCBlZGdlKTsgLy8gQ29uc3RydWN0IHRoZSBzYW1lIHZlY3RvciwgYnV0IG5vcm1hbGl6ZWQKCiAgICAgICAgICAgICAgY29uc3QgZWRnZVVuaXQgPSBzcGhlcmVDb252ZXhfZWRnZVVuaXQ7CiAgICAgICAgICAgICAgZWRnZS51bml0KGVkZ2VVbml0KTsgLy8gcCBpcyB4aSBwcm9qZWN0ZWQgb250byB0aGUgZWRnZQoKICAgICAgICAgICAgICBjb25zdCBwID0gdjNwb29sLmdldCgpOwogICAgICAgICAgICAgIGNvbnN0IHYxX3RvX3hpID0gdjNwb29sLmdldCgpOwogICAgICAgICAgICAgIHhpLnZzdWIodjEsIHYxX3RvX3hpKTsKICAgICAgICAgICAgICBjb25zdCBkb3QgPSB2MV90b194aS5kb3QoZWRnZVVuaXQpOwogICAgICAgICAgICAgIGVkZ2VVbml0LnNjYWxlKGRvdCwgcCk7CiAgICAgICAgICAgICAgcC52YWRkKHYxLCBwKTsgLy8gQ29tcHV0ZSBhIHZlY3RvciBmcm9tIHAgdG8gdGhlIGNlbnRlciBvZiB0aGUgc3BoZXJlCgogICAgICAgICAgICAgIGNvbnN0IHhpX3RvX3AgPSB2M3Bvb2wuZ2V0KCk7CiAgICAgICAgICAgICAgcC52c3ViKHhpLCB4aV90b19wKTsgLy8gQ29sbGlzaW9uIGlmIHRoZSBlZGdlLXNwaGVyZSBkaXN0YW5jZSBpcyBsZXNzIHRoYW4gdGhlIHJhZGl1cwogICAgICAgICAgICAgIC8vIEFORCBpZiBwIGlzIGluIGJldHdlZW4gdjEgYW5kIHYyCgogICAgICAgICAgICAgIGlmIChkb3QgPiAwICYmIGRvdCAqIGRvdCA8IGVkZ2UubGVuZ3RoU3F1YXJlZCgpICYmIHhpX3RvX3AubGVuZ3RoU3F1YXJlZCgpIDwgUiAqIFIpIHsKICAgICAgICAgICAgICAgIC8vIENvbGxpc2lvbiBpZiB0aGUgZWRnZS1zcGhlcmUgZGlzdGFuY2UgaXMgbGVzcyB0aGFuIHRoZSByYWRpdXMKICAgICAgICAgICAgICAgIC8vIEVkZ2UgY29udGFjdCEKICAgICAgICAgICAgICAgIGlmIChqdXN0VGVzdCkgewogICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBjb25zdCByID0gdGhpcy5jcmVhdGVDb250YWN0RXF1YXRpb24oYmksIGJqLCBzaSwgc2osIHJzaSwgcnNqKTsKICAgICAgICAgICAgICAgIHAudnN1Yih4aiwgci5yaik7CiAgICAgICAgICAgICAgICBwLnZzdWIoeGksIHIubmkpOwogICAgICAgICAgICAgICAgci5uaS5ub3JtYWxpemUoKTsKICAgICAgICAgICAgICAgIHIubmkuc2NhbGUoUiwgci5yaSk7IC8vIFNob3VsZCBiZSByZWxhdGl2ZSB0byB0aGUgYm9keS4KCiAgICAgICAgICAgICAgICByLnJqLnZhZGQoeGosIHIucmopOwogICAgICAgICAgICAgICAgci5yai52c3ViKGJqLnBvc2l0aW9uLCByLnJqKTsgLy8gU2hvdWxkIGJlIHJlbGF0aXZlIHRvIHRoZSBib2R5LgoKICAgICAgICAgICAgICAgIHIucmkudmFkZCh4aSwgci5yaSk7CiAgICAgICAgICAgICAgICByLnJpLnZzdWIoYmkucG9zaXRpb24sIHIucmkpOwogICAgICAgICAgICAgICAgdGhpcy5yZXN1bHQucHVzaChyKTsKICAgICAgICAgICAgICAgIHRoaXMuY3JlYXRlRnJpY3Rpb25FcXVhdGlvbnNGcm9tQ29udGFjdChyLCB0aGlzLmZyaWN0aW9uUmVzdWx0KTsgLy8gUmVsZWFzZSB3b3JsZCB2ZXJ0aWNlcwoKICAgICAgICAgICAgICAgIGZvciAobGV0IGogPSAwLCBOZmFjZXZlcnRzID0gZmFjZVZlcnRzLmxlbmd0aDsgaiAhPT0gTmZhY2V2ZXJ0czsgaisrKSB7CiAgICAgICAgICAgICAgICAgIHYzcG9vbC5yZWxlYXNlKGZhY2VWZXJ0c1tqXSk7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgdjNwb29sLnJlbGVhc2UodjEpOwogICAgICAgICAgICAgICAgdjNwb29sLnJlbGVhc2UodjIpOwogICAgICAgICAgICAgICAgdjNwb29sLnJlbGVhc2UocCk7CiAgICAgICAgICAgICAgICB2M3Bvb2wucmVsZWFzZSh4aV90b19wKTsKICAgICAgICAgICAgICAgIHYzcG9vbC5yZWxlYXNlKHYxX3RvX3hpKTsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIHYzcG9vbC5yZWxlYXNlKHYxKTsKICAgICAgICAgICAgICB2M3Bvb2wucmVsZWFzZSh2Mik7CiAgICAgICAgICAgICAgdjNwb29sLnJlbGVhc2UocCk7CiAgICAgICAgICAgICAgdjNwb29sLnJlbGVhc2UoeGlfdG9fcCk7CiAgICAgICAgICAgICAgdjNwb29sLnJlbGVhc2UodjFfdG9feGkpOwogICAgICAgICAgICB9CiAgICAgICAgICB9IC8vIFJlbGVhc2Ugd29ybGQgdmVydGljZXMKCgogICAgICAgICAgZm9yIChsZXQgaiA9IDAsIE5mYWNldmVydHMgPSBmYWNlVmVydHMubGVuZ3RoOyBqICE9PSBOZmFjZXZlcnRzOyBqKyspIHsKICAgICAgICAgICAgdjNwb29sLnJlbGVhc2UoZmFjZVZlcnRzW2pdKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgIH0KCiAgICBwbGFuZUNvbnZleChwbGFuZVNoYXBlLCBjb252ZXhTaGFwZSwgcGxhbmVQb3NpdGlvbiwgY29udmV4UG9zaXRpb24sIHBsYW5lUXVhdCwgY29udmV4UXVhdCwgcGxhbmVCb2R5LCBjb252ZXhCb2R5LCBzaSwgc2osIGp1c3RUZXN0KSB7CiAgICAgIC8vIFNpbXBseSByZXR1cm4gdGhlIHBvaW50cyBiZWhpbmQgdGhlIHBsYW5lLgogICAgICBjb25zdCB3b3JsZFZlcnRleCA9IHBsYW5lQ29udmV4X3Y7CiAgICAgIGNvbnN0IHdvcmxkTm9ybWFsID0gcGxhbmVDb252ZXhfbm9ybWFsOwogICAgICB3b3JsZE5vcm1hbC5zZXQoMCwgMCwgMSk7CiAgICAgIHBsYW5lUXVhdC52bXVsdCh3b3JsZE5vcm1hbCwgd29ybGROb3JtYWwpOyAvLyBUdXJuIG5vcm1hbCBhY2NvcmRpbmcgdG8gcGxhbmUgb3JpZW50YXRpb24KCiAgICAgIGxldCBudW1Db250YWN0cyA9IDA7CiAgICAgIGNvbnN0IHJlbHBvcyA9IHBsYW5lQ29udmV4X3JlbHBvczsKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpICE9PSBjb252ZXhTaGFwZS52ZXJ0aWNlcy5sZW5ndGg7IGkrKykgewogICAgICAgIC8vIEdldCB3b3JsZCBjb252ZXggdmVydGV4CiAgICAgICAgd29ybGRWZXJ0ZXguY29weShjb252ZXhTaGFwZS52ZXJ0aWNlc1tpXSk7CiAgICAgICAgY29udmV4UXVhdC52bXVsdCh3b3JsZFZlcnRleCwgd29ybGRWZXJ0ZXgpOwogICAgICAgIGNvbnZleFBvc2l0aW9uLnZhZGQod29ybGRWZXJ0ZXgsIHdvcmxkVmVydGV4KTsKICAgICAgICB3b3JsZFZlcnRleC52c3ViKHBsYW5lUG9zaXRpb24sIHJlbHBvcyk7CiAgICAgICAgY29uc3QgZG90ID0gd29ybGROb3JtYWwuZG90KHJlbHBvcyk7CgogICAgICAgIGlmIChkb3QgPD0gMC4wKSB7CiAgICAgICAgICBpZiAoanVzdFRlc3QpIHsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICB9CgogICAgICAgICAgY29uc3QgciA9IHRoaXMuY3JlYXRlQ29udGFjdEVxdWF0aW9uKHBsYW5lQm9keSwgY29udmV4Qm9keSwgcGxhbmVTaGFwZSwgY29udmV4U2hhcGUsIHNpLCBzaik7IC8vIEdldCB2ZXJ0ZXggcG9zaXRpb24gcHJvamVjdGVkIG9uIHBsYW5lCgogICAgICAgICAgY29uc3QgcHJvamVjdGVkID0gcGxhbmVDb252ZXhfcHJvamVjdGVkOwogICAgICAgICAgd29ybGROb3JtYWwuc2NhbGUod29ybGROb3JtYWwuZG90KHJlbHBvcyksIHByb2plY3RlZCk7CiAgICAgICAgICB3b3JsZFZlcnRleC52c3ViKHByb2plY3RlZCwgcHJvamVjdGVkKTsKICAgICAgICAgIHByb2plY3RlZC52c3ViKHBsYW5lUG9zaXRpb24sIHIucmkpOyAvLyBGcm9tIHBsYW5lIHRvIHZlcnRleCBwcm9qZWN0ZWQgb24gcGxhbmUKCiAgICAgICAgICByLm5pLmNvcHkod29ybGROb3JtYWwpOyAvLyBDb250YWN0IG5vcm1hbCBpcyB0aGUgcGxhbmUgbm9ybWFsIG91dCBmcm9tIHBsYW5lCiAgICAgICAgICAvLyByaiBpcyBub3cganVzdCB0aGUgdmVjdG9yIGZyb20gdGhlIGNvbnZleCBjZW50ZXIgdG8gdGhlIHZlcnRleAoKICAgICAgICAgIHdvcmxkVmVydGV4LnZzdWIoY29udmV4UG9zaXRpb24sIHIucmopOyAvLyBNYWtlIGl0IHJlbGF0aXZlIHRvIHRoZSBib2R5CgogICAgICAgICAgci5yaS52YWRkKHBsYW5lUG9zaXRpb24sIHIucmkpOwogICAgICAgICAgci5yaS52c3ViKHBsYW5lQm9keS5wb3NpdGlvbiwgci5yaSk7CiAgICAgICAgICByLnJqLnZhZGQoY29udmV4UG9zaXRpb24sIHIucmopOwogICAgICAgICAgci5yai52c3ViKGNvbnZleEJvZHkucG9zaXRpb24sIHIucmopOwogICAgICAgICAgdGhpcy5yZXN1bHQucHVzaChyKTsKICAgICAgICAgIG51bUNvbnRhY3RzKys7CgogICAgICAgICAgaWYgKCF0aGlzLmVuYWJsZUZyaWN0aW9uUmVkdWN0aW9uKSB7CiAgICAgICAgICAgIHRoaXMuY3JlYXRlRnJpY3Rpb25FcXVhdGlvbnNGcm9tQ29udGFjdChyLCB0aGlzLmZyaWN0aW9uUmVzdWx0KTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KCiAgICAgIGlmICh0aGlzLmVuYWJsZUZyaWN0aW9uUmVkdWN0aW9uICYmIG51bUNvbnRhY3RzKSB7CiAgICAgICAgdGhpcy5jcmVhdGVGcmljdGlvbkZyb21BdmVyYWdlKG51bUNvbnRhY3RzKTsKICAgICAgfQogICAgfQoKICAgIGJveENvbnZleChzaSwgc2osIHhpLCB4aiwgcWksIHFqLCBiaSwgYmosIHJzaSwgcnNqLCBqdXN0VGVzdCkgewogICAgICBzaS5jb252ZXhQb2x5aGVkcm9uUmVwcmVzZW50YXRpb24ubWF0ZXJpYWwgPSBzaS5tYXRlcmlhbDsKICAgICAgc2kuY29udmV4UG9seWhlZHJvblJlcHJlc2VudGF0aW9uLmNvbGxpc2lvblJlc3BvbnNlID0gc2kuY29sbGlzaW9uUmVzcG9uc2U7CiAgICAgIHJldHVybiB0aGlzLmNvbnZleENvbnZleChzaS5jb252ZXhQb2x5aGVkcm9uUmVwcmVzZW50YXRpb24sIHNqLCB4aSwgeGosIHFpLCBxaiwgYmksIGJqLCBzaSwgc2osIGp1c3RUZXN0KTsKICAgIH0KCiAgICBzcGhlcmVIZWlnaHRmaWVsZChzcGhlcmVTaGFwZSwgaGZTaGFwZSwgc3BoZXJlUG9zLCBoZlBvcywgc3BoZXJlUXVhdCwgaGZRdWF0LCBzcGhlcmVCb2R5LCBoZkJvZHksIHJzaSwgcnNqLCBqdXN0VGVzdCkgewogICAgICBjb25zdCBkYXRhID0gaGZTaGFwZS5kYXRhOwogICAgICBjb25zdCByYWRpdXMgPSBzcGhlcmVTaGFwZS5yYWRpdXM7CiAgICAgIGNvbnN0IHcgPSBoZlNoYXBlLmVsZW1lbnRTaXplOwogICAgICBjb25zdCB3b3JsZFBpbGxhck9mZnNldCA9IHNwaGVyZUhlaWdodGZpZWxkX3RtcDI7IC8vIEdldCBzcGhlcmUgcG9zaXRpb24gdG8gaGVpZ2h0ZmllbGQgbG9jYWwhCgogICAgICBjb25zdCBsb2NhbFNwaGVyZVBvcyA9IHNwaGVyZUhlaWdodGZpZWxkX3RtcDE7CiAgICAgIFRyYW5zZm9ybS5wb2ludFRvTG9jYWxGcmFtZShoZlBvcywgaGZRdWF0LCBzcGhlcmVQb3MsIGxvY2FsU3BoZXJlUG9zKTsgLy8gR2V0IHRoZSBpbmRleCBvZiB0aGUgZGF0YSBwb2ludHMgdG8gdGVzdCBhZ2FpbnN0CgogICAgICBsZXQgaU1pblggPSBNYXRoLmZsb29yKChsb2NhbFNwaGVyZVBvcy54IC0gcmFkaXVzKSAvIHcpIC0gMTsKICAgICAgbGV0IGlNYXhYID0gTWF0aC5jZWlsKChsb2NhbFNwaGVyZVBvcy54ICsgcmFkaXVzKSAvIHcpICsgMTsKICAgICAgbGV0IGlNaW5ZID0gTWF0aC5mbG9vcigobG9jYWxTcGhlcmVQb3MueSAtIHJhZGl1cykgLyB3KSAtIDE7CiAgICAgIGxldCBpTWF4WSA9IE1hdGguY2VpbCgobG9jYWxTcGhlcmVQb3MueSArIHJhZGl1cykgLyB3KSArIDE7IC8vIEJhaWwgb3V0IGlmIHdlIGFyZSBvdXQgb2YgdGhlIHRlcnJhaW4KCiAgICAgIGlmIChpTWF4WCA8IDAgfHwgaU1heFkgPCAwIHx8IGlNaW5YID4gZGF0YS5sZW5ndGggfHwgaU1pblkgPiBkYXRhWzBdLmxlbmd0aCkgewogICAgICAgIHJldHVybjsKICAgICAgfSAvLyBDbGFtcCBpbmRleCB0byBlZGdlcwoKCiAgICAgIGlmIChpTWluWCA8IDApIHsKICAgICAgICBpTWluWCA9IDA7CiAgICAgIH0KCiAgICAgIGlmIChpTWF4WCA8IDApIHsKICAgICAgICBpTWF4WCA9IDA7CiAgICAgIH0KCiAgICAgIGlmIChpTWluWSA8IDApIHsKICAgICAgICBpTWluWSA9IDA7CiAgICAgIH0KCiAgICAgIGlmIChpTWF4WSA8IDApIHsKICAgICAgICBpTWF4WSA9IDA7CiAgICAgIH0KCiAgICAgIGlmIChpTWluWCA+PSBkYXRhLmxlbmd0aCkgewogICAgICAgIGlNaW5YID0gZGF0YS5sZW5ndGggLSAxOwogICAgICB9CgogICAgICBpZiAoaU1heFggPj0gZGF0YS5sZW5ndGgpIHsKICAgICAgICBpTWF4WCA9IGRhdGEubGVuZ3RoIC0gMTsKICAgICAgfQoKICAgICAgaWYgKGlNYXhZID49IGRhdGFbMF0ubGVuZ3RoKSB7CiAgICAgICAgaU1heFkgPSBkYXRhWzBdLmxlbmd0aCAtIDE7CiAgICAgIH0KCiAgICAgIGlmIChpTWluWSA+PSBkYXRhWzBdLmxlbmd0aCkgewogICAgICAgIGlNaW5ZID0gZGF0YVswXS5sZW5ndGggLSAxOwogICAgICB9CgogICAgICBjb25zdCBtaW5NYXggPSBbXTsKICAgICAgaGZTaGFwZS5nZXRSZWN0TWluTWF4KGlNaW5YLCBpTWluWSwgaU1heFgsIGlNYXhZLCBtaW5NYXgpOwogICAgICBjb25zdCBtaW4gPSBtaW5NYXhbMF07CiAgICAgIGNvbnN0IG1heCA9IG1pbk1heFsxXTsgLy8gQmFpbCBvdXQgaWYgd2UgY2FuJ3QgdG91Y2ggdGhlIGJvdW5kaW5nIGhlaWdodCBib3gKCiAgICAgIGlmIChsb2NhbFNwaGVyZVBvcy56IC0gcmFkaXVzID4gbWF4IHx8IGxvY2FsU3BoZXJlUG9zLnogKyByYWRpdXMgPCBtaW4pIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIGNvbnN0IHJlc3VsdCA9IHRoaXMucmVzdWx0OwoKICAgICAgZm9yIChsZXQgaSA9IGlNaW5YOyBpIDwgaU1heFg7IGkrKykgewogICAgICAgIGZvciAobGV0IGogPSBpTWluWTsgaiA8IGlNYXhZOyBqKyspIHsKICAgICAgICAgIGNvbnN0IG51bUNvbnRhY3RzQmVmb3JlID0gcmVzdWx0Lmxlbmd0aDsKICAgICAgICAgIGxldCBpbnRlcnNlY3RpbmcgPSBmYWxzZTsgLy8gTG93ZXIgdHJpYW5nbGUKCiAgICAgICAgICBoZlNoYXBlLmdldENvbnZleFRyaWFuZ2xlUGlsbGFyKGksIGosIGZhbHNlKTsKICAgICAgICAgIFRyYW5zZm9ybS5wb2ludFRvV29ybGRGcmFtZShoZlBvcywgaGZRdWF0LCBoZlNoYXBlLnBpbGxhck9mZnNldCwgd29ybGRQaWxsYXJPZmZzZXQpOwoKICAgICAgICAgIGlmIChzcGhlcmVQb3MuZGlzdGFuY2VUbyh3b3JsZFBpbGxhck9mZnNldCkgPCBoZlNoYXBlLnBpbGxhckNvbnZleC5ib3VuZGluZ1NwaGVyZVJhZGl1cyArIHNwaGVyZVNoYXBlLmJvdW5kaW5nU3BoZXJlUmFkaXVzKSB7CiAgICAgICAgICAgIGludGVyc2VjdGluZyA9IHRoaXMuc3BoZXJlQ29udmV4KHNwaGVyZVNoYXBlLCBoZlNoYXBlLnBpbGxhckNvbnZleCwgc3BoZXJlUG9zLCB3b3JsZFBpbGxhck9mZnNldCwgc3BoZXJlUXVhdCwgaGZRdWF0LCBzcGhlcmVCb2R5LCBoZkJvZHksIHNwaGVyZVNoYXBlLCBoZlNoYXBlLCBqdXN0VGVzdCk7CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKGp1c3RUZXN0ICYmIGludGVyc2VjdGluZykgewogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgIH0gLy8gVXBwZXIgdHJpYW5nbGUKCgogICAgICAgICAgaGZTaGFwZS5nZXRDb252ZXhUcmlhbmdsZVBpbGxhcihpLCBqLCB0cnVlKTsKICAgICAgICAgIFRyYW5zZm9ybS5wb2ludFRvV29ybGRGcmFtZShoZlBvcywgaGZRdWF0LCBoZlNoYXBlLnBpbGxhck9mZnNldCwgd29ybGRQaWxsYXJPZmZzZXQpOwoKICAgICAgICAgIGlmIChzcGhlcmVQb3MuZGlzdGFuY2VUbyh3b3JsZFBpbGxhck9mZnNldCkgPCBoZlNoYXBlLnBpbGxhckNvbnZleC5ib3VuZGluZ1NwaGVyZVJhZGl1cyArIHNwaGVyZVNoYXBlLmJvdW5kaW5nU3BoZXJlUmFkaXVzKSB7CiAgICAgICAgICAgIGludGVyc2VjdGluZyA9IHRoaXMuc3BoZXJlQ29udmV4KHNwaGVyZVNoYXBlLCBoZlNoYXBlLnBpbGxhckNvbnZleCwgc3BoZXJlUG9zLCB3b3JsZFBpbGxhck9mZnNldCwgc3BoZXJlUXVhdCwgaGZRdWF0LCBzcGhlcmVCb2R5LCBoZkJvZHksIHNwaGVyZVNoYXBlLCBoZlNoYXBlLCBqdXN0VGVzdCk7CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKGp1c3RUZXN0ICYmIGludGVyc2VjdGluZykgewogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgIH0KCiAgICAgICAgICBjb25zdCBudW1Db250YWN0cyA9IHJlc3VsdC5sZW5ndGggLSBudW1Db250YWN0c0JlZm9yZTsKCiAgICAgICAgICBpZiAobnVtQ29udGFjdHMgPiAyKSB7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgIH0KICAgICAgICAgIC8qCiAgICAgICAgICAgIC8vIFNraXAgYWxsIGJ1dCAxCiAgICAgICAgICAgIGZvciAobGV0IGsgPSAwOyBrIDwgbnVtQ29udGFjdHMgLSAxOyBrKyspIHsKICAgICAgICAgICAgICAgIHJlc3VsdC5wb3AoKTsKICAgICAgICAgICAgfQogICAgICAgICAgKi8KCiAgICAgICAgfQogICAgICB9CiAgICB9CgogICAgYm94SGVpZ2h0ZmllbGQoc2ksIHNqLCB4aSwgeGosIHFpLCBxaiwgYmksIGJqLCByc2ksIHJzaiwganVzdFRlc3QpIHsKICAgICAgc2kuY29udmV4UG9seWhlZHJvblJlcHJlc2VudGF0aW9uLm1hdGVyaWFsID0gc2kubWF0ZXJpYWw7CiAgICAgIHNpLmNvbnZleFBvbHloZWRyb25SZXByZXNlbnRhdGlvbi5jb2xsaXNpb25SZXNwb25zZSA9IHNpLmNvbGxpc2lvblJlc3BvbnNlOwogICAgICByZXR1cm4gdGhpcy5jb252ZXhIZWlnaHRmaWVsZChzaS5jb252ZXhQb2x5aGVkcm9uUmVwcmVzZW50YXRpb24sIHNqLCB4aSwgeGosIHFpLCBxaiwgYmksIGJqLCBzaSwgc2osIGp1c3RUZXN0KTsKICAgIH0KCiAgICBjb252ZXhIZWlnaHRmaWVsZChjb252ZXhTaGFwZSwgaGZTaGFwZSwgY29udmV4UG9zLCBoZlBvcywgY29udmV4UXVhdCwgaGZRdWF0LCBjb252ZXhCb2R5LCBoZkJvZHksIHJzaSwgcnNqLCBqdXN0VGVzdCkgewogICAgICBjb25zdCBkYXRhID0gaGZTaGFwZS5kYXRhOwogICAgICBjb25zdCB3ID0gaGZTaGFwZS5lbGVtZW50U2l6ZTsKICAgICAgY29uc3QgcmFkaXVzID0gY29udmV4U2hhcGUuYm91bmRpbmdTcGhlcmVSYWRpdXM7CiAgICAgIGNvbnN0IHdvcmxkUGlsbGFyT2Zmc2V0ID0gY29udmV4SGVpZ2h0ZmllbGRfdG1wMjsKICAgICAgY29uc3QgZmFjZUxpc3QgPSBjb252ZXhIZWlnaHRmaWVsZF9mYWNlTGlzdDsgLy8gR2V0IHNwaGVyZSBwb3NpdGlvbiB0byBoZWlnaHRmaWVsZCBsb2NhbCEKCiAgICAgIGNvbnN0IGxvY2FsQ29udmV4UG9zID0gY29udmV4SGVpZ2h0ZmllbGRfdG1wMTsKICAgICAgVHJhbnNmb3JtLnBvaW50VG9Mb2NhbEZyYW1lKGhmUG9zLCBoZlF1YXQsIGNvbnZleFBvcywgbG9jYWxDb252ZXhQb3MpOyAvLyBHZXQgdGhlIGluZGV4IG9mIHRoZSBkYXRhIHBvaW50cyB0byB0ZXN0IGFnYWluc3QKCiAgICAgIGxldCBpTWluWCA9IE1hdGguZmxvb3IoKGxvY2FsQ29udmV4UG9zLnggLSByYWRpdXMpIC8gdykgLSAxOwogICAgICBsZXQgaU1heFggPSBNYXRoLmNlaWwoKGxvY2FsQ29udmV4UG9zLnggKyByYWRpdXMpIC8gdykgKyAxOwogICAgICBsZXQgaU1pblkgPSBNYXRoLmZsb29yKChsb2NhbENvbnZleFBvcy55IC0gcmFkaXVzKSAvIHcpIC0gMTsKICAgICAgbGV0IGlNYXhZID0gTWF0aC5jZWlsKChsb2NhbENvbnZleFBvcy55ICsgcmFkaXVzKSAvIHcpICsgMTsgLy8gQmFpbCBvdXQgaWYgd2UgYXJlIG91dCBvZiB0aGUgdGVycmFpbgoKICAgICAgaWYgKGlNYXhYIDwgMCB8fCBpTWF4WSA8IDAgfHwgaU1pblggPiBkYXRhLmxlbmd0aCB8fCBpTWluWSA+IGRhdGFbMF0ubGVuZ3RoKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9IC8vIENsYW1wIGluZGV4IHRvIGVkZ2VzCgoKICAgICAgaWYgKGlNaW5YIDwgMCkgewogICAgICAgIGlNaW5YID0gMDsKICAgICAgfQoKICAgICAgaWYgKGlNYXhYIDwgMCkgewogICAgICAgIGlNYXhYID0gMDsKICAgICAgfQoKICAgICAgaWYgKGlNaW5ZIDwgMCkgewogICAgICAgIGlNaW5ZID0gMDsKICAgICAgfQoKICAgICAgaWYgKGlNYXhZIDwgMCkgewogICAgICAgIGlNYXhZID0gMDsKICAgICAgfQoKICAgICAgaWYgKGlNaW5YID49IGRhdGEubGVuZ3RoKSB7CiAgICAgICAgaU1pblggPSBkYXRhLmxlbmd0aCAtIDE7CiAgICAgIH0KCiAgICAgIGlmIChpTWF4WCA+PSBkYXRhLmxlbmd0aCkgewogICAgICAgIGlNYXhYID0gZGF0YS5sZW5ndGggLSAxOwogICAgICB9CgogICAgICBpZiAoaU1heFkgPj0gZGF0YVswXS5sZW5ndGgpIHsKICAgICAgICBpTWF4WSA9IGRhdGFbMF0ubGVuZ3RoIC0gMTsKICAgICAgfQoKICAgICAgaWYgKGlNaW5ZID49IGRhdGFbMF0ubGVuZ3RoKSB7CiAgICAgICAgaU1pblkgPSBkYXRhWzBdLmxlbmd0aCAtIDE7CiAgICAgIH0KCiAgICAgIGNvbnN0IG1pbk1heCA9IFtdOwogICAgICBoZlNoYXBlLmdldFJlY3RNaW5NYXgoaU1pblgsIGlNaW5ZLCBpTWF4WCwgaU1heFksIG1pbk1heCk7CiAgICAgIGNvbnN0IG1pbiA9IG1pbk1heFswXTsKICAgICAgY29uc3QgbWF4ID0gbWluTWF4WzFdOyAvLyBCYWlsIG91dCBpZiB3ZSdyZSBjYW50IHRvdWNoIHRoZSBib3VuZGluZyBoZWlnaHQgYm94CgogICAgICBpZiAobG9jYWxDb252ZXhQb3MueiAtIHJhZGl1cyA+IG1heCB8fCBsb2NhbENvbnZleFBvcy56ICsgcmFkaXVzIDwgbWluKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICBmb3IgKGxldCBpID0gaU1pblg7IGkgPCBpTWF4WDsgaSsrKSB7CiAgICAgICAgZm9yIChsZXQgaiA9IGlNaW5ZOyBqIDwgaU1heFk7IGorKykgewogICAgICAgICAgbGV0IGludGVyc2VjdGluZyA9IGZhbHNlOyAvLyBMb3dlciB0cmlhbmdsZQoKICAgICAgICAgIGhmU2hhcGUuZ2V0Q29udmV4VHJpYW5nbGVQaWxsYXIoaSwgaiwgZmFsc2UpOwogICAgICAgICAgVHJhbnNmb3JtLnBvaW50VG9Xb3JsZEZyYW1lKGhmUG9zLCBoZlF1YXQsIGhmU2hhcGUucGlsbGFyT2Zmc2V0LCB3b3JsZFBpbGxhck9mZnNldCk7CgogICAgICAgICAgaWYgKGNvbnZleFBvcy5kaXN0YW5jZVRvKHdvcmxkUGlsbGFyT2Zmc2V0KSA8IGhmU2hhcGUucGlsbGFyQ29udmV4LmJvdW5kaW5nU3BoZXJlUmFkaXVzICsgY29udmV4U2hhcGUuYm91bmRpbmdTcGhlcmVSYWRpdXMpIHsKICAgICAgICAgICAgaW50ZXJzZWN0aW5nID0gdGhpcy5jb252ZXhDb252ZXgoY29udmV4U2hhcGUsIGhmU2hhcGUucGlsbGFyQ29udmV4LCBjb252ZXhQb3MsIHdvcmxkUGlsbGFyT2Zmc2V0LCBjb252ZXhRdWF0LCBoZlF1YXQsIGNvbnZleEJvZHksIGhmQm9keSwgbnVsbCwgbnVsbCwganVzdFRlc3QsIGZhY2VMaXN0LCBudWxsKTsKICAgICAgICAgIH0KCiAgICAgICAgICBpZiAoanVzdFRlc3QgJiYgaW50ZXJzZWN0aW5nKSB7CiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgfSAvLyBVcHBlciB0cmlhbmdsZQoKCiAgICAgICAgICBoZlNoYXBlLmdldENvbnZleFRyaWFuZ2xlUGlsbGFyKGksIGosIHRydWUpOwogICAgICAgICAgVHJhbnNmb3JtLnBvaW50VG9Xb3JsZEZyYW1lKGhmUG9zLCBoZlF1YXQsIGhmU2hhcGUucGlsbGFyT2Zmc2V0LCB3b3JsZFBpbGxhck9mZnNldCk7CgogICAgICAgICAgaWYgKGNvbnZleFBvcy5kaXN0YW5jZVRvKHdvcmxkUGlsbGFyT2Zmc2V0KSA8IGhmU2hhcGUucGlsbGFyQ29udmV4LmJvdW5kaW5nU3BoZXJlUmFkaXVzICsgY29udmV4U2hhcGUuYm91bmRpbmdTcGhlcmVSYWRpdXMpIHsKICAgICAgICAgICAgaW50ZXJzZWN0aW5nID0gdGhpcy5jb252ZXhDb252ZXgoY29udmV4U2hhcGUsIGhmU2hhcGUucGlsbGFyQ29udmV4LCBjb252ZXhQb3MsIHdvcmxkUGlsbGFyT2Zmc2V0LCBjb252ZXhRdWF0LCBoZlF1YXQsIGNvbnZleEJvZHksIGhmQm9keSwgbnVsbCwgbnVsbCwganVzdFRlc3QsIGZhY2VMaXN0LCBudWxsKTsKICAgICAgICAgIH0KCiAgICAgICAgICBpZiAoanVzdFRlc3QgJiYgaW50ZXJzZWN0aW5nKSB7CiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQogICAgfQoKICAgIHNwaGVyZVBhcnRpY2xlKHNqLCBzaSwgeGosIHhpLCBxaiwgcWksIGJqLCBiaSwgcnNpLCByc2osIGp1c3RUZXN0KSB7CiAgICAgIC8vIFRoZSBub3JtYWwgaXMgdGhlIHVuaXQgdmVjdG9yIGZyb20gc3BoZXJlIGNlbnRlciB0byBwYXJ0aWNsZSBjZW50ZXIKICAgICAgY29uc3Qgbm9ybWFsID0gcGFydGljbGVTcGhlcmVfbm9ybWFsOwogICAgICBub3JtYWwuc2V0KDAsIDAsIDEpOwogICAgICB4aS52c3ViKHhqLCBub3JtYWwpOwogICAgICBjb25zdCBsZW5ndGhTcXVhcmVkID0gbm9ybWFsLmxlbmd0aFNxdWFyZWQoKTsKCiAgICAgIGlmIChsZW5ndGhTcXVhcmVkIDw9IHNqLnJhZGl1cyAqIHNqLnJhZGl1cykgewogICAgICAgIGlmIChqdXN0VGVzdCkgewogICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfQoKICAgICAgICBjb25zdCByID0gdGhpcy5jcmVhdGVDb250YWN0RXF1YXRpb24oYmksIGJqLCBzaSwgc2osIHJzaSwgcnNqKTsKICAgICAgICBub3JtYWwubm9ybWFsaXplKCk7CiAgICAgICAgci5yai5jb3B5KG5vcm1hbCk7CiAgICAgICAgci5yai5zY2FsZShzai5yYWRpdXMsIHIucmopOwogICAgICAgIHIubmkuY29weShub3JtYWwpOyAvLyBDb250YWN0IG5vcm1hbAoKICAgICAgICByLm5pLm5lZ2F0ZShyLm5pKTsKICAgICAgICByLnJpLnNldCgwLCAwLCAwKTsgLy8gQ2VudGVyIG9mIHBhcnRpY2xlCgogICAgICAgIHRoaXMucmVzdWx0LnB1c2gocik7CiAgICAgICAgdGhpcy5jcmVhdGVGcmljdGlvbkVxdWF0aW9uc0Zyb21Db250YWN0KHIsIHRoaXMuZnJpY3Rpb25SZXN1bHQpOwogICAgICB9CiAgICB9CgogICAgcGxhbmVQYXJ0aWNsZShzaiwgc2ksIHhqLCB4aSwgcWosIHFpLCBiaiwgYmksIHJzaSwgcnNqLCBqdXN0VGVzdCkgewogICAgICBjb25zdCBub3JtYWwgPSBwYXJ0aWNsZVBsYW5lX25vcm1hbDsKICAgICAgbm9ybWFsLnNldCgwLCAwLCAxKTsKICAgICAgYmoucXVhdGVybmlvbi52bXVsdChub3JtYWwsIG5vcm1hbCk7IC8vIFR1cm4gbm9ybWFsIGFjY29yZGluZyB0byBwbGFuZSBvcmllbnRhdGlvbgoKICAgICAgY29uc3QgcmVscG9zID0gcGFydGljbGVQbGFuZV9yZWxwb3M7CiAgICAgIHhpLnZzdWIoYmoucG9zaXRpb24sIHJlbHBvcyk7CiAgICAgIGNvbnN0IGRvdCA9IG5vcm1hbC5kb3QocmVscG9zKTsKCiAgICAgIGlmIChkb3QgPD0gMC4wKSB7CiAgICAgICAgaWYgKGp1c3RUZXN0KSB7CiAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9CgogICAgICAgIGNvbnN0IHIgPSB0aGlzLmNyZWF0ZUNvbnRhY3RFcXVhdGlvbihiaSwgYmosIHNpLCBzaiwgcnNpLCByc2opOwogICAgICAgIHIubmkuY29weShub3JtYWwpOyAvLyBDb250YWN0IG5vcm1hbCBpcyB0aGUgcGxhbmUgbm9ybWFsCgogICAgICAgIHIubmkubmVnYXRlKHIubmkpOwogICAgICAgIHIucmkuc2V0KDAsIDAsIDApOyAvLyBDZW50ZXIgb2YgcGFydGljbGUKICAgICAgICAvLyBHZXQgcGFydGljbGUgcG9zaXRpb24gcHJvamVjdGVkIG9uIHBsYW5lCgogICAgICAgIGNvbnN0IHByb2plY3RlZCA9IHBhcnRpY2xlUGxhbmVfcHJvamVjdGVkOwogICAgICAgIG5vcm1hbC5zY2FsZShub3JtYWwuZG90KHhpKSwgcHJvamVjdGVkKTsKICAgICAgICB4aS52c3ViKHByb2plY3RlZCwgcHJvamVjdGVkKTsgLy9wcm9qZWN0ZWQudmFkZChiai5wb3NpdGlvbixwcm9qZWN0ZWQpOwogICAgICAgIC8vIHJqIGlzIG5vdyB0aGUgcHJvamVjdGVkIHdvcmxkIHBvc2l0aW9uIG1pbnVzIHBsYW5lIHBvc2l0aW9uCgogICAgICAgIHIucmouY29weShwcm9qZWN0ZWQpOwogICAgICAgIHRoaXMucmVzdWx0LnB1c2gocik7CiAgICAgICAgdGhpcy5jcmVhdGVGcmljdGlvbkVxdWF0aW9uc0Zyb21Db250YWN0KHIsIHRoaXMuZnJpY3Rpb25SZXN1bHQpOwogICAgICB9CiAgICB9CgogICAgYm94UGFydGljbGUoc2ksIHNqLCB4aSwgeGosIHFpLCBxaiwgYmksIGJqLCByc2ksIHJzaiwganVzdFRlc3QpIHsKICAgICAgc2kuY29udmV4UG9seWhlZHJvblJlcHJlc2VudGF0aW9uLm1hdGVyaWFsID0gc2kubWF0ZXJpYWw7CiAgICAgIHNpLmNvbnZleFBvbHloZWRyb25SZXByZXNlbnRhdGlvbi5jb2xsaXNpb25SZXNwb25zZSA9IHNpLmNvbGxpc2lvblJlc3BvbnNlOwogICAgICByZXR1cm4gdGhpcy5jb252ZXhQYXJ0aWNsZShzaS5jb252ZXhQb2x5aGVkcm9uUmVwcmVzZW50YXRpb24sIHNqLCB4aSwgeGosIHFpLCBxaiwgYmksIGJqLCBzaSwgc2osIGp1c3RUZXN0KTsKICAgIH0KCiAgICBjb252ZXhQYXJ0aWNsZShzaiwgc2ksIHhqLCB4aSwgcWosIHFpLCBiaiwgYmksIHJzaSwgcnNqLCBqdXN0VGVzdCkgewogICAgICBsZXQgcGVuZXRyYXRlZEZhY2VJbmRleCA9IC0xOwogICAgICBjb25zdCBwZW5ldHJhdGVkRmFjZU5vcm1hbCA9IGNvbnZleFBhcnRpY2xlX3BlbmV0cmF0ZWRGYWNlTm9ybWFsOwogICAgICBjb25zdCB3b3JsZFBlbmV0cmF0aW9uVmVjID0gY29udmV4UGFydGljbGVfd29ybGRQZW5ldHJhdGlvblZlYzsKICAgICAgbGV0IG1pblBlbmV0cmF0aW9uID0gbnVsbDsKCiAgICAgIGNvbnN0IGxvY2FsID0gY29udmV4UGFydGljbGVfbG9jYWw7CiAgICAgIGxvY2FsLmNvcHkoeGkpOwogICAgICBsb2NhbC52c3ViKHhqLCBsb2NhbCk7IC8vIENvbnZlcnQgcG9zaXRpb24gdG8gcmVsYXRpdmUgdGhlIGNvbnZleCBvcmlnaW4KCiAgICAgIHFqLmNvbmp1Z2F0ZShjcWopOwogICAgICBjcWoudm11bHQobG9jYWwsIGxvY2FsKTsKCiAgICAgIGlmIChzai5wb2ludElzSW5zaWRlKGxvY2FsKSkgewogICAgICAgIGlmIChzai53b3JsZFZlcnRpY2VzTmVlZHNVcGRhdGUpIHsKICAgICAgICAgIHNqLmNvbXB1dGVXb3JsZFZlcnRpY2VzKHhqLCBxaik7CiAgICAgICAgfQoKICAgICAgICBpZiAoc2oud29ybGRGYWNlTm9ybWFsc05lZWRzVXBkYXRlKSB7CiAgICAgICAgICBzai5jb21wdXRlV29ybGRGYWNlTm9ybWFscyhxaik7CiAgICAgICAgfSAvLyBGb3IgZWFjaCB3b3JsZCBwb2x5Z29uIGluIHRoZSBwb2x5aGVkcmEKCgogICAgICAgIGZvciAobGV0IGkgPSAwLCBuZmFjZXMgPSBzai5mYWNlcy5sZW5ndGg7IGkgIT09IG5mYWNlczsgaSsrKSB7CiAgICAgICAgICAvLyBDb25zdHJ1Y3Qgd29ybGQgZmFjZSB2ZXJ0aWNlcwogICAgICAgICAgY29uc3QgdmVydHMgPSBbc2oud29ybGRWZXJ0aWNlc1tzai5mYWNlc1tpXVswXV1dOwogICAgICAgICAgY29uc3Qgbm9ybWFsID0gc2oud29ybGRGYWNlTm9ybWFsc1tpXTsgLy8gQ2hlY2sgaG93IG11Y2ggdGhlIHBhcnRpY2xlIHBlbmV0cmF0ZXMgdGhlIHBvbHlnb24gcGxhbmUuCgogICAgICAgICAgeGkudnN1Yih2ZXJ0c1swXSwgY29udmV4UGFydGljbGVfdmVydGV4VG9QYXJ0aWNsZSk7CiAgICAgICAgICBjb25zdCBwZW5ldHJhdGlvbiA9IC1ub3JtYWwuZG90KGNvbnZleFBhcnRpY2xlX3ZlcnRleFRvUGFydGljbGUpOwoKICAgICAgICAgIGlmIChtaW5QZW5ldHJhdGlvbiA9PT0gbnVsbCB8fCBNYXRoLmFicyhwZW5ldHJhdGlvbikgPCBNYXRoLmFicyhtaW5QZW5ldHJhdGlvbikpIHsKICAgICAgICAgICAgaWYgKGp1c3RUZXN0KSB7CiAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIG1pblBlbmV0cmF0aW9uID0gcGVuZXRyYXRpb247CiAgICAgICAgICAgIHBlbmV0cmF0ZWRGYWNlSW5kZXggPSBpOwogICAgICAgICAgICBwZW5ldHJhdGVkRmFjZU5vcm1hbC5jb3B5KG5vcm1hbCk7CiAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBpZiAocGVuZXRyYXRlZEZhY2VJbmRleCAhPT0gLTEpIHsKICAgICAgICAgIC8vIFNldHVwIGNvbnRhY3QKICAgICAgICAgIGNvbnN0IHIgPSB0aGlzLmNyZWF0ZUNvbnRhY3RFcXVhdGlvbihiaSwgYmosIHNpLCBzaiwgcnNpLCByc2opOwogICAgICAgICAgcGVuZXRyYXRlZEZhY2VOb3JtYWwuc2NhbGUobWluUGVuZXRyYXRpb24sIHdvcmxkUGVuZXRyYXRpb25WZWMpOyAvLyByaiBpcyB0aGUgcGFydGljbGUgcG9zaXRpb24gcHJvamVjdGVkIHRvIHRoZSBmYWNlCgogICAgICAgICAgd29ybGRQZW5ldHJhdGlvblZlYy52YWRkKHhpLCB3b3JsZFBlbmV0cmF0aW9uVmVjKTsKICAgICAgICAgIHdvcmxkUGVuZXRyYXRpb25WZWMudnN1Yih4aiwgd29ybGRQZW5ldHJhdGlvblZlYyk7CiAgICAgICAgICByLnJqLmNvcHkod29ybGRQZW5ldHJhdGlvblZlYyk7IC8vY29uc3QgcHJvamVjdGVkVG9GYWNlID0geGkudnN1Yih4aikudmFkZCh3b3JsZFBlbmV0cmF0aW9uVmVjKTsKICAgICAgICAgIC8vcHJvamVjdGVkVG9GYWNlLmNvcHkoci5yaik7CiAgICAgICAgICAvL3FqLnZtdWx0KHIucmosci5yaik7CgogICAgICAgICAgcGVuZXRyYXRlZEZhY2VOb3JtYWwubmVnYXRlKHIubmkpOyAvLyBDb250YWN0IG5vcm1hbAoKICAgICAgICAgIHIucmkuc2V0KDAsIDAsIDApOyAvLyBDZW50ZXIgb2YgcGFydGljbGUKCiAgICAgICAgICBjb25zdCByaSA9IHIucmk7CiAgICAgICAgICBjb25zdCByaiA9IHIucmo7IC8vIE1ha2UgcmVsYXRpdmUgdG8gYm9kaWVzCgogICAgICAgICAgcmkudmFkZCh4aSwgcmkpOwogICAgICAgICAgcmkudnN1YihiaS5wb3NpdGlvbiwgcmkpOwogICAgICAgICAgcmoudmFkZCh4aiwgcmopOwogICAgICAgICAgcmoudnN1Yihiai5wb3NpdGlvbiwgcmopOwogICAgICAgICAgdGhpcy5yZXN1bHQucHVzaChyKTsKICAgICAgICAgIHRoaXMuY3JlYXRlRnJpY3Rpb25FcXVhdGlvbnNGcm9tQ29udGFjdChyLCB0aGlzLmZyaWN0aW9uUmVzdWx0KTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgY29uc29sZS53YXJuKCdQb2ludCBmb3VuZCBpbnNpZGUgY29udmV4LCBidXQgZGlkIG5vdCBmaW5kIHBlbmV0cmF0aW5nIGZhY2UhJyk7CiAgICAgICAgfQogICAgICB9CiAgICB9CgogICAgaGVpZ2h0ZmllbGRDeWxpbmRlcihoZlNoYXBlLCBjb252ZXhTaGFwZSwgaGZQb3MsIGNvbnZleFBvcywgaGZRdWF0LCBjb252ZXhRdWF0LCBoZkJvZHksIGNvbnZleEJvZHksIHJzaSwgcnNqLCBqdXN0VGVzdCkgewogICAgICByZXR1cm4gdGhpcy5jb252ZXhIZWlnaHRmaWVsZChjb252ZXhTaGFwZSwgaGZTaGFwZSwgY29udmV4UG9zLCBoZlBvcywgY29udmV4UXVhdCwgaGZRdWF0LCBjb252ZXhCb2R5LCBoZkJvZHksIHJzaSwgcnNqLCBqdXN0VGVzdCk7CiAgICB9CgogICAgcGFydGljbGVDeWxpbmRlcihzaSwgc2osIHhpLCB4aiwgcWksIHFqLCBiaSwgYmosIHJzaSwgcnNqLCBqdXN0VGVzdCkgewogICAgICByZXR1cm4gdGhpcy5jb252ZXhQYXJ0aWNsZShzaiwgc2ksIHhqLCB4aSwgcWosIHFpLCBiaiwgYmksIHJzaSwgcnNqLCBqdXN0VGVzdCk7CiAgICB9CgogICAgc3BoZXJlVHJpbWVzaChzcGhlcmVTaGFwZSwgdHJpbWVzaFNoYXBlLCBzcGhlcmVQb3MsIHRyaW1lc2hQb3MsIHNwaGVyZVF1YXQsIHRyaW1lc2hRdWF0LCBzcGhlcmVCb2R5LCB0cmltZXNoQm9keSwgcnNpLCByc2osIGp1c3RUZXN0KSB7CiAgICAgIGNvbnN0IGVkZ2VWZXJ0ZXhBID0gc3BoZXJlVHJpbWVzaF9lZGdlVmVydGV4QTsKICAgICAgY29uc3QgZWRnZVZlcnRleEIgPSBzcGhlcmVUcmltZXNoX2VkZ2VWZXJ0ZXhCOwogICAgICBjb25zdCBlZGdlVmVjdG9yID0gc3BoZXJlVHJpbWVzaF9lZGdlVmVjdG9yOwogICAgICBjb25zdCBlZGdlVmVjdG9yVW5pdCA9IHNwaGVyZVRyaW1lc2hfZWRnZVZlY3RvclVuaXQ7CiAgICAgIGNvbnN0IGxvY2FsU3BoZXJlUG9zID0gc3BoZXJlVHJpbWVzaF9sb2NhbFNwaGVyZVBvczsKICAgICAgY29uc3QgdG1wID0gc3BoZXJlVHJpbWVzaF90bXA7CiAgICAgIGNvbnN0IGxvY2FsU3BoZXJlQUFCQiA9IHNwaGVyZVRyaW1lc2hfbG9jYWxTcGhlcmVBQUJCOwogICAgICBjb25zdCB2MiA9IHNwaGVyZVRyaW1lc2hfdjI7CiAgICAgIGNvbnN0IHJlbHBvcyA9IHNwaGVyZVRyaW1lc2hfcmVscG9zOwogICAgICBjb25zdCB0cmlhbmdsZXMgPSBzcGhlcmVUcmltZXNoX3RyaWFuZ2xlczsgLy8gQ29udmVydCBzcGhlcmUgcG9zaXRpb24gdG8gbG9jYWwgaW4gdGhlIHRyaW1lc2gKCiAgICAgIFRyYW5zZm9ybS5wb2ludFRvTG9jYWxGcmFtZSh0cmltZXNoUG9zLCB0cmltZXNoUXVhdCwgc3BoZXJlUG9zLCBsb2NhbFNwaGVyZVBvcyk7IC8vIEdldCB0aGUgYWFiYiBvZiB0aGUgc3BoZXJlIGxvY2FsbHkgaW4gdGhlIHRyaW1lc2gKCiAgICAgIGNvbnN0IHNwaGVyZVJhZGl1cyA9IHNwaGVyZVNoYXBlLnJhZGl1czsKICAgICAgbG9jYWxTcGhlcmVBQUJCLmxvd2VyQm91bmQuc2V0KGxvY2FsU3BoZXJlUG9zLnggLSBzcGhlcmVSYWRpdXMsIGxvY2FsU3BoZXJlUG9zLnkgLSBzcGhlcmVSYWRpdXMsIGxvY2FsU3BoZXJlUG9zLnogLSBzcGhlcmVSYWRpdXMpOwogICAgICBsb2NhbFNwaGVyZUFBQkIudXBwZXJCb3VuZC5zZXQobG9jYWxTcGhlcmVQb3MueCArIHNwaGVyZVJhZGl1cywgbG9jYWxTcGhlcmVQb3MueSArIHNwaGVyZVJhZGl1cywgbG9jYWxTcGhlcmVQb3MueiArIHNwaGVyZVJhZGl1cyk7CiAgICAgIHRyaW1lc2hTaGFwZS5nZXRUcmlhbmdsZXNJbkFBQkIobG9jYWxTcGhlcmVBQUJCLCB0cmlhbmdsZXMpOyAvL2ZvciAobGV0IGkgPSAwOyBpIDwgdHJpbWVzaFNoYXBlLmluZGljZXMubGVuZ3RoIC8gMzsgaSsrKSB0cmlhbmdsZXMucHVzaChpKTsgLy8gQWxsCiAgICAgIC8vIFZlcnRpY2VzCgogICAgICBjb25zdCB2ID0gc3BoZXJlVHJpbWVzaF92OwogICAgICBjb25zdCByYWRpdXNTcXVhcmVkID0gc3BoZXJlU2hhcGUucmFkaXVzICogc3BoZXJlU2hhcGUucmFkaXVzOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0cmlhbmdsZXMubGVuZ3RoOyBpKyspIHsKICAgICAgICBmb3IgKGxldCBqID0gMDsgaiA8IDM7IGorKykgewogICAgICAgICAgdHJpbWVzaFNoYXBlLmdldFZlcnRleCh0cmltZXNoU2hhcGUuaW5kaWNlc1t0cmlhbmdsZXNbaV0gKiAzICsgal0sIHYpOyAvLyBDaGVjayB2ZXJ0ZXggb3ZlcmxhcCBpbiBzcGhlcmUKCiAgICAgICAgICB2LnZzdWIobG9jYWxTcGhlcmVQb3MsIHJlbHBvcyk7CgogICAgICAgICAgaWYgKHJlbHBvcy5sZW5ndGhTcXVhcmVkKCkgPD0gcmFkaXVzU3F1YXJlZCkgewogICAgICAgICAgICAvLyBTYWZlIHVwCiAgICAgICAgICAgIHYyLmNvcHkodik7CiAgICAgICAgICAgIFRyYW5zZm9ybS5wb2ludFRvV29ybGRGcmFtZSh0cmltZXNoUG9zLCB0cmltZXNoUXVhdCwgdjIsIHYpOwogICAgICAgICAgICB2LnZzdWIoc3BoZXJlUG9zLCByZWxwb3MpOwoKICAgICAgICAgICAgaWYgKGp1c3RUZXN0KSB7CiAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGxldCByID0gdGhpcy5jcmVhdGVDb250YWN0RXF1YXRpb24oc3BoZXJlQm9keSwgdHJpbWVzaEJvZHksIHNwaGVyZVNoYXBlLCB0cmltZXNoU2hhcGUsIHJzaSwgcnNqKTsKICAgICAgICAgICAgci5uaS5jb3B5KHJlbHBvcyk7CiAgICAgICAgICAgIHIubmkubm9ybWFsaXplKCk7IC8vIHJpIGlzIHRoZSB2ZWN0b3IgZnJvbSBzcGhlcmUgY2VudGVyIHRvIHRoZSBzcGhlcmUgc3VyZmFjZQoKICAgICAgICAgICAgci5yaS5jb3B5KHIubmkpOwogICAgICAgICAgICByLnJpLnNjYWxlKHNwaGVyZVNoYXBlLnJhZGl1cywgci5yaSk7CiAgICAgICAgICAgIHIucmkudmFkZChzcGhlcmVQb3MsIHIucmkpOwogICAgICAgICAgICByLnJpLnZzdWIoc3BoZXJlQm9keS5wb3NpdGlvbiwgci5yaSk7CiAgICAgICAgICAgIHIucmouY29weSh2KTsKICAgICAgICAgICAgci5yai52c3ViKHRyaW1lc2hCb2R5LnBvc2l0aW9uLCByLnJqKTsgLy8gU3RvcmUgcmVzdWx0CgogICAgICAgICAgICB0aGlzLnJlc3VsdC5wdXNoKHIpOwogICAgICAgICAgICB0aGlzLmNyZWF0ZUZyaWN0aW9uRXF1YXRpb25zRnJvbUNvbnRhY3QociwgdGhpcy5mcmljdGlvblJlc3VsdCk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9IC8vIENoZWNrIGFsbCBlZGdlcwoKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdHJpYW5nbGVzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgZm9yIChsZXQgaiA9IDA7IGogPCAzOyBqKyspIHsKICAgICAgICAgIHRyaW1lc2hTaGFwZS5nZXRWZXJ0ZXgodHJpbWVzaFNoYXBlLmluZGljZXNbdHJpYW5nbGVzW2ldICogMyArIGpdLCBlZGdlVmVydGV4QSk7CiAgICAgICAgICB0cmltZXNoU2hhcGUuZ2V0VmVydGV4KHRyaW1lc2hTaGFwZS5pbmRpY2VzW3RyaWFuZ2xlc1tpXSAqIDMgKyAoaiArIDEpICUgM10sIGVkZ2VWZXJ0ZXhCKTsKICAgICAgICAgIGVkZ2VWZXJ0ZXhCLnZzdWIoZWRnZVZlcnRleEEsIGVkZ2VWZWN0b3IpOyAvLyBQcm9qZWN0IHNwaGVyZSBwb3NpdGlvbiB0byB0aGUgZWRnZQoKICAgICAgICAgIGxvY2FsU3BoZXJlUG9zLnZzdWIoZWRnZVZlcnRleEIsIHRtcCk7CiAgICAgICAgICBjb25zdCBwb3NpdGlvbkFsb25nRWRnZUIgPSB0bXAuZG90KGVkZ2VWZWN0b3IpOwogICAgICAgICAgbG9jYWxTcGhlcmVQb3MudnN1YihlZGdlVmVydGV4QSwgdG1wKTsKICAgICAgICAgIGxldCBwb3NpdGlvbkFsb25nRWRnZUEgPSB0bXAuZG90KGVkZ2VWZWN0b3IpOwoKICAgICAgICAgIGlmIChwb3NpdGlvbkFsb25nRWRnZUEgPiAwICYmIHBvc2l0aW9uQWxvbmdFZGdlQiA8IDApIHsKICAgICAgICAgICAgLy8gTm93IGNoZWNrIHRoZSBvcnRob2dvbmFsIGRpc3RhbmNlIGZyb20gZWRnZSB0byBzcGhlcmUgY2VudGVyCiAgICAgICAgICAgIGxvY2FsU3BoZXJlUG9zLnZzdWIoZWRnZVZlcnRleEEsIHRtcCk7CiAgICAgICAgICAgIGVkZ2VWZWN0b3JVbml0LmNvcHkoZWRnZVZlY3Rvcik7CiAgICAgICAgICAgIGVkZ2VWZWN0b3JVbml0Lm5vcm1hbGl6ZSgpOwogICAgICAgICAgICBwb3NpdGlvbkFsb25nRWRnZUEgPSB0bXAuZG90KGVkZ2VWZWN0b3JVbml0KTsKICAgICAgICAgICAgZWRnZVZlY3RvclVuaXQuc2NhbGUocG9zaXRpb25BbG9uZ0VkZ2VBLCB0bXApOwogICAgICAgICAgICB0bXAudmFkZChlZGdlVmVydGV4QSwgdG1wKTsgLy8gdG1wIGlzIG5vdyB0aGUgc3BoZXJlIGNlbnRlciBwb3NpdGlvbiBwcm9qZWN0ZWQgdG8gdGhlIGVkZ2UsIGRlZmluZWQgbG9jYWxseSBpbiB0aGUgdHJpbWVzaCBmcmFtZQoKICAgICAgICAgICAgY29uc3QgZGlzdCA9IHRtcC5kaXN0YW5jZVRvKGxvY2FsU3BoZXJlUG9zKTsKCiAgICAgICAgICAgIGlmIChkaXN0IDwgc3BoZXJlU2hhcGUucmFkaXVzKSB7CiAgICAgICAgICAgICAgaWYgKGp1c3RUZXN0KSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIGNvbnN0IHIgPSB0aGlzLmNyZWF0ZUNvbnRhY3RFcXVhdGlvbihzcGhlcmVCb2R5LCB0cmltZXNoQm9keSwgc3BoZXJlU2hhcGUsIHRyaW1lc2hTaGFwZSwgcnNpLCByc2opOwogICAgICAgICAgICAgIHRtcC52c3ViKGxvY2FsU3BoZXJlUG9zLCByLm5pKTsKICAgICAgICAgICAgICByLm5pLm5vcm1hbGl6ZSgpOwogICAgICAgICAgICAgIHIubmkuc2NhbGUoc3BoZXJlU2hhcGUucmFkaXVzLCByLnJpKTsKICAgICAgICAgICAgICByLnJpLnZhZGQoc3BoZXJlUG9zLCByLnJpKTsKICAgICAgICAgICAgICByLnJpLnZzdWIoc3BoZXJlQm9keS5wb3NpdGlvbiwgci5yaSk7CiAgICAgICAgICAgICAgVHJhbnNmb3JtLnBvaW50VG9Xb3JsZEZyYW1lKHRyaW1lc2hQb3MsIHRyaW1lc2hRdWF0LCB0bXAsIHRtcCk7CiAgICAgICAgICAgICAgdG1wLnZzdWIodHJpbWVzaEJvZHkucG9zaXRpb24sIHIucmopOwogICAgICAgICAgICAgIFRyYW5zZm9ybS52ZWN0b3JUb1dvcmxkRnJhbWUodHJpbWVzaFF1YXQsIHIubmksIHIubmkpOwogICAgICAgICAgICAgIFRyYW5zZm9ybS52ZWN0b3JUb1dvcmxkRnJhbWUodHJpbWVzaFF1YXQsIHIucmksIHIucmkpOwogICAgICAgICAgICAgIHRoaXMucmVzdWx0LnB1c2gocik7CiAgICAgICAgICAgICAgdGhpcy5jcmVhdGVGcmljdGlvbkVxdWF0aW9uc0Zyb21Db250YWN0KHIsIHRoaXMuZnJpY3Rpb25SZXN1bHQpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9IC8vIFRyaWFuZ2xlIGZhY2VzCgoKICAgICAgY29uc3QgdmEgPSBzcGhlcmVUcmltZXNoX3ZhOwogICAgICBjb25zdCB2YiA9IHNwaGVyZVRyaW1lc2hfdmI7CiAgICAgIGNvbnN0IHZjID0gc3BoZXJlVHJpbWVzaF92YzsKICAgICAgY29uc3Qgbm9ybWFsID0gc3BoZXJlVHJpbWVzaF9ub3JtYWw7CgogICAgICBmb3IgKGxldCBpID0gMCwgTiA9IHRyaWFuZ2xlcy5sZW5ndGg7IGkgIT09IE47IGkrKykgewogICAgICAgIHRyaW1lc2hTaGFwZS5nZXRUcmlhbmdsZVZlcnRpY2VzKHRyaWFuZ2xlc1tpXSwgdmEsIHZiLCB2Yyk7CiAgICAgICAgdHJpbWVzaFNoYXBlLmdldE5vcm1hbCh0cmlhbmdsZXNbaV0sIG5vcm1hbCk7CiAgICAgICAgbG9jYWxTcGhlcmVQb3MudnN1Yih2YSwgdG1wKTsKICAgICAgICBsZXQgZGlzdCA9IHRtcC5kb3Qobm9ybWFsKTsKICAgICAgICBub3JtYWwuc2NhbGUoZGlzdCwgdG1wKTsKICAgICAgICBsb2NhbFNwaGVyZVBvcy52c3ViKHRtcCwgdG1wKTsgLy8gdG1wIGlzIG5vdyB0aGUgc3BoZXJlIHBvc2l0aW9uIHByb2plY3RlZCB0byB0aGUgdHJpYW5nbGUgcGxhbmUKCiAgICAgICAgZGlzdCA9IHRtcC5kaXN0YW5jZVRvKGxvY2FsU3BoZXJlUG9zKTsKCiAgICAgICAgaWYgKFJheS5wb2ludEluVHJpYW5nbGUodG1wLCB2YSwgdmIsIHZjKSAmJiBkaXN0IDwgc3BoZXJlU2hhcGUucmFkaXVzKSB7CiAgICAgICAgICBpZiAoanVzdFRlc3QpIHsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICB9CgogICAgICAgICAgbGV0IHIgPSB0aGlzLmNyZWF0ZUNvbnRhY3RFcXVhdGlvbihzcGhlcmVCb2R5LCB0cmltZXNoQm9keSwgc3BoZXJlU2hhcGUsIHRyaW1lc2hTaGFwZSwgcnNpLCByc2opOwogICAgICAgICAgdG1wLnZzdWIobG9jYWxTcGhlcmVQb3MsIHIubmkpOwogICAgICAgICAgci5uaS5ub3JtYWxpemUoKTsKICAgICAgICAgIHIubmkuc2NhbGUoc3BoZXJlU2hhcGUucmFkaXVzLCByLnJpKTsKICAgICAgICAgIHIucmkudmFkZChzcGhlcmVQb3MsIHIucmkpOwogICAgICAgICAgci5yaS52c3ViKHNwaGVyZUJvZHkucG9zaXRpb24sIHIucmkpOwogICAgICAgICAgVHJhbnNmb3JtLnBvaW50VG9Xb3JsZEZyYW1lKHRyaW1lc2hQb3MsIHRyaW1lc2hRdWF0LCB0bXAsIHRtcCk7CiAgICAgICAgICB0bXAudnN1Yih0cmltZXNoQm9keS5wb3NpdGlvbiwgci5yaik7CiAgICAgICAgICBUcmFuc2Zvcm0udmVjdG9yVG9Xb3JsZEZyYW1lKHRyaW1lc2hRdWF0LCByLm5pLCByLm5pKTsKICAgICAgICAgIFRyYW5zZm9ybS52ZWN0b3JUb1dvcmxkRnJhbWUodHJpbWVzaFF1YXQsIHIucmksIHIucmkpOwogICAgICAgICAgdGhpcy5yZXN1bHQucHVzaChyKTsKICAgICAgICAgIHRoaXMuY3JlYXRlRnJpY3Rpb25FcXVhdGlvbnNGcm9tQ29udGFjdChyLCB0aGlzLmZyaWN0aW9uUmVzdWx0KTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIHRyaWFuZ2xlcy5sZW5ndGggPSAwOwogICAgfQoKICAgIHBsYW5lVHJpbWVzaChwbGFuZVNoYXBlLCB0cmltZXNoU2hhcGUsIHBsYW5lUG9zLCB0cmltZXNoUG9zLCBwbGFuZVF1YXQsIHRyaW1lc2hRdWF0LCBwbGFuZUJvZHksIHRyaW1lc2hCb2R5LCByc2ksIHJzaiwganVzdFRlc3QpIHsKICAgICAgLy8gTWFrZSBjb250YWN0cyEKICAgICAgY29uc3QgdiA9IG5ldyBWZWMzKCk7CiAgICAgIGNvbnN0IG5vcm1hbCA9IHBsYW5lVHJpbWVzaF9ub3JtYWw7CiAgICAgIG5vcm1hbC5zZXQoMCwgMCwgMSk7CiAgICAgIHBsYW5lUXVhdC52bXVsdChub3JtYWwsIG5vcm1hbCk7IC8vIFR1cm4gbm9ybWFsIGFjY29yZGluZyB0byBwbGFuZQoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0cmltZXNoU2hhcGUudmVydGljZXMubGVuZ3RoIC8gMzsgaSsrKSB7CiAgICAgICAgLy8gR2V0IHdvcmxkIHZlcnRleCBmcm9tIHRyaW1lc2gKICAgICAgICB0cmltZXNoU2hhcGUuZ2V0VmVydGV4KGksIHYpOyAvLyBTYWZlIHVwCgogICAgICAgIGNvbnN0IHYyID0gbmV3IFZlYzMoKTsKICAgICAgICB2Mi5jb3B5KHYpOwogICAgICAgIFRyYW5zZm9ybS5wb2ludFRvV29ybGRGcmFtZSh0cmltZXNoUG9zLCB0cmltZXNoUXVhdCwgdjIsIHYpOyAvLyBDaGVjayBwbGFuZSBzaWRlCgogICAgICAgIGNvbnN0IHJlbHBvcyA9IHBsYW5lVHJpbWVzaF9yZWxwb3M7CiAgICAgICAgdi52c3ViKHBsYW5lUG9zLCByZWxwb3MpOwogICAgICAgIGNvbnN0IGRvdCA9IG5vcm1hbC5kb3QocmVscG9zKTsKCiAgICAgICAgaWYgKGRvdCA8PSAwLjApIHsKICAgICAgICAgIGlmIChqdXN0VGVzdCkgewogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgIH0KCiAgICAgICAgICBjb25zdCByID0gdGhpcy5jcmVhdGVDb250YWN0RXF1YXRpb24ocGxhbmVCb2R5LCB0cmltZXNoQm9keSwgcGxhbmVTaGFwZSwgdHJpbWVzaFNoYXBlLCByc2ksIHJzaik7CiAgICAgICAgICByLm5pLmNvcHkobm9ybWFsKTsgLy8gQ29udGFjdCBub3JtYWwgaXMgdGhlIHBsYW5lIG5vcm1hbAogICAgICAgICAgLy8gR2V0IHZlcnRleCBwb3NpdGlvbiBwcm9qZWN0ZWQgb24gcGxhbmUKCiAgICAgICAgICBjb25zdCBwcm9qZWN0ZWQgPSBwbGFuZVRyaW1lc2hfcHJvamVjdGVkOwogICAgICAgICAgbm9ybWFsLnNjYWxlKHJlbHBvcy5kb3Qobm9ybWFsKSwgcHJvamVjdGVkKTsKICAgICAgICAgIHYudnN1Yihwcm9qZWN0ZWQsIHByb2plY3RlZCk7IC8vIHJpIGlzIHRoZSBwcm9qZWN0ZWQgd29ybGQgcG9zaXRpb24gbWludXMgcGxhbmUgcG9zaXRpb24KCiAgICAgICAgICByLnJpLmNvcHkocHJvamVjdGVkKTsKICAgICAgICAgIHIucmkudnN1YihwbGFuZUJvZHkucG9zaXRpb24sIHIucmkpOwogICAgICAgICAgci5yai5jb3B5KHYpOwogICAgICAgICAgci5yai52c3ViKHRyaW1lc2hCb2R5LnBvc2l0aW9uLCByLnJqKTsgLy8gU3RvcmUgcmVzdWx0CgogICAgICAgICAgdGhpcy5yZXN1bHQucHVzaChyKTsKICAgICAgICAgIHRoaXMuY3JlYXRlRnJpY3Rpb25FcXVhdGlvbnNGcm9tQ29udGFjdChyLCB0aGlzLmZyaWN0aW9uUmVzdWx0KTsKICAgICAgICB9CiAgICAgIH0KICAgIH0gLy8gY29udmV4VHJpbWVzaCgKICAgIC8vICAgc2k6IENvbnZleFBvbHloZWRyb24sIHNqOiBUcmltZXNoLCB4aTogVmVjMywgeGo6IFZlYzMsIHFpOiBRdWF0ZXJuaW9uLCBxajogUXVhdGVybmlvbiwKICAgIC8vICAgYmk6IEJvZHksIGJqOiBCb2R5LCByc2k/OiBTaGFwZSB8IG51bGwsIHJzaj86IFNoYXBlIHwgbnVsbCwKICAgIC8vICAgZmFjZUxpc3RBPzogbnVtYmVyW10gfCBudWxsLCBmYWNlTGlzdEI/OiBudW1iZXJbXSB8IG51bGwsCiAgICAvLyApIHsKICAgIC8vICAgY29uc3Qgc2VwQXhpcyA9IGNvbnZleENvbnZleF9zZXBBeGlzOwogICAgLy8gICBpZih4aS5kaXN0YW5jZVRvKHhqKSA+IHNpLmJvdW5kaW5nU3BoZXJlUmFkaXVzICsgc2ouYm91bmRpbmdTcGhlcmVSYWRpdXMpewogICAgLy8gICAgICAgcmV0dXJuOwogICAgLy8gICB9CiAgICAvLyAgIC8vIENvbnN0cnVjdCBhIHRlbXAgaHVsbCBmb3IgZWFjaCB0cmlhbmdsZQogICAgLy8gICBjb25zdCBodWxsQiA9IG5ldyBDb252ZXhQb2x5aGVkcm9uKCk7CiAgICAvLyAgIGh1bGxCLmZhY2VzID0gW1swLDEsMl1dOwogICAgLy8gICBjb25zdCB2YSA9IG5ldyBWZWMzKCk7CiAgICAvLyAgIGNvbnN0IHZiID0gbmV3IFZlYzMoKTsKICAgIC8vICAgY29uc3QgdmMgPSBuZXcgVmVjMygpOwogICAgLy8gICBodWxsQi52ZXJ0aWNlcyA9IFsKICAgIC8vICAgICAgIHZhLAogICAgLy8gICAgICAgdmIsCiAgICAvLyAgICAgICB2YwogICAgLy8gICBdOwogICAgLy8gICBmb3IgKGxldCBpID0gMDsgaSA8IHNqLmluZGljZXMubGVuZ3RoIC8gMzsgaSsrKSB7CiAgICAvLyAgICAgICBjb25zdCB0cmlhbmdsZU5vcm1hbCA9IG5ldyBWZWMzKCk7CiAgICAvLyAgICAgICBzai5nZXROb3JtYWwoaSwgdHJpYW5nbGVOb3JtYWwpOwogICAgLy8gICAgICAgaHVsbEIuZmFjZU5vcm1hbHMgPSBbdHJpYW5nbGVOb3JtYWxdOwogICAgLy8gICAgICAgc2ouZ2V0VHJpYW5nbGVWZXJ0aWNlcyhpLCB2YSwgdmIsIHZjKTsKICAgIC8vICAgICAgIGxldCBkID0gc2kudGVzdFNlcEF4aXModHJpYW5nbGVOb3JtYWwsIGh1bGxCLCB4aSwgcWksIHhqLCBxaik7CiAgICAvLyAgICAgICBpZighZCl7CiAgICAvLyAgICAgICAgICAgdHJpYW5nbGVOb3JtYWwuc2NhbGUoLTEsIHRyaWFuZ2xlTm9ybWFsKTsKICAgIC8vICAgICAgICAgICBkID0gc2kudGVzdFNlcEF4aXModHJpYW5nbGVOb3JtYWwsIGh1bGxCLCB4aSwgcWksIHhqLCBxaik7CiAgICAvLyAgICAgICAgICAgaWYoIWQpewogICAgLy8gICAgICAgICAgICAgICBjb250aW51ZTsKICAgIC8vICAgICAgICAgICB9CiAgICAvLyAgICAgICB9CiAgICAvLyAgICAgICBjb25zdCByZXM6IENvbnZleFBvbHloZWRyb25Db250YWN0UG9pbnRbXSA9IFtdOwogICAgLy8gICAgICAgY29uc3QgcSA9IGNvbnZleENvbnZleF9xOwogICAgLy8gICAgICAgc2kuY2xpcEFnYWluc3RIdWxsKHhpLHFpLGh1bGxCLHhqLHFqLHRyaWFuZ2xlTm9ybWFsLC0xMDAsMTAwLHJlcyk7CiAgICAvLyAgICAgICBmb3IobGV0IGogPSAwOyBqICE9PSByZXMubGVuZ3RoOyBqKyspewogICAgLy8gICAgICAgICAgIGNvbnN0IHIgPSB0aGlzLmNyZWF0ZUNvbnRhY3RFcXVhdGlvbihiaSxiaixzaSxzaixyc2kscnNqKSwKICAgIC8vICAgICAgICAgICAgICAgcmkgPSByLnJpLAogICAgLy8gICAgICAgICAgICAgICByaiA9IHIucmo7CiAgICAvLyAgICAgICAgICAgci5uaS5jb3B5KHRyaWFuZ2xlTm9ybWFsKTsKICAgIC8vICAgICAgICAgICByLm5pLm5lZ2F0ZShyLm5pKTsKICAgIC8vICAgICAgICAgICByZXNbal0ubm9ybWFsLm5lZ2F0ZShxKTsKICAgIC8vICAgICAgICAgICBxLm11bHQocmVzW2pdLmRlcHRoLCBxKTsKICAgIC8vICAgICAgICAgICByZXNbal0ucG9pbnQudmFkZChxLCByaSk7CiAgICAvLyAgICAgICAgICAgcmouY29weShyZXNbal0ucG9pbnQpOwogICAgLy8gICAgICAgICAgIC8vIENvbnRhY3QgcG9pbnRzIGFyZSBpbiB3b3JsZCBjb29yZGluYXRlcy4gVHJhbnNmb3JtIGJhY2sgdG8gcmVsYXRpdmUKICAgIC8vICAgICAgICAgICByaS52c3ViKHhpLHJpKTsKICAgIC8vICAgICAgICAgICByai52c3ViKHhqLHJqKTsKICAgIC8vICAgICAgICAgICAvLyBNYWtlIHJlbGF0aXZlIHRvIGJvZGllcwogICAgLy8gICAgICAgICAgIHJpLnZhZGQoeGksIHJpKTsKICAgIC8vICAgICAgICAgICByaS52c3ViKGJpLnBvc2l0aW9uLCByaSk7CiAgICAvLyAgICAgICAgICAgcmoudmFkZCh4aiwgcmopOwogICAgLy8gICAgICAgICAgIHJqLnZzdWIoYmoucG9zaXRpb24sIHJqKTsKICAgIC8vICAgICAgICAgICByZXN1bHQucHVzaChyKTsKICAgIC8vICAgICAgIH0KICAgIC8vICAgfQogICAgLy8gfQoKCiAgfQogIGNvbnN0IGF2ZXJhZ2VOb3JtYWwgPSBuZXcgVmVjMygpOwogIGNvbnN0IGF2ZXJhZ2VDb250YWN0UG9pbnRBID0gbmV3IFZlYzMoKTsKICBjb25zdCBhdmVyYWdlQ29udGFjdFBvaW50QiA9IG5ldyBWZWMzKCk7CiAgY29uc3QgdG1wVmVjMSA9IG5ldyBWZWMzKCk7CiAgY29uc3QgdG1wVmVjMiA9IG5ldyBWZWMzKCk7CiAgY29uc3QgdG1wUXVhdDEgPSBuZXcgUXVhdGVybmlvbigpOwogIGNvbnN0IHRtcFF1YXQyID0gbmV3IFF1YXRlcm5pb24oKTsKCiAgY29uc3QgcGxhbmVUcmltZXNoX25vcm1hbCA9IG5ldyBWZWMzKCk7CiAgY29uc3QgcGxhbmVUcmltZXNoX3JlbHBvcyA9IG5ldyBWZWMzKCk7CiAgY29uc3QgcGxhbmVUcmltZXNoX3Byb2plY3RlZCA9IG5ldyBWZWMzKCk7CiAgY29uc3Qgc3BoZXJlVHJpbWVzaF9ub3JtYWwgPSBuZXcgVmVjMygpOwogIGNvbnN0IHNwaGVyZVRyaW1lc2hfcmVscG9zID0gbmV3IFZlYzMoKTsKICBuZXcgVmVjMygpOwogIGNvbnN0IHNwaGVyZVRyaW1lc2hfdiA9IG5ldyBWZWMzKCk7CiAgY29uc3Qgc3BoZXJlVHJpbWVzaF92MiA9IG5ldyBWZWMzKCk7CiAgY29uc3Qgc3BoZXJlVHJpbWVzaF9lZGdlVmVydGV4QSA9IG5ldyBWZWMzKCk7CiAgY29uc3Qgc3BoZXJlVHJpbWVzaF9lZGdlVmVydGV4QiA9IG5ldyBWZWMzKCk7CiAgY29uc3Qgc3BoZXJlVHJpbWVzaF9lZGdlVmVjdG9yID0gbmV3IFZlYzMoKTsKICBjb25zdCBzcGhlcmVUcmltZXNoX2VkZ2VWZWN0b3JVbml0ID0gbmV3IFZlYzMoKTsKICBjb25zdCBzcGhlcmVUcmltZXNoX2xvY2FsU3BoZXJlUG9zID0gbmV3IFZlYzMoKTsKICBjb25zdCBzcGhlcmVUcmltZXNoX3RtcCA9IG5ldyBWZWMzKCk7CiAgY29uc3Qgc3BoZXJlVHJpbWVzaF92YSA9IG5ldyBWZWMzKCk7CiAgY29uc3Qgc3BoZXJlVHJpbWVzaF92YiA9IG5ldyBWZWMzKCk7CiAgY29uc3Qgc3BoZXJlVHJpbWVzaF92YyA9IG5ldyBWZWMzKCk7CiAgY29uc3Qgc3BoZXJlVHJpbWVzaF9sb2NhbFNwaGVyZUFBQkIgPSBuZXcgQUFCQigpOwogIGNvbnN0IHNwaGVyZVRyaW1lc2hfdHJpYW5nbGVzID0gW107CiAgY29uc3QgcG9pbnRfb25fcGxhbmVfdG9fc3BoZXJlID0gbmV3IFZlYzMoKTsKICBjb25zdCBwbGFuZV90b19zcGhlcmVfb3J0aG8gPSBuZXcgVmVjMygpOyAvLyBTZWUgaHR0cDovL2J1bGxldHBoeXNpY3MuY29tL0J1bGxldC9CdWxsZXRGdWxsL1NwaGVyZVRyaWFuZ2xlRGV0ZWN0b3JfOGNwcF9zb3VyY2UuaHRtbAoKICBjb25zdCBwb2ludEluUG9seWdvbl9lZGdlID0gbmV3IFZlYzMoKTsKICBjb25zdCBwb2ludEluUG9seWdvbl9lZGdlX3hfbm9ybWFsID0gbmV3IFZlYzMoKTsKICBjb25zdCBwb2ludEluUG9seWdvbl92dHAgPSBuZXcgVmVjMygpOwoKICBmdW5jdGlvbiBwb2ludEluUG9seWdvbih2ZXJ0cywgbm9ybWFsLCBwKSB7CiAgICBsZXQgcG9zaXRpdmVSZXN1bHQgPSBudWxsOwogICAgY29uc3QgTiA9IHZlcnRzLmxlbmd0aDsKCiAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gTjsgaSsrKSB7CiAgICAgIGNvbnN0IHYgPSB2ZXJ0c1tpXTsgLy8gR2V0IGVkZ2UgdG8gdGhlIG5leHQgdmVydGV4CgogICAgICBjb25zdCBlZGdlID0gcG9pbnRJblBvbHlnb25fZWRnZTsKICAgICAgdmVydHNbKGkgKyAxKSAlIE5dLnZzdWIodiwgZWRnZSk7IC8vIEdldCBjcm9zcyBwcm9kdWN0IGJldHdlZW4gcG9seWdvbiBub3JtYWwgYW5kIHRoZSBlZGdlCgogICAgICBjb25zdCBlZGdlX3hfbm9ybWFsID0gcG9pbnRJblBvbHlnb25fZWRnZV94X25vcm1hbDsgLy9jb25zdCBlZGdlX3hfbm9ybWFsID0gbmV3IFZlYzMoKTsKCiAgICAgIGVkZ2UuY3Jvc3Mobm9ybWFsLCBlZGdlX3hfbm9ybWFsKTsgLy8gR2V0IHZlY3RvciBiZXR3ZWVuIHBvaW50IGFuZCBjdXJyZW50IHZlcnRleAoKICAgICAgY29uc3QgdmVydGV4X3RvX3AgPSBwb2ludEluUG9seWdvbl92dHA7CiAgICAgIHAudnN1Yih2LCB2ZXJ0ZXhfdG9fcCk7IC8vIFRoaXMgZG90IHByb2R1Y3QgZGV0ZXJtaW5lcyB3aGljaCBzaWRlIG9mIHRoZSBlZGdlIHRoZSBwb2ludCBpcwoKICAgICAgY29uc3QgciA9IGVkZ2VfeF9ub3JtYWwuZG90KHZlcnRleF90b19wKTsgLy8gSWYgYWxsIHN1Y2ggZG90IHByb2R1Y3RzIGhhdmUgc2FtZSBzaWduLCB3ZSBhcmUgaW5zaWRlIHRoZSBwb2x5Z29uLgoKICAgICAgaWYgKHBvc2l0aXZlUmVzdWx0ID09PSBudWxsIHx8IHIgPiAwICYmIHBvc2l0aXZlUmVzdWx0ID09PSB0cnVlIHx8IHIgPD0gMCAmJiBwb3NpdGl2ZVJlc3VsdCA9PT0gZmFsc2UpIHsKICAgICAgICBpZiAocG9zaXRpdmVSZXN1bHQgPT09IG51bGwpIHsKICAgICAgICAgIHBvc2l0aXZlUmVzdWx0ID0gciA+IDA7CiAgICAgICAgfQoKICAgICAgICBjb250aW51ZTsKICAgICAgfSBlbHNlIHsKICAgICAgICByZXR1cm4gZmFsc2U7IC8vIEVuY291bnRlcmVkIHNvbWUgb3RoZXIgc2lnbi4gRXhpdC4KICAgICAgfQogICAgfSAvLyBJZiB3ZSBnb3QgaGVyZSwgYWxsIGRvdCBwcm9kdWN0cyB3ZXJlIG9mIHRoZSBzYW1lIHNpZ24uCgoKICAgIHJldHVybiB0cnVlOwogIH0KCiAgY29uc3QgYm94X3RvX3NwaGVyZSA9IG5ldyBWZWMzKCk7CiAgY29uc3Qgc3BoZXJlQm94X25zID0gbmV3IFZlYzMoKTsKICBjb25zdCBzcGhlcmVCb3hfbnMxID0gbmV3IFZlYzMoKTsKICBjb25zdCBzcGhlcmVCb3hfbnMyID0gbmV3IFZlYzMoKTsKICBjb25zdCBzcGhlcmVCb3hfc2lkZXMgPSBbbmV3IFZlYzMoKSwgbmV3IFZlYzMoKSwgbmV3IFZlYzMoKSwgbmV3IFZlYzMoKSwgbmV3IFZlYzMoKSwgbmV3IFZlYzMoKV07CiAgY29uc3Qgc3BoZXJlQm94X3NwaGVyZV90b19jb3JuZXIgPSBuZXcgVmVjMygpOwogIGNvbnN0IHNwaGVyZUJveF9zaWRlX25zID0gbmV3IFZlYzMoKTsKICBjb25zdCBzcGhlcmVCb3hfc2lkZV9uczEgPSBuZXcgVmVjMygpOwogIGNvbnN0IHNwaGVyZUJveF9zaWRlX25zMiA9IG5ldyBWZWMzKCk7CiAgY29uc3QgY29udmV4X3RvX3NwaGVyZSA9IG5ldyBWZWMzKCk7CiAgY29uc3Qgc3BoZXJlQ29udmV4X2VkZ2UgPSBuZXcgVmVjMygpOwogIGNvbnN0IHNwaGVyZUNvbnZleF9lZGdlVW5pdCA9IG5ldyBWZWMzKCk7CiAgY29uc3Qgc3BoZXJlQ29udmV4X3NwaGVyZVRvQ29ybmVyID0gbmV3IFZlYzMoKTsKICBjb25zdCBzcGhlcmVDb252ZXhfd29ybGRDb3JuZXIgPSBuZXcgVmVjMygpOwogIGNvbnN0IHNwaGVyZUNvbnZleF93b3JsZE5vcm1hbCA9IG5ldyBWZWMzKCk7CiAgY29uc3Qgc3BoZXJlQ29udmV4X3dvcmxkUG9pbnQgPSBuZXcgVmVjMygpOwogIGNvbnN0IHNwaGVyZUNvbnZleF93b3JsZFNwaGVyZVBvaW50Q2xvc2VzdFRvUGxhbmUgPSBuZXcgVmVjMygpOwogIGNvbnN0IHNwaGVyZUNvbnZleF9wZW5ldHJhdGlvblZlYyA9IG5ldyBWZWMzKCk7CiAgY29uc3Qgc3BoZXJlQ29udmV4X3NwaGVyZVRvV29ybGRQb2ludCA9IG5ldyBWZWMzKCk7CiAgbmV3IFZlYzMoKTsKICBuZXcgVmVjMygpOwogIGNvbnN0IHBsYW5lQ29udmV4X3YgPSBuZXcgVmVjMygpOwogIGNvbnN0IHBsYW5lQ29udmV4X25vcm1hbCA9IG5ldyBWZWMzKCk7CiAgY29uc3QgcGxhbmVDb252ZXhfcmVscG9zID0gbmV3IFZlYzMoKTsKICBjb25zdCBwbGFuZUNvbnZleF9wcm9qZWN0ZWQgPSBuZXcgVmVjMygpOwogIGNvbnN0IGNvbnZleENvbnZleF9zZXBBeGlzID0gbmV3IFZlYzMoKTsKICBjb25zdCBjb252ZXhDb252ZXhfcSA9IG5ldyBWZWMzKCk7CiAgY29uc3QgcGFydGljbGVQbGFuZV9ub3JtYWwgPSBuZXcgVmVjMygpOwogIGNvbnN0IHBhcnRpY2xlUGxhbmVfcmVscG9zID0gbmV3IFZlYzMoKTsKICBjb25zdCBwYXJ0aWNsZVBsYW5lX3Byb2plY3RlZCA9IG5ldyBWZWMzKCk7CiAgY29uc3QgcGFydGljbGVTcGhlcmVfbm9ybWFsID0gbmV3IFZlYzMoKTsgLy8gV0lQCgogIGNvbnN0IGNxaiA9IG5ldyBRdWF0ZXJuaW9uKCk7CiAgY29uc3QgY29udmV4UGFydGljbGVfbG9jYWwgPSBuZXcgVmVjMygpOwogIG5ldyBWZWMzKCk7CiAgY29uc3QgY29udmV4UGFydGljbGVfcGVuZXRyYXRlZEZhY2VOb3JtYWwgPSBuZXcgVmVjMygpOwogIGNvbnN0IGNvbnZleFBhcnRpY2xlX3ZlcnRleFRvUGFydGljbGUgPSBuZXcgVmVjMygpOwogIGNvbnN0IGNvbnZleFBhcnRpY2xlX3dvcmxkUGVuZXRyYXRpb25WZWMgPSBuZXcgVmVjMygpOwogIGNvbnN0IGNvbnZleEhlaWdodGZpZWxkX3RtcDEgPSBuZXcgVmVjMygpOwogIGNvbnN0IGNvbnZleEhlaWdodGZpZWxkX3RtcDIgPSBuZXcgVmVjMygpOwogIGNvbnN0IGNvbnZleEhlaWdodGZpZWxkX2ZhY2VMaXN0ID0gWzBdOwogIGNvbnN0IHNwaGVyZUhlaWdodGZpZWxkX3RtcDEgPSBuZXcgVmVjMygpOwogIGNvbnN0IHNwaGVyZUhlaWdodGZpZWxkX3RtcDIgPSBuZXcgVmVjMygpOwoKICBjbGFzcyBPdmVybGFwS2VlcGVyIHsKICAgIC8qKgogICAgICogQHRvZG8gUmVtb3ZlIHVzZWxlc3MgY29uc3RydWN0b3IKICAgICAqLwogICAgY29uc3RydWN0b3IoKSB7CiAgICAgIHRoaXMuY3VycmVudCA9IFtdOwogICAgICB0aGlzLnByZXZpb3VzID0gW107CiAgICB9CiAgICAvKioKICAgICAqIGdldEtleQogICAgICovCgoKICAgIGdldEtleShpLCBqKSB7CiAgICAgIGlmIChqIDwgaSkgewogICAgICAgIGNvbnN0IHRlbXAgPSBqOwogICAgICAgIGogPSBpOwogICAgICAgIGkgPSB0ZW1wOwogICAgICB9CgogICAgICByZXR1cm4gaSA8PCAxNiB8IGo7CiAgICB9CiAgICAvKioKICAgICAqIHNldAogICAgICovCgoKICAgIHNldChpLCBqKSB7CiAgICAgIC8vIEluc2VydGlvbiBzb3J0LiBUaGlzIHdheSB0aGUgZGlmZiB3aWxsIGhhdmUgbGluZWFyIGNvbXBsZXhpdHkuCiAgICAgIGNvbnN0IGtleSA9IHRoaXMuZ2V0S2V5KGksIGopOwogICAgICBjb25zdCBjdXJyZW50ID0gdGhpcy5jdXJyZW50OwogICAgICBsZXQgaW5kZXggPSAwOwoKICAgICAgd2hpbGUgKGtleSA+IGN1cnJlbnRbaW5kZXhdKSB7CiAgICAgICAgaW5kZXgrKzsKICAgICAgfQoKICAgICAgaWYgKGtleSA9PT0gY3VycmVudFtpbmRleF0pIHsKICAgICAgICByZXR1cm47IC8vIFBhaXIgd2FzIGFscmVhZHkgYWRkZWQKICAgICAgfQoKICAgICAgZm9yIChsZXQgaiA9IGN1cnJlbnQubGVuZ3RoIC0gMTsgaiA+PSBpbmRleDsgai0tKSB7CiAgICAgICAgY3VycmVudFtqICsgMV0gPSBjdXJyZW50W2pdOwogICAgICB9CgogICAgICBjdXJyZW50W2luZGV4XSA9IGtleTsKICAgIH0KICAgIC8qKgogICAgICogdGljawogICAgICovCgoKICAgIHRpY2soKSB7CiAgICAgIGNvbnN0IHRtcCA9IHRoaXMuY3VycmVudDsKICAgICAgdGhpcy5jdXJyZW50ID0gdGhpcy5wcmV2aW91czsKICAgICAgdGhpcy5wcmV2aW91cyA9IHRtcDsKICAgICAgdGhpcy5jdXJyZW50Lmxlbmd0aCA9IDA7CiAgICB9CiAgICAvKioKICAgICAqIGdldERpZmYKICAgICAqLwoKCiAgICBnZXREaWZmKGFkZGl0aW9ucywgcmVtb3ZhbHMpIHsKICAgICAgY29uc3QgYSA9IHRoaXMuY3VycmVudDsKICAgICAgY29uc3QgYiA9IHRoaXMucHJldmlvdXM7CiAgICAgIGNvbnN0IGFsID0gYS5sZW5ndGg7CiAgICAgIGNvbnN0IGJsID0gYi5sZW5ndGg7CiAgICAgIGxldCBqID0gMDsKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgYWw7IGkrKykgewogICAgICAgIGxldCBmb3VuZCA9IGZhbHNlOwogICAgICAgIGNvbnN0IGtleUEgPSBhW2ldOwoKICAgICAgICB3aGlsZSAoa2V5QSA+IGJbal0pIHsKICAgICAgICAgIGorKzsKICAgICAgICB9CgogICAgICAgIGZvdW5kID0ga2V5QSA9PT0gYltqXTsKCiAgICAgICAgaWYgKCFmb3VuZCkgewogICAgICAgICAgdW5wYWNrQW5kUHVzaChhZGRpdGlvbnMsIGtleUEpOwogICAgICAgIH0KICAgICAgfQoKICAgICAgaiA9IDA7CgogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGJsOyBpKyspIHsKICAgICAgICBsZXQgZm91bmQgPSBmYWxzZTsKICAgICAgICBjb25zdCBrZXlCID0gYltpXTsKCiAgICAgICAgd2hpbGUgKGtleUIgPiBhW2pdKSB7CiAgICAgICAgICBqKys7CiAgICAgICAgfQoKICAgICAgICBmb3VuZCA9IGFbal0gPT09IGtleUI7CgogICAgICAgIGlmICghZm91bmQpIHsKICAgICAgICAgIHVucGFja0FuZFB1c2gocmVtb3ZhbHMsIGtleUIpOwogICAgICAgIH0KICAgICAgfQogICAgfQoKICB9CgogIGZ1bmN0aW9uIHVucGFja0FuZFB1c2goYXJyYXksIGtleSkgewogICAgYXJyYXkucHVzaCgoa2V5ICYgMHhmZmZmMDAwMCkgPj4gMTYsIGtleSAmIDB4MDAwMGZmZmYpOwogIH0KCiAgY29uc3QgZ2V0S2V5ID0gKGksIGopID0+IGkgPCBqID8gYCR7aX0tJHtqfWAgOiBgJHtqfS0ke2l9YDsKICAvKioKICAgKiBUdXBsZURpY3Rpb25hcnkKICAgKi8KCgogIGNsYXNzIFR1cGxlRGljdGlvbmFyeSB7CiAgICBjb25zdHJ1Y3RvcigpIHsKICAgICAgdGhpcy5kYXRhID0gewogICAgICAgIGtleXM6IFtdCiAgICAgIH07CiAgICB9CgogICAgLyoqIGdldCAqLwogICAgZ2V0KGksIGopIHsKICAgICAgY29uc3Qga2V5ID0gZ2V0S2V5KGksIGopOwogICAgICByZXR1cm4gdGhpcy5kYXRhW2tleV07CiAgICB9CiAgICAvKiogc2V0ICovCgoKICAgIHNldChpLCBqLCB2YWx1ZSkgewogICAgICBjb25zdCBrZXkgPSBnZXRLZXkoaSwgaik7IC8vIENoZWNrIGlmIGtleSBhbHJlYWR5IGV4aXN0cwoKICAgICAgaWYgKCF0aGlzLmdldChpLCBqKSkgewogICAgICAgIHRoaXMuZGF0YS5rZXlzLnB1c2goa2V5KTsKICAgICAgfQoKICAgICAgdGhpcy5kYXRhW2tleV0gPSB2YWx1ZTsKICAgIH0KICAgIC8qKiBkZWxldGUgKi8KCgogICAgZGVsZXRlKGksIGopIHsKICAgICAgY29uc3Qga2V5ID0gZ2V0S2V5KGksIGopOwogICAgICBjb25zdCBpbmRleCA9IHRoaXMuZGF0YS5rZXlzLmluZGV4T2Yoa2V5KTsKCiAgICAgIGlmIChpbmRleCAhPT0gLTEpIHsKICAgICAgICB0aGlzLmRhdGEua2V5cy5zcGxpY2UoaW5kZXgsIDEpOwogICAgICB9CgogICAgICBkZWxldGUgdGhpcy5kYXRhW2tleV07CiAgICB9CiAgICAvKiogcmVzZXQgKi8KCgogICAgcmVzZXQoKSB7CiAgICAgIGNvbnN0IGRhdGEgPSB0aGlzLmRhdGE7CiAgICAgIGNvbnN0IGtleXMgPSBkYXRhLmtleXM7CgogICAgICB3aGlsZSAoa2V5cy5sZW5ndGggPiAwKSB7CiAgICAgICAgY29uc3Qga2V5ID0ga2V5cy5wb3AoKTsKICAgICAgICBkZWxldGUgZGF0YVtrZXldOwogICAgICB9CiAgICB9CgogIH0KCiAgLyoqCiAgICogVGhlIHBoeXNpY3Mgd29ybGQKICAgKi8KICBjbGFzcyBXb3JsZCBleHRlbmRzIEV2ZW50VGFyZ2V0IHsKICAgIC8qKgogICAgICogQ3VycmVudGx5IC8gbGFzdCB1c2VkIHRpbWVzdGVwLiBJcyBzZXQgdG8gLTEgaWYgbm90IGF2YWlsYWJsZS4gVGhpcyB2YWx1ZSBpcyB1cGRhdGVkIGJlZm9yZSBlYWNoIGludGVybmFsIHN0ZXAsIHdoaWNoIG1lYW5zIHRoYXQgaXQgaXMgImZyZXNoIiBpbnNpZGUgZXZlbnQgY2FsbGJhY2tzLgogICAgICovCgogICAgLyoqCiAgICAgKiBNYWtlcyBib2RpZXMgZ28gdG8gc2xlZXAgd2hlbiB0aGV5J3ZlIGJlZW4gaW5hY3RpdmUuCiAgICAgKiBAZGVmYXVsdCBmYWxzZQogICAgICovCgogICAgLyoqCiAgICAgKiBBbGwgdGhlIGN1cnJlbnQgY29udGFjdHMgKGluc3RhbmNlcyBvZiBDb250YWN0RXF1YXRpb24pIGluIHRoZSB3b3JsZC4KICAgICAqLwoKICAgIC8qKgogICAgICogSG93IG9mdGVuIHRvIG5vcm1hbGl6ZSBxdWF0ZXJuaW9ucy4gU2V0IHRvIDAgZm9yIGV2ZXJ5IHN0ZXAsIDEgZm9yIGV2ZXJ5IHNlY29uZCBldGMuLiBBIGxhcmdlciB2YWx1ZSBpbmNyZWFzZXMgcGVyZm9ybWFuY2UuIElmIGJvZGllcyB0ZW5kIHRvIGV4cGxvZGUsIHNldCB0byBhIHNtYWxsZXIgdmFsdWUgKHplcm8gdG8gYmUgc3VyZSBub3RoaW5nIGNhbiBnbyB3cm9uZykuCiAgICAgKiBAZGVmYXVsdCAwCiAgICAgKi8KCiAgICAvKioKICAgICAqIFNldCB0byB0cnVlIHRvIHVzZSBmYXN0IHF1YXRlcm5pb24gbm9ybWFsaXphdGlvbi4gSXQgaXMgb2Z0ZW4gZW5vdWdoIGFjY3VyYXRlIHRvIHVzZS4KICAgICAqIElmIGJvZGllcyB0ZW5kIHRvIGV4cGxvZGUsIHNldCB0byBmYWxzZS4KICAgICAqIEBkZWZhdWx0IGZhbHNlCiAgICAgKi8KCiAgICAvKioKICAgICAqIFRoZSB3YWxsLWNsb2NrIHRpbWUgc2luY2Ugc2ltdWxhdGlvbiBzdGFydC4KICAgICAqLwoKICAgIC8qKgogICAgICogTnVtYmVyIG9mIHRpbWVzdGVwcyB0YWtlbiBzaW5jZSBzdGFydC4KICAgICAqLwoKICAgIC8qKgogICAgICogRGVmYXVsdCBhbmQgbGFzdCB0aW1lc3RlcCBzaXplcy4KICAgICAqLwoKICAgIC8qKgogICAgICogVGhlIGdyYXZpdHkgb2YgdGhlIHdvcmxkLgogICAgICovCgogICAgLyoqCiAgICAgKiBHcmF2aXR5IHRvIHVzZSB3aGVuIGFwcHJveGltYXRpbmcgdGhlIGZyaWN0aW9uIG1heCBmb3JjZSAobXUqbWFzcypncmF2aXR5KS4KICAgICAqIElmIHVuZGVmaW5lZCwgZ2xvYmFsIGdyYXZpdHkgd2lsbCBiZSB1c2VkLgogICAgICogVXNlIHRvIGVuYWJsZSBmcmljdGlvbiBpbiBhIFdvcmxkIHdpdGggYSBudWxsIGdyYXZpdHkgdmVjdG9yIChubyBncmF2aXR5KS4KICAgICAqLwoKICAgIC8qKgogICAgICogVGhlIGJyb2FkcGhhc2UgYWxnb3JpdGhtIHRvIHVzZS4KICAgICAqIEBkZWZhdWx0IE5haXZlQnJvYWRwaGFzZQogICAgICovCgogICAgLyoqCiAgICAgKiBBbGwgYm9kaWVzIGluIHRoaXMgd29ybGQKICAgICAqLwoKICAgIC8qKgogICAgICogVHJ1ZSBpZiBhbnkgYm9kaWVzIGFyZSBub3Qgc2xlZXBpbmcsIGZhbHNlIGlmIGV2ZXJ5IGJvZHkgaXMgc2xlZXBpbmcuCiAgICAgKi8KCiAgICAvKioKICAgICAqIFRoZSBzb2x2ZXIgYWxnb3JpdGhtIHRvIHVzZS4KICAgICAqIEBkZWZhdWx0IEdTU29sdmVyCiAgICAgKi8KCiAgICAvKioKICAgICAqIGNvbGxpc2lvbk1hdHJpeAogICAgICovCgogICAgLyoqCiAgICAgKiBDb2xsaXNpb25NYXRyaXggZnJvbSB0aGUgcHJldmlvdXMgc3RlcC4KICAgICAqLwoKICAgIC8qKgogICAgICogQWxsIGFkZGVkIGNvbnRhY3RtYXRlcmlhbHMuCiAgICAgKi8KCiAgICAvKioKICAgICAqIFVzZWQgdG8gbG9vayB1cCBhIENvbnRhY3RNYXRlcmlhbCBnaXZlbiB0d28gaW5zdGFuY2VzIG9mIE1hdGVyaWFsLgogICAgICovCgogICAgLyoqCiAgICAgKiBUaGUgZGVmYXVsdCBtYXRlcmlhbCBvZiB0aGUgYm9kaWVzLgogICAgICovCgogICAgLyoqCiAgICAgKiBUaGlzIGNvbnRhY3QgbWF0ZXJpYWwgaXMgdXNlZCBpZiBubyBzdWl0YWJsZSBjb250YWN0bWF0ZXJpYWwgaXMgZm91bmQgZm9yIGEgY29udGFjdC4KICAgICAqLwoKICAgIC8qKgogICAgICogVGltZSBhY2N1bXVsYXRvciBmb3IgaW50ZXJwb2xhdGlvbi4KICAgICAqIEBzZWUgaHR0cHM6Ly9nYWZmZXJvbmdhbWVzLmNvbS9nYW1lLXBoeXNpY3MvZml4LXlvdXItdGltZXN0ZXAvCiAgICAgKi8KCiAgICAvKioKICAgICAqIERpc3BhdGNoZWQgYWZ0ZXIgYSBib2R5IGhhcyBiZWVuIGFkZGVkIHRvIHRoZSB3b3JsZC4KICAgICAqLwoKICAgIC8qKgogICAgICogRGlzcGF0Y2hlZCBhZnRlciBhIGJvZHkgaGFzIGJlZW4gcmVtb3ZlZCBmcm9tIHRoZSB3b3JsZC4KICAgICAqLwogICAgY29uc3RydWN0b3Iob3B0aW9ucykgewogICAgICBpZiAob3B0aW9ucyA9PT0gdm9pZCAwKSB7CiAgICAgICAgb3B0aW9ucyA9IHt9OwogICAgICB9CgogICAgICBzdXBlcigpOwogICAgICB0aGlzLmR0ID0gLTE7CiAgICAgIHRoaXMuYWxsb3dTbGVlcCA9ICEhb3B0aW9ucy5hbGxvd1NsZWVwOwogICAgICB0aGlzLmNvbnRhY3RzID0gW107CiAgICAgIHRoaXMuZnJpY3Rpb25FcXVhdGlvbnMgPSBbXTsKICAgICAgdGhpcy5xdWF0Tm9ybWFsaXplU2tpcCA9IG9wdGlvbnMucXVhdE5vcm1hbGl6ZVNraXAgIT09IHVuZGVmaW5lZCA/IG9wdGlvbnMucXVhdE5vcm1hbGl6ZVNraXAgOiAwOwogICAgICB0aGlzLnF1YXROb3JtYWxpemVGYXN0ID0gb3B0aW9ucy5xdWF0Tm9ybWFsaXplRmFzdCAhPT0gdW5kZWZpbmVkID8gb3B0aW9ucy5xdWF0Tm9ybWFsaXplRmFzdCA6IGZhbHNlOwogICAgICB0aGlzLnRpbWUgPSAwLjA7CiAgICAgIHRoaXMuc3RlcG51bWJlciA9IDA7CiAgICAgIHRoaXMuZGVmYXVsdF9kdCA9IDEgLyA2MDsKICAgICAgdGhpcy5uZXh0SWQgPSAwOwogICAgICB0aGlzLmdyYXZpdHkgPSBuZXcgVmVjMygpOwoKICAgICAgaWYgKG9wdGlvbnMuZ3Jhdml0eSkgewogICAgICAgIHRoaXMuZ3Jhdml0eS5jb3B5KG9wdGlvbnMuZ3Jhdml0eSk7CiAgICAgIH0KCiAgICAgIGlmIChvcHRpb25zLmZyaWN0aW9uR3Jhdml0eSkgewogICAgICAgIHRoaXMuZnJpY3Rpb25HcmF2aXR5ID0gbmV3IFZlYzMoKTsKICAgICAgICB0aGlzLmZyaWN0aW9uR3Jhdml0eS5jb3B5KG9wdGlvbnMuZnJpY3Rpb25HcmF2aXR5KTsKICAgICAgfQoKICAgICAgdGhpcy5icm9hZHBoYXNlID0gb3B0aW9ucy5icm9hZHBoYXNlICE9PSB1bmRlZmluZWQgPyBvcHRpb25zLmJyb2FkcGhhc2UgOiBuZXcgTmFpdmVCcm9hZHBoYXNlKCk7CiAgICAgIHRoaXMuYm9kaWVzID0gW107CiAgICAgIHRoaXMuaGFzQWN0aXZlQm9kaWVzID0gZmFsc2U7CiAgICAgIHRoaXMuc29sdmVyID0gb3B0aW9ucy5zb2x2ZXIgIT09IHVuZGVmaW5lZCA/IG9wdGlvbnMuc29sdmVyIDogbmV3IEdTU29sdmVyKCk7CiAgICAgIHRoaXMuY29uc3RyYWludHMgPSBbXTsKICAgICAgdGhpcy5uYXJyb3dwaGFzZSA9IG5ldyBOYXJyb3dwaGFzZSh0aGlzKTsKICAgICAgdGhpcy5jb2xsaXNpb25NYXRyaXggPSBuZXcgQXJyYXlDb2xsaXNpb25NYXRyaXgoKTsKICAgICAgdGhpcy5jb2xsaXNpb25NYXRyaXhQcmV2aW91cyA9IG5ldyBBcnJheUNvbGxpc2lvbk1hdHJpeCgpOwogICAgICB0aGlzLmJvZHlPdmVybGFwS2VlcGVyID0gbmV3IE92ZXJsYXBLZWVwZXIoKTsKICAgICAgdGhpcy5zaGFwZU92ZXJsYXBLZWVwZXIgPSBuZXcgT3ZlcmxhcEtlZXBlcigpOwogICAgICB0aGlzLmNvbnRhY3RtYXRlcmlhbHMgPSBbXTsKICAgICAgdGhpcy5jb250YWN0TWF0ZXJpYWxUYWJsZSA9IG5ldyBUdXBsZURpY3Rpb25hcnkoKTsKICAgICAgdGhpcy5kZWZhdWx0TWF0ZXJpYWwgPSBuZXcgTWF0ZXJpYWwoJ2RlZmF1bHQnKTsKICAgICAgdGhpcy5kZWZhdWx0Q29udGFjdE1hdGVyaWFsID0gbmV3IENvbnRhY3RNYXRlcmlhbCh0aGlzLmRlZmF1bHRNYXRlcmlhbCwgdGhpcy5kZWZhdWx0TWF0ZXJpYWwsIHsKICAgICAgICBmcmljdGlvbjogMC4zLAogICAgICAgIHJlc3RpdHV0aW9uOiAwLjAKICAgICAgfSk7CiAgICAgIHRoaXMuZG9Qcm9maWxpbmcgPSBmYWxzZTsKICAgICAgdGhpcy5wcm9maWxlID0gewogICAgICAgIHNvbHZlOiAwLAogICAgICAgIG1ha2VDb250YWN0Q29uc3RyYWludHM6IDAsCiAgICAgICAgYnJvYWRwaGFzZTogMCwKICAgICAgICBpbnRlZ3JhdGU6IDAsCiAgICAgICAgbmFycm93cGhhc2U6IDAKICAgICAgfTsKICAgICAgdGhpcy5hY2N1bXVsYXRvciA9IDA7CiAgICAgIHRoaXMuc3Vic3lzdGVtcyA9IFtdOwogICAgICB0aGlzLmFkZEJvZHlFdmVudCA9IHsKICAgICAgICB0eXBlOiAnYWRkQm9keScsCiAgICAgICAgYm9keTogbnVsbAogICAgICB9OwogICAgICB0aGlzLnJlbW92ZUJvZHlFdmVudCA9IHsKICAgICAgICB0eXBlOiAncmVtb3ZlQm9keScsCiAgICAgICAgYm9keTogbnVsbAogICAgICB9OwogICAgICB0aGlzLmlkVG9Cb2R5TWFwID0ge307CiAgICAgIHRoaXMuYnJvYWRwaGFzZS5zZXRXb3JsZCh0aGlzKTsKICAgIH0KICAgIC8qKgogICAgICogR2V0IHRoZSBjb250YWN0IG1hdGVyaWFsIGJldHdlZW4gbWF0ZXJpYWxzIG0xIGFuZCBtMgogICAgICogQHJldHVybiBUaGUgY29udGFjdCBtYXRlcmlhbCBpZiBpdCB3YXMgZm91bmQuCiAgICAgKi8KCgogICAgZ2V0Q29udGFjdE1hdGVyaWFsKG0xLCBtMikgewogICAgICByZXR1cm4gdGhpcy5jb250YWN0TWF0ZXJpYWxUYWJsZS5nZXQobTEuaWQsIG0yLmlkKTsKICAgIH0KICAgIC8qKgogICAgICogU3RvcmUgb2xkIGNvbGxpc2lvbiBzdGF0ZSBpbmZvCiAgICAgKi8KCgogICAgY29sbGlzaW9uTWF0cml4VGljaygpIHsKICAgICAgY29uc3QgdGVtcCA9IHRoaXMuY29sbGlzaW9uTWF0cml4UHJldmlvdXM7CiAgICAgIHRoaXMuY29sbGlzaW9uTWF0cml4UHJldmlvdXMgPSB0aGlzLmNvbGxpc2lvbk1hdHJpeDsKICAgICAgdGhpcy5jb2xsaXNpb25NYXRyaXggPSB0ZW1wOwogICAgICB0aGlzLmNvbGxpc2lvbk1hdHJpeC5yZXNldCgpOwogICAgICB0aGlzLmJvZHlPdmVybGFwS2VlcGVyLnRpY2soKTsKICAgICAgdGhpcy5zaGFwZU92ZXJsYXBLZWVwZXIudGljaygpOwogICAgfQogICAgLyoqCiAgICAgKiBBZGQgYSBjb25zdHJhaW50IHRvIHRoZSBzaW11bGF0aW9uLgogICAgICovCgoKICAgIGFkZENvbnN0cmFpbnQoYykgewogICAgICB0aGlzLmNvbnN0cmFpbnRzLnB1c2goYyk7CiAgICB9CiAgICAvKioKICAgICAqIFJlbW92ZXMgYSBjb25zdHJhaW50CiAgICAgKi8KCgogICAgcmVtb3ZlQ29uc3RyYWludChjKSB7CiAgICAgIGNvbnN0IGlkeCA9IHRoaXMuY29uc3RyYWludHMuaW5kZXhPZihjKTsKCiAgICAgIGlmIChpZHggIT09IC0xKSB7CiAgICAgICAgdGhpcy5jb25zdHJhaW50cy5zcGxpY2UoaWR4LCAxKTsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBSYXljYXN0IHRlc3QKICAgICAqIEBkZXByZWNhdGVkIFVzZSAucmF5Y2FzdEFsbCwgLnJheWNhc3RDbG9zZXN0IG9yIC5yYXljYXN0QW55IGluc3RlYWQuCiAgICAgKi8KCgogICAgcmF5VGVzdChmcm9tLCB0bywgcmVzdWx0KSB7CiAgICAgIGlmIChyZXN1bHQgaW5zdGFuY2VvZiBSYXljYXN0UmVzdWx0KSB7CiAgICAgICAgLy8gRG8gcmF5Y2FzdENsb3Nlc3QKICAgICAgICB0aGlzLnJheWNhc3RDbG9zZXN0KGZyb20sIHRvLCB7CiAgICAgICAgICBza2lwQmFja2ZhY2VzOiB0cnVlCiAgICAgICAgfSwgcmVzdWx0KTsKICAgICAgfSBlbHNlIHsKICAgICAgICAvLyBEbyByYXljYXN0QWxsCiAgICAgICAgdGhpcy5yYXljYXN0QWxsKGZyb20sIHRvLCB7CiAgICAgICAgICBza2lwQmFja2ZhY2VzOiB0cnVlCiAgICAgICAgfSwgcmVzdWx0KTsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBSYXkgY2FzdCBhZ2FpbnN0IGFsbCBib2RpZXMuIFRoZSBwcm92aWRlZCBjYWxsYmFjayB3aWxsIGJlIGV4ZWN1dGVkIGZvciBlYWNoIGhpdCB3aXRoIGEgUmF5Y2FzdFJlc3VsdCBhcyBzaW5nbGUgYXJndW1lbnQuCiAgICAgKiBAcmV0dXJuIFRydWUgaWYgYW55IGJvZHkgd2FzIGhpdC4KICAgICAqLwoKCiAgICByYXljYXN0QWxsKGZyb20sIHRvLCBvcHRpb25zLCBjYWxsYmFjaykgewogICAgICBpZiAob3B0aW9ucyA9PT0gdm9pZCAwKSB7CiAgICAgICAgb3B0aW9ucyA9IHt9OwogICAgICB9CgogICAgICBvcHRpb25zLm1vZGUgPSBSYXkuQUxMOwogICAgICBvcHRpb25zLmZyb20gPSBmcm9tOwogICAgICBvcHRpb25zLnRvID0gdG87CiAgICAgIG9wdGlvbnMuY2FsbGJhY2sgPSBjYWxsYmFjazsKICAgICAgcmV0dXJuIHRtcFJheS5pbnRlcnNlY3RXb3JsZCh0aGlzLCBvcHRpb25zKTsKICAgIH0KICAgIC8qKgogICAgICogUmF5IGNhc3QsIGFuZCBzdG9wIGF0IHRoZSBmaXJzdCByZXN1bHQuIE5vdGUgdGhhdCB0aGUgb3JkZXIgaXMgcmFuZG9tIC0gYnV0IHRoZSBtZXRob2QgaXMgZmFzdC4KICAgICAqIEByZXR1cm4gVHJ1ZSBpZiBhbnkgYm9keSB3YXMgaGl0LgogICAgICovCgoKICAgIHJheWNhc3RBbnkoZnJvbSwgdG8sIG9wdGlvbnMsIHJlc3VsdCkgewogICAgICBpZiAob3B0aW9ucyA9PT0gdm9pZCAwKSB7CiAgICAgICAgb3B0aW9ucyA9IHt9OwogICAgICB9CgogICAgICBvcHRpb25zLm1vZGUgPSBSYXkuQU5ZOwogICAgICBvcHRpb25zLmZyb20gPSBmcm9tOwogICAgICBvcHRpb25zLnRvID0gdG87CiAgICAgIG9wdGlvbnMucmVzdWx0ID0gcmVzdWx0OwogICAgICByZXR1cm4gdG1wUmF5LmludGVyc2VjdFdvcmxkKHRoaXMsIG9wdGlvbnMpOwogICAgfQogICAgLyoqCiAgICAgKiBSYXkgY2FzdCwgYW5kIHJldHVybiBpbmZvcm1hdGlvbiBvZiB0aGUgY2xvc2VzdCBoaXQuCiAgICAgKiBAcmV0dXJuIFRydWUgaWYgYW55IGJvZHkgd2FzIGhpdC4KICAgICAqLwoKCiAgICByYXljYXN0Q2xvc2VzdChmcm9tLCB0bywgb3B0aW9ucywgcmVzdWx0KSB7CiAgICAgIGlmIChvcHRpb25zID09PSB2b2lkIDApIHsKICAgICAgICBvcHRpb25zID0ge307CiAgICAgIH0KCiAgICAgIG9wdGlvbnMubW9kZSA9IFJheS5DTE9TRVNUOwogICAgICBvcHRpb25zLmZyb20gPSBmcm9tOwogICAgICBvcHRpb25zLnRvID0gdG87CiAgICAgIG9wdGlvbnMucmVzdWx0ID0gcmVzdWx0OwogICAgICByZXR1cm4gdG1wUmF5LmludGVyc2VjdFdvcmxkKHRoaXMsIG9wdGlvbnMpOwogICAgfQogICAgLyoqCiAgICAgKiBBZGQgYSByaWdpZCBib2R5IHRvIHRoZSBzaW11bGF0aW9uLgogICAgICogQHRvZG8gSWYgdGhlIHNpbXVsYXRpb24gaGFzIG5vdCB5ZXQgc3RhcnRlZCwgd2h5IHJlY3JldGUgYW5kIGNvcHkgYXJyYXlzIGZvciBlYWNoIGJvZHk/IEFjY3VtdWxhdGUgaW4gZHluYW1pYyBhcnJheXMgaW4gdGhpcyBjYXNlLgogICAgICogQHRvZG8gQWRkaW5nIGFuIGFycmF5IG9mIGJvZGllcyBzaG91bGQgYmUgcG9zc2libGUuIFRoaXMgd291bGQgc2F2ZSBzb21lIGxvb3BzIHRvbwogICAgICovCgoKICAgIGFkZEJvZHkoYm9keSkgewogICAgICBpZiAodGhpcy5ib2RpZXMuaW5jbHVkZXMoYm9keSkpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIGJvZHkuaW5kZXggPSB0aGlzLmJvZGllcy5sZW5ndGg7CiAgICAgIHRoaXMuYm9kaWVzLnB1c2goYm9keSk7CiAgICAgIGJvZHkud29ybGQgPSB0aGlzOwogICAgICBib2R5LmluaXRQb3NpdGlvbi5jb3B5KGJvZHkucG9zaXRpb24pOwogICAgICBib2R5LmluaXRWZWxvY2l0eS5jb3B5KGJvZHkudmVsb2NpdHkpOwogICAgICBib2R5LnRpbWVMYXN0U2xlZXB5ID0gdGhpcy50aW1lOwoKICAgICAgaWYgKGJvZHkgaW5zdGFuY2VvZiBCb2R5KSB7CiAgICAgICAgYm9keS5pbml0QW5ndWxhclZlbG9jaXR5LmNvcHkoYm9keS5hbmd1bGFyVmVsb2NpdHkpOwogICAgICAgIGJvZHkuaW5pdFF1YXRlcm5pb24uY29weShib2R5LnF1YXRlcm5pb24pOwogICAgICB9CgogICAgICB0aGlzLmNvbGxpc2lvbk1hdHJpeC5zZXROdW1PYmplY3RzKHRoaXMuYm9kaWVzLmxlbmd0aCk7CiAgICAgIHRoaXMuYWRkQm9keUV2ZW50LmJvZHkgPSBib2R5OwogICAgICB0aGlzLmlkVG9Cb2R5TWFwW2JvZHkuaWRdID0gYm9keTsKICAgICAgdGhpcy5kaXNwYXRjaEV2ZW50KHRoaXMuYWRkQm9keUV2ZW50KTsKICAgIH0KICAgIC8qKgogICAgICogUmVtb3ZlIGEgcmlnaWQgYm9keSBmcm9tIHRoZSBzaW11bGF0aW9uLgogICAgICovCgoKICAgIHJlbW92ZUJvZHkoYm9keSkgewogICAgICBib2R5LndvcmxkID0gbnVsbDsKICAgICAgY29uc3QgbiA9IHRoaXMuYm9kaWVzLmxlbmd0aCAtIDE7CiAgICAgIGNvbnN0IGJvZGllcyA9IHRoaXMuYm9kaWVzOwogICAgICBjb25zdCBpZHggPSBib2RpZXMuaW5kZXhPZihib2R5KTsKCiAgICAgIGlmIChpZHggIT09IC0xKSB7CiAgICAgICAgYm9kaWVzLnNwbGljZShpZHgsIDEpOyAvLyBUb2RvOiBzaG91bGQgdXNlIGEgZ2FyYmFnZSBmcmVlIG1ldGhvZAogICAgICAgIC8vIFJlY29tcHV0ZSBpbmRleAoKICAgICAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gYm9kaWVzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICBib2RpZXNbaV0uaW5kZXggPSBpOwogICAgICAgIH0KCiAgICAgICAgdGhpcy5jb2xsaXNpb25NYXRyaXguc2V0TnVtT2JqZWN0cyhuKTsKICAgICAgICB0aGlzLnJlbW92ZUJvZHlFdmVudC5ib2R5ID0gYm9keTsKICAgICAgICBkZWxldGUgdGhpcy5pZFRvQm9keU1hcFtib2R5LmlkXTsKICAgICAgICB0aGlzLmRpc3BhdGNoRXZlbnQodGhpcy5yZW1vdmVCb2R5RXZlbnQpOwogICAgICB9CiAgICB9CgogICAgZ2V0Qm9keUJ5SWQoaWQpIHsKICAgICAgcmV0dXJuIHRoaXMuaWRUb0JvZHlNYXBbaWRdOwogICAgfQogICAgLyoqCiAgICAgKiBAdG9kbyBNYWtlIGEgZmFzdGVyIG1hcAogICAgICovCgoKICAgIGdldFNoYXBlQnlJZChpZCkgewogICAgICBjb25zdCBib2RpZXMgPSB0aGlzLmJvZGllczsKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgYm9kaWVzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgY29uc3Qgc2hhcGVzID0gYm9kaWVzW2ldLnNoYXBlczsKCiAgICAgICAgZm9yIChsZXQgaiA9IDA7IGogPCBzaGFwZXMubGVuZ3RoOyBqKyspIHsKICAgICAgICAgIGNvbnN0IHNoYXBlID0gc2hhcGVzW2pdOwoKICAgICAgICAgIGlmIChzaGFwZS5pZCA9PT0gaWQpIHsKICAgICAgICAgICAgcmV0dXJuIHNoYXBlOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQoKICAgICAgcmV0dXJuIG51bGw7CiAgICB9CiAgICAvKioKICAgICAqIEFkZHMgYSBjb250YWN0IG1hdGVyaWFsIHRvIHRoZSBXb3JsZAogICAgICovCgoKICAgIGFkZENvbnRhY3RNYXRlcmlhbChjbWF0KSB7CiAgICAgIC8vIEFkZCBjb250YWN0IG1hdGVyaWFsCiAgICAgIHRoaXMuY29udGFjdG1hdGVyaWFscy5wdXNoKGNtYXQpOyAvLyBBZGQgY3VycmVudCBjb250YWN0IG1hdGVyaWFsIHRvIHRoZSBtYXRlcmlhbCB0YWJsZQoKICAgICAgdGhpcy5jb250YWN0TWF0ZXJpYWxUYWJsZS5zZXQoY21hdC5tYXRlcmlhbHNbMF0uaWQsIGNtYXQubWF0ZXJpYWxzWzFdLmlkLCBjbWF0KTsKICAgIH0KICAgIC8qKgogICAgICogUmVtb3ZlcyBhIGNvbnRhY3QgbWF0ZXJpYWwgZnJvbSB0aGUgV29ybGQuCiAgICAgKi8KCgogICAgcmVtb3ZlQ29udGFjdE1hdGVyaWFsKGNtYXQpIHsKICAgICAgY29uc3QgaWR4ID0gdGhpcy5jb250YWN0bWF0ZXJpYWxzLmluZGV4T2YoY21hdCk7CgogICAgICBpZiAoaWR4ID09PSAtMSkgewogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgdGhpcy5jb250YWN0bWF0ZXJpYWxzLnNwbGljZShpZHgsIDEpOwogICAgICB0aGlzLmNvbnRhY3RNYXRlcmlhbFRhYmxlLmRlbGV0ZShjbWF0Lm1hdGVyaWFsc1swXS5pZCwgY21hdC5tYXRlcmlhbHNbMV0uaWQpOwogICAgfQogICAgLyoqCiAgICAgKiBTdGVwIHRoZSBzaW11bGF0aW9uIGZvcndhcmQga2VlcGluZyB0cmFjayBvZiBsYXN0IGNhbGxlZCB0aW1lCiAgICAgKiB0byBiZSBhYmxlIHRvIHN0ZXAgdGhlIHdvcmxkIGF0IGEgZml4ZWQgcmF0ZSwgaW5kZXBlbmRlbnRseSBvZiBmcmFtZXJhdGUuCiAgICAgKgogICAgICogQHBhcmFtIGR0IFRoZSBmaXhlZCB0aW1lIHN0ZXAgc2l6ZSB0byB1c2UgKGRlZmF1bHQ6IDEgLyA2MCkuCiAgICAgKiBAcGFyYW0gbWF4U3ViU3RlcHMgTWF4aW11bSBudW1iZXIgb2YgZml4ZWQgc3RlcHMgdG8gdGFrZSBwZXIgZnVuY3Rpb24gY2FsbCAoZGVmYXVsdDogMTApLgogICAgICogQHNlZSBodHRwczovL2dhZmZlcm9uZ2FtZXMuY29tL3Bvc3QvZml4X3lvdXJfdGltZXN0ZXAvCiAgICAgKiBAZXhhbXBsZQogICAgICogICAgIC8vIFJ1biB0aGUgc2ltdWxhdGlvbiBpbmRlcGVuZGVudGx5IG9mIGZyYW1lcmF0ZSBldmVyeSAxIC8gNjAgbXMKICAgICAqICAgICB3b3JsZC5maXhlZFN0ZXAoKQogICAgICovCgoKICAgIGZpeGVkU3RlcChkdCwgbWF4U3ViU3RlcHMpIHsKICAgICAgaWYgKGR0ID09PSB2b2lkIDApIHsKICAgICAgICBkdCA9IDEgLyA2MDsKICAgICAgfQoKICAgICAgaWYgKG1heFN1YlN0ZXBzID09PSB2b2lkIDApIHsKICAgICAgICBtYXhTdWJTdGVwcyA9IDEwOwogICAgICB9CgogICAgICBjb25zdCB0aW1lID0gcGVyZm9ybWFuY2Uubm93KCkgLyAxMDAwOyAvLyBzZWNvbmRzCgogICAgICBpZiAoIXRoaXMubGFzdENhbGxUaW1lKSB7CiAgICAgICAgdGhpcy5zdGVwKGR0LCB1bmRlZmluZWQsIG1heFN1YlN0ZXBzKTsKICAgICAgfSBlbHNlIHsKICAgICAgICBjb25zdCB0aW1lU2luY2VMYXN0Q2FsbGVkID0gdGltZSAtIHRoaXMubGFzdENhbGxUaW1lOwogICAgICAgIHRoaXMuc3RlcChkdCwgdGltZVNpbmNlTGFzdENhbGxlZCwgbWF4U3ViU3RlcHMpOwogICAgICB9CgogICAgICB0aGlzLmxhc3RDYWxsVGltZSA9IHRpbWU7CiAgICB9CiAgICAvKioKICAgICAqIFN0ZXAgdGhlIHBoeXNpY3Mgd29ybGQgZm9yd2FyZCBpbiB0aW1lLgogICAgICoKICAgICAqIFRoZXJlIGFyZSB0d28gbW9kZXMuIFRoZSBzaW1wbGUgbW9kZSBpcyBmaXhlZCB0aW1lc3RlcHBpbmcgd2l0aG91dCBpbnRlcnBvbGF0aW9uLiBJbiB0aGlzIGNhc2UgeW91IG9ubHkgdXNlIHRoZSBmaXJzdCBhcmd1bWVudC4gVGhlIHNlY29uZCBjYXNlIHVzZXMgaW50ZXJwb2xhdGlvbi4gSW4gdGhhdCB5b3UgYWxzbyBwcm92aWRlIHRoZSB0aW1lIHNpbmNlIHRoZSBmdW5jdGlvbiB3YXMgbGFzdCB1c2VkLCBhcyB3ZWxsIGFzIHRoZSBtYXhpbXVtIGZpeGVkIHRpbWVzdGVwcyB0byB0YWtlLgogICAgICoKICAgICAqIEBwYXJhbSBkdCBUaGUgZml4ZWQgdGltZSBzdGVwIHNpemUgdG8gdXNlLgogICAgICogQHBhcmFtIHRpbWVTaW5jZUxhc3RDYWxsZWQgVGhlIHRpbWUgZWxhcHNlZCBzaW5jZSB0aGUgZnVuY3Rpb24gd2FzIGxhc3QgY2FsbGVkLgogICAgICogQHBhcmFtIG1heFN1YlN0ZXBzIE1heGltdW0gbnVtYmVyIG9mIGZpeGVkIHN0ZXBzIHRvIHRha2UgcGVyIGZ1bmN0aW9uIGNhbGwgKGRlZmF1bHQ6IDEwKS4KICAgICAqIEBzZWUgaHR0cHM6Ly93ZWIuYXJjaGl2ZS5vcmcvd2ViLzIwMTgwNDI2MTU0NTMxL2h0dHA6Ly9idWxsZXRwaHlzaWNzLm9yZy9tZWRpYXdpa2ktMS41LjgvaW5kZXgucGhwL1N0ZXBwaW5nX1RoZV9Xb3JsZCNXaGF0X2RvX3RoZV9wYXJhbWV0ZXJzX3RvX2J0RHluYW1pY3NXb3JsZDo6c3RlcFNpbXVsYXRpb25fbWVhbi4zRgogICAgICogQGV4YW1wbGUKICAgICAqICAgICAvLyBmaXhlZCB0aW1lc3RlcHBpbmcgd2l0aG91dCBpbnRlcnBvbGF0aW9uCiAgICAgKiAgICAgd29ybGQuc3RlcCgxIC8gNjApCiAgICAgKi8KCgogICAgc3RlcChkdCwgdGltZVNpbmNlTGFzdENhbGxlZCwgbWF4U3ViU3RlcHMpIHsKICAgICAgaWYgKG1heFN1YlN0ZXBzID09PSB2b2lkIDApIHsKICAgICAgICBtYXhTdWJTdGVwcyA9IDEwOwogICAgICB9CgogICAgICBpZiAodGltZVNpbmNlTGFzdENhbGxlZCA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgLy8gRml4ZWQsIHNpbXBsZSBzdGVwcGluZwogICAgICAgIHRoaXMuaW50ZXJuYWxTdGVwKGR0KTsgLy8gSW5jcmVtZW50IHRpbWUKCiAgICAgICAgdGhpcy50aW1lICs9IGR0OwogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMuYWNjdW11bGF0b3IgKz0gdGltZVNpbmNlTGFzdENhbGxlZDsKICAgICAgICBjb25zdCB0MCA9IHBlcmZvcm1hbmNlLm5vdygpOwogICAgICAgIGxldCBzdWJzdGVwcyA9IDA7CgogICAgICAgIHdoaWxlICh0aGlzLmFjY3VtdWxhdG9yID49IGR0ICYmIHN1YnN0ZXBzIDwgbWF4U3ViU3RlcHMpIHsKICAgICAgICAgIC8vIERvIGZpeGVkIHN0ZXBzIHRvIGNhdGNoIHVwCiAgICAgICAgICB0aGlzLmludGVybmFsU3RlcChkdCk7CiAgICAgICAgICB0aGlzLmFjY3VtdWxhdG9yIC09IGR0OwogICAgICAgICAgc3Vic3RlcHMrKzsKCiAgICAgICAgICBpZiAocGVyZm9ybWFuY2Uubm93KCkgLSB0MCA+IGR0ICogMTAwMCkgewogICAgICAgICAgICAvLyBUaGUgZnJhbWVyYXRlIGlzIG5vdCBpbnRlcmFjdGl2ZSBhbnltb3JlLgogICAgICAgICAgICAvLyBXZSBhcmUgYmVsb3cgdGhlIHRhcmdldCBmcmFtZXJhdGUuCiAgICAgICAgICAgIC8vIEJldHRlciBiYWlsIG91dC4KICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICB9CiAgICAgICAgfSAvLyBSZW1vdmUgdGhlIGV4Y2VzcyBhY2N1bXVsYXRvciwgc2luY2Ugd2UgbWF5IG5vdAogICAgICAgIC8vIGhhdmUgaGFkIGVub3VnaCBzdWJzdGVwcyBhdmFpbGFibGUgdG8gY2F0Y2ggdXAKCgogICAgICAgIHRoaXMuYWNjdW11bGF0b3IgPSB0aGlzLmFjY3VtdWxhdG9yICUgZHQ7CiAgICAgICAgY29uc3QgdCA9IHRoaXMuYWNjdW11bGF0b3IgLyBkdDsKCiAgICAgICAgZm9yIChsZXQgaiA9IDA7IGogIT09IHRoaXMuYm9kaWVzLmxlbmd0aDsgaisrKSB7CiAgICAgICAgICBjb25zdCBiID0gdGhpcy5ib2RpZXNbal07CiAgICAgICAgICBiLnByZXZpb3VzUG9zaXRpb24ubGVycChiLnBvc2l0aW9uLCB0LCBiLmludGVycG9sYXRlZFBvc2l0aW9uKTsKICAgICAgICAgIGIucHJldmlvdXNRdWF0ZXJuaW9uLnNsZXJwKGIucXVhdGVybmlvbiwgdCwgYi5pbnRlcnBvbGF0ZWRRdWF0ZXJuaW9uKTsKICAgICAgICAgIGIucHJldmlvdXNRdWF0ZXJuaW9uLm5vcm1hbGl6ZSgpOwogICAgICAgIH0KCiAgICAgICAgdGhpcy50aW1lICs9IHRpbWVTaW5jZUxhc3RDYWxsZWQ7CiAgICAgIH0KICAgIH0KCiAgICBpbnRlcm5hbFN0ZXAoZHQpIHsKICAgICAgdGhpcy5kdCA9IGR0OwogICAgICBjb25zdCBjb250YWN0cyA9IHRoaXMuY29udGFjdHM7CiAgICAgIGNvbnN0IHAxID0gV29ybGRfc3RlcF9wMTsKICAgICAgY29uc3QgcDIgPSBXb3JsZF9zdGVwX3AyOwogICAgICBjb25zdCBOID0gdGhpcy5ib2RpZXMubGVuZ3RoOwogICAgICBjb25zdCBib2RpZXMgPSB0aGlzLmJvZGllczsKICAgICAgY29uc3Qgc29sdmVyID0gdGhpcy5zb2x2ZXI7CiAgICAgIGNvbnN0IGdyYXZpdHkgPSB0aGlzLmdyYXZpdHk7CiAgICAgIGNvbnN0IGRvUHJvZmlsaW5nID0gdGhpcy5kb1Byb2ZpbGluZzsKICAgICAgY29uc3QgcHJvZmlsZSA9IHRoaXMucHJvZmlsZTsKICAgICAgY29uc3QgRFlOQU1JQyA9IEJvZHkuRFlOQU1JQzsKICAgICAgbGV0IHByb2ZpbGluZ1N0YXJ0ID0gLUluZmluaXR5OwogICAgICBjb25zdCBjb25zdHJhaW50cyA9IHRoaXMuY29uc3RyYWludHM7CiAgICAgIGNvbnN0IGZyaWN0aW9uRXF1YXRpb25Qb29sID0gV29ybGRfc3RlcF9mcmljdGlvbkVxdWF0aW9uUG9vbDsKICAgICAgZ3Jhdml0eS5sZW5ndGgoKTsKICAgICAgY29uc3QgZ3ggPSBncmF2aXR5Lng7CiAgICAgIGNvbnN0IGd5ID0gZ3Jhdml0eS55OwogICAgICBjb25zdCBneiA9IGdyYXZpdHkuejsKICAgICAgbGV0IGkgPSAwOwoKICAgICAgaWYgKGRvUHJvZmlsaW5nKSB7CiAgICAgICAgcHJvZmlsaW5nU3RhcnQgPSBwZXJmb3JtYW5jZS5ub3coKTsKICAgICAgfSAvLyBBZGQgZ3Jhdml0eSB0byBhbGwgb2JqZWN0cwoKCiAgICAgIGZvciAoaSA9IDA7IGkgIT09IE47IGkrKykgewogICAgICAgIGNvbnN0IGJpID0gYm9kaWVzW2ldOwoKICAgICAgICBpZiAoYmkudHlwZSA9PT0gRFlOQU1JQykgewogICAgICAgICAgLy8gT25seSBmb3IgZHluYW1pYyBib2RpZXMKICAgICAgICAgIGNvbnN0IGYgPSBiaS5mb3JjZTsKICAgICAgICAgIGNvbnN0IG0gPSBiaS5tYXNzOwogICAgICAgICAgZi54ICs9IG0gKiBneDsKICAgICAgICAgIGYueSArPSBtICogZ3k7CiAgICAgICAgICBmLnogKz0gbSAqIGd6OwogICAgICAgIH0KICAgICAgfSAvLyBVcGRhdGUgc3Vic3lzdGVtcwoKCiAgICAgIGZvciAobGV0IGkgPSAwLCBOc3Vic3lzdGVtcyA9IHRoaXMuc3Vic3lzdGVtcy5sZW5ndGg7IGkgIT09IE5zdWJzeXN0ZW1zOyBpKyspIHsKICAgICAgICB0aGlzLnN1YnN5c3RlbXNbaV0udXBkYXRlKCk7CiAgICAgIH0gLy8gQ29sbGlzaW9uIGRldGVjdGlvbgoKCiAgICAgIGlmIChkb1Byb2ZpbGluZykgewogICAgICAgIHByb2ZpbGluZ1N0YXJ0ID0gcGVyZm9ybWFuY2Uubm93KCk7CiAgICAgIH0KCiAgICAgIHAxLmxlbmd0aCA9IDA7IC8vIENsZWFuIHVwIHBhaXIgYXJyYXlzIGZyb20gbGFzdCBzdGVwCgogICAgICBwMi5sZW5ndGggPSAwOwogICAgICB0aGlzLmJyb2FkcGhhc2UuY29sbGlzaW9uUGFpcnModGhpcywgcDEsIHAyKTsKCiAgICAgIGlmIChkb1Byb2ZpbGluZykgewogICAgICAgIHByb2ZpbGUuYnJvYWRwaGFzZSA9IHBlcmZvcm1hbmNlLm5vdygpIC0gcHJvZmlsaW5nU3RhcnQ7CiAgICAgIH0gLy8gUmVtb3ZlIGNvbnN0cmFpbmVkIHBhaXJzIHdpdGggY29sbGlkZUNvbm5lY3RlZCA9PSBmYWxzZQoKCiAgICAgIGxldCBOY29uc3RyYWludHMgPSBjb25zdHJhaW50cy5sZW5ndGg7CgogICAgICBmb3IgKGkgPSAwOyBpICE9PSBOY29uc3RyYWludHM7IGkrKykgewogICAgICAgIGNvbnN0IGMgPSBjb25zdHJhaW50c1tpXTsKCiAgICAgICAgaWYgKCFjLmNvbGxpZGVDb25uZWN0ZWQpIHsKICAgICAgICAgIGZvciAobGV0IGogPSBwMS5sZW5ndGggLSAxOyBqID49IDA7IGogLT0gMSkgewogICAgICAgICAgICBpZiAoYy5ib2R5QSA9PT0gcDFbal0gJiYgYy5ib2R5QiA9PT0gcDJbal0gfHwgYy5ib2R5QiA9PT0gcDFbal0gJiYgYy5ib2R5QSA9PT0gcDJbal0pIHsKICAgICAgICAgICAgICBwMS5zcGxpY2UoaiwgMSk7CiAgICAgICAgICAgICAgcDIuc3BsaWNlKGosIDEpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CgogICAgICB0aGlzLmNvbGxpc2lvbk1hdHJpeFRpY2soKTsgLy8gR2VuZXJhdGUgY29udGFjdHMKCiAgICAgIGlmIChkb1Byb2ZpbGluZykgewogICAgICAgIHByb2ZpbGluZ1N0YXJ0ID0gcGVyZm9ybWFuY2Uubm93KCk7CiAgICAgIH0KCiAgICAgIGNvbnN0IG9sZGNvbnRhY3RzID0gV29ybGRfc3RlcF9vbGRDb250YWN0czsKICAgICAgY29uc3QgTm9sZENvbnRhY3RzID0gY29udGFjdHMubGVuZ3RoOwoKICAgICAgZm9yIChpID0gMDsgaSAhPT0gTm9sZENvbnRhY3RzOyBpKyspIHsKICAgICAgICBvbGRjb250YWN0cy5wdXNoKGNvbnRhY3RzW2ldKTsKICAgICAgfQoKICAgICAgY29udGFjdHMubGVuZ3RoID0gMDsgLy8gVHJhbnNmZXIgRnJpY3Rpb25FcXVhdGlvbiBmcm9tIGN1cnJlbnQgbGlzdCB0byB0aGUgcG9vbCBmb3IgcmV1c2UKCiAgICAgIGNvbnN0IE5vbGRGcmljdGlvbkVxdWF0aW9ucyA9IHRoaXMuZnJpY3Rpb25FcXVhdGlvbnMubGVuZ3RoOwoKICAgICAgZm9yIChpID0gMDsgaSAhPT0gTm9sZEZyaWN0aW9uRXF1YXRpb25zOyBpKyspIHsKICAgICAgICBmcmljdGlvbkVxdWF0aW9uUG9vbC5wdXNoKHRoaXMuZnJpY3Rpb25FcXVhdGlvbnNbaV0pOwogICAgICB9CgogICAgICB0aGlzLmZyaWN0aW9uRXF1YXRpb25zLmxlbmd0aCA9IDA7CiAgICAgIHRoaXMubmFycm93cGhhc2UuZ2V0Q29udGFjdHMocDEsIHAyLCB0aGlzLCBjb250YWN0cywgb2xkY29udGFjdHMsIC8vIFRvIGJlIHJldXNlZAogICAgICB0aGlzLmZyaWN0aW9uRXF1YXRpb25zLCBmcmljdGlvbkVxdWF0aW9uUG9vbCk7CgogICAgICBpZiAoZG9Qcm9maWxpbmcpIHsKICAgICAgICBwcm9maWxlLm5hcnJvd3BoYXNlID0gcGVyZm9ybWFuY2Uubm93KCkgLSBwcm9maWxpbmdTdGFydDsKICAgICAgfSAvLyBMb29wIG92ZXIgYWxsIGNvbGxpc2lvbnMKCgogICAgICBpZiAoZG9Qcm9maWxpbmcpIHsKICAgICAgICBwcm9maWxpbmdTdGFydCA9IHBlcmZvcm1hbmNlLm5vdygpOwogICAgICB9IC8vIEFkZCBhbGwgZnJpY3Rpb24gZXFzCgoKICAgICAgZm9yIChpID0gMDsgaSA8IHRoaXMuZnJpY3Rpb25FcXVhdGlvbnMubGVuZ3RoOyBpKyspIHsKICAgICAgICBzb2x2ZXIuYWRkRXF1YXRpb24odGhpcy5mcmljdGlvbkVxdWF0aW9uc1tpXSk7CiAgICAgIH0KCiAgICAgIGNvbnN0IG5jb250YWN0cyA9IGNvbnRhY3RzLmxlbmd0aDsKCiAgICAgIGZvciAobGV0IGsgPSAwOyBrICE9PSBuY29udGFjdHM7IGsrKykgewogICAgICAgIC8vIEN1cnJlbnQgY29udGFjdAogICAgICAgIGNvbnN0IGMgPSBjb250YWN0c1trXTsgLy8gR2V0IGN1cnJlbnQgY29sbGlzaW9uIGluZGVjZXMKCiAgICAgICAgY29uc3QgYmkgPSBjLmJpOwogICAgICAgIGNvbnN0IGJqID0gYy5iajsKICAgICAgICBjb25zdCBzaSA9IGMuc2k7CiAgICAgICAgY29uc3Qgc2ogPSBjLnNqOyAvLyBHZXQgY29sbGlzaW9uIHByb3BlcnRpZXMKCiAgICAgICAgbGV0IGNtOwoKICAgICAgICBpZiAoYmkubWF0ZXJpYWwgJiYgYmoubWF0ZXJpYWwpIHsKICAgICAgICAgIGNtID0gdGhpcy5nZXRDb250YWN0TWF0ZXJpYWwoYmkubWF0ZXJpYWwsIGJqLm1hdGVyaWFsKSB8fCB0aGlzLmRlZmF1bHRDb250YWN0TWF0ZXJpYWw7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGNtID0gdGhpcy5kZWZhdWx0Q29udGFjdE1hdGVyaWFsOwogICAgICAgIH0gLy8gYy5lbmFibGVkID0gYmkuY29sbGlzaW9uUmVzcG9uc2UgJiYgYmouY29sbGlzaW9uUmVzcG9uc2UgJiYgc2kuY29sbGlzaW9uUmVzcG9uc2UgJiYgc2ouY29sbGlzaW9uUmVzcG9uc2U7CgoKICAgICAgICBjbS5mcmljdGlvbjsgLy8gYy5yZXN0aXR1dGlvbiA9IGNtLnJlc3RpdHV0aW9uOwogICAgICAgIC8vIElmIGZyaWN0aW9uIG9yIHJlc3RpdHV0aW9uIHdlcmUgc3BlY2lmaWVkIGluIHRoZSBtYXRlcmlhbCwgdXNlIHRoZW0KCiAgICAgICAgaWYgKGJpLm1hdGVyaWFsICYmIGJqLm1hdGVyaWFsKSB7CiAgICAgICAgICBpZiAoYmkubWF0ZXJpYWwuZnJpY3Rpb24gPj0gMCAmJiBiai5tYXRlcmlhbC5mcmljdGlvbiA+PSAwKSB7CiAgICAgICAgICAgIGJpLm1hdGVyaWFsLmZyaWN0aW9uICogYmoubWF0ZXJpYWwuZnJpY3Rpb247CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKGJpLm1hdGVyaWFsLnJlc3RpdHV0aW9uID49IDAgJiYgYmoubWF0ZXJpYWwucmVzdGl0dXRpb24gPj0gMCkgewogICAgICAgICAgICBjLnJlc3RpdHV0aW9uID0gYmkubWF0ZXJpYWwucmVzdGl0dXRpb24gKiBiai5tYXRlcmlhbC5yZXN0aXR1dGlvbjsKICAgICAgICAgIH0KICAgICAgICB9IC8vIGMuc2V0U3Bvb2tQYXJhbXMoCiAgICAgICAgLy8gICAgICAgICAgIGNtLmNvbnRhY3RFcXVhdGlvblN0aWZmbmVzcywKICAgICAgICAvLyAgICAgICAgICAgY20uY29udGFjdEVxdWF0aW9uUmVsYXhhdGlvbiwKICAgICAgICAvLyAgICAgICAgICAgZHQKICAgICAgICAvLyAgICAgICApOwoKCiAgICAgICAgc29sdmVyLmFkZEVxdWF0aW9uKGMpOyAvLyAvLyBBZGQgZnJpY3Rpb24gY29uc3RyYWludCBlcXVhdGlvbgogICAgICAgIC8vIGlmKG11ID4gMCl7CiAgICAgICAgLy8gCS8vIENyZWF0ZSAyIHRhbmdlbnQgZXF1YXRpb25zCiAgICAgICAgLy8gCWNvbnN0IG11ZyA9IG11ICogZ25vcm07CiAgICAgICAgLy8gCWNvbnN0IHJlZHVjZWRNYXNzID0gKGJpLmludk1hc3MgKyBiai5pbnZNYXNzKTsKICAgICAgICAvLyAJaWYocmVkdWNlZE1hc3MgPiAwKXsKICAgICAgICAvLyAJCXJlZHVjZWRNYXNzID0gMS9yZWR1Y2VkTWFzczsKICAgICAgICAvLyAJfQogICAgICAgIC8vIAljb25zdCBwb29sID0gZnJpY3Rpb25FcXVhdGlvblBvb2w7CiAgICAgICAgLy8gCWNvbnN0IGMxID0gcG9vbC5sZW5ndGggPyBwb29sLnBvcCgpIDogbmV3IEZyaWN0aW9uRXF1YXRpb24oYmksYmosbXVnKnJlZHVjZWRNYXNzKTsKICAgICAgICAvLyAJY29uc3QgYzIgPSBwb29sLmxlbmd0aCA/IHBvb2wucG9wKCkgOiBuZXcgRnJpY3Rpb25FcXVhdGlvbihiaSxiaixtdWcqcmVkdWNlZE1hc3MpOwogICAgICAgIC8vIAl0aGlzLmZyaWN0aW9uRXF1YXRpb25zLnB1c2goYzEsIGMyKTsKICAgICAgICAvLyAJYzEuYmkgPSBjMi5iaSA9IGJpOwogICAgICAgIC8vIAljMS5iaiA9IGMyLmJqID0gYmo7CiAgICAgICAgLy8gCWMxLm1pbkZvcmNlID0gYzIubWluRm9yY2UgPSAtbXVnKnJlZHVjZWRNYXNzOwogICAgICAgIC8vIAljMS5tYXhGb3JjZSA9IGMyLm1heEZvcmNlID0gbXVnKnJlZHVjZWRNYXNzOwogICAgICAgIC8vIAkvLyBDb3B5IG92ZXIgdGhlIHJlbGF0aXZlIHZlY3RvcnMKICAgICAgICAvLyAJYzEucmkuY29weShjLnJpKTsKICAgICAgICAvLyAJYzEucmouY29weShjLnJqKTsKICAgICAgICAvLyAJYzIucmkuY29weShjLnJpKTsKICAgICAgICAvLyAJYzIucmouY29weShjLnJqKTsKICAgICAgICAvLyAJLy8gQ29uc3RydWN0IHRhbmdlbnRzCiAgICAgICAgLy8gCWMubmkudGFuZ2VudHMoYzEudCwgYzIudCk7CiAgICAgICAgLy8gICAgICAgICAgIC8vIFNldCBzcG9vayBwYXJhbXMKICAgICAgICAvLyAgICAgICAgICAgYzEuc2V0U3Bvb2tQYXJhbXMoY20uZnJpY3Rpb25FcXVhdGlvblN0aWZmbmVzcywgY20uZnJpY3Rpb25FcXVhdGlvblJlbGF4YXRpb24sIGR0KTsKICAgICAgICAvLyAgICAgICAgICAgYzIuc2V0U3Bvb2tQYXJhbXMoY20uZnJpY3Rpb25FcXVhdGlvblN0aWZmbmVzcywgY20uZnJpY3Rpb25FcXVhdGlvblJlbGF4YXRpb24sIGR0KTsKICAgICAgICAvLyAgICAgICAgICAgYzEuZW5hYmxlZCA9IGMyLmVuYWJsZWQgPSBjLmVuYWJsZWQ7CiAgICAgICAgLy8gCS8vIEFkZCBlcXVhdGlvbnMgdG8gc29sdmVyCiAgICAgICAgLy8gCXNvbHZlci5hZGRFcXVhdGlvbihjMSk7CiAgICAgICAgLy8gCXNvbHZlci5hZGRFcXVhdGlvbihjMik7CiAgICAgICAgLy8gfQoKICAgICAgICBpZiAoYmkuYWxsb3dTbGVlcCAmJiBiaS50eXBlID09PSBCb2R5LkRZTkFNSUMgJiYgYmkuc2xlZXBTdGF0ZSA9PT0gQm9keS5TTEVFUElORyAmJiBiai5zbGVlcFN0YXRlID09PSBCb2R5LkFXQUtFICYmIGJqLnR5cGUgIT09IEJvZHkuU1RBVElDKSB7CiAgICAgICAgICBjb25zdCBzcGVlZFNxdWFyZWRCID0gYmoudmVsb2NpdHkubGVuZ3RoU3F1YXJlZCgpICsgYmouYW5ndWxhclZlbG9jaXR5Lmxlbmd0aFNxdWFyZWQoKTsKICAgICAgICAgIGNvbnN0IHNwZWVkTGltaXRTcXVhcmVkQiA9IGJqLnNsZWVwU3BlZWRMaW1pdCAqKiAyOwoKICAgICAgICAgIGlmIChzcGVlZFNxdWFyZWRCID49IHNwZWVkTGltaXRTcXVhcmVkQiAqIDIpIHsKICAgICAgICAgICAgYmkud2FrZVVwQWZ0ZXJOYXJyb3dwaGFzZSA9IHRydWU7CiAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBpZiAoYmouYWxsb3dTbGVlcCAmJiBiai50eXBlID09PSBCb2R5LkRZTkFNSUMgJiYgYmouc2xlZXBTdGF0ZSA9PT0gQm9keS5TTEVFUElORyAmJiBiaS5zbGVlcFN0YXRlID09PSBCb2R5LkFXQUtFICYmIGJpLnR5cGUgIT09IEJvZHkuU1RBVElDKSB7CiAgICAgICAgICBjb25zdCBzcGVlZFNxdWFyZWRBID0gYmkudmVsb2NpdHkubGVuZ3RoU3F1YXJlZCgpICsgYmkuYW5ndWxhclZlbG9jaXR5Lmxlbmd0aFNxdWFyZWQoKTsKICAgICAgICAgIGNvbnN0IHNwZWVkTGltaXRTcXVhcmVkQSA9IGJpLnNsZWVwU3BlZWRMaW1pdCAqKiAyOwoKICAgICAgICAgIGlmIChzcGVlZFNxdWFyZWRBID49IHNwZWVkTGltaXRTcXVhcmVkQSAqIDIpIHsKICAgICAgICAgICAgYmoud2FrZVVwQWZ0ZXJOYXJyb3dwaGFzZSA9IHRydWU7CiAgICAgICAgICB9CiAgICAgICAgfSAvLyBOb3cgd2Uga25vdyB0aGF0IGkgYW5kIGogYXJlIGluIGNvbnRhY3QuIFNldCBjb2xsaXNpb24gbWF0cml4IHN0YXRlCgoKICAgICAgICB0aGlzLmNvbGxpc2lvbk1hdHJpeC5zZXQoYmksIGJqLCB0cnVlKTsKCiAgICAgICAgaWYgKCF0aGlzLmNvbGxpc2lvbk1hdHJpeFByZXZpb3VzLmdldChiaSwgYmopKSB7CiAgICAgICAgICAvLyBGaXJzdCBjb250YWN0IQogICAgICAgICAgLy8gV2UgcmV1c2UgdGhlIGNvbGxpZGVFdmVudCBvYmplY3QsIG90aGVyd2lzZSB3ZSB3aWxsIGVuZCB1cCBjcmVhdGluZyBuZXcgb2JqZWN0cyBmb3IgZWFjaCBuZXcgY29udGFjdCwgZXZlbiBpZiB0aGVyZSdzIG5vIGV2ZW50IGxpc3RlbmVyIGF0dGFjaGVkLgogICAgICAgICAgV29ybGRfc3RlcF9jb2xsaWRlRXZlbnQuYm9keSA9IGJqOwogICAgICAgICAgV29ybGRfc3RlcF9jb2xsaWRlRXZlbnQuY29udGFjdCA9IGM7CiAgICAgICAgICBiaS5kaXNwYXRjaEV2ZW50KFdvcmxkX3N0ZXBfY29sbGlkZUV2ZW50KTsKICAgICAgICAgIFdvcmxkX3N0ZXBfY29sbGlkZUV2ZW50LmJvZHkgPSBiaTsKICAgICAgICAgIGJqLmRpc3BhdGNoRXZlbnQoV29ybGRfc3RlcF9jb2xsaWRlRXZlbnQpOwogICAgICAgIH0KCiAgICAgICAgdGhpcy5ib2R5T3ZlcmxhcEtlZXBlci5zZXQoYmkuaWQsIGJqLmlkKTsKICAgICAgICB0aGlzLnNoYXBlT3ZlcmxhcEtlZXBlci5zZXQoc2kuaWQsIHNqLmlkKTsKICAgICAgfQoKICAgICAgdGhpcy5lbWl0Q29udGFjdEV2ZW50cygpOwoKICAgICAgaWYgKGRvUHJvZmlsaW5nKSB7CiAgICAgICAgcHJvZmlsZS5tYWtlQ29udGFjdENvbnN0cmFpbnRzID0gcGVyZm9ybWFuY2Uubm93KCkgLSBwcm9maWxpbmdTdGFydDsKICAgICAgICBwcm9maWxpbmdTdGFydCA9IHBlcmZvcm1hbmNlLm5vdygpOwogICAgICB9IC8vIFdha2UgdXAgYm9kaWVzCgoKICAgICAgZm9yIChpID0gMDsgaSAhPT0gTjsgaSsrKSB7CiAgICAgICAgY29uc3QgYmkgPSBib2RpZXNbaV07CgogICAgICAgIGlmIChiaS53YWtlVXBBZnRlck5hcnJvd3BoYXNlKSB7CiAgICAgICAgICBiaS53YWtlVXAoKTsKICAgICAgICAgIGJpLndha2VVcEFmdGVyTmFycm93cGhhc2UgPSBmYWxzZTsKICAgICAgICB9CiAgICAgIH0gLy8gQWRkIHVzZXItYWRkZWQgY29uc3RyYWludHMKCgogICAgICBOY29uc3RyYWludHMgPSBjb25zdHJhaW50cy5sZW5ndGg7CgogICAgICBmb3IgKGkgPSAwOyBpICE9PSBOY29uc3RyYWludHM7IGkrKykgewogICAgICAgIGNvbnN0IGMgPSBjb25zdHJhaW50c1tpXTsKICAgICAgICBjLnVwZGF0ZSgpOwoKICAgICAgICBmb3IgKGxldCBqID0gMCwgTmVxID0gYy5lcXVhdGlvbnMubGVuZ3RoOyBqICE9PSBOZXE7IGorKykgewogICAgICAgICAgY29uc3QgZXEgPSBjLmVxdWF0aW9uc1tqXTsKICAgICAgICAgIHNvbHZlci5hZGRFcXVhdGlvbihlcSk7CiAgICAgICAgfQogICAgICB9IC8vIFNvbHZlIHRoZSBjb25zdHJhaW5lZCBzeXN0ZW0KCgogICAgICBzb2x2ZXIuc29sdmUoZHQsIHRoaXMpOwoKICAgICAgaWYgKGRvUHJvZmlsaW5nKSB7CiAgICAgICAgcHJvZmlsZS5zb2x2ZSA9IHBlcmZvcm1hbmNlLm5vdygpIC0gcHJvZmlsaW5nU3RhcnQ7CiAgICAgIH0gLy8gUmVtb3ZlIGFsbCBjb250YWN0cyBmcm9tIHNvbHZlcgoKCiAgICAgIHNvbHZlci5yZW1vdmVBbGxFcXVhdGlvbnMoKTsgLy8gQXBwbHkgZGFtcGluZywgc2VlIGh0dHA6Ly9jb2RlLmdvb2dsZS5jb20vcC9idWxsZXQvaXNzdWVzL2RldGFpbD9pZD03NCBmb3IgZGV0YWlscwoKICAgICAgY29uc3QgcG93ID0gTWF0aC5wb3c7CgogICAgICBmb3IgKGkgPSAwOyBpICE9PSBOOyBpKyspIHsKICAgICAgICBjb25zdCBiaSA9IGJvZGllc1tpXTsKCiAgICAgICAgaWYgKGJpLnR5cGUgJiBEWU5BTUlDKSB7CiAgICAgICAgICAvLyBPbmx5IGZvciBkeW5hbWljIGJvZGllcwogICAgICAgICAgY29uc3QgbGQgPSBwb3coMS4wIC0gYmkubGluZWFyRGFtcGluZywgZHQpOwogICAgICAgICAgY29uc3QgdiA9IGJpLnZlbG9jaXR5OwogICAgICAgICAgdi5zY2FsZShsZCwgdik7CiAgICAgICAgICBjb25zdCBhdiA9IGJpLmFuZ3VsYXJWZWxvY2l0eTsKCiAgICAgICAgICBpZiAoYXYpIHsKICAgICAgICAgICAgY29uc3QgYWQgPSBwb3coMS4wIC0gYmkuYW5ndWxhckRhbXBpbmcsIGR0KTsKICAgICAgICAgICAgYXYuc2NhbGUoYWQsIGF2KTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KCiAgICAgIHRoaXMuZGlzcGF0Y2hFdmVudChXb3JsZF9zdGVwX3ByZVN0ZXBFdmVudCk7IC8vIExlYXAgZnJvZwogICAgICAvLyB2bmV3ID0gdiArIGgqZi9tCiAgICAgIC8vIHhuZXcgPSB4ICsgaCp2bmV3CgogICAgICBpZiAoZG9Qcm9maWxpbmcpIHsKICAgICAgICBwcm9maWxpbmdTdGFydCA9IHBlcmZvcm1hbmNlLm5vdygpOwogICAgICB9CgogICAgICBjb25zdCBzdGVwbnVtYmVyID0gdGhpcy5zdGVwbnVtYmVyOwogICAgICBjb25zdCBxdWF0Tm9ybWFsaXplID0gc3RlcG51bWJlciAlICh0aGlzLnF1YXROb3JtYWxpemVTa2lwICsgMSkgPT09IDA7CiAgICAgIGNvbnN0IHF1YXROb3JtYWxpemVGYXN0ID0gdGhpcy5xdWF0Tm9ybWFsaXplRmFzdDsKCiAgICAgIGZvciAoaSA9IDA7IGkgIT09IE47IGkrKykgewogICAgICAgIGJvZGllc1tpXS5pbnRlZ3JhdGUoZHQsIHF1YXROb3JtYWxpemUsIHF1YXROb3JtYWxpemVGYXN0KTsKICAgICAgfQoKICAgICAgdGhpcy5jbGVhckZvcmNlcygpOwogICAgICB0aGlzLmJyb2FkcGhhc2UuZGlydHkgPSB0cnVlOwoKICAgICAgaWYgKGRvUHJvZmlsaW5nKSB7CiAgICAgICAgcHJvZmlsZS5pbnRlZ3JhdGUgPSBwZXJmb3JtYW5jZS5ub3coKSAtIHByb2ZpbGluZ1N0YXJ0OwogICAgICB9IC8vIFVwZGF0ZSBzdGVwIG51bWJlcgoKCiAgICAgIHRoaXMuc3RlcG51bWJlciArPSAxOwogICAgICB0aGlzLmRpc3BhdGNoRXZlbnQoV29ybGRfc3RlcF9wb3N0U3RlcEV2ZW50KTsgLy8gU2xlZXBpbmcgdXBkYXRlCgogICAgICBsZXQgaGFzQWN0aXZlQm9kaWVzID0gdHJ1ZTsKCiAgICAgIGlmICh0aGlzLmFsbG93U2xlZXApIHsKICAgICAgICBoYXNBY3RpdmVCb2RpZXMgPSBmYWxzZTsKCiAgICAgICAgZm9yIChpID0gMDsgaSAhPT0gTjsgaSsrKSB7CiAgICAgICAgICBjb25zdCBiaSA9IGJvZGllc1tpXTsKICAgICAgICAgIGJpLnNsZWVwVGljayh0aGlzLnRpbWUpOwoKICAgICAgICAgIGlmIChiaS5zbGVlcFN0YXRlICE9PSBCb2R5LlNMRUVQSU5HKSB7CiAgICAgICAgICAgIGhhc0FjdGl2ZUJvZGllcyA9IHRydWU7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CgogICAgICB0aGlzLmhhc0FjdGl2ZUJvZGllcyA9IGhhc0FjdGl2ZUJvZGllczsKICAgIH0KCiAgICBlbWl0Q29udGFjdEV2ZW50cygpIHsKICAgICAgY29uc3QgaGFzQmVnaW5Db250YWN0ID0gdGhpcy5oYXNBbnlFdmVudExpc3RlbmVyKCdiZWdpbkNvbnRhY3QnKTsKICAgICAgY29uc3QgaGFzRW5kQ29udGFjdCA9IHRoaXMuaGFzQW55RXZlbnRMaXN0ZW5lcignZW5kQ29udGFjdCcpOwoKICAgICAgaWYgKGhhc0JlZ2luQ29udGFjdCB8fCBoYXNFbmRDb250YWN0KSB7CiAgICAgICAgdGhpcy5ib2R5T3ZlcmxhcEtlZXBlci5nZXREaWZmKGFkZGl0aW9ucywgcmVtb3ZhbHMpOwogICAgICB9CgogICAgICBpZiAoaGFzQmVnaW5Db250YWN0KSB7CiAgICAgICAgZm9yIChsZXQgaSA9IDAsIGwgPSBhZGRpdGlvbnMubGVuZ3RoOyBpIDwgbDsgaSArPSAyKSB7CiAgICAgICAgICBiZWdpbkNvbnRhY3RFdmVudC5ib2R5QSA9IHRoaXMuZ2V0Qm9keUJ5SWQoYWRkaXRpb25zW2ldKTsKICAgICAgICAgIGJlZ2luQ29udGFjdEV2ZW50LmJvZHlCID0gdGhpcy5nZXRCb2R5QnlJZChhZGRpdGlvbnNbaSArIDFdKTsKICAgICAgICAgIHRoaXMuZGlzcGF0Y2hFdmVudChiZWdpbkNvbnRhY3RFdmVudCk7CiAgICAgICAgfQoKICAgICAgICBiZWdpbkNvbnRhY3RFdmVudC5ib2R5QSA9IGJlZ2luQ29udGFjdEV2ZW50LmJvZHlCID0gbnVsbDsKICAgICAgfQoKICAgICAgaWYgKGhhc0VuZENvbnRhY3QpIHsKICAgICAgICBmb3IgKGxldCBpID0gMCwgbCA9IHJlbW92YWxzLmxlbmd0aDsgaSA8IGw7IGkgKz0gMikgewogICAgICAgICAgZW5kQ29udGFjdEV2ZW50LmJvZHlBID0gdGhpcy5nZXRCb2R5QnlJZChyZW1vdmFsc1tpXSk7CiAgICAgICAgICBlbmRDb250YWN0RXZlbnQuYm9keUIgPSB0aGlzLmdldEJvZHlCeUlkKHJlbW92YWxzW2kgKyAxXSk7CiAgICAgICAgICB0aGlzLmRpc3BhdGNoRXZlbnQoZW5kQ29udGFjdEV2ZW50KTsKICAgICAgICB9CgogICAgICAgIGVuZENvbnRhY3RFdmVudC5ib2R5QSA9IGVuZENvbnRhY3RFdmVudC5ib2R5QiA9IG51bGw7CiAgICAgIH0KCiAgICAgIGFkZGl0aW9ucy5sZW5ndGggPSByZW1vdmFscy5sZW5ndGggPSAwOwogICAgICBjb25zdCBoYXNCZWdpblNoYXBlQ29udGFjdCA9IHRoaXMuaGFzQW55RXZlbnRMaXN0ZW5lcignYmVnaW5TaGFwZUNvbnRhY3QnKTsKICAgICAgY29uc3QgaGFzRW5kU2hhcGVDb250YWN0ID0gdGhpcy5oYXNBbnlFdmVudExpc3RlbmVyKCdlbmRTaGFwZUNvbnRhY3QnKTsKCiAgICAgIGlmIChoYXNCZWdpblNoYXBlQ29udGFjdCB8fCBoYXNFbmRTaGFwZUNvbnRhY3QpIHsKICAgICAgICB0aGlzLnNoYXBlT3ZlcmxhcEtlZXBlci5nZXREaWZmKGFkZGl0aW9ucywgcmVtb3ZhbHMpOwogICAgICB9CgogICAgICBpZiAoaGFzQmVnaW5TaGFwZUNvbnRhY3QpIHsKICAgICAgICBmb3IgKGxldCBpID0gMCwgbCA9IGFkZGl0aW9ucy5sZW5ndGg7IGkgPCBsOyBpICs9IDIpIHsKICAgICAgICAgIGNvbnN0IHNoYXBlQSA9IHRoaXMuZ2V0U2hhcGVCeUlkKGFkZGl0aW9uc1tpXSk7CiAgICAgICAgICBjb25zdCBzaGFwZUIgPSB0aGlzLmdldFNoYXBlQnlJZChhZGRpdGlvbnNbaSArIDFdKTsKICAgICAgICAgIGJlZ2luU2hhcGVDb250YWN0RXZlbnQuc2hhcGVBID0gc2hhcGVBOwogICAgICAgICAgYmVnaW5TaGFwZUNvbnRhY3RFdmVudC5zaGFwZUIgPSBzaGFwZUI7CiAgICAgICAgICBpZiAoc2hhcGVBKSBiZWdpblNoYXBlQ29udGFjdEV2ZW50LmJvZHlBID0gc2hhcGVBLmJvZHk7CiAgICAgICAgICBpZiAoc2hhcGVCKSBiZWdpblNoYXBlQ29udGFjdEV2ZW50LmJvZHlCID0gc2hhcGVCLmJvZHk7CiAgICAgICAgICB0aGlzLmRpc3BhdGNoRXZlbnQoYmVnaW5TaGFwZUNvbnRhY3RFdmVudCk7CiAgICAgICAgfQoKICAgICAgICBiZWdpblNoYXBlQ29udGFjdEV2ZW50LmJvZHlBID0gYmVnaW5TaGFwZUNvbnRhY3RFdmVudC5ib2R5QiA9IGJlZ2luU2hhcGVDb250YWN0RXZlbnQuc2hhcGVBID0gYmVnaW5TaGFwZUNvbnRhY3RFdmVudC5zaGFwZUIgPSBudWxsOwogICAgICB9CgogICAgICBpZiAoaGFzRW5kU2hhcGVDb250YWN0KSB7CiAgICAgICAgZm9yIChsZXQgaSA9IDAsIGwgPSByZW1vdmFscy5sZW5ndGg7IGkgPCBsOyBpICs9IDIpIHsKICAgICAgICAgIGNvbnN0IHNoYXBlQSA9IHRoaXMuZ2V0U2hhcGVCeUlkKHJlbW92YWxzW2ldKTsKICAgICAgICAgIGNvbnN0IHNoYXBlQiA9IHRoaXMuZ2V0U2hhcGVCeUlkKHJlbW92YWxzW2kgKyAxXSk7CiAgICAgICAgICBlbmRTaGFwZUNvbnRhY3RFdmVudC5zaGFwZUEgPSBzaGFwZUE7CiAgICAgICAgICBlbmRTaGFwZUNvbnRhY3RFdmVudC5zaGFwZUIgPSBzaGFwZUI7CiAgICAgICAgICBpZiAoc2hhcGVBKSBlbmRTaGFwZUNvbnRhY3RFdmVudC5ib2R5QSA9IHNoYXBlQS5ib2R5OwogICAgICAgICAgaWYgKHNoYXBlQikgZW5kU2hhcGVDb250YWN0RXZlbnQuYm9keUIgPSBzaGFwZUIuYm9keTsKICAgICAgICAgIHRoaXMuZGlzcGF0Y2hFdmVudChlbmRTaGFwZUNvbnRhY3RFdmVudCk7CiAgICAgICAgfQoKICAgICAgICBlbmRTaGFwZUNvbnRhY3RFdmVudC5ib2R5QSA9IGVuZFNoYXBlQ29udGFjdEV2ZW50LmJvZHlCID0gZW5kU2hhcGVDb250YWN0RXZlbnQuc2hhcGVBID0gZW5kU2hhcGVDb250YWN0RXZlbnQuc2hhcGVCID0gbnVsbDsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBTZXRzIGFsbCBib2R5IGZvcmNlcyBpbiB0aGUgd29ybGQgdG8gemVyby4KICAgICAqLwoKCiAgICBjbGVhckZvcmNlcygpIHsKICAgICAgY29uc3QgYm9kaWVzID0gdGhpcy5ib2RpZXM7CiAgICAgIGNvbnN0IE4gPSBib2RpZXMubGVuZ3RoOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgIT09IE47IGkrKykgewogICAgICAgIGNvbnN0IGIgPSBib2RpZXNbaV07CiAgICAgICAgYi5mb3JjZTsKICAgICAgICBiLnRvcnF1ZTsKICAgICAgICBiLmZvcmNlLnNldCgwLCAwLCAwKTsKICAgICAgICBiLnRvcnF1ZS5zZXQoMCwgMCwgMCk7CiAgICAgIH0KICAgIH0KCiAgfSAvLyBUZW1wIHN0dWZmCgogIG5ldyBBQUJCKCk7CiAgY29uc3QgdG1wUmF5ID0gbmV3IFJheSgpOyAvLyBwZXJmb3JtYW5jZS5ub3coKSBmYWxsYmFjayBvbiBEYXRlLm5vdygpCgogIGNvbnN0IHBlcmZvcm1hbmNlID0gZ2xvYmFsVGhpcy5wZXJmb3JtYW5jZSB8fCB7fTsKCiAgaWYgKCFwZXJmb3JtYW5jZS5ub3cpIHsKICAgIGxldCBub3dPZmZzZXQgPSBEYXRlLm5vdygpOwoKICAgIGlmIChwZXJmb3JtYW5jZS50aW1pbmcgJiYgcGVyZm9ybWFuY2UudGltaW5nLm5hdmlnYXRpb25TdGFydCkgewogICAgICBub3dPZmZzZXQgPSBwZXJmb3JtYW5jZS50aW1pbmcubmF2aWdhdGlvblN0YXJ0OwogICAgfQoKICAgIHBlcmZvcm1hbmNlLm5vdyA9ICgpID0+IERhdGUubm93KCkgLSBub3dPZmZzZXQ7CiAgfQoKICBuZXcgVmVjMygpOyAvLyBEaXNwYXRjaGVkIGFmdGVyIHRoZSB3b3JsZCBoYXMgc3RlcHBlZCBmb3J3YXJkIGluIHRpbWUuCiAgLy8gUmV1c2FibGUgZXZlbnQgb2JqZWN0cyB0byBzYXZlIG1lbW9yeS4KCiAgY29uc3QgV29ybGRfc3RlcF9wb3N0U3RlcEV2ZW50ID0gewogICAgdHlwZTogJ3Bvc3RTdGVwJwogIH07IC8vIERpc3BhdGNoZWQgYmVmb3JlIHRoZSB3b3JsZCBzdGVwcyBmb3J3YXJkIGluIHRpbWUuCgogIGNvbnN0IFdvcmxkX3N0ZXBfcHJlU3RlcEV2ZW50ID0gewogICAgdHlwZTogJ3ByZVN0ZXAnCiAgfTsKICBjb25zdCBXb3JsZF9zdGVwX2NvbGxpZGVFdmVudCA9IHsKICAgIHR5cGU6IEJvZHkuQ09MTElERV9FVkVOVF9OQU1FLAogICAgYm9keTogbnVsbCwKICAgIGNvbnRhY3Q6IG51bGwKICB9OyAvLyBQb29scyBmb3IgdW51c2VkIG9iamVjdHMKCiAgY29uc3QgV29ybGRfc3RlcF9vbGRDb250YWN0cyA9IFtdOwogIGNvbnN0IFdvcmxkX3N0ZXBfZnJpY3Rpb25FcXVhdGlvblBvb2wgPSBbXTsgLy8gUmV1c2FibGUgYXJyYXlzIGZvciBjb2xsaXNpb24gcGFpcnMKCiAgY29uc3QgV29ybGRfc3RlcF9wMSA9IFtdOwogIGNvbnN0IFdvcmxkX3N0ZXBfcDIgPSBbXTsgLy8gU3R1ZmYgZm9yIGVtaXRDb250YWN0RXZlbnRzCgogIGNvbnN0IGFkZGl0aW9ucyA9IFtdOwogIGNvbnN0IHJlbW92YWxzID0gW107CiAgY29uc3QgYmVnaW5Db250YWN0RXZlbnQgPSB7CiAgICB0eXBlOiAnYmVnaW5Db250YWN0JywKICAgIGJvZHlBOiBudWxsLAogICAgYm9keUI6IG51bGwKICB9OwogIGNvbnN0IGVuZENvbnRhY3RFdmVudCA9IHsKICAgIHR5cGU6ICdlbmRDb250YWN0JywKICAgIGJvZHlBOiBudWxsLAogICAgYm9keUI6IG51bGwKICB9OwogIGNvbnN0IGJlZ2luU2hhcGVDb250YWN0RXZlbnQgPSB7CiAgICB0eXBlOiAnYmVnaW5TaGFwZUNvbnRhY3QnLAogICAgYm9keUE6IG51bGwsCiAgICBib2R5QjogbnVsbCwKICAgIHNoYXBlQTogbnVsbCwKICAgIHNoYXBlQjogbnVsbAogIH07CiAgY29uc3QgZW5kU2hhcGVDb250YWN0RXZlbnQgPSB7CiAgICB0eXBlOiAnZW5kU2hhcGVDb250YWN0JywKICAgIGJvZHlBOiBudWxsLAogICAgYm9keUI6IG51bGwsCiAgICBzaGFwZUE6IG51bGwsCiAgICBzaGFwZUI6IG51bGwKICB9OwoKICBjb25zdCBhZGRDb250YWN0TWF0ZXJpYWwgPSAod29ybGQsIGNyZWF0ZU1hdGVyaWFsLCBfcmVmLCB1dWlkKSA9PiB7CiAgICBsZXQgW21hdGVyaWFsQSwgbWF0ZXJpYWxCLCBvcHRpb25zXSA9IF9yZWY7CiAgICBjb25zdCBtYXRBID0gY3JlYXRlTWF0ZXJpYWwobWF0ZXJpYWxBKTsKICAgIGNvbnN0IG1hdEIgPSBjcmVhdGVNYXRlcmlhbChtYXRlcmlhbEIpOwogICAgY29uc3QgY29udGFjdE1hdGVyaWFsID0gbmV3IENvbnRhY3RNYXRlcmlhbChtYXRBLCBtYXRCLCBvcHRpb25zKTsKICAgIGNvbnRhY3RNYXRlcmlhbC51dWlkID0gdXVpZDsKICAgIHdvcmxkLmFkZENvbnRhY3RNYXRlcmlhbChjb250YWN0TWF0ZXJpYWwpOwogIH07CiAgY29uc3QgcmVtb3ZlQ29udGFjdE1hdGVyaWFsID0gKHdvcmxkLCBjbVVVSUQpID0+IHsKICAgIGNvbnN0IGluZGV4ID0gd29ybGQuY29udGFjdG1hdGVyaWFscy5maW5kSW5kZXgoX3JlZjIgPT4gewogICAgICBsZXQgewogICAgICAgIHV1aWQKICAgICAgfSA9IF9yZWYyOwogICAgICByZXR1cm4gdXVpZCA9PT0gY21VVUlEOwogICAgfSk7CiAgICBjb25zdCBbewogICAgICBpZDogaQogICAgfSwgewogICAgICBpZDogagogICAgfV0gPSB3b3JsZC5jb250YWN0bWF0ZXJpYWxzW2luZGV4XS5tYXRlcmlhbHM7CiAgICB3b3JsZC5jb250YWN0bWF0ZXJpYWxzLnNwbGljZShpbmRleCwgMSk7CiAgICBkZWxldGUgd29ybGQuY29udGFjdE1hdGVyaWFsVGFibGUuZGF0YVtpIDwgaiA/IGAke2l9LSR7an1gIDogYCR7an0tJHtpfWBdOwogIH07CgogIGxldCBtYXRlcmlhbElkID0gMDsKICBjb25zdCBjcmVhdGVNYXRlcmlhbEZhY3RvcnkgPSBtYXRlcmlhbHMgPT4gZnVuY3Rpb24gKG5hbWVPck9wdGlvbnMpIHsKICAgIGlmIChuYW1lT3JPcHRpb25zID09PSB2b2lkIDApIHsKICAgICAgbmFtZU9yT3B0aW9ucyA9IHt9OwogICAgfQogICAgY29uc3QgbWF0ZXJpYWxPcHRpb25zID0gdHlwZW9mIG5hbWVPck9wdGlvbnMgPT09ICdzdHJpbmcnID8gewogICAgICBuYW1lOiBuYW1lT3JPcHRpb25zCiAgICB9IDogewogICAgICBuYW1lOiBTeW1ib2wuZm9yKGBNYXRlcmlhbCR7bWF0ZXJpYWxJZCsrfWApLAogICAgICAuLi5uYW1lT3JPcHRpb25zCiAgICB9OwogICAgY29uc3QgewogICAgICBuYW1lCiAgICB9ID0gbWF0ZXJpYWxPcHRpb25zOwogICAgbWF0ZXJpYWxzW25hbWVdID0gbWF0ZXJpYWxzW25hbWVdIHx8IG5ldyBNYXRlcmlhbChtYXRlcmlhbE9wdGlvbnMpOwogICAgcmV0dXJuIG1hdGVyaWFsc1tuYW1lXTsKICB9OwoKICAvKioKICAgKiBAdHlwZWRlZiB7IGltcG9ydCgnY2Fubm9uLWVzJykuTWF0ZXJpYWxPcHRpb25zIH0gTWF0ZXJpYWxPcHRpb25zCiAgICovCgogIGNvbnN0IG1ha2VWZWMzID0gX3JlZiA9PiB7CiAgICBsZXQgW3gsIHksIHpdID0gX3JlZjsKICAgIHJldHVybiBuZXcgVmVjMyh4LCB5LCB6KTsKICB9OwogIGNvbnN0IHByZXBhcmVTcGhlcmUgPSBhcmdzID0+IEFycmF5LmlzQXJyYXkoYXJncykgPyBhcmdzIDogW2FyZ3NdOwogIGNvbnN0IHByZXBhcmVDb252ZXhQb2x5aGVkcm9uID0gX3JlZjIgPT4gewogICAgbGV0IFt2LCBmYWNlcywgbiwgYSwgYm91bmRpbmdTcGhlcmVSYWRpdXNdID0gX3JlZjI7CiAgICByZXR1cm4gW3sKICAgICAgYXhlczogYSA/IGEubWFwKG1ha2VWZWMzKSA6IHVuZGVmaW5lZCwKICAgICAgYm91bmRpbmdTcGhlcmVSYWRpdXMsCiAgICAgIGZhY2VzLAogICAgICBub3JtYWxzOiBuID8gbi5tYXAobWFrZVZlYzMpIDogdW5kZWZpbmVkLAogICAgICB2ZXJ0aWNlczogdiA/IHYubWFwKG1ha2VWZWMzKSA6IHVuZGVmaW5lZAogICAgfV07CiAgfTsKICBmdW5jdGlvbiBjcmVhdGVTaGFwZSh0eXBlLCBhcmdzKSB7CiAgICBzd2l0Y2ggKHR5cGUpIHsKICAgICAgY2FzZSAnQm94JzoKICAgICAgICByZXR1cm4gbmV3IEJveChuZXcgVmVjMyguLi5hcmdzLm1hcCh2ID0+IHYgLyAyKSkpOwogICAgICAvLyBleHRlbnRzID0+IGhhbGZFeHRlbnRzCiAgICAgIGNhc2UgJ0NvbnZleFBvbHloZWRyb24nOgogICAgICAgIHJldHVybiBuZXcgQ29udmV4UG9seWhlZHJvbiguLi5wcmVwYXJlQ29udmV4UG9seWhlZHJvbihhcmdzKSk7CiAgICAgIGNhc2UgJ0N5bGluZGVyJzoKICAgICAgICByZXR1cm4gbmV3IEN5bGluZGVyKC4uLmFyZ3MpOwogICAgICAvLyBbIHJhZGl1c1RvcCwgcmFkaXVzQm90dG9tLCBoZWlnaHQsIG51bVNlZ21lbnRzIF0gPSBhcmdzCiAgICAgIGNhc2UgJ0hlaWdodGZpZWxkJzoKICAgICAgICByZXR1cm4gbmV3IEhlaWdodGZpZWxkKC4uLmFyZ3MpOwogICAgICAvLyBbIEFycmF5IGRhdGEsIG9wdGlvbnM6IHttaW5WYWx1ZSwgbWF4VmFsdWUsIGVsZW1lbnRTaXplfSAgXSA9IGFyZ3MKICAgICAgY2FzZSAnUGFydGljbGUnOgogICAgICAgIHJldHVybiBuZXcgUGFydGljbGUoKTsKICAgICAgLy8gbm8gYXJncwogICAgICBjYXNlICdQbGFuZSc6CiAgICAgICAgcmV0dXJuIG5ldyBQbGFuZSgpOwogICAgICAvLyBubyBhcmdzLCBpbmZpbml0ZSB4IGFuZCB5CiAgICAgIGNhc2UgJ1NwaGVyZSc6CiAgICAgICAgcmV0dXJuIG5ldyBTcGhlcmUoLi4ucHJlcGFyZVNwaGVyZShhcmdzKSk7CiAgICAgIC8vIHJhZGl1cyA9IGFyZ3MKICAgICAgY2FzZSAnVHJpbWVzaCc6CiAgICAgICAgcmV0dXJuIG5ldyBUcmltZXNoKC4uLmFyZ3MpOwogICAgICAvLyBbdmVydGljZXMsIGluZGljZXNdID0gYXJncwogICAgfQogIH0KCiAgLyoqCiAgICogQHBhcmFtIHtUSFJFRS5RdWF0ZXJuaW9ufSB0YXJnZXQKICAgKiBAcGFyYW0ge3sgcm90YXRpb24/OiBUSFJFRS5WZWN0b3IzVHVwbGUgcXVhdGVybmlvbj86IFRIUkVFLlZlY3RvcjRUdXBsZSB9fSBwcm9wcwogICAqIEByZXR1cm5zIHtUSFJFRS5RdWF0ZXJuaW9ufQogICAqLwogIGNvbnN0IHNldFF1YXRlcm5pb24gPSAodGFyZ2V0LCBfcmVmMykgPT4gewogICAgbGV0IHsKICAgICAgcXVhdGVybmlvbiwKICAgICAgcm90YXRpb24KICAgIH0gPSBfcmVmMzsKICAgIGlmIChxdWF0ZXJuaW9uKSB7CiAgICAgIHRhcmdldC5zZXQoLi4ucXVhdGVybmlvbik7CiAgICB9IGVsc2UgaWYgKHJvdGF0aW9uKSB7CiAgICAgIHRhcmdldC5zZXRGcm9tRXVsZXIoLi4ucm90YXRpb24pOwogICAgfQogICAgcmV0dXJuIHRhcmdldDsKICB9OwoKICAvKioKICAgKiBAZnVuY3Rpb24KICAgKiBAcGFyYW0ge09iamVjdH0gb3B0aW9ucwogICAqIEBwYXJhbSB7c3RyaW5nfSBvcHRpb25zLnV1aWQKICAgKiBAcGFyYW0ge0JvZHlQcm9wc30gb3B0aW9ucy5wcm9wcwogICAqIEBwYXJhbSB7Qm9keVNoYXBlVHlwZX0gb3B0aW9ucy50eXBlCiAgICogQHBhcmFtIHsobWF0ZXJpYWxPcHRpb25zOiBNYXRlcmlhbE9wdGlvbnMpID0+IE1hdGVyaWFsID19IG9wdGlvbnMuY3JlYXRlTWF0ZXJpYWwKICAgKiBAcmV0dXJucyB7Qm9keX0KICAgKi8KICBjb25zdCBwcm9wc1RvQm9keSA9IG9wdGlvbnMgPT4gewogICAgY29uc3QgewogICAgICB1dWlkLAogICAgICBwcm9wcywKICAgICAgdHlwZSwKICAgICAgY3JlYXRlTWF0ZXJpYWwgPSBtYXRlcmlhbE9wdGlvbnMgPT4gbmV3IE1hdGVyaWFsKG1hdGVyaWFsT3B0aW9ucykKICAgIH0gPSBvcHRpb25zOwogICAgY29uc3QgewogICAgICBhbmd1bGFyRmFjdG9yID0gWzEsIDEsIDFdLAogICAgICBhbmd1bGFyVmVsb2NpdHkgPSBbMCwgMCwgMF0sCiAgICAgIGFyZ3MgPSBbXSwKICAgICAgY29sbGlzaW9uUmVzcG9uc2UsCiAgICAgIGxpbmVhckZhY3RvciA9IFsxLCAxLCAxXSwKICAgICAgbWFzcywKICAgICAgbWF0ZXJpYWwsCiAgICAgIG9uQ29sbGlkZSwKICAgICAgcG9zaXRpb24gPSBbMCwgMCwgMF0sCiAgICAgIHJvdGF0aW9uLAogICAgICBxdWF0ZXJuaW9uLAogICAgICBzaGFwZXMsCiAgICAgIHR5cGU6IGJvZHlUeXBlLAogICAgICB2ZWxvY2l0eSA9IFswLCAwLCAwXSwKICAgICAgLi4uZXh0cmEKICAgIH0gPSBwcm9wczsKICAgIGNvbnN0IGJvZHkgPSBuZXcgQm9keSh7CiAgICAgIC4uLmV4dHJhLAogICAgICBtYXNzOiBib2R5VHlwZSA9PT0gJ1N0YXRpYycgPyAwIDogbWFzcywKICAgICAgbWF0ZXJpYWw6IG1hdGVyaWFsID8gY3JlYXRlTWF0ZXJpYWwobWF0ZXJpYWwpIDogdW5kZWZpbmVkLAogICAgICB0eXBlOiBib2R5VHlwZSA/IEJvZHlbYm9keVR5cGUudG9VcHBlckNhc2UoKV0gOiB1bmRlZmluZWQKICAgIH0pOwogICAgYm9keS51dWlkID0gdXVpZDsKICAgIGlmIChjb2xsaXNpb25SZXNwb25zZSAhPT0gdW5kZWZpbmVkKSB7CiAgICAgIGJvZHkuY29sbGlzaW9uUmVzcG9uc2UgPSBjb2xsaXNpb25SZXNwb25zZTsKICAgIH0KICAgIGlmICh0eXBlID09PSAnQ29tcG91bmQnKSB7CiAgICAgIHNoYXBlcy5mb3JFYWNoKF9yZWY0ID0+IHsKICAgICAgICBsZXQgewogICAgICAgICAgdHlwZSwKICAgICAgICAgIGFyZ3MsCiAgICAgICAgICBwb3NpdGlvbiwKICAgICAgICAgIHJvdGF0aW9uLAogICAgICAgICAgcXVhdGVybmlvbiwKICAgICAgICAgIG1hdGVyaWFsLAogICAgICAgICAgLi4uZXh0cmEKICAgICAgICB9ID0gX3JlZjQ7CiAgICAgICAgY29uc3Qgc2hhcGVCb2R5ID0gYm9keS5hZGRTaGFwZShjcmVhdGVTaGFwZSh0eXBlLCBhcmdzKSwgcG9zaXRpb24gPyBuZXcgVmVjMyguLi5wb3NpdGlvbikgOiB1bmRlZmluZWQsIHNldFF1YXRlcm5pb24obmV3IFF1YXRlcm5pb24oMCwgMCwgMCwgMSksIHsKICAgICAgICAgIHF1YXRlcm5pb24sCiAgICAgICAgICByb3RhdGlvbgogICAgICAgIH0pKTsKICAgICAgICBpZiAobWF0ZXJpYWwpIHNoYXBlQm9keS5tYXRlcmlhbCA9IGNyZWF0ZU1hdGVyaWFsKG1hdGVyaWFsKTsKICAgICAgICBPYmplY3QuYXNzaWduKHNoYXBlQm9keSwgZXh0cmEpOwogICAgICB9KTsKICAgIH0gZWxzZSB7CiAgICAgIGJvZHkuYWRkU2hhcGUoY3JlYXRlU2hhcGUodHlwZSwgYXJncykpOwogICAgfQogICAgYm9keS5wb3NpdGlvbi5zZXQocG9zaXRpb25bMF0sIHBvc2l0aW9uWzFdLCBwb3NpdGlvblsyXSk7CiAgICBib2R5LnZlbG9jaXR5LnNldCh2ZWxvY2l0eVswXSwgdmVsb2NpdHlbMV0sIHZlbG9jaXR5WzJdKTsKICAgIGJvZHkuYW5ndWxhclZlbG9jaXR5LnNldChhbmd1bGFyVmVsb2NpdHlbMF0sIGFuZ3VsYXJWZWxvY2l0eVsxXSwgYW5ndWxhclZlbG9jaXR5WzJdKTsKICAgIGJvZHkubGluZWFyRmFjdG9yLnNldChsaW5lYXJGYWN0b3JbMF0sIGxpbmVhckZhY3RvclsxXSwgbGluZWFyRmFjdG9yWzJdKTsKICAgIGJvZHkuYW5ndWxhckZhY3Rvci5zZXQoYW5ndWxhckZhY3RvclswXSwgYW5ndWxhckZhY3RvclsxXSwgYW5ndWxhckZhY3RvclsyXSk7CiAgICBzZXRRdWF0ZXJuaW9uKGJvZHkucXVhdGVybmlvbiwgewogICAgICBxdWF0ZXJuaW9uLAogICAgICByb3RhdGlvbgogICAgfSk7CiAgICByZXR1cm4gYm9keTsKICB9OwoKICBjb25zdCBhZGRCb2RpZXMgPSAoc3RhdGUsIGNyZWF0ZU1hdGVyaWFsLCBfcmVmKSA9PiB7CiAgICBsZXQgewogICAgICBwcm9wcywKICAgICAgdHlwZSwKICAgICAgdXVpZAogICAgfSA9IF9yZWY7CiAgICBmb3IgKGxldCBpID0gMDsgaSA8IHV1aWQubGVuZ3RoOyBpKyspIHsKICAgICAgY29uc3QgYm9keSA9IHByb3BzVG9Cb2R5KHsKICAgICAgICBjcmVhdGVNYXRlcmlhbCwKICAgICAgICBwcm9wczogcHJvcHNbaV0sCiAgICAgICAgdHlwZSwKICAgICAgICB1dWlkOiB1dWlkW2ldCiAgICAgIH0pOwogICAgICBzdGF0ZS53b3JsZC5hZGRCb2R5KGJvZHkpOwogICAgICBpZiAocHJvcHNbaV0ub25Db2xsaWRlKSBib2R5LmFkZEV2ZW50TGlzdGVuZXIoJ2NvbGxpZGUnLCBfcmVmMiA9PiB7CiAgICAgICAgbGV0IHsKICAgICAgICAgIHR5cGUsCiAgICAgICAgICBib2R5LAogICAgICAgICAgdGFyZ2V0LAogICAgICAgICAgY29udGFjdAogICAgICAgIH0gPSBfcmVmMjsKICAgICAgICBpZiAoIWJvZHkudXVpZCB8fCAhdGFyZ2V0LnV1aWQpIHJldHVybjsKICAgICAgICBjb25zdCB7CiAgICAgICAgICBuaSwKICAgICAgICAgIHJpLAogICAgICAgICAgcmosCiAgICAgICAgICBiaSwKICAgICAgICAgIGJqLAogICAgICAgICAgaWQKICAgICAgICB9ID0gY29udGFjdDsKICAgICAgICBjb25zdCBjb250YWN0UG9pbnQgPSBiaS5wb3NpdGlvbi52YWRkKHJpKTsKICAgICAgICBjb25zdCBjb250YWN0Tm9ybWFsID0gYmkgPT09IGJvZHkgPyBuaSA6IG5pLnNjYWxlKC0xKTsKICAgICAgICBzZWxmLnBvc3RNZXNzYWdlKHsKICAgICAgICAgIGJvZHk6IGJvZHkudXVpZCwKICAgICAgICAgIGNvbGxpc2lvbkZpbHRlcnM6IHsKICAgICAgICAgICAgYm9keUZpbHRlckdyb3VwOiBib2R5LmNvbGxpc2lvbkZpbHRlckdyb3VwLAogICAgICAgICAgICBib2R5RmlsdGVyTWFzazogYm9keS5jb2xsaXNpb25GaWx0ZXJNYXNrLAogICAgICAgICAgICB0YXJnZXRGaWx0ZXJHcm91cDogdGFyZ2V0LmNvbGxpc2lvbkZpbHRlckdyb3VwLAogICAgICAgICAgICB0YXJnZXRGaWx0ZXJNYXNrOiB0YXJnZXQuY29sbGlzaW9uRmlsdGVyTWFzawogICAgICAgICAgfSwKICAgICAgICAgIGNvbnRhY3Q6IHsKICAgICAgICAgICAgLy8gQHRzLWV4cGVjdC1lcnJvciBUT0RPOiB1c2UgaWQgaW5zdGVhZCBvZiB1dWlkCiAgICAgICAgICAgIGJpOiBiaS51dWlkLAogICAgICAgICAgICAvLyBAdHMtZXhwZWN0LWVycm9yIFRPRE86IHVzZSBpZCBpbnN0ZWFkIG9mIHV1aWQKICAgICAgICAgICAgYmo6IGJqLnV1aWQsCiAgICAgICAgICAgIC8vIE5vcm1hbCBvZiB0aGUgY29udGFjdCwgcmVsYXRpdmUgdG8gdGhlIGNvbGxpZGluZyBib2R5CiAgICAgICAgICAgIGNvbnRhY3ROb3JtYWw6IGNvbnRhY3ROb3JtYWwudG9BcnJheSgpLAogICAgICAgICAgICAvLyBXb3JsZCBwb3NpdGlvbiBvZiB0aGUgY29udGFjdAogICAgICAgICAgICBjb250YWN0UG9pbnQ6IGNvbnRhY3RQb2ludC50b0FycmF5KCksCiAgICAgICAgICAgIGlkLAogICAgICAgICAgICBpbXBhY3RWZWxvY2l0eTogY29udGFjdC5nZXRJbXBhY3RWZWxvY2l0eUFsb25nTm9ybWFsKCksCiAgICAgICAgICAgIG5pOiBuaS50b0FycmF5KCksCiAgICAgICAgICAgIHJpOiByaS50b0FycmF5KCksCiAgICAgICAgICAgIHJqOiByai50b0FycmF5KCkKICAgICAgICAgIH0sCiAgICAgICAgICBvcDogJ2V2ZW50JywKICAgICAgICAgIHRhcmdldDogdGFyZ2V0LnV1aWQsCiAgICAgICAgICB0eXBlCiAgICAgICAgfSk7CiAgICAgIH0pOwogICAgfQogIH07CgogIGNvbnN0IHRyaXBsZXRUb1ZlYzMgPSB0ID0+IHQgPyBuZXcgVmVjMyguLi50KSA6IHVuZGVmaW5lZDsKCiAgY29uc3QgYWRkQ29uc3RyYWludCA9IChzdGF0ZSwgX3JlZikgPT4gewogICAgbGV0IHsKICAgICAgcHJvcHM6IFtib2R5QSwgYm9keUIsIHsKICAgICAgICBhbmdsZSwKICAgICAgICBheGlzQSwKICAgICAgICBheGlzQiwKICAgICAgICBjb2xsaWRlQ29ubmVjdGVkLAogICAgICAgIGRpc3RhbmNlLAogICAgICAgIG1heEZvcmNlLAogICAgICAgIG1heE11bHRpcGxpZXIsCiAgICAgICAgcGl2b3RBLAogICAgICAgIHBpdm90QiwKICAgICAgICB0d2lzdEFuZ2xlLAogICAgICAgIHdha2VVcEJvZGllcwogICAgICB9XSwKICAgICAgdHlwZSwKICAgICAgdXVpZAogICAgfSA9IF9yZWY7CiAgICBsZXQgY29uc3RyYWludDsKICAgIHN3aXRjaCAodHlwZSkgewogICAgICBjYXNlICdQb2ludFRvUG9pbnQnOgogICAgICAgIGNvbnN0cmFpbnQgPSBuZXcgUG9pbnRUb1BvaW50Q29uc3RyYWludChzdGF0ZS5ib2RpZXNbYm9keUFdLCB0cmlwbGV0VG9WZWMzKHBpdm90QSksIHN0YXRlLmJvZGllc1tib2R5Ql0sIHRyaXBsZXRUb1ZlYzMocGl2b3RCKSwgbWF4Rm9yY2UpOwogICAgICAgIGJyZWFrOwogICAgICBjYXNlICdDb25lVHdpc3QnOgogICAgICAgIGNvbnN0cmFpbnQgPSBuZXcgQ29uZVR3aXN0Q29uc3RyYWludChzdGF0ZS5ib2RpZXNbYm9keUFdLCBzdGF0ZS5ib2RpZXNbYm9keUJdLCB7CiAgICAgICAgICBhbmdsZSwKICAgICAgICAgIGF4aXNBOiB0cmlwbGV0VG9WZWMzKGF4aXNBKSwKICAgICAgICAgIGF4aXNCOiB0cmlwbGV0VG9WZWMzKGF4aXNCKSwKICAgICAgICAgIGNvbGxpZGVDb25uZWN0ZWQsCiAgICAgICAgICBtYXhGb3JjZSwKICAgICAgICAgIHBpdm90QTogdHJpcGxldFRvVmVjMyhwaXZvdEEpLAogICAgICAgICAgcGl2b3RCOiB0cmlwbGV0VG9WZWMzKHBpdm90QiksCiAgICAgICAgICB0d2lzdEFuZ2xlCiAgICAgICAgfSk7CiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2UgJ0hpbmdlJzoKICAgICAgICBjb25zdHJhaW50ID0gbmV3IEhpbmdlQ29uc3RyYWludChzdGF0ZS5ib2RpZXNbYm9keUFdLCBzdGF0ZS5ib2RpZXNbYm9keUJdLCB7CiAgICAgICAgICBheGlzQTogdHJpcGxldFRvVmVjMyhheGlzQSksCiAgICAgICAgICBheGlzQjogdHJpcGxldFRvVmVjMyhheGlzQiksCiAgICAgICAgICBjb2xsaWRlQ29ubmVjdGVkLAogICAgICAgICAgbWF4Rm9yY2UsCiAgICAgICAgICBwaXZvdEE6IHRyaXBsZXRUb1ZlYzMocGl2b3RBKSwKICAgICAgICAgIHBpdm90QjogdHJpcGxldFRvVmVjMyhwaXZvdEIpCiAgICAgICAgfSk7CiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2UgJ0Rpc3RhbmNlJzoKICAgICAgICBjb25zdHJhaW50ID0gbmV3IERpc3RhbmNlQ29uc3RyYWludChzdGF0ZS5ib2RpZXNbYm9keUFdLCBzdGF0ZS5ib2RpZXNbYm9keUJdLCBkaXN0YW5jZSwgbWF4Rm9yY2UpOwogICAgICAgIGJyZWFrOwogICAgICBjYXNlICdMb2NrJzoKICAgICAgICBjb25zdHJhaW50ID0gbmV3IExvY2tDb25zdHJhaW50KHN0YXRlLmJvZGllc1tib2R5QV0sIHN0YXRlLmJvZGllc1tib2R5Ql0sIHsKICAgICAgICAgIG1heEZvcmNlCiAgICAgICAgfSk7CiAgICAgICAgYnJlYWs7CiAgICAgIGRlZmF1bHQ6CiAgICAgICAgY29uc3RyYWludCA9IG5ldyBDb25zdHJhaW50KHN0YXRlLmJvZGllc1tib2R5QV0sIHN0YXRlLmJvZGllc1tib2R5Ql0sIHsKICAgICAgICAgIGNvbGxpZGVDb25uZWN0ZWQsCiAgICAgICAgICB3YWtlVXBCb2RpZXMKICAgICAgICB9KTsKICAgICAgICBicmVhazsKICAgIH0KICAgIGNvbnN0cmFpbnQudXVpZCA9IHV1aWQ7CiAgICBzdGF0ZS53b3JsZC5hZGRDb25zdHJhaW50KGNvbnN0cmFpbnQpOwogICAgaWYgKG1heE11bHRpcGxpZXIgIT09IHVuZGVmaW5lZCkgewogICAgICBjb25zdCBwb3N0U3RlcENvbnN0cmFpbnQgPSAoKSA9PiB7CiAgICAgICAgLy8gVGhlIG11bHRpcGxpZXIgaXMgcHJvcG9ydGlvbmFsIHRvIGhvdyBtdWNoIGZvcmNlIGlzIGFkZGVkIHRvIHRoZSBib2RpZXMgYnkgdGhlIGNvbnN0cmFpbnQuCiAgICAgICAgLy8gSWYgdGhpcyBleGNlZWRzIGEgbGltaXQgdGhlIGNvbnN0cmFpbnQgaXMgZGlzYWJsZWQuCiAgICAgICAgY29uc3QgbXVsdGlwbGllciA9IE1hdGguYWJzKGNvbnN0cmFpbnQuZXF1YXRpb25zWzBdLm11bHRpcGxpZXIpOwogICAgICAgIGlmIChtdWx0aXBsaWVyID4gbWF4TXVsdGlwbGllcikgewogICAgICAgICAgY29uc3RyYWludC5kaXNhYmxlKCk7CiAgICAgICAgfQogICAgICB9OwogICAgICBzdGF0ZS5jb25zdHJhaW50c1t1dWlkXSA9IHBvc3RTdGVwQ29uc3RyYWludDsKICAgICAgc3RhdGUud29ybGQuYWRkRXZlbnRMaXN0ZW5lcigncG9zdFN0ZXAnLCBzdGF0ZS5jb25zdHJhaW50c1t1dWlkXSk7CiAgICB9CiAgfTsKCiAgZnVuY3Rpb24gdG9VcHBlcmNhc2Uoc3RyKSB7CiAgICByZXR1cm4gc3RyLnRvVXBwZXJDYXNlKCk7CiAgfQogIGNvbnN0IGFkZFJheSA9IChzdGF0ZSwgX3JlZikgPT4gewogICAgbGV0IHsKICAgICAgcHJvcHM6IHsKICAgICAgICBmcm9tLAogICAgICAgIG1vZGUsCiAgICAgICAgdG8sCiAgICAgICAgLi4ucmF5T3B0aW9ucwogICAgICB9LAogICAgICB1dWlkCiAgICB9ID0gX3JlZjsKICAgIGNvbnN0IHJheSA9IG5ldyBSYXkodHJpcGxldFRvVmVjMyhmcm9tKSwgdHJpcGxldFRvVmVjMyh0bykpOwogICAgY29uc3Qgb3B0aW9ucyA9IHsKICAgICAgbW9kZTogUkFZX01PREVTW3RvVXBwZXJjYXNlKG1vZGUpXSwKICAgICAgcmVzdWx0OiBuZXcgUmF5Y2FzdFJlc3VsdCgpLAogICAgICAuLi5yYXlPcHRpb25zCiAgICB9OwogICAgc3RhdGUucmF5c1t1dWlkXSA9ICgpID0+IHsKICAgICAgcmF5LmludGVyc2VjdFdvcmxkKHN0YXRlLndvcmxkLCBvcHRpb25zKTsKICAgICAgaWYgKCFvcHRpb25zLnJlc3VsdCB8fCAhb3B0aW9ucy5yZXN1bHQuYm9keSkgcmV0dXJuOwogICAgICBjb25zdCB7CiAgICAgICAgYm9keSwKICAgICAgICBzaGFwZSwKICAgICAgICByYXlGcm9tV29ybGQsCiAgICAgICAgcmF5VG9Xb3JsZCwKICAgICAgICBoaXROb3JtYWxXb3JsZCwKICAgICAgICBoaXRQb2ludFdvcmxkLAogICAgICAgIC4uLnJlc3QKICAgICAgfSA9IG9wdGlvbnMucmVzdWx0OwogICAgICBjb25zdCBib2R5VVVJRCA9IGJvZHkudXVpZDsKICAgICAgaWYgKCFib2R5VVVJRCkgcmV0dXJuOwogICAgICBzZWxmLnBvc3RNZXNzYWdlKHsKICAgICAgICBib2R5OiBib2R5VVVJRCwKICAgICAgICBoaXROb3JtYWxXb3JsZDogaGl0Tm9ybWFsV29ybGQudG9BcnJheSgpLAogICAgICAgIGhpdFBvaW50V29ybGQ6IGhpdFBvaW50V29ybGQudG9BcnJheSgpLAogICAgICAgIG9wOiAnZXZlbnQnLAogICAgICAgIHJheTogewogICAgICAgICAgY29sbGlzaW9uRmlsdGVyR3JvdXA6IHJheS5jb2xsaXNpb25GaWx0ZXJHcm91cCwKICAgICAgICAgIGNvbGxpc2lvbkZpbHRlck1hc2s6IHJheS5jb2xsaXNpb25GaWx0ZXJNYXNrLAogICAgICAgICAgZGlyZWN0aW9uOiByYXkuZGlyZWN0aW9uLnRvQXJyYXkoKSwKICAgICAgICAgIGZyb20sCiAgICAgICAgICB0bywKICAgICAgICAgIHV1aWQKICAgICAgICB9LAogICAgICAgIHJheUZyb21Xb3JsZDogcmF5RnJvbVdvcmxkLnRvQXJyYXkoKSwKICAgICAgICByYXlUb1dvcmxkOiByYXlUb1dvcmxkLnRvQXJyYXkoKSwKICAgICAgICBzaGFwZTogc2hhcGUgPyB7CiAgICAgICAgICAuLi5zaGFwZSwKICAgICAgICAgIGJvZHk6IGJvZHlVVUlECiAgICAgICAgfSA6IG51bGwsCiAgICAgICAgdHlwZTogJ3JheWhpdCcsCiAgICAgICAgLi4ucmVzdAogICAgICB9KTsKICAgIH07CiAgICBzdGF0ZS53b3JsZC5hZGRFdmVudExpc3RlbmVyKCdwcmVTdGVwJywgc3RhdGUucmF5c1t1dWlkXSk7CiAgfTsKCiAgY29uc3QgYWRkUmF5Y2FzdFZlaGljbGUgPSAoc3RhdGUsIGRhdGEpID0+IHsKICAgIGNvbnN0IFtjaGFzc2lzQm9keSwgd2hlZWxzLCB3aGVlbEluZm9zLCBpbmRleEZvcndhcmRBeGlzLCBpbmRleFJpZ2h0QXhpcywgaW5kZXhVcEF4aXNdID0gZGF0YS5wcm9wczsKICAgIGNvbnN0IHZlaGljbGUgPSBuZXcgUmF5Y2FzdFZlaGljbGUoewogICAgICBjaGFzc2lzQm9keTogc3RhdGUuYm9kaWVzW2NoYXNzaXNCb2R5XSwKICAgICAgaW5kZXhGb3J3YXJkQXhpcywKICAgICAgaW5kZXhSaWdodEF4aXMsCiAgICAgIGluZGV4VXBBeGlzCiAgICB9KTsKICAgIHZlaGljbGUud29ybGQgPSBzdGF0ZS53b3JsZDsKICAgIGZvciAobGV0IGkgPSAwOyBpIDwgd2hlZWxJbmZvcy5sZW5ndGg7IGkrKykgewogICAgICBjb25zdCB7CiAgICAgICAgYXhsZUxvY2FsLAogICAgICAgIGNoYXNzaXNDb25uZWN0aW9uUG9pbnRMb2NhbCwKICAgICAgICBkaXJlY3Rpb25Mb2NhbCwKICAgICAgICAuLi5yZXN0CiAgICAgIH0gPSB3aGVlbEluZm9zW2ldOwogICAgICB2ZWhpY2xlLmFkZFdoZWVsKHsKICAgICAgICBheGxlTG9jYWw6IHRyaXBsZXRUb1ZlYzMoYXhsZUxvY2FsKSwKICAgICAgICBjaGFzc2lzQ29ubmVjdGlvblBvaW50TG9jYWw6IHRyaXBsZXRUb1ZlYzMoY2hhc3Npc0Nvbm5lY3Rpb25Qb2ludExvY2FsKSwKICAgICAgICBkaXJlY3Rpb25Mb2NhbDogdHJpcGxldFRvVmVjMyhkaXJlY3Rpb25Mb2NhbCksCiAgICAgICAgLi4ucmVzdAogICAgICB9KTsKICAgIH0KICAgIGNvbnN0IHByZVN0ZXAgPSAoKSA9PiB7CiAgICAgIHZlaGljbGUudXBkYXRlVmVoaWNsZShzdGF0ZS53b3JsZC5kdCk7CiAgICB9OwogICAgY29uc3QgcG9zdFN0ZXAgPSAoKSA9PiB7CiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdmVoaWNsZS53aGVlbEluZm9zLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgdmVoaWNsZS51cGRhdGVXaGVlbFRyYW5zZm9ybShpKTsKICAgICAgICBjb25zdCB0ID0gdmVoaWNsZS53aGVlbEluZm9zW2ldLndvcmxkVHJhbnNmb3JtOwogICAgICAgIGNvbnN0IHdoZWVsQm9keSA9IHN0YXRlLmJvZGllc1t3aGVlbHNbaV1dOwogICAgICAgIHdoZWVsQm9keS5wb3NpdGlvbi5jb3B5KHQucG9zaXRpb24pOwogICAgICAgIHdoZWVsQm9keS5xdWF0ZXJuaW9uLmNvcHkodC5xdWF0ZXJuaW9uKTsKICAgICAgfQogICAgfTsKICAgIHN0YXRlLnZlaGljbGVzW2RhdGEudXVpZF0gPSB7CiAgICAgIHBvc3RTdGVwLAogICAgICBwcmVTdGVwLAogICAgICB2ZWhpY2xlCiAgICB9OwogICAgc3RhdGUud29ybGQuYWRkRXZlbnRMaXN0ZW5lcigncHJlU3RlcCcsIHByZVN0ZXApOwogICAgc3RhdGUud29ybGQuYWRkRXZlbnRMaXN0ZW5lcigncG9zdFN0ZXAnLCBwb3N0U3RlcCk7CiAgfTsKCiAgY29uc3QgYWRkU3ByaW5nID0gKHN0YXRlLCBfcmVmKSA9PiB7CiAgICBsZXQgewogICAgICBwcm9wczogW2JvZHlBLCBib2R5QiwgewogICAgICAgIGRhbXBpbmcsCiAgICAgICAgbG9jYWxBbmNob3JBLAogICAgICAgIGxvY2FsQW5jaG9yQiwKICAgICAgICByZXN0TGVuZ3RoLAogICAgICAgIHN0aWZmbmVzcywKICAgICAgICB3b3JsZEFuY2hvckEsCiAgICAgICAgd29ybGRBbmNob3JCCiAgICAgIH1dLAogICAgICB1dWlkCiAgICB9ID0gX3JlZjsKICAgIGNvbnN0IHNwcmluZyA9IG5ldyBTcHJpbmcoc3RhdGUuYm9kaWVzW2JvZHlBXSwgc3RhdGUuYm9kaWVzW2JvZHlCXSwgewogICAgICBkYW1waW5nLAogICAgICBsb2NhbEFuY2hvckE6IHRyaXBsZXRUb1ZlYzMobG9jYWxBbmNob3JBKSwKICAgICAgbG9jYWxBbmNob3JCOiB0cmlwbGV0VG9WZWMzKGxvY2FsQW5jaG9yQiksCiAgICAgIHJlc3RMZW5ndGgsCiAgICAgIHN0aWZmbmVzcywKICAgICAgd29ybGRBbmNob3JBOiB0cmlwbGV0VG9WZWMzKHdvcmxkQW5jaG9yQSksCiAgICAgIHdvcmxkQW5jaG9yQjogdHJpcGxldFRvVmVjMyh3b3JsZEFuY2hvckIpCiAgICB9KTsKICAgIHNwcmluZy51dWlkID0gdXVpZDsKICAgIGNvbnN0IHBvc3RTdGVwU3ByaW5nID0gKCkgPT4gc3ByaW5nLmFwcGx5Rm9yY2UoKTsKICAgIHN0YXRlLnNwcmluZ3NbdXVpZF0gPSBwb3N0U3RlcFNwcmluZzsKICAgIHN0YXRlLnNwcmluZ0luc3RhbmNlc1t1dWlkXSA9IHNwcmluZzsKCiAgICAvLyBDb21wdXRlIHRoZSBmb3JjZSBhZnRlciBlYWNoIHN0ZXAKICAgIHN0YXRlLndvcmxkLmFkZEV2ZW50TGlzdGVuZXIoJ3Bvc3RTdGVwJywgc3RhdGUuc3ByaW5nc1t1dWlkXSk7CiAgfTsKCiAgZnVuY3Rpb24gZW1pdEJlZ2luQ29udGFjdChfcmVmKSB7CiAgICBsZXQgewogICAgICBib2R5QSwKICAgICAgYm9keUIKICAgIH0gPSBfcmVmOwogICAgaWYgKCEoYm9keUEgIT0gbnVsbCAmJiBib2R5QS51dWlkKSB8fCAhKGJvZHlCICE9IG51bGwgJiYgYm9keUIudXVpZCkpIHJldHVybjsKICAgIHNlbGYucG9zdE1lc3NhZ2UoewogICAgICBib2R5QTogYm9keUEudXVpZCwKICAgICAgYm9keUI6IGJvZHlCLnV1aWQsCiAgICAgIG9wOiAnZXZlbnQnLAogICAgICB0eXBlOiAnY29sbGlkZUJlZ2luJwogICAgfSk7CiAgfQogIGZ1bmN0aW9uIGVtaXRFbmRDb250YWN0KF9yZWYyKSB7CiAgICBsZXQgewogICAgICBib2R5QSwKICAgICAgYm9keUIKICAgIH0gPSBfcmVmMjsKICAgIGlmICghKGJvZHlBICE9IG51bGwgJiYgYm9keUEudXVpZCkgfHwgIShib2R5QiAhPSBudWxsICYmIGJvZHlCLnV1aWQpKSByZXR1cm47CiAgICBzZWxmLnBvc3RNZXNzYWdlKHsKICAgICAgYm9keUE6IGJvZHlBLnV1aWQsCiAgICAgIGJvZHlCOiBib2R5Qi51dWlkLAogICAgICBvcDogJ2V2ZW50JywKICAgICAgdHlwZTogJ2NvbGxpZGVFbmQnCiAgICB9KTsKICB9CiAgY29uc3QgaW5pdCA9ICh3b3JsZCwgX3JlZjMpID0+IHsKICAgIGxldCB7CiAgICAgIGFsbG93U2xlZXAsCiAgICAgIGF4aXNJbmRleCA9IDAsCiAgICAgIGJyb2FkcGhhc2UsCiAgICAgIGRlZmF1bHRDb250YWN0TWF0ZXJpYWwsCiAgICAgIGZyaWN0aW9uR3Jhdml0eSwKICAgICAgZ3Jhdml0eSwKICAgICAgaXRlcmF0aW9ucywKICAgICAgcXVhdE5vcm1hbGl6ZUZhc3QsCiAgICAgIHF1YXROb3JtYWxpemVTa2lwLAogICAgICBzb2x2ZXIsCiAgICAgIHRvbGVyYW5jZQogICAgfSA9IF9yZWYzOwogICAgd29ybGQuYWxsb3dTbGVlcCA9IGFsbG93U2xlZXA7CiAgICB3b3JsZC5ncmF2aXR5LnNldCguLi5ncmF2aXR5KTsKICAgIHdvcmxkLmZyaWN0aW9uR3Jhdml0eSA9IGZyaWN0aW9uR3Jhdml0eSA/IG5ldyBWZWMzKC4uLmZyaWN0aW9uR3Jhdml0eSkgOiB1bmRlZmluZWQ7CiAgICB3b3JsZC5xdWF0Tm9ybWFsaXplRmFzdCA9IHF1YXROb3JtYWxpemVGYXN0OwogICAgd29ybGQucXVhdE5vcm1hbGl6ZVNraXAgPSBxdWF0Tm9ybWFsaXplU2tpcDsKICAgIGlmIChzb2x2ZXIgPT09ICdTcGxpdCcpIHsKICAgICAgd29ybGQuc29sdmVyID0gbmV3IFNwbGl0U29sdmVyKG5ldyBHU1NvbHZlcigpKTsKICAgIH0KICAgIGlmICh3b3JsZC5zb2x2ZXIgaW5zdGFuY2VvZiBHU1NvbHZlcikgewogICAgICB3b3JsZC5zb2x2ZXIudG9sZXJhbmNlID0gdG9sZXJhbmNlOwogICAgICB3b3JsZC5zb2x2ZXIuaXRlcmF0aW9ucyA9IGl0ZXJhdGlvbnM7CiAgICB9CiAgICB3b3JsZC5icm9hZHBoYXNlID0gYnJvYWRwaGFzZSA9PT0gJ1NBUCcgPyBuZXcgU0FQQnJvYWRwaGFzZSh3b3JsZCkgOiBuZXcgTmFpdmVCcm9hZHBoYXNlKCk7CiAgICBpZiAod29ybGQuYnJvYWRwaGFzZSBpbnN0YW5jZW9mIFNBUEJyb2FkcGhhc2UpIHsKICAgICAgd29ybGQuYnJvYWRwaGFzZS5heGlzSW5kZXggPSBheGlzSW5kZXg7CiAgICB9CiAgICB3b3JsZC5hZGRFdmVudExpc3RlbmVyKCdiZWdpbkNvbnRhY3QnLCBlbWl0QmVnaW5Db250YWN0KTsKICAgIHdvcmxkLmFkZEV2ZW50TGlzdGVuZXIoJ2VuZENvbnRhY3QnLCBlbWl0RW5kQ29udGFjdCk7CiAgICBPYmplY3QuYXNzaWduKHdvcmxkLmRlZmF1bHRDb250YWN0TWF0ZXJpYWwsIGRlZmF1bHRDb250YWN0TWF0ZXJpYWwpOwogIH07CgogIGNvbnN0IGlzUW9yViA9IHYgPT4gdiBpbnN0YW5jZW9mIFF1YXRlcm5pb24gfHwgdiBpbnN0YW5jZW9mIFZlYzM7CiAgY29uc3Qgc3RlcCA9IChzdGF0ZSwgX3JlZikgPT4gewogICAgbGV0IHsKICAgICAgcG9zaXRpb25zLAogICAgICBwcm9wczogewogICAgICAgIG1heFN1YlN0ZXBzLAogICAgICAgIHN0ZXBTaXplLAogICAgICAgIHRpbWVTaW5jZUxhc3RDYWxsZWQKICAgICAgfSwKICAgICAgcXVhdGVybmlvbnMKICAgIH0gPSBfcmVmOwogICAgc3RhdGUud29ybGQuc3RlcChzdGVwU2l6ZSwgdGltZVNpbmNlTGFzdENhbGxlZCwgbWF4U3ViU3RlcHMpOwogICAgZm9yIChsZXQgaSA9IDA7IGkgPCBzdGF0ZS53b3JsZC5ib2RpZXMubGVuZ3RoOyBpICs9IDEpIHsKICAgICAgY29uc3QgcCA9IHN0YXRlLndvcmxkLmJvZGllc1tpXS5wb3NpdGlvbjsKICAgICAgY29uc3QgcSA9IHN0YXRlLndvcmxkLmJvZGllc1tpXS5xdWF0ZXJuaW9uOwogICAgICBwb3NpdGlvbnNbMyAqIGkgKyAwXSA9IHAueDsKICAgICAgcG9zaXRpb25zWzMgKiBpICsgMV0gPSBwLnk7CiAgICAgIHBvc2l0aW9uc1szICogaSArIDJdID0gcC56OwogICAgICBxdWF0ZXJuaW9uc1s0ICogaSArIDBdID0gcS54OwogICAgICBxdWF0ZXJuaW9uc1s0ICogaSArIDFdID0gcS55OwogICAgICBxdWF0ZXJuaW9uc1s0ICogaSArIDJdID0gcS56OwogICAgICBxdWF0ZXJuaW9uc1s0ICogaSArIDNdID0gcS53OwogICAgfQogICAgY29uc3Qgb2JzZXJ2YXRpb25zID0gW107CiAgICBmb3IgKGNvbnN0IGlkIG9mIE9iamVjdC5rZXlzKHN0YXRlLnN1YnNjcmlwdGlvbnMpKSB7CiAgICAgIGNvbnN0IFt1dWlkLCB0eXBlLCB0YXJnZXQgPSAnYm9kaWVzJ10gPSBzdGF0ZS5zdWJzY3JpcHRpb25zW2lkXTsKICAgICAgY29uc3QgewogICAgICAgIGJvZGllcywKICAgICAgICB2ZWhpY2xlcwogICAgICB9ID0gc3RhdGU7CiAgICAgIGNvbnN0IHZhbHVlID0gdGFyZ2V0ID09PSAndmVoaWNsZXMnID8KICAgICAgLy8gQHRzLWV4cGVjdC1lcnJvciBUT0RPOiBEaWZmZXJlbnRpYXRlIHRoZXNlICJ0eXBlcyIKICAgICAgdmVoaWNsZXNbdXVpZF0udmVoaWNsZVt0eXBlXSA6CiAgICAgIC8vIEB0cy1leHBlY3QtZXJyb3IgVE9ETzogRGlmZmVyZW50aWF0ZSB0aGVzZSAidHlwZXMiCiAgICAgIGJvZGllc1t1dWlkXVt0eXBlXTsKICAgICAgY29uc3Qgc2VyaWFsaXphYmxlVmFsdWUgPSBpc1FvclYodmFsdWUpID8gdmFsdWUudG9BcnJheSgpIDogdmFsdWU7CiAgICAgIG9ic2VydmF0aW9ucy5wdXNoKFtOdW1iZXIoaWQpLCBzZXJpYWxpemFibGVWYWx1ZSwKICAgICAgLy8gQHRzLWV4cGVjdC1lcnJvciBUT0RPOiBEaWZmZXJlbnRpYXRlIHRoZXNlICJ0eXBlcyIKICAgICAgdHlwZV0pOwogICAgfQogICAgY29uc3QgbWVzc2FnZSA9IHsKICAgICAgYWN0aXZlOiBzdGF0ZS53b3JsZC5oYXNBY3RpdmVCb2RpZXMsCiAgICAgIG9ic2VydmF0aW9ucywKICAgICAgb3A6ICdmcmFtZScsCiAgICAgIHBvc2l0aW9ucywKICAgICAgcXVhdGVybmlvbnMKICAgIH07CiAgICBpZiAoc3RhdGUuYm9kaWVzTmVlZFN5bmNpbmcpIHsKICAgICAgbWVzc2FnZS5ib2RpZXMgPSBzdGF0ZS53b3JsZC5ib2RpZXMucmVkdWNlKChib2RpZXMsIGJvZHkpID0+IHsKICAgICAgICBpZiAoYm9keS51dWlkKSBib2RpZXMucHVzaChib2R5LnV1aWQpOwogICAgICAgIHJldHVybiBib2RpZXM7CiAgICAgIH0sIFtdKTsKICAgICAgc3RhdGUuYm9kaWVzTmVlZFN5bmNpbmcgPSBmYWxzZTsKICAgIH0KICAgIHNlbGYucG9zdE1lc3NhZ2UobWVzc2FnZSwgW3Bvc2l0aW9ucy5idWZmZXIsIHF1YXRlcm5pb25zLmJ1ZmZlcl0pOwogIH07CgogIGNvbnN0IHN0YXRlID0gewogICAgYm9kaWVzOiB7fSwKICAgIGJvZGllc05lZWRTeW5jaW5nOiBmYWxzZSwKICAgIGNvbnN0cmFpbnRzOiB7fSwKICAgIG1hdGVyaWFsczoge30sCiAgICByYXlzOiB7fSwKICAgIHNwcmluZ0luc3RhbmNlczoge30sCiAgICBzcHJpbmdzOiB7fSwKICAgIHN1YnNjcmlwdGlvbnM6IHt9LAogICAgdmVoaWNsZXM6IHt9LAogICAgd29ybGQ6IG5ldyBXb3JsZCgpCiAgfTsKCiAgLy8vIDxyZWZlcmVuY2Ugbm8tZGVmYXVsdC1saWI9InRydWUiLz4KICBjb25zdCBpc0hpbmdlQ29uc3RyYWludCA9IGMgPT4gYyBpbnN0YW5jZW9mIEhpbmdlQ29uc3RyYWludDsKICBmdW5jdGlvbiBzeW5jQm9kaWVzKCkgewogICAgc3RhdGUuYm9kaWVzTmVlZFN5bmNpbmcgPSB0cnVlOwogICAgc3RhdGUuYm9kaWVzID0gc3RhdGUud29ybGQuYm9kaWVzLnJlZHVjZSgoYm9kaWVzLCBib2R5KSA9PiBib2R5LnV1aWQgPyB7CiAgICAgIC4uLmJvZGllcywKICAgICAgW2JvZHkudXVpZF06IGJvZHkKICAgIH0gOiBib2RpZXMsIHt9KTsKICB9CiAgY29uc3QgYnJvYWRwaGFzZXMgPSB7CiAgICBOYWl2ZUJyb2FkcGhhc2UsCiAgICBTQVBCcm9hZHBoYXNlCiAgfTsKICBjb25zdCBjcmVhdGVNYXRlcmlhbCA9IGNyZWF0ZU1hdGVyaWFsRmFjdG9yeShzdGF0ZS5tYXRlcmlhbHMpOwogIHNlbGYub25tZXNzYWdlID0gX3JlZiA9PiB7CiAgICBsZXQgewogICAgICBkYXRhCiAgICB9ID0gX3JlZjsKICAgIHN3aXRjaCAoZGF0YS5vcCkgewogICAgICBjYXNlICdpbml0JzoKICAgICAgICB7CiAgICAgICAgICBpbml0KHN0YXRlLndvcmxkLCBkYXRhLnByb3BzKTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgICAgY2FzZSAnc3RlcCc6CiAgICAgICAgewogICAgICAgICAgc3RlcChzdGF0ZSwgZGF0YSk7CiAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAgIGNhc2UgJ2FkZEJvZGllcyc6CiAgICAgICAgewogICAgICAgICAgYWRkQm9kaWVzKHN0YXRlLCBjcmVhdGVNYXRlcmlhbCwgZGF0YSk7CiAgICAgICAgICBzeW5jQm9kaWVzKCk7CiAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAgIGNhc2UgJ3JlbW92ZUJvZGllcyc6CiAgICAgICAgewogICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBkYXRhLnV1aWQubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgc3RhdGUud29ybGQucmVtb3ZlQm9keShzdGF0ZS5ib2RpZXNbZGF0YS51dWlkW2ldXSk7CiAgICAgICAgICAgIGNvbnN0IGtleSA9IE9iamVjdC5rZXlzKHN0YXRlLnN1YnNjcmlwdGlvbnMpLmZpbmQoayA9PiBzdGF0ZS5zdWJzY3JpcHRpb25zW2tdWzBdID09PSBkYXRhLnV1aWRbaV0pOwogICAgICAgICAgICBpZiAoa2V5KSB7CiAgICAgICAgICAgICAgZGVsZXRlIHN0YXRlLnN1YnNjcmlwdGlvbnNba2V5XTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgICAgc3luY0JvZGllcygpOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgICBjYXNlICdzdWJzY3JpYmUnOgogICAgICAgIHsKICAgICAgICAgIGNvbnN0IHsKICAgICAgICAgICAgaWQsCiAgICAgICAgICAgIHRhcmdldCwKICAgICAgICAgICAgdHlwZQogICAgICAgICAgfSA9IGRhdGEucHJvcHM7CiAgICAgICAgICBzdGF0ZS5zdWJzY3JpcHRpb25zW2lkXSA9IFtkYXRhLnV1aWQsIHR5cGUsIHRhcmdldF07CiAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAgIGNhc2UgJ3Vuc3Vic2NyaWJlJzoKICAgICAgICB7CiAgICAgICAgICBkZWxldGUgc3RhdGUuc3Vic2NyaXB0aW9uc1tkYXRhLnByb3BzXTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgICAgY2FzZSAnc2V0UG9zaXRpb24nOgogICAgICAgIHN0YXRlLmJvZGllc1tkYXRhLnV1aWRdLnBvc2l0aW9uLnNldChkYXRhLnByb3BzWzBdLCBkYXRhLnByb3BzWzFdLCBkYXRhLnByb3BzWzJdKTsKICAgICAgICBicmVhazsKICAgICAgY2FzZSAnc2V0UXVhdGVybmlvbic6CiAgICAgICAgc3RhdGUuYm9kaWVzW2RhdGEudXVpZF0ucXVhdGVybmlvbi5zZXQoZGF0YS5wcm9wc1swXSwgZGF0YS5wcm9wc1sxXSwgZGF0YS5wcm9wc1syXSwgZGF0YS5wcm9wc1szXSk7CiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2UgJ3NldFJvdGF0aW9uJzoKICAgICAgICBzdGF0ZS5ib2RpZXNbZGF0YS51dWlkXS5xdWF0ZXJuaW9uLnNldEZyb21FdWxlcihkYXRhLnByb3BzWzBdLCBkYXRhLnByb3BzWzFdLCBkYXRhLnByb3BzWzJdKTsKICAgICAgICBicmVhazsKICAgICAgY2FzZSAnc2V0VmVsb2NpdHknOgogICAgICAgIHN0YXRlLmJvZGllc1tkYXRhLnV1aWRdLnZlbG9jaXR5LnNldChkYXRhLnByb3BzWzBdLCBkYXRhLnByb3BzWzFdLCBkYXRhLnByb3BzWzJdKTsKICAgICAgICBicmVhazsKICAgICAgY2FzZSAnc2V0QW5ndWxhclZlbG9jaXR5JzoKICAgICAgICBzdGF0ZS5ib2RpZXNbZGF0YS51dWlkXS5hbmd1bGFyVmVsb2NpdHkuc2V0KGRhdGEucHJvcHNbMF0sIGRhdGEucHJvcHNbMV0sIGRhdGEucHJvcHNbMl0pOwogICAgICAgIGJyZWFrOwogICAgICBjYXNlICdzZXRMaW5lYXJGYWN0b3InOgogICAgICAgIHN0YXRlLmJvZGllc1tkYXRhLnV1aWRdLmxpbmVhckZhY3Rvci5zZXQoZGF0YS5wcm9wc1swXSwgZGF0YS5wcm9wc1sxXSwgZGF0YS5wcm9wc1syXSk7CiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2UgJ3NldEFuZ3VsYXJGYWN0b3InOgogICAgICAgIHN0YXRlLmJvZGllc1tkYXRhLnV1aWRdLmFuZ3VsYXJGYWN0b3Iuc2V0KGRhdGEucHJvcHNbMF0sIGRhdGEucHJvcHNbMV0sIGRhdGEucHJvcHNbMl0pOwogICAgICAgIGJyZWFrOwogICAgICBjYXNlICdzZXRNYXNzJzoKICAgICAgICBzdGF0ZS5ib2RpZXNbZGF0YS51dWlkXS5tYXNzID0gZGF0YS5wcm9wczsKICAgICAgICBzdGF0ZS5ib2RpZXNbZGF0YS51dWlkXS51cGRhdGVNYXNzUHJvcGVydGllcygpOwogICAgICAgIGJyZWFrOwogICAgICBjYXNlICdzZXRNYXRlcmlhbCc6CiAgICAgICAgc3RhdGUuYm9kaWVzW2RhdGEudXVpZF0ubWF0ZXJpYWwgPSBkYXRhLnByb3BzID8gY3JlYXRlTWF0ZXJpYWwoZGF0YS5wcm9wcykgOiBudWxsOwogICAgICAgIGJyZWFrOwogICAgICBjYXNlICdzZXRMaW5lYXJEYW1waW5nJzoKICAgICAgICBzdGF0ZS5ib2RpZXNbZGF0YS51dWlkXS5saW5lYXJEYW1waW5nID0gZGF0YS5wcm9wczsKICAgICAgICBicmVhazsKICAgICAgY2FzZSAnc2V0QW5ndWxhckRhbXBpbmcnOgogICAgICAgIHN0YXRlLmJvZGllc1tkYXRhLnV1aWRdLmFuZ3VsYXJEYW1waW5nID0gZGF0YS5wcm9wczsKICAgICAgICBicmVhazsKICAgICAgY2FzZSAnc2V0QWxsb3dTbGVlcCc6CiAgICAgICAgc3RhdGUuYm9kaWVzW2RhdGEudXVpZF0uYWxsb3dTbGVlcCA9IGRhdGEucHJvcHM7CiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2UgJ3NldFNsZWVwU3BlZWRMaW1pdCc6CiAgICAgICAgc3RhdGUuYm9kaWVzW2RhdGEudXVpZF0uc2xlZXBTcGVlZExpbWl0ID0gZGF0YS5wcm9wczsKICAgICAgICBicmVhazsKICAgICAgY2FzZSAnc2V0U2xlZXBUaW1lTGltaXQnOgogICAgICAgIHN0YXRlLmJvZGllc1tkYXRhLnV1aWRdLnNsZWVwVGltZUxpbWl0ID0gZGF0YS5wcm9wczsKICAgICAgICBicmVhazsKICAgICAgY2FzZSAnc2V0Q29sbGlzaW9uRmlsdGVyR3JvdXAnOgogICAgICAgIHN0YXRlLmJvZGllc1tkYXRhLnV1aWRdLmNvbGxpc2lvbkZpbHRlckdyb3VwID0gZGF0YS5wcm9wczsKICAgICAgICBicmVhazsKICAgICAgY2FzZSAnc2V0Q29sbGlzaW9uRmlsdGVyTWFzayc6CiAgICAgICAgc3RhdGUuYm9kaWVzW2RhdGEudXVpZF0uY29sbGlzaW9uRmlsdGVyTWFzayA9IGRhdGEucHJvcHM7CiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2UgJ3NldENvbGxpc2lvblJlc3BvbnNlJzoKICAgICAgICBzdGF0ZS5ib2RpZXNbZGF0YS51dWlkXS5jb2xsaXNpb25SZXNwb25zZSA9IGRhdGEucHJvcHM7CiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2UgJ3NldEZpeGVkUm90YXRpb24nOgogICAgICAgIHN0YXRlLmJvZGllc1tkYXRhLnV1aWRdLmZpeGVkUm90YXRpb24gPSBkYXRhLnByb3BzOwogICAgICAgIGJyZWFrOwogICAgICBjYXNlICdzZXRGcmljdGlvbkdyYXZpdHknOgogICAgICAgIHN0YXRlLndvcmxkLmZyaWN0aW9uR3Jhdml0eSA9IGRhdGEucHJvcHMgPyBuZXcgVmVjMyguLi5kYXRhLnByb3BzKSA6IHVuZGVmaW5lZDsKICAgICAgICBicmVhazsKICAgICAgY2FzZSAnc2V0SXNUcmlnZ2VyJzoKICAgICAgICBzdGF0ZS5ib2RpZXNbZGF0YS51dWlkXS5pc1RyaWdnZXIgPSBkYXRhLnByb3BzOwogICAgICAgIGJyZWFrOwogICAgICBjYXNlICdzZXRHcmF2aXR5JzoKICAgICAgICBzdGF0ZS53b3JsZC5ncmF2aXR5LnNldChkYXRhLnByb3BzWzBdLCBkYXRhLnByb3BzWzFdLCBkYXRhLnByb3BzWzJdKTsKICAgICAgICBicmVhazsKICAgICAgY2FzZSAnc2V0VG9sZXJhbmNlJzoKICAgICAgICBpZiAoc3RhdGUud29ybGQuc29sdmVyIGluc3RhbmNlb2YgR1NTb2x2ZXIpIHsKICAgICAgICAgIHN0YXRlLndvcmxkLnNvbHZlci50b2xlcmFuY2UgPSBkYXRhLnByb3BzOwogICAgICAgIH0KICAgICAgICBicmVhazsKICAgICAgY2FzZSAnc2V0SXRlcmF0aW9ucyc6CiAgICAgICAgaWYgKHN0YXRlLndvcmxkLnNvbHZlciBpbnN0YW5jZW9mIEdTU29sdmVyKSB7CiAgICAgICAgICBzdGF0ZS53b3JsZC5zb2x2ZXIuaXRlcmF0aW9ucyA9IGRhdGEucHJvcHM7CiAgICAgICAgfQogICAgICAgIGJyZWFrOwogICAgICBjYXNlICdzZXRCcm9hZHBoYXNlJzoKICAgICAgICBzdGF0ZS53b3JsZC5icm9hZHBoYXNlID0gbmV3IChicm9hZHBoYXNlc1tgJHtkYXRhLnByb3BzfUJyb2FkcGhhc2VgXSB8fCBOYWl2ZUJyb2FkcGhhc2UpKHN0YXRlLndvcmxkKTsKICAgICAgICBicmVhazsKICAgICAgY2FzZSAnc2V0QXhpc0luZGV4JzoKICAgICAgICBpZiAoc3RhdGUud29ybGQuYnJvYWRwaGFzZSBpbnN0YW5jZW9mIFNBUEJyb2FkcGhhc2UpIHsKICAgICAgICAgIHN0YXRlLndvcmxkLmJyb2FkcGhhc2UuYXhpc0luZGV4ID0gZGF0YS5wcm9wcyA9PT0gdW5kZWZpbmVkIHx8IGRhdGEucHJvcHMgPT09IG51bGwgPyAwIDogZGF0YS5wcm9wczsKICAgICAgICB9CiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2UgJ2FwcGx5Rm9yY2UnOgogICAgICAgIHN0YXRlLmJvZGllc1tkYXRhLnV1aWRdLmFwcGx5Rm9yY2UobmV3IFZlYzMoLi4uZGF0YS5wcm9wc1swXSksIG5ldyBWZWMzKC4uLmRhdGEucHJvcHNbMV0pKTsKICAgICAgICBicmVhazsKICAgICAgY2FzZSAnYXBwbHlJbXB1bHNlJzoKICAgICAgICBzdGF0ZS5ib2RpZXNbZGF0YS51dWlkXS5hcHBseUltcHVsc2UobmV3IFZlYzMoLi4uZGF0YS5wcm9wc1swXSksIG5ldyBWZWMzKC4uLmRhdGEucHJvcHNbMV0pKTsKICAgICAgICBicmVhazsKICAgICAgY2FzZSAnYXBwbHlMb2NhbEZvcmNlJzoKICAgICAgICBzdGF0ZS5ib2RpZXNbZGF0YS51dWlkXS5hcHBseUxvY2FsRm9yY2UobmV3IFZlYzMoLi4uZGF0YS5wcm9wc1swXSksIG5ldyBWZWMzKC4uLmRhdGEucHJvcHNbMV0pKTsKICAgICAgICBicmVhazsKICAgICAgY2FzZSAnYXBwbHlMb2NhbEltcHVsc2UnOgogICAgICAgIHN0YXRlLmJvZGllc1tkYXRhLnV1aWRdLmFwcGx5TG9jYWxJbXB1bHNlKG5ldyBWZWMzKC4uLmRhdGEucHJvcHNbMF0pLCBuZXcgVmVjMyguLi5kYXRhLnByb3BzWzFdKSk7CiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2UgJ2FwcGx5VG9ycXVlJzoKICAgICAgICBzdGF0ZS5ib2RpZXNbZGF0YS51dWlkXS5hcHBseVRvcnF1ZShuZXcgVmVjMyguLi5kYXRhLnByb3BzWzBdKSk7CiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2UgJ2FkZENvbnN0cmFpbnQnOgogICAgICAgIHsKICAgICAgICAgIGFkZENvbnN0cmFpbnQoc3RhdGUsIGRhdGEpOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgICBjYXNlICdyZW1vdmVDb25zdHJhaW50JzoKICAgICAgICBzdGF0ZS53b3JsZC5jb25zdHJhaW50cy5maWx0ZXIoX3JlZjIgPT4gewogICAgICAgICAgbGV0IHsKICAgICAgICAgICAgdXVpZAogICAgICAgICAgfSA9IF9yZWYyOwogICAgICAgICAgcmV0dXJuIHV1aWQgPT09IGRhdGEudXVpZDsKICAgICAgICB9KS5tYXAoYyA9PiBzdGF0ZS53b3JsZC5yZW1vdmVDb25zdHJhaW50KGMpKTsKICAgICAgICBpZiAoc3RhdGUuY29uc3RyYWludHNbZGF0YS51dWlkXSkgewogICAgICAgICAgc3RhdGUud29ybGQucmVtb3ZlRXZlbnRMaXN0ZW5lcigncG9zdFN0ZXAnLCBzdGF0ZS5jb25zdHJhaW50c1tkYXRhLnV1aWRdKTsKICAgICAgICAgIGRlbGV0ZSBzdGF0ZS5jb25zdHJhaW50c1tkYXRhLnV1aWRdOwogICAgICAgIH0KICAgICAgICBicmVhazsKICAgICAgY2FzZSAnZW5hYmxlQ29uc3RyYWludCc6CiAgICAgICAgc3RhdGUud29ybGQuY29uc3RyYWludHMuZmlsdGVyKGMgPT4gYy51dWlkID09PSBkYXRhLnV1aWQpLm1hcChjID0+IGMuZW5hYmxlKCkpOwogICAgICAgIGJyZWFrOwogICAgICBjYXNlICdkaXNhYmxlQ29uc3RyYWludCc6CiAgICAgICAgc3RhdGUud29ybGQuY29uc3RyYWludHMuZmlsdGVyKGMgPT4gYy51dWlkID09PSBkYXRhLnV1aWQpLm1hcChjID0+IGMuZGlzYWJsZSgpKTsKICAgICAgICBicmVhazsKICAgICAgY2FzZSAnZW5hYmxlQ29uc3RyYWludE1vdG9yJzoKICAgICAgICBzdGF0ZS53b3JsZC5jb25zdHJhaW50cy5maWx0ZXIoYyA9PiBjLnV1aWQgPT09IGRhdGEudXVpZCkuZmlsdGVyKGlzSGluZ2VDb25zdHJhaW50KS5tYXAoYyA9PiBjLmVuYWJsZU1vdG9yKCkpOwogICAgICAgIGJyZWFrOwogICAgICBjYXNlICdkaXNhYmxlQ29uc3RyYWludE1vdG9yJzoKICAgICAgICBzdGF0ZS53b3JsZC5jb25zdHJhaW50cy5maWx0ZXIoYyA9PiBjLnV1aWQgPT09IGRhdGEudXVpZCkuZmlsdGVyKGlzSGluZ2VDb25zdHJhaW50KS5tYXAoYyA9PiBjLmRpc2FibGVNb3RvcigpKTsKICAgICAgICBicmVhazsKICAgICAgY2FzZSAnc2V0Q29uc3RyYWludE1vdG9yU3BlZWQnOgogICAgICAgIHN0YXRlLndvcmxkLmNvbnN0cmFpbnRzLmZpbHRlcihjID0+IGMudXVpZCA9PT0gZGF0YS51dWlkKS5maWx0ZXIoaXNIaW5nZUNvbnN0cmFpbnQpLm1hcChjID0+IGMuc2V0TW90b3JTcGVlZChkYXRhLnByb3BzKSk7CiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2UgJ3NldENvbnN0cmFpbnRNb3Rvck1heEZvcmNlJzoKICAgICAgICBzdGF0ZS53b3JsZC5jb25zdHJhaW50cy5maWx0ZXIoYyA9PiBjLnV1aWQgPT09IGRhdGEudXVpZCkuZmlsdGVyKGlzSGluZ2VDb25zdHJhaW50KS5tYXAoYyA9PiBjLnNldE1vdG9yTWF4Rm9yY2UoZGF0YS5wcm9wcykpOwogICAgICAgIGJyZWFrOwogICAgICBjYXNlICdhZGRTcHJpbmcnOgogICAgICAgIHsKICAgICAgICAgIGFkZFNwcmluZyhzdGF0ZSwgZGF0YSk7CiAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAgIGNhc2UgJ3NldFNwcmluZ1N0aWZmbmVzcyc6CiAgICAgICAgewogICAgICAgICAgc3RhdGUuc3ByaW5nSW5zdGFuY2VzW2RhdGEudXVpZF0uc3RpZmZuZXNzID0gZGF0YS5wcm9wczsKICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgICAgY2FzZSAnc2V0U3ByaW5nUmVzdExlbmd0aCc6CiAgICAgICAgewogICAgICAgICAgc3RhdGUuc3ByaW5nSW5zdGFuY2VzW2RhdGEudXVpZF0ucmVzdExlbmd0aCA9IGRhdGEucHJvcHM7CiAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAgIGNhc2UgJ3NldFNwcmluZ0RhbXBpbmcnOgogICAgICAgIHsKICAgICAgICAgIHN0YXRlLnNwcmluZ0luc3RhbmNlc1tkYXRhLnV1aWRdLmRhbXBpbmcgPSBkYXRhLnByb3BzOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgICBjYXNlICdyZW1vdmVTcHJpbmcnOgogICAgICAgIHsKICAgICAgICAgIHN0YXRlLndvcmxkLnJlbW92ZUV2ZW50TGlzdGVuZXIoJ3Bvc3RTdGVwJywgc3RhdGUuc3ByaW5nc1tkYXRhLnV1aWRdKTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgICAgY2FzZSAnYWRkUmF5JzoKICAgICAgICB7CiAgICAgICAgICBhZGRSYXkoc3RhdGUsIGRhdGEpOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgICBjYXNlICdyZW1vdmVSYXknOgogICAgICAgIHsKICAgICAgICAgIHN0YXRlLndvcmxkLnJlbW92ZUV2ZW50TGlzdGVuZXIoJ3ByZVN0ZXAnLCBzdGF0ZS5yYXlzW2RhdGEudXVpZF0pOwogICAgICAgICAgZGVsZXRlIHN0YXRlLnJheXNbZGF0YS51dWlkXTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgICAgY2FzZSAnYWRkUmF5Y2FzdFZlaGljbGUnOgogICAgICAgIHsKICAgICAgICAgIGFkZFJheWNhc3RWZWhpY2xlKHN0YXRlLCBkYXRhKTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgICAgY2FzZSAncmVtb3ZlUmF5Y2FzdFZlaGljbGUnOgogICAgICAgIHsKICAgICAgICAgIHN0YXRlLndvcmxkLnJlbW92ZUV2ZW50TGlzdGVuZXIoJ3ByZVN0ZXAnLCBzdGF0ZS52ZWhpY2xlc1tkYXRhLnV1aWRdLnByZVN0ZXApOwogICAgICAgICAgc3RhdGUud29ybGQucmVtb3ZlRXZlbnRMaXN0ZW5lcigncG9zdFN0ZXAnLCBzdGF0ZS52ZWhpY2xlc1tkYXRhLnV1aWRdLnBvc3RTdGVwKTsKICAgICAgICAgIHN0YXRlLnZlaGljbGVzW2RhdGEudXVpZF0udmVoaWNsZS53b3JsZCA9IG51bGw7CiAgICAgICAgICBkZWxldGUgc3RhdGUudmVoaWNsZXNbZGF0YS51dWlkXTsKICAgICAgICAgIGNvbnN0IGtleSA9IE9iamVjdC5rZXlzKHN0YXRlLnN1YnNjcmlwdGlvbnMpLmZpbmQoayA9PiBzdGF0ZS5zdWJzY3JpcHRpb25zW2tdWzBdID09PSBkYXRhLnV1aWQpOwogICAgICAgICAgaWYgKGtleSkgewogICAgICAgICAgICBkZWxldGUgc3RhdGUuc3Vic2NyaXB0aW9uc1trZXldOwogICAgICAgICAgfQogICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgICBjYXNlICdzZXRSYXljYXN0VmVoaWNsZVN0ZWVyaW5nVmFsdWUnOgogICAgICAgIHsKICAgICAgICAgIGNvbnN0IFt2YWx1ZSwgd2hlZWxJbmRleF0gPSBkYXRhLnByb3BzOwogICAgICAgICAgc3RhdGUudmVoaWNsZXNbZGF0YS51dWlkXS52ZWhpY2xlLnNldFN0ZWVyaW5nVmFsdWUodmFsdWUsIHdoZWVsSW5kZXgpOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgICBjYXNlICdhcHBseVJheWNhc3RWZWhpY2xlRW5naW5lRm9yY2UnOgogICAgICAgIHsKICAgICAgICAgIGNvbnN0IFt2YWx1ZSwgd2hlZWxJbmRleF0gPSBkYXRhLnByb3BzOwogICAgICAgICAgc3RhdGUudmVoaWNsZXNbZGF0YS51dWlkXS52ZWhpY2xlLmFwcGx5RW5naW5lRm9yY2UodmFsdWUsIHdoZWVsSW5kZXgpOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgICBjYXNlICdzZXRSYXljYXN0VmVoaWNsZUJyYWtlJzoKICAgICAgICB7CiAgICAgICAgICBjb25zdCBbYnJha2UsIHdoZWVsSW5kZXhdID0gZGF0YS5wcm9wczsKICAgICAgICAgIHN0YXRlLnZlaGljbGVzW2RhdGEudXVpZF0udmVoaWNsZS5zZXRCcmFrZShicmFrZSwgd2hlZWxJbmRleCk7CiAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAgIGNhc2UgJ2FkZENvbnRhY3RNYXRlcmlhbCc6CiAgICAgICAgewogICAgICAgICAgYWRkQ29udGFjdE1hdGVyaWFsKHN0YXRlLndvcmxkLCBjcmVhdGVNYXRlcmlhbCwgZGF0YS5wcm9wcywgZGF0YS51dWlkKTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgICAgY2FzZSAncmVtb3ZlQ29udGFjdE1hdGVyaWFsJzoKICAgICAgICB7CiAgICAgICAgICByZW1vdmVDb250YWN0TWF0ZXJpYWwoc3RhdGUud29ybGQsIGRhdGEudXVpZCk7CiAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAgIGNhc2UgJ3dha2VVcCc6CiAgICAgICAgewogICAgICAgICAgc3RhdGUuYm9kaWVzW2RhdGEudXVpZF0ud2FrZVVwKCk7CiAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAgIGNhc2UgJ3NsZWVwJzoKICAgICAgICB7CiAgICAgICAgICBzdGF0ZS5ib2RpZXNbZGF0YS51dWlkXS5zbGVlcCgpOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgfQogIH07Cgp9KSgpOwoK",null,!1);class j7 extends k7{get axisIndex(){return this.config.axisIndex}set axisIndex(e){this.config.axisIndex=e,this.postMessage({op:"setAxisIndex",props:e})}get broadphase(){return this.config.broadphase}set broadphase(e){this.config.broadphase=e,this.postMessage({op:"setBroadphase",props:e})}get frictionGravity(){return this.config.frictionGravity}set frictionGravity(e){this.config.frictionGravity=e,this.postMessage({op:"setFrictionGravity",props:e})}get gravity(){return this.config.gravity}set gravity(e){this.config.gravity=e,this.postMessage({op:"setGravity",props:e})}get iterations(){return this.config.iterations}set iterations(e){this.config.iterations=e,this.postMessage({op:"setIterations",props:e})}get tolerance(){return this.config.tolerance}set tolerance(e){this.config.tolerance=e,this.postMessage({op:"setTolerance",props:e})}messageQueue=[];worker=null;constructor(e){let{allowSleep:t=!1,axisIndex:n=0,broadphase:i="Naive",defaultContactMaterial:s={contactEquationStiffness:1e6},frictionGravity:o=null,gravity:r=[0,-9.81,0],iterations:g=5,quatNormalizeFast:u=!1,quatNormalizeSkip:C=0,size:h=1e3,solver:f="GS",tolerance:p=.001}=e;super(),this.config={allowSleep:t,axisIndex:n,broadphase:i,defaultContactMaterial:s,frictionGravity:o,gravity:r,iterations:g,quatNormalizeFast:u,quatNormalizeSkip:C,size:h,solver:f,tolerance:p},this.buffers={positions:new Float32Array(h*3),quaternions:new Float32Array(h*4)}}addBodies(e){let{props:t,type:n,uuid:i}=e;this.postMessage({op:"addBodies",props:t,type:n,uuid:i})}addConstraint(e){let{props:[t,n,i],type:s,uuid:o}=e;this.postMessage({op:"addConstraint",props:[t,n,i],type:s,uuid:o})}addContactMaterial(e){let{props:t,uuid:n}=e;this.postMessage({op:"addContactMaterial",props:t,uuid:n})}addRay(e){let{props:t,uuid:n}=e;this.postMessage({op:"addRay",props:t,uuid:n})}addRaycastVehicle(e){let{props:[t,n,i,s,o,r],uuid:g}=e;this.postMessage({op:"addRaycastVehicle",props:[t,n,i,s,o,r],uuid:g})}addSpring(e){let{props:[t,n,i],uuid:s}=e;this.postMessage({op:"addSpring",props:[t,n,i],uuid:s})}applyForce(e){let{props:t,uuid:n}=e;this.postMessage({op:"applyForce",props:t,uuid:n})}applyImpulse(e){let{props:t,uuid:n}=e;this.postMessage({op:"applyImpulse",props:t,uuid:n})}applyLocalForce(e){let{props:t,uuid:n}=e;this.postMessage({op:"applyLocalForce",props:t,uuid:n})}applyLocalImpulse(e){let{props:t,uuid:n}=e;this.postMessage({op:"applyLocalImpulse",props:t,uuid:n})}applyRaycastVehicleEngineForce(e){let{props:t,uuid:n}=e;this.postMessage({op:"applyRaycastVehicleEngineForce",props:t,uuid:n})}applyTorque(e){let{props:t,uuid:n}=e;this.postMessage({op:"applyTorque",props:t,uuid:n})}connect(){this.worker=new Q7,this.worker.onmessage=e=>{if(e.data.op==="frame"){this.buffers.positions=e.data.positions,this.buffers.quaternions=e.data.quaternions,this.emit(e.data.op,e.data);return}this.emit(e.data.type,e.data)};for(const e of this.messageQueue)this.worker.postMessage(e);this.messageQueue.length=0}disableConstraint(e){let{uuid:t}=e;this.postMessage({op:"disableConstraint",uuid:t})}disableConstraintMotor(e){let{uuid:t}=e;this.postMessage({op:"disableConstraintMotor",uuid:t})}disconnect(){this.worker&&(this.worker.onmessage=null)}enableConstraint(e){let{uuid:t}=e;this.postMessage({op:"enableConstraint",uuid:t})}enableConstraintMotor(e){let{uuid:t}=e;this.postMessage({op:"enableConstraintMotor",uuid:t})}init(){const{allowSleep:e,axisIndex:t,broadphase:n,defaultContactMaterial:i,frictionGravity:s,gravity:o,iterations:r,quatNormalizeFast:g,quatNormalizeSkip:u,solver:C,tolerance:h}=this.config;this.postMessage({op:"init",props:{allowSleep:e,axisIndex:t,broadphase:n,defaultContactMaterial:i,frictionGravity:s,gravity:o,iterations:r,quatNormalizeFast:g,quatNormalizeSkip:u,solver:C,tolerance:h}})}removeBodies(e){let{uuid:t}=e;this.postMessage({op:"removeBodies",uuid:t})}removeConstraint(e){let{uuid:t}=e;this.postMessage({op:"removeConstraint",uuid:t})}removeContactMaterial(e){let{uuid:t}=e;this.postMessage({op:"removeContactMaterial",uuid:t})}removeRay(e){let{uuid:t}=e;this.postMessage({op:"removeRay",uuid:t})}removeRaycastVehicle(e){let{uuid:t}=e;this.postMessage({op:"removeRaycastVehicle",uuid:t})}removeSpring(e){let{uuid:t}=e;this.postMessage({op:"removeSpring",uuid:t})}setAllowSleep(e){let{props:t,uuid:n}=e;this.postMessage({op:"setAllowSleep",props:t,uuid:n})}setAngularDamping(e){let{props:t,uuid:n}=e;this.postMessage({op:"setAngularDamping",props:t,uuid:n})}setAngularFactor(e){let{props:t,uuid:n}=e;this.postMessage({op:"setAngularFactor",props:t,uuid:n})}setAngularVelocity(e){let{props:t,uuid:n}=e;this.postMessage({op:"setAngularVelocity",props:t,uuid:n})}setCollisionFilterGroup(e){let{props:t,uuid:n}=e;this.postMessage({op:"setCollisionFilterGroup",props:t,uuid:n})}setCollisionFilterMask(e){let{props:t,uuid:n}=e;this.postMessage({op:"setCollisionFilterMask",props:t,uuid:n})}setCollisionResponse(e){let{props:t,uuid:n}=e;this.postMessage({op:"setCollisionResponse",props:t,uuid:n})}setConstraintMotorMaxForce(e){let{props:t,uuid:n}=e;this.postMessage({op:"setConstraintMotorMaxForce",props:t,uuid:n})}setConstraintMotorSpeed(e){let{props:t,uuid:n}=e;this.postMessage({op:"setConstraintMotorSpeed",props:t,uuid:n})}setFixedRotation(e){let{props:t,uuid:n}=e;this.postMessage({op:"setFixedRotation",props:t,uuid:n})}setIsTrigger(e){let{props:t,uuid:n}=e;this.postMessage({op:"setIsTrigger",props:t,uuid:n})}setLinearDamping(e){let{props:t,uuid:n}=e;this.postMessage({op:"setLinearDamping",props:t,uuid:n})}setLinearFactor(e){let{props:t,uuid:n}=e;this.postMessage({op:"setLinearFactor",props:t,uuid:n})}setMass(e){let{props:t,uuid:n}=e;this.postMessage({op:"setMass",props:t,uuid:n})}setMaterial(e){let{props:t,uuid:n}=e;this.postMessage({op:"setMaterial",props:t,uuid:n})}setPosition(e){let{props:t,uuid:n}=e;this.postMessage({op:"setPosition",props:t,uuid:n})}setQuaternion(e){let{props:[t,n,i,s],uuid:o}=e;this.postMessage({op:"setQuaternion",props:[t,n,i,s],uuid:o})}setRaycastVehicleBrake(e){let{props:t,uuid:n}=e;this.postMessage({op:"setRaycastVehicleBrake",props:t,uuid:n})}setRaycastVehicleSteeringValue(e){let{props:t,uuid:n}=e;this.postMessage({op:"setRaycastVehicleSteeringValue",props:t,uuid:n})}setRotation(e){let{props:t,uuid:n}=e;this.postMessage({op:"setRotation",props:t,uuid:n})}setSleepSpeedLimit(e){let{props:t,uuid:n}=e;this.postMessage({op:"setSleepSpeedLimit",props:t,uuid:n})}setSleepTimeLimit(e){let{props:t,uuid:n}=e;this.postMessage({op:"setSleepTimeLimit",props:t,uuid:n})}setSpringDamping(e){let{props:t,uuid:n}=e;this.postMessage({op:"setSpringDamping",props:t,uuid:n})}setSpringRestLength(e){let{props:t,uuid:n}=e;this.postMessage({op:"setSpringRestLength",props:t,uuid:n})}setSpringStiffness(e){let{props:t,uuid:n}=e;this.postMessage({op:"setSpringStiffness",props:t,uuid:n})}setUserData(e){let{props:t,uuid:n}=e;this.postMessage({op:"setUserData",props:t,uuid:n})}setVelocity(e){let{props:t,uuid:n}=e;this.postMessage({op:"setVelocity",props:t,uuid:n})}sleep(e){let{uuid:t}=e;this.postMessage({op:"sleep",uuid:t})}step(e){var t;const{buffers:{positions:n,quaternions:i}}=this;!n.byteLength&&!i.byteLength||(t=this.worker)==null||t.postMessage({op:"step",positions:n,props:e,quaternions:i},[n.buffer,i.buffer])}subscribe(e){let{props:{id:t,target:n,type:i},uuid:s}=e;this.postMessage({op:"subscribe",props:{id:t,target:n,type:i},uuid:s})}terminate(){var e;(e=this.worker)==null||e.terminate(),this.worker=null}unsubscribe(e){let{props:t}=e;this.postMessage({op:"unsubscribe",props:t})}wakeUp(e){let{uuid:t}=e;this.postMessage({op:"wakeUp",uuid:t})}postMessage(e){if(this.worker)return this.worker.postMessage(e);this.messageQueue.push(e)}}class rc{constructor(e){e===void 0&&(e=[0,0,0,0,0,0,0,0,0]),this.elements=e}identity(){const e=this.elements;e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=0,e[7]=0,e[8]=1}setZero(){const e=this.elements;e[0]=0,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=0,e[6]=0,e[7]=0,e[8]=0}setTrace(e){const t=this.elements;t[0]=e.x,t[4]=e.y,t[8]=e.z}getTrace(e){e===void 0&&(e=new ge);const t=this.elements;return e.x=t[0],e.y=t[4],e.z=t[8],e}vmult(e,t){t===void 0&&(t=new ge);const n=this.elements,i=e.x,s=e.y,o=e.z;return t.x=n[0]*i+n[1]*s+n[2]*o,t.y=n[3]*i+n[4]*s+n[5]*o,t.z=n[6]*i+n[7]*s+n[8]*o,t}smult(e){for(let t=0;t<this.elements.length;t++)this.elements[t]*=e}mmult(e,t){t===void 0&&(t=new rc);const n=this.elements,i=e.elements,s=t.elements,o=n[0],r=n[1],g=n[2],u=n[3],C=n[4],h=n[5],f=n[6],p=n[7],y=n[8],v=i[0],G=i[1],B=i[2],R=i[3],x=i[4],w=i[5],M=i[6],H=i[7],N=i[8];return s[0]=o*v+r*R+g*M,s[1]=o*G+r*x+g*H,s[2]=o*B+r*w+g*N,s[3]=u*v+C*R+h*M,s[4]=u*G+C*x+h*H,s[5]=u*B+C*w+h*N,s[6]=f*v+p*R+y*M,s[7]=f*G+p*x+y*H,s[8]=f*B+p*w+y*N,t}scale(e,t){t===void 0&&(t=new rc);const n=this.elements,i=t.elements;for(let s=0;s!==3;s++)i[3*s+0]=e.x*n[3*s+0],i[3*s+1]=e.y*n[3*s+1],i[3*s+2]=e.z*n[3*s+2];return t}solve(e,t){t===void 0&&(t=new ge);const n=3,i=4,s=[];let o,r;for(o=0;o<n*i;o++)s.push(0);for(o=0;o<3;o++)for(r=0;r<3;r++)s[o+i*r]=this.elements[o+3*r];s[3+4*0]=e.x,s[3+4*1]=e.y,s[3+4*2]=e.z;let g=3;const u=g;let C;const h=4;let f;do{if(o=u-g,s[o+i*o]===0){for(r=o+1;r<u;r++)if(s[o+i*r]!==0){C=h;do f=h-C,s[f+i*o]+=s[f+i*r];while(--C);break}}if(s[o+i*o]!==0)for(r=o+1;r<u;r++){const p=s[o+i*r]/s[o+i*o];C=h;do f=h-C,s[f+i*r]=f<=o?0:s[f+i*r]-s[f+i*o]*p;while(--C)}}while(--g);if(t.z=s[2*i+3]/s[2*i+2],t.y=(s[1*i+3]-s[1*i+2]*t.z)/s[1*i+1],t.x=(s[0*i+3]-s[0*i+2]*t.z-s[0*i+1]*t.y)/s[0*i+0],isNaN(t.x)||isNaN(t.y)||isNaN(t.z)||t.x===1/0||t.y===1/0||t.z===1/0)throw`Could not solve equation! Got x=[${t.toString()}], b=[${e.toString()}], A=[${this.toString()}]`;return t}e(e,t,n){if(n===void 0)return this.elements[t+3*e];this.elements[t+3*e]=n}copy(e){for(let t=0;t<e.elements.length;t++)this.elements[t]=e.elements[t];return this}toString(){let e="";const t=",";for(let n=0;n<9;n++)e+=this.elements[n]+t;return e}reverse(e){e===void 0&&(e=new rc);const t=3,n=6,i=q7;let s,o;for(s=0;s<3;s++)for(o=0;o<3;o++)i[s+n*o]=this.elements[s+3*o];i[3+6*0]=1,i[3+6*1]=0,i[3+6*2]=0,i[4+6*0]=0,i[4+6*1]=1,i[4+6*2]=0,i[5+6*0]=0,i[5+6*1]=0,i[5+6*2]=1;let r=3;const g=r;let u;const C=n;let h;do{if(s=g-r,i[s+n*s]===0){for(o=s+1;o<g;o++)if(i[s+n*o]!==0){u=C;do h=C-u,i[h+n*s]+=i[h+n*o];while(--u);break}}if(i[s+n*s]!==0)for(o=s+1;o<g;o++){const f=i[s+n*o]/i[s+n*s];u=C;do h=C-u,i[h+n*o]=h<=s?0:i[h+n*o]-i[h+n*s]*f;while(--u)}}while(--r);s=2;do{o=s-1;do{const f=i[s+n*o]/i[s+n*s];u=n;do h=n-u,i[h+n*o]=i[h+n*o]-i[h+n*s]*f;while(--u)}while(o--)}while(--s);s=2;do{const f=1/i[s+n*s];u=n;do h=n-u,i[h+n*s]=i[h+n*s]*f;while(--u)}while(s--);s=2;do{o=2;do{if(h=i[t+o+n*s],isNaN(h)||h===1/0)throw`Could not reverse! A=[${this.toString()}]`;e.e(s,o,h)}while(o--)}while(s--);return e}setRotationFromQuaternion(e){const t=e.x,n=e.y,i=e.z,s=e.w,o=t+t,r=n+n,g=i+i,u=t*o,C=t*r,h=t*g,f=n*r,p=n*g,y=i*g,v=s*o,G=s*r,B=s*g,R=this.elements;return R[3*0+0]=1-(f+y),R[3*0+1]=C-B,R[3*0+2]=h+G,R[3*1+0]=C+B,R[3*1+1]=1-(u+y),R[3*1+2]=p-v,R[3*2+0]=h-G,R[3*2+1]=p+v,R[3*2+2]=1-(u+f),this}transpose(e){e===void 0&&(e=new rc);const t=this.elements,n=e.elements;let i;return n[0]=t[0],n[4]=t[4],n[8]=t[8],i=t[1],n[1]=t[3],n[3]=i,i=t[2],n[2]=t[6],n[6]=i,i=t[5],n[5]=t[7],n[7]=i,e}}const q7=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];class ge{constructor(e,t,n){e===void 0&&(e=0),t===void 0&&(t=0),n===void 0&&(n=0),this.x=e,this.y=t,this.z=n}cross(e,t){t===void 0&&(t=new ge);const n=e.x,i=e.y,s=e.z,o=this.x,r=this.y,g=this.z;return t.x=r*s-g*i,t.y=g*n-o*s,t.z=o*i-r*n,t}set(e,t,n){return this.x=e,this.y=t,this.z=n,this}setZero(){this.x=this.y=this.z=0}vadd(e,t){if(t)t.x=e.x+this.x,t.y=e.y+this.y,t.z=e.z+this.z;else return new ge(this.x+e.x,this.y+e.y,this.z+e.z)}vsub(e,t){if(t)t.x=this.x-e.x,t.y=this.y-e.y,t.z=this.z-e.z;else return new ge(this.x-e.x,this.y-e.y,this.z-e.z)}crossmat(){return new rc([0,-this.z,this.y,this.z,0,-this.x,-this.y,this.x,0])}normalize(){const e=this.x,t=this.y,n=this.z,i=Math.sqrt(e*e+t*t+n*n);if(i>0){const s=1/i;this.x*=s,this.y*=s,this.z*=s}else this.x=0,this.y=0,this.z=0;return i}unit(e){e===void 0&&(e=new ge);const t=this.x,n=this.y,i=this.z;let s=Math.sqrt(t*t+n*n+i*i);return s>0?(s=1/s,e.x=t*s,e.y=n*s,e.z=i*s):(e.x=1,e.y=0,e.z=0),e}length(){const e=this.x,t=this.y,n=this.z;return Math.sqrt(e*e+t*t+n*n)}lengthSquared(){return this.dot(this)}distanceTo(e){const t=this.x,n=this.y,i=this.z,s=e.x,o=e.y,r=e.z;return Math.sqrt((s-t)*(s-t)+(o-n)*(o-n)+(r-i)*(r-i))}distanceSquared(e){const t=this.x,n=this.y,i=this.z,s=e.x,o=e.y,r=e.z;return(s-t)*(s-t)+(o-n)*(o-n)+(r-i)*(r-i)}scale(e,t){t===void 0&&(t=new ge);const n=this.x,i=this.y,s=this.z;return t.x=e*n,t.y=e*i,t.z=e*s,t}vmul(e,t){return t===void 0&&(t=new ge),t.x=e.x*this.x,t.y=e.y*this.y,t.z=e.z*this.z,t}addScaledVector(e,t,n){return n===void 0&&(n=new ge),n.x=this.x+e*t.x,n.y=this.y+e*t.y,n.z=this.z+e*t.z,n}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}isZero(){return this.x===0&&this.y===0&&this.z===0}negate(e){return e===void 0&&(e=new ge),e.x=-this.x,e.y=-this.y,e.z=-this.z,e}tangents(e,t){const n=this.length();if(n>0){const i=$7,s=1/n;i.set(this.x*s,this.y*s,this.z*s);const o=e8;Math.abs(i.x)<.9?(o.set(1,0,0),i.cross(o,e)):(o.set(0,1,0),i.cross(o,e)),i.cross(e,t)}else e.set(1,0,0),t.set(0,1,0)}toString(){return`${this.x},${this.y},${this.z}`}toArray(){return[this.x,this.y,this.z]}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}lerp(e,t,n){const i=this.x,s=this.y,o=this.z;n.x=i+(e.x-i)*t,n.y=s+(e.y-s)*t,n.z=o+(e.z-o)*t}almostEquals(e,t){return t===void 0&&(t=1e-6),!(Math.abs(this.x-e.x)>t||Math.abs(this.y-e.y)>t||Math.abs(this.z-e.z)>t)}almostZero(e){return e===void 0&&(e=1e-6),!(Math.abs(this.x)>e||Math.abs(this.y)>e||Math.abs(this.z)>e)}isAntiparallelTo(e,t){return this.negate(AW),AW.almostEquals(e,t)}clone(){return new ge(this.x,this.y,this.z)}}ge.ZERO=new ge(0,0,0);ge.UNIT_X=new ge(1,0,0);ge.UNIT_Y=new ge(0,1,0);ge.UNIT_Z=new ge(0,0,1);const $7=new ge,e8=new ge,AW=new ge;class xl{constructor(e){e===void 0&&(e={}),this.lowerBound=new ge,this.upperBound=new ge,e.lowerBound&&this.lowerBound.copy(e.lowerBound),e.upperBound&&this.upperBound.copy(e.upperBound)}setFromPoints(e,t,n,i){const s=this.lowerBound,o=this.upperBound,r=n;s.copy(e[0]),r&&r.vmult(s,s),o.copy(s);for(let g=1;g<e.length;g++){let u=e[g];r&&(r.vmult(u,hW),u=hW),u.x>o.x&&(o.x=u.x),u.x<s.x&&(s.x=u.x),u.y>o.y&&(o.y=u.y),u.y<s.y&&(s.y=u.y),u.z>o.z&&(o.z=u.z),u.z<s.z&&(s.z=u.z)}return t&&(t.vadd(s,s),t.vadd(o,o)),i&&(s.x-=i,s.y-=i,s.z-=i,o.x+=i,o.y+=i,o.z+=i),this}copy(e){return this.lowerBound.copy(e.lowerBound),this.upperBound.copy(e.upperBound),this}clone(){return new xl().copy(this)}extend(e){this.lowerBound.x=Math.min(this.lowerBound.x,e.lowerBound.x),this.upperBound.x=Math.max(this.upperBound.x,e.upperBound.x),this.lowerBound.y=Math.min(this.lowerBound.y,e.lowerBound.y),this.upperBound.y=Math.max(this.upperBound.y,e.upperBound.y),this.lowerBound.z=Math.min(this.lowerBound.z,e.lowerBound.z),this.upperBound.z=Math.max(this.upperBound.z,e.upperBound.z)}overlaps(e){const t=this.lowerBound,n=this.upperBound,i=e.lowerBound,s=e.upperBound,o=i.x<=n.x&&n.x<=s.x||t.x<=s.x&&s.x<=n.x,r=i.y<=n.y&&n.y<=s.y||t.y<=s.y&&s.y<=n.y,g=i.z<=n.z&&n.z<=s.z||t.z<=s.z&&s.z<=n.z;return o&&r&&g}volume(){const e=this.lowerBound,t=this.upperBound;return(t.x-e.x)*(t.y-e.y)*(t.z-e.z)}contains(e){const t=this.lowerBound,n=this.upperBound,i=e.lowerBound,s=e.upperBound;return t.x<=i.x&&n.x>=s.x&&t.y<=i.y&&n.y>=s.y&&t.z<=i.z&&n.z>=s.z}getCorners(e,t,n,i,s,o,r,g){const u=this.lowerBound,C=this.upperBound;e.copy(u),t.set(C.x,u.y,u.z),n.set(C.x,C.y,u.z),i.set(u.x,C.y,C.z),s.set(C.x,u.y,C.z),o.set(u.x,C.y,u.z),r.set(u.x,u.y,C.z),g.copy(C)}toLocalFrame(e,t){const n=fW,i=n[0],s=n[1],o=n[2],r=n[3],g=n[4],u=n[5],C=n[6],h=n[7];this.getCorners(i,s,o,r,g,u,C,h);for(let f=0;f!==8;f++){const p=n[f];e.pointToLocal(p,p)}return t.setFromPoints(n)}toWorldFrame(e,t){const n=fW,i=n[0],s=n[1],o=n[2],r=n[3],g=n[4],u=n[5],C=n[6],h=n[7];this.getCorners(i,s,o,r,g,u,C,h);for(let f=0;f!==8;f++){const p=n[f];e.pointToWorld(p,p)}return t.setFromPoints(n)}overlapsRay(e){const{direction:t,from:n}=e,i=1/t.x,s=1/t.y,o=1/t.z,r=(this.lowerBound.x-n.x)*i,g=(this.upperBound.x-n.x)*i,u=(this.lowerBound.y-n.y)*s,C=(this.upperBound.y-n.y)*s,h=(this.lowerBound.z-n.z)*o,f=(this.upperBound.z-n.z)*o,p=Math.max(Math.max(Math.min(r,g),Math.min(u,C)),Math.min(h,f)),y=Math.min(Math.min(Math.max(r,g),Math.max(u,C)),Math.max(h,f));return!(y<0||p>y)}}const hW=new ge,fW=[new ge,new ge,new ge,new ge,new ge,new ge,new ge,new ge];class Ps{constructor(e,t,n,i){e===void 0&&(e=0),t===void 0&&(t=0),n===void 0&&(n=0),i===void 0&&(i=1),this.x=e,this.y=t,this.z=n,this.w=i}set(e,t,n,i){return this.x=e,this.y=t,this.z=n,this.w=i,this}toString(){return`${this.x},${this.y},${this.z},${this.w}`}toArray(){return[this.x,this.y,this.z,this.w]}setFromAxisAngle(e,t){const n=Math.sin(t*.5);return this.x=e.x*n,this.y=e.y*n,this.z=e.z*n,this.w=Math.cos(t*.5),this}toAxisAngle(e){e===void 0&&(e=new ge),this.normalize();const t=2*Math.acos(this.w),n=Math.sqrt(1-this.w*this.w);return n<.001?(e.x=this.x,e.y=this.y,e.z=this.z):(e.x=this.x/n,e.y=this.y/n,e.z=this.z/n),[e,t]}setFromVectors(e,t){if(e.isAntiparallelTo(t)){const n=t8,i=n8;e.tangents(n,i),this.setFromAxisAngle(n,Math.PI)}else{const n=e.cross(t);this.x=n.x,this.y=n.y,this.z=n.z,this.w=Math.sqrt(e.length()**2*t.length()**2)+e.dot(t),this.normalize()}return this}mult(e,t){t===void 0&&(t=new Ps);const n=this.x,i=this.y,s=this.z,o=this.w,r=e.x,g=e.y,u=e.z,C=e.w;return t.x=n*C+o*r+i*u-s*g,t.y=i*C+o*g+s*r-n*u,t.z=s*C+o*u+n*g-i*r,t.w=o*C-n*r-i*g-s*u,t}inverse(e){e===void 0&&(e=new Ps);const t=this.x,n=this.y,i=this.z,s=this.w;this.conjugate(e);const o=1/(t*t+n*n+i*i+s*s);return e.x*=o,e.y*=o,e.z*=o,e.w*=o,e}conjugate(e){return e===void 0&&(e=new Ps),e.x=-this.x,e.y=-this.y,e.z=-this.z,e.w=this.w,e}normalize(){let e=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w);return e===0?(this.x=0,this.y=0,this.z=0,this.w=0):(e=1/e,this.x*=e,this.y*=e,this.z*=e,this.w*=e),this}normalizeFast(){const e=(3-(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w))/2;return e===0?(this.x=0,this.y=0,this.z=0,this.w=0):(this.x*=e,this.y*=e,this.z*=e,this.w*=e),this}vmult(e,t){t===void 0&&(t=new ge);const n=e.x,i=e.y,s=e.z,o=this.x,r=this.y,g=this.z,u=this.w,C=u*n+r*s-g*i,h=u*i+g*n-o*s,f=u*s+o*i-r*n,p=-o*n-r*i-g*s;return t.x=C*u+p*-o+h*-g-f*-r,t.y=h*u+p*-r+f*-o-C*-g,t.z=f*u+p*-g+C*-r-h*-o,t}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w,this}toEuler(e,t){t===void 0&&(t="YZX");let n,i,s;const o=this.x,r=this.y,g=this.z,u=this.w;switch(t){case"YZX":const C=o*r+g*u;if(C>.499&&(n=2*Math.atan2(o,u),i=Math.PI/2,s=0),C<-.499&&(n=-2*Math.atan2(o,u),i=-Math.PI/2,s=0),n===void 0){const h=o*o,f=r*r,p=g*g;n=Math.atan2(2*r*u-2*o*g,1-2*f-2*p),i=Math.asin(2*C),s=Math.atan2(2*o*u-2*r*g,1-2*h-2*p)}break;default:throw new Error(`Euler order ${t} not supported yet.`)}e.y=n,e.z=i,e.x=s}setFromEuler(e,t,n,i){i===void 0&&(i="XYZ");const s=Math.cos(e/2),o=Math.cos(t/2),r=Math.cos(n/2),g=Math.sin(e/2),u=Math.sin(t/2),C=Math.sin(n/2);return i==="XYZ"?(this.x=g*o*r+s*u*C,this.y=s*u*r-g*o*C,this.z=s*o*C+g*u*r,this.w=s*o*r-g*u*C):i==="YXZ"?(this.x=g*o*r+s*u*C,this.y=s*u*r-g*o*C,this.z=s*o*C-g*u*r,this.w=s*o*r+g*u*C):i==="ZXY"?(this.x=g*o*r-s*u*C,this.y=s*u*r+g*o*C,this.z=s*o*C+g*u*r,this.w=s*o*r-g*u*C):i==="ZYX"?(this.x=g*o*r-s*u*C,this.y=s*u*r+g*o*C,this.z=s*o*C-g*u*r,this.w=s*o*r+g*u*C):i==="YZX"?(this.x=g*o*r+s*u*C,this.y=s*u*r+g*o*C,this.z=s*o*C-g*u*r,this.w=s*o*r-g*u*C):i==="XZY"&&(this.x=g*o*r-s*u*C,this.y=s*u*r-g*o*C,this.z=s*o*C+g*u*r,this.w=s*o*r+g*u*C),this}clone(){return new Ps(this.x,this.y,this.z,this.w)}slerp(e,t,n){n===void 0&&(n=new Ps);const i=this.x,s=this.y,o=this.z,r=this.w;let g=e.x,u=e.y,C=e.z,h=e.w,f,p,y,v,G;return p=i*g+s*u+o*C+r*h,p<0&&(p=-p,g=-g,u=-u,C=-C,h=-h),1-p>1e-6?(f=Math.acos(p),y=Math.sin(f),v=Math.sin((1-t)*f)/y,G=Math.sin(t*f)/y):(v=1-t,G=t),n.x=v*i+G*g,n.y=v*s+G*u,n.z=v*o+G*C,n.w=v*r+G*h,n}integrate(e,t,n,i){i===void 0&&(i=new Ps);const s=e.x*n.x,o=e.y*n.y,r=e.z*n.z,g=this.x,u=this.y,C=this.z,h=this.w,f=t*.5;return i.x+=f*(s*h+o*C-r*u),i.y+=f*(o*h+r*g-s*C),i.z+=f*(r*h+s*u-o*g),i.w+=f*(-s*g-o*u-r*C),i}}const t8=new ge,n8=new ge,i8={SPHERE:1,PLANE:2,BOX:4,COMPOUND:8,CONVEXPOLYHEDRON:16,HEIGHTFIELD:32,PARTICLE:64,CYLINDER:128,TRIMESH:256};class Ft{constructor(e){e===void 0&&(e={}),this.id=Ft.idCounter++,this.type=e.type||0,this.boundingSphereRadius=0,this.collisionResponse=e.collisionResponse?e.collisionResponse:!0,this.collisionFilterGroup=e.collisionFilterGroup!==void 0?e.collisionFilterGroup:1,this.collisionFilterMask=e.collisionFilterMask!==void 0?e.collisionFilterMask:-1,this.material=e.material?e.material:null,this.body=null}updateBoundingSphereRadius(){throw`computeBoundingSphereRadius() not implemented for shape type ${this.type}`}volume(){throw`volume() not implemented for shape type ${this.type}`}calculateLocalInertia(e,t){throw`calculateLocalInertia() not implemented for shape type ${this.type}`}calculateWorldAABB(e,t,n,i){throw`calculateWorldAABB() not implemented for shape type ${this.type}`}}Ft.idCounter=0;Ft.types=i8;class Zo{constructor(e){e===void 0&&(e={}),this.position=new ge,this.quaternion=new Ps,e.position&&this.position.copy(e.position),e.quaternion&&this.quaternion.copy(e.quaternion)}pointToLocal(e,t){return Zo.pointToLocalFrame(this.position,this.quaternion,e,t)}pointToWorld(e,t){return Zo.pointToWorldFrame(this.position,this.quaternion,e,t)}vectorToWorldFrame(e,t){return t===void 0&&(t=new ge),this.quaternion.vmult(e,t),t}static pointToLocalFrame(e,t,n,i){return i===void 0&&(i=new ge),n.vsub(e,i),t.conjugate(pW),pW.vmult(i,i),i}static pointToWorldFrame(e,t,n,i){return i===void 0&&(i=new ge),t.vmult(n,i),i.vadd(e,i),i}static vectorToWorldFrame(e,t,n){return n===void 0&&(n=new ge),e.vmult(t,n),n}static vectorToLocalFrame(e,t,n,i){return i===void 0&&(i=new ge),t.w*=-1,t.vmult(n,i),t.w*=-1,i}}const pW=new Ps;new ge;new ge;new ge;new ge;new ge,new ge,new ge,new ge,new ge,new ge,new ge,new ge;new ge;new Ps;new xl;new rc;new rc;new rc;new ge;new ge;new ge;new ge;new ge;new ge;new ge;new ge;new ge;new ge;new Ps;new ge;new ge;new ge;new ge;class Y2{constructor(){this.rayFromWorld=new ge,this.rayToWorld=new ge,this.hitNormalWorld=new ge,this.hitPointWorld=new ge,this.hasHit=!1,this.shape=null,this.body=null,this.hitFaceIndex=-1,this.distance=-1,this.shouldStop=!1}reset(){this.rayFromWorld.setZero(),this.rayToWorld.setZero(),this.hitNormalWorld.setZero(),this.hitPointWorld.setZero(),this.hasHit=!1,this.shape=null,this.body=null,this.hitFaceIndex=-1,this.distance=-1,this.shouldStop=!1}abort(){this.shouldStop=!0}set(e,t,n,i,s,o,r){this.rayFromWorld.copy(e),this.rayToWorld.copy(t),this.hitNormalWorld.copy(n),this.hitPointWorld.copy(i),this.shape=s,this.body=o,this.distance=r}}let dN,AN,hN,fN,pN,mN,bN;const iS={CLOSEST:1,ANY:2,ALL:4};dN=Ft.types.SPHERE;AN=Ft.types.PLANE;hN=Ft.types.BOX;fN=Ft.types.CYLINDER;pN=Ft.types.CONVEXPOLYHEDRON;mN=Ft.types.HEIGHTFIELD;bN=Ft.types.TRIMESH;class ms{get[dN](){return this._intersectSphere}get[AN](){return this._intersectPlane}get[hN](){return this._intersectBox}get[fN](){return this._intersectConvex}get[pN](){return this._intersectConvex}get[mN](){return this._intersectHeightfield}get[bN](){return this._intersectTrimesh}constructor(e,t){e===void 0&&(e=new ge),t===void 0&&(t=new ge),this.from=e.clone(),this.to=t.clone(),this.direction=new ge,this.precision=1e-4,this.checkCollisionResponse=!0,this.skipBackfaces=!1,this.collisionFilterMask=-1,this.collisionFilterGroup=-1,this.mode=ms.ANY,this.result=new Y2,this.hasHit=!1,this.callback=n=>{}}intersectWorld(e,t){return this.mode=t.mode||ms.ANY,this.result=t.result||new Y2,this.skipBackfaces=!!t.skipBackfaces,this.collisionFilterMask=typeof t.collisionFilterMask<"u"?t.collisionFilterMask:-1,this.collisionFilterGroup=typeof t.collisionFilterGroup<"u"?t.collisionFilterGroup:-1,this.checkCollisionResponse=typeof t.checkCollisionResponse<"u"?t.checkCollisionResponse:!0,t.from&&this.from.copy(t.from),t.to&&this.to.copy(t.to),this.callback=t.callback||(()=>{}),this.hasHit=!1,this.result.reset(),this.updateDirection(),this.getAABB(mW),Wv.length=0,e.broadphase.aabbQuery(e,mW,Wv),this.intersectBodies(Wv),this.hasHit}intersectBody(e,t){t&&(this.result=t,this.updateDirection());const n=this.checkCollisionResponse;if(n&&!e.collisionResponse||(this.collisionFilterGroup&e.collisionFilterMask)===0||(e.collisionFilterGroup&this.collisionFilterMask)===0)return;const i=a8,s=s8;for(let o=0,r=e.shapes.length;o<r;o++){const g=e.shapes[o];if(!(n&&!g.collisionResponse)&&(e.quaternion.mult(e.shapeOrientations[o],s),e.quaternion.vmult(e.shapeOffsets[o],i),i.vadd(e.position,i),this.intersectShape(g,s,i,e),this.result.shouldStop))break}}intersectBodies(e,t){t&&(this.result=t,this.updateDirection());for(let n=0,i=e.length;!this.result.shouldStop&&n<i;n++)this.intersectBody(e[n])}updateDirection(){this.to.vsub(this.from,this.direction),this.direction.normalize()}intersectShape(e,t,n,i){const s=this.from;if(m8(s,this.direction,n)>e.boundingSphereRadius)return;const r=this[e.type];r&&r.call(this,e,t,n,i,e)}_intersectBox(e,t,n,i,s){return this._intersectConvex(e.convexPolyhedronRepresentation,t,n,i,s)}_intersectPlane(e,t,n,i,s){const o=this.from,r=this.to,g=this.direction,u=new ge(0,0,1);t.vmult(u,u);const C=new ge;o.vsub(n,C);const h=C.dot(u);r.vsub(n,C);const f=C.dot(u);if(h*f>0||o.distanceTo(r)<h)return;const p=u.dot(g);if(Math.abs(p)<this.precision)return;const y=new ge,v=new ge,G=new ge;o.vsub(n,y);const B=-u.dot(y)/p;g.scale(B,v),o.vadd(v,G),this.reportIntersection(u,G,s,i,-1)}getAABB(e){const{lowerBound:t,upperBound:n}=e,i=this.to,s=this.from;t.x=Math.min(i.x,s.x),t.y=Math.min(i.y,s.y),t.z=Math.min(i.z,s.z),n.x=Math.max(i.x,s.x),n.y=Math.max(i.y,s.y),n.z=Math.max(i.z,s.z)}_intersectHeightfield(e,t,n,i,s){e.data,e.elementSize;const o=o8;o.from.copy(this.from),o.to.copy(this.to),Zo.pointToLocalFrame(n,t,o.from,o.from),Zo.pointToLocalFrame(n,t,o.to,o.to),o.updateDirection();const r=l8;let g,u,C,h;g=u=0,C=h=e.data.length-1;const f=new xl;o.getAABB(f),e.getIndexOfPosition(f.lowerBound.x,f.lowerBound.y,r,!0),g=Math.max(g,r[0]),u=Math.max(u,r[1]),e.getIndexOfPosition(f.upperBound.x,f.upperBound.y,r,!0),C=Math.min(C,r[0]+1),h=Math.min(h,r[1]+1);for(let p=g;p<C;p++)for(let y=u;y<h;y++){if(this.result.shouldStop)return;if(e.getAabbAtIndex(p,y,f),!!f.overlapsRay(o)){if(e.getConvexTrianglePillar(p,y,!1),Zo.pointToWorldFrame(n,t,e.pillarOffset,Xb),this._intersectConvex(e.pillarConvex,t,Xb,i,s,bW),this.result.shouldStop)return;e.getConvexTrianglePillar(p,y,!0),Zo.pointToWorldFrame(n,t,e.pillarOffset,Xb),this._intersectConvex(e.pillarConvex,t,Xb,i,s,bW)}}}_intersectSphere(e,t,n,i,s){const o=this.from,r=this.to,g=e.radius,u=(r.x-o.x)**2+(r.y-o.y)**2+(r.z-o.z)**2,C=2*((r.x-o.x)*(o.x-n.x)+(r.y-o.y)*(o.y-n.y)+(r.z-o.z)*(o.z-n.z)),h=(o.x-n.x)**2+(o.y-n.y)**2+(o.z-n.z)**2-g**2,f=C**2-4*u*h,p=r8,y=g8;if(!(f<0))if(f===0)o.lerp(r,f,p),p.vsub(n,y),y.normalize(),this.reportIntersection(y,p,s,i,-1);else{const v=(-C-Math.sqrt(f))/(2*u),G=(-C+Math.sqrt(f))/(2*u);if(v>=0&&v<=1&&(o.lerp(r,v,p),p.vsub(n,y),y.normalize(),this.reportIntersection(y,p,s,i,-1)),this.result.shouldStop)return;G>=0&&G<=1&&(o.lerp(r,G,p),p.vsub(n,y),y.normalize(),this.reportIntersection(y,p,s,i,-1))}}_intersectConvex(e,t,n,i,s,o){const r=c8,g=yW,u=o&&o.faceList||null,C=e.faces,h=e.vertices,f=e.faceNormals,p=this.direction,y=this.from,v=this.to,G=y.distanceTo(v),B=u?u.length:C.length,R=this.result;for(let x=0;!R.shouldStop&&x<B;x++){const w=u?u[x]:x,M=C[w],H=f[w],N=t,F=n;g.copy(h[M[0]]),N.vmult(g,g),g.vadd(F,g),g.vsub(y,g),N.vmult(H,r);const Y=p.dot(r);if(Math.abs(Y)<this.precision)continue;const X=r.dot(g)/Y;if(!(X<0)){p.scale(X,yo),yo.vadd(y,yo),Ir.copy(h[M[0]]),N.vmult(Ir,Ir),F.vadd(Ir,Ir);for(let U=1;!R.shouldStop&&U<M.length-1;U++){cg.copy(h[M[U]]),ug.copy(h[M[U+1]]),N.vmult(cg,cg),N.vmult(ug,ug),F.vadd(cg,cg),F.vadd(ug,ug);const O=yo.distanceTo(y);!(ms.pointInTriangle(yo,Ir,cg,ug)||ms.pointInTriangle(yo,cg,Ir,ug))||O>G||this.reportIntersection(r,yo,s,i,w)}}}}_intersectTrimesh(e,t,n,i,s,o){const r=u8,g=f8,u=p8,C=yW,h=I8,f=C8,p=d8,y=h8,v=A8,G=e.indices;e.vertices;const B=this.from,R=this.to,x=this.direction;u.position.copy(n),u.quaternion.copy(t),Zo.vectorToLocalFrame(n,t,x,h),Zo.pointToLocalFrame(n,t,B,f),Zo.pointToLocalFrame(n,t,R,p),p.x*=e.scale.x,p.y*=e.scale.y,p.z*=e.scale.z,f.x*=e.scale.x,f.y*=e.scale.y,f.z*=e.scale.z,p.vsub(f,h),h.normalize();const w=f.distanceSquared(p);e.tree.rayQuery(this,u,g);for(let M=0,H=g.length;!this.result.shouldStop&&M!==H;M++){const N=g[M];e.getNormal(N,r),e.getVertex(G[N*3],Ir),Ir.vsub(f,C);const F=h.dot(r),Y=r.dot(C)/F;if(Y<0)continue;h.scale(Y,yo),yo.vadd(f,yo),e.getVertex(G[N*3+1],cg),e.getVertex(G[N*3+2],ug);const X=yo.distanceSquared(f);!(ms.pointInTriangle(yo,cg,Ir,ug)||ms.pointInTriangle(yo,Ir,cg,ug))||X>w||(Zo.vectorToWorldFrame(t,r,v),Zo.pointToWorldFrame(n,t,yo,y),this.reportIntersection(v,y,s,i,N))}g.length=0}reportIntersection(e,t,n,i,s){const o=this.from,r=this.to,g=o.distanceTo(t),u=this.result;if(!(this.skipBackfaces&&e.dot(this.direction)>0))switch(u.hitFaceIndex=typeof s<"u"?s:-1,this.mode){case ms.ALL:this.hasHit=!0,u.set(o,r,e,t,n,i,g),u.hasHit=!0,this.callback(u);break;case ms.CLOSEST:(g<u.distance||!u.hasHit)&&(this.hasHit=!0,u.hasHit=!0,u.set(o,r,e,t,n,i,g));break;case ms.ANY:this.hasHit=!0,u.hasHit=!0,u.set(o,r,e,t,n,i,g),u.shouldStop=!0;break}}static pointInTriangle(e,t,n,i){i.vsub(t,LI),n.vsub(t,qh),e.vsub(t,Vv);const s=LI.dot(LI),o=LI.dot(qh),r=LI.dot(Vv),g=qh.dot(qh),u=qh.dot(Vv);let C,h;return(C=g*r-o*u)>=0&&(h=s*u-o*r)>=0&&C+h<s*g-o*o}}ms.CLOSEST=iS.CLOSEST;ms.ANY=iS.ANY;ms.ALL=iS.ALL;const mW=new xl,Wv=[],qh=new ge,Vv=new ge,a8=new ge,s8=new Ps,yo=new ge,Ir=new ge,cg=new ge,ug=new ge;new ge;new Y2;const bW={faceList:[0]},Xb=new ge,o8=new ms,l8=[],r8=new ge,g8=new ge,c8=new ge;new ge;new ge;const yW=new ge,u8=new ge,I8=new ge,C8=new ge,d8=new ge,A8=new ge,h8=new ge;new xl;const f8=[],p8=new Zo,LI=new ge,Nb=new ge;function m8(a,e,t){t.vsub(a,LI);const n=LI.dot(e);return e.scale(n,Nb),Nb.vadd(a,Nb),t.distanceTo(Nb)}new ge;new ge;new ge;new ge;new ge;new ge;new ge;new ge;new ge;new ge;new ge;new ge;new ge;new ge;new ge;new ge;new ge;new ge;new ge;new ge;new ge;new ge;new ge;new ge;new ge;new ge;new ge;new ge;new ge;new ge;new ge;new ge;new ge;new ge;new ge;new ge;new ge;new ge;new ge;new ge;new ge;new ge;new ge;new ge;new ge;new ms;new ge;new ge;new ge;new ge(1,0,0),new ge(0,1,0),new ge(0,0,1);new ge;new ge;new ge;new ge;new ge;new ge;new ge;new ge;new ge;new ge;new ge;new ge;new ge;new ge;new ge;new ge;new ge;new ge;new ge;new ge;new ge;new ge;new ge;new ge;new ge;new ge;new ge;new ge;new ge;new ge;new ge;new xl;new ge;new xl;new ge;new ge;new ge;new ge;new ge;new ge;new ge;new xl;new ge;new Zo;new xl;Ft.types.SPHERE,Ft.types.SPHERE|Ft.types.PLANE,Ft.types.BOX|Ft.types.BOX,Ft.types.SPHERE|Ft.types.BOX,Ft.types.PLANE|Ft.types.BOX,Ft.types.CONVEXPOLYHEDRON,Ft.types.SPHERE|Ft.types.CONVEXPOLYHEDRON,Ft.types.PLANE|Ft.types.CONVEXPOLYHEDRON,Ft.types.BOX|Ft.types.CONVEXPOLYHEDRON,Ft.types.SPHERE|Ft.types.HEIGHTFIELD,Ft.types.BOX|Ft.types.HEIGHTFIELD,Ft.types.CONVEXPOLYHEDRON|Ft.types.HEIGHTFIELD,Ft.types.PARTICLE|Ft.types.SPHERE,Ft.types.PLANE|Ft.types.PARTICLE,Ft.types.BOX|Ft.types.PARTICLE,Ft.types.PARTICLE|Ft.types.CONVEXPOLYHEDRON,Ft.types.CYLINDER,Ft.types.SPHERE|Ft.types.CYLINDER,Ft.types.PLANE|Ft.types.CYLINDER,Ft.types.BOX|Ft.types.CYLINDER,Ft.types.CONVEXPOLYHEDRON|Ft.types.CYLINDER,Ft.types.HEIGHTFIELD|Ft.types.CYLINDER,Ft.types.PARTICLE|Ft.types.CYLINDER,Ft.types.SPHERE|Ft.types.TRIMESH,Ft.types.PLANE|Ft.types.TRIMESH;new ge;new ge;new ge;new ge;new ge;new Ps;new Ps;new ge;new ge;new ge;new ge;new ge;new ge;new ge;new ge;new ge;new ge;new ge;new ge;new ge;new ge;new ge;new ge;new ge;new xl;new ge;new ge;new ge;new ge;new ge;new ge;new ge;new ge;new ge;new ge,new ge,new ge,new ge,new ge,new ge;new ge;new ge;new ge;new ge;new ge;new ge;new ge;new ge;new ge;new ge;new ge;new ge;new ge;new ge;new ge;new ge;new ge;new ge;new ge;new ge;new ge;new ge;new ge;new ge;new ge;new ge;new Ps;new ge;new ge;new ge;new ge;new ge;new ge;new ge;new ge;new ge;new xl;new ms;const $h=globalThis.performance||{};if(!$h.now){let a=Date.now();$h.timing&&$h.timing.navigationStart&&(a=$h.timing.navigationStart),$h.now=()=>Date.now()-a}new ge;class gc{constructor(e){e===void 0&&(e=[0,0,0,0,0,0,0,0,0]),this.elements=e}identity(){const e=this.elements;e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=0,e[7]=0,e[8]=1}setZero(){const e=this.elements;e[0]=0,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=0,e[6]=0,e[7]=0,e[8]=0}setTrace(e){const t=this.elements;t[0]=e.x,t[4]=e.y,t[8]=e.z}getTrace(e){e===void 0&&(e=new ce);const t=this.elements;return e.x=t[0],e.y=t[4],e.z=t[8],e}vmult(e,t){t===void 0&&(t=new ce);const n=this.elements,i=e.x,s=e.y,o=e.z;return t.x=n[0]*i+n[1]*s+n[2]*o,t.y=n[3]*i+n[4]*s+n[5]*o,t.z=n[6]*i+n[7]*s+n[8]*o,t}smult(e){for(let t=0;t<this.elements.length;t++)this.elements[t]*=e}mmult(e,t){t===void 0&&(t=new gc);const n=this.elements,i=e.elements,s=t.elements,o=n[0],r=n[1],g=n[2],u=n[3],C=n[4],h=n[5],f=n[6],p=n[7],y=n[8],v=i[0],G=i[1],B=i[2],R=i[3],x=i[4],w=i[5],M=i[6],H=i[7],N=i[8];return s[0]=o*v+r*R+g*M,s[1]=o*G+r*x+g*H,s[2]=o*B+r*w+g*N,s[3]=u*v+C*R+h*M,s[4]=u*G+C*x+h*H,s[5]=u*B+C*w+h*N,s[6]=f*v+p*R+y*M,s[7]=f*G+p*x+y*H,s[8]=f*B+p*w+y*N,t}scale(e,t){t===void 0&&(t=new gc);const n=this.elements,i=t.elements;for(let s=0;s!==3;s++)i[3*s+0]=e.x*n[3*s+0],i[3*s+1]=e.y*n[3*s+1],i[3*s+2]=e.z*n[3*s+2];return t}solve(e,t){t===void 0&&(t=new ce);const n=3,i=4,s=[];let o,r;for(o=0;o<n*i;o++)s.push(0);for(o=0;o<3;o++)for(r=0;r<3;r++)s[o+i*r]=this.elements[o+3*r];s[3+4*0]=e.x,s[3+4*1]=e.y,s[3+4*2]=e.z;let g=3;const u=g;let C;const h=4;let f;do{if(o=u-g,s[o+i*o]===0){for(r=o+1;r<u;r++)if(s[o+i*r]!==0){C=h;do f=h-C,s[f+i*o]+=s[f+i*r];while(--C);break}}if(s[o+i*o]!==0)for(r=o+1;r<u;r++){const p=s[o+i*r]/s[o+i*o];C=h;do f=h-C,s[f+i*r]=f<=o?0:s[f+i*r]-s[f+i*o]*p;while(--C)}}while(--g);if(t.z=s[2*i+3]/s[2*i+2],t.y=(s[1*i+3]-s[1*i+2]*t.z)/s[1*i+1],t.x=(s[0*i+3]-s[0*i+2]*t.z-s[0*i+1]*t.y)/s[0*i+0],isNaN(t.x)||isNaN(t.y)||isNaN(t.z)||t.x===1/0||t.y===1/0||t.z===1/0)throw`Could not solve equation! Got x=[${t.toString()}], b=[${e.toString()}], A=[${this.toString()}]`;return t}e(e,t,n){if(n===void 0)return this.elements[t+3*e];this.elements[t+3*e]=n}copy(e){for(let t=0;t<e.elements.length;t++)this.elements[t]=e.elements[t];return this}toString(){let e="";const t=",";for(let n=0;n<9;n++)e+=this.elements[n]+t;return e}reverse(e){e===void 0&&(e=new gc);const t=3,n=6,i=b8;let s,o;for(s=0;s<3;s++)for(o=0;o<3;o++)i[s+n*o]=this.elements[s+3*o];i[3+6*0]=1,i[3+6*1]=0,i[3+6*2]=0,i[4+6*0]=0,i[4+6*1]=1,i[4+6*2]=0,i[5+6*0]=0,i[5+6*1]=0,i[5+6*2]=1;let r=3;const g=r;let u;const C=n;let h;do{if(s=g-r,i[s+n*s]===0){for(o=s+1;o<g;o++)if(i[s+n*o]!==0){u=C;do h=C-u,i[h+n*s]+=i[h+n*o];while(--u);break}}if(i[s+n*s]!==0)for(o=s+1;o<g;o++){const f=i[s+n*o]/i[s+n*s];u=C;do h=C-u,i[h+n*o]=h<=s?0:i[h+n*o]-i[h+n*s]*f;while(--u)}}while(--r);s=2;do{o=s-1;do{const f=i[s+n*o]/i[s+n*s];u=n;do h=n-u,i[h+n*o]=i[h+n*o]-i[h+n*s]*f;while(--u)}while(o--)}while(--s);s=2;do{const f=1/i[s+n*s];u=n;do h=n-u,i[h+n*s]=i[h+n*s]*f;while(--u)}while(s--);s=2;do{o=2;do{if(h=i[t+o+n*s],isNaN(h)||h===1/0)throw`Could not reverse! A=[${this.toString()}]`;e.e(s,o,h)}while(o--)}while(s--);return e}setRotationFromQuaternion(e){const t=e.x,n=e.y,i=e.z,s=e.w,o=t+t,r=n+n,g=i+i,u=t*o,C=t*r,h=t*g,f=n*r,p=n*g,y=i*g,v=s*o,G=s*r,B=s*g,R=this.elements;return R[3*0+0]=1-(f+y),R[3*0+1]=C-B,R[3*0+2]=h+G,R[3*1+0]=C+B,R[3*1+1]=1-(u+y),R[3*1+2]=p-v,R[3*2+0]=h-G,R[3*2+1]=p+v,R[3*2+2]=1-(u+f),this}transpose(e){e===void 0&&(e=new gc);const t=this.elements,n=e.elements;let i;return n[0]=t[0],n[4]=t[4],n[8]=t[8],i=t[1],n[1]=t[3],n[3]=i,i=t[2],n[2]=t[6],n[6]=i,i=t[5],n[5]=t[7],n[7]=i,e}}const b8=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];class ce{constructor(e,t,n){e===void 0&&(e=0),t===void 0&&(t=0),n===void 0&&(n=0),this.x=e,this.y=t,this.z=n}cross(e,t){t===void 0&&(t=new ce);const n=e.x,i=e.y,s=e.z,o=this.x,r=this.y,g=this.z;return t.x=r*s-g*i,t.y=g*n-o*s,t.z=o*i-r*n,t}set(e,t,n){return this.x=e,this.y=t,this.z=n,this}setZero(){this.x=this.y=this.z=0}vadd(e,t){if(t)t.x=e.x+this.x,t.y=e.y+this.y,t.z=e.z+this.z;else return new ce(this.x+e.x,this.y+e.y,this.z+e.z)}vsub(e,t){if(t)t.x=this.x-e.x,t.y=this.y-e.y,t.z=this.z-e.z;else return new ce(this.x-e.x,this.y-e.y,this.z-e.z)}crossmat(){return new gc([0,-this.z,this.y,this.z,0,-this.x,-this.y,this.x,0])}normalize(){const e=this.x,t=this.y,n=this.z,i=Math.sqrt(e*e+t*t+n*n);if(i>0){const s=1/i;this.x*=s,this.y*=s,this.z*=s}else this.x=0,this.y=0,this.z=0;return i}unit(e){e===void 0&&(e=new ce);const t=this.x,n=this.y,i=this.z;let s=Math.sqrt(t*t+n*n+i*i);return s>0?(s=1/s,e.x=t*s,e.y=n*s,e.z=i*s):(e.x=1,e.y=0,e.z=0),e}length(){const e=this.x,t=this.y,n=this.z;return Math.sqrt(e*e+t*t+n*n)}lengthSquared(){return this.dot(this)}distanceTo(e){const t=this.x,n=this.y,i=this.z,s=e.x,o=e.y,r=e.z;return Math.sqrt((s-t)*(s-t)+(o-n)*(o-n)+(r-i)*(r-i))}distanceSquared(e){const t=this.x,n=this.y,i=this.z,s=e.x,o=e.y,r=e.z;return(s-t)*(s-t)+(o-n)*(o-n)+(r-i)*(r-i)}scale(e,t){t===void 0&&(t=new ce);const n=this.x,i=this.y,s=this.z;return t.x=e*n,t.y=e*i,t.z=e*s,t}vmul(e,t){return t===void 0&&(t=new ce),t.x=e.x*this.x,t.y=e.y*this.y,t.z=e.z*this.z,t}addScaledVector(e,t,n){return n===void 0&&(n=new ce),n.x=this.x+e*t.x,n.y=this.y+e*t.y,n.z=this.z+e*t.z,n}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}isZero(){return this.x===0&&this.y===0&&this.z===0}negate(e){return e===void 0&&(e=new ce),e.x=-this.x,e.y=-this.y,e.z=-this.z,e}tangents(e,t){const n=this.length();if(n>0){const i=y8,s=1/n;i.set(this.x*s,this.y*s,this.z*s);const o=G8;Math.abs(i.x)<.9?(o.set(1,0,0),i.cross(o,e)):(o.set(0,1,0),i.cross(o,e)),i.cross(e,t)}else e.set(1,0,0),t.set(0,1,0)}toString(){return`${this.x},${this.y},${this.z}`}toArray(){return[this.x,this.y,this.z]}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}lerp(e,t,n){const i=this.x,s=this.y,o=this.z;n.x=i+(e.x-i)*t,n.y=s+(e.y-s)*t,n.z=o+(e.z-o)*t}almostEquals(e,t){return t===void 0&&(t=1e-6),!(Math.abs(this.x-e.x)>t||Math.abs(this.y-e.y)>t||Math.abs(this.z-e.z)>t)}almostZero(e){return e===void 0&&(e=1e-6),!(Math.abs(this.x)>e||Math.abs(this.y)>e||Math.abs(this.z)>e)}isAntiparallelTo(e,t){return this.negate(GW),GW.almostEquals(e,t)}clone(){return new ce(this.x,this.y,this.z)}}ce.ZERO=new ce(0,0,0);ce.UNIT_X=new ce(1,0,0);ce.UNIT_Y=new ce(0,1,0);ce.UNIT_Z=new ce(0,0,1);const y8=new ce,G8=new ce,GW=new ce;class Wl{constructor(e){e===void 0&&(e={}),this.lowerBound=new ce,this.upperBound=new ce,e.lowerBound&&this.lowerBound.copy(e.lowerBound),e.upperBound&&this.upperBound.copy(e.upperBound)}setFromPoints(e,t,n,i){const s=this.lowerBound,o=this.upperBound,r=n;s.copy(e[0]),r&&r.vmult(s,s),o.copy(s);for(let g=1;g<e.length;g++){let u=e[g];r&&(r.vmult(u,BW),u=BW),u.x>o.x&&(o.x=u.x),u.x<s.x&&(s.x=u.x),u.y>o.y&&(o.y=u.y),u.y<s.y&&(s.y=u.y),u.z>o.z&&(o.z=u.z),u.z<s.z&&(s.z=u.z)}return t&&(t.vadd(s,s),t.vadd(o,o)),i&&(s.x-=i,s.y-=i,s.z-=i,o.x+=i,o.y+=i,o.z+=i),this}copy(e){return this.lowerBound.copy(e.lowerBound),this.upperBound.copy(e.upperBound),this}clone(){return new Wl().copy(this)}extend(e){this.lowerBound.x=Math.min(this.lowerBound.x,e.lowerBound.x),this.upperBound.x=Math.max(this.upperBound.x,e.upperBound.x),this.lowerBound.y=Math.min(this.lowerBound.y,e.lowerBound.y),this.upperBound.y=Math.max(this.upperBound.y,e.upperBound.y),this.lowerBound.z=Math.min(this.lowerBound.z,e.lowerBound.z),this.upperBound.z=Math.max(this.upperBound.z,e.upperBound.z)}overlaps(e){const t=this.lowerBound,n=this.upperBound,i=e.lowerBound,s=e.upperBound,o=i.x<=n.x&&n.x<=s.x||t.x<=s.x&&s.x<=n.x,r=i.y<=n.y&&n.y<=s.y||t.y<=s.y&&s.y<=n.y,g=i.z<=n.z&&n.z<=s.z||t.z<=s.z&&s.z<=n.z;return o&&r&&g}volume(){const e=this.lowerBound,t=this.upperBound;return(t.x-e.x)*(t.y-e.y)*(t.z-e.z)}contains(e){const t=this.lowerBound,n=this.upperBound,i=e.lowerBound,s=e.upperBound;return t.x<=i.x&&n.x>=s.x&&t.y<=i.y&&n.y>=s.y&&t.z<=i.z&&n.z>=s.z}getCorners(e,t,n,i,s,o,r,g){const u=this.lowerBound,C=this.upperBound;e.copy(u),t.set(C.x,u.y,u.z),n.set(C.x,C.y,u.z),i.set(u.x,C.y,C.z),s.set(C.x,u.y,C.z),o.set(u.x,C.y,u.z),r.set(u.x,u.y,C.z),g.copy(C)}toLocalFrame(e,t){const n=vW,i=n[0],s=n[1],o=n[2],r=n[3],g=n[4],u=n[5],C=n[6],h=n[7];this.getCorners(i,s,o,r,g,u,C,h);for(let f=0;f!==8;f++){const p=n[f];e.pointToLocal(p,p)}return t.setFromPoints(n)}toWorldFrame(e,t){const n=vW,i=n[0],s=n[1],o=n[2],r=n[3],g=n[4],u=n[5],C=n[6],h=n[7];this.getCorners(i,s,o,r,g,u,C,h);for(let f=0;f!==8;f++){const p=n[f];e.pointToWorld(p,p)}return t.setFromPoints(n)}overlapsRay(e){const{direction:t,from:n}=e,i=1/t.x,s=1/t.y,o=1/t.z,r=(this.lowerBound.x-n.x)*i,g=(this.upperBound.x-n.x)*i,u=(this.lowerBound.y-n.y)*s,C=(this.upperBound.y-n.y)*s,h=(this.lowerBound.z-n.z)*o,f=(this.upperBound.z-n.z)*o,p=Math.max(Math.max(Math.min(r,g),Math.min(u,C)),Math.min(h,f)),y=Math.min(Math.min(Math.max(r,g),Math.max(u,C)),Math.max(h,f));return!(y<0||p>y)}}const BW=new ce,vW=[new ce,new ce,new ce,new ce,new ce,new ce,new ce,new ce];class Qs{constructor(e,t,n,i){e===void 0&&(e=0),t===void 0&&(t=0),n===void 0&&(n=0),i===void 0&&(i=1),this.x=e,this.y=t,this.z=n,this.w=i}set(e,t,n,i){return this.x=e,this.y=t,this.z=n,this.w=i,this}toString(){return`${this.x},${this.y},${this.z},${this.w}`}toArray(){return[this.x,this.y,this.z,this.w]}setFromAxisAngle(e,t){const n=Math.sin(t*.5);return this.x=e.x*n,this.y=e.y*n,this.z=e.z*n,this.w=Math.cos(t*.5),this}toAxisAngle(e){e===void 0&&(e=new ce),this.normalize();const t=2*Math.acos(this.w),n=Math.sqrt(1-this.w*this.w);return n<.001?(e.x=this.x,e.y=this.y,e.z=this.z):(e.x=this.x/n,e.y=this.y/n,e.z=this.z/n),[e,t]}setFromVectors(e,t){if(e.isAntiparallelTo(t)){const n=B8,i=v8;e.tangents(n,i),this.setFromAxisAngle(n,Math.PI)}else{const n=e.cross(t);this.x=n.x,this.y=n.y,this.z=n.z,this.w=Math.sqrt(e.length()**2*t.length()**2)+e.dot(t),this.normalize()}return this}mult(e,t){t===void 0&&(t=new Qs);const n=this.x,i=this.y,s=this.z,o=this.w,r=e.x,g=e.y,u=e.z,C=e.w;return t.x=n*C+o*r+i*u-s*g,t.y=i*C+o*g+s*r-n*u,t.z=s*C+o*u+n*g-i*r,t.w=o*C-n*r-i*g-s*u,t}inverse(e){e===void 0&&(e=new Qs);const t=this.x,n=this.y,i=this.z,s=this.w;this.conjugate(e);const o=1/(t*t+n*n+i*i+s*s);return e.x*=o,e.y*=o,e.z*=o,e.w*=o,e}conjugate(e){return e===void 0&&(e=new Qs),e.x=-this.x,e.y=-this.y,e.z=-this.z,e.w=this.w,e}normalize(){let e=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w);return e===0?(this.x=0,this.y=0,this.z=0,this.w=0):(e=1/e,this.x*=e,this.y*=e,this.z*=e,this.w*=e),this}normalizeFast(){const e=(3-(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w))/2;return e===0?(this.x=0,this.y=0,this.z=0,this.w=0):(this.x*=e,this.y*=e,this.z*=e,this.w*=e),this}vmult(e,t){t===void 0&&(t=new ce);const n=e.x,i=e.y,s=e.z,o=this.x,r=this.y,g=this.z,u=this.w,C=u*n+r*s-g*i,h=u*i+g*n-o*s,f=u*s+o*i-r*n,p=-o*n-r*i-g*s;return t.x=C*u+p*-o+h*-g-f*-r,t.y=h*u+p*-r+f*-o-C*-g,t.z=f*u+p*-g+C*-r-h*-o,t}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w,this}toEuler(e,t){t===void 0&&(t="YZX");let n,i,s;const o=this.x,r=this.y,g=this.z,u=this.w;switch(t){case"YZX":const C=o*r+g*u;if(C>.499&&(n=2*Math.atan2(o,u),i=Math.PI/2,s=0),C<-.499&&(n=-2*Math.atan2(o,u),i=-Math.PI/2,s=0),n===void 0){const h=o*o,f=r*r,p=g*g;n=Math.atan2(2*r*u-2*o*g,1-2*f-2*p),i=Math.asin(2*C),s=Math.atan2(2*o*u-2*r*g,1-2*h-2*p)}break;default:throw new Error(`Euler order ${t} not supported yet.`)}e.y=n,e.z=i,e.x=s}setFromEuler(e,t,n,i){i===void 0&&(i="XYZ");const s=Math.cos(e/2),o=Math.cos(t/2),r=Math.cos(n/2),g=Math.sin(e/2),u=Math.sin(t/2),C=Math.sin(n/2);return i==="XYZ"?(this.x=g*o*r+s*u*C,this.y=s*u*r-g*o*C,this.z=s*o*C+g*u*r,this.w=s*o*r-g*u*C):i==="YXZ"?(this.x=g*o*r+s*u*C,this.y=s*u*r-g*o*C,this.z=s*o*C-g*u*r,this.w=s*o*r+g*u*C):i==="ZXY"?(this.x=g*o*r-s*u*C,this.y=s*u*r+g*o*C,this.z=s*o*C+g*u*r,this.w=s*o*r-g*u*C):i==="ZYX"?(this.x=g*o*r-s*u*C,this.y=s*u*r+g*o*C,this.z=s*o*C-g*u*r,this.w=s*o*r+g*u*C):i==="YZX"?(this.x=g*o*r+s*u*C,this.y=s*u*r+g*o*C,this.z=s*o*C-g*u*r,this.w=s*o*r-g*u*C):i==="XZY"&&(this.x=g*o*r-s*u*C,this.y=s*u*r-g*o*C,this.z=s*o*C+g*u*r,this.w=s*o*r+g*u*C),this}clone(){return new Qs(this.x,this.y,this.z,this.w)}slerp(e,t,n){n===void 0&&(n=new Qs);const i=this.x,s=this.y,o=this.z,r=this.w;let g=e.x,u=e.y,C=e.z,h=e.w,f,p,y,v,G;return p=i*g+s*u+o*C+r*h,p<0&&(p=-p,g=-g,u=-u,C=-C,h=-h),1-p>1e-6?(f=Math.acos(p),y=Math.sin(f),v=Math.sin((1-t)*f)/y,G=Math.sin(t*f)/y):(v=1-t,G=t),n.x=v*i+G*g,n.y=v*s+G*u,n.z=v*o+G*C,n.w=v*r+G*h,n}integrate(e,t,n,i){i===void 0&&(i=new Qs);const s=e.x*n.x,o=e.y*n.y,r=e.z*n.z,g=this.x,u=this.y,C=this.z,h=this.w,f=t*.5;return i.x+=f*(s*h+o*C-r*u),i.y+=f*(o*h+r*g-s*C),i.z+=f*(r*h+s*u-o*g),i.w+=f*(-s*g-o*u-r*C),i}}const B8=new ce,v8=new ce,Z8={SPHERE:1,PLANE:2,BOX:4,COMPOUND:8,CONVEXPOLYHEDRON:16,HEIGHTFIELD:32,PARTICLE:64,CYLINDER:128,TRIMESH:256};class Et{constructor(e){e===void 0&&(e={}),this.id=Et.idCounter++,this.type=e.type||0,this.boundingSphereRadius=0,this.collisionResponse=e.collisionResponse?e.collisionResponse:!0,this.collisionFilterGroup=e.collisionFilterGroup!==void 0?e.collisionFilterGroup:1,this.collisionFilterMask=e.collisionFilterMask!==void 0?e.collisionFilterMask:-1,this.material=e.material?e.material:null,this.body=null}updateBoundingSphereRadius(){throw`computeBoundingSphereRadius() not implemented for shape type ${this.type}`}volume(){throw`volume() not implemented for shape type ${this.type}`}calculateLocalInertia(e,t){throw`calculateLocalInertia() not implemented for shape type ${this.type}`}calculateWorldAABB(e,t,n,i){throw`calculateWorldAABB() not implemented for shape type ${this.type}`}}Et.idCounter=0;Et.types=Z8;class So{constructor(e){e===void 0&&(e={}),this.position=new ce,this.quaternion=new Qs,e.position&&this.position.copy(e.position),e.quaternion&&this.quaternion.copy(e.quaternion)}pointToLocal(e,t){return So.pointToLocalFrame(this.position,this.quaternion,e,t)}pointToWorld(e,t){return So.pointToWorldFrame(this.position,this.quaternion,e,t)}vectorToWorldFrame(e,t){return t===void 0&&(t=new ce),this.quaternion.vmult(e,t),t}static pointToLocalFrame(e,t,n,i){return i===void 0&&(i=new ce),n.vsub(e,i),t.conjugate(ZW),ZW.vmult(i,i),i}static pointToWorldFrame(e,t,n,i){return i===void 0&&(i=new ce),t.vmult(n,i),i.vadd(e,i),i}static vectorToWorldFrame(e,t,n){return n===void 0&&(n=new ce),e.vmult(t,n),n}static vectorToLocalFrame(e,t,n,i){return i===void 0&&(i=new ce),t.w*=-1,t.vmult(n,i),t.w*=-1,i}}const ZW=new Qs;new ce;new ce;new ce;new ce;new ce,new ce,new ce,new ce,new ce,new ce,new ce,new ce;new ce;new Qs;new Wl;new gc;new gc;new gc;new ce;new ce;new ce;new ce;new ce;new ce;new ce;new ce;new ce;new ce;new Qs;new ce;new ce;new ce;new ce;class K2{constructor(){this.rayFromWorld=new ce,this.rayToWorld=new ce,this.hitNormalWorld=new ce,this.hitPointWorld=new ce,this.hasHit=!1,this.shape=null,this.body=null,this.hitFaceIndex=-1,this.distance=-1,this.shouldStop=!1}reset(){this.rayFromWorld.setZero(),this.rayToWorld.setZero(),this.hitNormalWorld.setZero(),this.hitPointWorld.setZero(),this.hasHit=!1,this.shape=null,this.body=null,this.hitFaceIndex=-1,this.distance=-1,this.shouldStop=!1}abort(){this.shouldStop=!0}set(e,t,n,i,s,o,r){this.rayFromWorld.copy(e),this.rayToWorld.copy(t),this.hitNormalWorld.copy(n),this.hitPointWorld.copy(i),this.shape=s,this.body=o,this.distance=r}}let yN,GN,BN,vN,ZN,SN,RN;const aS={CLOSEST:1,ANY:2,ALL:4};yN=Et.types.SPHERE;GN=Et.types.PLANE;BN=Et.types.BOX;vN=Et.types.CYLINDER;ZN=Et.types.CONVEXPOLYHEDRON;SN=Et.types.HEIGHTFIELD;RN=Et.types.TRIMESH;class bs{get[yN](){return this._intersectSphere}get[GN](){return this._intersectPlane}get[BN](){return this._intersectBox}get[vN](){return this._intersectConvex}get[ZN](){return this._intersectConvex}get[SN](){return this._intersectHeightfield}get[RN](){return this._intersectTrimesh}constructor(e,t){e===void 0&&(e=new ce),t===void 0&&(t=new ce),this.from=e.clone(),this.to=t.clone(),this.direction=new ce,this.precision=1e-4,this.checkCollisionResponse=!0,this.skipBackfaces=!1,this.collisionFilterMask=-1,this.collisionFilterGroup=-1,this.mode=bs.ANY,this.result=new K2,this.hasHit=!1,this.callback=n=>{}}intersectWorld(e,t){return this.mode=t.mode||bs.ANY,this.result=t.result||new K2,this.skipBackfaces=!!t.skipBackfaces,this.collisionFilterMask=typeof t.collisionFilterMask<"u"?t.collisionFilterMask:-1,this.collisionFilterGroup=typeof t.collisionFilterGroup<"u"?t.collisionFilterGroup:-1,this.checkCollisionResponse=typeof t.checkCollisionResponse<"u"?t.checkCollisionResponse:!0,t.from&&this.from.copy(t.from),t.to&&this.to.copy(t.to),this.callback=t.callback||(()=>{}),this.hasHit=!1,this.result.reset(),this.updateDirection(),this.getAABB(SW),Mv.length=0,e.broadphase.aabbQuery(e,SW,Mv),this.intersectBodies(Mv),this.hasHit}intersectBody(e,t){t&&(this.result=t,this.updateDirection());const n=this.checkCollisionResponse;if(n&&!e.collisionResponse||(this.collisionFilterGroup&e.collisionFilterMask)===0||(e.collisionFilterGroup&this.collisionFilterMask)===0)return;const i=S8,s=R8;for(let o=0,r=e.shapes.length;o<r;o++){const g=e.shapes[o];if(!(n&&!g.collisionResponse)&&(e.quaternion.mult(e.shapeOrientations[o],s),e.quaternion.vmult(e.shapeOffsets[o],i),i.vadd(e.position,i),this.intersectShape(g,s,i,e),this.result.shouldStop))break}}intersectBodies(e,t){t&&(this.result=t,this.updateDirection());for(let n=0,i=e.length;!this.result.shouldStop&&n<i;n++)this.intersectBody(e[n])}updateDirection(){this.to.vsub(this.from,this.direction),this.direction.normalize()}intersectShape(e,t,n,i){const s=this.from;if(z8(s,this.direction,n)>e.boundingSphereRadius)return;const r=this[e.type];r&&r.call(this,e,t,n,i,e)}_intersectBox(e,t,n,i,s){return this._intersectConvex(e.convexPolyhedronRepresentation,t,n,i,s)}_intersectPlane(e,t,n,i,s){const o=this.from,r=this.to,g=this.direction,u=new ce(0,0,1);t.vmult(u,u);const C=new ce;o.vsub(n,C);const h=C.dot(u);r.vsub(n,C);const f=C.dot(u);if(h*f>0||o.distanceTo(r)<h)return;const p=u.dot(g);if(Math.abs(p)<this.precision)return;const y=new ce,v=new ce,G=new ce;o.vsub(n,y);const B=-u.dot(y)/p;g.scale(B,v),o.vadd(v,G),this.reportIntersection(u,G,s,i,-1)}getAABB(e){const{lowerBound:t,upperBound:n}=e,i=this.to,s=this.from;t.x=Math.min(i.x,s.x),t.y=Math.min(i.y,s.y),t.z=Math.min(i.z,s.z),n.x=Math.max(i.x,s.x),n.y=Math.max(i.y,s.y),n.z=Math.max(i.z,s.z)}_intersectHeightfield(e,t,n,i,s){e.data,e.elementSize;const o=w8;o.from.copy(this.from),o.to.copy(this.to),So.pointToLocalFrame(n,t,o.from,o.from),So.pointToLocalFrame(n,t,o.to,o.to),o.updateDirection();const r=x8;let g,u,C,h;g=u=0,C=h=e.data.length-1;const f=new Wl;o.getAABB(f),e.getIndexOfPosition(f.lowerBound.x,f.lowerBound.y,r,!0),g=Math.max(g,r[0]),u=Math.max(u,r[1]),e.getIndexOfPosition(f.upperBound.x,f.upperBound.y,r,!0),C=Math.min(C,r[0]+1),h=Math.min(h,r[1]+1);for(let p=g;p<C;p++)for(let y=u;y<h;y++){if(this.result.shouldStop)return;if(e.getAabbAtIndex(p,y,f),!!f.overlapsRay(o)){if(e.getConvexTrianglePillar(p,y,!1),So.pointToWorldFrame(n,t,e.pillarOffset,Yb),this._intersectConvex(e.pillarConvex,t,Yb,i,s,RW),this.result.shouldStop)return;e.getConvexTrianglePillar(p,y,!0),So.pointToWorldFrame(n,t,e.pillarOffset,Yb),this._intersectConvex(e.pillarConvex,t,Yb,i,s,RW)}}}_intersectSphere(e,t,n,i,s){const o=this.from,r=this.to,g=e.radius,u=(r.x-o.x)**2+(r.y-o.y)**2+(r.z-o.z)**2,C=2*((r.x-o.x)*(o.x-n.x)+(r.y-o.y)*(o.y-n.y)+(r.z-o.z)*(o.z-n.z)),h=(o.x-n.x)**2+(o.y-n.y)**2+(o.z-n.z)**2-g**2,f=C**2-4*u*h,p=W8,y=V8;if(!(f<0))if(f===0)o.lerp(r,f,p),p.vsub(n,y),y.normalize(),this.reportIntersection(y,p,s,i,-1);else{const v=(-C-Math.sqrt(f))/(2*u),G=(-C+Math.sqrt(f))/(2*u);if(v>=0&&v<=1&&(o.lerp(r,v,p),p.vsub(n,y),y.normalize(),this.reportIntersection(y,p,s,i,-1)),this.result.shouldStop)return;G>=0&&G<=1&&(o.lerp(r,G,p),p.vsub(n,y),y.normalize(),this.reportIntersection(y,p,s,i,-1))}}_intersectConvex(e,t,n,i,s,o){const r=M8,g=wW,u=o&&o.faceList||null,C=e.faces,h=e.vertices,f=e.faceNormals,p=this.direction,y=this.from,v=this.to,G=y.distanceTo(v),B=u?u.length:C.length,R=this.result;for(let x=0;!R.shouldStop&&x<B;x++){const w=u?u[x]:x,M=C[w],H=f[w],N=t,F=n;g.copy(h[M[0]]),N.vmult(g,g),g.vadd(F,g),g.vsub(y,g),N.vmult(H,r);const Y=p.dot(r);if(Math.abs(Y)<this.precision)continue;const X=r.dot(g)/Y;if(!(X<0)){p.scale(X,Go),Go.vadd(y,Go),Cr.copy(h[M[0]]),N.vmult(Cr,Cr),F.vadd(Cr,Cr);for(let U=1;!R.shouldStop&&U<M.length-1;U++){Ig.copy(h[M[U]]),Cg.copy(h[M[U+1]]),N.vmult(Ig,Ig),N.vmult(Cg,Cg),F.vadd(Ig,Ig),F.vadd(Cg,Cg);const O=Go.distanceTo(y);!(bs.pointInTriangle(Go,Cr,Ig,Cg)||bs.pointInTriangle(Go,Ig,Cr,Cg))||O>G||this.reportIntersection(r,Go,s,i,w)}}}}_intersectTrimesh(e,t,n,i,s,o){const r=H8,g=E8,u=T8,C=wW,h=X8,f=N8,p=Y8,y=F8,v=K8,G=e.indices;e.vertices;const B=this.from,R=this.to,x=this.direction;u.position.copy(n),u.quaternion.copy(t),So.vectorToLocalFrame(n,t,x,h),So.pointToLocalFrame(n,t,B,f),So.pointToLocalFrame(n,t,R,p),p.x*=e.scale.x,p.y*=e.scale.y,p.z*=e.scale.z,f.x*=e.scale.x,f.y*=e.scale.y,f.z*=e.scale.z,p.vsub(f,h),h.normalize();const w=f.distanceSquared(p);e.tree.rayQuery(this,u,g);for(let M=0,H=g.length;!this.result.shouldStop&&M!==H;M++){const N=g[M];e.getNormal(N,r),e.getVertex(G[N*3],Cr),Cr.vsub(f,C);const F=h.dot(r),Y=r.dot(C)/F;if(Y<0)continue;h.scale(Y,Go),Go.vadd(f,Go),e.getVertex(G[N*3+1],Ig),e.getVertex(G[N*3+2],Cg);const X=Go.distanceSquared(f);!(bs.pointInTriangle(Go,Ig,Cr,Cg)||bs.pointInTriangle(Go,Cr,Ig,Cg))||X>w||(So.vectorToWorldFrame(t,r,v),So.pointToWorldFrame(n,t,Go,y),this.reportIntersection(v,y,s,i,N))}g.length=0}reportIntersection(e,t,n,i,s){const o=this.from,r=this.to,g=o.distanceTo(t),u=this.result;if(!(this.skipBackfaces&&e.dot(this.direction)>0))switch(u.hitFaceIndex=typeof s<"u"?s:-1,this.mode){case bs.ALL:this.hasHit=!0,u.set(o,r,e,t,n,i,g),u.hasHit=!0,this.callback(u);break;case bs.CLOSEST:(g<u.distance||!u.hasHit)&&(this.hasHit=!0,u.hasHit=!0,u.set(o,r,e,t,n,i,g));break;case bs.ANY:this.hasHit=!0,u.hasHit=!0,u.set(o,r,e,t,n,i,g),u.shouldStop=!0;break}}static pointInTriangle(e,t,n,i){i.vsub(t,_I),n.vsub(t,ef),e.vsub(t,Hv);const s=_I.dot(_I),o=_I.dot(ef),r=_I.dot(Hv),g=ef.dot(ef),u=ef.dot(Hv);let C,h;return(C=g*r-o*u)>=0&&(h=s*u-o*r)>=0&&C+h<s*g-o*o}}bs.CLOSEST=aS.CLOSEST;bs.ANY=aS.ANY;bs.ALL=aS.ALL;const SW=new Wl,Mv=[],ef=new ce,Hv=new ce,S8=new ce,R8=new Qs,Go=new ce,Cr=new ce,Ig=new ce,Cg=new ce;new ce;new K2;const RW={faceList:[0]},Yb=new ce,w8=new bs,x8=[],W8=new ce,V8=new ce,M8=new ce;new ce;new ce;const wW=new ce,H8=new ce,X8=new ce,N8=new ce,Y8=new ce,K8=new ce,F8=new ce;new Wl;const E8=[],T8=new So,_I=new ce,Kb=new ce;function z8(a,e,t){t.vsub(a,_I);const n=_I.dot(e);return e.scale(n,Kb),Kb.vadd(a,Kb),t.distanceTo(Kb)}new ce;new ce;new ce;new ce;new ce;new ce;new ce;new ce;new ce;new ce;new ce;new ce;new ce;new ce;new ce;new ce;new ce;new ce;new ce;new ce;new ce;new ce;new ce;new ce;new ce;new ce;new ce;new ce;new ce;new ce;new ce;new ce;new ce;new ce;new ce;new ce;new ce;new ce;new ce;new ce;new ce;new ce;new ce;new ce;new ce;new bs;new ce;new ce;new ce;new ce(1,0,0),new ce(0,1,0),new ce(0,0,1);new ce;new ce;new ce;new ce;new ce;new ce;new ce;new ce;new ce;new ce;new ce;new ce;new ce;new ce;new ce;new ce;new ce;new ce;new ce;new ce;new ce;new ce;new ce;new ce;new ce;new ce;new ce;new ce;new ce;new ce;new ce;new Wl;new ce;new Wl;new ce;new ce;new ce;new ce;new ce;new ce;new ce;new Wl;new ce;new So;new Wl;Et.types.SPHERE,Et.types.SPHERE|Et.types.PLANE,Et.types.BOX|Et.types.BOX,Et.types.SPHERE|Et.types.BOX,Et.types.PLANE|Et.types.BOX,Et.types.CONVEXPOLYHEDRON,Et.types.SPHERE|Et.types.CONVEXPOLYHEDRON,Et.types.PLANE|Et.types.CONVEXPOLYHEDRON,Et.types.BOX|Et.types.CONVEXPOLYHEDRON,Et.types.SPHERE|Et.types.HEIGHTFIELD,Et.types.BOX|Et.types.HEIGHTFIELD,Et.types.CONVEXPOLYHEDRON|Et.types.HEIGHTFIELD,Et.types.PARTICLE|Et.types.SPHERE,Et.types.PLANE|Et.types.PARTICLE,Et.types.BOX|Et.types.PARTICLE,Et.types.PARTICLE|Et.types.CONVEXPOLYHEDRON,Et.types.CYLINDER,Et.types.SPHERE|Et.types.CYLINDER,Et.types.PLANE|Et.types.CYLINDER,Et.types.BOX|Et.types.CYLINDER,Et.types.CONVEXPOLYHEDRON|Et.types.CYLINDER,Et.types.HEIGHTFIELD|Et.types.CYLINDER,Et.types.PARTICLE|Et.types.CYLINDER,Et.types.SPHERE|Et.types.TRIMESH,Et.types.PLANE|Et.types.TRIMESH;new ce;new ce;new ce;new ce;new ce;new Qs;new Qs;new ce;new ce;new ce;new ce;new ce;new ce;new ce;new ce;new ce;new ce;new ce;new ce;new ce;new ce;new ce;new ce;new ce;new Wl;new ce;new ce;new ce;new ce;new ce;new ce;new ce;new ce;new ce;new ce,new ce,new ce,new ce,new ce,new ce;new ce;new ce;new ce;new ce;new ce;new ce;new ce;new ce;new ce;new ce;new ce;new ce;new ce;new ce;new ce;new ce;new ce;new ce;new ce;new ce;new ce;new ce;new ce;new ce;new ce;new ce;new Qs;new ce;new ce;new ce;new ce;new ce;new ce;new ce;new ce;new ce;new Wl;new bs;const tf=globalThis.performance||{};if(!tf.now){let a=Date.now();tf.timing&&tf.timing.navigationStart&&(a=tf.timing.navigationStart),tf.now=()=>Date.now()-a}new ce;const L8=E.createContext(null),_8=()=>E.useContext(L8),wN=E.createContext(null),U8=()=>{const a=E.useContext(wN);if(!a)throw new Error("Physics context not found. @react-three/cannon & components can only be used within a Physics provider");return a};new ae(1,1,1);new ae;new Yt;const xW=new wn;function D8(a){const e=E.useRef(null);return a&&typeof a!="function"?a:e}function WW(a){return a.charAt(0).toUpperCase()+a.slice(1)}function ja(a,e){const t=e===void 0?"":`/${e}`;return typeof a=="function"?null:a&&a.current&&`${a.current.uuid}${t}`}const k8=new to,O8=new ca,J8=a=>e=>a(k8.setFromQuaternion(O8.fromArray(e)).toArray());let xN=0;function Xv(a,e,t,n,i,s){return s===void 0&&(s="bodies"),o=>{const r=xN++;t[r]={[n]:o};const g=ja(a,i);return g&&e.subscribe({props:{id:r,target:s,type:n},uuid:g}),()=>{delete t[r],e.unsubscribe({props:r})}}}function VW(a,e){let{position:t=[0,0,0],rotation:n=[0,0,0],userData:i={}}=e;a.userData=i,a.position.set(...t),a.rotation.set(...n),a.updateMatrix()}function MW(a,e,t){let{onCollide:n,onCollideBegin:i,onCollideEnd:s}=e;a[t]={collide:n,collideBegin:i,collideEnd:s}}function sS(a,e,t,n,i){n===void 0&&(n=null),i===void 0&&(i=[]);const s=D8(n),{events:o,refs:r,scaleOverrides:g,subscriptions:u,worker:C}=U8(),h=_8();E.useLayoutEffect(()=>{s.current||(s.current=new wn);const p=s.current,y=C,v=p instanceof eC?(p.instanceMatrix.setUsage(H0),p.count):1,G=p instanceof eC?new Array(v).fill(0).map((R,x)=>`${p.uuid}/${x}`):[p.uuid],B=p instanceof eC?G.map((R,x)=>{const w=e(x);return VW(xW,w),p.setMatrixAt(x,xW.matrix),p.instanceMatrix.needsUpdate=!0,r[R]=p,h?.add(R,w,a),MW(o,w,R),{...w,args:t(w.args)}}):G.map((R,x)=>{const w=e(x);return VW(p,w),r[R]=p,h?.add(R,w,a),MW(o,w,R),{...w,args:t(w.args)}});return y.addBodies({props:B.map(R=>{let{onCollide:x,onCollideBegin:w,onCollideEnd:M,...H}=R;return{onCollide:!!x,...H}}),type:a,uuid:G}),()=>{G.forEach(R=>{delete r[R],h?.remove(R),delete o[R]}),y.removeBodies({uuid:G})}},i);const f=E.useMemo(()=>{const p=(x,w)=>{const M=`set${WW(x)}`;return{set:H=>{const N=ja(s,w);N&&C[M]({props:H,uuid:N})},subscribe:Xv(s,C,u,x,w)}},y=x=>({copy:M=>{let{w:H,x:N,y:F,z:Y}=M;const X=ja(s,x);X&&C.setQuaternion({props:[N,F,Y,H],uuid:X})},set:(M,H,N,F)=>{const Y=ja(s,x);Y&&C.setQuaternion({props:[M,H,N,F],uuid:Y})},subscribe:Xv(s,C,u,"quaternion",x)}),v=x=>({copy:w=>{let{x:M,y:H,z:N}=w;const F=ja(s,x);F&&C.setRotation({props:[M,H,N],uuid:F})},set:(w,M,H)=>{const N=ja(s,x);N&&C.setRotation({props:[w,M,H],uuid:N})},subscribe:w=>{const M=xN++,H="bodies",N="quaternion",F=ja(s,x);return u[M]={[N]:J8(w)},F&&C.subscribe({props:{id:M,target:H,type:N},uuid:F}),()=>{delete u[M],C.unsubscribe({props:M})}}}),G=(x,w)=>{const M=`set${WW(x)}`;return{copy:H=>{let{x:N,y:F,z:Y}=H;const X=ja(s,w);X&&C[M]({props:[N,F,Y],uuid:X})},set:(H,N,F)=>{const Y=ja(s,w);Y&&C[M]({props:[H,N,F],uuid:Y})},subscribe:Xv(s,C,u,x,w)}};function B(x){return{allowSleep:p("allowSleep",x),angularDamping:p("angularDamping",x),angularFactor:G("angularFactor",x),angularVelocity:G("angularVelocity",x),applyForce(w,M){const H=ja(s,x);H&&C.applyForce({props:[w,M],uuid:H})},applyImpulse(w,M){const H=ja(s,x);H&&C.applyImpulse({props:[w,M],uuid:H})},applyLocalForce(w,M){const H=ja(s,x);H&&C.applyLocalForce({props:[w,M],uuid:H})},applyLocalImpulse(w,M){const H=ja(s,x);H&&C.applyLocalImpulse({props:[w,M],uuid:H})},applyTorque(w){const M=ja(s,x);M&&C.applyTorque({props:[w],uuid:M})},collisionFilterGroup:p("collisionFilterGroup",x),collisionFilterMask:p("collisionFilterMask",x),collisionResponse:p("collisionResponse",x),fixedRotation:p("fixedRotation",x),isTrigger:p("isTrigger",x),linearDamping:p("linearDamping",x),linearFactor:G("linearFactor",x),mass:p("mass",x),material:p("material",x),position:G("position",x),quaternion:y(x),rotation:v(x),scaleOverride(w){const M=ja(s,x);M&&(g[M]=new ae(...w))},sleep(){const w=ja(s,x);w&&C.sleep({uuid:w})},sleepSpeedLimit:p("sleepSpeedLimit",x),sleepTimeLimit:p("sleepTimeLimit",x),userData:p("userData",x),velocity:G("velocity",x),wakeUp(){const w=ja(s,x);w&&C.wakeUp({uuid:w})}}}const R={};return{...B(void 0),at:x=>R[x]||(R[x]=B(x))}},[]);return[s,f]}function P8(a,e,t){return sS("Plane",a,()=>[],e,t)}function WN(a,e,t){const n=[1,1,1];return sS("Box",a,function(i){return i===void 0&&(i=n),i},e,t)}function VN(a,e,t){return sS("Sphere",a,function(n){if(n===void 0&&(n=[1]),!Array.isArray(n))throw new Error("useSphere args must be an array");return[n[0]]},e,t)}const Q8=new ae,j8=new ae(1,1,1),q8=new ca,Fb=new Yt;function HW(a,e,t,n,i){return n===void 0&&(n=j8),a!==void 0?(Fb.compose(Q8.fromArray(e,a*3),q8.fromArray(t,a*4),n),i&&(i.matrixAutoUpdate=!1,i.matrix.copy(Fb)),Fb):Fb.identity()}const $8=()=>{const a=[];return e=>a.includes(e)?!1:!!a.push(e)};function e6(a){let{allowSleep:e=!1,axisIndex:t=0,broadphase:n="Naive",children:i,defaultContactMaterial:s={contactEquationStiffness:1e6},frictionGravity:o=null,gravity:r=[0,-9.81,0],isPaused:g=!1,iterations:u=5,maxSubSteps:C=10,quatNormalizeFast:h=!1,quatNormalizeSkip:f=0,shouldInvalidate:p=!0,size:y=1e3,solver:v="GS",stepSize:G=1/60,tolerance:B=.001}=a;const{invalidate:R}=qa(),[{bodies:x,events:w,refs:M,scaleOverrides:H,subscriptions:N,worker:F}]=E.useState(()=>({bodies:{},events:{},refs:{},scaleOverrides:{},subscriptions:{},worker:new j7({allowSleep:e,axisIndex:t,broadphase:n,defaultContactMaterial:s,frictionGravity:o,gravity:r,iterations:u,quatNormalizeFast:h,quatNormalizeSkip:f,size:y,solver:v,tolerance:B})}));let Y=0;const X=E.useCallback((J,Q)=>{g||(Y+=Q,F.step({maxSubSteps:C,stepSize:G,timeSinceLastCalled:Y}),Y=0)},[g,C,G]),U=J=>{var Q;let{body:se,contact:{bi:L,bj:D,...ne},target:oe,...j}=J;const re=(Q=w[oe])==null?void 0:Q.collide;re&&re({body:M[se],contact:{bi:M[L],bj:M[D],...ne},target:M[oe],...j})},O=J=>{var Q,se;let{bodyA:L,bodyB:D}=J;const ne=(Q=w[L])==null?void 0:Q.collideBegin;ne&&ne({body:M[D],op:"event",target:M[L],type:"collideBegin"});const oe=(se=w[D])==null?void 0:se.collideBegin;oe&&oe({body:M[L],op:"event",target:M[D],type:"collideBegin"})},P=J=>{var Q,se;let{bodyA:L,bodyB:D}=J;const ne=(Q=w[L])==null?void 0:Q.collideEnd;ne&&ne({body:M[D],op:"event",target:M[L],type:"collideEnd"});const oe=(se=w[D])==null?void 0:se.collideEnd;oe&&oe({body:M[L],op:"event",target:M[D],type:"collideEnd"})},ie=J=>{let{active:Q,bodies:se=[],observations:L,positions:D,quaternions:ne}=J;for(let oe=0;oe<se.length;oe++)x[se[oe]]=oe;if(L.forEach(oe=>{let[j,re,pe]=oe;const be=(N[j]||{})[pe];be&&be(re)}),!!Q){for(const oe of Object.values(M).filter($8()))if(oe instanceof eC)for(let j=0;j<oe.count;j++){const re=`${oe.uuid}/${j}`,pe=x[re];pe!==void 0&&(oe.setMatrixAt(j,HW(pe,D,ne,H[re])),oe.instanceMatrix.needsUpdate=!0)}else{const j=H[oe.uuid]||oe.scale;HW(x[oe.uuid],D,ne,j,oe)}p&&R()}},le=J=>{var Q;let{body:se,ray:{uuid:L,...D},...ne}=J;const oe=(Q=w[L])==null?void 0:Q.rayhit;oe&&oe({body:se?M[se]:null,ray:{uuid:L,...D},...ne})};Wo(X),E.useEffect(()=>(F.connect(),F.init(),F.on("collide",U),F.on("collideBegin",O),F.on("collideEnd",P),F.on("frame",ie),F.on("rayhit",le),()=>{F.terminate(),F.removeAllListeners()}),[]),E.useEffect(()=>{F.axisIndex=t},[t]),E.useEffect(()=>{F.broadphase=n},[n]),E.useEffect(()=>{F.gravity=r},[r]),E.useEffect(()=>{F.iterations=u},[u]),E.useEffect(()=>{F.tolerance=B},[B]);const T=E.useMemo(()=>({bodies:x,events:w,refs:M,scaleOverrides:H,subscriptions:N,worker:F}),[x,w,M,N,F]);return de.jsx(wN.Provider,{value:T,children:i})}const t6=rk({uFade:.12,uColor:new Gt("#e9dbbb")},`
    varying vec2 vUv;
    void main() {
      vUv = uv;
      gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
    }
  `,`
    varying vec2 vUv;
    uniform float uFade;
    uniform vec3 uColor;

    void main() {
 
      float fadeX = smoothstep(0.0, uFade, vUv.x);
      fadeX *= 1.0 - smoothstep(1.0 - uFade, 1.0, vUv.x);

      float fadeY = smoothstep(0.0, uFade, vUv.y);
      fadeY *= 1.0 - smoothstep(1.0 - uFade, 1.0, vUv.y);

      float fade = fadeX * fadeY; // combine le fade horizontal & vertical

      gl_FragColor = vec4(uColor, fade);
      if (gl_FragColor.a < 0.01) discard;
    }
  `);WZ({RectFadeMaterial:t6});function n6({size:a=50,...e}){const{onShoot:t,onPointerMove:n,...i}=e,[s]=P8(()=>({position:[0,.01,0],rotation:[-Math.PI/2,0,0],mass:0,userData:{name:"ground"},...i})),{uFade:o,color:r}=Mu("ground",{uFade:{value:.4,min:0,max:.4,step:.01,label:"Largeur Fade (bord)"},color:{value:"#f0f0f0",label:"Couleur du sol"}});return de.jsxs(de.Fragment,{children:[de.jsxs("mesh",{"rotation-x":-Math.PI/2,ref:s,receiveShadow:!0,onClick:t,onPointerMove:e.onPointerMove,children:[de.jsx("circleGeometry",{args:[10,32]}),de.jsx("shadowMaterial",{transparent:!0,opacity:.4})]}),de.jsxs("mesh",{"rotation-x":-Math.PI/2,position:[0,0,0],children:[de.jsx("planeGeometry",{args:[a,a,100,100]}),de.jsx("rectFadeMaterial",{uFade:o,uColor:new Gt(r),transparent:!0})]})]})}function i6({count:a=60,colors:e=["#FF6F61","#FFB400","#44CFCB","#6B47DC","#F652A0"],duration:t=2,onComplete:n,distanceFromCamera:i=5,...s}){const o=E.useRef(null),{camera:r,size:g}=qa(),u=r,C=E.useMemo(()=>{const f=new ae;u.getWorldDirection(f);const p=u.position.clone().add(f.clone().multiplyScalar(i)),y=u.fov*Math.PI/180,v=2*Math.tan(y/2)*i,G=g.width/g.height,B=v*G,R=u.up.clone().normalize(),x=new ae().crossVectors(f,R).normalize();return{spawnCenter:p,width:B,height:v,right:x,up:R}},[u.position.x,u.position.y,u.position.z,u.quaternion.x,u.quaternion.y,u.quaternion.z,u.quaternion.w,u.fov,g.width,g.height,i]),h=E.useRef(Array.from({length:a}).map(()=>{const f=(Math.random()-.5)*C.width,p=Math.random()*2+C.height/2,y=C.spawnCenter.clone().add(C.right.clone().multiplyScalar(f)).add(C.up.clone().multiplyScalar(p));return{x:y.x,y:y.y,z:y.z,rx:f,color:e[Math.floor(Math.random()*e.length)],rot:[Math.random()*Math.PI,Math.random()*Math.PI,Math.random()*Math.PI],velY:-Math.random()*1.5-.5,rotSpeed:[Math.random()*.05,Math.random()*.05,Math.random()*.05]}}));return E.useEffect(()=>{let f=setTimeout(()=>n?.(),t*1e3);return()=>clearTimeout(f)},[t,n]),Wo((f,p)=>{h.current.forEach((y,v)=>{if(y.y+=y.velY*p,y.velY-=.5*p,y.rot[0]+=y.rotSpeed[0],y.rot[1]+=y.rotSpeed[1],y.rot[2]+=y.rotSpeed[2],y.y<C.spawnCenter.y-C.height/2-1){const B=C.height/2+Math.random()*2,R=C.spawnCenter.clone().add(C.right.clone().multiplyScalar(y.rx)).add(C.up.clone().multiplyScalar(B));y.x=R.x,y.y=R.y,y.z=R.z,y.velY=-Math.random()*1.5-.5}else{const B=C.spawnCenter.clone().add(C.right.clone().multiplyScalar(y.rx)).add(C.up.clone().multiplyScalar(y.y-C.spawnCenter.y));y.x=B.x,y.z=B.z}const G=o.current?.children[v];G&&(G.position.set(y.x,y.y,y.z),G.rotation.set(y.rot[0],y.rot[1],y.rot[2]))})}),de.jsxs("group",{ref:o,...s,children:[h.current.map((f,p)=>de.jsxs("mesh",{children:[de.jsx("planeGeometry",{args:[.1,.2]}),de.jsx("meshStandardMaterial",{color:f.color})]},p)),s.children]})}const dr={GAMEPLAY:"GAMEPLAY",GAME_OVER:"GAME_OVER",VICTORY:"VICTORY"};function a6(a){const e=E.useRef(null);return Wo(({camera:t})=>{e.current&&e.current.lookAt(t.position)}),de.jsxs(i6,{children:[de.jsx(gA,{ref:e,position:[0,1,0],fontSize:.5,color:"#000000",anchorX:"center",anchorY:"middle",children:"Success !"}),de.jsx(HZ,{position:[-.5,1,0],children:de.jsx("button",{type:"button",onClick:t=>{t.preventDefault(),a.onClick()},children:"Retry"})})]})}function s6(a){const e=E.useRef(null);return Wo(({camera:t})=>{e.current&&e.current.lookAt(t.position)}),de.jsxs(de.Fragment,{children:[de.jsx(gA,{ref:e,position:[0,1,0],fontSize:.5,color:"#000000",anchorX:"center",anchorY:"middle",children:"You loose :-("}),de.jsx(HZ,{position:[-.5,1,0],children:de.jsx("button",{type:"button",onClick:t=>{t.preventDefault(),a.onClick()},children:"Retry"})})]})}let o6=(a=21)=>crypto.getRandomValues(new Uint8Array(a)).reduce((e,t)=>(t&=63,t<36?e+=t.toString(36):t<62?e+=(t-26).toString(36).toUpperCase():t>62?e+="-":e+="_",e),"");function Eb(a,e,t,n,i,s,o=.2,r=new ae(0,0,0),g=new to(0,0,0)){const u=[];let f=0;for(;u.length<a&&f<1e3;){f++;const p=Math.sqrt(Math.random())*(e-o),y=n+Math.random()*t,v=new ae(p*Math.cos(y),0,p*Math.sin(y));v.applyEuler(g),v.add(r),u.some(B=>new ae(...B.position).distanceTo(v)<i)||u.push({id:o6(),position:[v.x,v.y+.05,v.z],color:s})}return u}function MN(a,e){return[a*Math.PI/180,e*Math.PI/180]}function l6(a,e){return Math.sqrt((a[0]-e[0])**2+(a[2]-e[2])**2)}function HN(a,e,t,n,i,s,o,r=1e4){const g=[];let u=0;for(;g.length<a&&u<r;){u++;const C=i+Math.random()*(s-i),h=Math.sqrt(Math.random()*(t**2-e**2)+e**2),f=n[0]+Math.cos(C)*h,p=n[1],y=n[2]+Math.sin(C)*h,v=[f,p,y];let G=!0;for(const B of g)if(l6(v,B.position)<o){G=!1;break}(G||g.length===0)&&g.push({position:v})}return g}function XW(a,e){const t=Math.ceil(a),n=Math.floor(e);return Math.floor(Math.random()*(n-t+1))+t}const r6=E.memo(({id:a,position:e,color:t,life:n,delayRange:i=[0,20],gameplay:s})=>{const o=E.useRef(0),r=E.useRef(null),g=E.useRef({fire:!1,pos:new ae}),u=E.useRef(n),[C,h]=WN(()=>({mass:1,position:e,args:[.2,.2,.2],angularFactor:[0,0,0],userData:{type:"enemy",id:a}})),f=E.useMemo(()=>Math.random()*(i[1]-i[0])+i[0],[]),p=3;return Wo((y,v)=>{o.current+=v,o.current>=f&&o.current>=p&&(g.current.pos.x<=3&&h.velocity.set(2,0,0),o.current-=p)}),E.useEffect(()=>h.position.subscribe(v=>{g.current.pos.fromArray(v),r.current&&(r.current.text=`${v[0].toFixed()}`),g.current.fire===!1&&v[0]>=3&&(s?.(a),g.current.fire=!0)}),[]),de.jsxs("mesh",{ref:C,castShadow:!0,children:[de.jsx("boxGeometry",{args:[.2,.2,.2]}),de.jsx("meshStandardMaterial",{color:t}),de.jsx(XN,{children:`${n}/${u.current}`})]})}),g6=E.memo(({id:a,position:e,color:t,life:n,delayRange:i=[0,10],gameplay:s})=>{const o=E.useRef(0),r=E.useRef(n),[g,u]=WN(()=>({mass:1,position:e,args:[.1,.1,.1],angularFactor:[0,0,0],userData:{type:"friend",id:a}})),C=E.useRef(null),h=E.useRef({fire:!1,pos:new ae}),f=E.useMemo(()=>Math.random()*(i[1]-i[0])+i[0],[]),p=3;return Wo((y,v)=>{o.current+=v,o.current>=f&&o.current>=p&&(h.current.pos.x<=4&&u.velocity.set(2,0,0),o.current-=p)}),E.useEffect(()=>u.position.subscribe(v=>{C.current&&(C.current.text=`${v[0].toFixed(1)}/ ${v[1].toFixed(1)}/ ${v[2].toFixed(1)}`),h.current.pos.fromArray(v),h.current.fire===!1&&v[0]>=4&&(s?.(a),h.current.fire=!0)}),[]),de.jsxs("mesh",{ref:g,castShadow:!0,children:[de.jsx("boxGeometry",{args:[.2,.1,.1]}),de.jsx("meshStandardMaterial",{color:t}),de.jsx(XN,{children:`${n}/${r.current}`})]})}),XN=({children:a,...e})=>{const t=E.useRef(null);return Wo(({camera:n})=>{t.current&&t.current.lookAt(n.position)}),de.jsx(de.Fragment,{children:de.jsx(gA,{ref:t,color:"black",fontSize:.1,position:[.2,.2,0],...e,children:a})})};function c6({friends:a,enemies:e,...t}){const{position:n}=Mu("Info",{position:{value:[4.2,.7,1.5],step:.1}});return de.jsxs(de.Fragment,{children:[de.jsxs("group",{position:n,children:[de.jsx(gA,{color:"black",fontSize:.09,position:[0,.1,0],children:`Friends:${a}`}),de.jsx(gA,{color:"black",fontSize:.09,anchorX:"center",anchorY:"middle",children:`Enemies:${e}`})]}),t.children]})}function u6({ref:a}){const e=E.useRef(null),t=E.useRef(0),{position:n,rotation:i}=Mu("Score",{position:{value:[4.2,.9,1.5],step:.1},rotation:{value:[0,0,0],step:.1}});return E.useImperativeHandle(a,()=>({add:s=>{t.current+=s}}),[]),de.jsx(gA,{position:n,rotation:i,fontSize:.09,color:"black",ref:e,children:`Score:${t.current}`})}const NN="/castledefense/castle/GLB_format/wall-narrow.glb";function nf(a){const{nodes:e,materials:t}=$t(NN);return de.jsx("group",{...a,dispose:null,children:de.jsx("mesh",{name:"wall-narrow_1",geometry:e["wall-narrow_1"].geometry,material:t.colormap})})}$t.preload(NN);const YN="/castledefense/castle/GLB_format/flag-banner-short.glb";function Tb(a){const{nodes:e,materials:t}=$t(YN);return de.jsx("group",{...a,dispose:null,children:de.jsx("mesh",{name:"flag-banner-short_1",geometry:e["flag-banner-short_1"].geometry,material:t.colormap})})}$t.preload(YN);const KN="/castledefense/castle/GLB_format/tree-large.glb";function mi(a){const{nodes:e,materials:t}=$t(KN);return de.jsx("group",{...a,dispose:null,children:de.jsx("mesh",{name:"tree-large_1",geometry:e["tree-large_1"].geometry,material:t.colormap})})}$t.preload(KN);const oS="/castledefense/castle/GLB_format/tree-small.glb";function na(a){const{nodes:e,materials:t}=$t(oS);return de.jsx("group",{...a,dispose:null,children:de.jsx("mesh",{name:"tree-small_1",geometry:e["tree-small_1"].geometry,material:t.colormap})})}function NW({data:a,range:e,scale:t}){const{nodes:n,materials:i}=$t(oS);return de.jsx(fk,{scale:t,range:e,material:i.colormap,geometry:n["tree-small_1"].geometry,children:a.map((s,o)=>de.jsx(I6,{...s},o))})}function I6(a){return de.jsx("group",{...a,children:de.jsx(SH,{})})}$t.preload(oS);const FN="/castledefense/castle/GLB_format/wall-corner-half-tower.glb";function F2(a){const{nodes:e,materials:t}=$t(FN);return de.jsx("group",{...a,dispose:null,children:de.jsx("mesh",{name:"wall-corner-half-tower_1",geometry:e["wall-corner-half-tower_1"].geometry,material:t.colormap})})}$t.preload(FN);const EN="/castledefense/castle/GLB_format/wall-narrow-stairs.glb";function C6(a){const{nodes:e,materials:t}=$t(EN);return de.jsx("group",{...a,dispose:null,children:de.jsx("mesh",{name:"wall-narrow-stairs_1",geometry:e["wall-narrow-stairs_1"].geometry,material:t.colormap})})}$t.preload(EN);const TN="/castledefense/castle/GLB_format/gate.glb";function d6(a){const{nodes:e,materials:t}=$t(TN);return de.jsx("group",{...a,dispose:null,children:de.jsx("mesh",{name:"gate_1",geometry:e.gate_1.geometry,material:t.colormap})})}$t.preload(TN);const zN="/castledefense/castle/GLB_format/wall-narrow-gate.glb";function A6(a){const{nodes:e,materials:t}=$t(zN);return de.jsx("group",{...a,dispose:null,children:de.jsx("mesh",{name:"wall-narrow-gate_1",geometry:e["wall-narrow-gate_1"].geometry,material:t.colormap})})}$t.preload(zN);const LN="/castledefense/castle/GLB_format/wall-to-narrow.glb";function h6(a){const{nodes:e,materials:t}=$t(LN);return de.jsx("group",{...a,dispose:null,children:de.jsx("mesh",{name:"wall-to-narrow_1",geometry:e["wall-to-narrow_1"].geometry,material:t.colormap})})}$t.preload(LN);const _N="/castledefense/castle/GLB_format/wall-narrow-stairs-rail.glb";function f6(a){const{nodes:e,materials:t}=$t(_N);return de.jsx("group",{...a,dispose:null,children:de.jsx("mesh",{name:"wall-narrow-stairs-rail_1",geometry:e["wall-narrow-stairs-rail_1"].geometry,material:t.colormap})})}$t.preload(_N);const UN="/castledefense/castle/GLB_format/wall-pillar.glb";function YW(a){const{nodes:e,materials:t}=$t(UN);return de.jsx("group",{...a,dispose:null,children:de.jsx("mesh",{name:"wall-pillar_1",geometry:e["wall-pillar_1"].geometry,material:t.colormap})})}$t.preload(UN);const DN="/castledefense/castle/GLB_format/wall-corner-half.glb";function p6(a){const{nodes:e,materials:t}=$t(DN);return de.jsx("group",{...a,dispose:null,children:de.jsx("mesh",{name:"wall-corner-half_1",geometry:e["wall-corner-half_1"].geometry,material:t.colormap})})}$t.preload(DN);const kN="/castledefense/castle/GLB_format/wall.glb";function Nv(a){const{nodes:e,materials:t}=$t(kN);return de.jsx("group",{...a,dispose:null,children:de.jsx("mesh",{name:"wall_1",geometry:e.wall_1.geometry,material:t.colormap})})}$t.preload(kN);const ON="/castledefense/castle/GLB_format/wall-corner-slant.glb";function m6(a){const{nodes:e,materials:t}=$t(ON);return de.jsx("group",{...a,dispose:null,children:de.jsx("mesh",{name:"wall-corner-slant_1",geometry:e["wall-corner-slant_1"].geometry,material:t.colormap})})}$t.preload(ON);const JN="/castledefense/castle/GLB_format/tower-square-base-color.glb";function b6(a){const{nodes:e,materials:t}=$t(JN);return de.jsx("group",{...a,dispose:null,children:de.jsx("mesh",{name:"tower-square-base-color_1",geometry:e["tower-square-base-color_1"].geometry,material:t.colormap})})}$t.preload(JN);const PN="/castledefense/castle/GLB_format/tower-slant-roof.glb";function y6(a){const{nodes:e,materials:t}=$t(PN);return de.jsx("group",{...a,dispose:null,children:de.jsx("mesh",{name:"tower-slant-roof_1",geometry:e["tower-slant-roof_1"].geometry,material:t.colormap})})}$t.preload(PN);const QN="/castledefense/castle/GLB_format/bridge-draw.glb";function G6(a){const{nodes:e,materials:t}=$t(QN);return de.jsx("group",{...a,dispose:null,children:de.jsx("mesh",{name:"bridge-draw_1",geometry:e["bridge-draw_1"].geometry,material:t.colormap})})}$t.preload(QN);const jN="/castledefense/castle/GLB_format/rocks-large.glb";function B6(a){const{nodes:e,materials:t}=$t(jN);return de.jsx("group",{...a,dispose:null,children:de.jsx("mesh",{name:"rocks-large_1",geometry:e["rocks-large_1"].geometry,material:t.colormap})})}$t.preload(jN);const qN="/castledefense/pirate/GLBformat/patch-sand.glb";function KW(a){const{nodes:e,materials:t}=$t(qN);return de.jsx("group",{...a,dispose:null,children:de.jsx("mesh",{name:"patch-sand_1",geometry:e["patch-sand_1"].geometry,material:t.colormap})})}$t.preload(qN);const $N="/castledefense/castle/GLB_format/rocks-small.glb";function v6(a){const{nodes:e,materials:t}=$t($N);return de.jsx("group",{...a,dispose:null,children:de.jsx("mesh",{name:"rocks-small_1",geometry:e["rocks-small_1"].geometry,material:t.colormap})})}$t.preload($N);function Z6(a){return de.jsxs("group",{...a,dispose:null,children:[a.children,de.jsxs("group",{name:"Scene",children:[de.jsx(S6,{}),de.jsx(X6,{}),de.jsx(R6,{hero:a.hero,position:[3.91,0,.98],rotation:[-2.7982624053781304,-1.5518478432668705,-2.7984850858530317]})]})]})}function S6(){return de.jsxs("group",{name:"Castle",position:[3.91,0,5.21],rotation:[0,1.5707963267948966,0],children:[de.jsx(KW,{position:[6.01,-.23,2.60274969005641],scale:[1.74,.95,1.8]}),de.jsx(KW,{position:[-9.19863570103075,-.22,-19.31],rotation:[0,-.9599310885968813,0]}),de.jsx(F2,{position:[8.14,0,.00861587832121291],rotation:[0,1.5707963267949,0]}),de.jsx(h6,{position:[8.13875368967917,0,.96],rotation:[3.141592653589793,24980018054066017e-32,-3.1415926535897927]}),de.jsx(nf,{position:[8.15652533058199,0,3.71],rotation:[3.141592653589793,-.017453292519945075,3.141592653589793]}),de.jsx(nf,{position:[7.17,0,.0111959906723946],rotation:[0,-1.5707963267948966,0]}),de.jsx(F2,{position:[8.16551207482225,0,4.68],rotation:[-12246467991473535e-32,828503932126523e-29,12246467991473535e-32]}),de.jsx(m6,{position:[7.6683363042974,0,3.9],rotation:[0,1.5533430342749615,0]}),de.jsx(nf,{position:[5.2,0,.0155060482195601],rotation:[0,-1.5707963267948966,0]}),de.jsx(C6,{position:[4.19754524809229,0,.99],rotation:[3.141592653589793,-12490009027033014e-32,3.141592653589793]}),de.jsx(f6,{position:[8.17,0,2.90644801168798],rotation:[-3.141592653589793,24980018054066027e-32,-3.141592653589793]}),de.jsx(y6,{position:[6.13,1,2.90637838842338],rotation:[0,1.553343034274955,0]}),de.jsx(b6,{position:[6.13,0,2.93972336529792]}),de.jsx(na,{position:[5.14034820309399,0,1.73]}),de.jsx(A6,{position:[6.19,0,.0142204861339232],rotation:[0,1.5707963267948966,0]}),de.jsx(d6,{position:[6.16972726130578,0,-.48],rotation:[3.141592653589793,-1.553343034274955,3.141592653589793]}),de.jsxs("group",{name:"CastleLeftWall",position:[.608967054536858,0,.92],children:[de.jsx(nf,{position:[7.5345014326453,0,1.01896705453686],rotation:[-3.141592653589793,-.017453292519943226,-3.141592653589793]}),de.jsx(nf,{position:[3.61,0,.89],rotation:[0,0,0]}),de.jsx(YW,{position:[3.61,0,1.8],rotation:[0,0,0]}),de.jsx(YW,{position:[3.61,0,2.8],rotation:[3.141592653589793,-12246467991473532e-32,3.141592653589793]}),de.jsx(p6,{position:[3.61,0,3.77],rotation:[3.141592653589793,-12246467991473532e-32,3.141592653589793]}),de.jsx(Nv,{position:[4.60839710040731,0,3.76896705453686],rotation:[-12246467991473535e-32,1.5707963267948966,0]}),de.jsx(Nv,{position:[5.58602019424858,0,3.76896705453686],rotation:[-12246467991473535e-32,1.5707963267948966,0]}),de.jsx(Nv,{position:[6.56017897937098,0,3.76896705453686],rotation:[-12246467991473535e-32,1.5707963267948966,0]}),de.jsx(Tb,{position:[3.07,.53,-.17698744765316],scale:.5}),de.jsx(Tb,{position:[4.35900936496689,.53,-1.41103294546314],scale:.5,rotation:[0,-1.5358897417550172,0]}),de.jsx(Tb,{position:[6.70230659444351,.53,-1.41103294546314],scale:.5,rotation:[0,-1.5358897417550172,0]}),de.jsx(Tb,{position:[8.02,.53,1.58811348228312],scale:.5,rotation:[3.141592653589793,-.03490658503987947,3.141592653589793]})]}),de.jsx(G6,{position:[6.16654347354107,0,-.56],rotation:[3.141592653589793,-1.553343034274955,3.141592653589793]}),de.jsx(B6,{position:[10.4,0,-19.6054452305556],scale:[5.55,3.46,1]}),de.jsx(v6,{position:[23.5087653094466,0,-5.9]})]})}function R6(a){return de.jsxs("group",{name:"Tower",...a,children:[a.hero,de.jsx(F2,{name:"WallConerTowerRight",position:[0,0,0]})]})}const[w6,x6]=MN(90,300),W6=HN(200,20,40,[0,0,0],w6,x6,1),[V6,M6]=MN(150,300),H6=HN(200,120,150,[0,0,0],V6,M6,1);function X6(){const{range:a}=Mu("Itrees",{range:{value:200,min:0,max:300,step:10}});return de.jsxs("group",{name:"Tree",position:[0,0,0],children:[de.jsx(na,{name:"tree-small001",castShadow:!0,receiveShadow:!0,position:[-2.38,0,1.867],scale:.5}),de.jsx(na,{name:"tree-small002",castShadow:!0,receiveShadow:!0,position:[-4.72,0,2.351],scale:.5}),de.jsx(na,{name:"tree-small003",castShadow:!0,receiveShadow:!0,position:[-4.16,0,2.648],scale:.5}),de.jsx(na,{name:"tree-small004",castShadow:!0,receiveShadow:!0,position:[-4.6,0,2.899],scale:.5}),de.jsx(na,{name:"tree-small005",castShadow:!0,receiveShadow:!0,position:[-2.79,0,3.371],scale:.5}),de.jsx(na,{name:"tree-small006",castShadow:!0,receiveShadow:!0,position:[-2.27,0,3.821],scale:.5}),de.jsx(na,{name:"tree-small007",castShadow:!0,receiveShadow:!0,position:[.379,0,3.955],scale:.5}),de.jsx(na,{name:"tree-small008",castShadow:!0,receiveShadow:!0,position:[.157,0,4.293],scale:.5}),de.jsx(na,{name:"tree-small009",castShadow:!0,receiveShadow:!0,position:[-.18,0,5.44],scale:.5}),de.jsx(na,{name:"tree-small010",castShadow:!0,receiveShadow:!0,position:[-5.2,0,1.423],scale:.5}),de.jsx(na,{name:"tree-small011",castShadow:!0,receiveShadow:!0,position:[-4.38,0,.84],scale:.5}),de.jsx(na,{name:"tree-small012",castShadow:!0,receiveShadow:!0,position:[-4.38,0,.84],scale:.5}),de.jsx(na,{name:"tree-small013",castShadow:!0,receiveShadow:!0,position:[-6.21,0,-2.98],scale:.5}),de.jsx(na,{name:"tree-small014",castShadow:!0,receiveShadow:!0,position:[-4.38,0,.84],scale:.5}),de.jsx(na,{name:"tree-small015",castShadow:!0,receiveShadow:!0,position:[-4.99,0,-1.85],scale:.5}),de.jsx(na,{name:"tree-small016",castShadow:!0,receiveShadow:!0,position:[-6.29,0,-4.41],scale:.5}),de.jsx(na,{name:"tree-small017",castShadow:!0,receiveShadow:!0,position:[-6.79,0,.61],scale:.5}),de.jsx(na,{name:"tree-small018",castShadow:!0,receiveShadow:!0,position:[-7.12,0,1.97],scale:.5}),de.jsx(na,{name:"tree-small019",castShadow:!0,receiveShadow:!0,position:[-5.95,0,.84],scale:.5}),de.jsx(na,{name:"tree-small020",castShadow:!0,receiveShadow:!0,position:[-6.7,0,-.47],scale:.5}),de.jsx(na,{name:"tree-small021",castShadow:!0,receiveShadow:!0,position:[1.59,0,5.54],scale:.5}),de.jsx(mi,{name:"tree-large001",castShadow:!0,receiveShadow:!0,position:[-3.41,0,-3.05],scale:.5}),de.jsx(mi,{name:"tree-large002",castShadow:!0,receiveShadow:!0,position:[-1.34,0,3.68],scale:.5}),de.jsx(mi,{name:"tree-large003",castShadow:!0,receiveShadow:!0,position:[-5.47,0,.57],scale:.5}),de.jsx(mi,{name:"tree-large004",castShadow:!0,receiveShadow:!0,position:[-2.12,0,2.74],scale:.5}),de.jsx(mi,{name:"tree-large005",castShadow:!0,receiveShadow:!0,position:[-3.03,0,.94],scale:.5}),de.jsx(mi,{name:"tree-large006",castShadow:!0,receiveShadow:!0,position:[-2.96,0,1.896],scale:.5}),de.jsx(mi,{name:"tree-large007",castShadow:!0,receiveShadow:!0,position:[-3.54,0,-1.12],scale:.5}),de.jsx(mi,{name:"tree-large008",castShadow:!0,receiveShadow:!0,position:[-3.23,0,-.77],scale:.5}),de.jsx(mi,{name:"tree-large009",castShadow:!0,receiveShadow:!0,position:[-3.44,0,2.654],scale:.5}),de.jsx(mi,{name:"tree-large010",castShadow:!0,receiveShadow:!0,position:[-4.72,0,-.54],scale:.5}),de.jsx(mi,{name:"tree-large011",castShadow:!0,receiveShadow:!0,position:[-3.34,0,3.39],scale:.5}),de.jsx(mi,{name:"tree-large012",castShadow:!0,receiveShadow:!0,position:[-3.6,0,2.041],scale:.5}),de.jsx(mi,{name:"tree-large013",castShadow:!0,receiveShadow:!0,position:[-.356,0,4.194],scale:.5}),de.jsx(mi,{name:"tree-large014",castShadow:!0,receiveShadow:!0,position:[-1.283,0,4.439],scale:.5}),de.jsx(mi,{name:"tree-large015",castShadow:!0,receiveShadow:!0,position:[-5.92,0,-1.49],scale:.5}),de.jsx(mi,{name:"tree-large016",castShadow:!0,receiveShadow:!0,position:[-3.12,0,-2.24],scale:.5}),de.jsx(mi,{name:"tree-large017",castShadow:!0,receiveShadow:!0,position:[-5.47,0,4.1],scale:.5}),de.jsx(mi,{name:"tree-large018",castShadow:!0,receiveShadow:!0,position:[-2.53,0,-4.86],scale:.5}),de.jsx(mi,{name:"tree-large019",castShadow:!0,receiveShadow:!0,position:[-2.85,0,-4.09],scale:.5}),de.jsx(mi,{name:"tree-large020",castShadow:!0,receiveShadow:!0,position:[-3.86,0,-2.33],scale:.5}),de.jsx(mi,{name:"tree-large021",castShadow:!0,receiveShadow:!0,position:[-3.86,0,-2.33],scale:.5}),de.jsx(mi,{name:"tree-large022",castShadow:!0,receiveShadow:!0,position:[-3.86,0,-2.33],scale:.5}),de.jsx(mi,{name:"tree-large023",castShadow:!0,receiveShadow:!0,position:[-3.86,0,-2.33],scale:.5}),de.jsx(mi,{name:"tree-large024",castShadow:!0,receiveShadow:!0,position:[-3.86,0,-2.33],scale:.5}),de.jsx(mi,{name:"tree-large025",castShadow:!0,receiveShadow:!0,position:[-3.86,0,-2.33],scale:.5}),de.jsx(mi,{name:"tree-large026",castShadow:!0,receiveShadow:!0,position:[.37,0,5.01],scale:.5}),de.jsx(NW,{data:W6,range:a,scale:.3}),de.jsx(NW,{data:H6,range:a,scale:.1})]})}const e9="/castledefense/pirate/GLBformat/cannon.glb";function N6(a){const{nodes:e,materials:t}=$t(e9);return de.jsx("group",{...a,dispose:null,children:de.jsxs("mesh",{name:"cannon_1",geometry:e.cannon_1.geometry,material:t.colormap,children:[de.jsx("mesh",{name:"Group",geometry:e.Group.geometry,material:t.colormap,position:[-.229,.3,-.825],rotation:[0,0,.262]}),de.jsx("mesh",{name:"Group_1",geometry:e.Group_1.geometry,material:t.colormap,position:[.519,.222,-.825],rotation:[0,0,-.262]})]})})}$t.preload(e9);const Y6=-Math.PI/12,K6=Math.PI/4,F6=E.forwardRef((a,e)=>{const{heroPosition:t}=Mu("hero",{heroPosition:{value:[.5,1.5,.5],step:.1},angleX:{value:[Y6,K6],step:.1},fov:30});return Wo(()=>{e&&"current"in e&&e.current&&a.aimPoint!==null&&e.current.lookAt(a.aimPoint)}),de.jsx(de.Fragment,{children:de.jsxs("mesh",{ref:e,...a,position:t,scale:.3,children:[de.jsx(N6,{position:[0,-.5,0]}),de.jsx(E6,{position:new ae(0,0,5)})]})})});function E6(a){const{rotation:e}=Mu("reticule",{rotation:{value:[.4,.9,.2],step:.1}});return de.jsxs("mesh",{receiveShadow:!0,position:a.position,rotation:e,children:[de.jsx("tetrahedronGeometry",{args:[.5,0]}),de.jsx("meshStandardMaterial",{visible:!0,color:"blue"})]})}E.memo(({id:a,position:e,velocity:t,onCollide:n})=>{const[i]=VN(()=>({mass:.1,position:e,velocity:t,args:[.2],onCollide:n,userData:{type:"projectile",id:a}}));return de.jsxs("mesh",{ref:i,children:[de.jsx("sphereGeometry",{args:[.02,16,16]}),de.jsx("meshStandardMaterial",{color:"red"})]})});const T6=E.forwardRef(({id:a,active:e,returnToPool:t,onCollide:n},i)=>{const[s,o]=VN(()=>({mass:2,position:[0,-10,0],args:[.05],onCollide:n,userData:{type:"stone",id:a},material:{restitution:.1,friction:.8}}));return E.useEffect(()=>{o.sleep()},[o]),E.useImperativeHandle(i,()=>o),Wo(()=>{e&&s.current.position.y<-20&&t(a)}),de.jsxs("mesh",{ref:s,visible:e,castShadow:!0,children:[de.jsx("sphereGeometry",{args:[.05,16,16]}),de.jsx("meshStandardMaterial",{color:"grey"})]})}),Mi={enemies:60,friends:5,radius:6.1,position:new ae(-2,0,0),arcAngle:3,startAngle:1.6,minDistance:.5},FW=20;function z6(){const a=E.useRef(null),e=E.useRef(new ae(0,.5,-5)),t=E.useRef(null);let[n,i]=E.useState(dr.GAMEPLAY);const[s,o]=E.useState(()=>Eb(Mi.enemies,Mi.radius,Mi.arcAngle,Mi.startAngle,Mi.minDistance,"orange",void 0,Mi.position).map(w=>({...w,life:XW(3,10),saved:!1}))),[r,g]=E.useState(()=>Eb(Mi.friends,Mi.radius,Mi.arcAngle,Mi.startAngle,Mi.minDistance,"#2b7fff",void 0,Mi.position).map(w=>({...w,life:XW(1,3),saved:!1}))),u=E.useMemo(()=>Array.from({length:FW}).map((w,M)=>({id:M,active:!1})),[]),[C,h]=E.useState(u),f=E.useRef([]),p=E.useRef(0),y=w=>{f.current[w]?.sleep(),h(M=>M.map(H=>H.id===w?{...H,active:!1}:H))},v=E.useCallback(w=>{const{body:M,target:H}=w;if(M.userData?.name==="ground")return;const N=(F,Y)=>{o(X=>X.map(U=>U.id===F?(U.life==1&&t.current?.add(10),{...U,life:U.life-1}):U)),g(X=>X.map(U=>U.id===F?{...U,life:U.life-1}:U)),y(Y),o(X=>X.filter(U=>U.life>0)),g(X=>X.filter(U=>U.life>0))};M.userData.type==="enemy"&&H.userData.type==="stone"&&N(M.userData.id,H.userData.id),M.userData.type==="friend"&&H.userData.type==="stone"&&N(M.userData.id,H.userData.id)},[]),G=w=>{w.stopPropagation(),e.current?.copy(w.point)},B=w=>{w.stopPropagation();const M=p.current,H=f.current[M];if(H){const N=new ae;a.current.getWorldPosition(N);const F=new ae;a.current.getWorldDirection(F),h(U=>U.map(O=>O.id===M?{...O,active:!0}:O)),H.wakeUp(),H.position.copy(N),H.velocity.set(0,0,0);const X=F.multiplyScalar(30);H.applyImpulse([X.x,X.y,X.z],[0,0,0]),p.current=(M+1)%FW}},R=()=>{o(()=>Eb(Mi.enemies,Mi.radius,Mi.arcAngle,Mi.startAngle,Mi.minDistance,"orange",void 0,Mi.position).map(w=>({...w,life:3,saved:!1}))),g(Eb(Mi.friends,Mi.radius,Mi.arcAngle,Mi.startAngle,Mi.minDistance,"blue",void 0,Mi.position).map(w=>({...w,life:3,saved:!1}))),i(dr.GAMEPLAY)},x=w=>{g(r.map(M=>(M.id==w&&(M.saved=!0),M)))};return s.length===0&&n!==dr.VICTORY&&i(dr.VICTORY),r.length===0&&n!==dr.GAME_OVER&&i(dr.GAME_OVER),r.length&&r.every(w=>w.saved)&&n!==dr.VICTORY&&i(dr.VICTORY),de.jsxs(de.Fragment,{children:[de.jsx(HZ,{fullscreen:!0,style:{fontSize:60},children:de.jsx("div",{style:{color:"black",marginLeft:20},children:"CASTLE DEFENSE"})}),de.jsx(F7,{}),de.jsx(E7,{}),n==dr.VICTORY.toString()&&de.jsx(a6,{onClick:R}),n==dr.GAME_OVER.toString()&&de.jsx(s6,{onClick:R}),de.jsx(Z6,{hero:de.jsx(F6,{ref:a,aimPoint:e.current}),children:de.jsx(c6,{friends:r.length,enemies:s.length,children:de.jsx(u6,{ref:t})})}),de.jsxs(e6,{children:[de.jsx(n6,{onShoot:B,onPointerMove:G}),s.map(w=>de.jsx(r6,{...w,gameplay:()=>{i(dr.GAME_OVER)}},w.id)),r.map(w=>de.jsx(g6,{...w,gameplay:M=>{x(M)}},w.id)),C.map((w,M)=>de.jsx(T6,{id:w.id,active:w.active,onCollide:v,ref:H=>{H&&(f.current[M]=H)},returnToPool:y},w.id))]}),null,de.jsx(sN,{hidden:!0})]})}function L6(){return de.jsx("div",{style:{height:"100vh"},children:de.jsx(p_,{dpr:[1.5,2],shadows:!0,children:de.jsx(z6,{})})})}E2.createRoot(document.getElementById("root")).render(de.jsx(E.StrictMode,{children:de.jsx(L6,{})}));
